/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={320:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(537),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,".aut {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    height: 100vh;\r\n    width: 100vw;\r\n    background-color: var(--dark);\r\n    z-index: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    gap: 40px;\r\n}\r\n\r\n.aut button {\r\n    font-family: var(--unbounded);\r\n    color: var(--light);\r\n    padding: 8px;\r\n    background-color: transparent;\r\n    border: 2px solid var(--light);\r\n    cursor: pointer;\r\n    transition: 0.5s;\r\n}\r\n\r\n.aut button:hover {\r\n    background-color: var(--light);\r\n    color: var(--dark);\r\n}\r\n\r\n.invisible {\r\n    display: none;\r\n}","",{version:3,sources:["webpack://./src/styles/aut.css"],names:[],mappings:"AAAA;IACI,eAAe;IACf,MAAM;IACN,OAAO;IACP,aAAa;IACb,YAAY;IACZ,6BAA6B;IAC7B,UAAU;IACV,aAAa;IACb,sBAAsB;IACtB,mBAAmB;IACnB,uBAAuB;IACvB,SAAS;AACb;;AAEA;IACI,6BAA6B;IAC7B,mBAAmB;IACnB,YAAY;IACZ,6BAA6B;IAC7B,8BAA8B;IAC9B,eAAe;IACf,gBAAgB;AACpB;;AAEA;IACI,8BAA8B;IAC9B,kBAAkB;AACtB;;AAEA;IACI,aAAa;AACjB",sourcesContent:[".aut {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    height: 100vh;\r\n    width: 100vw;\r\n    background-color: var(--dark);\r\n    z-index: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    gap: 40px;\r\n}\r\n\r\n.aut button {\r\n    font-family: var(--unbounded);\r\n    color: var(--light);\r\n    padding: 8px;\r\n    background-color: transparent;\r\n    border: 2px solid var(--light);\r\n    cursor: pointer;\r\n    transition: 0.5s;\r\n}\r\n\r\n.aut button:hover {\r\n    background-color: var(--light);\r\n    color: var(--dark);\r\n}\r\n\r\n.invisible {\r\n    display: none;\r\n}"],sourceRoot:""}]);const a=o},497:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(537),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,".header-title {\r\n    color: var(--light);\r\n    font-family: var(--unbounded);\r\n}\r\n\r\nheader img {\r\n    position: absolute;\r\n    top: 19.5px;\r\n    left: 19.5px;\r\n    cursor: pointer;\r\n    visibility: hidden;\r\n}\r\n\r\n@media only screen and (max-width: 780px) {\r\n    header img {\r\n        visibility: visible;\r\n    }\r\n}","",{version:3,sources:["webpack://./src/styles/header.css"],names:[],mappings:"AAAA;IACI,mBAAmB;IACnB,6BAA6B;AACjC;;AAEA;IACI,kBAAkB;IAClB,WAAW;IACX,YAAY;IACZ,eAAe;IACf,kBAAkB;AACtB;;AAEA;IACI;QACI,mBAAmB;IACvB;AACJ",sourcesContent:[".header-title {\r\n    color: var(--light);\r\n    font-family: var(--unbounded);\r\n}\r\n\r\nheader img {\r\n    position: absolute;\r\n    top: 19.5px;\r\n    left: 19.5px;\r\n    cursor: pointer;\r\n    visibility: hidden;\r\n}\r\n\r\n@media only screen and (max-width: 780px) {\r\n    header img {\r\n        visibility: visible;\r\n    }\r\n}"],sourceRoot:""}]);const a=o},63:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(537),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Unbounded&display=swap);"]),o.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap);"]),o.push([e.id,":root {\r\n    --light: #FFFFFF;\r\n    --dark: #0d1321;\r\n    --grey: #D2D7DF;\r\n    --unbounded: 'Unbounded', cursive;\r\n    --roboto: 'Roboto', sans-serif;\r\n}\r\n\r\n* {\r\n    margin: 0;\r\n    padding: 0;\r\n    box-sizing: border-box;\r\n    /*border: 1px solid red;*/\r\n}\r\n\r\nheader {\r\n    height: 10vh;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: var(--dark);\r\n    position: relative;\r\n}\r\n\r\n.main-container {\r\n    display: flex;\r\n}\r\n\r\nnav {\r\n    flex: 2;\r\n    height: 90vh;\r\n    overflow-y: auto;\r\n}\r\n\r\nmain {\r\n    flex: 8;\r\n    height: 90vh;\r\n    overflow-y: auto;\r\n}\r\n\r\n\r\n/*Scroll bar code from: https://www.cssportal.com/css-scrollbar-generator/ */\r\n\r\n\r\n/* Firefox */\r\n\r\n* {\r\n    scrollbar-width: thin;\r\n    scrollbar-color: #747474 #DFE9EB;\r\n}\r\n\r\n\r\n/* Chrome, Edge and Safari */\r\n\r\n*::-webkit-scrollbar {\r\n    width: 4px;\r\n    width: 4px;\r\n}\r\n\r\n*::-webkit-scrollbar-track {\r\n    border-radius: 5px;\r\n    background-color: #DFE9EB;\r\n}\r\n\r\n*::-webkit-scrollbar-track:hover {\r\n    background-color: #B8C0C2;\r\n}\r\n\r\n*::-webkit-scrollbar-track:active {\r\n    background-color: #B8C0C2;\r\n}\r\n\r\n*::-webkit-scrollbar-thumb {\r\n    border-radius: 5px;\r\n    background-color: #747474;\r\n}\r\n\r\n*::-webkit-scrollbar-thumb:hover {\r\n    background-color: #747474;\r\n}\r\n\r\n*::-webkit-scrollbar-thumb:active {\r\n    background-color: #000000;\r\n}\r\n\r\n@media only screen and (max-width: 780px) {\r\n    .visible {\r\n        display: block;\r\n    }\r\n    .main-container {\r\n        flex-direction: column;\r\n    }\r\n}","",{version:3,sources:["webpack://./src/styles/mainLayout.css"],names:[],mappings:"AAEA;IACI,gBAAgB;IAChB,eAAe;IACf,eAAe;IACf,iCAAiC;IACjC,8BAA8B;AAClC;;AAEA;IACI,SAAS;IACT,UAAU;IACV,sBAAsB;IACtB,yBAAyB;AAC7B;;AAEA;IACI,YAAY;IACZ,aAAa;IACb,mBAAmB;IACnB,uBAAuB;IACvB,6BAA6B;IAC7B,kBAAkB;AACtB;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,OAAO;IACP,YAAY;IACZ,gBAAgB;AACpB;;AAEA;IACI,OAAO;IACP,YAAY;IACZ,gBAAgB;AACpB;;;AAGA,4EAA4E;;;AAG5E,YAAY;;AAEZ;IACI,qBAAqB;IACrB,gCAAgC;AACpC;;;AAGA,4BAA4B;;AAE5B;IACI,UAAU;IACV,UAAU;AACd;;AAEA;IACI,kBAAkB;IAClB,yBAAyB;AAC7B;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI,kBAAkB;IAClB,yBAAyB;AAC7B;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI,yBAAyB;AAC7B;;AAEA;IACI;QACI,cAAc;IAClB;IACA;QACI,sBAAsB;IAC1B;AACJ",sourcesContent:["@import url('https://fonts.googleapis.com/css2?family=Unbounded&display=swap');\r\n@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');\r\n:root {\r\n    --light: #FFFFFF;\r\n    --dark: #0d1321;\r\n    --grey: #D2D7DF;\r\n    --unbounded: 'Unbounded', cursive;\r\n    --roboto: 'Roboto', sans-serif;\r\n}\r\n\r\n* {\r\n    margin: 0;\r\n    padding: 0;\r\n    box-sizing: border-box;\r\n    /*border: 1px solid red;*/\r\n}\r\n\r\nheader {\r\n    height: 10vh;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: var(--dark);\r\n    position: relative;\r\n}\r\n\r\n.main-container {\r\n    display: flex;\r\n}\r\n\r\nnav {\r\n    flex: 2;\r\n    height: 90vh;\r\n    overflow-y: auto;\r\n}\r\n\r\nmain {\r\n    flex: 8;\r\n    height: 90vh;\r\n    overflow-y: auto;\r\n}\r\n\r\n\r\n/*Scroll bar code from: https://www.cssportal.com/css-scrollbar-generator/ */\r\n\r\n\r\n/* Firefox */\r\n\r\n* {\r\n    scrollbar-width: thin;\r\n    scrollbar-color: #747474 #DFE9EB;\r\n}\r\n\r\n\r\n/* Chrome, Edge and Safari */\r\n\r\n*::-webkit-scrollbar {\r\n    width: 4px;\r\n    width: 4px;\r\n}\r\n\r\n*::-webkit-scrollbar-track {\r\n    border-radius: 5px;\r\n    background-color: #DFE9EB;\r\n}\r\n\r\n*::-webkit-scrollbar-track:hover {\r\n    background-color: #B8C0C2;\r\n}\r\n\r\n*::-webkit-scrollbar-track:active {\r\n    background-color: #B8C0C2;\r\n}\r\n\r\n*::-webkit-scrollbar-thumb {\r\n    border-radius: 5px;\r\n    background-color: #747474;\r\n}\r\n\r\n*::-webkit-scrollbar-thumb:hover {\r\n    background-color: #747474;\r\n}\r\n\r\n*::-webkit-scrollbar-thumb:active {\r\n    background-color: #000000;\r\n}\r\n\r\n@media only screen and (max-width: 780px) {\r\n    .visible {\r\n        display: block;\r\n    }\r\n    .main-container {\r\n        flex-direction: column;\r\n    }\r\n}"],sourceRoot:""}]);const a=o},926:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(537),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,"nav {\r\n    font-family: var(--roboto);\r\n    background-color: var(--dark);\r\n    color: var(--light);\r\n    padding-left: 8px;\r\n    padding-right: 8px;\r\n}\r\n\r\nnav ul {\r\n    margin-top: 20px;\r\n    margin-bottom: 20px;\r\n}\r\n\r\nnav li button {\r\n    color: var(--light);\r\n    background-color: var(--dark);\r\n    padding: 2px;\r\n    border-radius: 8px;\r\n    border: transparent;\r\n    font-size: larger;\r\n    margin-top: 4px;\r\n    margin-bottom: 4px;\r\n    cursor: pointer;\r\n    transition: 0.3s;\r\n}\r\n\r\nnav li button:hover {\r\n    color: var(--dark);\r\n    background-color: var(--light);\r\n    transition: 0.3s;\r\n}\r\n\r\nnav span {\r\n    font-size: xx-large;\r\n    font-weight: 700;\r\n}\r\n\r\n#add-container {\r\n    display: flex;\r\n    justify-content: center;\r\n    margin-top: 6px;\r\n}\r\n\r\n#add {\r\n    color: var(--dark);\r\n    background-color: var(--light);\r\n    font-weight: 700;\r\n}\r\n\r\n.icon {\r\n    height: 26.4px;\r\n    width: 26.4px;\r\n    filter: invert(100%) sepia(99%) saturate(119%) hue-rotate(196deg) brightness(116%) contrast(100%);\r\n}\r\n\r\n.badger {\r\n    display: inline;\r\n    background-color: var(--light);\r\n    padding: 1px;\r\n    color: var(--dark);\r\n    border-radius: 2px;\r\n}\r\n\r\n@media only screen and (max-width: 780px) {\r\n    nav {\r\n        display: none;\r\n    }\r\n}","",{version:3,sources:["webpack://./src/styles/nav.css"],names:[],mappings:"AAAA;IACI,0BAA0B;IAC1B,6BAA6B;IAC7B,mBAAmB;IACnB,iBAAiB;IACjB,kBAAkB;AACtB;;AAEA;IACI,gBAAgB;IAChB,mBAAmB;AACvB;;AAEA;IACI,mBAAmB;IACnB,6BAA6B;IAC7B,YAAY;IACZ,kBAAkB;IAClB,mBAAmB;IACnB,iBAAiB;IACjB,eAAe;IACf,kBAAkB;IAClB,eAAe;IACf,gBAAgB;AACpB;;AAEA;IACI,kBAAkB;IAClB,8BAA8B;IAC9B,gBAAgB;AACpB;;AAEA;IACI,mBAAmB;IACnB,gBAAgB;AACpB;;AAEA;IACI,aAAa;IACb,uBAAuB;IACvB,eAAe;AACnB;;AAEA;IACI,kBAAkB;IAClB,8BAA8B;IAC9B,gBAAgB;AACpB;;AAEA;IACI,cAAc;IACd,aAAa;IACb,iGAAiG;AACrG;;AAEA;IACI,eAAe;IACf,8BAA8B;IAC9B,YAAY;IACZ,kBAAkB;IAClB,kBAAkB;AACtB;;AAEA;IACI;QACI,aAAa;IACjB;AACJ",sourcesContent:["nav {\r\n    font-family: var(--roboto);\r\n    background-color: var(--dark);\r\n    color: var(--light);\r\n    padding-left: 8px;\r\n    padding-right: 8px;\r\n}\r\n\r\nnav ul {\r\n    margin-top: 20px;\r\n    margin-bottom: 20px;\r\n}\r\n\r\nnav li button {\r\n    color: var(--light);\r\n    background-color: var(--dark);\r\n    padding: 2px;\r\n    border-radius: 8px;\r\n    border: transparent;\r\n    font-size: larger;\r\n    margin-top: 4px;\r\n    margin-bottom: 4px;\r\n    cursor: pointer;\r\n    transition: 0.3s;\r\n}\r\n\r\nnav li button:hover {\r\n    color: var(--dark);\r\n    background-color: var(--light);\r\n    transition: 0.3s;\r\n}\r\n\r\nnav span {\r\n    font-size: xx-large;\r\n    font-weight: 700;\r\n}\r\n\r\n#add-container {\r\n    display: flex;\r\n    justify-content: center;\r\n    margin-top: 6px;\r\n}\r\n\r\n#add {\r\n    color: var(--dark);\r\n    background-color: var(--light);\r\n    font-weight: 700;\r\n}\r\n\r\n.icon {\r\n    height: 26.4px;\r\n    width: 26.4px;\r\n    filter: invert(100%) sepia(99%) saturate(119%) hue-rotate(196deg) brightness(116%) contrast(100%);\r\n}\r\n\r\n.badger {\r\n    display: inline;\r\n    background-color: var(--light);\r\n    padding: 1px;\r\n    color: var(--dark);\r\n    border-radius: 2px;\r\n}\r\n\r\n@media only screen and (max-width: 780px) {\r\n    nav {\r\n        display: none;\r\n    }\r\n}"],sourceRoot:""}]);const a=o},666:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(537),i=n.n(r),s=n(645),o=n.n(s)()(i());o.push([e.id,'main {\r\n    padding: 5%;\r\n}\r\n\r\nmain li {\r\n    margin-top: 12px;\r\n    display: grid;\r\n    column-gap: 10px;\r\n    grid-template-columns: 2fr 28px 6fr 28px 1fr 1fr 28px;\r\n    text-align: center;\r\n    font-family: var(--roboto);\r\n    background-color: rgb(241, 241, 241);\r\n    padding: 4px;\r\n    border-radius: 6px;\r\n    border-left: 4px solid var(--dark);\r\n    line-height: 30px;\r\n}\r\n\r\nmain li button {\r\n    background-color: transparent;\r\n    border: none;\r\n    cursor: pointer;\r\n    transition: 0.3s;\r\n}\r\n\r\nmain img[alt="Delete Icon"] {\r\n    filter: invert(27%) sepia(50%) saturate(2918%) hue-rotate(344deg) brightness(83%) contrast(90%) !important;\r\n}\r\n\r\nmain input[type="date"] {\r\n    font-family: var(--roboto);\r\n    border: none;\r\n    border-radius: 8px;\r\n    font-size: small;\r\n}\r\n\r\nmain li button:hover {\r\n    background-color: rgb(210, 210, 210);\r\n    border-radius: 50%;\r\n    transition: 0.3s;\r\n}\r\n\r\nmain li input {\r\n    cursor: pointer;\r\n}\r\n\r\nmain li button img {\r\n    filter: brightness(0) !important;\r\n}\r\n\r\nmain span {\r\n    text-overflow: ellipsis;\r\n}\r\n\r\nmain>button {\r\n    margin-top: 12px;\r\n    display: block;\r\n    width: 100%;\r\n    text-align: center;\r\n    background-color: var(--dark);\r\n    color: var(--light);\r\n    font-family: var(--roboto);\r\n    padding: 3px;\r\n    border-radius: 8px;\r\n    border: transparent;\r\n    cursor: pointer;\r\n    font-size: x-large;\r\n    transition: 0.3s;\r\n}\r\n\r\nmain>button:hover {\r\n    transition: 0.3s;\r\n    background-color: #4f5053;\r\n}\r\n\r\n@media only screen and (max-width: 425px) {\r\n    main li {\r\n        /*\r\n        grid-template-columns: 1fr 1fr;\r\n        grid-template-rows: auto auto auto;*/\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n    }\r\n    input[type="checkbox"],\r\n    input[type="date"] {\r\n        max-height: 30.4px;\r\n    }\r\n}',"",{version:3,sources:["webpack://./src/styles/tasks.css"],names:[],mappings:"AAAA;IACI,WAAW;AACf;;AAEA;IACI,gBAAgB;IAChB,aAAa;IACb,gBAAgB;IAChB,qDAAqD;IACrD,kBAAkB;IAClB,0BAA0B;IAC1B,oCAAoC;IACpC,YAAY;IACZ,kBAAkB;IAClB,kCAAkC;IAClC,iBAAiB;AACrB;;AAEA;IACI,6BAA6B;IAC7B,YAAY;IACZ,eAAe;IACf,gBAAgB;AACpB;;AAEA;IACI,0GAA0G;AAC9G;;AAEA;IACI,0BAA0B;IAC1B,YAAY;IACZ,kBAAkB;IAClB,gBAAgB;AACpB;;AAEA;IACI,oCAAoC;IACpC,kBAAkB;IAClB,gBAAgB;AACpB;;AAEA;IACI,eAAe;AACnB;;AAEA;IACI,gCAAgC;AACpC;;AAEA;IACI,uBAAuB;AAC3B;;AAEA;IACI,gBAAgB;IAChB,cAAc;IACd,WAAW;IACX,kBAAkB;IAClB,6BAA6B;IAC7B,mBAAmB;IACnB,0BAA0B;IAC1B,YAAY;IACZ,kBAAkB;IAClB,mBAAmB;IACnB,eAAe;IACf,kBAAkB;IAClB,gBAAgB;AACpB;;AAEA;IACI,gBAAgB;IAChB,yBAAyB;AAC7B;;AAEA;IACI;QACI;;4CAEoC;QACpC,aAAa;QACb,sBAAsB;QACtB,mBAAmB;IACvB;IACA;;QAEI,kBAAkB;IACtB;AACJ",sourcesContent:['main {\r\n    padding: 5%;\r\n}\r\n\r\nmain li {\r\n    margin-top: 12px;\r\n    display: grid;\r\n    column-gap: 10px;\r\n    grid-template-columns: 2fr 28px 6fr 28px 1fr 1fr 28px;\r\n    text-align: center;\r\n    font-family: var(--roboto);\r\n    background-color: rgb(241, 241, 241);\r\n    padding: 4px;\r\n    border-radius: 6px;\r\n    border-left: 4px solid var(--dark);\r\n    line-height: 30px;\r\n}\r\n\r\nmain li button {\r\n    background-color: transparent;\r\n    border: none;\r\n    cursor: pointer;\r\n    transition: 0.3s;\r\n}\r\n\r\nmain img[alt="Delete Icon"] {\r\n    filter: invert(27%) sepia(50%) saturate(2918%) hue-rotate(344deg) brightness(83%) contrast(90%) !important;\r\n}\r\n\r\nmain input[type="date"] {\r\n    font-family: var(--roboto);\r\n    border: none;\r\n    border-radius: 8px;\r\n    font-size: small;\r\n}\r\n\r\nmain li button:hover {\r\n    background-color: rgb(210, 210, 210);\r\n    border-radius: 50%;\r\n    transition: 0.3s;\r\n}\r\n\r\nmain li input {\r\n    cursor: pointer;\r\n}\r\n\r\nmain li button img {\r\n    filter: brightness(0) !important;\r\n}\r\n\r\nmain span {\r\n    text-overflow: ellipsis;\r\n}\r\n\r\nmain>button {\r\n    margin-top: 12px;\r\n    display: block;\r\n    width: 100%;\r\n    text-align: center;\r\n    background-color: var(--dark);\r\n    color: var(--light);\r\n    font-family: var(--roboto);\r\n    padding: 3px;\r\n    border-radius: 8px;\r\n    border: transparent;\r\n    cursor: pointer;\r\n    font-size: x-large;\r\n    transition: 0.3s;\r\n}\r\n\r\nmain>button:hover {\r\n    transition: 0.3s;\r\n    background-color: #4f5053;\r\n}\r\n\r\n@media only screen and (max-width: 425px) {\r\n    main li {\r\n        /*\r\n        grid-template-columns: 1fr 1fr;\r\n        grid-template-rows: auto auto auto;*/\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n    }\r\n    input[type="checkbox"],\r\n    input[type="date"] {\r\n        max-height: 30.4px;\r\n    }\r\n}'],sourceRoot:""}]);const a=o},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var h=[].concat(e[l]);r&&o[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),t.push(h))}},t}},537:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),s="/*# ".concat(i," */"),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(o).concat([s]).join("\n")}return[t].join("\n")}},379:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},o=[],a=0;a<e.length;a++){var c=e[a],l=r.base?c[0]+r.base:c[0],h=s[l]||0,u="".concat(l," ").concat(h);s[l]=h+1;var d=n(u),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=i(p,r);r.byIndex=a,t.splice(a,0,{identifier:u,updater:f,references:1})}o.push(u)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var s=r(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<s.length;o++){var a=n(s[o]);t[a].references--}for(var c=r(e,i),l=0;l<s.length;l++){var h=n(s[l]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}s=c}}},569:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={id:r,exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0,(()=>{var e=n(379),t=n.n(e),r=n(795),i=n.n(r),s=n(569),o=n.n(s),a=n(565),c=n.n(a),l=n(216),h=n.n(l),u=n(589),d=n.n(u),p=n(63),f={};f.styleTagTransform=d(),f.setAttributes=c(),f.insert=o().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=h(),t()(p.Z,f),p.Z&&p.Z.locals&&p.Z.locals;var g=n(497),m={};m.styleTagTransform=d(),m.setAttributes=c(),m.insert=o().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=h(),t()(g.Z,m),g.Z&&g.Z.locals&&g.Z.locals;var v=n(926),y={};y.styleTagTransform=d(),y.setAttributes=c(),y.insert=o().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=h(),t()(v.Z,y),v.Z&&v.Z.locals&&v.Z.locals;var b=n(666),A={};A.styleTagTransform=d(),A.setAttributes=c(),A.insert=o().bind(null,"head"),A.domAPI=i(),A.insertStyleElement=h(),t()(b.Z,A),b.Z&&b.Z.locals&&b.Z.locals;const w=n.p+"113d59e2703636dfe157.svg",I=n.p+"6e93938839cb814ff0a3.svg",_=n.p+"2662cd22342b7aec3759.svg",k=n.p+"b7fbf4b82de02c03c144.svg";var T=n(320),E={};E.styleTagTransform=d(),E.setAttributes=c(),E.insert=o().bind(null,"head"),E.domAPI=i(),E.insertStyleElement=h(),t()(T.Z,E),T.Z&&T.Z.locals&&T.Z.locals;const C=n.p+"0f8eae15be24f4e845ee.svg",S=n.p+"3270f2c93c8c138fa6cc.svg",R=n.p+"5b4bbee2e91b8855115c.svg",O=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},P={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=i>>2,h=(3&i)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(u=64)),r.push(n[l],n[h],n[u],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(O(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},N=function(e){return function(e){const t=O(e);return P.encodeByteArray(t,!0)}(e).replace(/\./g,"")},D=function(e){try{return P.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},B=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&D(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},x=e=>{var t;return null===(t=B())||void 0===t?void 0:t[`_${e}`]};class L{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function M(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function U(){try{return"object"==typeof indexedDB}catch(e){return!1}}function j(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class F extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,F.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$.prototype.create)}}class ${constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(H,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new F(r,o,n)}}const H=/\{\$([^}]+)}/g;function V(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(z(n)&&z(s)){if(!V(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function z(e){return null!==e&&"object"==typeof e}function q(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function K(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function W(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class G{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=J),void 0===r.error&&(r.error=J),void 0===r.complete&&(r.complete=J);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function J(){}function Y(e){return e&&e._delegate?e._delegate:e}class X{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Z="[DEFAULT]";class Q{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new L;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Z})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=Z){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=Z){return this.instances.has(e)}getOptions(e=Z){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===Z?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=Z){return this.component?this.component.multipleInstances?e:Z:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ee{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Q(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const te=[];var ne,re;(re=ne||(ne={}))[re.DEBUG=0]="DEBUG",re[re.VERBOSE=1]="VERBOSE",re[re.INFO=2]="INFO",re[re.WARN=3]="WARN",re[re.ERROR=4]="ERROR",re[re.SILENT=5]="SILENT";const ie={debug:ne.DEBUG,verbose:ne.VERBOSE,info:ne.INFO,warn:ne.WARN,error:ne.ERROR,silent:ne.SILENT},se=ne.INFO,oe={[ne.DEBUG]:"log",[ne.VERBOSE]:"log",[ne.INFO]:"info",[ne.WARN]:"warn",[ne.ERROR]:"error"},ae=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=oe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class ce{constructor(e){this.name=e,this._logLevel=se,this._logHandler=ae,this._userLogHandler=null,te.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ne))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ie[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ne.DEBUG,...e),this._logHandler(this,ne.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ne.VERBOSE,...e),this._logHandler(this,ne.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ne.INFO,...e),this._logHandler(this,ne.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ne.WARN,...e),this._logHandler(this,ne.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ne.ERROR,...e),this._logHandler(this,ne.ERROR,...e)}}let le,he;const ue=new WeakMap,de=new WeakMap,pe=new WeakMap,fe=new WeakMap,ge=new WeakMap;let me={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return de.get(e);if("objectStoreNames"===t)return e.objectStoreNames||pe.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ye(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ve(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(he||(he=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(be(this),e),ye(ue.get(this))}:function(...e){return ye(t.apply(be(this),e))}:function(e,...n){const r=t.call(be(this),e,...n);return pe.set(r,e.sort?e.sort():[e]),ye(r)}:(e instanceof IDBTransaction&&function(e){if(de.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));de.set(e,t)}(e),n=e,(le||(le=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,me):e);var t,n}function ye(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ye(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&ue.set(t,e)})).catch((()=>{})),ge.set(t,e),t}(e);if(fe.has(e))return fe.get(e);const t=ve(e);return t!==e&&(fe.set(e,t),ge.set(t,e)),t}const be=e=>ge.get(e);function Ae(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=ye(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(ye(o.result),e.oldVersion,e.newVersion,ye(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}function we(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(()=>t())),ye(n).then((()=>{}))}const Ie=["get","getKey","getAll","getAllKeys","count"],_e=["put","add","delete","clear"],ke=new Map;function Te(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ke.get(t))return ke.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=_e.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Ie.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return ke.set(t,s),s}var Ee;Ee=me,me={...Ee,get:(e,t,n)=>Te(e,t)||Ee.get(e,t,n),has:(e,t)=>!!Te(e,t)||Ee.has(e,t)};class Ce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Se="@firebase/app",Re="0.9.1",Oe=new ce("@firebase/app"),Pe="[DEFAULT]",Ne={[Se]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},De=new Map,Be=new Map;function xe(e,t){try{e.container.addComponent(t)}catch(n){Oe.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Le(e){const t=e.name;if(Be.has(t))return Oe.debug(`There were multiple attempts to register component ${t}.`),!1;Be.set(t,e);for(const t of De.values())xe(t,e);return!0}function Me(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Ue=new $("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class je{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new X("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ue.create("app-deleted",{appName:this._name})}}const Fe="9.16.0";function $e(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:Pe,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw Ue.create("bad-app-name",{appName:String(i)});if(n||(n=(()=>{var e;return null===(e=B())||void 0===e?void 0:e.config})()),!n)throw Ue.create("no-options");const s=De.get(i);if(s){if(V(n,s.options)&&V(r,s.config))return s;throw Ue.create("duplicate-app",{appName:i})}const o=new ee(i);for(const e of Be.values())o.addComponent(e);const a=new je(n,r,o);return De.set(i,a),a}function He(e,t,n){var r;let i=null!==(r=Ne[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Oe.warn(e.join(" "))}Le(new X(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Ve="firebase-heartbeat-store";let ze=null;function qe(){return ze||(ze=Ae("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ve)}}).catch((e=>{throw Ue.create("idb-open",{originalErrorMessage:e.message})}))),ze}async function Ke(e,t){try{const n=(await qe()).transaction(Ve,"readwrite"),r=n.objectStore(Ve);return await r.put(t,We(e)),n.done}catch(e){if(e instanceof F)Oe.warn(e.message);else{const t=Ue.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Oe.warn(t.message)}}}function We(e){return`${e.name}!${e.options.appId}`}class Ge{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ye(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Je();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Je(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Xe(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Xe(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=N(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Je(){return(new Date).toISOString().substring(0,10)}class Ye{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!U()&&j().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await qe()).transaction(Ve).objectStore(Ve).get(We(e))}catch(e){if(e instanceof F)Oe.warn(e.message);else{const t=Ue.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Oe.warn(t.message)}}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Xe(e){return N(JSON.stringify({version:2,heartbeats:e})).length}function Ze(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Le(new X("platform-logger",(e=>new Ce(e)),"PRIVATE")),Le(new X("heartbeat",(e=>new Ge(e)),"PRIVATE")),He(Se,Re,""),He(Se,Re,"esm2017"),He("fire-js",""),He("firebase","9.16.0","app"),Object.create,Object.create;const Qe=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},et=new $("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),tt=new ce("@firebase/auth");function nt(e,...t){tt.logLevel<=ne.ERROR&&tt.error(`Auth (${Fe}): ${e}`,...t)}function rt(e,...t){throw ot(e,...t)}function it(e,...t){return ot(e,...t)}function st(e,t,n){const r=Object.assign(Object.assign({},Qe()),{[t]:n});return new $("auth","Firebase",r).create(t,{appName:e.name})}function ot(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return et.create(e,...t)}function at(e,t,...n){if(!e)throw ot(t,...n)}function ct(e){const t="INTERNAL ASSERTION FAILED: "+e;throw nt(t),new Error(t)}function lt(e,t){e||ct(t)}const ht=new Map;function ut(e){lt(e instanceof Function,"Expected a class definition");let t=ht.get(e);return t?(lt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ht.set(e,t),t)}function dt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function pt(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function ft(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===pt()||"https:"===pt()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class gt{constructor(e,t){this.shortDelay=e,this.longDelay=t,lt(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(M())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return ft()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function mt(e,t){lt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class vt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void ct("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void ct("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void ct("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const yt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},bt=new gt(3e4,6e4);function At(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function wt(e,t,n,r,i={}){return It(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=q(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),vt.fetch()(kt(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function It(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},yt),t);try{const t=new Tt(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw Et(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Et(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Et(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw Et(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw st(e,a,o);rt(e,a)}}catch(t){if(t instanceof F)throw t;rt(e,"network-request-failed")}}async function _t(e,t,n,r,i={}){const s=await wt(e,t,n,r,i);return"mfaPendingCredential"in s&&rt(e,"multi-factor-auth-required",{_serverResponse:s}),s}function kt(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?mt(e.config,i):`${e.config.apiScheme}://${i}`}class Tt{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(it(this.auth,"network-request-failed"))),bt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Et(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=it(e,t,r);return i.customData._tokenResponse=n,i}function Ct(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function St(e){return 1e3*Number(e)}function Rt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return nt("JWT malformed, contained fewer than 3 sections"),null;try{const e=D(n);return e?JSON.parse(e):(nt("Failed to decode base64 JWT payload"),null)}catch(e){return nt("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function Ot(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof F&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Pt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Nt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ct(this.lastLoginAt),this.creationTime=Ct(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Dt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Ot(e,async function(e,t){return wt(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));at(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Ze(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Nt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,p)}class Bt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){at(e.idToken,"internal-error"),at(void 0!==e.idToken,"internal-error"),at(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Rt(e);return at(t,"internal-error"),at(void 0!==t.exp,"internal-error"),at(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return at(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await It(e,{},(async()=>{const n=q({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=kt(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",vt.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Bt;return n&&(at("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(at("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(at("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Bt,this.toJSON())}_performRefresh(){return ct("not implemented")}}function xt(e,t){at("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Lt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Ze(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Pt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Nt(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Ot(this,this.stsTokenManager.getToken(this.auth,e));return at(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Y(e),r=await n.getIdToken(t),i=Rt(r);at(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Ct(St(i.auth_time)),issuedAtTime:Ct(St(i.iat)),expirationTime:Ct(St(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Y(e);await Dt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(at(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Lt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){at(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Dt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Ot(this,async function(e,t){return wt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:b,isAnonymous:A,providerData:w,stsTokenManager:I}=t;at(y&&I,e,"internal-error");const _=Bt.fromJSON(this.name,I);at("string"==typeof y,e,"internal-error"),xt(h,e.name),xt(u,e.name),at("boolean"==typeof b,e,"internal-error"),at("boolean"==typeof A,e,"internal-error"),xt(d,e.name),xt(p,e.name),xt(f,e.name),xt(g,e.name),xt(m,e.name),xt(v,e.name);const k=new Lt({uid:y,auth:e,email:u,emailVerified:b,displayName:h,isAnonymous:A,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:_,createdAt:m,lastLoginAt:v});return w&&Array.isArray(w)&&(k.providerData=w.map((e=>Object.assign({},e)))),g&&(k._redirectEventId=g),k}static async _fromIdTokenResponse(e,t,n=!1){const r=new Bt;r.updateFromServerResponse(t);const i=new Lt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Dt(i),i}}class Mt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Mt.type="NONE";const Ut=Mt;function jt(e,t,n){return`firebase:${e}:${t}:${n}`}class Ft{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=jt(this.userKey,r.apiKey,i),this.fullPersistenceKey=jt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Lt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Ft(ut(Ut),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||ut(Ut);const s=jt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Lt._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Ft(i,e,n)):new Ft(i,e,n)}}function $t(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(qt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ht(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Wt(t))return"Blackberry";if(Gt(t))return"Webos";if(Vt(t))return"Safari";if((t.includes("chrome/")||zt(t))&&!t.includes("edge/"))return"Chrome";if(Kt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Ht(e=M()){return/firefox\//i.test(e)}function Vt(e=M()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function zt(e=M()){return/crios\//i.test(e)}function qt(e=M()){return/iemobile/i.test(e)}function Kt(e=M()){return/android/i.test(e)}function Wt(e=M()){return/blackberry/i.test(e)}function Gt(e=M()){return/webos/i.test(e)}function Jt(e=M()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Yt(e=M()){return Jt(e)||Kt(e)||Gt(e)||Wt(e)||/windows phone/i.test(e)||qt(e)}function Xt(e,t=[]){let n;switch(e){case"Browser":n=$t(M());break;case"Worker":n=`${$t(M())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Fe}/${r}`}class Zt{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Qt{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tn(this),this.idTokenSubscription=new tn(this),this.beforeStateQueue=new Zt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=et,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ut(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Ft.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return at(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Dt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Y(e):null;return t&&at(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&at(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(ut(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new $("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ut(e)||this._popupRedirectResolver;at(t,this,"argument-error"),this.redirectPersistenceManager=await Ft.create(this,[ut(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return at(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return at(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Xt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function en(e){return Y(e)}class tn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new G(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return at(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function nn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function rn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class sn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ct("not implemented")}_getIdTokenResponse(e){return ct("not implemented")}_linkToIdToken(e,t){return ct("not implemented")}_getReauthenticationResolver(e){return ct("not implemented")}}class on extends sn{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new on(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new on(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return _t(e,"POST","/v1/accounts:signInWithPassword",At(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return _t(e,"POST","/v1/accounts:signInWithEmailLink",At(e,t))}(e,{email:this._email,oobCode:this._password});default:rt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return wt(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return _t(e,"POST","/v1/accounts:signInWithEmailLink",At(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:rt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function an(e,t){return _t(e,"POST","/v1/accounts:signInWithIdp",At(e,t))}class cn extends sn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new cn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):rt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Ze(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new cn(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return an(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,an(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,an(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=q(t)}return e}}const ln={USER_NOT_FOUND:"user-not-found"};class hn extends sn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new hn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new hn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return _t(e,"POST","/v1/accounts:signInWithPhoneNumber",At(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await _t(e,"POST","/v1/accounts:signInWithPhoneNumber",At(e,t));if(n.temporaryProof)throw Et(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return _t(e,"POST","/v1/accounts:signInWithPhoneNumber",At(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ln)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new hn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class un{constructor(e){var t,n,r,i,s,o;const a=K(W(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);at(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=K(W(e)).link,n=t?K(W(t)).deep_link_id:null,r=K(W(e)).deep_link_id;return(r?K(W(r)).link:null)||r||n||t||e}(e);try{return new un(t)}catch(e){return null}}}class dn{constructor(){this.providerId=dn.PROVIDER_ID}static credential(e,t){return on._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=un.parseLink(t);return at(n,"argument-error"),on._fromEmailAndCode(e,n.code,n.tenantId)}}dn.PROVIDER_ID="password",dn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",dn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class pn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class fn extends pn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class gn extends fn{constructor(){super("facebook.com")}static credential(e){return cn._fromParams({providerId:gn.PROVIDER_ID,signInMethod:gn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gn.credentialFromTaggedObject(e)}static credentialFromError(e){return gn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return gn.credential(e.oauthAccessToken)}catch(e){return null}}}gn.FACEBOOK_SIGN_IN_METHOD="facebook.com",gn.PROVIDER_ID="facebook.com";class mn extends fn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return cn._fromParams({providerId:mn.PROVIDER_ID,signInMethod:mn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return mn.credentialFromTaggedObject(e)}static credentialFromError(e){return mn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return mn.credential(t,n)}catch(e){return null}}}mn.GOOGLE_SIGN_IN_METHOD="google.com",mn.PROVIDER_ID="google.com";class vn extends fn{constructor(){super("github.com")}static credential(e){return cn._fromParams({providerId:vn.PROVIDER_ID,signInMethod:vn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vn.credentialFromTaggedObject(e)}static credentialFromError(e){return vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return vn.credential(e.oauthAccessToken)}catch(e){return null}}}vn.GITHUB_SIGN_IN_METHOD="github.com",vn.PROVIDER_ID="github.com";class yn extends fn{constructor(){super("twitter.com")}static credential(e,t){return cn._fromParams({providerId:yn.PROVIDER_ID,signInMethod:yn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return yn.credentialFromTaggedObject(e)}static credentialFromError(e){return yn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return yn.credential(t,n)}catch(e){return null}}}yn.TWITTER_SIGN_IN_METHOD="twitter.com",yn.PROVIDER_ID="twitter.com";class bn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Lt._fromIdTokenResponse(e,n,r),s=An(n);return new bn({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=An(n);return new bn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function An(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class wn extends F{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,wn.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new wn(e,t,n,r)}}function In(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw wn._fromErrorAndOperation(e,n,t,r);throw n}))}new WeakMap;const _n="__sak";class kn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(_n,"1"),this.storage.removeItem(_n),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Tn extends kn{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=M();return Vt(e)||Jt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Yt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=M();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Tn.type="LOCAL";const En=Tn;class Cn extends kn{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Cn.type="SESSION";const Sn=Cn;class Rn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Rn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function On(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Rn.receivers=[];class Pn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=On("",20);r.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(l),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Nn(){return window}function Dn(){return void 0!==Nn().WorkerGlobalScope&&"function"==typeof Nn().importScripts}const Bn="firebaseLocalStorageDb",xn="firebaseLocalStorage",Ln="fbase_key";class Mn{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Un(e,t){return e.transaction([xn],t?"readwrite":"readonly").objectStore(xn)}function jn(){const e=indexedDB.open(Bn,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(xn,{keyPath:Ln})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(xn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Bn);return new Mn(e).toPromise()}(),t(await jn()))}))}))}async function Fn(e,t,n){const r=Un(e,!0).put({[Ln]:t,value:n});return new Mn(r).toPromise()}function $n(e,t){const n=Un(e,!0).delete(t);return new Mn(n).toPromise()}class Hn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await jn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Dn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Rn._getInstance(Dn()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Pn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await jn();return await Fn(e,_n,"1"),await $n(e,_n),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Fn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Un(e,!1).get(t),r=await new Mn(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>$n(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Un(e,!1).getAll();return new Mn(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Hn.type="LOCAL";const Vn=Hn;function zn(e){return`__${e}${Math.floor(1e6*Math.random())}`}zn("rcb"),new gt(3e4,6e4);class qn{constructor(e){this.providerId=qn.PROVIDER_ID,this.auth=en(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(at("string"==typeof i,e,"argument-error"),at("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){at("enroll"===t.type,e,"internal-error");const n=await function(e,t){return wt(e,"POST","/v2/accounts/mfaEnrollment:start",At(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{at("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;at(n,e,"missing-multi-factor-info");const o=await function(e,t){return wt(e,"POST","/v2/accounts/mfaSignIn:start",At(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return wt(e,"POST","/v1/accounts:sendVerificationCode",At(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,Y(t))}static credential(e,t){return hn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return qn.credentialFromTaggedObject(t)}static credentialFromError(e){return qn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?hn._fromTokenResponse(t,n):null}}function Kn(e,t){return t?ut(t):(at(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}qn.PROVIDER_ID="phone",qn.PHONE_SIGN_IN_METHOD="phone";class Wn extends sn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return an(e,this._buildIdpRequest())}_linkToIdToken(e,t){return an(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return an(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Gn(e){return async function(e,t,n=!1){const r="signIn",i=await In(e,r,t),s=await bn._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}(e.auth,new Wn(e),e.bypassAuthState)}function Jn(e){const{auth:t,user:n}=e;return at(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await Ot(e,In(r,i,t,e),n);at(s.idToken,r,"internal-error");const o=Rt(s.idToken);at(o,r,"internal-error");const{sub:a}=o;return at(e.uid===a,r,"user-mismatch"),bn._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&rt(r,"user-mismatch"),e}}(n,new Wn(e),e.bypassAuthState)}async function Yn(e){const{auth:t,user:n}=e;return at(n,t,"internal-error"),async function(e,t,n=!1){const r=await Ot(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return bn._forOperation(e,"link",r)}(n,new Wn(e),e.bypassAuthState)}class Xn{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Gn;case"linkViaPopup":case"linkViaRedirect":return Yn;case"reauthViaPopup":case"reauthViaRedirect":return Jn;default:rt(this.auth,"internal-error")}}resolve(e){lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Zn=new gt(2e3,1e4);class Qn extends Xn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Qn.currentPopupAction&&Qn.currentPopupAction.cancel(),Qn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return at(e,this.auth,"internal-error"),e}async onExecution(){lt(1===this.filter.length,"Popup operations only handle one event");const e=On();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(it(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(it(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(it(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Zn.get())};e()}}Qn.currentPopupAction=null;const er=new Map;class tr extends Xn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=er.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return jt("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return ut(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}er.set(this.auth._key(),e)}return this.bypassAuthState||er.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function nr(e,t){er.set(e._key(),t)}async function rr(e,t,n=!1){const r=en(e),i=Kn(r,t),s=new tr(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class ir{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return or(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!or(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(it(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(sr(e))}saveEventToCache(e){this.cachedEventUids.add(sr(e)),this.lastProcessedEventTime=Date.now()}}function sr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function or({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const ar=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cr=/^https?/;function lr(e){const t=dt(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!cr.test(n))return!1;if(ar.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const hr=new gt(3e4,6e4);function ur(){const e=Nn().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let dr=null;function pr(e){return dr=dr||function(e){return new Promise(((t,n)=>{var r,i,s,o;function a(){ur(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ur(),n(it(e,"network-request-failed"))},timeout:hr.get()})}if(null===(i=null===(r=Nn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Nn().gapi)||void 0===s?void 0:s.load)){const t=zn("iframefcb");return Nn()[t]=()=>{gapi.load?a():n(it(e,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${t}`,new Promise(((e,t)=>{const n=document.createElement("script");n.setAttribute("src",o),n.onload=e,n.onerror=e=>{const n=it("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(n)}))).catch((e=>n(e)))}a()}})).catch((e=>{throw dr=null,e}))}(e),dr}const fr=new gt(5e3,15e3),gr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},mr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vr(e){const t=e.config;at(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?mt(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Fe},i=mr.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${q(r).slice(1)}`}const yr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class br{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ar(e,t,n,r,i,s){at(e.config.authDomain,e,"auth-domain-config-required"),at(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Fe,eventId:i};if(t instanceof pn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof fn){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?mt(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${q(a).slice(1)}`}const wr="webStorageSupport",Ir=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Sn,this._completeRedirectFn=rr,this._overrideRedirectResult=nr}async _openPopup(e,t,n,r){var i;return lt(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},yr),{width:r.toString(),height:i.toString(),top:s,left:o}),l=M().toLowerCase();n&&(a=zt(l)?"_blank":n),Ht(l)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=M()){var t;return Jt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new br(null);const u=window.open(t||"",a,h);at(u,e,"popup-blocked");try{u.focus()}catch(e){}return new br(u)}(e,Ar(e,t,n,dt(),r),On())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=Ar(e,t,n,dt(),r),Nn().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(lt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await pr(e),n=Nn().gapi;return at(n,e,"internal-error"),t.open({where:document.body,url:vr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gr,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=it(e,"network-request-failed"),s=Nn().setTimeout((()=>{r(i)}),fr.get());function o(){Nn().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new ir(e);return t.register("authEvent",(t=>(at(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(wr,{type:wr},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[wr];void 0!==i&&t(!!i),rt(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return wt(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(lr(e))return}catch(e){}rt(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Yt()||Vt()||Jt()}};var _r="@firebase/auth",kr="0.21.1";class Tr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){at(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Er=x("authIdTokenMaxAge")||300;let Cr=null;function Sr(e=function(e=Pe){const t=De.get(e);if(!t&&e===Pe)return $e();if(!t)throw Ue.create("no-app",{appName:e});return t}()){const t=Me(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Me(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(V(n.getOptions(),null!=t?t:{}))return e;rt(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Ir,persistence:[Vn,En,Sn]}),r=x("authTokenSyncURL");if(r){const e=(i=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Er)return;const r=null==t?void 0:t.token;Cr!==r&&(Cr=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){Y(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,r,i){Y(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var i;const s=(e=>{var t,n;return null===(n=null===(t=B())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})("auth");return s&&function(e,t,n){const r=en(e);at(r._canInitEmulator,r,"emulator-config-failed"),at(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=nn(t),{host:o,port:a}=function(e){const t=nn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:rn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:rn(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}var Rr;Rr="Browser",Le(new X("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{at(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),at(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:Rr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Xt(Rr)},o=new Qt(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ut);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Le(new X("auth-internal",(e=>(e=>new Tr(e))(en(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),He(_r,kr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Rr)),He(_r,kr,"esm2017");var Or,Pr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},Nr={},Dr=Dr||{},Br=Pr||self;function xr(){}function Lr(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Mr(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Ur="closure_uid_"+(1e9*Math.random()>>>0),jr=0;function Fr(e,t,n){return e.call.apply(e.bind,arguments)}function $r(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Hr(e,t,n){return(Hr=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Fr:$r).apply(null,arguments)}function Vr(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function zr(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function qr(){this.s=this.s,this.o=this.o}qr.prototype.s=!1,qr.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Ur)&&e[Ur]||(e[Ur]=++jr))},qr.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Kr=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Wr(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Gr(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Lr(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function Jr(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Jr.prototype.h=function(){this.defaultPrevented=!0};var Yr=function(){if(!Br.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Br.addEventListener("test",xr,t),Br.removeEventListener("test",xr,t)}catch(e){}return e}();function Xr(e){return/^[\s\xa0]*$/.test(e)}var Zr=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Qr(e,t){return e<t?-1:e>t?1:0}function ei(){var e=Br.navigator;return e&&(e=e.userAgent)?e:""}function ti(e){return-1!=ei().indexOf(e)}function ni(e){return ni[" "](e),e}ni[" "]=xr;var ri,ii,si=ti("Opera"),oi=ti("Trident")||ti("MSIE"),ai=ti("Edge"),ci=ai||oi,li=ti("Gecko")&&!(-1!=ei().toLowerCase().indexOf("webkit")&&!ti("Edge"))&&!(ti("Trident")||ti("MSIE"))&&!ti("Edge"),hi=-1!=ei().toLowerCase().indexOf("webkit")&&!ti("Edge");function ui(){var e=Br.document;return e?e.documentMode:void 0}e:{var di="",pi=(ii=ei(),li?/rv:([^\);]+)(\)|;)/.exec(ii):ai?/Edge\/([\d\.]+)/.exec(ii):oi?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ii):hi?/WebKit\/(\S+)/.exec(ii):si?/(?:Version)[ \/]?(\S+)/.exec(ii):void 0);if(pi&&(di=pi?pi[1]:""),oi){var fi=ui();if(null!=fi&&fi>parseFloat(di)){ri=String(fi);break e}}ri=di}var gi,mi={};function vi(){return function(e){var t=mi;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let e=0;const t=Zr(String(ri)).split("."),n=Zr("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Qr(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Qr(0==i[2].length,0==s[2].length)||Qr(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}()}()}Br.document&&oi?gi=ui()||parseInt(ri,10)||void 0:gi=void 0;var yi=gi;function bi(e,t){if(Jr.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(li){e:{try{ni(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Ai[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&bi.X.h.call(this)}}zr(bi,Jr);var Ai={2:"touch",3:"pen",4:"mouse"};bi.prototype.h=function(){bi.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var wi="closure_listenable_"+(1e6*Math.random()|0),Ii=0;function _i(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Ii,this.ba=this.ea=!1}function ki(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Ti(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Ei(e){const t={};for(const n in e)t[n]=e[n];return t}const Ci="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Si(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Ci.length;t++)n=Ci[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Ri(e){this.src=e,this.g={},this.h=0}function Oi(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Kr(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ki(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Pi(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}Ri.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Pi(e,t,r,i);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new _i(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var Ni="closure_lm_"+(1e6*Math.random()|0),Di={};function Bi(e,t,n,r,i){if(r&&r.once)return Li(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Bi(e,t[s],n,r,i);return null}return n=Vi(n),e&&e[wi]?e.N(t,n,Mr(r)?!!r.capture:!!r,i):xi(e,t,n,!1,r,i)}function xi(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Mr(i)?!!i.capture:!!i,a=$i(e);if(a||(e[Ni]=a=new Ri(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Fi;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Yr||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ji(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Li(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Li(e,t[s],n,r,i);return null}return n=Vi(n),e&&e[wi]?e.O(t,n,Mr(r)?!!r.capture:!!r,i):xi(e,t,n,!0,r,i)}function Mi(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)Mi(e,t[s],n,r,i);else r=Mr(r)?!!r.capture:!!r,n=Vi(n),e&&e[wi]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Pi(s=e.g[t],n,r,i))&&(ki(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=$i(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Pi(t,n,r,i)),(n=-1<e?t[e]:null)&&Ui(n))}function Ui(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[wi])Oi(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ji(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=$i(t))?(Oi(n,e),0==n.h&&(n.src=null,t[Ni]=null)):ki(e)}}}function ji(e){return e in Di?Di[e]:Di[e]="on"+e}function Fi(e,t){if(e.ba)e=!0;else{t=new bi(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&Ui(e),e=n.call(r,t)}return e}function $i(e){return(e=e[Ni])instanceof Ri?e:null}var Hi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vi(e){return"function"==typeof e?e:(e[Hi]||(e[Hi]=function(t){return e.handleEvent(t)}),e[Hi])}function zi(){qr.call(this),this.i=new Ri(this),this.P=this,this.I=null}function qi(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Jr(t,e);else if(t instanceof Jr)t.target=t.target||e;else{var i=t;Si(t=new Jr(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ki(o,r,!0,t)&&i}if(i=Ki(o=t.g=e,r,!0,t)&&i,i=Ki(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ki(o=t.g=n[s],r,!1,t)&&i}function Ki(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ba&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.ea&&Oi(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}zr(zi,qr),zi.prototype[wi]=!0,zi.prototype.removeEventListener=function(e,t,n,r){Mi(this,e,t,n,r)},zi.prototype.M=function(){if(zi.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ki(n[r]);delete t.g[e],t.h--}}this.I=null},zi.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},zi.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Wi=Br.JSON.stringify;function Gi(){var e=ts;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Ji,Yi=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Xi),(e=>e.reset()));class Xi{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Zi(e){Br.setTimeout((()=>{throw e}),0)}function Qi(e,t){Ji||function(){var e=Br.Promise.resolve(void 0);Ji=function(){e.then(ns)}}(),es||(Ji(),es=!0),ts.add(e,t)}var es=!1,ts=new class{constructor(){this.h=this.g=null}add(e,t){const n=Yi.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function ns(){for(var e;e=Gi();){try{e.h.call(e.g)}catch(e){Zi(e)}var t=Yi;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}es=!1}function rs(e,t){zi.call(this),this.h=e||1,this.g=t||Br,this.j=Hr(this.lb,this),this.l=Date.now()}function is(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function ss(e,t,n){if("function"==typeof e)n&&(e=Hr(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Hr(e.handleEvent,e)}return 2147483647<Number(t)?-1:Br.setTimeout(e,t||0)}function os(e){e.g=ss((()=>{e.g=null,e.i&&(e.i=!1,os(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}zr(rs,zi),(Or=rs.prototype).ca=!1,Or.R=null,Or.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),qi(this,"tick"),this.ca&&(is(this),this.start()))}},Or.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Or.M=function(){rs.X.M.call(this),is(this),delete this.g};class as extends qr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:os(this)}M(){super.M(),this.g&&(Br.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cs(e){qr.call(this),this.h=e,this.g={}}zr(cs,qr);var ls=[];function hs(e,t,n,r){Array.isArray(n)||(n&&(ls[0]=n.toString()),n=ls);for(var i=0;i<n.length;i++){var s=Bi(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function us(e){Ti(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ui(e)}),e),e.g={}}function ds(){this.g=!0}function ps(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Wi(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}cs.prototype.M=function(){cs.X.M.call(this),us(this)},cs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ds.prototype.Aa=function(){this.g=!1},ds.prototype.info=function(){};var fs={},gs=null;function ms(){return gs=gs||new zi}function vs(e){Jr.call(this,fs.Pa,e)}function ys(e){const t=ms();qi(t,new vs(t))}function bs(e,t){Jr.call(this,fs.STAT_EVENT,e),this.stat=t}function As(e){const t=ms();qi(t,new bs(t,e))}function ws(e,t){Jr.call(this,fs.Qa,e),this.size=t}function Is(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Br.setTimeout((function(){e()}),t)}fs.Pa="serverreachability",zr(vs,Jr),fs.STAT_EVENT="statevent",zr(bs,Jr),fs.Qa="timingevent",zr(ws,Jr);var _s={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ks={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Ts(){}function Es(e){return e.h||(e.h=e.i())}function Cs(){}Ts.prototype.h=null;var Ss,Rs={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Os(){Jr.call(this,"d")}function Ps(){Jr.call(this,"c")}function Ns(){}function Ds(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new cs(this),this.O=xs,e=ci?125:void 0,this.T=new rs(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Bs}function Bs(){this.i=null,this.g="",this.h=!1}zr(Os,Jr),zr(Ps,Jr),zr(Ns,Ts),Ns.prototype.g=function(){return new XMLHttpRequest},Ns.prototype.i=function(){return{}},Ss=new Ns;var xs=45e3,Ls={},Ms={};function Us(e,t,n){e.K=1,e.v=ro(Zs(t)),e.s=n,e.P=!0,js(e,null)}function js(e,t){e.F=Date.now(),Vs(e),e.A=Zs(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),vo(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Bs,e.g=ma(e.l,n?t:null,!e.s),0<e.N&&(e.L=new as(Hr(e.La,e,e.g),e.N)),hs(e.S,e.g,"readystatechange",e.ib),t=e.H?Ei(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),ys(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var h=l[0];l=l[1];var u=h.split("_");o=2<=u.length&&"type"==u[1]?o+(h+"=")+l+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Fs(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function $s(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Hs(e,n),r==Ms){4==t&&(e.o=4,As(14),i=!1),ps(e.j,e.m,null,"[Incomplete Response]");break}if(r==Ls){e.o=4,As(15),ps(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}ps(e.j,e.m,r,null),Gs(e,r)}Fs(e)&&r!=Ms&&r!=Ls&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,As(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),ca(t),t.K=!0,As(11))):(ps(e.j,e.m,n,"[Invalid Chunked Response]"),Ws(e),Ks(e))}function Hs(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Ms:(n=Number(t.substring(n,r)),isNaN(n)?Ls:(r+=1)+n>t.length?Ms:(t=t.substr(r,n),e.C=r+n,t))}function Vs(e){e.V=Date.now()+e.O,zs(e,e.O)}function zs(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Is(Hr(e.gb,e),t)}function qs(e){e.B&&(Br.clearTimeout(e.B),e.B=null)}function Ks(e){0==e.l.G||e.I||ua(e.l,e)}function Ws(e){qs(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,is(e.T),us(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Gs(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||_o(n.h,e)))if(!e.J&&_o(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ha(n),ea(n)}aa(n),As(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=Is(Hr(n.cb,n),6e3));if(1>=Io(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else pa(n,11)}else if((e.J||n.g==e)&&ha(n),!Xr(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let l=i[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.I=l[1],n.ka=l[2];const t=l[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=l[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const h=l[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ko(s,s.h),s.h=null))}if(r.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,no(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=e;if((r=n).sa=ga(r,r.H?r.ka:null,r.V),o.J){To(r.h,o);var a=o,c=r.J;c&&a.setTimeout(c),a.B&&(qs(a),Vs(a)),r.g=o}else oa(r);0<n.i.length&&na(n)}else"stop"!=l[0]&&"close"!=l[0]||pa(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?pa(n,7):Qo(n):"noop"!=l[0]&&n.l&&n.l.wa(l),n.A=0)}ys()}catch(e){}}function Js(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Lr(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Lr(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Lr(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(Or=Ds.prototype).setTimeout=function(e){this.O=e},Or.ib=function(e){e=e.target;const t=this.L;t&&3==Wo(e)?t.l():this.La(e)},Or.La=function(e){try{if(e==this.g)e:{const h=Wo(this.g);var t=this.g.Ea();if(this.g.aa(),!(3>h)&&(3!=h||ci||this.g&&(this.h.h||this.g.fa()||Go(this.g)))){this.I||4!=h||7==t||ys(),qs(this);var n=this.g.aa();this.Y=n;t:if(Fs(this)){var r=Go(this.g);e="";var i=r.length,s=4==Wo(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ws(this),Ks(this);var o="";break t}this.h.i=new Br.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.U,h,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Xr(a)){var l=a;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,As(12),Ws(this),Ks(this);break e}ps(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Gs(this,n)}this.P?($s(this,h,o),ci&&this.i&&3==h&&(hs(this.S,this.T,"tick",this.hb),this.T.start())):(ps(this.j,this.m,o,null),Gs(this,o)),4==h&&Ws(this),this.i&&!this.I&&(4==h?ua(this.l,this):(this.i=!1,Vs(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,As(12)):(this.o=0,As(13)),Ws(this),Ks(this)}}}catch(e){}},Or.hb=function(){if(this.g){var e=Wo(this.g),t=this.g.fa();this.C<t.length&&(qs(this),$s(this,e,t),this.i&&4!=e&&Vs(this))}},Or.cancel=function(){this.I=!0,Ws(this)},Or.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(ys(),As(17)),Ws(this),this.o=2,Ks(this)):zs(this,this.V-e)};var Ys=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xs(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Xs){this.h=void 0!==t?t:e.h,Qs(this,e.j),this.s=e.s,this.g=e.g,eo(this,e.m),this.l=e.l,t=e.i;var n=new po;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),to(this,n),this.o=e.o}else e&&(n=String(e).match(Ys))?(this.h=!!t,Qs(this,n[1]||"",!0),this.s=io(n[2]||""),this.g=io(n[3]||"",!0),eo(this,n[4]),this.l=io(n[5]||"",!0),to(this,n[6]||"",!0),this.o=io(n[7]||"")):(this.h=!!t,this.i=new po(null,this.h))}function Zs(e){return new Xs(e)}function Qs(e,t,n){e.j=n?io(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function eo(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function to(e,t,n){t instanceof po?(e.i=t,function(e,t){t&&!e.j&&(fo(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(go(this,t),vo(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=so(t,ho)),e.i=new po(t,e.h))}function no(e,t,n){e.i.set(t,n)}function ro(e){return no(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function io(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function so(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,oo),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function oo(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Xs.prototype.toString=function(){var e=[],t=this.j;t&&e.push(so(t,ao,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(so(t,ao,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(so(n,"/"==n.charAt(0)?lo:co,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",so(n,uo)),e.join("")};var ao=/[#\/\?@]/g,co=/[#\?:]/g,lo=/[#\?]/g,ho=/[#\?@]/g,uo=/#/g;function po(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function fo(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function go(e,t){fo(e),t=yo(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function mo(e,t){return fo(e),t=yo(e,t),e.g.has(t)}function vo(e,t,n){go(e,t),0<n.length&&(e.i=null,e.g.set(yo(e,t),Wr(n)),e.h+=n.length)}function yo(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function bo(e){this.l=e||Ao,e=Br.PerformanceNavigationTiming?0<(e=Br.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Br.g&&Br.g.Ga&&Br.g.Ga()&&Br.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Or=po.prototype).add=function(e,t){fo(this),this.i=null,e=yo(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Or.forEach=function(e,t){fo(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Or.oa=function(){fo(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},Or.W=function(e){fo(this);let t=[];if("string"==typeof e)mo(this,e)&&(t=t.concat(this.g.get(yo(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Or.set=function(e,t){return fo(this),this.i=null,mo(this,e=yo(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Or.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},Or.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var Ao=10;function wo(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Io(e){return e.h?1:e.g?e.g.size:0}function _o(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ko(e,t){e.g?e.g.add(t):e.h=t}function To(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Eo(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return Wr(e.i)}function Co(){}function So(){this.g=new Co}function Ro(e,t,n){const r=n||"";try{Js(e,(function(e,n){let i=e;Mr(e)&&(i=Wi(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Oo(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Po(e){this.l=e.ac||null,this.j=e.jb||!1}function No(e,t){zi.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Do,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}bo.prototype.cancel=function(){if(this.i=Eo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Co.prototype.stringify=function(e){return Br.JSON.stringify(e,void 0)},Co.prototype.parse=function(e){return Br.JSON.parse(e,void 0)},zr(Po,Ts),Po.prototype.g=function(){return new No(this.l,this.j)},Po.prototype.i=function(e){return function(){return e}}({}),zr(No,zi);var Do=0;function Bo(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function xo(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Lo(e)}function Lo(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Or=No.prototype).open=function(e,t){if(this.readyState!=Do)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Lo(this)},Or.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Br).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},Or.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,xo(this)),this.readyState=Do},Or.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Lo(this)),this.g&&(this.readyState=3,Lo(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==Br.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Bo(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},Or.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?xo(this):Lo(this),3==this.readyState&&Bo(this)}},Or.Va=function(e){this.g&&(this.response=this.responseText=e,xo(this))},Or.Ua=function(e){this.g&&(this.response=e,xo(this))},Or.ga=function(){this.g&&xo(this)},Or.setRequestHeader=function(e,t){this.v.append(e,t)},Or.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Or.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(No.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Mo=Br.JSON.parse;function Uo(e){zi.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=jo,this.K=this.L=!1}zr(Uo,zi);var jo="",Fo=/^https?$/i,$o=["POST","PUT"];function Ho(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Vo(e),qo(e)}function Vo(e){e.D||(e.D=!0,qi(e,"complete"),qi(e,"error"))}function zo(e){if(e.h&&void 0!==Dr&&(!e.C[1]||4!=Wo(e)||2!=e.aa()))if(e.v&&4==Wo(e))ss(e.Ha,0,e);else if(qi(e,"readystatechange"),4==Wo(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(Ys)[1]||null;if(!i&&Br.self&&Br.self.location){var s=Br.self.location.protocol;i=s.substr(0,s.length-1)}r=!Fo.test(i?i.toLowerCase():"")}n=r}if(n)qi(e,"complete"),qi(e,"success");else{e.m=6;try{var o=2<Wo(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Vo(e)}}finally{qo(e)}}}function qo(e,t){if(e.g){Ko(e);const n=e.g,r=e.C[0]?xr:null;e.g=null,e.C=null,t||qi(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Ko(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Br.clearTimeout(e.A),e.A=null)}function Wo(e){return e.g?e.g.readyState:0}function Go(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case jo:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Jo(e){let t="";return Ti(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Yo(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Jo(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):no(e,t,n))}function Xo(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Zo(e){this.Ca=0,this.i=[],this.j=new ds,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Xo("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Xo("baseRetryDelayMs",5e3,e),this.bb=Xo("retryDelaySeedMs",1e4,e),this.$a=Xo("forwardChannelMaxRetries",2,e),this.ta=Xo("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new bo(e&&e.concurrentRequestLimit),this.Fa=new So,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Qo(e){if(ta(e),3==e.G){var t=e.U++,n=Zs(e.F);no(n,"SID",e.I),no(n,"RID",t),no(n,"TYPE","terminate"),ia(e,n),(t=new Ds(e,e.j,t,void 0)).K=2,t.v=ro(Zs(n)),n=!1,Br.navigator&&Br.navigator.sendBeacon&&(n=Br.navigator.sendBeacon(t.v.toString(),"")),!n&&Br.Image&&((new Image).src=t.v,n=!0),n||(t.g=ma(t.l,null),t.g.da(t.v)),t.F=Date.now(),Vs(t)}fa(e)}function ea(e){e.g&&(ca(e),e.g.cancel(),e.g=null)}function ta(e){ea(e),e.u&&(Br.clearTimeout(e.u),e.u=null),ha(e),e.h.cancel(),e.m&&("number"==typeof e.m&&Br.clearTimeout(e.m),e.m=null)}function na(e){wo(e.h)||e.m||(e.m=!0,Qi(e.Ja,e),e.C=0)}function ra(e,t){var n;n=t?t.m:e.U++;const r=Zs(e.F);no(r,"SID",e.I),no(r,"RID",n),no(r,"AID",e.T),ia(e,r),e.o&&e.s&&Yo(r,e.o,e.s),n=new Ds(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=sa(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),ko(e.h,n),Us(n,r,t)}function ia(e,t){e.ia&&Ti(e.ia,(function(e,n){no(t,n,e)})),e.l&&Js({},(function(e,n){no(t,n,e)}))}function sa(e,t,n){n=Math.min(e.i.length,n);var r=e.l?Hr(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{Ro(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function oa(e){e.g||e.u||(e.Z=1,Qi(e.Ia,e),e.A=0)}function aa(e){return!(e.g||e.u||3<=e.A||(e.Z++,e.u=Is(Hr(e.Ia,e),da(e,e.A)),e.A++,0))}function ca(e){null!=e.B&&(Br.clearTimeout(e.B),e.B=null)}function la(e){e.g=new Ds(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Zs(e.sa);no(t,"RID","rpc"),no(t,"SID",e.I),no(t,"CI",e.L?"0":"1"),no(t,"AID",e.T),no(t,"TYPE","xmlhttp"),ia(e,t),e.o&&e.s&&Yo(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=ro(Zs(t)),n.s=null,n.P=!0,js(n,e)}function ha(e){null!=e.v&&(Br.clearTimeout(e.v),e.v=null)}function ua(e,t){var n=null;if(e.g==t){ha(e),ca(e),e.g=null;var r=2}else{if(!_o(e.h,t))return;n=t.D,To(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;qi(r=ms(),new ws(r,n)),na(e)}else oa(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(Io(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=Is(Hr(e.Ja,e,t),da(e,e.C)),e.C++,0)))}(e,t)||2==r&&aa(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:pa(e,5);break;case 4:pa(e,10);break;case 3:pa(e,6);break;default:pa(e,2)}}function da(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function pa(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=Hr(e.kb,e);n||(n=new Xs("//www.google.com/images/cleardot.gif"),Br.location&&"http"==Br.location.protocol||Qs(n,"https"),ro(n)),function(e,t){const n=new ds;if(Br.Image){const r=new Image;r.onload=Vr(Oo,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Vr(Oo,n,r,"TestLoadImage: error",!1,t),r.onabort=Vr(Oo,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Vr(Oo,n,r,"TestLoadImage: timeout",!1,t),Br.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else As(2);e.G=0,e.l&&e.l.va(t),fa(e),ta(e)}function fa(e){if(e.G=0,e.la=[],e.l){const t=Eo(e.h);0==t.length&&0==e.i.length||(Gr(e.la,t),Gr(e.la,e.i),e.h.i.length=0,Wr(e.i),e.i.length=0),e.l.ua()}}function ga(e,t,n){var r=n instanceof Xs?Zs(n):new Xs(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),eo(r,r.m);else{var i=Br.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new Xs(null,void 0);r&&Qs(s,r),t&&(s.g=t),i&&eo(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&no(r,n,t),no(r,"VER",e.ma),ia(e,r),r}function ma(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Uo(new Po({jb:!0})):new Uo(e.ra)).Ka(e.H),t}function va(){}function ya(){if(oi&&!(10<=Number(yi)))throw Error("Environmental error: no available transport.")}function ba(e,t){zi.call(this),this.g=new Zo(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!Xr(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Xr(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Ia(this)}function Aa(e){Os.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function wa(){Ps.call(this),this.status=1}function Ia(e){this.g=e}(Or=Uo.prototype).Ka=function(e){this.L=e},Or.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ss.g(),this.C=this.u?Es(this.u):Es(Ss),this.g.onreadystatechange=Hr(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Ho(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Br.FormData&&e instanceof Br.FormData,!(0<=Kr($o,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ko(this),0<this.B&&((this.K=function(e){return oi&&vi()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Hr(this.qa,this)):this.A=ss(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Ho(this,e)}},Or.qa=function(){void 0!==Dr&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,qi(this,"timeout"),this.abort(8))},Or.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,qi(this,"complete"),qi(this,"abort"),qo(this))},Or.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),qo(this,!0)),Uo.X.M.call(this)},Or.Ha=function(){this.s||(this.F||this.v||this.l?zo(this):this.fb())},Or.fb=function(){zo(this)},Or.aa=function(){try{return 2<Wo(this)?this.g.status:-1}catch(e){return-1}},Or.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Or.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Mo(t)}},Or.Ea=function(){return this.m},Or.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Or=Zo.prototype).ma=8,Or.G=1,Or.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ds(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=Ei(s),Si(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=sa(this,i,t),no(n=Zs(this.F),"RID",e),no(n,"CVER",22),this.D&&no(n,"X-HTTP-Session-Id",this.D),ia(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(Jo(s)))+"&"+t:this.o&&Yo(n,this.o,s)),ko(this.h,i),this.Ya&&no(n,"TYPE","init"),this.O?(no(n,"$req",t),no(n,"SID","null"),i.Z=!0,Us(i,n,null)):Us(i,n,t),this.G=2}}else 3==this.G&&(e?ra(this,e):0==this.i.length||wo(this.h)||ra(this))},Or.Ia=function(){if(this.u=null,la(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=Is(Hr(this.eb,this),e)}},Or.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,As(10),ea(this),la(this))},Or.cb=function(){null!=this.v&&(this.v=null,ea(this),aa(this),As(19))},Or.kb=function(e){e?(this.j.info("Successfully pinged google.com"),As(2)):(this.j.info("Failed to ping google.com"),As(1))},(Or=va.prototype).xa=function(){},Or.wa=function(){},Or.va=function(){},Or.ua=function(){},Or.Ra=function(){},ya.prototype.g=function(e,t){return new ba(e,t)},zr(ba,zi),ba.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;As(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=ga(e,null,e.V),na(e)},ba.prototype.close=function(){Qo(this.g)},ba.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Wi(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&na(t)},ba.prototype.M=function(){this.g.l=null,delete this.j,Qo(this.g),delete this.g,ba.X.M.call(this)},zr(Aa,Os),zr(wa,Ps),zr(Ia,va),Ia.prototype.xa=function(){qi(this.g,"a")},Ia.prototype.wa=function(e){qi(this.g,new Aa(e))},Ia.prototype.va=function(e){qi(this.g,new wa)},Ia.prototype.ua=function(){qi(this.g,"b")},ya.prototype.createWebChannel=ya.prototype.g,ba.prototype.send=ba.prototype.u,ba.prototype.open=ba.prototype.m,ba.prototype.close=ba.prototype.close,_s.NO_ERROR=0,_s.TIMEOUT=8,_s.HTTP_ERROR=6,ks.COMPLETE="complete",Cs.EventType=Rs,Rs.OPEN="a",Rs.CLOSE="b",Rs.ERROR="c",Rs.MESSAGE="d",zi.prototype.listen=zi.prototype.N,Uo.prototype.listenOnce=Uo.prototype.O,Uo.prototype.getLastError=Uo.prototype.Oa,Uo.prototype.getLastErrorCode=Uo.prototype.Ea,Uo.prototype.getStatus=Uo.prototype.aa,Uo.prototype.getResponseJson=Uo.prototype.Sa,Uo.prototype.getResponseText=Uo.prototype.fa,Uo.prototype.send=Uo.prototype.da,Uo.prototype.setWithCredentials=Uo.prototype.Ka,Nr.createWebChannelTransport=function(){return new ya},Nr.getStatEventTarget=function(){return ms()},Nr.ErrorCode=_s,Nr.EventType=ks,Nr.Event=fs,Nr.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Nr.FetchXmlHttpFactory=Po,Nr.WebChannel=Cs,Nr.XhrIo=Uo;const _a="@firebase/firestore";class ka{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ka.UNAUTHENTICATED=new ka(null),ka.GOOGLE_CREDENTIALS=new ka("google-credentials-uid"),ka.FIRST_PARTY=new ka("first-party-uid"),ka.MOCK_USER=new ka("mock-user");let Ta="9.16.0";const Ea=new ce("@firebase/firestore");function Ca(e,...t){if(Ea.logLevel<=ne.DEBUG){const n=t.map(Ra);Ea.debug(`Firestore (${Ta}): ${e}`,...n)}}function Sa(e,...t){if(Ea.logLevel<=ne.ERROR){const n=t.map(Ra);Ea.error(`Firestore (${Ta}): ${e}`,...n)}}function Ra(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Oa(e="Unexpected state"){const t=`FIRESTORE (${Ta}) INTERNAL ASSERTION FAILED: `+e;throw Sa(t),new Error(t)}function Pa(e,t){e||Oa()}const Na="cancelled",Da="invalid-argument",Ba="failed-precondition",xa="unavailable";class La extends F{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ma{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Ua{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ja{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ka.UNAUTHENTICATED)))}shutdown(){}}class Fa{constructor(e){this.t=e,this.currentUser=ka.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ma;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ma,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Ca("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Ca("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ma)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Ca("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Pa("string"==typeof t.accessToken),new Ua(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Pa(null===e||"string"==typeof e),new ka(e)}}class $a{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=ka.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Pa(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Ha{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new $a(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(ka.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Va{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class za{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&Ca("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.A;return this.A=e.token,Ca("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Ca("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):Ca("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Pa("string"==typeof e.token),this.A=e.token,new Va(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function qa(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Ka{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=qa(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Wa(e,t){return e<t?-1:e>t?1:0}class Ga{constructor(e,t,n){void 0===t?t=0:t>e.length&&Oa(),void 0===n?n=e.length-t:n>e.length-t&&Oa(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ga.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ga?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ja extends Ga{construct(e,t,n){return new Ja(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new La(Da,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ja(t)}static emptyPath(){return new Ja([])}}class Ya{constructor(e){this.path=e}static fromPath(e){return new Ya(Ja.fromString(e))}static fromName(e){return new Ya(Ja.fromString(e).popFirst(5))}static empty(){return new Ya(Ja.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ja.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ja.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ya(new Ja(e.slice()))}}function Xa(e){return"IndexedDbTransactionError"===e.name}class Za{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Qa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Qa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Qa&&e.projectId===this.projectId&&e.database===this.database}}class ec{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ec(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ec(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Wa(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function tc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}ec.EMPTY_BYTE_STRING=new ec("");class nc{constructor(e,t){this.comparator=e,this.root=t||ic.EMPTY}insert(e,t){return new nc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ic.BLACK,null,null))}remove(e){return new nc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ic.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rc(this.root,e,this.comparator,!1)}getReverseIterator(){return new rc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rc(this.root,e,this.comparator,!0)}}class rc{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ic{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ic.RED,this.left=null!=r?r:ic.EMPTY,this.right=null!=i?i:ic.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ic(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ic.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ic.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ic.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ic.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Oa();if(this.right.isRed())throw Oa();const e=this.left.check();if(e!==this.right.check())throw Oa();return e+(this.isRed()?0:1)}}ic.EMPTY=null,ic.RED=!0,ic.BLACK=!1,ic.EMPTY=new class{constructor(){this.size=0}get key(){throw Oa()}get value(){throw Oa()}get color(){throw Oa()}get left(){throw Oa()}get right(){throw Oa()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ic(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sc{constructor(e){this.comparator=e,this.data=new nc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new oc(this.data.getIterator())}getIteratorFrom(e){return new oc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof sc))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new sc(this.comparator);return t.data=e,t}}class oc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}var ac,cc;(cc=ac||(ac={}))[cc.OK=0]="OK",cc[cc.CANCELLED=1]="CANCELLED",cc[cc.UNKNOWN=2]="UNKNOWN",cc[cc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",cc[cc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",cc[cc.NOT_FOUND=5]="NOT_FOUND",cc[cc.ALREADY_EXISTS=6]="ALREADY_EXISTS",cc[cc.PERMISSION_DENIED=7]="PERMISSION_DENIED",cc[cc.UNAUTHENTICATED=16]="UNAUTHENTICATED",cc[cc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",cc[cc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",cc[cc.ABORTED=10]="ABORTED",cc[cc.OUT_OF_RANGE=11]="OUT_OF_RANGE",cc[cc.UNIMPLEMENTED=12]="UNIMPLEMENTED",cc[cc.INTERNAL=13]="INTERNAL",cc[cc.UNAVAILABLE=14]="UNAVAILABLE",cc[cc.DATA_LOSS=15]="DATA_LOSS",new nc(Ya.comparator),new nc(Ya.comparator),new nc(Ya.comparator),new sc(Ya.comparator),new sc(Wa);class lc{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(tc(e.integerValue));else if("doubleValue"in e){const n=tc(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),function(e){return 0===e&&1/e==-1/0}(n)?t.le(0):t.le(n))}else if("timestampValue"in e){const n=e.timestampValue;this.he(t,20),"string"==typeof n?t.fe(n):(t.fe(`${n.seconds||""}`),t.le(n.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(function(e){return"string"==typeof e?ec.fromBase64String(e):ec.fromUint8Array(e)}(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.he(t,45),t.le(n.latitude||0),t.le(n.longitude||0)}else"mapValue"in e?function(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):Oa()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){const n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),Ya.fromName(e).path.forEach((e=>{this.he(t,60),this.pe(e,t)}))}he(e,t){e.le(t)}_e(e){e.le(2)}}lc.Ie=new lc,new Uint8Array(0);class hc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new hc(e,hc.DEFAULT_COLLECTION_PERCENTILE,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function uc(){return"undefined"!=typeof document?document:null}hc.DEFAULT_COLLECTION_PERCENTILE=10,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hc.DEFAULT=new hc(41943040,hc.DEFAULT_COLLECTION_PERCENTILE,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hc.DISABLED=new hc(-1,0,0);class dc{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&Ca("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class pc{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ma,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new pc(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new La(Na,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}const fc=new Map;class gc{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new La(Da,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new La(Da,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new La(Da,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mc{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new La(Ba,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new La(Ba,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ja;switch(e.type){case"gapi":const t=e.client;return new Ha(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new La(Da,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=fc.get(e);t&&(Ca("ComponentProvider","Removing Datastore"),fc.delete(e),t.terminate())}(this),Promise.resolve()}}class vc{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ka.UNAUTHENTICATED,this.clientId=Ka.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Ca("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Ca("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new La(Ba,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ma;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=function(e,t){if(Sa("AsyncQueue",`${t}: ${e}`),Xa(e))return new La(xa,`${t}: ${e}`);throw e}(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}class yc{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new dc(this,"async_queue_retry"),this.Wc=()=>{const e=uc();e&&Ca("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=uc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=uc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise((()=>{}));const t=new Ma;return this.Hc((()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Lc.push(e),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!Xa(e))throw e;Ca("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(e){const t=this.Bc.then((()=>(this.Gc=!0,e().catch((e=>{this.Kc=e,this.Gc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Sa("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.Gc=!1,e))))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=pc.createAndSchedule(this,e,t,n,(e=>this.Yc(e)));return this.Uc.push(r),r}zc(){this.Kc&&Oa()}verifyOperationInProgress(){}async Xc(){let e;do{e=this.Bc,await e}while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then((()=>{this.Uc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()}))}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}class bc extends mc{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new yc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||function(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Za(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new vc(e._authCredentials,e._appCheckCredentials,e._queue,r)}(this),this._firestoreClient.terminate()}}!function(e,t=!0){!function(e){Ta=e}(Fe),Le(new X("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new bc(new Fa(e.getProvider("auth-internal")),new za(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new La(Da,'"projectId" not provided in firebase.initializeApp.');return new Qa(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),He(_a,"3.8.1",e),He(_a,"3.8.1","esm2017")}();const Ac="firebasestorage.googleapis.com";class wc extends F{constructor(e,t,n=0){super(Ic(e),`Firebase Storage: ${t} (${Ic(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,wc.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ic(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Ic(e){return"storage/"+e}function _c(e){return new wc("invalid-argument",e)}function kc(){return new wc("app-deleted","The Firebase app was deleted.")}class Tc{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Tc.makeFromUrl(e,t)}catch(t){return new Tc(e,"")}if(""===n.path)return n;throw new wc("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Ac?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<a.length;t++){const r=a[t],i=r.regex.exec(e);if(i){const e=i[r.indices.bucket];let t=i[r.indices.path];t||(t=""),n=new Tc(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new wc("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class Ec{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Cc(e,t,n,r){if(r<t)throw _c(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw _c(`Invalid value for '${e}'. Expected ${n} or less.`)}var Sc,Rc;(Rc=Sc||(Sc={}))[Rc.NO_ERROR=0]="NO_ERROR",Rc[Rc.NETWORK_ERROR=1]="NETWORK_ERROR",Rc[Rc.ABORT=2]="ABORT";class Oc{constructor(e,t,n,r,i,s,o,a,c,l,h,u=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==i){const e=new wc("unknown","An unknown error occurred, please check the error payload for server response.");e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else t.canceled?r(this.appDelete_?kc():new wc("canceled","User canceled the upload/download.")):r(new wc("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new Pc(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){i=setTimeout((()=>{i=null,e(p,c())}),t)}function d(){s&&clearTimeout(s)}function p(e,...t){if(l)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),u(n)}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(a=2),clearTimeout(i),u(0)):e||(a=1)))}return u(0),s=setTimeout((()=>{o=!0,g(!0)}),n),g}(((e,t)=>{if(t)return void e(!1,new Pc(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Sc.NO_ERROR,i=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Sc.ABORT;return void e(!1,new Pc(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Pc(s,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Pc{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class Nc{constructor(e,t){this._service=e,this._location=t instanceof Tc?t:Tc.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Nc(e,t)}get root(){const e=new Tc(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Tc(this._location.bucket,e);return new Nc(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new wc("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Dc(e,t){const n=null==t?void 0:t.storageBucket;return null==n?null:Tc.makeFromBucketSpec(n,e)}class Bc{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Ac,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Tc.makeFromBucketSpec(r,this._host):Dc(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Tc.makeFromBucketSpec(this._url,e):this._bucket=Dc(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Cc("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Cc("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Nc(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new Ec(kc());{const s=function(e,t,n,r,i,s,o=!0){const a=function(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}(e.urlParams),c=e.url+a,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(l,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,r),new Oc(c,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const xc="@firebase/storage",Lc="0.10.1";Le(new X("storage",(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Bc(n,r,i,t,Fe)}),"PUBLIC").setMultipleInstances(!0)),He(xc,Lc,""),He(xc,Lc,"esm2017");const Mc="@firebase/installations",Uc="0.6.1",jc=`w:${Uc}`,Fc="FIS_v2",$c=new $("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Hc(e){return e instanceof F&&e.code.includes("request-failed")}function Vc({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function zc(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function qc(e,t){const n=(await t.json()).error;return $c.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Kc({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Wc(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Gc(e){return new Promise((t=>{setTimeout(t,e)}))}const Jc=/^[cdef][\w-]{21}$/;function Yc(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Jc.test(t)?t:""}catch(e){return""}}function Xc(e){return`${e.appName}!${e.appId}`}const Zc=new Map;function Qc(e,t){const n=Xc(e);el(n,t),function(e,t){const n=(!tl&&"BroadcastChannel"in self&&(tl=new BroadcastChannel("[Firebase] FID Change"),tl.onmessage=e=>{el(e.data.key,e.data.fid)}),tl);n&&n.postMessage({key:e,fid:t}),0===Zc.size&&tl&&(tl.close(),tl=null)}(n,t)}function el(e,t){const n=Zc.get(e);if(n)for(const e of n)e(t)}let tl=null;const nl="firebase-installations-store";let rl=null;function il(){return rl||(rl=Ae("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(nl)}})),rl}async function sl(e,t){const n=Xc(e),r=(await il()).transaction(nl,"readwrite"),i=r.objectStore(nl),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||Qc(e,t.fid),t}async function ol(e){const t=Xc(e),n=(await il()).transaction(nl,"readwrite");await n.objectStore(nl).delete(t),await n.done}async function al(e,t){const n=Xc(e),r=(await il()).transaction(nl,"readwrite"),i=r.objectStore(nl),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||Qc(e,o.fid),o}async function cl(e){let t;const n=await al(e.appConfig,(n=>{const r=function(e){return ul(e||{fid:Yc(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject($c.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Vc(e),i=Kc(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Fc,appId:e.appId,sdkVersion:jc},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Wc((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:zc(e.authToken)}}throw await qc("Create Installation",c)}(e,t);return sl(e.appConfig,n)}catch(n){throw Hc(n)&&409===n.customData.serverCode?await ol(e.appConfig):await sl(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:ll(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function ll(e){let t=await hl(e.appConfig);for(;1===t.registrationStatus;)await Gc(100),t=await hl(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await cl(e);return n||t}return t}function hl(e){return al(e,(e=>{if(!e)throw $c.create("installation-not-found");return ul(e)}))}function ul(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function dl({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${Vc(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=Kc(e);return n.append("Authorization",function(e){return`${Fc} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:jc,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Wc((()=>fetch(r,a)));if(c.ok)return zc(await c.json());throw await qc("Generate Auth Token",c)}async function pl(e,t=!1){let n;const r=await al(e.appConfig,(r=>{if(!gl(r))throw $c.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await fl(e.appConfig);for(;1===n.authToken.requestStatus;)await Gc(100),n=await fl(e.appConfig);const r=n.authToken;return 0===r.requestStatus?pl(e,t):r}(e,t),r;{if(!navigator.onLine)throw $c.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await dl(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await sl(e.appConfig,r),n}catch(n){if(!Hc(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await sl(e.appConfig,n)}else await ol(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function fl(e){return al(e,(e=>{if(!gl(e))throw $c.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function gl(e){return void 0!==e&&2===e.registrationStatus}function ml(e){return $c.create("missing-app-config-values",{valueName:e})}const vl="installations";Le(new X(vl,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw ml("App Configuration");if(!e.name)throw ml("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw ml(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Me(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Le(new X("installations-internal",(e=>{const t=Me(e.getProvider("app").getImmediate(),vl).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await cl(t);return r?r.catch(console.error):pl(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await cl(e);t&&await t}(n),(await pl(n,t)).token}(t,e)}}),"PRIVATE")),He(Mc,Uc),He(Mc,Uc,"esm2017");const yl="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",bl="google.c.a.c_id";var Al,wl;function Il(e){const t=new Uint8Array(e);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _l(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(Al||(Al={})),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(wl||(wl={}));const kl="fcm_token_details_db",Tl="fcm_token_object_Store",El="firebase-messaging-store";let Cl=null;function Sl(){return Cl||(Cl=Ae("firebase-messaging-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(El)}})),Cl}async function Rl(e){const t=Pl(e),n=await Sl(),r=await n.transaction(El).objectStore(El).get(t);if(r)return r;{const t=await async function(e){if("databases"in indexedDB){const e=(await indexedDB.databases()).map((e=>e.name));if(!e.includes(kl))return null}let t=null;const n=await Ae(kl,5,{upgrade:async(n,r,i,s)=>{var o;if(r<2)return;if(!n.objectStoreNames.contains(Tl))return;const a=s.objectStore(Tl),c=await a.index("fcmSenderId").get(e);if(await a.clear(),c)if(2===r){const e=c;if(!e.auth||!e.p256dh||!e.endpoint)return;t={token:e.fcmToken,createTime:null!==(o=e.createTime)&&void 0!==o?o:Date.now(),subscriptionOptions:{auth:e.auth,p256dh:e.p256dh,endpoint:e.endpoint,swScope:e.swScope,vapidKey:"string"==typeof e.vapidKey?e.vapidKey:Il(e.vapidKey)}}}else if(3===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Il(e.auth),p256dh:Il(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Il(e.vapidKey)}}}else if(4===r){const e=c;t={token:e.fcmToken,createTime:e.createTime,subscriptionOptions:{auth:Il(e.auth),p256dh:Il(e.p256dh),endpoint:e.endpoint,swScope:e.swScope,vapidKey:Il(e.vapidKey)}}}}});return n.close(),await we(kl),await we("fcm_vapid_details_db"),await we("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;const{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}(t)?t:null}(e.appConfig.senderId);if(t)return await Ol(e,t),t}}async function Ol(e,t){const n=Pl(e),r=(await Sl()).transaction(El,"readwrite");return await r.objectStore(El).put(t,n),await r.done,t}function Pl({appConfig:e}){return e.appId}const Nl=new $("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function Dl(e,t){const n={method:"DELETE",headers:await xl(e)};try{const r=await fetch(`${Bl(e.appConfig)}/${t}`,n),i=await r.json();if(i.error){const e=i.error.message;throw Nl.create("token-unsubscribe-failed",{errorInfo:e})}}catch(e){throw Nl.create("token-unsubscribe-failed",{errorInfo:null==e?void 0:e.toString()})}}function Bl({projectId:e}){return`https://fcmregistrations.googleapis.com/v1/projects/${e}/registrations`}async function xl({appConfig:e,installations:t}){const n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function Ll({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==yl&&(i.web.applicationPubKey=r),i}async function Ml(e){const t=await async function(e,t){const n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_l(t)})}(e.swRegistration,e.vapidKey),n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Il(t.getKey("auth")),p256dh:Il(t.getKey("p256dh"))},r=await Rl(e.firebaseDependencies);if(r){if(function(e,t){const n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,i=t.auth===e.auth,s=t.p256dh===e.p256dh;return n&&r&&i&&s}(r.subscriptionOptions,n))return Date.now()>=r.createTime+6048e5?async function(e,t){try{const n=await async function(e,t){const n=await xl(e),r=Ll(t.subscriptionOptions),i={method:"PATCH",headers:n,body:JSON.stringify(r)};let s;try{const n=await fetch(`${Bl(e.appConfig)}/${t.token}`,i);s=await n.json()}catch(e){throw Nl.create("token-update-failed",{errorInfo:null==e?void 0:e.toString()})}if(s.error){const e=s.error.message;throw Nl.create("token-update-failed",{errorInfo:e})}if(!s.token)throw Nl.create("token-update-no-token");return s.token}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await Ol(e.firebaseDependencies,r),n}catch(t){throw await async function(e){const t=await Rl(e.firebaseDependencies);t&&(await Dl(e.firebaseDependencies,t.token),await async function(e){const t=Pl(e),n=(await Sl()).transaction(El,"readwrite");await n.objectStore(El).delete(t),await n.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}(e),t}}(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await Dl(e.firebaseDependencies,r.token)}catch(e){console.warn(e)}return Ul(e.firebaseDependencies,n)}return Ul(e.firebaseDependencies,n)}async function Ul(e,t){const n=await async function(e,t){const n=await xl(e),r=Ll(t),i={method:"POST",headers:n,body:JSON.stringify(r)};let s;try{const t=await fetch(Bl(e.appConfig),i);s=await t.json()}catch(e){throw Nl.create("token-subscribe-failed",{errorInfo:null==e?void 0:e.toString()})}if(s.error){const e=s.error.message;throw Nl.create("token-subscribe-failed",{errorInfo:e})}if(!s.token)throw Nl.create("token-subscribe-no-token");return s.token}(e,t),r={token:n,createTime:Date.now(),subscriptionOptions:t};return await Ol(e,r),r.token}function jl(e){const t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return function(e,t){if(!t.notification)return;e.notification={};const n=t.notification.title;n&&(e.notification.title=n);const r=t.notification.body;r&&(e.notification.body=r);const i=t.notification.image;i&&(e.notification.image=i);const s=t.notification.icon;s&&(e.notification.icon=s)}(t,e),function(e,t){t.data&&(e.data=t.data)}(t,e),function(e,t){var n,r,i,s,o;if(!t.fcmOptions&&!(null===(n=t.notification)||void 0===n?void 0:n.click_action))return;e.fcmOptions={};const a=null!==(i=null===(r=t.fcmOptions)||void 0===r?void 0:r.link)&&void 0!==i?i:null===(s=t.notification)||void 0===s?void 0:s.click_action;a&&(e.fcmOptions.link=a);const c=null===(o=t.fcmOptions)||void 0===o?void 0:o.analytics_label;c&&(e.fcmOptions.analyticsLabel=c)}(t,e),t}function Fl(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function $l(e){return Nl.create("missing-app-config-values",{valueName:e})}Fl("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),Fl("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class Hl{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const r=function(e){if(!e||!e.options)throw $l("App Configuration Object");if(!e.name)throw $l("App Name");const t=["projectId","apiKey","appId","messagingSenderId"],{options:n}=e;for(const e of t)if(!n[e])throw $l(e);return{appName:e.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function Vl(e,t){if(!navigator)throw Nl.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw Nl.create("permission-blocked");return await async function(e,t){t?e.vapidKey=t:e.vapidKey||(e.vapidKey=yl)}(e,null==t?void 0:t.vapidKey),await async function(e,t){if(t||e.swRegistration||await async function(e){try{e.swRegistration=await navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}),e.swRegistration.update().catch((()=>{}))}catch(e){throw Nl.create("failed-service-worker-registration",{browserErrorMessage:null==e?void 0:e.message})}}(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw Nl.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),Ml(e)}async function zl(e,t){const n=t.data;if(!n.isFirebaseMessaging)return;e.onMessageHandler&&n.messageType===wl.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(jl(n)):e.onMessageHandler.next(jl(n)));const r=n.data;var i;"object"==typeof(i=r)&&i&&bl in i&&"1"===r["google.c.a.e"]&&await async function(e,t,n){const r=function(e){switch(e){case wl.NOTIFICATION_CLICKED:return"notification_open";case wl.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);(await e.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:n[bl],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}(e,n.messageType,r)}const ql="@firebase/messaging",Kl="0.12.1";Le(new X("messaging",(e=>{const t=new Hl(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",(e=>zl(t,e))),t}),"PUBLIC")),Le(new X("messaging-internal",(e=>{const t=e.getProvider("messaging").getImmediate(),n={getToken:e=>Vl(t,e)};return n}),"PRIVATE")),He(ql,Kl),He(ql,Kl,"esm2017");const Wl="@firebase/performance",Gl="0.6.1",Jl=Gl,Yl="FB-PERF-TRACE-MEASURE",Xl="_wt_",Zl="_fcp",Ql="_fid",eh="@firebase/performance/config",th="@firebase/performance/configexpire",nh="Performance",rh=new $("performance",nh,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),ih=new ce(nh);let sh,oh,ah,ch;ih.logLevel=ne.INFO;class lh{constructor(e){if(this.window=e,!e)throw rh.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&"undefined"!=typeof navigator&&navigator.cookieEnabled?!!U()||(ih.info("IndexedDB is not supported by current browswer"),!1):(ih.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver((e=>{for(const n of e.getEntries())t(n)})).observe({entryTypes:[e]})}static getInstance(){return void 0===sh&&(sh=new lh(oh)),sh}}function hh(){return ah}function uh(e,t){const n=e.length-t.length;if(n<0||n>1)throw rh.create("invalid String merger input");const r=[];for(let n=0;n<e.length;n++)r.push(e.charAt(n)),t.length>n&&r.push(t.charAt(n));return r.join("")}class dh{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=uh("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=uh("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===ch&&(ch=new dh),ch}}var ph;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(ph||(ph={}));const fh=["firebase_","google_","ga_"],gh=new RegExp("^[a-zA-Z]\\w*$");function mh(){const e=lh.getInstance().navigator;return(null==e?void 0:e.serviceWorker)?e.serviceWorker.controller?2:3:1}function vh(){switch(lh.getInstance().document.visibilityState){case"visible":return ph.VISIBLE;case"hidden":return ph.HIDDEN;default:return ph.UNKNOWN}}function yh(){const e=lh.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function bh(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.appId;if(!n)throw rh.create("no app id");return n}const Ah={loggingEnabled:!0};const wh="Could not fetch config, will use default configs";function Ih(e){if(!e)return e;const t=dh.getInstance(),n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=Ah.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):Ah.logSource&&(t.logSource=Ah.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:Ah.logEndPointUrl&&(t.logEndPointUrl=Ah.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:Ah.transportKey&&(t.transportKey=Ah.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==Ah.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=Ah.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==Ah.tracesSamplingRate&&(t.tracesSamplingRate=Ah.tracesSamplingRate),t.logTraceAfterSampling=_h(t.tracesSamplingRate),t.logNetworkAfterSampling=_h(t.networkRequestsSamplingRate),e}function _h(e){return Math.random()<=e}let kh,Th=1;function Eh(e){return Th=2,kh=kh||function(e){return function(){const e=lh.getInstance().document;return new Promise((t=>{if(e&&"complete"!==e.readyState){const n=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()}))}().then((()=>function(e){const t=e.getId();return t.then((e=>{ah=e})),t}(e.installations))).then((t=>function(e,t){const n=function(){const e=lh.getInstance().localStorage;if(!e)return;const t=e.getItem(th);if(!(t&&(n=t,Number(n)>Date.now())))return;var n;const r=e.getItem(eh);if(r)try{return JSON.parse(r)}catch(e){return}}();return n?(Ih(n),Promise.resolve()):function(e,t){return function(e){const t=e.getToken();return t.then((e=>{})),t}(e.installations).then((n=>{const r=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!n)throw rh.create("no project id");return n}(e.app),i=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!n)throw rh.create("no api key");return n}(e.app),s=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${r}/namespaces/fireperf:fetch?key=${i}`,{method:"POST",headers:{Authorization:`FIREBASE_INSTALLATIONS_AUTH ${n}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:n,app_id:bh(e.app),app_version:Jl,sdk_version:"0.0.1"})});return fetch(s).then((e=>{if(e.ok)return e.json();throw rh.create("RC response not ok")}))})).catch((()=>{ih.info(wh)}))}(e,t).then(Ih).then((e=>function(e){const t=lh.getInstance().localStorage;e&&t&&(t.setItem(eh,JSON.stringify(e)),t.setItem(th,String(Date.now()+60*dh.getInstance().configTimeToLive*60*1e3)))}(e)),(()=>{}))}(e,t))).then((()=>Ch()),(()=>Ch()))}(e),kh}function Ch(){Th=3}const Sh=1e4;let Rh,Oh=3,Ph=[],Nh=!1;function Dh(e){setTimeout((()=>{if(0!==Oh)return Ph.length?void function(){const e=Ph.splice(0,1e3),t=e.map((e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})));(function(e,t){return function(e){const t=dh.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then((e=>(e.ok||ih.info("Call to Firebase backend failed."),e.json()))).then((e=>{const n=Number(e.nextRequestWaitMillis);let r=Sh;isNaN(n)||(r=Math.max(n,r));const i=e.logResponseDetails;Array.isArray(i)&&i.length>0&&"RETRY_REQUEST_LATER"===i[0].responseAction&&(Ph=[...t,...Ph],ih.info("Retry transport request later.")),Oh=3,Dh(r)}))})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:dh.getInstance().logSource,log_event:t},e).catch((()=>{Ph=[...e,...Ph],Oh--,ih.info(`Tries left: ${Oh}.`),Dh(Sh)}))}():Dh(Sh)}),e)}function Bh(e,t){Rh||(Rh=function(e){return(...t)=>{!function(e){if(!e.eventTime||!e.message)throw rh.create("invalid cc log");Ph=[...Ph,e]}({message:e(...t),eventTime:Date.now()})}}(Mh)),Rh(e,t)}function xh(e){const t=dh.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&lh.getInstance().requiredApisAvailable()&&(e.isAuto&&vh()!==ph.VISIBLE||(3===Th?Lh(e):Eh(e.performanceController).then((()=>Lh(e)),(()=>Lh(e)))))}function Lh(e){if(!hh())return;const t=dh.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&setTimeout((()=>Bh(e,1)),0)}function Mh(e,t){return 0===t?function(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:Uh(e.performanceController.app),network_request_metric:t};return JSON.stringify(n)}(e):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);const r={application_info:Uh(e.performanceController.app),trace_metric:t};return JSON.stringify(r)}(e)}function Uh(e){return{google_app_id:bh(e),app_instance_id:hh(),web_app_info:{sdk_version:Jl,page_url:lh.getInstance().getUrl(),service_worker_status:mh(),visibility_state:vh(),effective_connection_type:yh()},application_process_state:0}}const jh=["_fp",Zl,Ql];class Fh{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=lh.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${Yl}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw rh.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw rh.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),xh(this)}record(e,t,n){if(e<=0)throw rh.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw rh.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const e of Object.keys(n.metrics))isNaN(Number(n.metrics[e]))||(this.counters[e]=Math.floor(Number(n.metrics[e])));xh(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||n.length>100||!(r&&r.startsWith(Xl)&&jh.indexOf(n)>-1)&&n.startsWith("_"))throw rh.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=function(e){const t=Math.floor(e);return t<e&&ih.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}(null!=t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const n=!(0===(r=e).length||r.length>40||fh.some((e=>r.startsWith(e)))||!r.match(gh));var r;const i=function(e){return 0!==e.length&&e.length<=100}(t);if(n&&i)this.customAttributes[e]=t;else{if(!n)throw rh.create("invalid attribute name",{attributeName:e});if(!i)throw rh.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){const i=lh.getInstance().getUrl();if(!i)return;const s=new Fh(e,Xl+i,!0),o=Math.floor(1e3*lh.getInstance().getTimeOrigin());if(s.setStartTime(o),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n){const e=n.find((e=>"first-paint"===e.name));e&&e.startTime&&s.putMetric("_fp",Math.floor(1e3*e.startTime));const t=n.find((e=>"first-contentful-paint"===e.name));t&&t.startTime&&s.putMetric(Zl,Math.floor(1e3*t.startTime)),r&&s.putMetric(Ql,Math.floor(1e3*r))}xh(s)}static createUserTimingTrace(e,t){xh(new Fh(e,t,!1,t))}}function $h(e,t){const n=t;if(!n||void 0===n.responseStart)return;const r=lh.getInstance().getTimeOrigin(),i=Math.floor(1e3*(n.startTime+r)),s=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,o=Math.floor(1e3*(n.responseEnd-n.startTime));!function(e){const t=dh.getInstance();if(!t.instrumentationEnabled)return;const n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout((()=>Bh(e,0)),0)}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:i,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o})}function Hh(e){hh()&&(setTimeout((()=>function(e){const t=lh.getInstance(),n=t.getEntriesByType("navigation"),r=t.getEntriesByType("paint");if(t.onFirstInputDelay){let i=setTimeout((()=>{Fh.createOobTrace(e,n,r),i=void 0}),5e3);t.onFirstInputDelay((t=>{i&&(clearTimeout(i),Fh.createOobTrace(e,n,r,t))}))}else Fh.createOobTrace(e,n,r)}(e)),0),setTimeout((()=>function(e){const t=lh.getInstance(),n=t.getEntriesByType("resource");for(const t of n)$h(e,t);t.setupObserver("resource",(t=>$h(e,t)))}(e)),0),setTimeout((()=>function(e){const t=lh.getInstance(),n=t.getEntriesByType("measure");for(const t of n)Vh(e,t);t.setupObserver("measure",(t=>Vh(e,t)))}(e)),0))}function Vh(e,t){const n=t.name;n.substring(0,Yl.length)!==Yl&&Fh.createUserTimingTrace(e,n)}class zh{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),lh.getInstance().requiredApisAvailable()?j().then((e=>{e&&(Nh||(Dh(5500),Nh=!0),Eh(this).then((()=>Hh(this)),(()=>Hh(this))),this.initialized=!0)})).catch((e=>{ih.info(`Environment doesn't support IndexedDB: ${e}`)})):ih.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){dh.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return dh.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){dh.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return dh.getInstance().dataCollectionEnabled}}async function qh(){var e=new mn;await async function(e,t,n){const r=en(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&rt(e,"argument-error"),st(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,pn);const i=Kn(r,void 0);return new Qn(r,"signInViaPopup",t,i).executeNotNull()}(Sr(),e)}async function Kh(){(async function(e){var t;const n=en(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new bn({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await async function(e,t){return _t(e,"POST","/v1/accounts:signUp",At(e,t))}(n,{returnSecureToken:!0}),i=await bn._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i})(Sr()).then((()=>{console.log("Welcome!")})).catch((e=>{e.code,e.message}))}Le(new X("performance",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw rh.create("FB not default");if("undefined"==typeof window)throw rh.create("no window");!function(e){oh=e}(window);const i=new zh(n,r);return i._init(t),i}),"PUBLIC")),He(Wl,Gl),He(Wl,Gl,"esm2017");class Wh{constructor(e=[]){this.projects=e}getProjects(){return this.projects}addProject(e){this.projects.push(e)}deleteProject(e){this.projects.splice(this.projects.indexOf(e),1)}editProject(e){let t=prompt("Choose a new name for your project:");null!=t&&""!=t&&this.projects[this.projects.indexOf(e)].setName(t)}}class Gh{constructor(e,t=[]){this.name=e,this.tasks=t}addTask(e){this.tasks.push(e)}deleteTask(e){this.tasks.splice(this.tasks.indexOf(e),1)}setName(e){this.name=e}getName(){return this.name}getSize(){return this.tasks.length}getTasks(){return this.tasks}setTasks(e){this.tasks=e}}class Jh{constructor(e,t,n="0000-00-00",r=!1){this.name=e,this.description=t,this.date=n,this.isCompleted=r}setName(e){this.name=e}setDescription(e){this.description=e}setDate(e){this.date=e}setIsCompleted(e){this.isCompleted=e}getName(){return this.name}getDescription(){return this.description}getDate(){return this.date}getIsCompleted(){return this.isCompleted}}var Yh;document.querySelector("body").innerHTML='\n    <div class="aut"></div>\n    <header></header>\n    <div class="main-container">\n        <nav></nav>\n        <main></main>\n    </div>\n    ',document.querySelector("header").innerHTML=`\n    <img class="icon" src="${w}" alt="Menu Icon"/>\n    <h1 class="header-title">✔️DoingIt</h1>\n    `,document.querySelector("nav").innerHTML=`\n    <ul>\n        <li><img class="icon" src="${I}" alt="All Icon"><button>All</button></li>\n        <li><img class="icon" src="${_}" alt="Today Icon"><button>Today</button></li>\n        <li><img class="icon" src="${k}" alt="This week Icon"><button>Next 7 days</button></li>\n    </ul>\n    <span>Projects</span>\n    <ul id="projects-list">\n    </ul>\n    <ul>\n        <li id="add-container"><button id="add">Add Project</button></li>\n    </ul>\n    `,document.querySelector(".aut").innerHTML='\n    <button id="log-google-btn">Login via GOOGLE</button>\n    <button id="log-anon-btn">Anonymous Login</button>\n    ',function(){let e,t=new Wh;if(null!=localStorage.getItem("handlerData")){e=JSON.parse(localStorage.getItem("handlerData"));for(let n=0;n<e.projects.length;n++){let r=e.projects[n].name,i=new Gh(r);t.addProject(i);for(let r=0;r<e.projects[n].tasks.length;r++){let i=e.projects[n].tasks[r].name,s=e.projects[n].tasks[r].description,o=e.projects[n].tasks[r].date,a=e.projects[n].tasks[r].isCompleted,c=new Jh(i,s,o,a);t.getProjects()[n].addTask(c)}}}document.querySelector("#add").addEventListener("click",(()=>{let e=prompt("Name your new project");if(null!=e&&""!=e){let i=new Gh(e);t.addProject(i),r(n,t.getProjects()),console.log(t),localStorage.setItem("handlerData",JSON.stringify(t))}}));const n=document.querySelector("#projects-list");function r(e,o){let a="";for(let e=0;e<o.length;e++)a+=`<li><img class="icon" src="${C}" alt="Project Icon"><button id="open-btn-${e}">${o[e].getName()}</button>&nbsp<div class="badger">${o[e].getSize()}</div>\n            <button id="edt-btn-${e}"><img class="icon" src="${R}" alt="Edit Icon"></button><button id="del-btn-${e}"><img class="icon" src="${S}" alt="Delete Icon"</button>\n            </li>`;e.innerHTML=a,function(e){for(let o=0;o<e.length;o++)document.getElementById(`del-btn-${o}`).onclick=()=>{t.deleteProject(e[o]),r(n,t.getProjects()),localStorage.setItem("handlerData",JSON.stringify(t))},document.getElementById(`edt-btn-${o}`).onclick=()=>{t.editProject(e[o]),r(n,t.getProjects()),localStorage.setItem("handlerData",JSON.stringify(t))},document.getElementById(`open-btn-${o}`).onclick=()=>{s(i,t.getProjects()[o]),localStorage.setItem("handlerData",JSON.stringify(t))}}(o)}const i=document.querySelector("body > div > main");function s(e,a){let c="<ul>";for(let e=0;e<a.getTasks().length;e++)c+="<li",a.getTasks()[e].getIsCompleted()&&(c+=' style="text-decoration: line-through;"'),c+=`><span>${a.getTasks()[e].getName()}</span><button id="edt-name-${e}"><img class="icon" src="${R}" alt="Edit Icon"></button>\n            <span>${a.getTasks()[e].getDescription()}</span><button id="edt-desc-${e}"><img class="icon" src="${R}" alt="Edit Icon"></button>\n            <input id="date-${e}" type="date" value="${a.getTasks()[e].getDate()}"><input id="check-${e}" type="checkbox" `,a.getTasks()[e].getIsCompleted()&&(c+="checked"),c+=a!=o?`><button id="del-${e}"><img class="icon" src="${S}" alt="Delete Icon"></button></li>`:"></li>";a!=o&&(c+='</ul><button id="add-task">Add Task</button>'),e.innerHTML=c,function(e){for(let a=0;a<e.getTasks().length;a++)document.getElementById(`edt-name-${a}`).onclick=()=>{let n=prompt("Choose a new name:");null!=n&&""!=n&&(e.getTasks()[a].setName(n),s(i,e),localStorage.setItem("handlerData",JSON.stringify(t)))},document.getElementById(`edt-desc-${a}`).onclick=()=>{let n=prompt("Choose a new description:");""==n&&(n="No description..."),null==n||(e.getTasks()[a].setDescription(n),s(i,e),localStorage.setItem("handlerData",JSON.stringify(t)))},document.getElementById(`date-${a}`).onchange=()=>{let n=document.getElementById(`date-${a}`).value;e.getTasks()[a].setDate(n),localStorage.setItem("handlerData",JSON.stringify(t))},document.getElementById(`check-${a}`).onclick=()=>{let n=document.getElementById(`check-${a}`).checked;e.getTasks()[a].setIsCompleted(n),s(i,e),localStorage.setItem("handlerData",JSON.stringify(t))},e!=o&&(document.getElementById(`del-${a}`).onclick=()=>{let o=e.getTasks()[a];e.deleteTask(o),s(i,e),r(n,t.getProjects()),localStorage.setItem("handlerData",JSON.stringify(t))})}(a),a!=o&&function(e,o){e.onclick=()=>{let e=prompt("Choose your task name"),a=prompt("Choose your task description");if(null!=a&&""!=a||(a="No description..."),null!=e&&""!=e){let c=new Jh(e,a);o.addTask(c),s(i,o),r(n,t.getProjects()),localStorage.setItem("handlerData",JSON.stringify(t))}}}(document.querySelector("#add-task"),a)}let o=new Gh("All");function a(){let e=[];for(let n=0;n<t.getProjects().length;n++)for(let r=0;r<t.getProjects()[n].getTasks().length;r++)e.push(t.getProjects()[n].getTasks()[r]);o.setTasks(e)}a(),s(i,o),r(n,t.getProjects()),document.querySelector("body > div > nav > ul:nth-child(1) > li:nth-child(1) > button").onclick=()=>{a(),s(i,o)},document.querySelector("body > div > nav > ul:nth-child(1) > li:nth-child(2) > button").onclick=()=>{!function(){let e=new Date,n=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,r=[];for(let e=0;e<t.getProjects().length;e++)for(let i=0;i<t.getProjects()[e].getTasks().length;i++)t.getProjects()[e].getTasks()[i].getDate()==n&&r.push(t.getProjects()[e].getTasks()[i]);o.setTasks(r)}(),s(i,o)},document.querySelector("body > div > nav > ul:nth-child(1) > li:nth-child(3) > button").onclick=()=>{!function(){let e=Date.now(),n=e+6048e5,r=[];for(let i=0;i<t.getProjects().length;i++)for(let s=0;s<t.getProjects()[i].getTasks().length;s++){let o=new Date(t.getProjects()[i].getTasks()[s].getDate());o=o.getTime(),o>e&&o<n&&r.push(t.getProjects()[i].getTasks()[s])}o.setTasks(r)}(),s(i,o)};const c=document.querySelector("body > header > img"),l=document.querySelector("body > div > nav");c.onclick=()=>{l.classList.contains("visible")?l.classList.remove("visible"):l.classList.add("visible")},document.querySelector("#log-google-btn").addEventListener("click",(()=>{qh()})),document.querySelector("#log-anon-btn").addEventListener("click",(()=>{Kh()}))}(),$e({apiKey:"AIzaSyC3PRzhNZZr2HC54_2e1mBIgu1I71exY3o",authDomain:"doingit-app.firebaseapp.com",projectId:"doingit-app",storageBucket:"doingit-app.appspot.com",messagingSenderId:"69184799749",appId:"1:69184799749:web:da85a20b521e3b4d29c86c"}),Yh=function(e){const t=document.querySelector(".aut");e?t.classList.add("invisible"):console.log("not user")},Y(Sr()).onAuthStateChanged(Yh,undefined,undefined)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z2dGLEVBQU1qZ0YsU0FBU0MsY0FBYyxvQkFFbkMrL0UsRUFBUXJCLFFBQVUsS0FDVHNCLEVBQUlqdkMsVUFBVXBSLFNBQVMsV0FHeEJxZ0QsRUFBSWp2QyxVQUFVNXhDLE9BQU8sV0FGckI2Z0YsRUFBSWp2QyxVQUFVNS9CLElBQUksVUFHdEIsRUFJaUJwUixTQUFTQyxjQUFjLG1CQUMvQnlWLGlCQUFpQixTQUFTLEtBQ25DbW1FLElBQWMsSUFHQzc3RSxTQUFTQyxjQUFjLGlCQUMvQnlWLGlCQUFpQixTQUFTLEtBQ2pDd21FLElBQVksR0FHcEIsQ0kxUkEyQyxHVGlDZ0JqbEUsR0FUVyxDQUNuQnlILE9BQVEsMENBQ1I2UCxXQUFZLDhCQUNaZzVCLFVBQVcsY0FDWGcyQixjQUFlLDBCQUNmclYsa0JBQW1CLGNBQ25CNXZELE1BQU8sNkNQMGlMbUJqTyxHTzVnTGhDLFNBQTJCb1gsR0FFekIsTUFBTSs3RCxFQUFlbmdGLFNBQVNDLGNBQWMsUUFFeENta0IsRUFFQSs3RCxFQUFhbnZDLFVBQVU1L0IsSUFBSSxhQUkzQnJLLFFBQVEyTSxJQUFJLFdBRWxCLEVQaWdMUyxFT2hoTFkwN0IsTVBnaExhMWMsbUJBQW1CMWxCLEdBRExoRyxVQUFPMnJCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9zdHlsZXMvYXV0LmNzcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vc3JjL3N0eWxlcy9oZWFkZXIuY3NzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvc3R5bGVzL21haW5MYXlvdXQuY3NzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvc3R5bGVzL25hdi5jc3MiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9zdHlsZXMvdGFza3MuY3NzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvc291cmNlTWFwcy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRCeVNlbGVjdG9yLmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRTdHlsZUVsZW1lbnQuanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3NldEF0dHJpYnV0ZXNXaXRob3V0QXR0cmlidXRlcy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVEb21BUEkuanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlVGFnVHJhbnNmb3JtLmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3Qvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0L3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0L3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3RvcC10b2RvLWxpc3Qvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC93ZWJwYWNrL3J1bnRpbWUvbm9uY2UiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9zdHlsZXMvbWFpbkxheW91dC5jc3M/YmNjZiIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vc3JjL3N0eWxlcy9oZWFkZXIuY3NzP2U2OGIiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9zdHlsZXMvbmF2LmNzcz8yMTcwIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvc3R5bGVzL3Rhc2tzLmNzcz80ZDMyIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvc3R5bGVzL2F1dC5jc3M/OTliZCIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL2Rpc3QvaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9jb21wb25lbnQvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9sb2dnZXIvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC93cmFwLWlkYi12YWx1ZS5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2lkYi9idWlsZC9pbmRleC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9hcHAvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL2ZpcmViYXNlL2FwcC9kaXN0L2VzbS9pbmRleC5lc20uanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXV0aC9kaXN0L2VzbTIwMTcvaW5kZXgtZTViM2NjODEuanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL2Rpc3QvaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9maXJlc3RvcmUvZGlzdC9pbmRleC5lc20yMDE3LmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3N0b3JhZ2UvZGlzdC9pbmRleC5lc20yMDE3LmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2luc3RhbGxhdGlvbnMvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9tZXNzYWdpbmcvZGlzdC9lc20vaW5kZXguZXNtMjAxNy5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS9wZXJmb3JtYW5jZS9kaXN0L2VzbS9pbmRleC5lc20yMDE3LmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvbG9naWMvZmlyZUJhc2VNYW5pcHVsYXRpb24uanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9sb2dpYy9BcHBIYW5kbGVyLmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvbG9naWMvUHJvamVjdC5qcyIsIndlYnBhY2s6Ly90b3AtdG9kby1saXN0Ly4vc3JjL2xvZ2ljL1Rhc2suanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9VSS9oZWFkZXIuanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9sb2dpYy9ET01NYW5pcHVsYXRpb24uanMiLCJ3ZWJwYWNrOi8vdG9wLXRvZG8tbGlzdC8uL3NyYy9VSS9tYWluTGF5b3V0LmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvVUkvbmF2LmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvVUkvYXV0LmpzIiwid2VicGFjazovL3RvcC10b2RvLWxpc3QvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0c1xuaW1wb3J0IF9fX0NTU19MT0FERVJfQVBJX1NPVVJDRU1BUF9JTVBPUlRfX18gZnJvbSBcIi4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9zb3VyY2VNYXBzLmpzXCI7XG5pbXBvcnQgX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fIGZyb20gXCIuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvYXBpLmpzXCI7XG52YXIgX19fQ1NTX0xPQURFUl9FWFBPUlRfX18gPSBfX19DU1NfTE9BREVSX0FQSV9JTVBPUlRfX18oX19fQ1NTX0xPQURFUl9BUElfU09VUkNFTUFQX0lNUE9SVF9fXyk7XG4vLyBNb2R1bGVcbl9fX0NTU19MT0FERVJfRVhQT1JUX19fLnB1c2goW21vZHVsZS5pZCwgXCIuYXV0IHtcXHJcXG4gICAgcG9zaXRpb246IGZpeGVkO1xcclxcbiAgICB0b3A6IDA7XFxyXFxuICAgIGxlZnQ6IDA7XFxyXFxuICAgIGhlaWdodDogMTAwdmg7XFxyXFxuICAgIHdpZHRoOiAxMDB2dztcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZGFyayk7XFxyXFxuICAgIHotaW5kZXg6IDE7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XFxyXFxuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xcclxcbiAgICBnYXA6IDQwcHg7XFxyXFxufVxcclxcblxcclxcbi5hdXQgYnV0dG9uIHtcXHJcXG4gICAgZm9udC1mYW1pbHk6IHZhcigtLXVuYm91bmRlZCk7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1saWdodCk7XFxyXFxuICAgIHBhZGRpbmc6IDhweDtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XFxyXFxuICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjVzO1xcclxcbn1cXHJcXG5cXHJcXG4uYXV0IGJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgY29sb3I6IHZhcigtLWRhcmspO1xcclxcbn1cXHJcXG5cXHJcXG4uaW52aXNpYmxlIHtcXHJcXG4gICAgZGlzcGxheTogbm9uZTtcXHJcXG59XCIsIFwiXCIse1widmVyc2lvblwiOjMsXCJzb3VyY2VzXCI6W1wid2VicGFjazovLy4vc3JjL3N0eWxlcy9hdXQuY3NzXCJdLFwibmFtZXNcIjpbXSxcIm1hcHBpbmdzXCI6XCJBQUFBO0lBQ0ksZUFBZTtJQUNmLE1BQU07SUFDTixPQUFPO0lBQ1AsYUFBYTtJQUNiLFlBQVk7SUFDWiw2QkFBNkI7SUFDN0IsVUFBVTtJQUNWLGFBQWE7SUFDYixzQkFBc0I7SUFDdEIsbUJBQW1CO0lBQ25CLHVCQUF1QjtJQUN2QixTQUFTO0FBQ2I7O0FBRUE7SUFDSSw2QkFBNkI7SUFDN0IsbUJBQW1CO0lBQ25CLFlBQVk7SUFDWiw2QkFBNkI7SUFDN0IsOEJBQThCO0lBQzlCLGVBQWU7SUFDZixnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSw4QkFBOEI7SUFDOUIsa0JBQWtCO0FBQ3RCOztBQUVBO0lBQ0ksYUFBYTtBQUNqQlwiLFwic291cmNlc0NvbnRlbnRcIjpbXCIuYXV0IHtcXHJcXG4gICAgcG9zaXRpb246IGZpeGVkO1xcclxcbiAgICB0b3A6IDA7XFxyXFxuICAgIGxlZnQ6IDA7XFxyXFxuICAgIGhlaWdodDogMTAwdmg7XFxyXFxuICAgIHdpZHRoOiAxMDB2dztcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZGFyayk7XFxyXFxuICAgIHotaW5kZXg6IDE7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XFxyXFxuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xcclxcbiAgICBnYXA6IDQwcHg7XFxyXFxufVxcclxcblxcclxcbi5hdXQgYnV0dG9uIHtcXHJcXG4gICAgZm9udC1mYW1pbHk6IHZhcigtLXVuYm91bmRlZCk7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1saWdodCk7XFxyXFxuICAgIHBhZGRpbmc6IDhweDtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7XFxyXFxuICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjVzO1xcclxcbn1cXHJcXG5cXHJcXG4uYXV0IGJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgY29sb3I6IHZhcigtLWRhcmspO1xcclxcbn1cXHJcXG5cXHJcXG4uaW52aXNpYmxlIHtcXHJcXG4gICAgZGlzcGxheTogbm9uZTtcXHJcXG59XCJdLFwic291cmNlUm9vdFwiOlwiXCJ9XSk7XG4vLyBFeHBvcnRzXG5leHBvcnQgZGVmYXVsdCBfX19DU1NfTE9BREVSX0VYUE9SVF9fXztcbiIsIi8vIEltcG9ydHNcbmltcG9ydCBfX19DU1NfTE9BREVSX0FQSV9TT1VSQ0VNQVBfSU1QT1JUX19fIGZyb20gXCIuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvc291cmNlTWFwcy5qc1wiO1xuaW1wb3J0IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyBmcm9tIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL2FwaS5qc1wiO1xudmFyIF9fX0NTU19MT0FERVJfRVhQT1JUX19fID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKF9fX0NTU19MT0FERVJfQVBJX1NPVVJDRU1BUF9JTVBPUlRfX18pO1xuLy8gTW9kdWxlXG5fX19DU1NfTE9BREVSX0VYUE9SVF9fXy5wdXNoKFttb2R1bGUuaWQsIFwiLmhlYWRlci10aXRsZSB7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1saWdodCk7XFxyXFxuICAgIGZvbnQtZmFtaWx5OiB2YXIoLS11bmJvdW5kZWQpO1xcclxcbn1cXHJcXG5cXHJcXG5oZWFkZXIgaW1nIHtcXHJcXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xcclxcbiAgICB0b3A6IDE5LjVweDtcXHJcXG4gICAgbGVmdDogMTkuNXB4O1xcclxcbiAgICBjdXJzb3I6IHBvaW50ZXI7XFxyXFxuICAgIHZpc2liaWxpdHk6IGhpZGRlbjtcXHJcXG59XFxyXFxuXFxyXFxuQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA3ODBweCkge1xcclxcbiAgICBoZWFkZXIgaW1nIHtcXHJcXG4gICAgICAgIHZpc2liaWxpdHk6IHZpc2libGU7XFxyXFxuICAgIH1cXHJcXG59XCIsIFwiXCIse1widmVyc2lvblwiOjMsXCJzb3VyY2VzXCI6W1wid2VicGFjazovLy4vc3JjL3N0eWxlcy9oZWFkZXIuY3NzXCJdLFwibmFtZXNcIjpbXSxcIm1hcHBpbmdzXCI6XCJBQUFBO0lBQ0ksbUJBQW1CO0lBQ25CLDZCQUE2QjtBQUNqQzs7QUFFQTtJQUNJLGtCQUFrQjtJQUNsQixXQUFXO0lBQ1gsWUFBWTtJQUNaLGVBQWU7SUFDZixrQkFBa0I7QUFDdEI7O0FBRUE7SUFDSTtRQUNJLG1CQUFtQjtJQUN2QjtBQUNKXCIsXCJzb3VyY2VzQ29udGVudFwiOltcIi5oZWFkZXItdGl0bGUge1xcclxcbiAgICBjb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICBmb250LWZhbWlseTogdmFyKC0tdW5ib3VuZGVkKTtcXHJcXG59XFxyXFxuXFxyXFxuaGVhZGVyIGltZyB7XFxyXFxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXHJcXG4gICAgdG9wOiAxOS41cHg7XFxyXFxuICAgIGxlZnQ6IDE5LjVweDtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbiAgICB2aXNpYmlsaXR5OiBoaWRkZW47XFxyXFxufVxcclxcblxcclxcbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNzgwcHgpIHtcXHJcXG4gICAgaGVhZGVyIGltZyB7XFxyXFxuICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlO1xcclxcbiAgICB9XFxyXFxufVwiXSxcInNvdXJjZVJvb3RcIjpcIlwifV0pO1xuLy8gRXhwb3J0c1xuZXhwb3J0IGRlZmF1bHQgX19fQ1NTX0xPQURFUl9FWFBPUlRfX187XG4iLCIvLyBJbXBvcnRzXG5pbXBvcnQgX19fQ1NTX0xPQURFUl9BUElfU09VUkNFTUFQX0lNUE9SVF9fXyBmcm9tIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL3NvdXJjZU1hcHMuanNcIjtcbmltcG9ydCBfX19DU1NfTE9BREVSX0FQSV9JTVBPUlRfX18gZnJvbSBcIi4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIjtcbnZhciBfX19DU1NfTE9BREVSX0VYUE9SVF9fXyA9IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyhfX19DU1NfTE9BREVSX0FQSV9TT1VSQ0VNQVBfSU1QT1JUX19fKTtcbl9fX0NTU19MT0FERVJfRVhQT1JUX19fLnB1c2goW21vZHVsZS5pZCwgXCJAaW1wb3J0IHVybChodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PVVuYm91bmRlZCZkaXNwbGF5PXN3YXApO1wiXSk7XG5fX19DU1NfTE9BREVSX0VYUE9SVF9fXy5wdXNoKFttb2R1bGUuaWQsIFwiQGltcG9ydCB1cmwoaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1Sb2JvdG86d2dodEA0MDA7NzAwJmRpc3BsYXk9c3dhcCk7XCJdKTtcbi8vIE1vZHVsZVxuX19fQ1NTX0xPQURFUl9FWFBPUlRfX18ucHVzaChbbW9kdWxlLmlkLCBcIjpyb290IHtcXHJcXG4gICAgLS1saWdodDogI0ZGRkZGRjtcXHJcXG4gICAgLS1kYXJrOiAjMGQxMzIxO1xcclxcbiAgICAtLWdyZXk6ICNEMkQ3REY7XFxyXFxuICAgIC0tdW5ib3VuZGVkOiAnVW5ib3VuZGVkJywgY3Vyc2l2ZTtcXHJcXG4gICAgLS1yb2JvdG86ICdSb2JvdG8nLCBzYW5zLXNlcmlmO1xcclxcbn1cXHJcXG5cXHJcXG4qIHtcXHJcXG4gICAgbWFyZ2luOiAwO1xcclxcbiAgICBwYWRkaW5nOiAwO1xcclxcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xcclxcbiAgICAvKmJvcmRlcjogMXB4IHNvbGlkIHJlZDsqL1xcclxcbn1cXHJcXG5cXHJcXG5oZWFkZXIge1xcclxcbiAgICBoZWlnaHQ6IDEwdmg7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XFxyXFxuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1kYXJrKTtcXHJcXG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xcclxcbn1cXHJcXG5cXHJcXG4ubWFpbi1jb250YWluZXIge1xcclxcbiAgICBkaXNwbGF5OiBmbGV4O1xcclxcbn1cXHJcXG5cXHJcXG5uYXYge1xcclxcbiAgICBmbGV4OiAyO1xcclxcbiAgICBoZWlnaHQ6IDkwdmg7XFxyXFxuICAgIG92ZXJmbG93LXk6IGF1dG87XFxyXFxufVxcclxcblxcclxcbm1haW4ge1xcclxcbiAgICBmbGV4OiA4O1xcclxcbiAgICBoZWlnaHQ6IDkwdmg7XFxyXFxuICAgIG92ZXJmbG93LXk6IGF1dG87XFxyXFxufVxcclxcblxcclxcblxcclxcbi8qU2Nyb2xsIGJhciBjb2RlIGZyb206IGh0dHBzOi8vd3d3LmNzc3BvcnRhbC5jb20vY3NzLXNjcm9sbGJhci1nZW5lcmF0b3IvICovXFxyXFxuXFxyXFxuXFxyXFxuLyogRmlyZWZveCAqL1xcclxcblxcclxcbioge1xcclxcbiAgICBzY3JvbGxiYXItd2lkdGg6IHRoaW47XFxyXFxuICAgIHNjcm9sbGJhci1jb2xvcjogIzc0NzQ3NCAjREZFOUVCO1xcclxcbn1cXHJcXG5cXHJcXG5cXHJcXG4vKiBDaHJvbWUsIEVkZ2UgYW5kIFNhZmFyaSAqL1xcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyIHtcXHJcXG4gICAgd2lkdGg6IDRweDtcXHJcXG4gICAgd2lkdGg6IDRweDtcXHJcXG59XFxyXFxuXFxyXFxuKjo6LXdlYmtpdC1zY3JvbGxiYXItdHJhY2sge1xcclxcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICNERkU5RUI7XFxyXFxufVxcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrOmhvdmVyIHtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogI0I4QzBDMjtcXHJcXG59XFxyXFxuXFxyXFxuKjo6LXdlYmtpdC1zY3JvbGxiYXItdHJhY2s6YWN0aXZlIHtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogI0I4QzBDMjtcXHJcXG59XFxyXFxuXFxyXFxuKjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIge1xcclxcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICM3NDc0NzQ7XFxyXFxufVxcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iOmhvdmVyIHtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzc0NzQ3NDtcXHJcXG59XFxyXFxuXFxyXFxuKjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWI6YWN0aXZlIHtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDtcXHJcXG59XFxyXFxuXFxyXFxuQG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA3ODBweCkge1xcclxcbiAgICAudmlzaWJsZSB7XFxyXFxuICAgICAgICBkaXNwbGF5OiBibG9jaztcXHJcXG4gICAgfVxcclxcbiAgICAubWFpbi1jb250YWluZXIge1xcclxcbiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcXHJcXG4gICAgfVxcclxcbn1cIiwgXCJcIix7XCJ2ZXJzaW9uXCI6MyxcInNvdXJjZXNcIjpbXCJ3ZWJwYWNrOi8vLi9zcmMvc3R5bGVzL21haW5MYXlvdXQuY3NzXCJdLFwibmFtZXNcIjpbXSxcIm1hcHBpbmdzXCI6XCJBQUVBO0lBQ0ksZ0JBQWdCO0lBQ2hCLGVBQWU7SUFDZixlQUFlO0lBQ2YsaUNBQWlDO0lBQ2pDLDhCQUE4QjtBQUNsQzs7QUFFQTtJQUNJLFNBQVM7SUFDVCxVQUFVO0lBQ1Ysc0JBQXNCO0lBQ3RCLHlCQUF5QjtBQUM3Qjs7QUFFQTtJQUNJLFlBQVk7SUFDWixhQUFhO0lBQ2IsbUJBQW1CO0lBQ25CLHVCQUF1QjtJQUN2Qiw2QkFBNkI7SUFDN0Isa0JBQWtCO0FBQ3RCOztBQUVBO0lBQ0ksYUFBYTtBQUNqQjs7QUFFQTtJQUNJLE9BQU87SUFDUCxZQUFZO0lBQ1osZ0JBQWdCO0FBQ3BCOztBQUVBO0lBQ0ksT0FBTztJQUNQLFlBQVk7SUFDWixnQkFBZ0I7QUFDcEI7OztBQUdBLDRFQUE0RTs7O0FBRzVFLFlBQVk7O0FBRVo7SUFDSSxxQkFBcUI7SUFDckIsZ0NBQWdDO0FBQ3BDOzs7QUFHQSw0QkFBNEI7O0FBRTVCO0lBQ0ksVUFBVTtJQUNWLFVBQVU7QUFDZDs7QUFFQTtJQUNJLGtCQUFrQjtJQUNsQix5QkFBeUI7QUFDN0I7O0FBRUE7SUFDSSx5QkFBeUI7QUFDN0I7O0FBRUE7SUFDSSx5QkFBeUI7QUFDN0I7O0FBRUE7SUFDSSxrQkFBa0I7SUFDbEIseUJBQXlCO0FBQzdCOztBQUVBO0lBQ0kseUJBQXlCO0FBQzdCOztBQUVBO0lBQ0kseUJBQXlCO0FBQzdCOztBQUVBO0lBQ0k7UUFDSSxjQUFjO0lBQ2xCO0lBQ0E7UUFDSSxzQkFBc0I7SUFDMUI7QUFDSlwiLFwic291cmNlc0NvbnRlbnRcIjpbXCJAaW1wb3J0IHVybCgnaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1VbmJvdW5kZWQmZGlzcGxheT1zd2FwJyk7XFxyXFxuQGltcG9ydCB1cmwoJ2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9Um9ib3RvOndnaHRANDAwOzcwMCZkaXNwbGF5PXN3YXAnKTtcXHJcXG46cm9vdCB7XFxyXFxuICAgIC0tbGlnaHQ6ICNGRkZGRkY7XFxyXFxuICAgIC0tZGFyazogIzBkMTMyMTtcXHJcXG4gICAgLS1ncmV5OiAjRDJEN0RGO1xcclxcbiAgICAtLXVuYm91bmRlZDogJ1VuYm91bmRlZCcsIGN1cnNpdmU7XFxyXFxuICAgIC0tcm9ib3RvOiAnUm9ib3RvJywgc2Fucy1zZXJpZjtcXHJcXG59XFxyXFxuXFxyXFxuKiB7XFxyXFxuICAgIG1hcmdpbjogMDtcXHJcXG4gICAgcGFkZGluZzogMDtcXHJcXG4gICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcXHJcXG4gICAgLypib3JkZXI6IDFweCBzb2xpZCByZWQ7Ki9cXHJcXG59XFxyXFxuXFxyXFxuaGVhZGVyIHtcXHJcXG4gICAgaGVpZ2h0OiAxMHZoO1xcclxcbiAgICBkaXNwbGF5OiBmbGV4O1xcclxcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xcclxcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZGFyayk7XFxyXFxuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcXHJcXG59XFxyXFxuXFxyXFxuLm1haW4tY29udGFpbmVyIHtcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG59XFxyXFxuXFxyXFxubmF2IHtcXHJcXG4gICAgZmxleDogMjtcXHJcXG4gICAgaGVpZ2h0OiA5MHZoO1xcclxcbiAgICBvdmVyZmxvdy15OiBhdXRvO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIHtcXHJcXG4gICAgZmxleDogODtcXHJcXG4gICAgaGVpZ2h0OiA5MHZoO1xcclxcbiAgICBvdmVyZmxvdy15OiBhdXRvO1xcclxcbn1cXHJcXG5cXHJcXG5cXHJcXG4vKlNjcm9sbCBiYXIgY29kZSBmcm9tOiBodHRwczovL3d3dy5jc3Nwb3J0YWwuY29tL2Nzcy1zY3JvbGxiYXItZ2VuZXJhdG9yLyAqL1xcclxcblxcclxcblxcclxcbi8qIEZpcmVmb3ggKi9cXHJcXG5cXHJcXG4qIHtcXHJcXG4gICAgc2Nyb2xsYmFyLXdpZHRoOiB0aGluO1xcclxcbiAgICBzY3JvbGxiYXItY29sb3I6ICM3NDc0NzQgI0RGRTlFQjtcXHJcXG59XFxyXFxuXFxyXFxuXFxyXFxuLyogQ2hyb21lLCBFZGdlIGFuZCBTYWZhcmkgKi9cXHJcXG5cXHJcXG4qOjotd2Via2l0LXNjcm9sbGJhciB7XFxyXFxuICAgIHdpZHRoOiA0cHg7XFxyXFxuICAgIHdpZHRoOiA0cHg7XFxyXFxufVxcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrIHtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogNXB4O1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjREZFOUVCO1xcclxcbn1cXHJcXG5cXHJcXG4qOjotd2Via2l0LXNjcm9sbGJhci10cmFjazpob3ZlciB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICNCOEMwQzI7XFxyXFxufVxcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNrOmFjdGl2ZSB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICNCOEMwQzI7XFxyXFxufVxcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iIHtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogNXB4O1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNzQ3NDc0O1xcclxcbn1cXHJcXG5cXHJcXG4qOjotd2Via2l0LXNjcm9sbGJhci10aHVtYjpob3ZlciB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICM3NDc0NzQ7XFxyXFxufVxcclxcblxcclxcbio6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iOmFjdGl2ZSB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDAwMDA7XFxyXFxufVxcclxcblxcclxcbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNzgwcHgpIHtcXHJcXG4gICAgLnZpc2libGUge1xcclxcbiAgICAgICAgZGlzcGxheTogYmxvY2s7XFxyXFxuICAgIH1cXHJcXG4gICAgLm1haW4tY29udGFpbmVyIHtcXHJcXG4gICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgIH1cXHJcXG59XCJdLFwic291cmNlUm9vdFwiOlwiXCJ9XSk7XG4vLyBFeHBvcnRzXG5leHBvcnQgZGVmYXVsdCBfX19DU1NfTE9BREVSX0VYUE9SVF9fXztcbiIsIi8vIEltcG9ydHNcbmltcG9ydCBfX19DU1NfTE9BREVSX0FQSV9TT1VSQ0VNQVBfSU1QT1JUX19fIGZyb20gXCIuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L3J1bnRpbWUvc291cmNlTWFwcy5qc1wiO1xuaW1wb3J0IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyBmcm9tIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL2FwaS5qc1wiO1xudmFyIF9fX0NTU19MT0FERVJfRVhQT1JUX19fID0gX19fQ1NTX0xPQURFUl9BUElfSU1QT1JUX19fKF9fX0NTU19MT0FERVJfQVBJX1NPVVJDRU1BUF9JTVBPUlRfX18pO1xuLy8gTW9kdWxlXG5fX19DU1NfTE9BREVSX0VYUE9SVF9fXy5wdXNoKFttb2R1bGUuaWQsIFwibmF2IHtcXHJcXG4gICAgZm9udC1mYW1pbHk6IHZhcigtLXJvYm90byk7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWRhcmspO1xcclxcbiAgICBjb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICBwYWRkaW5nLWxlZnQ6IDhweDtcXHJcXG4gICAgcGFkZGluZy1yaWdodDogOHB4O1xcclxcbn1cXHJcXG5cXHJcXG5uYXYgdWwge1xcclxcbiAgICBtYXJnaW4tdG9wOiAyMHB4O1xcclxcbiAgICBtYXJnaW4tYm90dG9tOiAyMHB4O1xcclxcbn1cXHJcXG5cXHJcXG5uYXYgbGkgYnV0dG9uIHtcXHJcXG4gICAgY29sb3I6IHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZGFyayk7XFxyXFxuICAgIHBhZGRpbmc6IDJweDtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogOHB4O1xcclxcbiAgICBib3JkZXI6IHRyYW5zcGFyZW50O1xcclxcbiAgICBmb250LXNpemU6IGxhcmdlcjtcXHJcXG4gICAgbWFyZ2luLXRvcDogNHB4O1xcclxcbiAgICBtYXJnaW4tYm90dG9tOiA0cHg7XFxyXFxuICAgIGN1cnNvcjogcG9pbnRlcjtcXHJcXG4gICAgdHJhbnNpdGlvbjogMC4zcztcXHJcXG59XFxyXFxuXFxyXFxubmF2IGxpIGJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1kYXJrKTtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjNzO1xcclxcbn1cXHJcXG5cXHJcXG5uYXYgc3BhbiB7XFxyXFxuICAgIGZvbnQtc2l6ZTogeHgtbGFyZ2U7XFxyXFxuICAgIGZvbnQtd2VpZ2h0OiA3MDA7XFxyXFxufVxcclxcblxcclxcbiNhZGQtY29udGFpbmVyIHtcXHJcXG4gICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XFxyXFxuICAgIG1hcmdpbi10b3A6IDZweDtcXHJcXG59XFxyXFxuXFxyXFxuI2FkZCB7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1kYXJrKTtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICBmb250LXdlaWdodDogNzAwO1xcclxcbn1cXHJcXG5cXHJcXG4uaWNvbiB7XFxyXFxuICAgIGhlaWdodDogMjYuNHB4O1xcclxcbiAgICB3aWR0aDogMjYuNHB4O1xcclxcbiAgICBmaWx0ZXI6IGludmVydCgxMDAlKSBzZXBpYSg5OSUpIHNhdHVyYXRlKDExOSUpIGh1ZS1yb3RhdGUoMTk2ZGVnKSBicmlnaHRuZXNzKDExNiUpIGNvbnRyYXN0KDEwMCUpO1xcclxcbn1cXHJcXG5cXHJcXG4uYmFkZ2VyIHtcXHJcXG4gICAgZGlzcGxheTogaW5saW5lO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XFxyXFxuICAgIHBhZGRpbmc6IDFweDtcXHJcXG4gICAgY29sb3I6IHZhcigtLWRhcmspO1xcclxcbiAgICBib3JkZXItcmFkaXVzOiAycHg7XFxyXFxufVxcclxcblxcclxcbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNzgwcHgpIHtcXHJcXG4gICAgbmF2IHtcXHJcXG4gICAgICAgIGRpc3BsYXk6IG5vbmU7XFxyXFxuICAgIH1cXHJcXG59XCIsIFwiXCIse1widmVyc2lvblwiOjMsXCJzb3VyY2VzXCI6W1wid2VicGFjazovLy4vc3JjL3N0eWxlcy9uYXYuY3NzXCJdLFwibmFtZXNcIjpbXSxcIm1hcHBpbmdzXCI6XCJBQUFBO0lBQ0ksMEJBQTBCO0lBQzFCLDZCQUE2QjtJQUM3QixtQkFBbUI7SUFDbkIsaUJBQWlCO0lBQ2pCLGtCQUFrQjtBQUN0Qjs7QUFFQTtJQUNJLGdCQUFnQjtJQUNoQixtQkFBbUI7QUFDdkI7O0FBRUE7SUFDSSxtQkFBbUI7SUFDbkIsNkJBQTZCO0lBQzdCLFlBQVk7SUFDWixrQkFBa0I7SUFDbEIsbUJBQW1CO0lBQ25CLGlCQUFpQjtJQUNqQixlQUFlO0lBQ2Ysa0JBQWtCO0lBQ2xCLGVBQWU7SUFDZixnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSxrQkFBa0I7SUFDbEIsOEJBQThCO0lBQzlCLGdCQUFnQjtBQUNwQjs7QUFFQTtJQUNJLG1CQUFtQjtJQUNuQixnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSxhQUFhO0lBQ2IsdUJBQXVCO0lBQ3ZCLGVBQWU7QUFDbkI7O0FBRUE7SUFDSSxrQkFBa0I7SUFDbEIsOEJBQThCO0lBQzlCLGdCQUFnQjtBQUNwQjs7QUFFQTtJQUNJLGNBQWM7SUFDZCxhQUFhO0lBQ2IsaUdBQWlHO0FBQ3JHOztBQUVBO0lBQ0ksZUFBZTtJQUNmLDhCQUE4QjtJQUM5QixZQUFZO0lBQ1osa0JBQWtCO0lBQ2xCLGtCQUFrQjtBQUN0Qjs7QUFFQTtJQUNJO1FBQ0ksYUFBYTtJQUNqQjtBQUNKXCIsXCJzb3VyY2VzQ29udGVudFwiOltcIm5hdiB7XFxyXFxuICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1yb2JvdG8pO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1kYXJrKTtcXHJcXG4gICAgY29sb3I6IHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgcGFkZGluZy1sZWZ0OiA4cHg7XFxyXFxuICAgIHBhZGRpbmctcmlnaHQ6IDhweDtcXHJcXG59XFxyXFxuXFxyXFxubmF2IHVsIHtcXHJcXG4gICAgbWFyZ2luLXRvcDogMjBweDtcXHJcXG4gICAgbWFyZ2luLWJvdHRvbTogMjBweDtcXHJcXG59XFxyXFxuXFxyXFxubmF2IGxpIGJ1dHRvbiB7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1saWdodCk7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWRhcmspO1xcclxcbiAgICBwYWRkaW5nOiAycHg7XFxyXFxuICAgIGJvcmRlci1yYWRpdXM6IDhweDtcXHJcXG4gICAgYm9yZGVyOiB0cmFuc3BhcmVudDtcXHJcXG4gICAgZm9udC1zaXplOiBsYXJnZXI7XFxyXFxuICAgIG1hcmdpbi10b3A6IDRweDtcXHJcXG4gICAgbWFyZ2luLWJvdHRvbTogNHB4O1xcclxcbiAgICBjdXJzb3I6IHBvaW50ZXI7XFxyXFxuICAgIHRyYW5zaXRpb246IDAuM3M7XFxyXFxufVxcclxcblxcclxcbm5hdiBsaSBidXR0b246aG92ZXIge1xcclxcbiAgICBjb2xvcjogdmFyKC0tZGFyayk7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgdHJhbnNpdGlvbjogMC4zcztcXHJcXG59XFxyXFxuXFxyXFxubmF2IHNwYW4ge1xcclxcbiAgICBmb250LXNpemU6IHh4LWxhcmdlO1xcclxcbiAgICBmb250LXdlaWdodDogNzAwO1xcclxcbn1cXHJcXG5cXHJcXG4jYWRkLWNvbnRhaW5lciB7XFxyXFxuICAgIGRpc3BsYXk6IGZsZXg7XFxyXFxuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xcclxcbiAgICBtYXJnaW4tdG9wOiA2cHg7XFxyXFxufVxcclxcblxcclxcbiNhZGQge1xcclxcbiAgICBjb2xvcjogdmFyKC0tZGFyayk7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcXHJcXG4gICAgZm9udC13ZWlnaHQ6IDcwMDtcXHJcXG59XFxyXFxuXFxyXFxuLmljb24ge1xcclxcbiAgICBoZWlnaHQ6IDI2LjRweDtcXHJcXG4gICAgd2lkdGg6IDI2LjRweDtcXHJcXG4gICAgZmlsdGVyOiBpbnZlcnQoMTAwJSkgc2VwaWEoOTklKSBzYXR1cmF0ZSgxMTklKSBodWUtcm90YXRlKDE5NmRlZykgYnJpZ2h0bmVzcygxMTYlKSBjb250cmFzdCgxMDAlKTtcXHJcXG59XFxyXFxuXFxyXFxuLmJhZGdlciB7XFxyXFxuICAgIGRpc3BsYXk6IGlubGluZTtcXHJcXG4gICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICBwYWRkaW5nOiAxcHg7XFxyXFxuICAgIGNvbG9yOiB2YXIoLS1kYXJrKTtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogMnB4O1xcclxcbn1cXHJcXG5cXHJcXG5AbWVkaWEgb25seSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6IDc4MHB4KSB7XFxyXFxuICAgIG5hdiB7XFxyXFxuICAgICAgICBkaXNwbGF5OiBub25lO1xcclxcbiAgICB9XFxyXFxufVwiXSxcInNvdXJjZVJvb3RcIjpcIlwifV0pO1xuLy8gRXhwb3J0c1xuZXhwb3J0IGRlZmF1bHQgX19fQ1NTX0xPQURFUl9FWFBPUlRfX187XG4iLCIvLyBJbXBvcnRzXG5pbXBvcnQgX19fQ1NTX0xPQURFUl9BUElfU09VUkNFTUFQX0lNUE9SVF9fXyBmcm9tIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9ydW50aW1lL3NvdXJjZU1hcHMuanNcIjtcbmltcG9ydCBfX19DU1NfTE9BREVSX0FQSV9JTVBPUlRfX18gZnJvbSBcIi4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvcnVudGltZS9hcGkuanNcIjtcbnZhciBfX19DU1NfTE9BREVSX0VYUE9SVF9fXyA9IF9fX0NTU19MT0FERVJfQVBJX0lNUE9SVF9fXyhfX19DU1NfTE9BREVSX0FQSV9TT1VSQ0VNQVBfSU1QT1JUX19fKTtcbi8vIE1vZHVsZVxuX19fQ1NTX0xPQURFUl9FWFBPUlRfX18ucHVzaChbbW9kdWxlLmlkLCBcIm1haW4ge1xcclxcbiAgICBwYWRkaW5nOiA1JTtcXHJcXG59XFxyXFxuXFxyXFxubWFpbiBsaSB7XFxyXFxuICAgIG1hcmdpbi10b3A6IDEycHg7XFxyXFxuICAgIGRpc3BsYXk6IGdyaWQ7XFxyXFxuICAgIGNvbHVtbi1nYXA6IDEwcHg7XFxyXFxuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMmZyIDI4cHggNmZyIDI4cHggMWZyIDFmciAyOHB4O1xcclxcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxyXFxuICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1yb2JvdG8pO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjQxLCAyNDEsIDI0MSk7XFxyXFxuICAgIHBhZGRpbmc6IDRweDtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogNnB4O1xcclxcbiAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHZhcigtLWRhcmspO1xcclxcbiAgICBsaW5lLWhlaWdodDogMzBweDtcXHJcXG59XFxyXFxuXFxyXFxubWFpbiBsaSBidXR0b24ge1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDtcXHJcXG4gICAgYm9yZGVyOiBub25lO1xcclxcbiAgICBjdXJzb3I6IHBvaW50ZXI7XFxyXFxuICAgIHRyYW5zaXRpb246IDAuM3M7XFxyXFxufVxcclxcblxcclxcbm1haW4gaW1nW2FsdD1cXFwiRGVsZXRlIEljb25cXFwiXSB7XFxyXFxuICAgIGZpbHRlcjogaW52ZXJ0KDI3JSkgc2VwaWEoNTAlKSBzYXR1cmF0ZSgyOTE4JSkgaHVlLXJvdGF0ZSgzNDRkZWcpIGJyaWdodG5lc3MoODMlKSBjb250cmFzdCg5MCUpICFpbXBvcnRhbnQ7XFxyXFxufVxcclxcblxcclxcbm1haW4gaW5wdXRbdHlwZT1cXFwiZGF0ZVxcXCJdIHtcXHJcXG4gICAgZm9udC1mYW1pbHk6IHZhcigtLXJvYm90byk7XFxyXFxuICAgIGJvcmRlcjogbm9uZTtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogOHB4O1xcclxcbiAgICBmb250LXNpemU6IHNtYWxsO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIGxpIGJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyMTAsIDIxMCwgMjEwKTtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogNTAlO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjNzO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIGxpIGlucHV0IHtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIGxpIGJ1dHRvbiBpbWcge1xcclxcbiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMCkgIWltcG9ydGFudDtcXHJcXG59XFxyXFxuXFxyXFxubWFpbiBzcGFuIHtcXHJcXG4gICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XFxyXFxufVxcclxcblxcclxcbm1haW4+YnV0dG9uIHtcXHJcXG4gICAgbWFyZ2luLXRvcDogMTJweDtcXHJcXG4gICAgZGlzcGxheTogYmxvY2s7XFxyXFxuICAgIHdpZHRoOiAxMDAlO1xcclxcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWRhcmspO1xcclxcbiAgICBjb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICBmb250LWZhbWlseTogdmFyKC0tcm9ib3RvKTtcXHJcXG4gICAgcGFkZGluZzogM3B4O1xcclxcbiAgICBib3JkZXItcmFkaXVzOiA4cHg7XFxyXFxuICAgIGJvcmRlcjogdHJhbnNwYXJlbnQ7XFxyXFxuICAgIGN1cnNvcjogcG9pbnRlcjtcXHJcXG4gICAgZm9udC1zaXplOiB4LWxhcmdlO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjNzO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluPmJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIHRyYW5zaXRpb246IDAuM3M7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICM0ZjUwNTM7XFxyXFxufVxcclxcblxcclxcbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDI1cHgpIHtcXHJcXG4gICAgbWFpbiBsaSB7XFxyXFxuICAgICAgICAvKlxcclxcbiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyO1xcclxcbiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1yb3dzOiBhdXRvIGF1dG8gYXV0bzsqL1xcclxcbiAgICAgICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xcclxcbiAgICB9XFxyXFxuICAgIGlucHV0W3R5cGU9XFxcImNoZWNrYm94XFxcIl0sXFxyXFxuICAgIGlucHV0W3R5cGU9XFxcImRhdGVcXFwiXSB7XFxyXFxuICAgICAgICBtYXgtaGVpZ2h0OiAzMC40cHg7XFxyXFxuICAgIH1cXHJcXG59XCIsIFwiXCIse1widmVyc2lvblwiOjMsXCJzb3VyY2VzXCI6W1wid2VicGFjazovLy4vc3JjL3N0eWxlcy90YXNrcy5jc3NcIl0sXCJuYW1lc1wiOltdLFwibWFwcGluZ3NcIjpcIkFBQUE7SUFDSSxXQUFXO0FBQ2Y7O0FBRUE7SUFDSSxnQkFBZ0I7SUFDaEIsYUFBYTtJQUNiLGdCQUFnQjtJQUNoQixxREFBcUQ7SUFDckQsa0JBQWtCO0lBQ2xCLDBCQUEwQjtJQUMxQixvQ0FBb0M7SUFDcEMsWUFBWTtJQUNaLGtCQUFrQjtJQUNsQixrQ0FBa0M7SUFDbEMsaUJBQWlCO0FBQ3JCOztBQUVBO0lBQ0ksNkJBQTZCO0lBQzdCLFlBQVk7SUFDWixlQUFlO0lBQ2YsZ0JBQWdCO0FBQ3BCOztBQUVBO0lBQ0ksMEdBQTBHO0FBQzlHOztBQUVBO0lBQ0ksMEJBQTBCO0lBQzFCLFlBQVk7SUFDWixrQkFBa0I7SUFDbEIsZ0JBQWdCO0FBQ3BCOztBQUVBO0lBQ0ksb0NBQW9DO0lBQ3BDLGtCQUFrQjtJQUNsQixnQkFBZ0I7QUFDcEI7O0FBRUE7SUFDSSxlQUFlO0FBQ25COztBQUVBO0lBQ0ksZ0NBQWdDO0FBQ3BDOztBQUVBO0lBQ0ksdUJBQXVCO0FBQzNCOztBQUVBO0lBQ0ksZ0JBQWdCO0lBQ2hCLGNBQWM7SUFDZCxXQUFXO0lBQ1gsa0JBQWtCO0lBQ2xCLDZCQUE2QjtJQUM3QixtQkFBbUI7SUFDbkIsMEJBQTBCO0lBQzFCLFlBQVk7SUFDWixrQkFBa0I7SUFDbEIsbUJBQW1CO0lBQ25CLGVBQWU7SUFDZixrQkFBa0I7SUFDbEIsZ0JBQWdCO0FBQ3BCOztBQUVBO0lBQ0ksZ0JBQWdCO0lBQ2hCLHlCQUF5QjtBQUM3Qjs7QUFFQTtJQUNJO1FBQ0k7OzRDQUVvQztRQUNwQyxhQUFhO1FBQ2Isc0JBQXNCO1FBQ3RCLG1CQUFtQjtJQUN2QjtJQUNBOztRQUVJLGtCQUFrQjtJQUN0QjtBQUNKXCIsXCJzb3VyY2VzQ29udGVudFwiOltcIm1haW4ge1xcclxcbiAgICBwYWRkaW5nOiA1JTtcXHJcXG59XFxyXFxuXFxyXFxubWFpbiBsaSB7XFxyXFxuICAgIG1hcmdpbi10b3A6IDEycHg7XFxyXFxuICAgIGRpc3BsYXk6IGdyaWQ7XFxyXFxuICAgIGNvbHVtbi1nYXA6IDEwcHg7XFxyXFxuICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMmZyIDI4cHggNmZyIDI4cHggMWZyIDFmciAyOHB4O1xcclxcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxyXFxuICAgIGZvbnQtZmFtaWx5OiB2YXIoLS1yb2JvdG8pO1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMjQxLCAyNDEsIDI0MSk7XFxyXFxuICAgIHBhZGRpbmc6IDRweDtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogNnB4O1xcclxcbiAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHZhcigtLWRhcmspO1xcclxcbiAgICBsaW5lLWhlaWdodDogMzBweDtcXHJcXG59XFxyXFxuXFxyXFxubWFpbiBsaSBidXR0b24ge1xcclxcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudDtcXHJcXG4gICAgYm9yZGVyOiBub25lO1xcclxcbiAgICBjdXJzb3I6IHBvaW50ZXI7XFxyXFxuICAgIHRyYW5zaXRpb246IDAuM3M7XFxyXFxufVxcclxcblxcclxcbm1haW4gaW1nW2FsdD1cXFwiRGVsZXRlIEljb25cXFwiXSB7XFxyXFxuICAgIGZpbHRlcjogaW52ZXJ0KDI3JSkgc2VwaWEoNTAlKSBzYXR1cmF0ZSgyOTE4JSkgaHVlLXJvdGF0ZSgzNDRkZWcpIGJyaWdodG5lc3MoODMlKSBjb250cmFzdCg5MCUpICFpbXBvcnRhbnQ7XFxyXFxufVxcclxcblxcclxcbm1haW4gaW5wdXRbdHlwZT1cXFwiZGF0ZVxcXCJdIHtcXHJcXG4gICAgZm9udC1mYW1pbHk6IHZhcigtLXJvYm90byk7XFxyXFxuICAgIGJvcmRlcjogbm9uZTtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogOHB4O1xcclxcbiAgICBmb250LXNpemU6IHNtYWxsO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIGxpIGJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHJnYigyMTAsIDIxMCwgMjEwKTtcXHJcXG4gICAgYm9yZGVyLXJhZGl1czogNTAlO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjNzO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIGxpIGlucHV0IHtcXHJcXG4gICAgY3Vyc29yOiBwb2ludGVyO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluIGxpIGJ1dHRvbiBpbWcge1xcclxcbiAgICBmaWx0ZXI6IGJyaWdodG5lc3MoMCkgIWltcG9ydGFudDtcXHJcXG59XFxyXFxuXFxyXFxubWFpbiBzcGFuIHtcXHJcXG4gICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XFxyXFxufVxcclxcblxcclxcbm1haW4+YnV0dG9uIHtcXHJcXG4gICAgbWFyZ2luLXRvcDogMTJweDtcXHJcXG4gICAgZGlzcGxheTogYmxvY2s7XFxyXFxuICAgIHdpZHRoOiAxMDAlO1xcclxcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWRhcmspO1xcclxcbiAgICBjb2xvcjogdmFyKC0tbGlnaHQpO1xcclxcbiAgICBmb250LWZhbWlseTogdmFyKC0tcm9ib3RvKTtcXHJcXG4gICAgcGFkZGluZzogM3B4O1xcclxcbiAgICBib3JkZXItcmFkaXVzOiA4cHg7XFxyXFxuICAgIGJvcmRlcjogdHJhbnNwYXJlbnQ7XFxyXFxuICAgIGN1cnNvcjogcG9pbnRlcjtcXHJcXG4gICAgZm9udC1zaXplOiB4LWxhcmdlO1xcclxcbiAgICB0cmFuc2l0aW9uOiAwLjNzO1xcclxcbn1cXHJcXG5cXHJcXG5tYWluPmJ1dHRvbjpob3ZlciB7XFxyXFxuICAgIHRyYW5zaXRpb246IDAuM3M7XFxyXFxuICAgIGJhY2tncm91bmQtY29sb3I6ICM0ZjUwNTM7XFxyXFxufVxcclxcblxcclxcbkBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDogNDI1cHgpIHtcXHJcXG4gICAgbWFpbiBsaSB7XFxyXFxuICAgICAgICAvKlxcclxcbiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyO1xcclxcbiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1yb3dzOiBhdXRvIGF1dG8gYXV0bzsqL1xcclxcbiAgICAgICAgZGlzcGxheTogZmxleDtcXHJcXG4gICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XFxyXFxuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xcclxcbiAgICB9XFxyXFxuICAgIGlucHV0W3R5cGU9XFxcImNoZWNrYm94XFxcIl0sXFxyXFxuICAgIGlucHV0W3R5cGU9XFxcImRhdGVcXFwiXSB7XFxyXFxuICAgICAgICBtYXgtaGVpZ2h0OiAzMC40cHg7XFxyXFxuICAgIH1cXHJcXG59XCJdLFwic291cmNlUm9vdFwiOlwiXCJ9XSk7XG4vLyBFeHBvcnRzXG5leHBvcnQgZGVmYXVsdCBfX19DU1NfTE9BREVSX0VYUE9SVF9fXztcbiIsIlwidXNlIHN0cmljdFwiO1xuXG4vKlxuICBNSVQgTGljZW5zZSBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICBBdXRob3IgVG9iaWFzIEtvcHBlcnMgQHNva3JhXG4qL1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoY3NzV2l0aE1hcHBpbmdUb1N0cmluZykge1xuICB2YXIgbGlzdCA9IFtdO1xuXG4gIC8vIHJldHVybiB0aGUgbGlzdCBvZiBtb2R1bGVzIGFzIGNzcyBzdHJpbmdcbiAgbGlzdC50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIGNvbnRlbnQgPSBcIlwiO1xuICAgICAgdmFyIG5lZWRMYXllciA9IHR5cGVvZiBpdGVtWzVdICE9PSBcInVuZGVmaW5lZFwiO1xuICAgICAgaWYgKGl0ZW1bNF0pIHtcbiAgICAgICAgY29udGVudCArPSBcIkBzdXBwb3J0cyAoXCIuY29uY2F0KGl0ZW1bNF0sIFwiKSB7XCIpO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW1bMl0pIHtcbiAgICAgICAgY29udGVudCArPSBcIkBtZWRpYSBcIi5jb25jYXQoaXRlbVsyXSwgXCIge1wiKTtcbiAgICAgIH1cbiAgICAgIGlmIChuZWVkTGF5ZXIpIHtcbiAgICAgICAgY29udGVudCArPSBcIkBsYXllclwiLmNvbmNhdChpdGVtWzVdLmxlbmd0aCA+IDAgPyBcIiBcIi5jb25jYXQoaXRlbVs1XSkgOiBcIlwiLCBcIiB7XCIpO1xuICAgICAgfVxuICAgICAgY29udGVudCArPSBjc3NXaXRoTWFwcGluZ1RvU3RyaW5nKGl0ZW0pO1xuICAgICAgaWYgKG5lZWRMYXllcikge1xuICAgICAgICBjb250ZW50ICs9IFwifVwiO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW1bMl0pIHtcbiAgICAgICAgY29udGVudCArPSBcIn1cIjtcbiAgICAgIH1cbiAgICAgIGlmIChpdGVtWzRdKSB7XG4gICAgICAgIGNvbnRlbnQgKz0gXCJ9XCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udGVudDtcbiAgICB9KS5qb2luKFwiXCIpO1xuICB9O1xuXG4gIC8vIGltcG9ydCBhIGxpc3Qgb2YgbW9kdWxlcyBpbnRvIHRoZSBsaXN0XG4gIGxpc3QuaSA9IGZ1bmN0aW9uIGkobW9kdWxlcywgbWVkaWEsIGRlZHVwZSwgc3VwcG9ydHMsIGxheWVyKSB7XG4gICAgaWYgKHR5cGVvZiBtb2R1bGVzID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBtb2R1bGVzID0gW1tudWxsLCBtb2R1bGVzLCB1bmRlZmluZWRdXTtcbiAgICB9XG4gICAgdmFyIGFscmVhZHlJbXBvcnRlZE1vZHVsZXMgPSB7fTtcbiAgICBpZiAoZGVkdXBlKSB7XG4gICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgdmFyIGlkID0gdGhpc1trXVswXTtcbiAgICAgICAgaWYgKGlkICE9IG51bGwpIHtcbiAgICAgICAgICBhbHJlYWR5SW1wb3J0ZWRNb2R1bGVzW2lkXSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZm9yICh2YXIgX2sgPSAwOyBfayA8IG1vZHVsZXMubGVuZ3RoOyBfaysrKSB7XG4gICAgICB2YXIgaXRlbSA9IFtdLmNvbmNhdChtb2R1bGVzW19rXSk7XG4gICAgICBpZiAoZGVkdXBlICYmIGFscmVhZHlJbXBvcnRlZE1vZHVsZXNbaXRlbVswXV0pIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGxheWVyICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGlmICh0eXBlb2YgaXRlbVs1XSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgIGl0ZW1bNV0gPSBsYXllcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtWzFdID0gXCJAbGF5ZXJcIi5jb25jYXQoaXRlbVs1XS5sZW5ndGggPiAwID8gXCIgXCIuY29uY2F0KGl0ZW1bNV0pIDogXCJcIiwgXCIge1wiKS5jb25jYXQoaXRlbVsxXSwgXCJ9XCIpO1xuICAgICAgICAgIGl0ZW1bNV0gPSBsYXllcjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG1lZGlhKSB7XG4gICAgICAgIGlmICghaXRlbVsyXSkge1xuICAgICAgICAgIGl0ZW1bMl0gPSBtZWRpYTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpdGVtWzFdID0gXCJAbWVkaWEgXCIuY29uY2F0KGl0ZW1bMl0sIFwiIHtcIikuY29uY2F0KGl0ZW1bMV0sIFwifVwiKTtcbiAgICAgICAgICBpdGVtWzJdID0gbWVkaWE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzdXBwb3J0cykge1xuICAgICAgICBpZiAoIWl0ZW1bNF0pIHtcbiAgICAgICAgICBpdGVtWzRdID0gXCJcIi5jb25jYXQoc3VwcG9ydHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGl0ZW1bMV0gPSBcIkBzdXBwb3J0cyAoXCIuY29uY2F0KGl0ZW1bNF0sIFwiKSB7XCIpLmNvbmNhdChpdGVtWzFdLCBcIn1cIik7XG4gICAgICAgICAgaXRlbVs0XSA9IHN1cHBvcnRzO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsaXN0LnB1c2goaXRlbSk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gbGlzdDtcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgdmFyIGNvbnRlbnQgPSBpdGVtWzFdO1xuICB2YXIgY3NzTWFwcGluZyA9IGl0ZW1bM107XG4gIGlmICghY3NzTWFwcGluZykge1xuICAgIHJldHVybiBjb250ZW50O1xuICB9XG4gIGlmICh0eXBlb2YgYnRvYSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgdmFyIGJhc2U2NCA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGNzc01hcHBpbmcpKSkpO1xuICAgIHZhciBkYXRhID0gXCJzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04O2Jhc2U2NCxcIi5jb25jYXQoYmFzZTY0KTtcbiAgICB2YXIgc291cmNlTWFwcGluZyA9IFwiLyojIFwiLmNvbmNhdChkYXRhLCBcIiAqL1wiKTtcbiAgICB2YXIgc291cmNlVVJMcyA9IGNzc01hcHBpbmcuc291cmNlcy5tYXAoZnVuY3Rpb24gKHNvdXJjZSkge1xuICAgICAgcmV0dXJuIFwiLyojIHNvdXJjZVVSTD1cIi5jb25jYXQoY3NzTWFwcGluZy5zb3VyY2VSb290IHx8IFwiXCIpLmNvbmNhdChzb3VyY2UsIFwiICovXCIpO1xuICAgIH0pO1xuICAgIHJldHVybiBbY29udGVudF0uY29uY2F0KHNvdXJjZVVSTHMpLmNvbmNhdChbc291cmNlTWFwcGluZ10pLmpvaW4oXCJcXG5cIik7XG4gIH1cbiAgcmV0dXJuIFtjb250ZW50XS5qb2luKFwiXFxuXCIpO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIHN0eWxlc0luRE9NID0gW107XG5cbmZ1bmN0aW9uIGdldEluZGV4QnlJZGVudGlmaWVyKGlkZW50aWZpZXIpIHtcbiAgdmFyIHJlc3VsdCA9IC0xO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3R5bGVzSW5ET00ubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoc3R5bGVzSW5ET01baV0uaWRlbnRpZmllciA9PT0gaWRlbnRpZmllcikge1xuICAgICAgcmVzdWx0ID0gaTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIG1vZHVsZXNUb0RvbShsaXN0LCBvcHRpb25zKSB7XG4gIHZhciBpZENvdW50TWFwID0ge307XG4gIHZhciBpZGVudGlmaWVycyA9IFtdO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBpdGVtID0gbGlzdFtpXTtcbiAgICB2YXIgaWQgPSBvcHRpb25zLmJhc2UgPyBpdGVtWzBdICsgb3B0aW9ucy5iYXNlIDogaXRlbVswXTtcbiAgICB2YXIgY291bnQgPSBpZENvdW50TWFwW2lkXSB8fCAwO1xuICAgIHZhciBpZGVudGlmaWVyID0gXCJcIi5jb25jYXQoaWQsIFwiIFwiKS5jb25jYXQoY291bnQpO1xuICAgIGlkQ291bnRNYXBbaWRdID0gY291bnQgKyAxO1xuICAgIHZhciBpbmRleEJ5SWRlbnRpZmllciA9IGdldEluZGV4QnlJZGVudGlmaWVyKGlkZW50aWZpZXIpO1xuICAgIHZhciBvYmogPSB7XG4gICAgICBjc3M6IGl0ZW1bMV0sXG4gICAgICBtZWRpYTogaXRlbVsyXSxcbiAgICAgIHNvdXJjZU1hcDogaXRlbVszXSxcbiAgICAgIHN1cHBvcnRzOiBpdGVtWzRdLFxuICAgICAgbGF5ZXI6IGl0ZW1bNV1cbiAgICB9O1xuXG4gICAgaWYgKGluZGV4QnlJZGVudGlmaWVyICE9PSAtMSkge1xuICAgICAgc3R5bGVzSW5ET01baW5kZXhCeUlkZW50aWZpZXJdLnJlZmVyZW5jZXMrKztcbiAgICAgIHN0eWxlc0luRE9NW2luZGV4QnlJZGVudGlmaWVyXS51cGRhdGVyKG9iaik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB1cGRhdGVyID0gYWRkRWxlbWVudFN0eWxlKG9iaiwgb3B0aW9ucyk7XG4gICAgICBvcHRpb25zLmJ5SW5kZXggPSBpO1xuICAgICAgc3R5bGVzSW5ET00uc3BsaWNlKGksIDAsIHtcbiAgICAgICAgaWRlbnRpZmllcjogaWRlbnRpZmllcixcbiAgICAgICAgdXBkYXRlcjogdXBkYXRlcixcbiAgICAgICAgcmVmZXJlbmNlczogMVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWRlbnRpZmllcnMucHVzaChpZGVudGlmaWVyKTtcbiAgfVxuXG4gIHJldHVybiBpZGVudGlmaWVycztcbn1cblxuZnVuY3Rpb24gYWRkRWxlbWVudFN0eWxlKG9iaiwgb3B0aW9ucykge1xuICB2YXIgYXBpID0gb3B0aW9ucy5kb21BUEkob3B0aW9ucyk7XG4gIGFwaS51cGRhdGUob2JqKTtcblxuICB2YXIgdXBkYXRlciA9IGZ1bmN0aW9uIHVwZGF0ZXIobmV3T2JqKSB7XG4gICAgaWYgKG5ld09iaikge1xuICAgICAgaWYgKG5ld09iai5jc3MgPT09IG9iai5jc3MgJiYgbmV3T2JqLm1lZGlhID09PSBvYmoubWVkaWEgJiYgbmV3T2JqLnNvdXJjZU1hcCA9PT0gb2JqLnNvdXJjZU1hcCAmJiBuZXdPYmouc3VwcG9ydHMgPT09IG9iai5zdXBwb3J0cyAmJiBuZXdPYmoubGF5ZXIgPT09IG9iai5sYXllcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGFwaS51cGRhdGUob2JqID0gbmV3T2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXBpLnJlbW92ZSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gdXBkYXRlcjtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAobGlzdCwgb3B0aW9ucykge1xuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgbGlzdCA9IGxpc3QgfHwgW107XG4gIHZhciBsYXN0SWRlbnRpZmllcnMgPSBtb2R1bGVzVG9Eb20obGlzdCwgb3B0aW9ucyk7XG4gIHJldHVybiBmdW5jdGlvbiB1cGRhdGUobmV3TGlzdCkge1xuICAgIG5ld0xpc3QgPSBuZXdMaXN0IHx8IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0SWRlbnRpZmllcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBpZGVudGlmaWVyID0gbGFzdElkZW50aWZpZXJzW2ldO1xuICAgICAgdmFyIGluZGV4ID0gZ2V0SW5kZXhCeUlkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICBzdHlsZXNJbkRPTVtpbmRleF0ucmVmZXJlbmNlcy0tO1xuICAgIH1cblxuICAgIHZhciBuZXdMYXN0SWRlbnRpZmllcnMgPSBtb2R1bGVzVG9Eb20obmV3TGlzdCwgb3B0aW9ucyk7XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbGFzdElkZW50aWZpZXJzLmxlbmd0aDsgX2krKykge1xuICAgICAgdmFyIF9pZGVudGlmaWVyID0gbGFzdElkZW50aWZpZXJzW19pXTtcblxuICAgICAgdmFyIF9pbmRleCA9IGdldEluZGV4QnlJZGVudGlmaWVyKF9pZGVudGlmaWVyKTtcblxuICAgICAgaWYgKHN0eWxlc0luRE9NW19pbmRleF0ucmVmZXJlbmNlcyA9PT0gMCkge1xuICAgICAgICBzdHlsZXNJbkRPTVtfaW5kZXhdLnVwZGF0ZXIoKTtcblxuICAgICAgICBzdHlsZXNJbkRPTS5zcGxpY2UoX2luZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsYXN0SWRlbnRpZmllcnMgPSBuZXdMYXN0SWRlbnRpZmllcnM7XG4gIH07XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgbWVtbyA9IHt9O1xuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5cbmZ1bmN0aW9uIGdldFRhcmdldCh0YXJnZXQpIHtcbiAgaWYgKHR5cGVvZiBtZW1vW3RhcmdldF0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICB2YXIgc3R5bGVUYXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRhcmdldCk7IC8vIFNwZWNpYWwgY2FzZSB0byByZXR1cm4gaGVhZCBvZiBpZnJhbWUgaW5zdGVhZCBvZiBpZnJhbWUgaXRzZWxmXG5cbiAgICBpZiAod2luZG93LkhUTUxJRnJhbWVFbGVtZW50ICYmIHN0eWxlVGFyZ2V0IGluc3RhbmNlb2Ygd2luZG93LkhUTUxJRnJhbWVFbGVtZW50KSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBUaGlzIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFjY2VzcyB0byBpZnJhbWUgaXMgYmxvY2tlZFxuICAgICAgICAvLyBkdWUgdG8gY3Jvc3Mtb3JpZ2luIHJlc3RyaWN0aW9uc1xuICAgICAgICBzdHlsZVRhcmdldCA9IHN0eWxlVGFyZ2V0LmNvbnRlbnREb2N1bWVudC5oZWFkO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBpc3RhbmJ1bCBpZ25vcmUgbmV4dFxuICAgICAgICBzdHlsZVRhcmdldCA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbWVtb1t0YXJnZXRdID0gc3R5bGVUYXJnZXQ7XG4gIH1cblxuICByZXR1cm4gbWVtb1t0YXJnZXRdO1xufVxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5cblxuZnVuY3Rpb24gaW5zZXJ0QnlTZWxlY3RvcihpbnNlcnQsIHN0eWxlKSB7XG4gIHZhciB0YXJnZXQgPSBnZXRUYXJnZXQoaW5zZXJ0KTtcblxuICBpZiAoIXRhcmdldCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkbid0IGZpbmQgYSBzdHlsZSB0YXJnZXQuIFRoaXMgcHJvYmFibHkgbWVhbnMgdGhhdCB0aGUgdmFsdWUgZm9yIHRoZSAnaW5zZXJ0JyBwYXJhbWV0ZXIgaXMgaW52YWxpZC5cIik7XG4gIH1cblxuICB0YXJnZXQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGluc2VydEJ5U2VsZWN0b3I7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICAqL1xuZnVuY3Rpb24gaW5zZXJ0U3R5bGVFbGVtZW50KG9wdGlvbnMpIHtcbiAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7XG4gIG9wdGlvbnMuc2V0QXR0cmlidXRlcyhlbGVtZW50LCBvcHRpb25zLmF0dHJpYnV0ZXMpO1xuICBvcHRpb25zLmluc2VydChlbGVtZW50LCBvcHRpb25zLm9wdGlvbnMpO1xuICByZXR1cm4gZWxlbWVudDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBpbnNlcnRTdHlsZUVsZW1lbnQ7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICAqL1xuZnVuY3Rpb24gc2V0QXR0cmlidXRlc1dpdGhvdXRBdHRyaWJ1dGVzKHN0eWxlRWxlbWVudCkge1xuICB2YXIgbm9uY2UgPSB0eXBlb2YgX193ZWJwYWNrX25vbmNlX18gIT09IFwidW5kZWZpbmVkXCIgPyBfX3dlYnBhY2tfbm9uY2VfXyA6IG51bGw7XG5cbiAgaWYgKG5vbmNlKSB7XG4gICAgc3R5bGVFbGVtZW50LnNldEF0dHJpYnV0ZShcIm5vbmNlXCIsIG5vbmNlKTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHNldEF0dHJpYnV0ZXNXaXRob3V0QXR0cmlidXRlczsiLCJcInVzZSBzdHJpY3RcIjtcblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgICovXG5mdW5jdGlvbiBhcHBseShzdHlsZUVsZW1lbnQsIG9wdGlvbnMsIG9iaikge1xuICB2YXIgY3NzID0gXCJcIjtcblxuICBpZiAob2JqLnN1cHBvcnRzKSB7XG4gICAgY3NzICs9IFwiQHN1cHBvcnRzIChcIi5jb25jYXQob2JqLnN1cHBvcnRzLCBcIikge1wiKTtcbiAgfVxuXG4gIGlmIChvYmoubWVkaWEpIHtcbiAgICBjc3MgKz0gXCJAbWVkaWEgXCIuY29uY2F0KG9iai5tZWRpYSwgXCIge1wiKTtcbiAgfVxuXG4gIHZhciBuZWVkTGF5ZXIgPSB0eXBlb2Ygb2JqLmxheWVyICE9PSBcInVuZGVmaW5lZFwiO1xuXG4gIGlmIChuZWVkTGF5ZXIpIHtcbiAgICBjc3MgKz0gXCJAbGF5ZXJcIi5jb25jYXQob2JqLmxheWVyLmxlbmd0aCA+IDAgPyBcIiBcIi5jb25jYXQob2JqLmxheWVyKSA6IFwiXCIsIFwiIHtcIik7XG4gIH1cblxuICBjc3MgKz0gb2JqLmNzcztcblxuICBpZiAobmVlZExheWVyKSB7XG4gICAgY3NzICs9IFwifVwiO1xuICB9XG5cbiAgaWYgKG9iai5tZWRpYSkge1xuICAgIGNzcyArPSBcIn1cIjtcbiAgfVxuXG4gIGlmIChvYmouc3VwcG9ydHMpIHtcbiAgICBjc3MgKz0gXCJ9XCI7XG4gIH1cblxuICB2YXIgc291cmNlTWFwID0gb2JqLnNvdXJjZU1hcDtcblxuICBpZiAoc291cmNlTWFwICYmIHR5cGVvZiBidG9hICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgY3NzICs9IFwiXFxuLyojIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxcIi5jb25jYXQoYnRvYSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkoc291cmNlTWFwKSkpKSwgXCIgKi9cIik7XG4gIH0gLy8gRm9yIG9sZCBJRVxuXG4gIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAgKi9cblxuXG4gIG9wdGlvbnMuc3R5bGVUYWdUcmFuc2Zvcm0oY3NzLCBzdHlsZUVsZW1lbnQsIG9wdGlvbnMub3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZVN0eWxlRWxlbWVudChzdHlsZUVsZW1lbnQpIHtcbiAgLy8gaXN0YW5idWwgaWdub3JlIGlmXG4gIGlmIChzdHlsZUVsZW1lbnQucGFyZW50Tm9kZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHN0eWxlRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHN0eWxlRWxlbWVudCk7XG59XG4vKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAgKi9cblxuXG5mdW5jdGlvbiBkb21BUEkob3B0aW9ucykge1xuICB2YXIgc3R5bGVFbGVtZW50ID0gb3B0aW9ucy5pbnNlcnRTdHlsZUVsZW1lbnQob3B0aW9ucyk7XG4gIHJldHVybiB7XG4gICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUob2JqKSB7XG4gICAgICBhcHBseShzdHlsZUVsZW1lbnQsIG9wdGlvbnMsIG9iaik7XG4gICAgfSxcbiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSgpIHtcbiAgICAgIHJlbW92ZVN0eWxlRWxlbWVudChzdHlsZUVsZW1lbnQpO1xuICAgIH1cbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBkb21BUEk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICAqL1xuZnVuY3Rpb24gc3R5bGVUYWdUcmFuc2Zvcm0oY3NzLCBzdHlsZUVsZW1lbnQpIHtcbiAgaWYgKHN0eWxlRWxlbWVudC5zdHlsZVNoZWV0KSB7XG4gICAgc3R5bGVFbGVtZW50LnN0eWxlU2hlZXQuY3NzVGV4dCA9IGNzcztcbiAgfSBlbHNlIHtcbiAgICB3aGlsZSAoc3R5bGVFbGVtZW50LmZpcnN0Q2hpbGQpIHtcbiAgICAgIHN0eWxlRWxlbWVudC5yZW1vdmVDaGlsZChzdHlsZUVsZW1lbnQuZmlyc3RDaGlsZCk7XG4gICAgfVxuXG4gICAgc3R5bGVFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gc3R5bGVUYWdUcmFuc2Zvcm07IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHRpZDogbW9kdWxlSWQsXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwidmFyIHNjcmlwdFVybDtcbmlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLmcuaW1wb3J0U2NyaXB0cykgc2NyaXB0VXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmxvY2F0aW9uICsgXCJcIjtcbnZhciBkb2N1bWVudCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5kb2N1bWVudDtcbmlmICghc2NyaXB0VXJsICYmIGRvY3VtZW50KSB7XG5cdGlmIChkb2N1bWVudC5jdXJyZW50U2NyaXB0KVxuXHRcdHNjcmlwdFVybCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjXG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkgc2NyaXB0VXJsID0gc2NyaXB0c1tzY3JpcHRzLmxlbmd0aCAtIDFdLnNyY1xuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybDsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm5jID0gdW5kZWZpbmVkOyIsIlxuICAgICAgaW1wb3J0IEFQSSBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luamVjdFN0eWxlc0ludG9TdHlsZVRhZy5qc1wiO1xuICAgICAgaW1wb3J0IGRvbUFQSSBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlRG9tQVBJLmpzXCI7XG4gICAgICBpbXBvcnQgaW5zZXJ0Rm4gZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRCeVNlbGVjdG9yLmpzXCI7XG4gICAgICBpbXBvcnQgc2V0QXR0cmlidXRlcyBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3NldEF0dHJpYnV0ZXNXaXRob3V0QXR0cmlidXRlcy5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydFN0eWxlRWxlbWVudCBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luc2VydFN0eWxlRWxlbWVudC5qc1wiO1xuICAgICAgaW1wb3J0IHN0eWxlVGFnVHJhbnNmb3JtRm4gZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZVRhZ1RyYW5zZm9ybS5qc1wiO1xuICAgICAgaW1wb3J0IGNvbnRlbnQsICogYXMgbmFtZWRFeHBvcnQgZnJvbSBcIiEhLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanMhLi9tYWluTGF5b3V0LmNzc1wiO1xuICAgICAgXG4gICAgICBcblxudmFyIG9wdGlvbnMgPSB7fTtcblxub3B0aW9ucy5zdHlsZVRhZ1RyYW5zZm9ybSA9IHN0eWxlVGFnVHJhbnNmb3JtRm47XG5vcHRpb25zLnNldEF0dHJpYnV0ZXMgPSBzZXRBdHRyaWJ1dGVzO1xuXG4gICAgICBvcHRpb25zLmluc2VydCA9IGluc2VydEZuLmJpbmQobnVsbCwgXCJoZWFkXCIpO1xuICAgIFxub3B0aW9ucy5kb21BUEkgPSBkb21BUEk7XG5vcHRpb25zLmluc2VydFN0eWxlRWxlbWVudCA9IGluc2VydFN0eWxlRWxlbWVudDtcblxudmFyIHVwZGF0ZSA9IEFQSShjb250ZW50LCBvcHRpb25zKTtcblxuXG5cbmV4cG9ydCAqIGZyb20gXCIhIS4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vbWFpbkxheW91dC5jc3NcIjtcbiAgICAgICBleHBvcnQgZGVmYXVsdCBjb250ZW50ICYmIGNvbnRlbnQubG9jYWxzID8gY29udGVudC5sb2NhbHMgOiB1bmRlZmluZWQ7XG4iLCJcbiAgICAgIGltcG9ydCBBUEkgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbmplY3RTdHlsZXNJbnRvU3R5bGVUYWcuanNcIjtcbiAgICAgIGltcG9ydCBkb21BUEkgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZURvbUFQSS5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydEZuIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5zZXJ0QnlTZWxlY3Rvci5qc1wiO1xuICAgICAgaW1wb3J0IHNldEF0dHJpYnV0ZXMgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zZXRBdHRyaWJ1dGVzV2l0aG91dEF0dHJpYnV0ZXMuanNcIjtcbiAgICAgIGltcG9ydCBpbnNlcnRTdHlsZUVsZW1lbnQgZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRTdHlsZUVsZW1lbnQuanNcIjtcbiAgICAgIGltcG9ydCBzdHlsZVRhZ1RyYW5zZm9ybUZuIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVUYWdUcmFuc2Zvcm0uanNcIjtcbiAgICAgIGltcG9ydCBjb250ZW50LCAqIGFzIG5hbWVkRXhwb3J0IGZyb20gXCIhIS4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vaGVhZGVyLmNzc1wiO1xuICAgICAgXG4gICAgICBcblxudmFyIG9wdGlvbnMgPSB7fTtcblxub3B0aW9ucy5zdHlsZVRhZ1RyYW5zZm9ybSA9IHN0eWxlVGFnVHJhbnNmb3JtRm47XG5vcHRpb25zLnNldEF0dHJpYnV0ZXMgPSBzZXRBdHRyaWJ1dGVzO1xuXG4gICAgICBvcHRpb25zLmluc2VydCA9IGluc2VydEZuLmJpbmQobnVsbCwgXCJoZWFkXCIpO1xuICAgIFxub3B0aW9ucy5kb21BUEkgPSBkb21BUEk7XG5vcHRpb25zLmluc2VydFN0eWxlRWxlbWVudCA9IGluc2VydFN0eWxlRWxlbWVudDtcblxudmFyIHVwZGF0ZSA9IEFQSShjb250ZW50LCBvcHRpb25zKTtcblxuXG5cbmV4cG9ydCAqIGZyb20gXCIhIS4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vaGVhZGVyLmNzc1wiO1xuICAgICAgIGV4cG9ydCBkZWZhdWx0IGNvbnRlbnQgJiYgY29udGVudC5sb2NhbHMgPyBjb250ZW50LmxvY2FscyA6IHVuZGVmaW5lZDtcbiIsIlxuICAgICAgaW1wb3J0IEFQSSBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luamVjdFN0eWxlc0ludG9TdHlsZVRhZy5qc1wiO1xuICAgICAgaW1wb3J0IGRvbUFQSSBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlRG9tQVBJLmpzXCI7XG4gICAgICBpbXBvcnQgaW5zZXJ0Rm4gZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9pbnNlcnRCeVNlbGVjdG9yLmpzXCI7XG4gICAgICBpbXBvcnQgc2V0QXR0cmlidXRlcyBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3NldEF0dHJpYnV0ZXNXaXRob3V0QXR0cmlidXRlcy5qc1wiO1xuICAgICAgaW1wb3J0IGluc2VydFN0eWxlRWxlbWVudCBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luc2VydFN0eWxlRWxlbWVudC5qc1wiO1xuICAgICAgaW1wb3J0IHN0eWxlVGFnVHJhbnNmb3JtRm4gZnJvbSBcIiEuLi8uLi9ub2RlX21vZHVsZXMvc3R5bGUtbG9hZGVyL2Rpc3QvcnVudGltZS9zdHlsZVRhZ1RyYW5zZm9ybS5qc1wiO1xuICAgICAgaW1wb3J0IGNvbnRlbnQsICogYXMgbmFtZWRFeHBvcnQgZnJvbSBcIiEhLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanMhLi9uYXYuY3NzXCI7XG4gICAgICBcbiAgICAgIFxuXG52YXIgb3B0aW9ucyA9IHt9O1xuXG5vcHRpb25zLnN0eWxlVGFnVHJhbnNmb3JtID0gc3R5bGVUYWdUcmFuc2Zvcm1Gbjtcbm9wdGlvbnMuc2V0QXR0cmlidXRlcyA9IHNldEF0dHJpYnV0ZXM7XG5cbiAgICAgIG9wdGlvbnMuaW5zZXJ0ID0gaW5zZXJ0Rm4uYmluZChudWxsLCBcImhlYWRcIik7XG4gICAgXG5vcHRpb25zLmRvbUFQSSA9IGRvbUFQSTtcbm9wdGlvbnMuaW5zZXJ0U3R5bGVFbGVtZW50ID0gaW5zZXJ0U3R5bGVFbGVtZW50O1xuXG52YXIgdXBkYXRlID0gQVBJKGNvbnRlbnQsIG9wdGlvbnMpO1xuXG5cblxuZXhwb3J0ICogZnJvbSBcIiEhLi4vLi4vbm9kZV9tb2R1bGVzL2Nzcy1sb2FkZXIvZGlzdC9janMuanMhLi9uYXYuY3NzXCI7XG4gICAgICAgZXhwb3J0IGRlZmF1bHQgY29udGVudCAmJiBjb250ZW50LmxvY2FscyA/IGNvbnRlbnQubG9jYWxzIDogdW5kZWZpbmVkO1xuIiwiXG4gICAgICBpbXBvcnQgQVBJIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzXCI7XG4gICAgICBpbXBvcnQgZG9tQVBJIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVEb21BUEkuanNcIjtcbiAgICAgIGltcG9ydCBpbnNlcnRGbiBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luc2VydEJ5U2VsZWN0b3IuanNcIjtcbiAgICAgIGltcG9ydCBzZXRBdHRyaWJ1dGVzIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc2V0QXR0cmlidXRlc1dpdGhvdXRBdHRyaWJ1dGVzLmpzXCI7XG4gICAgICBpbXBvcnQgaW5zZXJ0U3R5bGVFbGVtZW50IGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5zZXJ0U3R5bGVFbGVtZW50LmpzXCI7XG4gICAgICBpbXBvcnQgc3R5bGVUYWdUcmFuc2Zvcm1GbiBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlVGFnVHJhbnNmb3JtLmpzXCI7XG4gICAgICBpbXBvcnQgY29udGVudCwgKiBhcyBuYW1lZEV4cG9ydCBmcm9tIFwiISEuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL3Rhc2tzLmNzc1wiO1xuICAgICAgXG4gICAgICBcblxudmFyIG9wdGlvbnMgPSB7fTtcblxub3B0aW9ucy5zdHlsZVRhZ1RyYW5zZm9ybSA9IHN0eWxlVGFnVHJhbnNmb3JtRm47XG5vcHRpb25zLnNldEF0dHJpYnV0ZXMgPSBzZXRBdHRyaWJ1dGVzO1xuXG4gICAgICBvcHRpb25zLmluc2VydCA9IGluc2VydEZuLmJpbmQobnVsbCwgXCJoZWFkXCIpO1xuICAgIFxub3B0aW9ucy5kb21BUEkgPSBkb21BUEk7XG5vcHRpb25zLmluc2VydFN0eWxlRWxlbWVudCA9IGluc2VydFN0eWxlRWxlbWVudDtcblxudmFyIHVwZGF0ZSA9IEFQSShjb250ZW50LCBvcHRpb25zKTtcblxuXG5cbmV4cG9ydCAqIGZyb20gXCIhIS4uLy4uL25vZGVfbW9kdWxlcy9jc3MtbG9hZGVyL2Rpc3QvY2pzLmpzIS4vdGFza3MuY3NzXCI7XG4gICAgICAgZXhwb3J0IGRlZmF1bHQgY29udGVudCAmJiBjb250ZW50LmxvY2FscyA/IGNvbnRlbnQubG9jYWxzIDogdW5kZWZpbmVkO1xuIiwiXG4gICAgICBpbXBvcnQgQVBJIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5qZWN0U3R5bGVzSW50b1N0eWxlVGFnLmpzXCI7XG4gICAgICBpbXBvcnQgZG9tQVBJIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc3R5bGVEb21BUEkuanNcIjtcbiAgICAgIGltcG9ydCBpbnNlcnRGbiBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL2luc2VydEJ5U2VsZWN0b3IuanNcIjtcbiAgICAgIGltcG9ydCBzZXRBdHRyaWJ1dGVzIGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvc2V0QXR0cmlidXRlc1dpdGhvdXRBdHRyaWJ1dGVzLmpzXCI7XG4gICAgICBpbXBvcnQgaW5zZXJ0U3R5bGVFbGVtZW50IGZyb20gXCIhLi4vLi4vbm9kZV9tb2R1bGVzL3N0eWxlLWxvYWRlci9kaXN0L3J1bnRpbWUvaW5zZXJ0U3R5bGVFbGVtZW50LmpzXCI7XG4gICAgICBpbXBvcnQgc3R5bGVUYWdUcmFuc2Zvcm1GbiBmcm9tIFwiIS4uLy4uL25vZGVfbW9kdWxlcy9zdHlsZS1sb2FkZXIvZGlzdC9ydW50aW1lL3N0eWxlVGFnVHJhbnNmb3JtLmpzXCI7XG4gICAgICBpbXBvcnQgY29udGVudCwgKiBhcyBuYW1lZEV4cG9ydCBmcm9tIFwiISEuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL2F1dC5jc3NcIjtcbiAgICAgIFxuICAgICAgXG5cbnZhciBvcHRpb25zID0ge307XG5cbm9wdGlvbnMuc3R5bGVUYWdUcmFuc2Zvcm0gPSBzdHlsZVRhZ1RyYW5zZm9ybUZuO1xub3B0aW9ucy5zZXRBdHRyaWJ1dGVzID0gc2V0QXR0cmlidXRlcztcblxuICAgICAgb3B0aW9ucy5pbnNlcnQgPSBpbnNlcnRGbi5iaW5kKG51bGwsIFwiaGVhZFwiKTtcbiAgICBcbm9wdGlvbnMuZG9tQVBJID0gZG9tQVBJO1xub3B0aW9ucy5pbnNlcnRTdHlsZUVsZW1lbnQgPSBpbnNlcnRTdHlsZUVsZW1lbnQ7XG5cbnZhciB1cGRhdGUgPSBBUEkoY29udGVudCwgb3B0aW9ucyk7XG5cblxuXG5leHBvcnQgKiBmcm9tIFwiISEuLi8uLi9ub2RlX21vZHVsZXMvY3NzLWxvYWRlci9kaXN0L2Nqcy5qcyEuL2F1dC5jc3NcIjtcbiAgICAgICBleHBvcnQgZGVmYXVsdCBjb250ZW50ICYmIGNvbnRlbnQubG9jYWxzID8gY29udGVudC5sb2NhbHMgOiB1bmRlZmluZWQ7XG4iLCIvKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQGZpbGVvdmVydmlldyBGaXJlYmFzZSBjb25zdGFudHMuICBTb21lIG9mIHRoZXNlIChAZGVmaW5lcykgY2FuIGJlIG92ZXJyaWRkZW4gYXQgY29tcGlsZS10aW1lLlxyXG4gKi9cclxuY29uc3QgQ09OU1RBTlRTID0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoaXMgaXMgdGhlIGNsaWVudCBOb2RlLmpzIFNESy5cclxuICAgICAqL1xyXG4gICAgTk9ERV9DTElFTlQ6IGZhbHNlLFxyXG4gICAgLyoqXHJcbiAgICAgKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoaXMgaXMgdGhlIEFkbWluIE5vZGUuanMgU0RLLlxyXG4gICAgICovXHJcbiAgICBOT0RFX0FETUlOOiBmYWxzZSxcclxuICAgIC8qKlxyXG4gICAgICogRmlyZWJhc2UgU0RLIFZlcnNpb25cclxuICAgICAqL1xyXG4gICAgU0RLX1ZFUlNJT046ICcke0pTQ09SRV9WRVJTSU9OfSdcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRocm93cyBhbiBlcnJvciBpZiB0aGUgcHJvdmlkZWQgYXNzZXJ0aW9uIGlzIGZhbHN5XHJcbiAqL1xyXG5jb25zdCBhc3NlcnQgPSBmdW5jdGlvbiAoYXNzZXJ0aW9uLCBtZXNzYWdlKSB7XHJcbiAgICBpZiAoIWFzc2VydGlvbikge1xyXG4gICAgICAgIHRocm93IGFzc2VydGlvbkVycm9yKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICogUmV0dXJucyBhbiBFcnJvciBvYmplY3Qgc3VpdGFibGUgZm9yIHRocm93aW5nLlxyXG4gKi9cclxuY29uc3QgYXNzZXJ0aW9uRXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgcmV0dXJuIG5ldyBFcnJvcignRmlyZWJhc2UgRGF0YWJhc2UgKCcgK1xyXG4gICAgICAgIENPTlNUQU5UUy5TREtfVkVSU0lPTiArXHJcbiAgICAgICAgJykgSU5URVJOQUwgQVNTRVJUIEZBSUxFRDogJyArXHJcbiAgICAgICAgbWVzc2FnZSk7XHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IHN0cmluZ1RvQnl0ZUFycmF5JDEgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICAvLyBUT0RPKHVzZXIpOiBVc2UgbmF0aXZlIGltcGxlbWVudGF0aW9ucyBpZi93aGVuIGF2YWlsYWJsZVxyXG4gICAgY29uc3Qgb3V0ID0gW107XHJcbiAgICBsZXQgcCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGxldCBjID0gc3RyLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgaWYgKGMgPCAxMjgpIHtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSBjO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjIDwgMjA0OCkge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDYpIHwgMTkyO1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICgoYyAmIDB4ZmMwMCkgPT09IDB4ZDgwMCAmJlxyXG4gICAgICAgICAgICBpICsgMSA8IHN0ci5sZW5ndGggJiZcclxuICAgICAgICAgICAgKHN0ci5jaGFyQ29kZUF0KGkgKyAxKSAmIDB4ZmMwMCkgPT09IDB4ZGMwMCkge1xyXG4gICAgICAgICAgICAvLyBTdXJyb2dhdGUgUGFpclxyXG4gICAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAmIDB4MDNmZikgPDwgMTApICsgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAweDAzZmYpO1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDE4KSB8IDI0MDtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4O1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gMTIpIHwgMjI0O1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3V0O1xyXG59O1xyXG4vKipcclxuICogVHVybnMgYW4gYXJyYXkgb2YgbnVtYmVycyBpbnRvIHRoZSBzdHJpbmcgZ2l2ZW4gYnkgdGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlXHJcbiAqIGNoYXJhY3RlcnMgdG8gd2hpY2ggdGhlIG51bWJlcnMgY29ycmVzcG9uZC5cclxuICogQHBhcmFtIGJ5dGVzIEFycmF5IG9mIG51bWJlcnMgcmVwcmVzZW50aW5nIGNoYXJhY3RlcnMuXHJcbiAqIEByZXR1cm4gU3RyaW5naWZpY2F0aW9uIG9mIHRoZSBhcnJheS5cclxuICovXHJcbmNvbnN0IGJ5dGVBcnJheVRvU3RyaW5nID0gZnVuY3Rpb24gKGJ5dGVzKSB7XHJcbiAgICAvLyBUT0RPKHVzZXIpOiBVc2UgbmF0aXZlIGltcGxlbWVudGF0aW9ucyBpZi93aGVuIGF2YWlsYWJsZVxyXG4gICAgY29uc3Qgb3V0ID0gW107XHJcbiAgICBsZXQgcG9zID0gMCwgYyA9IDA7XHJcbiAgICB3aGlsZSAocG9zIDwgYnl0ZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgY29uc3QgYzEgPSBieXRlc1twb3MrK107XHJcbiAgICAgICAgaWYgKGMxIDwgMTI4KSB7XHJcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGMxID4gMTkxICYmIGMxIDwgMjI0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGMyID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgICAgICBvdXRbYysrXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjMSAmIDMxKSA8PCA2KSB8IChjMiAmIDYzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGMxID4gMjM5ICYmIGMxIDwgMzY1KSB7XHJcbiAgICAgICAgICAgIC8vIFN1cnJvZ2F0ZSBQYWlyXHJcbiAgICAgICAgICAgIGNvbnN0IGMyID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgY29uc3QgYzQgPSBieXRlc1twb3MrK107XHJcbiAgICAgICAgICAgIGNvbnN0IHUgPSAoKChjMSAmIDcpIDw8IDE4KSB8ICgoYzIgJiA2MykgPDwgMTIpIHwgKChjMyAmIDYzKSA8PCA2KSB8IChjNCAmIDYzKSkgLVxyXG4gICAgICAgICAgICAgICAgMHgxMDAwMDtcclxuICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZDgwMCArICh1ID4+IDEwKSk7XHJcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGRjMDAgKyAodSAmIDEwMjMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGMyID0gYnl0ZXNbcG9zKytdO1xyXG4gICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTtcclxuICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYzEgJiAxNSkgPDwgMTIpIHwgKChjMiAmIDYzKSA8PCA2KSB8IChjMyAmIDYzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dC5qb2luKCcnKTtcclxufTtcclxuLy8gV2UgZGVmaW5lIGl0IGFzIGFuIG9iamVjdCBsaXRlcmFsIGluc3RlYWQgb2YgYSBjbGFzcyBiZWNhdXNlIGEgY2xhc3MgY29tcGlsZWQgZG93biB0byBlczUgY2FuJ3RcclxuLy8gYmUgdHJlZXNoYWtlZC4gaHR0cHM6Ly9naXRodWIuY29tL3JvbGx1cC9yb2xsdXAvaXNzdWVzLzE2OTFcclxuLy8gU3RhdGljIGxvb2t1cCBtYXBzLCBsYXppbHkgcG9wdWxhdGVkIGJ5IGluaXRfKClcclxuY29uc3QgYmFzZTY0ID0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBNYXBzIGJ5dGVzIHRvIGNoYXJhY3RlcnMuXHJcbiAgICAgKi9cclxuICAgIGJ5dGVUb0NoYXJNYXBfOiBudWxsLFxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXBzIGNoYXJhY3RlcnMgdG8gYnl0ZXMuXHJcbiAgICAgKi9cclxuICAgIGNoYXJUb0J5dGVNYXBfOiBudWxsLFxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXBzIGJ5dGVzIHRvIHdlYnNhZmUgY2hhcmFjdGVycy5cclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKi9cclxuICAgIGJ5dGVUb0NoYXJNYXBXZWJTYWZlXzogbnVsbCxcclxuICAgIC8qKlxyXG4gICAgICogTWFwcyB3ZWJzYWZlIGNoYXJhY3RlcnMgdG8gYnl0ZXMuXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBjaGFyVG9CeXRlTWFwV2ViU2FmZV86IG51bGwsXHJcbiAgICAvKipcclxuICAgICAqIE91ciBkZWZhdWx0IGFscGhhYmV0LCBzaGFyZWQgYmV0d2VlblxyXG4gICAgICogRU5DT0RFRF9WQUxTIGFuZCBFTkNPREVEX1ZBTFNfV0VCU0FGRVxyXG4gICAgICovXHJcbiAgICBFTkNPREVEX1ZBTFNfQkFTRTogJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJyArICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicgKyAnMDEyMzQ1Njc4OScsXHJcbiAgICAvKipcclxuICAgICAqIE91ciBkZWZhdWx0IGFscGhhYmV0LiBWYWx1ZSA2NCAoPSkgaXMgc3BlY2lhbDsgaXQgbWVhbnMgXCJub3RoaW5nLlwiXHJcbiAgICAgKi9cclxuICAgIGdldCBFTkNPREVEX1ZBTFMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuRU5DT0RFRF9WQUxTX0JBU0UgKyAnKy89JztcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIE91ciB3ZWJzYWZlIGFscGhhYmV0LlxyXG4gICAgICovXHJcbiAgICBnZXQgRU5DT0RFRF9WQUxTX1dFQlNBRkUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuRU5DT0RFRF9WQUxTX0JBU0UgKyAnLV8uJztcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIFdoZXRoZXIgdGhpcyBicm93c2VyIHN1cHBvcnRzIHRoZSBhdG9iIGFuZCBidG9hIGZ1bmN0aW9ucy4gVGhpcyBleHRlbnNpb25cclxuICAgICAqIHN0YXJ0ZWQgYXQgTW96aWxsYSBidXQgaXMgbm93IGltcGxlbWVudGVkIGJ5IG1hbnkgYnJvd3NlcnMuIFdlIHVzZSB0aGVcclxuICAgICAqIEFTU1VNRV8qIHZhcmlhYmxlcyB0byBhdm9pZCBwdWxsaW5nIGluIHRoZSBmdWxsIHVzZXJhZ2VudCBkZXRlY3Rpb24gbGlicmFyeVxyXG4gICAgICogYnV0IHN0aWxsIGFsbG93aW5nIHRoZSBzdGFuZGFyZCBwZXItYnJvd3NlciBjb21waWxhdGlvbnMuXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBIQVNfTkFUSVZFX1NVUFBPUlQ6IHR5cGVvZiBhdG9iID09PSAnZnVuY3Rpb24nLFxyXG4gICAgLyoqXHJcbiAgICAgKiBCYXNlNjQtZW5jb2RlIGFuIGFycmF5IG9mIGJ5dGVzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnB1dCBBbiBhcnJheSBvZiBieXRlcyAobnVtYmVycyB3aXRoXHJcbiAgICAgKiAgICAgdmFsdWUgaW4gWzAsIDI1NV0pIHRvIGVuY29kZS5cclxuICAgICAqIEBwYXJhbSB3ZWJTYWZlIEJvb2xlYW4gaW5kaWNhdGluZyB3ZSBzaG91bGQgdXNlIHRoZVxyXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxyXG4gICAgICogQHJldHVybiBUaGUgYmFzZTY0IGVuY29kZWQgc3RyaW5nLlxyXG4gICAgICovXHJcbiAgICBlbmNvZGVCeXRlQXJyYXkoaW5wdXQsIHdlYlNhZmUpIHtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaW5wdXQpKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdlbmNvZGVCeXRlQXJyYXkgdGFrZXMgYW4gYXJyYXkgYXMgYSBwYXJhbWV0ZXInKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pbml0XygpO1xyXG4gICAgICAgIGNvbnN0IGJ5dGVUb0NoYXJNYXAgPSB3ZWJTYWZlXHJcbiAgICAgICAgICAgID8gdGhpcy5ieXRlVG9DaGFyTWFwV2ViU2FmZV9cclxuICAgICAgICAgICAgOiB0aGlzLmJ5dGVUb0NoYXJNYXBfO1xyXG4gICAgICAgIGNvbnN0IG91dHB1dCA9IFtdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpICs9IDMpIHtcclxuICAgICAgICAgICAgY29uc3QgYnl0ZTEgPSBpbnB1dFtpXTtcclxuICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGUyID0gaSArIDEgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUyID0gaGF2ZUJ5dGUyID8gaW5wdXRbaSArIDFdIDogMDtcclxuICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGUzID0gaSArIDIgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUzID0gaGF2ZUJ5dGUzID8gaW5wdXRbaSArIDJdIDogMDtcclxuICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTEgPSBieXRlMSA+PiAyO1xyXG4gICAgICAgICAgICBjb25zdCBvdXRCeXRlMiA9ICgoYnl0ZTEgJiAweDAzKSA8PCA0KSB8IChieXRlMiA+PiA0KTtcclxuICAgICAgICAgICAgbGV0IG91dEJ5dGUzID0gKChieXRlMiAmIDB4MGYpIDw8IDIpIHwgKGJ5dGUzID4+IDYpO1xyXG4gICAgICAgICAgICBsZXQgb3V0Qnl0ZTQgPSBieXRlMyAmIDB4M2Y7XHJcbiAgICAgICAgICAgIGlmICghaGF2ZUJ5dGUzKSB7XHJcbiAgICAgICAgICAgICAgICBvdXRCeXRlNCA9IDY0O1xyXG4gICAgICAgICAgICAgICAgaWYgKCFoYXZlQnl0ZTIpIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRCeXRlMyA9IDY0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG91dHB1dC5wdXNoKGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTFdLCBieXRlVG9DaGFyTWFwW291dEJ5dGUyXSwgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlM10sIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG91dHB1dC5qb2luKCcnKTtcclxuICAgIH0sXHJcbiAgICAvKipcclxuICAgICAqIEJhc2U2NC1lbmNvZGUgYSBzdHJpbmcuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlucHV0IEEgc3RyaW5nIHRvIGVuY29kZS5cclxuICAgICAqIEBwYXJhbSB3ZWJTYWZlIElmIHRydWUsIHdlIHNob3VsZCB1c2UgdGhlXHJcbiAgICAgKiAgICAgYWx0ZXJuYXRpdmUgYWxwaGFiZXQuXHJcbiAgICAgKiBAcmV0dXJuIFRoZSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcuXHJcbiAgICAgKi9cclxuICAgIGVuY29kZVN0cmluZyhpbnB1dCwgd2ViU2FmZSkge1xyXG4gICAgICAgIC8vIFNob3J0Y3V0IGZvciBNb3ppbGxhIGJyb3dzZXJzIHRoYXQgaW1wbGVtZW50XHJcbiAgICAgICAgLy8gYSBuYXRpdmUgYmFzZTY0IGVuY29kZXIgaW4gdGhlIGZvcm0gb2YgXCJidG9hL2F0b2JcIlxyXG4gICAgICAgIGlmICh0aGlzLkhBU19OQVRJVkVfU1VQUE9SVCAmJiAhd2ViU2FmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYnRvYShpbnB1dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmVuY29kZUJ5dGVBcnJheShzdHJpbmdUb0J5dGVBcnJheSQxKGlucHV0KSwgd2ViU2FmZSk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBCYXNlNjQtZGVjb2RlIGEgc3RyaW5nLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnB1dCB0byBkZWNvZGUuXHJcbiAgICAgKiBAcGFyYW0gd2ViU2FmZSBUcnVlIGlmIHdlIHNob3VsZCB1c2UgdGhlXHJcbiAgICAgKiAgICAgYWx0ZXJuYXRpdmUgYWxwaGFiZXQuXHJcbiAgICAgKiBAcmV0dXJuIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuXHJcbiAgICAgKi9cclxuICAgIGRlY29kZVN0cmluZyhpbnB1dCwgd2ViU2FmZSkge1xyXG4gICAgICAgIC8vIFNob3J0Y3V0IGZvciBNb3ppbGxhIGJyb3dzZXJzIHRoYXQgaW1wbGVtZW50XHJcbiAgICAgICAgLy8gYSBuYXRpdmUgYmFzZTY0IGVuY29kZXIgaW4gdGhlIGZvcm0gb2YgXCJidG9hL2F0b2JcIlxyXG4gICAgICAgIGlmICh0aGlzLkhBU19OQVRJVkVfU1VQUE9SVCAmJiAhd2ViU2FmZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYXRvYihpbnB1dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBieXRlQXJyYXlUb1N0cmluZyh0aGlzLmRlY29kZVN0cmluZ1RvQnl0ZUFycmF5KGlucHV0LCB3ZWJTYWZlKSk7XHJcbiAgICB9LFxyXG4gICAgLyoqXHJcbiAgICAgKiBCYXNlNjQtZGVjb2RlIGEgc3RyaW5nLlxyXG4gICAgICpcclxuICAgICAqIEluIGJhc2UtNjQgZGVjb2RpbmcsIGdyb3VwcyBvZiBmb3VyIGNoYXJhY3RlcnMgYXJlIGNvbnZlcnRlZCBpbnRvIHRocmVlXHJcbiAgICAgKiBieXRlcy4gIElmIHRoZSBlbmNvZGVyIGRpZCBub3QgYXBwbHkgcGFkZGluZywgdGhlIGlucHV0IGxlbmd0aCBtYXkgbm90XHJcbiAgICAgKiBiZSBhIG11bHRpcGxlIG9mIDQuXHJcbiAgICAgKlxyXG4gICAgICogSW4gdGhpcyBjYXNlLCB0aGUgbGFzdCBncm91cCB3aWxsIGhhdmUgZmV3ZXIgdGhhbiA0IGNoYXJhY3RlcnMsIGFuZFxyXG4gICAgICogcGFkZGluZyB3aWxsIGJlIGluZmVycmVkLiAgSWYgdGhlIGdyb3VwIGhhcyBvbmUgb3IgdHdvIGNoYXJhY3RlcnMsIGl0IGRlY29kZXNcclxuICAgICAqIHRvIG9uZSBieXRlLiAgSWYgdGhlIGdyb3VwIGhhcyB0aHJlZSBjaGFyYWN0ZXJzLCBpdCBkZWNvZGVzIHRvIHR3byBieXRlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaW5wdXQgSW5wdXQgdG8gZGVjb2RlLlxyXG4gICAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZSB3ZWItc2FmZSBhbHBoYWJldC5cclxuICAgICAqIEByZXR1cm4gYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSBkZWNvZGVkIHZhbHVlLlxyXG4gICAgICovXHJcbiAgICBkZWNvZGVTdHJpbmdUb0J5dGVBcnJheShpbnB1dCwgd2ViU2FmZSkge1xyXG4gICAgICAgIHRoaXMuaW5pdF8oKTtcclxuICAgICAgICBjb25zdCBjaGFyVG9CeXRlTWFwID0gd2ViU2FmZVxyXG4gICAgICAgICAgICA/IHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfXHJcbiAgICAgICAgICAgIDogdGhpcy5jaGFyVG9CeXRlTWFwXztcclxuICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDspIHtcclxuICAgICAgICAgICAgY29uc3QgYnl0ZTEgPSBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKyspXTtcclxuICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGUyID0gaSA8IGlucHV0Lmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgYnl0ZTIgPSBoYXZlQnl0ZTIgPyBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKV0gOiAwO1xyXG4gICAgICAgICAgICArK2k7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgPCBpbnB1dC5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUzID0gaGF2ZUJ5dGUzID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogNjQ7XHJcbiAgICAgICAgICAgICsraTtcclxuICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGU0ID0gaSA8IGlucHV0Lmxlbmd0aDtcclxuICAgICAgICAgICAgY29uc3QgYnl0ZTQgPSBoYXZlQnl0ZTQgPyBjaGFyVG9CeXRlTWFwW2lucHV0LmNoYXJBdChpKV0gOiA2NDtcclxuICAgICAgICAgICAgKytpO1xyXG4gICAgICAgICAgICBpZiAoYnl0ZTEgPT0gbnVsbCB8fCBieXRlMiA9PSBudWxsIHx8IGJ5dGUzID09IG51bGwgfHwgYnl0ZTQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBvdXRCeXRlMSA9IChieXRlMSA8PCAyKSB8IChieXRlMiA+PiA0KTtcclxuICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTEpO1xyXG4gICAgICAgICAgICBpZiAoYnl0ZTMgIT09IDY0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdXRCeXRlMiA9ICgoYnl0ZTIgPDwgNCkgJiAweGYwKSB8IChieXRlMyA+PiAyKTtcclxuICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUyKTtcclxuICAgICAgICAgICAgICAgIGlmIChieXRlNCAhPT0gNjQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRCeXRlMyA9ICgoYnl0ZTMgPDwgNikgJiAweGMwKSB8IGJ5dGU0O1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKG91dEJ5dGUzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gb3V0cHV0O1xyXG4gICAgfSxcclxuICAgIC8qKlxyXG4gICAgICogTGF6eSBzdGF0aWMgaW5pdGlhbGl6YXRpb24gZnVuY3Rpb24uIENhbGxlZCBiZWZvcmVcclxuICAgICAqIGFjY2Vzc2luZyBhbnkgb2YgdGhlIHN0YXRpYyBtYXAgdmFyaWFibGVzLlxyXG4gICAgICogQHByaXZhdGVcclxuICAgICAqL1xyXG4gICAgaW5pdF8oKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmJ5dGVUb0NoYXJNYXBfKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcF8gPSB7fTtcclxuICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwXyA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlXyA9IHt9O1xyXG4gICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlXyA9IHt9O1xyXG4gICAgICAgICAgICAvLyBXZSB3YW50IHF1aWNrIG1hcHBpbmdzIGJhY2sgYW5kIGZvcnRoLCBzbyB3ZSBwcmVjb21wdXRlIHR3byBtYXBzLlxyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuRU5DT0RFRF9WQUxTLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBfW2ldID0gdGhpcy5FTkNPREVEX1ZBTFMuY2hhckF0KGkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwX1t0aGlzLmJ5dGVUb0NoYXJNYXBfW2ldXSA9IGk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBXZWJTYWZlX1tpXSA9IHRoaXMuRU5DT0RFRF9WQUxTX1dFQlNBRkUuY2hhckF0KGkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV9bdGhpcy5ieXRlVG9DaGFyTWFwV2ViU2FmZV9baV1dID0gaTtcclxuICAgICAgICAgICAgICAgIC8vIEJlIGZvcmdpdmluZyB3aGVuIGRlY29kaW5nIGFuZCBjb3JyZWN0bHkgZGVjb2RlIGJvdGggZW5jb2RpbmdzLlxyXG4gICAgICAgICAgICAgICAgaWYgKGkgPj0gdGhpcy5FTkNPREVEX1ZBTFNfQkFTRS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfW3RoaXMuRU5DT0RFRF9WQUxTX1dFQlNBRkUuY2hhckF0KGkpXSA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV9bdGhpcy5FTkNPREVEX1ZBTFMuY2hhckF0KGkpXSA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcbi8qKlxyXG4gKiBVUkwtc2FmZSBiYXNlNjQgZW5jb2RpbmdcclxuICovXHJcbmNvbnN0IGJhc2U2NEVuY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcclxuICAgIGNvbnN0IHV0ZjhCeXRlcyA9IHN0cmluZ1RvQnl0ZUFycmF5JDEoc3RyKTtcclxuICAgIHJldHVybiBiYXNlNjQuZW5jb2RlQnl0ZUFycmF5KHV0ZjhCeXRlcywgdHJ1ZSk7XHJcbn07XHJcbi8qKlxyXG4gKiBVUkwtc2FmZSBiYXNlNjQgZW5jb2RpbmcgKHdpdGhvdXQgXCIuXCIgcGFkZGluZyBpbiB0aGUgZW5kKS5cclxuICogZS5nLiBVc2VkIGluIEpTT04gV2ViIFRva2VuIChKV1QpIHBhcnRzLlxyXG4gKi9cclxuY29uc3QgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICAvLyBVc2UgYmFzZTY0dXJsIGVuY29kaW5nIGFuZCByZW1vdmUgcGFkZGluZyBpbiB0aGUgZW5kIChkb3QgY2hhcmFjdGVycykuXHJcbiAgICByZXR1cm4gYmFzZTY0RW5jb2RlKHN0cikucmVwbGFjZSgvXFwuL2csICcnKTtcclxufTtcclxuLyoqXHJcbiAqIFVSTC1zYWZlIGJhc2U2NCBkZWNvZGluZ1xyXG4gKlxyXG4gKiBOT1RFOiBETyBOT1QgdXNlIHRoZSBnbG9iYWwgYXRvYigpIGZ1bmN0aW9uIC0gaXQgZG9lcyBOT1Qgc3VwcG9ydCB0aGVcclxuICogYmFzZTY0VXJsIHZhcmlhbnQgZW5jb2RpbmcuXHJcbiAqXHJcbiAqIEBwYXJhbSBzdHIgVG8gYmUgZGVjb2RlZFxyXG4gKiBAcmV0dXJuIERlY29kZWQgcmVzdWx0LCBpZiBwb3NzaWJsZVxyXG4gKi9cclxuY29uc3QgYmFzZTY0RGVjb2RlID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICByZXR1cm4gYmFzZTY0LmRlY29kZVN0cmluZyhzdHIsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdiYXNlNjREZWNvZGUgZmFpbGVkOiAnLCBlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRG8gYSBkZWVwLWNvcHkgb2YgYmFzaWMgSmF2YVNjcmlwdCBPYmplY3RzIG9yIEFycmF5cy5cclxuICovXHJcbmZ1bmN0aW9uIGRlZXBDb3B5KHZhbHVlKSB7XHJcbiAgICByZXR1cm4gZGVlcEV4dGVuZCh1bmRlZmluZWQsIHZhbHVlKTtcclxufVxyXG4vKipcclxuICogQ29weSBwcm9wZXJ0aWVzIGZyb20gc291cmNlIHRvIHRhcmdldCAocmVjdXJzaXZlbHkgYWxsb3dzIGV4dGVuc2lvblxyXG4gKiBvZiBPYmplY3RzIGFuZCBBcnJheXMpLiAgU2NhbGFyIHZhbHVlcyBpbiB0aGUgdGFyZ2V0IGFyZSBvdmVyLXdyaXR0ZW4uXHJcbiAqIElmIHRhcmdldCBpcyB1bmRlZmluZWQsIGFuIG9iamVjdCBvZiB0aGUgYXBwcm9wcmlhdGUgdHlwZSB3aWxsIGJlIGNyZWF0ZWRcclxuICogKGFuZCByZXR1cm5lZCkuXHJcbiAqXHJcbiAqIFdlIHJlY3Vyc2l2ZWx5IGNvcHkgYWxsIGNoaWxkIHByb3BlcnRpZXMgb2YgcGxhaW4gT2JqZWN0cyBpbiB0aGUgc291cmNlLSBzb1xyXG4gKiB0aGF0IG5hbWVzcGFjZS0gbGlrZSBkaWN0aW9uYXJpZXMgYXJlIG1lcmdlZC5cclxuICpcclxuICogTm90ZSB0aGF0IHRoZSB0YXJnZXQgY2FuIGJlIGEgZnVuY3Rpb24sIGluIHdoaWNoIGNhc2UgdGhlIHByb3BlcnRpZXMgaW5cclxuICogdGhlIHNvdXJjZSBPYmplY3QgYXJlIGNvcGllZCBvbnRvIGl0IGFzIHN0YXRpYyBwcm9wZXJ0aWVzIG9mIHRoZSBGdW5jdGlvbi5cclxuICpcclxuICogTm90ZTogd2UgZG9uJ3QgbWVyZ2UgX19wcm90b19fIHRvIHByZXZlbnQgcHJvdG90eXBlIHBvbGx1dGlvblxyXG4gKi9cclxuZnVuY3Rpb24gZGVlcEV4dGVuZCh0YXJnZXQsIHNvdXJjZSkge1xyXG4gICAgaWYgKCEoc291cmNlIGluc3RhbmNlb2YgT2JqZWN0KSkge1xyXG4gICAgICAgIHJldHVybiBzb3VyY2U7XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKHNvdXJjZS5jb25zdHJ1Y3Rvcikge1xyXG4gICAgICAgIGNhc2UgRGF0ZTpcclxuICAgICAgICAgICAgLy8gVHJlYXQgRGF0ZXMgbGlrZSBzY2FsYXJzOyBpZiB0aGUgdGFyZ2V0IGRhdGUgb2JqZWN0IGhhZCBhbnkgY2hpbGRcclxuICAgICAgICAgICAgLy8gcHJvcGVydGllcyAtIHRoZXkgd2lsbCBiZSBsb3N0IVxyXG4gICAgICAgICAgICBjb25zdCBkYXRlVmFsdWUgPSBzb3VyY2U7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShkYXRlVmFsdWUuZ2V0VGltZSgpKTtcclxuICAgICAgICBjYXNlIE9iamVjdDpcclxuICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSB7fTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEFycmF5OlxyXG4gICAgICAgICAgICAvLyBBbHdheXMgY29weSB0aGUgYXJyYXkgc291cmNlIGFuZCBvdmVyd3JpdGUgdGhlIHRhcmdldC5cclxuICAgICAgICAgICAgdGFyZ2V0ID0gW107XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIC8vIE5vdCBhIHBsYWluIE9iamVjdCAtIHRyZWF0IGl0IGFzIGEgc2NhbGFyLlxyXG4gICAgICAgICAgICByZXR1cm4gc291cmNlO1xyXG4gICAgfVxyXG4gICAgZm9yIChjb25zdCBwcm9wIGluIHNvdXJjZSkge1xyXG4gICAgICAgIC8vIHVzZSBpc1ZhbGlkS2V5IHRvIGd1YXJkIGFnYWluc3QgcHJvdG90eXBlIHBvbGx1dGlvbi4gU2VlIGh0dHBzOi8vc255ay5pby92dWxuL1NOWUstSlMtTE9EQVNILTQ1MDIwMlxyXG4gICAgICAgIGlmICghc291cmNlLmhhc093blByb3BlcnR5KHByb3ApIHx8ICFpc1ZhbGlkS2V5KHByb3ApKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0YXJnZXRbcHJvcF0gPSBkZWVwRXh0ZW5kKHRhcmdldFtwcm9wXSwgc291cmNlW3Byb3BdKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0YXJnZXQ7XHJcbn1cclxuZnVuY3Rpb24gaXNWYWxpZEtleShrZXkpIHtcclxuICAgIHJldHVybiBrZXkgIT09ICdfX3Byb3RvX18nO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQb2x5ZmlsbCBmb3IgYGdsb2JhbFRoaXNgIG9iamVjdC5cclxuICogQHJldHVybnMgdGhlIGBnbG9iYWxUaGlzYCBvYmplY3QgZm9yIHRoZSBnaXZlbiBlbnZpcm9ubWVudC5cclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0R2xvYmFsKCkge1xyXG4gICAgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybiBzZWxmO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHdpbmRvdztcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybiBnbG9iYWw7XHJcbiAgICB9XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBsb2NhdGUgZ2xvYmFsIG9iamVjdC4nKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0c0Zyb21HbG9iYWwgPSAoKSA9PiBnZXRHbG9iYWwoKS5fX0ZJUkVCQVNFX0RFRkFVTFRTX187XHJcbi8qKlxyXG4gKiBBdHRlbXB0IHRvIHJlYWQgZGVmYXVsdHMgZnJvbSBhIEpTT04gc3RyaW5nIHByb3ZpZGVkIHRvXHJcbiAqIHByb2Nlc3MoLillbnYoLilfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb3IgYSBKU09OIGZpbGUgd2hvc2UgcGF0aCBpcyBpblxyXG4gKiBwcm9jZXNzKC4pZW52KC4pX19GSVJFQkFTRV9ERUZBVUxUU19QQVRIX19cclxuICogVGhlIGRvdHMgYXJlIGluIHBhcmVucyBiZWNhdXNlIGNlcnRhaW4gY29tcGlsZXJzIChWaXRlPykgY2Fubm90XHJcbiAqIGhhbmRsZSBzZWVpbmcgdGhhdCB2YXJpYWJsZSBpbiBjb21tZW50cy5cclxuICogU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvaXNzdWVzLzY4MzhcclxuICovXHJcbmNvbnN0IGdldERlZmF1bHRzRnJvbUVudlZhcmlhYmxlID0gKCkgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBwcm9jZXNzID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgcHJvY2Vzcy5lbnYgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGVmYXVsdHNKc29uU3RyaW5nID0gcHJvY2Vzcy5lbnYuX19GSVJFQkFTRV9ERUZBVUxUU19fO1xyXG4gICAgaWYgKGRlZmF1bHRzSnNvblN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGRlZmF1bHRzSnNvblN0cmluZyk7XHJcbiAgICB9XHJcbn07XHJcbmNvbnN0IGdldERlZmF1bHRzRnJvbUNvb2tpZSA9ICgpID0+IHtcclxuICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IG1hdGNoO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBtYXRjaCA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgvX19GSVJFQkFTRV9ERUZBVUxUU19fPShbXjtdKykvKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgLy8gU29tZSBlbnZpcm9ubWVudHMgc3VjaCBhcyBBbmd1bGFyIFVuaXZlcnNhbCBTU1IgaGF2ZSBhXHJcbiAgICAgICAgLy8gYGRvY3VtZW50YCBvYmplY3QgYnV0IGVycm9yIG9uIGFjY2Vzc2luZyBgZG9jdW1lbnQuY29va2llYC5cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBkZWNvZGVkID0gbWF0Y2ggJiYgYmFzZTY0RGVjb2RlKG1hdGNoWzFdKTtcclxuICAgIHJldHVybiBkZWNvZGVkICYmIEpTT04ucGFyc2UoZGVjb2RlZCk7XHJcbn07XHJcbi8qKlxyXG4gKiBHZXQgdGhlIF9fRklSRUJBU0VfREVGQVVMVFNfXyBvYmplY3QuIEl0IGNoZWNrcyBpbiBvcmRlcjpcclxuICogKDEpIGlmIHN1Y2ggYW4gb2JqZWN0IGV4aXN0cyBhcyBhIHByb3BlcnR5IG9mIGBnbG9iYWxUaGlzYFxyXG4gKiAoMikgaWYgc3VjaCBhbiBvYmplY3Qgd2FzIHByb3ZpZGVkIG9uIGEgc2hlbGwgZW52aXJvbm1lbnQgdmFyaWFibGVcclxuICogKDMpIGlmIHN1Y2ggYW4gb2JqZWN0IGV4aXN0cyBpbiBhIGNvb2tpZVxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0cyA9ICgpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIChnZXREZWZhdWx0c0Zyb21HbG9iYWwoKSB8fFxyXG4gICAgICAgICAgICBnZXREZWZhdWx0c0Zyb21FbnZWYXJpYWJsZSgpIHx8XHJcbiAgICAgICAgICAgIGdldERlZmF1bHRzRnJvbUNvb2tpZSgpKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ2F0Y2gtYWxsIGZvciBiZWluZyB1bmFibGUgdG8gZ2V0IF9fRklSRUJBU0VfREVGQVVMVFNfXyBkdWVcclxuICAgICAgICAgKiB0byBhbnkgZW52aXJvbm1lbnQgY2FzZSB3ZSBoYXZlIG5vdCBhY2NvdW50ZWQgZm9yLiBMb2cgdG9cclxuICAgICAgICAgKiBpbmZvIGluc3RlYWQgb2Ygc3dhbGxvd2luZyBzbyB3ZSBjYW4gZmluZCB0aGVzZSB1bmtub3duIGNhc2VzXHJcbiAgICAgICAgICogYW5kIGFkZCBwYXRocyBmb3IgdGhlbSBpZiBuZWVkZWQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgY29uc29sZS5pbmZvKGBVbmFibGUgdG8gZ2V0IF9fRklSRUJBU0VfREVGQVVMVFNfXyBkdWUgdG86ICR7ZX1gKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbn07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIGVtdWxhdG9yIGhvc3Qgc3RvcmVkIGluIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0XHJcbiAqIGZvciB0aGUgZ2l2ZW4gcHJvZHVjdC5cclxuICogQHJldHVybnMgYSBVUkwgaG9zdCBmb3JtYXR0ZWQgbGlrZSBgMTI3LjAuMC4xOjk5OTlgIG9yIGBbOjoxXTo0MDAwYCBpZiBhdmFpbGFibGVcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCA9IChwcm9kdWN0TmFtZSkgPT4geyB2YXIgX2EsIF9iOyByZXR1cm4gKF9iID0gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmVtdWxhdG9ySG9zdHMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYltwcm9kdWN0TmFtZV07IH07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIGVtdWxhdG9yIGhvc3RuYW1lIGFuZCBwb3J0IHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdFxyXG4gKiBmb3IgdGhlIGdpdmVuIHByb2R1Y3QuXHJcbiAqIEByZXR1cm5zIGEgcGFpciBvZiBob3N0bmFtZSBhbmQgcG9ydCBsaWtlIGBbXCI6OjFcIiwgNDAwMF1gIGlmIGF2YWlsYWJsZVxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBnZXREZWZhdWx0RW11bGF0b3JIb3N0bmFtZUFuZFBvcnQgPSAocHJvZHVjdE5hbWUpID0+IHtcclxuICAgIGNvbnN0IGhvc3QgPSBnZXREZWZhdWx0RW11bGF0b3JIb3N0KHByb2R1Y3ROYW1lKTtcclxuICAgIGlmICghaG9zdCkge1xyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzZXBhcmF0b3JJbmRleCA9IGhvc3QubGFzdEluZGV4T2YoJzonKTsgLy8gRmluZGluZyB0aGUgbGFzdCBzaW5jZSBJUHY2IGFkZHIgYWxzbyBoYXMgY29sb25zLlxyXG4gICAgaWYgKHNlcGFyYXRvckluZGV4IDw9IDAgfHwgc2VwYXJhdG9ySW5kZXggKyAxID09PSBob3N0Lmxlbmd0aCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBob3N0ICR7aG9zdH0gd2l0aCBubyBzZXBhcmF0ZSBob3N0bmFtZSBhbmQgcG9ydCFgKTtcclxuICAgIH1cclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcclxuICAgIGNvbnN0IHBvcnQgPSBwYXJzZUludChob3N0LnN1YnN0cmluZyhzZXBhcmF0b3JJbmRleCArIDEpLCAxMCk7XHJcbiAgICBpZiAoaG9zdFswXSA9PT0gJ1snKSB7XHJcbiAgICAgICAgLy8gQnJhY2tldC1xdW90ZWQgYFtpcHY2YWRkcl06cG9ydGAgPT4gcmV0dXJuIFwiaXB2NmFkZHJcIiAod2l0aG91dCBicmFja2V0cykuXHJcbiAgICAgICAgcmV0dXJuIFtob3N0LnN1YnN0cmluZygxLCBzZXBhcmF0b3JJbmRleCAtIDEpLCBwb3J0XTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBbaG9zdC5zdWJzdHJpbmcoMCwgc2VwYXJhdG9ySW5kZXgpLCBwb3J0XTtcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIFJldHVybnMgRmlyZWJhc2UgYXBwIGNvbmZpZyBzdG9yZWQgaW4gdGhlIF9fRklSRUJBU0VfREVGQVVMVFNfXyBvYmplY3QuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGdldERlZmF1bHRBcHBDb25maWcgPSAoKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb25maWc7IH07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIGFuIGV4cGVyaW1lbnRhbCBzZXR0aW5nIG9uIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0IChwcm9wZXJ0aWVzXHJcbiAqIHByZWZpeGVkIGJ5IFwiX1wiKVxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBnZXRFeHBlcmltZW50YWxTZXR0aW5nID0gKG5hbWUpID0+IHsgdmFyIF9hOyByZXR1cm4gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2BfJHtuYW1lfWBdOyB9O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBEZWZlcnJlZCB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnJlamVjdCA9ICgpID0+IHsgfTtcclxuICAgICAgICB0aGlzLnJlc29sdmUgPSAoKSA9PiB7IH07XHJcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlc29sdmUgPSByZXNvbHZlO1xyXG4gICAgICAgICAgICB0aGlzLnJlamVjdCA9IHJlamVjdDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogT3VyIEFQSSBpbnRlcm5hbHMgYXJlIG5vdCBwcm9taXNlaWZpZWQgYW5kIGNhbm5vdCBiZWNhdXNlIG91ciBjYWxsYmFjayBBUElzIGhhdmUgc3VidGxlIGV4cGVjdGF0aW9ucyBhcm91bmRcclxuICAgICAqIGludm9raW5nIHByb21pc2VzIGlubGluZSwgd2hpY2ggUHJvbWlzZXMgYXJlIGZvcmJpZGRlbiB0byBkby4gVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBvcHRpb25hbCBub2RlLXN0eWxlIGNhbGxiYWNrXHJcbiAgICAgKiBhbmQgcmV0dXJucyBhIG5vZGUtc3R5bGUgY2FsbGJhY2sgd2hpY2ggd2lsbCByZXNvbHZlIG9yIHJlamVjdCB0aGUgRGVmZXJyZWQncyBwcm9taXNlLlxyXG4gICAgICovXHJcbiAgICB3cmFwQ2FsbGJhY2soY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gKGVycm9yLCB2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgLy8gQXR0YWNoaW5nIG5vb3AgaGFuZGxlciBqdXN0IGluIGNhc2UgZGV2ZWxvcGVyIHdhc24ndCBleHBlY3RpbmdcclxuICAgICAgICAgICAgICAgIC8vIHByb21pc2VzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb21pc2UuY2F0Y2goKCkgPT4geyB9KTtcclxuICAgICAgICAgICAgICAgIC8vIFNvbWUgb2Ygb3VyIGNhbGxiYWNrcyBkb24ndCBleHBlY3QgYSB2YWx1ZSBhbmQgb3VyIG93biB0ZXN0c1xyXG4gICAgICAgICAgICAgICAgLy8gYXNzZXJ0IHRoYXQgdGhlIHBhcmFtZXRlciBsZW5ndGggaXMgMVxyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZU1vY2tVc2VyVG9rZW4odG9rZW4sIHByb2plY3RJZCkge1xyXG4gICAgaWYgKHRva2VuLnVpZCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIFwidWlkXCIgZmllbGQgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCBieSBtb2NrVXNlclRva2VuLiBQbGVhc2UgdXNlIFwic3ViXCIgaW5zdGVhZCBmb3IgRmlyZWJhc2UgQXV0aCBVc2VyIElELicpO1xyXG4gICAgfVxyXG4gICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlIFwibm9uZVwiIGFzIHRoZSBhbGdvcml0aG0uXHJcbiAgICBjb25zdCBoZWFkZXIgPSB7XHJcbiAgICAgICAgYWxnOiAnbm9uZScsXHJcbiAgICAgICAgdHlwZTogJ0pXVCdcclxuICAgIH07XHJcbiAgICBjb25zdCBwcm9qZWN0ID0gcHJvamVjdElkIHx8ICdkZW1vLXByb2plY3QnO1xyXG4gICAgY29uc3QgaWF0ID0gdG9rZW4uaWF0IHx8IDA7XHJcbiAgICBjb25zdCBzdWIgPSB0b2tlbi5zdWIgfHwgdG9rZW4udXNlcl9pZDtcclxuICAgIGlmICghc3ViKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkIVwiKTtcclxuICAgIH1cclxuICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKHsgXHJcbiAgICAgICAgLy8gU2V0IGFsbCByZXF1aXJlZCBmaWVsZHMgdG8gZGVjZW50IGRlZmF1bHRzXHJcbiAgICAgICAgaXNzOiBgaHR0cHM6Ly9zZWN1cmV0b2tlbi5nb29nbGUuY29tLyR7cHJvamVjdH1gLCBhdWQ6IHByb2plY3QsIGlhdCwgZXhwOiBpYXQgKyAzNjAwLCBhdXRoX3RpbWU6IGlhdCwgc3ViLCB1c2VyX2lkOiBzdWIsIGZpcmViYXNlOiB7XHJcbiAgICAgICAgICAgIHNpZ25faW5fcHJvdmlkZXI6ICdjdXN0b20nLFxyXG4gICAgICAgICAgICBpZGVudGl0aWVzOiB7fVxyXG4gICAgICAgIH0gfSwgdG9rZW4pO1xyXG4gICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlIHRoZSBlbXB0eSBzdHJpbmcgYXMgYSBzaWduYXR1cmUuXHJcbiAgICBjb25zdCBzaWduYXR1cmUgPSAnJztcclxuICAgIHJldHVybiBbXHJcbiAgICAgICAgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkoaGVhZGVyKSksXHJcbiAgICAgICAgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpLFxyXG4gICAgICAgIHNpZ25hdHVyZVxyXG4gICAgXS5qb2luKCcuJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFJldHVybnMgbmF2aWdhdG9yLnVzZXJBZ2VudCBzdHJpbmcgb3IgJycgaWYgaXQncyBub3QgZGVmaW5lZC5cclxuICogQHJldHVybiB1c2VyIGFnZW50IHN0cmluZ1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0VUEoKSB7XHJcbiAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICB0eXBlb2YgbmF2aWdhdG9yWyd1c2VyQWdlbnQnXSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICByZXR1cm4gbmF2aWdhdG9yWyd1c2VyQWdlbnQnXTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxyXG4vKipcclxuICogRGV0ZWN0IENvcmRvdmEgLyBQaG9uZUdhcCAvIElvbmljIGZyYW1ld29ya3Mgb24gYSBtb2JpbGUgZGV2aWNlLlxyXG4gKlxyXG4gKiBEZWxpYmVyYXRlbHkgZG9lcyBub3QgcmVseSBvbiBjaGVja2luZyBgZmlsZTovL2AgVVJMcyAoYXMgdGhpcyBmYWlscyBQaG9uZUdhcFxyXG4gKiBpbiB0aGUgUmlwcGxlIGVtdWxhdG9yKSBub3IgQ29yZG92YSBgb25EZXZpY2VSZWFkeWAsIHdoaWNoIHdvdWxkIG5vcm1hbGx5XHJcbiAqIHdhaXQgZm9yIGEgY2FsbGJhY2suXHJcbiAqL1xyXG5mdW5jdGlvbiBpc01vYmlsZUNvcmRvdmEoKSB7XHJcbiAgICByZXR1cm4gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmXHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZSBTZXR0aW5nIHVwIGFuIGJyb2FkbHkgYXBwbGljYWJsZSBpbmRleCBzaWduYXR1cmUgZm9yIFdpbmRvd1xyXG4gICAgICAgIC8vIGp1c3QgdG8gZGVhbCB3aXRoIHRoaXMgY2FzZSB3b3VsZCBwcm9iYWJseSBiZSBhIGJhZCBpZGVhLlxyXG4gICAgICAgICEhKHdpbmRvd1snY29yZG92YSddIHx8IHdpbmRvd1sncGhvbmVnYXAnXSB8fCB3aW5kb3dbJ1Bob25lR2FwJ10pICYmXHJcbiAgICAgICAgL2lvc3xpcGhvbmV8aXBvZHxpcGFkfGFuZHJvaWR8YmxhY2tiZXJyeXxpZW1vYmlsZS9pLnRlc3QoZ2V0VUEoKSkpO1xyXG59XHJcbi8qKlxyXG4gKiBEZXRlY3QgTm9kZS5qcy5cclxuICpcclxuICogQHJldHVybiB0cnVlIGlmIE5vZGUuanMgZW52aXJvbm1lbnQgaXMgZGV0ZWN0ZWQgb3Igc3BlY2lmaWVkLlxyXG4gKi9cclxuLy8gTm9kZSBkZXRlY3Rpb24gbG9naWMgZnJvbTogaHR0cHM6Ly9naXRodWIuY29tL2lsaWFrYW4vZGV0ZWN0LW5vZGUvXHJcbmZ1bmN0aW9uIGlzTm9kZSgpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IGZvcmNlRW52aXJvbm1lbnQgPSAoX2EgPSBnZXREZWZhdWx0cygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9yY2VFbnZpcm9ubWVudDtcclxuICAgIGlmIChmb3JjZUVudmlyb25tZW50ID09PSAnbm9kZScpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGZvcmNlRW52aXJvbm1lbnQgPT09ICdicm93c2VyJykge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZ2xvYmFsLnByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXScpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIERldGVjdCBCcm93c2VyIEVudmlyb25tZW50XHJcbiAqL1xyXG5mdW5jdGlvbiBpc0Jyb3dzZXIoKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHNlbGYgPT09ICdvYmplY3QnICYmIHNlbGYuc2VsZiA9PT0gc2VsZjtcclxufVxyXG5mdW5jdGlvbiBpc0Jyb3dzZXJFeHRlbnNpb24oKSB7XHJcbiAgICBjb25zdCBydW50aW1lID0gdHlwZW9mIGNocm9tZSA9PT0gJ29iamVjdCdcclxuICAgICAgICA/IGNocm9tZS5ydW50aW1lXHJcbiAgICAgICAgOiB0eXBlb2YgYnJvd3NlciA9PT0gJ29iamVjdCdcclxuICAgICAgICAgICAgPyBicm93c2VyLnJ1bnRpbWVcclxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XHJcbiAgICByZXR1cm4gdHlwZW9mIHJ1bnRpbWUgPT09ICdvYmplY3QnICYmIHJ1bnRpbWUuaWQgIT09IHVuZGVmaW5lZDtcclxufVxyXG4vKipcclxuICogRGV0ZWN0IFJlYWN0IE5hdGl2ZS5cclxuICpcclxuICogQHJldHVybiB0cnVlIGlmIFJlYWN0TmF0aXZlIGVudmlyb25tZW50IGlzIGRldGVjdGVkLlxyXG4gKi9cclxuZnVuY3Rpb24gaXNSZWFjdE5hdGl2ZSgpIHtcclxuICAgIHJldHVybiAodHlwZW9mIG5hdmlnYXRvciA9PT0gJ29iamVjdCcgJiYgbmF2aWdhdG9yWydwcm9kdWN0J10gPT09ICdSZWFjdE5hdGl2ZScpO1xyXG59XHJcbi8qKiBEZXRlY3RzIEVsZWN0cm9uIGFwcHMuICovXHJcbmZ1bmN0aW9uIGlzRWxlY3Ryb24oKSB7XHJcbiAgICByZXR1cm4gZ2V0VUEoKS5pbmRleE9mKCdFbGVjdHJvbi8nKSA+PSAwO1xyXG59XHJcbi8qKiBEZXRlY3RzIEludGVybmV0IEV4cGxvcmVyLiAqL1xyXG5mdW5jdGlvbiBpc0lFKCkge1xyXG4gICAgY29uc3QgdWEgPSBnZXRVQSgpO1xyXG4gICAgcmV0dXJuIHVhLmluZGV4T2YoJ01TSUUgJykgPj0gMCB8fCB1YS5pbmRleE9mKCdUcmlkZW50LycpID49IDA7XHJcbn1cclxuLyoqIERldGVjdHMgVW5pdmVyc2FsIFdpbmRvd3MgUGxhdGZvcm0gYXBwcy4gKi9cclxuZnVuY3Rpb24gaXNVV1AoKSB7XHJcbiAgICByZXR1cm4gZ2V0VUEoKS5pbmRleE9mKCdNU0FwcEhvc3QvJykgPj0gMDtcclxufVxyXG4vKipcclxuICogRGV0ZWN0IHdoZXRoZXIgdGhlIGN1cnJlbnQgU0RLIGJ1aWxkIGlzIHRoZSBOb2RlIHZlcnNpb24uXHJcbiAqXHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIHRoZSBOb2RlIFNESyBidWlsZC5cclxuICovXHJcbmZ1bmN0aW9uIGlzTm9kZVNkaygpIHtcclxuICAgIHJldHVybiBDT05TVEFOVFMuTk9ERV9DTElFTlQgPT09IHRydWUgfHwgQ09OU1RBTlRTLk5PREVfQURNSU4gPT09IHRydWU7XHJcbn1cclxuLyoqIFJldHVybnMgdHJ1ZSBpZiB3ZSBhcmUgcnVubmluZyBpbiBTYWZhcmkuICovXHJcbmZ1bmN0aW9uIGlzU2FmYXJpKCkge1xyXG4gICAgcmV0dXJuICghaXNOb2RlKCkgJiZcclxuICAgICAgICBuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdTYWZhcmknKSAmJlxyXG4gICAgICAgICFuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdDaHJvbWUnKSk7XHJcbn1cclxuLyoqXHJcbiAqIFRoaXMgbWV0aG9kIGNoZWNrcyBpZiBpbmRleGVkREIgaXMgc3VwcG9ydGVkIGJ5IGN1cnJlbnQgYnJvd3Nlci9zZXJ2aWNlIHdvcmtlciBjb250ZXh0XHJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBpbmRleGVkREIgaXMgc3VwcG9ydGVkIGJ5IGN1cnJlbnQgYnJvd3Nlci9zZXJ2aWNlIHdvcmtlciBjb250ZXh0XHJcbiAqL1xyXG5mdW5jdGlvbiBpc0luZGV4ZWREQkF2YWlsYWJsZSgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBpbmRleGVkREIgPT09ICdvYmplY3QnO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFRoaXMgbWV0aG9kIHZhbGlkYXRlcyBicm93c2VyL3N3IGNvbnRleHQgZm9yIGluZGV4ZWREQiBieSBvcGVuaW5nIGEgZHVtbXkgaW5kZXhlZERCIGRhdGFiYXNlIGFuZCByZWplY3RcclxuICogaWYgZXJyb3JzIG9jY3VyIGR1cmluZyB0aGUgZGF0YWJhc2Ugb3BlbiBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEB0aHJvd3MgZXhjZXB0aW9uIGlmIGN1cnJlbnQgYnJvd3Nlci9zdyBjb250ZXh0IGNhbid0IHJ1biBpZGIub3BlbiAoZXg6IFNhZmFyaSBpZnJhbWUsIEZpcmVmb3hcclxuICogcHJpdmF0ZSBicm93c2luZylcclxuICovXHJcbmZ1bmN0aW9uIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGxldCBwcmVFeGlzdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGNvbnN0IERCX0NIRUNLX05BTUUgPSAndmFsaWRhdGUtYnJvd3Nlci1jb250ZXh0LWZvci1pbmRleGVkZGItYW5hbHl0aWNzLW1vZHVsZSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzZWxmLmluZGV4ZWREQi5vcGVuKERCX0NIRUNLX05BTUUpO1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3QucmVzdWx0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAvLyBkZWxldGUgZGF0YWJhc2Ugb25seSB3aGVuIGl0IGRvZXNuJ3QgcHJlLWV4aXN0XHJcbiAgICAgICAgICAgICAgICBpZiAoIXByZUV4aXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoREJfQ0hFQ0tfTkFNRSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHByZUV4aXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHZhciBfYTtcclxuICAgICAgICAgICAgICAgIHJlamVjdCgoKF9hID0gcmVxdWVzdC5lcnJvcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1lc3NhZ2UpIHx8ICcnKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuLyoqXHJcbiAqXHJcbiAqIFRoaXMgbWV0aG9kIGNoZWNrcyB3aGV0aGVyIGNvb2tpZSBpcyBlbmFibGVkIHdpdGhpbiBjdXJyZW50IGJyb3dzZXJcclxuICogQHJldHVybiB0cnVlIGlmIGNvb2tpZSBpcyBlbmFibGVkIHdpdGhpbiBjdXJyZW50IGJyb3dzZXJcclxuICovXHJcbmZ1bmN0aW9uIGFyZUNvb2tpZXNFbmFibGVkKCkge1xyXG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnIHx8ICFuYXZpZ2F0b3IuY29va2llRW5hYmxlZCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBAZmlsZW92ZXJ2aWV3IFN0YW5kYXJkaXplZCBGaXJlYmFzZSBFcnJvci5cclxuICpcclxuICogVXNhZ2U6XHJcbiAqXHJcbiAqICAgLy8gVHlwZXNjcmlwdCBzdHJpbmcgbGl0ZXJhbHMgZm9yIHR5cGUtc2FmZSBjb2Rlc1xyXG4gKiAgIHR5cGUgRXJyID1cclxuICogICAgICd1bmtub3duJyB8XHJcbiAqICAgICAnb2JqZWN0LW5vdC1mb3VuZCdcclxuICogICAgIDtcclxuICpcclxuICogICAvLyBDbG9zdXJlIGVudW0gZm9yIHR5cGUtc2FmZSBlcnJvciBjb2Rlc1xyXG4gKiAgIC8vIGF0LWVudW0ge3N0cmluZ31cclxuICogICB2YXIgRXJyID0ge1xyXG4gKiAgICAgVU5LTk9XTjogJ3Vua25vd24nLFxyXG4gKiAgICAgT0JKRUNUX05PVF9GT1VORDogJ29iamVjdC1ub3QtZm91bmQnLFxyXG4gKiAgIH1cclxuICpcclxuICogICBsZXQgZXJyb3JzOiBNYXA8RXJyLCBzdHJpbmc+ID0ge1xyXG4gKiAgICAgJ2dlbmVyaWMtZXJyb3InOiBcIlVua25vd24gZXJyb3JcIixcclxuICogICAgICdmaWxlLW5vdC1mb3VuZCc6IFwiQ291bGQgbm90IGZpbmQgZmlsZTogeyRmaWxlfVwiLFxyXG4gKiAgIH07XHJcbiAqXHJcbiAqICAgLy8gVHlwZS1zYWZlIGZ1bmN0aW9uIC0gbXVzdCBwYXNzIGEgdmFsaWQgZXJyb3IgY29kZSBhcyBwYXJhbS5cclxuICogICBsZXQgZXJyb3IgPSBuZXcgRXJyb3JGYWN0b3J5PEVycj4oJ3NlcnZpY2UnLCAnU2VydmljZScsIGVycm9ycyk7XHJcbiAqXHJcbiAqICAgLi4uXHJcbiAqICAgdGhyb3cgZXJyb3IuY3JlYXRlKEVyci5HRU5FUklDKTtcclxuICogICAuLi5cclxuICogICB0aHJvdyBlcnJvci5jcmVhdGUoRXJyLkZJTEVfTk9UX0ZPVU5ELCB7J2ZpbGUnOiBmaWxlTmFtZX0pO1xyXG4gKiAgIC4uLlxyXG4gKiAgIC8vIFNlcnZpY2U6IENvdWxkIG5vdCBmaWxlIGZpbGU6IGZvby50eHQgKHNlcnZpY2UvZmlsZS1ub3QtZm91bmQpLlxyXG4gKlxyXG4gKiAgIGNhdGNoIChlKSB7XHJcbiAqICAgICBhc3NlcnQoZS5tZXNzYWdlID09PSBcIkNvdWxkIG5vdCBmaW5kIGZpbGU6IGZvby50eHQuXCIpO1xyXG4gKiAgICAgaWYgKChlIGFzIEZpcmViYXNlRXJyb3IpPy5jb2RlID09PSAnc2VydmljZS9maWxlLW5vdC1mb3VuZCcpIHtcclxuICogICAgICAgY29uc29sZS5sb2coXCJDb3VsZCBub3QgcmVhZCBmaWxlOiBcIiArIGVbJ2ZpbGUnXSk7XHJcbiAqICAgICB9XHJcbiAqICAgfVxyXG4gKi9cclxuY29uc3QgRVJST1JfTkFNRSA9ICdGaXJlYmFzZUVycm9yJztcclxuLy8gQmFzZWQgb24gY29kZSBmcm9tOlxyXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9FcnJvciNDdXN0b21fRXJyb3JfVHlwZXNcclxuY2xhc3MgRmlyZWJhc2VFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgLyoqIFRoZSBlcnJvciBjb2RlIGZvciB0aGlzIGVycm9yLiAqL1xyXG4gICAgY29kZSwgbWVzc2FnZSwgXHJcbiAgICAvKiogQ3VzdG9tIGRhdGEgZm9yIHRoaXMgZXJyb3IuICovXHJcbiAgICBjdXN0b21EYXRhKSB7XHJcbiAgICAgICAgc3VwZXIobWVzc2FnZSk7XHJcbiAgICAgICAgdGhpcy5jb2RlID0gY29kZTtcclxuICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSBjdXN0b21EYXRhO1xyXG4gICAgICAgIC8qKiBUaGUgY3VzdG9tIG5hbWUgZm9yIGFsbCBGaXJlYmFzZUVycm9ycy4gKi9cclxuICAgICAgICB0aGlzLm5hbWUgPSBFUlJPUl9OQU1FO1xyXG4gICAgICAgIC8vIEZpeCBGb3IgRVM1XHJcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0LXdpa2kvYmxvYi9tYXN0ZXIvQnJlYWtpbmctQ2hhbmdlcy5tZCNleHRlbmRpbmctYnVpbHQtaW5zLWxpa2UtZXJyb3ItYXJyYXktYW5kLW1hcC1tYXktbm8tbG9uZ2VyLXdvcmtcclxuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgRmlyZWJhc2VFcnJvci5wcm90b3R5cGUpO1xyXG4gICAgICAgIC8vIE1haW50YWlucyBwcm9wZXIgc3RhY2sgdHJhY2UgZm9yIHdoZXJlIG91ciBlcnJvciB3YXMgdGhyb3duLlxyXG4gICAgICAgIC8vIE9ubHkgYXZhaWxhYmxlIG9uIFY4LlxyXG4gICAgICAgIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkge1xyXG4gICAgICAgICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBFcnJvckZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmNsYXNzIEVycm9yRmFjdG9yeSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlLCBzZXJ2aWNlTmFtZSwgZXJyb3JzKSB7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcclxuICAgICAgICB0aGlzLnNlcnZpY2VOYW1lID0gc2VydmljZU5hbWU7XHJcbiAgICAgICAgdGhpcy5lcnJvcnMgPSBlcnJvcnM7XHJcbiAgICB9XHJcbiAgICBjcmVhdGUoY29kZSwgLi4uZGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGN1c3RvbURhdGEgPSBkYXRhWzBdIHx8IHt9O1xyXG4gICAgICAgIGNvbnN0IGZ1bGxDb2RlID0gYCR7dGhpcy5zZXJ2aWNlfS8ke2NvZGV9YDtcclxuICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IHRoaXMuZXJyb3JzW2NvZGVdO1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0ZW1wbGF0ZSA/IHJlcGxhY2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgY3VzdG9tRGF0YSkgOiAnRXJyb3InO1xyXG4gICAgICAgIC8vIFNlcnZpY2UgTmFtZTogRXJyb3IgbWVzc2FnZSAoc2VydmljZS9jb2RlKS5cclxuICAgICAgICBjb25zdCBmdWxsTWVzc2FnZSA9IGAke3RoaXMuc2VydmljZU5hbWV9OiAke21lc3NhZ2V9ICgke2Z1bGxDb2RlfSkuYDtcclxuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBGaXJlYmFzZUVycm9yKGZ1bGxDb2RlLCBmdWxsTWVzc2FnZSwgY3VzdG9tRGF0YSk7XHJcbiAgICAgICAgcmV0dXJuIGVycm9yO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHJlcGxhY2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgZGF0YSkge1xyXG4gICAgcmV0dXJuIHRlbXBsYXRlLnJlcGxhY2UoUEFUVEVSTiwgKF8sIGtleSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsID8gU3RyaW5nKHZhbHVlKSA6IGA8JHtrZXl9Pz5gO1xyXG4gICAgfSk7XHJcbn1cclxuY29uc3QgUEFUVEVSTiA9IC9cXHtcXCQoW159XSspfS9nO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRXZhbHVhdGVzIGEgSlNPTiBzdHJpbmcgaW50byBhIGphdmFzY3JpcHQgb2JqZWN0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyIEEgc3RyaW5nIGNvbnRhaW5pbmcgSlNPTi5cclxuICogQHJldHVybiB7Kn0gVGhlIGphdmFzY3JpcHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc3BlY2lmaWVkIEpTT04uXHJcbiAqL1xyXG5mdW5jdGlvbiBqc29uRXZhbChzdHIpIHtcclxuICAgIHJldHVybiBKU09OLnBhcnNlKHN0cik7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgSlNPTiByZXByZXNlbnRpbmcgYSBqYXZhc2NyaXB0IG9iamVjdC5cclxuICogQHBhcmFtIHsqfSBkYXRhIEphdmFzY3JpcHQgb2JqZWN0IHRvIGJlIHN0cmluZ2lmaWVkLlxyXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBKU09OIGNvbnRlbnRzIG9mIHRoZSBvYmplY3QuXHJcbiAqL1xyXG5mdW5jdGlvbiBzdHJpbmdpZnkoZGF0YSkge1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGRhdGEpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gaW50byBjb25zdGl0dWVudCBwYXJ0cy5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiB3aXRoIGludmFsaWQgLyBpbmNvbXBsZXRlIGNsYWltcyBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cclxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cclxuICovXHJcbmNvbnN0IGRlY29kZSA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgbGV0IGhlYWRlciA9IHt9LCBjbGFpbXMgPSB7fSwgZGF0YSA9IHt9LCBzaWduYXR1cmUgPSAnJztcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcGFydHMgPSB0b2tlbi5zcGxpdCgnLicpO1xyXG4gICAgICAgIGhlYWRlciA9IGpzb25FdmFsKGJhc2U2NERlY29kZShwYXJ0c1swXSkgfHwgJycpO1xyXG4gICAgICAgIGNsYWltcyA9IGpzb25FdmFsKGJhc2U2NERlY29kZShwYXJ0c1sxXSkgfHwgJycpO1xyXG4gICAgICAgIHNpZ25hdHVyZSA9IHBhcnRzWzJdO1xyXG4gICAgICAgIGRhdGEgPSBjbGFpbXNbJ2QnXSB8fCB7fTtcclxuICAgICAgICBkZWxldGUgY2xhaW1zWydkJ107XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkgeyB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGhlYWRlcixcclxuICAgICAgICBjbGFpbXMsXHJcbiAgICAgICAgZGF0YSxcclxuICAgICAgICBzaWduYXR1cmVcclxuICAgIH07XHJcbn07XHJcbi8qKlxyXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gYW5kIGNoZWNrcyB0aGUgdmFsaWRpdHkgb2YgaXRzIHRpbWUtYmFzZWQgY2xhaW1zLiBXaWxsIHJldHVybiB0cnVlIGlmIHRoZVxyXG4gKiB0b2tlbiBpcyB3aXRoaW4gdGhlIHRpbWUgd2luZG93IGF1dGhvcml6ZWQgYnkgdGhlICduYmYnIChub3QtYmVmb3JlKSBhbmQgJ2lhdCcgKGlzc3VlZC1hdCkgY2xhaW1zLlxyXG4gKlxyXG4gKiBOb3RlczpcclxuICogLSBNYXkgcmV0dXJuIGEgZmFsc2UgbmVnYXRpdmUgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXHJcbiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuXHJcbiAqL1xyXG5jb25zdCBpc1ZhbGlkVGltZXN0YW1wID0gZnVuY3Rpb24gKHRva2VuKSB7XHJcbiAgICBjb25zdCBjbGFpbXMgPSBkZWNvZGUodG9rZW4pLmNsYWltcztcclxuICAgIGNvbnN0IG5vdyA9IE1hdGguZmxvb3IobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcclxuICAgIGxldCB2YWxpZFNpbmNlID0gMCwgdmFsaWRVbnRpbCA9IDA7XHJcbiAgICBpZiAodHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICBpZiAoY2xhaW1zLmhhc093blByb3BlcnR5KCduYmYnKSkge1xyXG4gICAgICAgICAgICB2YWxpZFNpbmNlID0gY2xhaW1zWyduYmYnXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY2xhaW1zLmhhc093blByb3BlcnR5KCdpYXQnKSkge1xyXG4gICAgICAgICAgICB2YWxpZFNpbmNlID0gY2xhaW1zWydpYXQnXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnZXhwJykpIHtcclxuICAgICAgICAgICAgdmFsaWRVbnRpbCA9IGNsYWltc1snZXhwJ107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyB0b2tlbiB3aWxsIGV4cGlyZSBhZnRlciAyNGggYnkgZGVmYXVsdFxyXG4gICAgICAgICAgICB2YWxpZFVudGlsID0gdmFsaWRTaW5jZSArIDg2NDAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiAoISFub3cgJiZcclxuICAgICAgICAhIXZhbGlkU2luY2UgJiZcclxuICAgICAgICAhIXZhbGlkVW50aWwgJiZcclxuICAgICAgICBub3cgPj0gdmFsaWRTaW5jZSAmJlxyXG4gICAgICAgIG5vdyA8PSB2YWxpZFVudGlsKTtcclxufTtcclxuLyoqXHJcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgcmV0dXJucyBpdHMgaXNzdWVkIGF0IHRpbWUgaWYgdmFsaWQsIG51bGwgb3RoZXJ3aXNlLlxyXG4gKlxyXG4gKiBOb3RlczpcclxuICogLSBNYXkgcmV0dXJuIG51bGwgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXHJcbiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuXHJcbiAqL1xyXG5jb25zdCBpc3N1ZWRBdFRpbWUgPSBmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgIGNvbnN0IGNsYWltcyA9IGRlY29kZSh0b2tlbikuY2xhaW1zO1xyXG4gICAgaWYgKHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnICYmIGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnaWF0JykpIHtcclxuICAgICAgICByZXR1cm4gY2xhaW1zWydpYXQnXTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59O1xyXG4vKipcclxuICogRGVjb2RlcyBhIEZpcmViYXNlIGF1dGguIHRva2VuIGFuZCBjaGVja3MgdGhlIHZhbGlkaXR5IG9mIGl0cyBmb3JtYXQuIEV4cGVjdHMgYSB2YWxpZCBpc3N1ZWQtYXQgdGltZS5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiBhIGZhbHNlIG5lZ2F0aXZlIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxyXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxyXG4gKi9cclxuY29uc3QgaXNWYWxpZEZvcm1hdCA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZSh0b2tlbiksIGNsYWltcyA9IGRlY29kZWQuY2xhaW1zO1xyXG4gICAgcmV0dXJuICEhY2xhaW1zICYmIHR5cGVvZiBjbGFpbXMgPT09ICdvYmplY3QnICYmIGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnaWF0Jyk7XHJcbn07XHJcbi8qKlxyXG4gKiBBdHRlbXB0cyB0byBwZWVyIGludG8gYW4gYXV0aCB0b2tlbiBhbmQgZGV0ZXJtaW5lIGlmIGl0J3MgYW4gYWRtaW4gYXV0aCB0b2tlbiBieSBsb29raW5nIGF0IHRoZSBjbGFpbXMgcG9ydGlvbi5cclxuICpcclxuICogTm90ZXM6XHJcbiAqIC0gTWF5IHJldHVybiBhIGZhbHNlIG5lZ2F0aXZlIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxyXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxyXG4gKi9cclxuY29uc3QgaXNBZG1pbiA9IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgY29uc3QgY2xhaW1zID0gZGVjb2RlKHRva2VuKS5jbGFpbXM7XHJcbiAgICByZXR1cm4gdHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zWydhZG1pbiddID09PSB0cnVlO1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBjb250YWlucyhvYmosIGtleSkge1xyXG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7XHJcbn1cclxuZnVuY3Rpb24gc2FmZUdldChvYmosIGtleSkge1xyXG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcclxuICAgICAgICByZXR1cm4gb2JqW2tleV07XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7XHJcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcclxuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuZnVuY3Rpb24gbWFwKG9iaiwgZm4sIGNvbnRleHRPYmopIHtcclxuICAgIGNvbnN0IHJlcyA9IHt9O1xyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcclxuICAgICAgICAgICAgcmVzW2tleV0gPSBmbi5jYWxsKGNvbnRleHRPYmosIG9ialtrZXldLCBrZXksIG9iaik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG4vKipcclxuICogRGVlcCBlcXVhbCB0d28gb2JqZWN0cy4gU3VwcG9ydCBBcnJheXMgYW5kIE9iamVjdHMuXHJcbiAqL1xyXG5mdW5jdGlvbiBkZWVwRXF1YWwoYSwgYikge1xyXG4gICAgaWYgKGEgPT09IGIpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGFLZXlzID0gT2JqZWN0LmtleXMoYSk7XHJcbiAgICBjb25zdCBiS2V5cyA9IE9iamVjdC5rZXlzKGIpO1xyXG4gICAgZm9yIChjb25zdCBrIG9mIGFLZXlzKSB7XHJcbiAgICAgICAgaWYgKCFiS2V5cy5pbmNsdWRlcyhrKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGFQcm9wID0gYVtrXTtcclxuICAgICAgICBjb25zdCBiUHJvcCA9IGJba107XHJcbiAgICAgICAgaWYgKGlzT2JqZWN0KGFQcm9wKSAmJiBpc09iamVjdChiUHJvcCkpIHtcclxuICAgICAgICAgICAgaWYgKCFkZWVwRXF1YWwoYVByb3AsIGJQcm9wKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGFQcm9wICE9PSBiUHJvcCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yIChjb25zdCBrIG9mIGJLZXlzKSB7XHJcbiAgICAgICAgaWYgKCFhS2V5cy5pbmNsdWRlcyhrKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuZnVuY3Rpb24gaXNPYmplY3QodGhpbmcpIHtcclxuICAgIHJldHVybiB0aGluZyAhPT0gbnVsbCAmJiB0eXBlb2YgdGhpbmcgPT09ICdvYmplY3QnO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZWplY3RzIGlmIHRoZSBnaXZlbiBwcm9taXNlIGRvZXNuJ3QgcmVzb2x2ZSBpbiB0aW1lSW5NUyBtaWxsaXNlY29uZHMuXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gcHJvbWlzZVdpdGhUaW1lb3V0KHByb21pc2UsIHRpbWVJbk1TID0gMjAwMCkge1xyXG4gICAgY29uc3QgZGVmZXJyZWRQcm9taXNlID0gbmV3IERlZmVycmVkKCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IGRlZmVycmVkUHJvbWlzZS5yZWplY3QoJ3RpbWVvdXQhJyksIHRpbWVJbk1TKTtcclxuICAgIHByb21pc2UudGhlbihkZWZlcnJlZFByb21pc2UucmVzb2x2ZSwgZGVmZXJyZWRQcm9taXNlLnJlamVjdCk7XHJcbiAgICByZXR1cm4gZGVmZXJyZWRQcm9taXNlLnByb21pc2U7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFJldHVybnMgYSBxdWVyeXN0cmluZy1mb3JtYXR0ZWQgc3RyaW5nIChlLmcuICZhcmc9dmFsJmFyZzI9dmFsMikgZnJvbSBhXHJcbiAqIHBhcmFtcyBvYmplY3QgKGUuZy4ge2FyZzogJ3ZhbCcsIGFyZzI6ICd2YWwyJ30pXHJcbiAqIE5vdGU6IFlvdSBtdXN0IHByZXBlbmQgaXQgd2l0aCA/IHdoZW4gYWRkaW5nIGl0IHRvIGEgVVJMLlxyXG4gKi9cclxuZnVuY3Rpb24gcXVlcnlzdHJpbmcocXVlcnlzdHJpbmdQYXJhbXMpIHtcclxuICAgIGNvbnN0IHBhcmFtcyA9IFtdO1xyXG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocXVlcnlzdHJpbmdQYXJhbXMpKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHZhbHVlLmZvckVhY2goYXJyYXlWYWwgPT4ge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJyYXlWYWwpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwYXJhbXMucHVzaChlbmNvZGVVUklDb21wb25lbnQoa2V5KSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBwYXJhbXMubGVuZ3RoID8gJyYnICsgcGFyYW1zLmpvaW4oJyYnKSA6ICcnO1xyXG59XHJcbi8qKlxyXG4gKiBEZWNvZGVzIGEgcXVlcnlzdHJpbmcgKGUuZy4gP2FyZz12YWwmYXJnMj12YWwyKSBpbnRvIGEgcGFyYW1zIG9iamVjdFxyXG4gKiAoZS5nLiB7YXJnOiAndmFsJywgYXJnMjogJ3ZhbDInfSlcclxuICovXHJcbmZ1bmN0aW9uIHF1ZXJ5c3RyaW5nRGVjb2RlKHF1ZXJ5c3RyaW5nKSB7XHJcbiAgICBjb25zdCBvYmogPSB7fTtcclxuICAgIGNvbnN0IHRva2VucyA9IHF1ZXJ5c3RyaW5nLnJlcGxhY2UoL15cXD8vLCAnJykuc3BsaXQoJyYnKTtcclxuICAgIHRva2Vucy5mb3JFYWNoKHRva2VuID0+IHtcclxuICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gdG9rZW4uc3BsaXQoJz0nKTtcclxuICAgICAgICAgICAgb2JqW2RlY29kZVVSSUNvbXBvbmVudChrZXkpXSA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gb2JqO1xyXG59XHJcbi8qKlxyXG4gKiBFeHRyYWN0IHRoZSBxdWVyeSBzdHJpbmcgcGFydCBvZiBhIFVSTCwgaW5jbHVkaW5nIHRoZSBsZWFkaW5nIHF1ZXN0aW9uIG1hcmsgKGlmIHByZXNlbnQpLlxyXG4gKi9cclxuZnVuY3Rpb24gZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkge1xyXG4gICAgY29uc3QgcXVlcnlTdGFydCA9IHVybC5pbmRleE9mKCc/Jyk7XHJcbiAgICBpZiAoIXF1ZXJ5U3RhcnQpIHtcclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgICBjb25zdCBmcmFnbWVudFN0YXJ0ID0gdXJsLmluZGV4T2YoJyMnLCBxdWVyeVN0YXJ0KTtcclxuICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHF1ZXJ5U3RhcnQsIGZyYWdtZW50U3RhcnQgPiAwID8gZnJhZ21lbnRTdGFydCA6IHVuZGVmaW5lZCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEBmaWxlb3ZlcnZpZXcgU0hBLTEgY3J5cHRvZ3JhcGhpYyBoYXNoLlxyXG4gKiBWYXJpYWJsZSBuYW1lcyBmb2xsb3cgdGhlIG5vdGF0aW9uIGluIEZJUFMgUFVCIDE4MC0zOlxyXG4gKiBodHRwOi8vY3NyYy5uaXN0Lmdvdi9wdWJsaWNhdGlvbnMvZmlwcy9maXBzMTgwLTMvZmlwczE4MC0zX2ZpbmFsLnBkZi5cclxuICpcclxuICogVXNhZ2U6XHJcbiAqICAgdmFyIHNoYTEgPSBuZXcgc2hhMSgpO1xyXG4gKiAgIHNoYTEudXBkYXRlKGJ5dGVzKTtcclxuICogICB2YXIgaGFzaCA9IHNoYTEuZGlnZXN0KCk7XHJcbiAqXHJcbiAqIFBlcmZvcm1hbmNlOlxyXG4gKiAgIENocm9tZSAyMzogICB+NDAwIE1iaXQvc1xyXG4gKiAgIEZpcmVmb3ggMTY6ICB+MjUwIE1iaXQvc1xyXG4gKlxyXG4gKi9cclxuLyoqXHJcbiAqIFNIQS0xIGNyeXB0b2dyYXBoaWMgaGFzaCBjb25zdHJ1Y3Rvci5cclxuICpcclxuICogVGhlIHByb3BlcnRpZXMgZGVjbGFyZWQgaGVyZSBhcmUgZGlzY3Vzc2VkIGluIHRoZSBhYm92ZSBhbGdvcml0aG0gZG9jdW1lbnQuXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAZmluYWxcclxuICogQHN0cnVjdFxyXG4gKi9cclxuY2xhc3MgU2hhMSB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBIb2xkcyB0aGUgcHJldmlvdXMgdmFsdWVzIG9mIGFjY3VtdWxhdGVkIHZhcmlhYmxlcyBhLWUgaW4gdGhlIGNvbXByZXNzX1xyXG4gICAgICAgICAqIGZ1bmN0aW9uLlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5jaGFpbl8gPSBbXTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBIGJ1ZmZlciBob2xkaW5nIHRoZSBwYXJ0aWFsbHkgY29tcHV0ZWQgaGFzaCByZXN1bHQuXHJcbiAgICAgICAgICogQHByaXZhdGVcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmJ1Zl8gPSBbXTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBbiBhcnJheSBvZiA4MCBieXRlcywgZWFjaCBhIHBhcnQgb2YgdGhlIG1lc3NhZ2UgdG8gYmUgaGFzaGVkLiAgUmVmZXJyZWQgdG9cclxuICAgICAgICAgKiBhcyB0aGUgbWVzc2FnZSBzY2hlZHVsZSBpbiB0aGUgZG9jcy5cclxuICAgICAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuV18gPSBbXTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDb250YWlucyBkYXRhIG5lZWRlZCB0byBwYWQgbWVzc2FnZXMgbGVzcyB0aGFuIDY0IGJ5dGVzLlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5wYWRfID0gW107XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQHByaXZhdGUge251bWJlcn1cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmluYnVmXyA9IDA7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQHByaXZhdGUge251bWJlcn1cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnRvdGFsXyA9IDA7XHJcbiAgICAgICAgdGhpcy5ibG9ja1NpemUgPSA1MTIgLyA4O1xyXG4gICAgICAgIHRoaXMucGFkX1swXSA9IDEyODtcclxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuYmxvY2tTaXplOyArK2kpIHtcclxuICAgICAgICAgICAgdGhpcy5wYWRfW2ldID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgfVxyXG4gICAgcmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bMF0gPSAweDY3NDUyMzAxO1xyXG4gICAgICAgIHRoaXMuY2hhaW5fWzFdID0gMHhlZmNkYWI4OTtcclxuICAgICAgICB0aGlzLmNoYWluX1syXSA9IDB4OThiYWRjZmU7XHJcbiAgICAgICAgdGhpcy5jaGFpbl9bM10gPSAweDEwMzI1NDc2O1xyXG4gICAgICAgIHRoaXMuY2hhaW5fWzRdID0gMHhjM2QyZTFmMDtcclxuICAgICAgICB0aGlzLmluYnVmXyA9IDA7XHJcbiAgICAgICAgdGhpcy50b3RhbF8gPSAwO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbnRlcm5hbCBjb21wcmVzcyBoZWxwZXIgZnVuY3Rpb24uXHJcbiAgICAgKiBAcGFyYW0gYnVmIEJsb2NrIHRvIGNvbXByZXNzLlxyXG4gICAgICogQHBhcmFtIG9mZnNldCBPZmZzZXQgb2YgdGhlIGJsb2NrIGluIHRoZSBidWZmZXIuXHJcbiAgICAgKiBAcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBjb21wcmVzc18oYnVmLCBvZmZzZXQpIHtcclxuICAgICAgICBpZiAoIW9mZnNldCkge1xyXG4gICAgICAgICAgICBvZmZzZXQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBXID0gdGhpcy5XXztcclxuICAgICAgICAvLyBnZXQgMTYgYmlnIGVuZGlhbiB3b3Jkc1xyXG4gICAgICAgIGlmICh0eXBlb2YgYnVmID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8odXNlcik6IFtidWcgODE0MDEyMl0gUmVjZW50IHZlcnNpb25zIG9mIFNhZmFyaSBmb3IgTWFjIE9TIGFuZCBpT1NcclxuICAgICAgICAgICAgICAgIC8vIGhhdmUgYSBidWcgdGhhdCB0dXJucyB0aGUgcG9zdC1pbmNyZW1lbnQgKysgb3BlcmF0b3IgaW50byBwcmUtaW5jcmVtZW50XHJcbiAgICAgICAgICAgICAgICAvLyBkdXJpbmcgSklUIGNvbXBpbGF0aW9uLiAgV2UgaGF2ZSBjb2RlIHRoYXQgZGVwZW5kcyBoZWF2aWx5IG9uIFNIQS0xIGZvclxyXG4gICAgICAgICAgICAgICAgLy8gY29ycmVjdG5lc3MgYW5kIHdoaWNoIGlzIGFmZmVjdGVkIGJ5IHRoaXMgYnVnLCBzbyBJJ3ZlIHJlbW92ZWQgYWxsIHVzZXNcclxuICAgICAgICAgICAgICAgIC8vIG9mIHBvc3QtaW5jcmVtZW50ICsrIGluIHdoaWNoIHRoZSByZXN1bHQgdmFsdWUgaXMgdXNlZC4gIFdlIGNhbiByZXZlcnRcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMgY2hhbmdlIG9uY2UgdGhlIFNhZmFyaSBidWdcclxuICAgICAgICAgICAgICAgIC8vIChodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTA5MDM2KSBoYXMgYmVlbiBmaXhlZCBhbmRcclxuICAgICAgICAgICAgICAgIC8vIG1vc3QgY2xpZW50cyBoYXZlIGJlZW4gdXBkYXRlZC5cclxuICAgICAgICAgICAgICAgIFdbaV0gPVxyXG4gICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQpIDw8IDI0KSB8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQgKyAxKSA8PCAxNikgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMikgPDwgOCkgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidWYuY2hhckNvZGVBdChvZmZzZXQgKyAzKTtcclxuICAgICAgICAgICAgICAgIG9mZnNldCArPSA0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIFdbaV0gPVxyXG4gICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0XSA8PCAyNCkgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldCArIDFdIDw8IDE2KSB8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMl0gPDwgOCkgfFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBidWZbb2Zmc2V0ICsgM107XHJcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBleHBhbmQgdG8gODAgd29yZHNcclxuICAgICAgICBmb3IgKGxldCBpID0gMTY7IGkgPCA4MDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHQgPSBXW2kgLSAzXSBeIFdbaSAtIDhdIF4gV1tpIC0gMTRdIF4gV1tpIC0gMTZdO1xyXG4gICAgICAgICAgICBXW2ldID0gKCh0IDw8IDEpIHwgKHQgPj4+IDMxKSkgJiAweGZmZmZmZmZmO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgYSA9IHRoaXMuY2hhaW5fWzBdO1xyXG4gICAgICAgIGxldCBiID0gdGhpcy5jaGFpbl9bMV07XHJcbiAgICAgICAgbGV0IGMgPSB0aGlzLmNoYWluX1syXTtcclxuICAgICAgICBsZXQgZCA9IHRoaXMuY2hhaW5fWzNdO1xyXG4gICAgICAgIGxldCBlID0gdGhpcy5jaGFpbl9bNF07XHJcbiAgICAgICAgbGV0IGYsIGs7XHJcbiAgICAgICAgLy8gVE9ETyh1c2VyKTogVHJ5IHRvIHVucm9sbCB0aGlzIGxvb3AgdG8gc3BlZWQgdXAgdGhlIGNvbXB1dGF0aW9uLlxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODA7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoaSA8IDQwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA8IDIwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IGQgXiAoYiAmIChjIF4gZCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGsgPSAweDVhODI3OTk5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDtcclxuICAgICAgICAgICAgICAgICAgICBrID0gMHg2ZWQ5ZWJhMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChpIDwgNjApIHtcclxuICAgICAgICAgICAgICAgICAgICBmID0gKGIgJiBjKSB8IChkICYgKGIgfCBjKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgayA9IDB4OGYxYmJjZGM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmID0gYiBeIGMgXiBkO1xyXG4gICAgICAgICAgICAgICAgICAgIGsgPSAweGNhNjJjMWQ2O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHQgPSAoKChhIDw8IDUpIHwgKGEgPj4+IDI3KSkgKyBmICsgZSArIGsgKyBXW2ldKSAmIDB4ZmZmZmZmZmY7XHJcbiAgICAgICAgICAgIGUgPSBkO1xyXG4gICAgICAgICAgICBkID0gYztcclxuICAgICAgICAgICAgYyA9ICgoYiA8PCAzMCkgfCAoYiA+Pj4gMikpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICAgICAgYiA9IGE7XHJcbiAgICAgICAgICAgIGEgPSB0O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoYWluX1swXSA9ICh0aGlzLmNoYWluX1swXSArIGEpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICB0aGlzLmNoYWluX1sxXSA9ICh0aGlzLmNoYWluX1sxXSArIGIpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICB0aGlzLmNoYWluX1syXSA9ICh0aGlzLmNoYWluX1syXSArIGMpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICB0aGlzLmNoYWluX1szXSA9ICh0aGlzLmNoYWluX1szXSArIGQpICYgMHhmZmZmZmZmZjtcclxuICAgICAgICB0aGlzLmNoYWluX1s0XSA9ICh0aGlzLmNoYWluX1s0XSArIGUpICYgMHhmZmZmZmZmZjtcclxuICAgIH1cclxuICAgIHVwZGF0ZShieXRlcywgbGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gVE9ETyhqb2hubGVueik6IHRpZ2h0ZW4gdGhlIGZ1bmN0aW9uIHNpZ25hdHVyZSBhbmQgcmVtb3ZlIHRoaXMgY2hlY2tcclxuICAgICAgICBpZiAoYnl0ZXMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBsZW5ndGggPSBieXRlcy5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGxlbmd0aE1pbnVzQmxvY2sgPSBsZW5ndGggLSB0aGlzLmJsb2NrU2l6ZTtcclxuICAgICAgICBsZXQgbiA9IDA7XHJcbiAgICAgICAgLy8gVXNpbmcgbG9jYWwgaW5zdGVhZCBvZiBtZW1iZXIgdmFyaWFibGVzIGdpdmVzIH41JSBzcGVlZHVwIG9uIEZpcmVmb3ggMTYuXHJcbiAgICAgICAgY29uc3QgYnVmID0gdGhpcy5idWZfO1xyXG4gICAgICAgIGxldCBpbmJ1ZiA9IHRoaXMuaW5idWZfO1xyXG4gICAgICAgIC8vIFRoZSBvdXRlciB3aGlsZSBsb29wIHNob3VsZCBleGVjdXRlIGF0IG1vc3QgdHdpY2UuXHJcbiAgICAgICAgd2hpbGUgKG4gPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8gV2hlbiB3ZSBoYXZlIG5vIGRhdGEgaW4gdGhlIGJsb2NrIHRvIHRvcCB1cCwgd2UgY2FuIGRpcmVjdGx5IHByb2Nlc3MgdGhlXHJcbiAgICAgICAgICAgIC8vIGlucHV0IGJ1ZmZlciAoYXNzdW1pbmcgaXQgY29udGFpbnMgc3VmZmljaWVudCBkYXRhKS4gVGhpcyBnaXZlcyB+MjUlXHJcbiAgICAgICAgICAgIC8vIHNwZWVkdXAgb24gQ2hyb21lIDIzIGFuZCB+MTUlIHNwZWVkdXAgb24gRmlyZWZveCAxNiwgYnV0IHJlcXVpcmVzIHRoYXRcclxuICAgICAgICAgICAgLy8gdGhlIGRhdGEgaXMgcHJvdmlkZWQgaW4gbGFyZ2UgY2h1bmtzIChvciBpbiBtdWx0aXBsZXMgb2YgNjQgYnl0ZXMpLlxyXG4gICAgICAgICAgICBpZiAoaW5idWYgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChuIDw9IGxlbmd0aE1pbnVzQmxvY2spIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhieXRlcywgbik7XHJcbiAgICAgICAgICAgICAgICAgICAgbiArPSB0aGlzLmJsb2NrU2l6ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGJ5dGVzID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKG4gPCBsZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXMuY2hhckNvZGVBdChuKTtcclxuICAgICAgICAgICAgICAgICAgICArK2luYnVmO1xyXG4gICAgICAgICAgICAgICAgICAgICsrbjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcHJlc3NfKGJ1Zik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYnVmID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZltpbmJ1Zl0gPSBieXRlc1tuXTtcclxuICAgICAgICAgICAgICAgICAgICArK2luYnVmO1xyXG4gICAgICAgICAgICAgICAgICAgICsrbjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcHJlc3NfKGJ1Zik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYnVmID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSBpbmJ1ZjtcclxuICAgICAgICB0aGlzLnRvdGFsXyArPSBsZW5ndGg7XHJcbiAgICB9XHJcbiAgICAvKiogQG92ZXJyaWRlICovXHJcbiAgICBkaWdlc3QoKSB7XHJcbiAgICAgICAgY29uc3QgZGlnZXN0ID0gW107XHJcbiAgICAgICAgbGV0IHRvdGFsQml0cyA9IHRoaXMudG90YWxfICogODtcclxuICAgICAgICAvLyBBZGQgcGFkIDB4ODAgMHgwMCouXHJcbiAgICAgICAgaWYgKHRoaXMuaW5idWZfIDwgNTYpIHtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGUodGhpcy5wYWRfLCA1NiAtIHRoaXMuaW5idWZfKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgdGhpcy5ibG9ja1NpemUgLSAodGhpcy5pbmJ1Zl8gLSA1NikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBBZGQgIyBiaXRzLlxyXG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmJsb2NrU2l6ZSAtIDE7IGkgPj0gNTY7IGktLSkge1xyXG4gICAgICAgICAgICB0aGlzLmJ1Zl9baV0gPSB0b3RhbEJpdHMgJiAyNTU7XHJcbiAgICAgICAgICAgIHRvdGFsQml0cyAvPSAyNTY7IC8vIERvbid0IHVzZSBiaXQtc2hpZnRpbmcgaGVyZSFcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb21wcmVzc18odGhpcy5idWZfKTtcclxuICAgICAgICBsZXQgbiA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDI0OyBqID49IDA7IGogLT0gOCkge1xyXG4gICAgICAgICAgICAgICAgZGlnZXN0W25dID0gKHRoaXMuY2hhaW5fW2ldID4+IGopICYgMjU1O1xyXG4gICAgICAgICAgICAgICAgKytuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkaWdlc3Q7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEhlbHBlciB0byBtYWtlIGEgU3Vic2NyaWJlIGZ1bmN0aW9uIChqdXN0IGxpa2UgUHJvbWlzZSBoZWxwcyBtYWtlIGFcclxuICogVGhlbmFibGUpLlxyXG4gKlxyXG4gKiBAcGFyYW0gZXhlY3V0b3IgRnVuY3Rpb24gd2hpY2ggY2FuIG1ha2UgY2FsbHMgdG8gYSBzaW5nbGUgT2JzZXJ2ZXJcclxuICogICAgIGFzIGEgcHJveHkuXHJcbiAqIEBwYXJhbSBvbk5vT2JzZXJ2ZXJzIENhbGxiYWNrIHdoZW4gY291bnQgb2YgT2JzZXJ2ZXJzIGdvZXMgdG8gemVyby5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZShleGVjdXRvciwgb25Ob09ic2VydmVycykge1xyXG4gICAgY29uc3QgcHJveHkgPSBuZXcgT2JzZXJ2ZXJQcm94eShleGVjdXRvciwgb25Ob09ic2VydmVycyk7XHJcbiAgICByZXR1cm4gcHJveHkuc3Vic2NyaWJlLmJpbmQocHJveHkpO1xyXG59XHJcbi8qKlxyXG4gKiBJbXBsZW1lbnQgZmFuLW91dCBmb3IgYW55IG51bWJlciBvZiBPYnNlcnZlcnMgYXR0YWNoZWQgdmlhIGEgc3Vic2NyaWJlXHJcbiAqIGZ1bmN0aW9uLlxyXG4gKi9cclxuY2xhc3MgT2JzZXJ2ZXJQcm94eSB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBleGVjdXRvciBGdW5jdGlvbiB3aGljaCBjYW4gbWFrZSBjYWxscyB0byBhIHNpbmdsZSBPYnNlcnZlclxyXG4gICAgICogICAgIGFzIGEgcHJveHkuXHJcbiAgICAgKiBAcGFyYW0gb25Ob09ic2VydmVycyBDYWxsYmFjayB3aGVuIGNvdW50IG9mIE9ic2VydmVycyBnb2VzIHRvIHplcm8uXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKGV4ZWN1dG9yLCBvbk5vT2JzZXJ2ZXJzKSB7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlcyA9IFtdO1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJDb3VudCA9IDA7XHJcbiAgICAgICAgLy8gTWljcm8tdGFzayBzY2hlZHVsaW5nIGJ5IGNhbGxpbmcgdGFzay50aGVuKCkuXHJcbiAgICAgICAgdGhpcy50YXNrID0gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgdGhpcy5maW5hbGl6ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm9uTm9PYnNlcnZlcnMgPSBvbk5vT2JzZXJ2ZXJzO1xyXG4gICAgICAgIC8vIENhbGwgdGhlIGV4ZWN1dG9yIGFzeW5jaHJvbm91c2x5IHNvIHN1YnNjcmliZXJzIHRoYXQgYXJlIGNhbGxlZFxyXG4gICAgICAgIC8vIHN5bmNocm9ub3VzbHkgYWZ0ZXIgdGhlIGNyZWF0aW9uIG9mIHRoZSBzdWJzY3JpYmUgZnVuY3Rpb25cclxuICAgICAgICAvLyBjYW4gc3RpbGwgcmVjZWl2ZSB0aGUgdmVyeSBmaXJzdCB2YWx1ZSBnZW5lcmF0ZWQgaW4gdGhlIGV4ZWN1dG9yLlxyXG4gICAgICAgIHRoaXMudGFza1xyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4ZWN1dG9yKHRoaXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5lcnJvcihlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG5leHQodmFsdWUpIHtcclxuICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCh2YWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlcnJvcihlcnJvcikge1xyXG4gICAgICAgIHRoaXMuZm9yRWFjaE9ic2VydmVyKChvYnNlcnZlcikgPT4ge1xyXG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5jbG9zZShlcnJvcik7XHJcbiAgICB9XHJcbiAgICBjb21wbGV0ZSgpIHtcclxuICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmliZSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGFkZCBhbiBPYnNlcnZlciB0byB0aGUgZmFuLW91dCBsaXN0LlxyXG4gICAgICpcclxuICAgICAqIC0gV2UgcmVxdWlyZSB0aGF0IG5vIGV2ZW50IGlzIHNlbnQgdG8gYSBzdWJzY3JpYmVyIHN5Y2hyb25vdXNseSB0byB0aGVpclxyXG4gICAgICogICBjYWxsIHRvIHN1YnNjcmliZSgpLlxyXG4gICAgICovXHJcbiAgICBzdWJzY3JpYmUobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZSkge1xyXG4gICAgICAgIGxldCBvYnNlcnZlcjtcclxuICAgICAgICBpZiAobmV4dE9yT2JzZXJ2ZXIgPT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgICAgICBlcnJvciA9PT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgIGNvbXBsZXRlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIE9ic2VydmVyLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBBc3NlbWJsZSBhbiBPYnNlcnZlciBvYmplY3Qgd2hlbiBwYXNzZWQgYXMgY2FsbGJhY2sgZnVuY3Rpb25zLlxyXG4gICAgICAgIGlmIChpbXBsZW1lbnRzQW55TWV0aG9kcyhuZXh0T3JPYnNlcnZlciwgW1xyXG4gICAgICAgICAgICAnbmV4dCcsXHJcbiAgICAgICAgICAgICdlcnJvcicsXHJcbiAgICAgICAgICAgICdjb21wbGV0ZSdcclxuICAgICAgICBdKSkge1xyXG4gICAgICAgICAgICBvYnNlcnZlciA9IG5leHRPck9ic2VydmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIgPSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0OiBuZXh0T3JPYnNlcnZlcixcclxuICAgICAgICAgICAgICAgIGVycm9yLFxyXG4gICAgICAgICAgICAgICAgY29tcGxldGVcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9ic2VydmVyLm5leHQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0ID0gbm9vcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9ic2VydmVyLmVycm9yID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IgPSBub29wO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob2JzZXJ2ZXIuY29tcGxldGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSA9IG5vb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHVuc3ViID0gdGhpcy51bnN1YnNjcmliZU9uZS5iaW5kKHRoaXMsIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCk7XHJcbiAgICAgICAgLy8gQXR0ZW1wdCB0byBzdWJzY3JpYmUgdG8gYSB0ZXJtaW5hdGVkIE9ic2VydmFibGUgLSB3ZVxyXG4gICAgICAgIC8vIGp1c3QgcmVzcG9uZCB0byB0aGUgT2JzZXJ2ZXIgd2l0aCB0aGUgZmluYWwgZXJyb3Igb3IgY29tcGxldGVcclxuICAgICAgICAvLyBldmVudC5cclxuICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xyXG4gICAgICAgICAgICB0aGlzLnRhc2sudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZpbmFsRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5maW5hbEVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTtcclxuICAgICAgICByZXR1cm4gdW5zdWI7XHJcbiAgICB9XHJcbiAgICAvLyBVbnN1YnNjcmliZSBpcyBzeW5jaHJvbm91cyAtIHdlIGd1YXJhbnRlZSB0aGF0IG5vIGV2ZW50cyBhcmUgc2VudCB0b1xyXG4gICAgLy8gYW55IHVuc3Vic2NyaWJlZCBPYnNlcnZlci5cclxuICAgIHVuc3Vic2NyaWJlT25lKGkpIHtcclxuICAgICAgICBpZiAodGhpcy5vYnNlcnZlcnMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLm9ic2VydmVyc1tpXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVsZXRlIHRoaXMub2JzZXJ2ZXJzW2ldO1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJDb3VudCAtPSAxO1xyXG4gICAgICAgIGlmICh0aGlzLm9ic2VydmVyQ291bnQgPT09IDAgJiYgdGhpcy5vbk5vT2JzZXJ2ZXJzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvckVhY2hPYnNlcnZlcihmbikge1xyXG4gICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCkge1xyXG4gICAgICAgICAgICAvLyBBbHJlYWR5IGNsb3NlZCBieSBwcmV2aW91cyBldmVudC4uLi5qdXN0IGVhdCB0aGUgYWRkaXRpb25hbCB2YWx1ZXMuXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU2luY2Ugc2VuZE9uZSBjYWxscyBhc3luY2hyb25vdXNseSAtIHRoZXJlIGlzIG5vIGNoYW5jZSB0aGF0XHJcbiAgICAgICAgLy8gdGhpcy5vYnNlcnZlcnMgd2lsbCBiZWNvbWUgdW5kZWZpbmVkLlxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5vYnNlcnZlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5zZW5kT25lKGksIGZuKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBDYWxsIHRoZSBPYnNlcnZlciB2aWEgb25lIG9mIGl0J3MgY2FsbGJhY2sgZnVuY3Rpb24uIFdlIGFyZSBjYXJlZnVsIHRvXHJcbiAgICAvLyBjb25maXJtIHRoYXQgdGhlIG9ic2VydmUgaGFzIG5vdCBiZWVuIHVuc3Vic2NyaWJlZCBzaW5jZSB0aGlzIGFzeW5jaHJvbm91c1xyXG4gICAgLy8gZnVuY3Rpb24gaGFkIGJlZW4gcXVldWVkLlxyXG4gICAgc2VuZE9uZShpLCBmbikge1xyXG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIGNhbGxiYWNrIGFzeW5jaHJvbm91c2x5XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xyXG4gICAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJzICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vYnNlcnZlcnNbaV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBmbih0aGlzLm9ic2VydmVyc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBleGNlcHRpb25zIHJhaXNlZCBpbiBPYnNlcnZlcnMgb3IgbWlzc2luZyBtZXRob2RzIG9mIGFuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZXIuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGVycm9yIHRvIGNvbnNvbGUuIGIvMzE0MDQ4MDZcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGNsb3NlKGVycikge1xyXG4gICAgICAgIGlmICh0aGlzLmZpbmFsaXplZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZmluYWxpemVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAoZXJyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5maW5hbEVycm9yID0gZXJyO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBQcm94eSBpcyBubyBsb25nZXIgbmVlZGVkIC0gZ2FyYmFnZSBjb2xsZWN0IHJlZmVyZW5jZXNcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICAgICAgdGhpcy50YXNrLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm9ic2VydmVycyA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbi8qKiBUdXJuIHN5bmNocm9ub3VzIGZ1bmN0aW9uIGludG8gb25lIGNhbGxlZCBhc3luY2hyb25vdXNseS4gKi9cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHlwZXNcclxuZnVuY3Rpb24gYXN5bmMoZm4sIG9uRXJyb3IpIHtcclxuICAgIHJldHVybiAoLi4uYXJncykgPT4ge1xyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZSh0cnVlKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGZuKC4uLmFyZ3MpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgaWYgKG9uRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIG9uRXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG59XHJcbi8qKlxyXG4gKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgb2JqZWN0IHBhc3NlZCBpbiBpbXBsZW1lbnRzIGFueSBvZiB0aGUgbmFtZWQgbWV0aG9kcy5cclxuICovXHJcbmZ1bmN0aW9uIGltcGxlbWVudHNBbnlNZXRob2RzKG9iaiwgbWV0aG9kcykge1xyXG4gICAgaWYgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnIHx8IG9iaiA9PT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGZvciAoY29uc3QgbWV0aG9kIG9mIG1ldGhvZHMpIHtcclxuICAgICAgICBpZiAobWV0aG9kIGluIG9iaiAmJiB0eXBlb2Ygb2JqW21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcbmZ1bmN0aW9uIG5vb3AoKSB7XHJcbiAgICAvLyBkbyBub3RoaW5nXHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIENoZWNrIHRvIG1ha2Ugc3VyZSB0aGUgYXBwcm9wcmlhdGUgbnVtYmVyIG9mIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQgZm9yIGEgcHVibGljIGZ1bmN0aW9uLlxyXG4gKiBUaHJvd3MgYW4gZXJyb3IgaWYgaXQgZmFpbHMuXHJcbiAqXHJcbiAqIEBwYXJhbSBmbk5hbWUgVGhlIGZ1bmN0aW9uIG5hbWVcclxuICogQHBhcmFtIG1pbkNvdW50IFRoZSBtaW5pbXVtIG51bWJlciBvZiBhcmd1bWVudHMgdG8gYWxsb3cgZm9yIHRoZSBmdW5jdGlvbiBjYWxsXHJcbiAqIEBwYXJhbSBtYXhDb3VudCBUaGUgbWF4aW11bSBudW1iZXIgb2YgYXJndW1lbnQgdG8gYWxsb3cgZm9yIHRoZSBmdW5jdGlvbiBjYWxsXHJcbiAqIEBwYXJhbSBhcmdDb3VudCBUaGUgYWN0dWFsIG51bWJlciBvZiBhcmd1bWVudHMgcHJvdmlkZWQuXHJcbiAqL1xyXG5jb25zdCB2YWxpZGF0ZUFyZ0NvdW50ID0gZnVuY3Rpb24gKGZuTmFtZSwgbWluQ291bnQsIG1heENvdW50LCBhcmdDb3VudCkge1xyXG4gICAgbGV0IGFyZ0Vycm9yO1xyXG4gICAgaWYgKGFyZ0NvdW50IDwgbWluQ291bnQpIHtcclxuICAgICAgICBhcmdFcnJvciA9ICdhdCBsZWFzdCAnICsgbWluQ291bnQ7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChhcmdDb3VudCA+IG1heENvdW50KSB7XHJcbiAgICAgICAgYXJnRXJyb3IgPSBtYXhDb3VudCA9PT0gMCA/ICdub25lJyA6ICdubyBtb3JlIHRoYW4gJyArIG1heENvdW50O1xyXG4gICAgfVxyXG4gICAgaWYgKGFyZ0Vycm9yKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBmbk5hbWUgK1xyXG4gICAgICAgICAgICAnIGZhaWxlZDogV2FzIGNhbGxlZCB3aXRoICcgK1xyXG4gICAgICAgICAgICBhcmdDb3VudCArXHJcbiAgICAgICAgICAgIChhcmdDb3VudCA9PT0gMSA/ICcgYXJndW1lbnQuJyA6ICcgYXJndW1lbnRzLicpICtcclxuICAgICAgICAgICAgJyBFeHBlY3RzICcgK1xyXG4gICAgICAgICAgICBhcmdFcnJvciArXHJcbiAgICAgICAgICAgICcuJztcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICogR2VuZXJhdGVzIGEgc3RyaW5nIHRvIHByZWZpeCBhbiBlcnJvciBtZXNzYWdlIGFib3V0IGZhaWxlZCBhcmd1bWVudCB2YWxpZGF0aW9uXHJcbiAqXHJcbiAqIEBwYXJhbSBmbk5hbWUgVGhlIGZ1bmN0aW9uIG5hbWVcclxuICogQHBhcmFtIGFyZ05hbWUgVGhlIG5hbWUgb2YgdGhlIGFyZ3VtZW50XHJcbiAqIEByZXR1cm4gVGhlIHByZWZpeCB0byBhZGQgdG8gdGhlIGVycm9yIHRocm93biBmb3IgdmFsaWRhdGlvbi5cclxuICovXHJcbmZ1bmN0aW9uIGVycm9yUHJlZml4KGZuTmFtZSwgYXJnTmFtZSkge1xyXG4gICAgcmV0dXJuIGAke2ZuTmFtZX0gZmFpbGVkOiAke2FyZ05hbWV9IGFyZ3VtZW50IGA7XHJcbn1cclxuLyoqXHJcbiAqIEBwYXJhbSBmbk5hbWVcclxuICogQHBhcmFtIGFyZ3VtZW50TnVtYmVyXHJcbiAqIEBwYXJhbSBuYW1lc3BhY2VcclxuICogQHBhcmFtIG9wdGlvbmFsXHJcbiAqL1xyXG5mdW5jdGlvbiB2YWxpZGF0ZU5hbWVzcGFjZShmbk5hbWUsIG5hbWVzcGFjZSwgb3B0aW9uYWwpIHtcclxuICAgIGlmIChvcHRpb25hbCAmJiAhbmFtZXNwYWNlKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBuYW1lc3BhY2UgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgLy9UT0RPOiBJIHNob3VsZCBkbyBtb3JlIHZhbGlkYXRpb24gaGVyZS4gV2Ugb25seSBhbGxvdyBjZXJ0YWluIGNoYXJzIGluIG5hbWVzcGFjZXMuXHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4KGZuTmFtZSwgJ25hbWVzcGFjZScpICsgJ211c3QgYmUgYSB2YWxpZCBmaXJlYmFzZSBuYW1lc3BhY2UuJyk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gdmFsaWRhdGVDYWxsYmFjayhmbk5hbWUsIGFyZ3VtZW50TmFtZSwgXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXHJcbmNhbGxiYWNrLCBvcHRpb25hbCkge1xyXG4gICAgaWYgKG9wdGlvbmFsICYmICFjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCBhcmd1bWVudE5hbWUpICsgJ211c3QgYmUgYSB2YWxpZCBmdW5jdGlvbi4nKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiB2YWxpZGF0ZUNvbnRleHRPYmplY3QoZm5OYW1lLCBhcmd1bWVudE5hbWUsIGNvbnRleHQsIG9wdGlvbmFsKSB7XHJcbiAgICBpZiAob3B0aW9uYWwgJiYgIWNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGNvbnRleHQgIT09ICdvYmplY3QnIHx8IGNvbnRleHQgPT09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCBhcmd1bWVudE5hbWUpICsgJ211c3QgYmUgYSB2YWxpZCBjb250ZXh0IG9iamVjdC4nKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vLyBDb2RlIG9yaWdpbmFsbHkgY2FtZSBmcm9tIGdvb2cuY3J5cHQuc3RyaW5nVG9VdGY4Qnl0ZUFycmF5LCBidXQgZm9yIHNvbWUgcmVhc29uIHRoZXlcclxuLy8gYXV0b21hdGljYWxseSByZXBsYWNlZCAnXFxyXFxuJyB3aXRoICdcXG4nLCBhbmQgdGhleSBkaWRuJ3QgaGFuZGxlIHN1cnJvZ2F0ZSBwYWlycyxcclxuLy8gc28gaXQncyBiZWVuIG1vZGlmaWVkLlxyXG4vLyBOb3RlIHRoYXQgbm90IGFsbCBVbmljb2RlIGNoYXJhY3RlcnMgYXBwZWFyIGFzIHNpbmdsZSBjaGFyYWN0ZXJzIGluIEphdmFTY3JpcHQgc3RyaW5ncy5cclxuLy8gZnJvbUNoYXJDb2RlIHJldHVybnMgdGhlIFVURi0xNiBlbmNvZGluZyBvZiBhIGNoYXJhY3RlciAtIHNvIHNvbWUgVW5pY29kZSBjaGFyYWN0ZXJzXHJcbi8vIHVzZSAyIGNoYXJhY3RlcnMgaW4gSmF2YXNjcmlwdC4gIEFsbCA0LWJ5dGUgVVRGLTggY2hhcmFjdGVycyBiZWdpbiB3aXRoIGEgZmlyc3RcclxuLy8gY2hhcmFjdGVyIGluIHRoZSByYW5nZSAweEQ4MDAgLSAweERCRkYgKHRoZSBmaXJzdCBjaGFyYWN0ZXIgb2YgYSBzby1jYWxsZWQgc3Vycm9nYXRlXHJcbi8vIHBhaXIpLlxyXG4vLyBTZWUgaHR0cDovL3d3dy5lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzUuMS8jc2VjLTE1LjEuM1xyXG4vKipcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0clxyXG4gKiBAcmV0dXJuIHtBcnJheX1cclxuICovXHJcbmNvbnN0IHN0cmluZ1RvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgY29uc3Qgb3V0ID0gW107XHJcbiAgICBsZXQgcCA9IDA7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGxldCBjID0gc3RyLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgLy8gSXMgdGhpcyB0aGUgbGVhZCBzdXJyb2dhdGUgaW4gYSBzdXJyb2dhdGUgcGFpcj9cclxuICAgICAgICBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHtcclxuICAgICAgICAgICAgY29uc3QgaGlnaCA9IGMgLSAweGQ4MDA7IC8vIHRoZSBoaWdoIDEwIGJpdHMuXHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgYXNzZXJ0KGkgPCBzdHIubGVuZ3RoLCAnU3Vycm9nYXRlIHBhaXIgbWlzc2luZyB0cmFpbCBzdXJyb2dhdGUuJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxvdyA9IHN0ci5jaGFyQ29kZUF0KGkpIC0gMHhkYzAwOyAvLyB0aGUgbG93IDEwIGJpdHMuXHJcbiAgICAgICAgICAgIGMgPSAweDEwMDAwICsgKGhpZ2ggPDwgMTApICsgbG93O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYyA8IDEyOCkge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IGM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGMgPCAyMDQ4KSB7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gNikgfCAxOTI7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGMgPCA2NTUzNikge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDE4KSB8IDI0MDtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4O1xyXG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODtcclxuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3V0O1xyXG59O1xyXG4vKipcclxuICogQ2FsY3VsYXRlIGxlbmd0aCB3aXRob3V0IGFjdHVhbGx5IGNvbnZlcnRpbmc7IHVzZWZ1bCBmb3IgZG9pbmcgY2hlYXBlciB2YWxpZGF0aW9uLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXHJcbiAqIEByZXR1cm4ge251bWJlcn1cclxuICovXHJcbmNvbnN0IHN0cmluZ0xlbmd0aCA9IGZ1bmN0aW9uIChzdHIpIHtcclxuICAgIGxldCBwID0gMDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIGlmIChjIDwgMTI4KSB7XHJcbiAgICAgICAgICAgIHArKztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHtcclxuICAgICAgICAgICAgcCArPSAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjID49IDB4ZDgwMCAmJiBjIDw9IDB4ZGJmZikge1xyXG4gICAgICAgICAgICAvLyBMZWFkIHN1cnJvZ2F0ZSBvZiBhIHN1cnJvZ2F0ZSBwYWlyLiAgVGhlIHBhaXIgdG9nZXRoZXIgd2lsbCB0YWtlIDQgYnl0ZXMgdG8gcmVwcmVzZW50LlxyXG4gICAgICAgICAgICBwICs9IDQ7XHJcbiAgICAgICAgICAgIGkrKzsgLy8gc2tpcCB0cmFpbCBzdXJyb2dhdGUuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwICs9IDM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHA7XHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBDb3BpZWQgZnJvbSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMjExNzUyM1xyXG4gKiBHZW5lcmF0ZXMgYSBuZXcgdXVpZC5cclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgdXVpZHY0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuICd4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgnLnJlcGxhY2UoL1t4eV0vZywgYyA9PiB7XHJcbiAgICAgICAgY29uc3QgciA9IChNYXRoLnJhbmRvbSgpICogMTYpIHwgMCwgdiA9IGMgPT09ICd4JyA/IHIgOiAociAmIDB4MykgfCAweDg7XHJcbiAgICAgICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xyXG4gICAgfSk7XHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaGUgYW1vdW50IG9mIG1pbGxpc2Vjb25kcyB0byBleHBvbmVudGlhbGx5IGluY3JlYXNlLlxyXG4gKi9cclxuY29uc3QgREVGQVVMVF9JTlRFUlZBTF9NSUxMSVMgPSAxMDAwO1xyXG4vKipcclxuICogVGhlIGZhY3RvciB0byBiYWNrb2ZmIGJ5LlxyXG4gKiBTaG91bGQgYmUgYSBudW1iZXIgZ3JlYXRlciB0aGFuIDEuXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX0JBQ0tPRkZfRkFDVE9SID0gMjtcclxuLyoqXHJcbiAqIFRoZSBtYXhpbXVtIG1pbGxpc2Vjb25kcyB0byBpbmNyZWFzZSB0by5cclxuICpcclxuICogPHA+VmlzaWJsZSBmb3IgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgTUFYX1ZBTFVFX01JTExJUyA9IDQgKiA2MCAqIDYwICogMTAwMDsgLy8gRm91ciBob3VycywgbGlrZSBpT1MgYW5kIEFuZHJvaWQuXHJcbi8qKlxyXG4gKiBUaGUgcGVyY2VudGFnZSBvZiBiYWNrb2ZmIHRpbWUgdG8gcmFuZG9taXplIGJ5LlxyXG4gKiBTZWVcclxuICogaHR0cDovL2dvL3NhZmUtY2xpZW50LWJlaGF2aW9yI3N0ZXAtMS1kZXRlcm1pbmUtdGhlLWFwcHJvcHJpYXRlLXJldHJ5LWludGVydmFsLXRvLWhhbmRsZS1zcGlrZS10cmFmZmljXHJcbiAqIGZvciBjb250ZXh0LlxyXG4gKlxyXG4gKiA8cD5WaXNpYmxlIGZvciB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBSQU5ET01fRkFDVE9SID0gMC41O1xyXG4vKipcclxuICogQmFzZWQgb24gdGhlIGJhY2tvZmYgbWV0aG9kIGZyb21cclxuICogaHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS9jbG9zdXJlLWxpYnJhcnkvYmxvYi9tYXN0ZXIvY2xvc3VyZS9nb29nL21hdGgvZXhwb25lbnRpYWxiYWNrb2ZmLmpzLlxyXG4gKiBFeHRyYWN0ZWQgaGVyZSBzbyB3ZSBkb24ndCBuZWVkIHRvIHBhc3MgbWV0YWRhdGEgYW5kIGEgc3RhdGVmdWwgRXhwb25lbnRpYWxCYWNrb2ZmIG9iamVjdCBhcm91bmQuXHJcbiAqL1xyXG5mdW5jdGlvbiBjYWxjdWxhdGVCYWNrb2ZmTWlsbGlzKGJhY2tvZmZDb3VudCwgaW50ZXJ2YWxNaWxsaXMgPSBERUZBVUxUX0lOVEVSVkFMX01JTExJUywgYmFja29mZkZhY3RvciA9IERFRkFVTFRfQkFDS09GRl9GQUNUT1IpIHtcclxuICAgIC8vIENhbGN1bGF0ZXMgYW4gZXhwb25lbnRpYWxseSBpbmNyZWFzaW5nIHZhbHVlLlxyXG4gICAgLy8gRGV2aWF0aW9uOiBjYWxjdWxhdGVzIHZhbHVlIGZyb20gY291bnQgYW5kIGEgY29uc3RhbnQgaW50ZXJ2YWwsIHNvIHdlIG9ubHkgbmVlZCB0byBzYXZlIHZhbHVlXHJcbiAgICAvLyBhbmQgY291bnQgdG8gcmVzdG9yZSBzdGF0ZS5cclxuICAgIGNvbnN0IGN1cnJCYXNlVmFsdWUgPSBpbnRlcnZhbE1pbGxpcyAqIE1hdGgucG93KGJhY2tvZmZGYWN0b3IsIGJhY2tvZmZDb3VudCk7XHJcbiAgICAvLyBBIHJhbmRvbSBcImZ1enpcIiB0byBhdm9pZCB3YXZlcyBvZiByZXRyaWVzLlxyXG4gICAgLy8gRGV2aWF0aW9uOiByYW5kb21GYWN0b3IgaXMgcmVxdWlyZWQuXHJcbiAgICBjb25zdCByYW5kb21XYWl0ID0gTWF0aC5yb3VuZChcclxuICAgIC8vIEEgZnJhY3Rpb24gb2YgdGhlIGJhY2tvZmYgdmFsdWUgdG8gYWRkL3N1YnRyYWN0LlxyXG4gICAgLy8gRGV2aWF0aW9uOiBjaGFuZ2VzIG11bHRpcGxpY2F0aW9uIG9yZGVyIHRvIGltcHJvdmUgcmVhZGFiaWxpdHkuXHJcbiAgICBSQU5ET01fRkFDVE9SICpcclxuICAgICAgICBjdXJyQmFzZVZhbHVlICpcclxuICAgICAgICAvLyBBIHJhbmRvbSBmbG9hdCAocm91bmRlZCB0byBpbnQgYnkgTWF0aC5yb3VuZCBhYm92ZSkgaW4gdGhlIHJhbmdlIFstMSwgMV0uIERldGVybWluZXNcclxuICAgICAgICAvLyBpZiB3ZSBhZGQgb3Igc3VidHJhY3QuXHJcbiAgICAgICAgKE1hdGgucmFuZG9tKCkgLSAwLjUpICpcclxuICAgICAgICAyKTtcclxuICAgIC8vIExpbWl0cyBiYWNrb2ZmIHRvIG1heCB0byBhdm9pZCBlZmZlY3RpdmVseSBwZXJtYW5lbnQgYmFja29mZi5cclxuICAgIHJldHVybiBNYXRoLm1pbihNQVhfVkFMVUVfTUlMTElTLCBjdXJyQmFzZVZhbHVlICsgcmFuZG9tV2FpdCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFByb3ZpZGUgRW5nbGlzaCBvcmRpbmFsIGxldHRlcnMgYWZ0ZXIgYSBudW1iZXJcclxuICovXHJcbmZ1bmN0aW9uIG9yZGluYWwoaSkge1xyXG4gICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoaSkpIHtcclxuICAgICAgICByZXR1cm4gYCR7aX1gO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGkgKyBpbmRpY2F0b3IoaSk7XHJcbn1cclxuZnVuY3Rpb24gaW5kaWNhdG9yKGkpIHtcclxuICAgIGkgPSBNYXRoLmFicyhpKTtcclxuICAgIGNvbnN0IGNlbnQgPSBpICUgMTAwO1xyXG4gICAgaWYgKGNlbnQgPj0gMTAgJiYgY2VudCA8PSAyMCkge1xyXG4gICAgICAgIHJldHVybiAndGgnO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGVjID0gaSAlIDEwO1xyXG4gICAgaWYgKGRlYyA9PT0gMSkge1xyXG4gICAgICAgIHJldHVybiAnc3QnO1xyXG4gICAgfVxyXG4gICAgaWYgKGRlYyA9PT0gMikge1xyXG4gICAgICAgIHJldHVybiAnbmQnO1xyXG4gICAgfVxyXG4gICAgaWYgKGRlYyA9PT0gMykge1xyXG4gICAgICAgIHJldHVybiAncmQnO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICd0aCc7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0TW9kdWxhckluc3RhbmNlKHNlcnZpY2UpIHtcclxuICAgIGlmIChzZXJ2aWNlICYmIHNlcnZpY2UuX2RlbGVnYXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2UuX2RlbGVnYXRlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICB9XHJcbn1cblxuZXhwb3J0IHsgQ09OU1RBTlRTLCBEZWZlcnJlZCwgRXJyb3JGYWN0b3J5LCBGaXJlYmFzZUVycm9yLCBNQVhfVkFMVUVfTUlMTElTLCBSQU5ET01fRkFDVE9SLCBTaGExLCBhcmVDb29raWVzRW5hYmxlZCwgYXNzZXJ0LCBhc3NlcnRpb25FcnJvciwgYXN5bmMsIGJhc2U2NCwgYmFzZTY0RGVjb2RlLCBiYXNlNjRFbmNvZGUsIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nLCBjYWxjdWxhdGVCYWNrb2ZmTWlsbGlzLCBjb250YWlucywgY3JlYXRlTW9ja1VzZXJUb2tlbiwgY3JlYXRlU3Vic2NyaWJlLCBkZWNvZGUsIGRlZXBDb3B5LCBkZWVwRXF1YWwsIGRlZXBFeHRlbmQsIGVycm9yUHJlZml4LCBleHRyYWN0UXVlcnlzdHJpbmcsIGdldERlZmF1bHRBcHBDb25maWcsIGdldERlZmF1bHRFbXVsYXRvckhvc3QsIGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCwgZ2V0RGVmYXVsdHMsIGdldEV4cGVyaW1lbnRhbFNldHRpbmcsIGdldEdsb2JhbCwgZ2V0TW9kdWxhckluc3RhbmNlLCBnZXRVQSwgaXNBZG1pbiwgaXNCcm93c2VyLCBpc0Jyb3dzZXJFeHRlbnNpb24sIGlzRWxlY3Ryb24sIGlzRW1wdHksIGlzSUUsIGlzSW5kZXhlZERCQXZhaWxhYmxlLCBpc01vYmlsZUNvcmRvdmEsIGlzTm9kZSwgaXNOb2RlU2RrLCBpc1JlYWN0TmF0aXZlLCBpc1NhZmFyaSwgaXNVV1AsIGlzVmFsaWRGb3JtYXQsIGlzVmFsaWRUaW1lc3RhbXAsIGlzc3VlZEF0VGltZSwganNvbkV2YWwsIG1hcCwgb3JkaW5hbCwgcHJvbWlzZVdpdGhUaW1lb3V0LCBxdWVyeXN0cmluZywgcXVlcnlzdHJpbmdEZWNvZGUsIHNhZmVHZXQsIHN0cmluZ0xlbmd0aCwgc3RyaW5nVG9CeXRlQXJyYXksIHN0cmluZ2lmeSwgdXVpZHY0LCB2YWxpZGF0ZUFyZ0NvdW50LCB2YWxpZGF0ZUNhbGxiYWNrLCB2YWxpZGF0ZUNvbnRleHRPYmplY3QsIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUsIHZhbGlkYXRlTmFtZXNwYWNlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgRGVmZXJyZWQgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5cbi8qKlxyXG4gKiBDb21wb25lbnQgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgXHJcbiAqL1xyXG5jbGFzcyBDb21wb25lbnQge1xyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIHB1YmxpYyBzZXJ2aWNlIG5hbWUsIGUuZy4gYXBwLCBhdXRoLCBmaXJlc3RvcmUsIGRhdGFiYXNlXHJcbiAgICAgKiBAcGFyYW0gaW5zdGFuY2VGYWN0b3J5IFNlcnZpY2UgZmFjdG9yeSByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIHB1YmxpYyBpbnRlcmZhY2VcclxuICAgICAqIEBwYXJhbSB0eXBlIHdoZXRoZXIgdGhlIHNlcnZpY2UgcHJvdmlkZWQgYnkgdGhlIGNvbXBvbmVudCBpcyBwdWJsaWMgb3IgcHJpdmF0ZVxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBpbnN0YW5jZUZhY3RvcnksIHR5cGUpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VGYWN0b3J5ID0gaW5zdGFuY2VGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IGZhbHNlO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFByb3BlcnRpZXMgdG8gYmUgYWRkZWQgdG8gdGhlIHNlcnZpY2UgbmFtZXNwYWNlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlUHJvcHMgPSB7fTtcclxuICAgICAgICB0aGlzLmluc3RhbnRpYXRpb25Nb2RlID0gXCJMQVpZXCIgLyogSW5zdGFudGlhdGlvbk1vZGUuTEFaWSAqLztcclxuICAgICAgICB0aGlzLm9uSW5zdGFuY2VDcmVhdGVkID0gbnVsbDtcclxuICAgIH1cclxuICAgIHNldEluc3RhbnRpYXRpb25Nb2RlKG1vZGUpIHtcclxuICAgICAgICB0aGlzLmluc3RhbnRpYXRpb25Nb2RlID0gbW9kZTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNldE11bHRpcGxlSW5zdGFuY2VzKG11bHRpcGxlSW5zdGFuY2VzKSB7XHJcbiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IG11bHRpcGxlSW5zdGFuY2VzO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2V0U2VydmljZVByb3BzKHByb3BzKSB7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlUHJvcHMgPSBwcm9wcztcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNldEluc3RhbmNlQ3JlYXRlZENhbGxiYWNrKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdGhpcy5vbkluc3RhbmNlQ3JlYXRlZCA9IGNhbGxiYWNrO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSA9ICdbREVGQVVMVF0nO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGluc3RhbmNlIGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiAnYXV0aCcsICdhdXRoLWludGVybmFsJ1xyXG4gKiBOYW1lU2VydmljZU1hcHBpbmdbVF0gaXMgYW4gYWxpYXMgZm9yIHRoZSB0eXBlIG9mIHRoZSBpbnN0YW5jZVxyXG4gKi9cclxuY2xhc3MgUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IobmFtZSwgY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXMgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZCA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgdGhpcy5vbkluaXRDYWxsYmFja3MgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEEgcHJvdmlkZXIgY2FuIHByb3ZpZGUgbXVsaXRwbGUgaW5zdGFuY2VzIG9mIGEgc2VydmljZVxyXG4gICAgICogaWYgdGhpcy5jb21wb25lbnQubXVsdGlwbGVJbnN0YW5jZXMgaXMgdHJ1ZS5cclxuICAgICAqL1xyXG4gICAgZ2V0KGlkZW50aWZpZXIpIHtcclxuICAgICAgICAvLyBpZiBtdWx0aXBsZUluc3RhbmNlcyBpcyBub3Qgc3VwcG9ydGVkLCB1c2UgdGhlIGRlZmF1bHQgbmFtZVxyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllcik7XHJcbiAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlc0RlZmVycmVkLmhhcyhub3JtYWxpemVkSWRlbnRpZmllcikpIHtcclxuICAgICAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5zZXQobm9ybWFsaXplZElkZW50aWZpZXIsIGRlZmVycmVkKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdWxkQXV0b0luaXRpYWxpemUoKSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc2VydmljZSBpZiBpdCBjYW4gYmUgYXV0by1pbml0aWFsaXplZFxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIGdldCgpLCBpdCBzaG91bGQgbm90IGNhdXNlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvci4gV2UganVzdCByZXR1cm4gdGhlIHVucmVzb2x2ZWQgcHJvbWlzZSBpbiB0aGlzIGNhc2UuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKS5wcm9taXNlO1xyXG4gICAgfVxyXG4gICAgZ2V0SW1tZWRpYXRlKG9wdGlvbnMpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgLy8gaWYgbXVsdGlwbGVJbnN0YW5jZXMgaXMgbm90IHN1cHBvcnRlZCwgdXNlIHRoZSBkZWZhdWx0IG5hbWVcclxuICAgICAgICBjb25zdCBub3JtYWxpemVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5pZGVudGlmaWVyKTtcclxuICAgICAgICBjb25zdCBvcHRpb25hbCA9IChfYSA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5vcHRpb25hbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikgfHxcclxuICAgICAgICAgICAgdGhpcy5zaG91bGRBdXRvSW5pdGlhbGl6ZSgpKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBJbiBjYXNlIGEgY29tcG9uZW50IGlzIG5vdCBpbml0aWFsaXplZCBhbmQgc2hvdWxkL2NhbiBub3QgYmUgYXV0by1pbml0aWFsaXplZCBhdCB0aGUgbW9tZW50LCByZXR1cm4gbnVsbCBpZiB0aGUgb3B0aW9uYWwgZmxhZyBpcyBzZXQsIG9yIHRocm93XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25hbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgU2VydmljZSAke3RoaXMubmFtZX0gaXMgbm90IGF2YWlsYWJsZWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0Q29tcG9uZW50KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudDtcclxuICAgIH1cclxuICAgIHNldENvbXBvbmVudChjb21wb25lbnQpIHtcclxuICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgIT09IHRoaXMubmFtZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgTWlzbWF0Y2hpbmcgQ29tcG9uZW50ICR7Y29tcG9uZW50Lm5hbWV9IGZvciBQcm92aWRlciAke3RoaXMubmFtZX0uYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgQ29tcG9uZW50IGZvciAke3RoaXMubmFtZX0gaGFzIGFscmVhZHkgYmVlbiBwcm92aWRlZGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudDtcclxuICAgICAgICAvLyByZXR1cm4gZWFybHkgd2l0aG91dCBhdHRlbXB0aW5nIHRvIGluaXRpYWxpemUgdGhlIGNvbXBvbmVudCBpZiB0aGUgY29tcG9uZW50IHJlcXVpcmVzIGV4cGxpY2l0IGluaXRpYWxpemF0aW9uIChjYWxsaW5nIGBQcm92aWRlci5pbml0aWFsaXplKClgKVxyXG4gICAgICAgIGlmICghdGhpcy5zaG91bGRBdXRvSW5pdGlhbGl6ZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgdGhlIHNlcnZpY2UgaXMgZWFnZXIsIGluaXRpYWxpemUgdGhlIGRlZmF1bHQgaW5zdGFuY2VcclxuICAgICAgICBpZiAoaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoeyBpbnN0YW5jZUlkZW50aWZpZXI6IERFRkFVTFRfRU5UUllfTkFNRSB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gd2hlbiB0aGUgaW5zdGFuY2UgZmFjdG9yeSBmb3IgYW4gZWFnZXIgQ29tcG9uZW50IHRocm93cyBhbiBleGNlcHRpb24gZHVyaW5nIHRoZSBlYWdlclxyXG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6YXRpb24sIGl0IHNob3VsZCBub3QgY2F1c2UgYSBmYXRhbCBlcnJvci5cclxuICAgICAgICAgICAgICAgIC8vIFRPRE86IEludmVzdGlnYXRlIGlmIHdlIG5lZWQgdG8gbWFrZSBpdCBjb25maWd1cmFibGUsIGJlY2F1c2Ugc29tZSBjb21wb25lbnQgbWF5IHdhbnQgdG8gY2F1c2VcclxuICAgICAgICAgICAgICAgIC8vIGEgZmF0YWwgZXJyb3IgaW4gdGhpcyBjYXNlP1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIENyZWF0ZSBzZXJ2aWNlIGluc3RhbmNlcyBmb3IgdGhlIHBlbmRpbmcgcHJvbWlzZXMgYW5kIHJlc29sdmUgdGhlbVxyXG4gICAgICAgIC8vIE5PVEU6IGlmIHRoaXMubXVsdGlwbGVJbnN0YW5jZXMgaXMgZmFsc2UsIG9ubHkgdGhlIGRlZmF1bHQgaW5zdGFuY2Ugd2lsbCBiZSBjcmVhdGVkXHJcbiAgICAgICAgLy8gYW5kIGFsbCBwcm9taXNlcyB3aXRoIHJlc29sdmUgd2l0aCBpdCByZWdhcmRsZXNzIG9mIHRoZSBpZGVudGlmaWVyLlxyXG4gICAgICAgIGZvciAoY29uc3QgW2luc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2VEZWZlcnJlZF0gb2YgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpbnN0YW5jZUlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgLy8gYGdldE9ySW5pdGlhbGl6ZVNlcnZpY2UoKWAgc2hvdWxkIGFsd2F5cyByZXR1cm4gYSB2YWxpZCBpbnN0YW5jZSBzaW5jZSBhIGNvbXBvbmVudCBpcyBndWFyYW50ZWVkLiB1c2UgISB0byBtYWtlIHR5cGVzY3JpcHQgaGFwcHkuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2VJZGVudGlmaWVyOiBub3JtYWxpemVkSWRlbnRpZmllclxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZURlZmVycmVkLnJlc29sdmUoaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24sIGl0IHNob3VsZCBub3QgY2F1c2VcclxuICAgICAgICAgICAgICAgIC8vIGEgZmF0YWwgZXJyb3IuIFdlIGp1c3QgbGVhdmUgdGhlIHByb21pc2UgdW5yZXNvbHZlZC5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNsZWFySW5zdGFuY2UoaWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZGVsZXRlKGlkZW50aWZpZXIpO1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2VzT3B0aW9ucy5kZWxldGUoaWRlbnRpZmllcik7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZXMuZGVsZXRlKGlkZW50aWZpZXIpO1xyXG4gICAgfVxyXG4gICAgLy8gYXBwLmRlbGV0ZSgpIHdpbGwgY2FsbCB0aGlzIG1ldGhvZCBvbiBldmVyeSBwcm92aWRlciB0byBkZWxldGUgdGhlIHNlcnZpY2VzXHJcbiAgICAvLyBUT0RPOiBzaG91bGQgd2UgbWFyayB0aGUgcHJvdmlkZXIgYXMgZGVsZXRlZD9cclxuICAgIGFzeW5jIGRlbGV0ZSgpIHtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlcyA9IEFycmF5LmZyb20odGhpcy5pbnN0YW5jZXMudmFsdWVzKCkpO1xyXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgLi4uc2VydmljZXNcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoc2VydmljZSA9PiAnSU5URVJOQUwnIGluIHNlcnZpY2UpIC8vIGxlZ2FjeSBzZXJ2aWNlc1xyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICAgICAgICAgIC5tYXAoc2VydmljZSA9PiBzZXJ2aWNlLklOVEVSTkFMLmRlbGV0ZSgpKSxcclxuICAgICAgICAgICAgLi4uc2VydmljZXNcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoc2VydmljZSA9PiAnX2RlbGV0ZScgaW4gc2VydmljZSkgLy8gbW9kdWxhcml6ZWQgc2VydmljZXNcclxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgICAgICAgICAgICAgICAubWFwKHNlcnZpY2UgPT4gc2VydmljZS5fZGVsZXRlKCkpXHJcbiAgICAgICAgXSk7XHJcbiAgICB9XHJcbiAgICBpc0NvbXBvbmVudFNldCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21wb25lbnQgIT0gbnVsbDtcclxuICAgIH1cclxuICAgIGlzSW5pdGlhbGl6ZWQoaWRlbnRpZmllciA9IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlcy5oYXMoaWRlbnRpZmllcik7XHJcbiAgICB9XHJcbiAgICBnZXRPcHRpb25zKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZXNPcHRpb25zLmdldChpZGVudGlmaWVyKSB8fCB7fTtcclxuICAgIH1cclxuICAgIGluaXRpYWxpemUob3B0cyA9IHt9KSB7XHJcbiAgICAgICAgY29uc3QgeyBvcHRpb25zID0ge30gfSA9IG9wdHM7XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihvcHRzLmluc3RhbmNlSWRlbnRpZmllcik7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZChub3JtYWxpemVkSWRlbnRpZmllcikpIHtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYCR7dGhpcy5uYW1lfSgke25vcm1hbGl6ZWRJZGVudGlmaWVyfSkgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXplZGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuaXNDb21wb25lbnRTZXQoKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgQ29tcG9uZW50ICR7dGhpcy5uYW1lfSBoYXMgbm90IGJlZW4gcmVnaXN0ZXJlZCB5ZXRgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmdldE9ySW5pdGlhbGl6ZVNlcnZpY2Uoe1xyXG4gICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZWRJZGVudGlmaWVyLFxyXG4gICAgICAgICAgICBvcHRpb25zXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gcmVzb2x2ZSBhbnkgcGVuZGluZyBwcm9taXNlIHdhaXRpbmcgZm9yIHRoZSBzZXJ2aWNlIGluc3RhbmNlXHJcbiAgICAgICAgZm9yIChjb25zdCBbaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZURlZmVycmVkXSBvZiB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmVudHJpZXMoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBub3JtYWxpemVkRGVmZXJyZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaW5zdGFuY2VJZGVudGlmaWVyKTtcclxuICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRJZGVudGlmaWVyID09PSBub3JtYWxpemVkRGVmZXJyZWRJZGVudGlmaWVyKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZURlZmVycmVkLnJlc29sdmUoaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGludm9rZWQgIGFmdGVyIHRoZSBwcm92aWRlciBoYXMgYmVlbiBpbml0aWFsaXplZCBieSBjYWxsaW5nIHByb3ZpZGVyLmluaXRpYWxpemUoKS5cclxuICAgICAqIFRoZSBmdW5jdGlvbiBpcyBpbnZva2VkIFNZTkNIUk9OT1VTTFksIHNvIGl0IHNob3VsZCBub3QgZXhlY3V0ZSBhbnkgbG9uZ3J1bm5pbmcgdGFza3MgaW4gb3JkZXIgdG8gbm90IGJsb2NrIHRoZSBwcm9ncmFtLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZGVudGlmaWVyIEFuIG9wdGlvbmFsIGluc3RhbmNlIGlkZW50aWZpZXJcclxuICAgICAqIEByZXR1cm5zIGEgZnVuY3Rpb24gdG8gdW5yZWdpc3RlciB0aGUgY2FsbGJhY2tcclxuICAgICAqL1xyXG4gICAgb25Jbml0KGNhbGxiYWNrLCBpZGVudGlmaWVyKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllcik7XHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDYWxsYmFja3MgPSAoX2EgPSB0aGlzLm9uSW5pdENhbGxiYWNrcy5nZXQobm9ybWFsaXplZElkZW50aWZpZXIpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBuZXcgU2V0KCk7XHJcbiAgICAgICAgZXhpc3RpbmdDYWxsYmFja3MuYWRkKGNhbGxiYWNrKTtcclxuICAgICAgICB0aGlzLm9uSW5pdENhbGxiYWNrcy5zZXQobm9ybWFsaXplZElkZW50aWZpZXIsIGV4aXN0aW5nQ2FsbGJhY2tzKTtcclxuICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5pbnN0YW5jZXMuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKTtcclxuICAgICAgICBpZiAoZXhpc3RpbmdJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhleGlzdGluZ0luc3RhbmNlLCBub3JtYWxpemVkSWRlbnRpZmllcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgICAgIGV4aXN0aW5nQ2FsbGJhY2tzLmRlbGV0ZShjYWxsYmFjayk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSW52b2tlIG9uSW5pdCBjYWxsYmFja3Mgc3luY2hyb25vdXNseVxyXG4gICAgICogQHBhcmFtIGluc3RhbmNlIHRoZSBzZXJ2aWNlIGluc3RhbmNlYFxyXG4gICAgICovXHJcbiAgICBpbnZva2VPbkluaXRDYWxsYmFja3MoaW5zdGFuY2UsIGlkZW50aWZpZXIpIHtcclxuICAgICAgICBjb25zdCBjYWxsYmFja3MgPSB0aGlzLm9uSW5pdENhbGxiYWNrcy5nZXQoaWRlbnRpZmllcik7XHJcbiAgICAgICAgaWYgKCFjYWxsYmFja3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IGNhbGxiYWNrIG9mIGNhbGxiYWNrcykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soaW5zdGFuY2UsIGlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICAgICAgLy8gaWdub3JlIGVycm9ycyBpbiB0aGUgb25Jbml0IGNhbGxiYWNrXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRPckluaXRpYWxpemVTZXJ2aWNlKHsgaW5zdGFuY2VJZGVudGlmaWVyLCBvcHRpb25zID0ge30gfSkge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2VzLmdldChpbnN0YW5jZUlkZW50aWZpZXIpO1xyXG4gICAgICAgIGlmICghaW5zdGFuY2UgJiYgdGhpcy5jb21wb25lbnQpIHtcclxuICAgICAgICAgICAgaW5zdGFuY2UgPSB0aGlzLmNvbXBvbmVudC5pbnN0YW5jZUZhY3RvcnkodGhpcy5jb250YWluZXIsIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplSWRlbnRpZmllckZvckZhY3RvcnkoaW5zdGFuY2VJZGVudGlmaWVyKSxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2VzLnNldChpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlKTtcclxuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXNPcHRpb25zLnNldChpbnN0YW5jZUlkZW50aWZpZXIsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogSW52b2tlIG9uSW5pdCBsaXN0ZW5lcnMuXHJcbiAgICAgICAgICAgICAqIE5vdGUgdGhpcy5jb21wb25lbnQub25JbnN0YW5jZUNyZWF0ZWQgaXMgZGlmZmVyZW50LCB3aGljaCBpcyB1c2VkIGJ5IHRoZSBjb21wb25lbnQgY3JlYXRvcixcclxuICAgICAgICAgICAgICogd2hpbGUgb25Jbml0IGxpc3RlbmVycyBhcmUgcmVnaXN0ZXJlZCBieSBjb25zdW1lcnMgb2YgdGhlIHByb3ZpZGVyLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdGhpcy5pbnZva2VPbkluaXRDYWxsYmFja3MoaW5zdGFuY2UsIGluc3RhbmNlSWRlbnRpZmllcik7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBPcmRlciBpcyBpbXBvcnRhbnRcclxuICAgICAgICAgICAgICogb25JbnN0YW5jZUNyZWF0ZWQoKSBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIHRoaXMuaW5zdGFuY2VzLnNldChpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlKTsgd2hpY2hcclxuICAgICAgICAgICAgICogbWFrZXMgYGlzSW5pdGlhbGl6ZWQoKWAgcmV0dXJuIHRydWUuXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb21wb25lbnQub25JbnN0YW5jZUNyZWF0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wb25lbnQub25JbnN0YW5jZUNyZWF0ZWQodGhpcy5jb250YWluZXIsIGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIGVycm9ycyBpbiB0aGUgb25JbnN0YW5jZUNyZWF0ZWRDYWxsYmFja1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZSB8fCBudWxsO1xyXG4gICAgfVxyXG4gICAgbm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUpIHtcclxuICAgICAgICBpZiAodGhpcy5jb21wb25lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50Lm11bHRpcGxlSW5zdGFuY2VzID8gaWRlbnRpZmllciA6IERFRkFVTFRfRU5UUllfTkFNRTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyOyAvLyBhc3N1bWUgbXVsdGlwbGUgaW5zdGFuY2VzIGFyZSBzdXBwb3J0ZWQgYmVmb3JlIHRoZSBjb21wb25lbnQgaXMgcHJvdmlkZWQuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2hvdWxkQXV0b0luaXRpYWxpemUoKSB7XHJcbiAgICAgICAgcmV0dXJuICghIXRoaXMuY29tcG9uZW50ICYmXHJcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lmluc3RhbnRpYXRpb25Nb2RlICE9PSBcIkVYUExJQ0lUXCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVQgKi8pO1xyXG4gICAgfVxyXG59XHJcbi8vIHVuZGVmaW5lZCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBzZXJ2aWNlIGZhY3RvcnkgZm9yIHRoZSBkZWZhdWx0IGluc3RhbmNlXHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZUlkZW50aWZpZXJGb3JGYWN0b3J5KGlkZW50aWZpZXIpIHtcclxuICAgIHJldHVybiBpZGVudGlmaWVyID09PSBERUZBVUxUX0VOVFJZX05BTUUgPyB1bmRlZmluZWQgOiBpZGVudGlmaWVyO1xyXG59XHJcbmZ1bmN0aW9uIGlzQ29tcG9uZW50RWFnZXIoY29tcG9uZW50KSB7XHJcbiAgICByZXR1cm4gY29tcG9uZW50Lmluc3RhbnRpYXRpb25Nb2RlID09PSBcIkVBR0VSXCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRUFHRVIgKi87XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIENvbXBvbmVudENvbnRhaW5lciB0aGF0IHByb3ZpZGVzIFByb3ZpZGVycyBmb3Igc2VydmljZSBuYW1lIFQsIGUuZy4gYGF1dGhgLCBgYXV0aC1pbnRlcm5hbGBcclxuICovXHJcbmNsYXNzIENvbXBvbmVudENvbnRhaW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnByb3ZpZGVycyA9IG5ldyBNYXAoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb21wb25lbnQgQ29tcG9uZW50IGJlaW5nIGFkZGVkXHJcbiAgICAgKiBAcGFyYW0gb3ZlcndyaXRlIFdoZW4gYSBjb21wb25lbnQgd2l0aCB0aGUgc2FtZSBuYW1lIGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCxcclxuICAgICAqIGlmIG92ZXJ3cml0ZSBpcyB0cnVlOiBvdmVyd3JpdGUgdGhlIGV4aXN0aW5nIGNvbXBvbmVudCB3aXRoIHRoZSBuZXcgY29tcG9uZW50IGFuZCBjcmVhdGUgYSBuZXdcclxuICAgICAqIHByb3ZpZGVyIHdpdGggdGhlIG5ldyBjb21wb25lbnQuIEl0IGNhbiBiZSB1c2VmdWwgaW4gdGVzdHMgd2hlcmUgeW91IHdhbnQgdG8gdXNlIGRpZmZlcmVudCBtb2Nrc1xyXG4gICAgICogZm9yIGRpZmZlcmVudCB0ZXN0cy5cclxuICAgICAqIGlmIG92ZXJ3cml0ZSBpcyBmYWxzZTogdGhyb3cgYW4gZXhjZXB0aW9uXHJcbiAgICAgKi9cclxuICAgIGFkZENvbXBvbmVudChjb21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuZ2V0UHJvdmlkZXIoY29tcG9uZW50Lm5hbWUpO1xyXG4gICAgICAgIGlmIChwcm92aWRlci5pc0NvbXBvbmVudFNldCgpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29tcG9uZW50ICR7Y29tcG9uZW50Lm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcmVnaXN0ZXJlZCB3aXRoICR7dGhpcy5uYW1lfWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm92aWRlci5zZXRDb21wb25lbnQoY29tcG9uZW50KTtcclxuICAgIH1cclxuICAgIGFkZE9yT3ZlcndyaXRlQ29tcG9uZW50KGNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5nZXRQcm92aWRlcihjb21wb25lbnQubmFtZSk7XHJcbiAgICAgICAgaWYgKHByb3ZpZGVyLmlzQ29tcG9uZW50U2V0KCkpIHtcclxuICAgICAgICAgICAgLy8gZGVsZXRlIHRoZSBleGlzdGluZyBwcm92aWRlciBmcm9tIHRoZSBjb250YWluZXIsIHNvIHdlIGNhbiByZWdpc3RlciB0aGUgbmV3IGNvbXBvbmVudFxyXG4gICAgICAgICAgICB0aGlzLnByb3ZpZGVycy5kZWxldGUoY29tcG9uZW50Lm5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBnZXRQcm92aWRlciBwcm92aWRlcyBhIHR5cGUgc2FmZSBpbnRlcmZhY2Ugd2hlcmUgaXQgY2FuIG9ubHkgYmUgY2FsbGVkIHdpdGggYSBmaWVsZCBuYW1lXHJcbiAgICAgKiBwcmVzZW50IGluIE5hbWVTZXJ2aWNlTWFwcGluZyBpbnRlcmZhY2UuXHJcbiAgICAgKlxyXG4gICAgICogRmlyZWJhc2UgU0RLcyBwcm92aWRpbmcgc2VydmljZXMgc2hvdWxkIGV4dGVuZCBOYW1lU2VydmljZU1hcHBpbmcgaW50ZXJmYWNlIHRvIHJlZ2lzdGVyXHJcbiAgICAgKiB0aGVtc2VsdmVzLlxyXG4gICAgICovXHJcbiAgICBnZXRQcm92aWRlcihuYW1lKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucHJvdmlkZXJzLmhhcyhuYW1lKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm92aWRlcnMuZ2V0KG5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjcmVhdGUgYSBQcm92aWRlciBmb3IgYSBzZXJ2aWNlIHRoYXQgaGFzbid0IHJlZ2lzdGVyZWQgd2l0aCBGaXJlYmFzZVxyXG4gICAgICAgIGNvbnN0IHByb3ZpZGVyID0gbmV3IFByb3ZpZGVyKG5hbWUsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJzLnNldChuYW1lLCBwcm92aWRlcik7XHJcbiAgICAgICAgcmV0dXJuIHByb3ZpZGVyO1xyXG4gICAgfVxyXG4gICAgZ2V0UHJvdmlkZXJzKCkge1xyXG4gICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMucHJvdmlkZXJzLnZhbHVlcygpKTtcclxuICAgIH1cclxufVxuXG5leHBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudENvbnRhaW5lciwgUHJvdmlkZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCIvKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQSBjb250YWluZXIgZm9yIGFsbCBvZiB0aGUgTG9nZ2VyIGluc3RhbmNlc1xyXG4gKi9cclxuY29uc3QgaW5zdGFuY2VzID0gW107XHJcbi8qKlxyXG4gKiBUaGUgSlMgU0RLIHN1cHBvcnRzIDUgbG9nIGxldmVscyBhbmQgYWxzbyBhbGxvd3MgYSB1c2VyIHRoZSBhYmlsaXR5IHRvXHJcbiAqIHNpbGVuY2UgdGhlIGxvZ3MgYWx0b2dldGhlci5cclxuICpcclxuICogVGhlIG9yZGVyIGlzIGEgZm9sbG93czpcclxuICogREVCVUcgPCBWRVJCT1NFIDwgSU5GTyA8IFdBUk4gPCBFUlJPUlxyXG4gKlxyXG4gKiBBbGwgb2YgdGhlIGxvZyB0eXBlcyBhYm92ZSB0aGUgY3VycmVudCBsb2cgbGV2ZWwgd2lsbCBiZSBjYXB0dXJlZCAoaS5lLiBpZlxyXG4gKiB5b3Ugc2V0IHRoZSBsb2cgbGV2ZWwgdG8gYElORk9gLCBlcnJvcnMgd2lsbCBzdGlsbCBiZSBsb2dnZWQsIGJ1dCBgREVCVUdgIGFuZFxyXG4gKiBgVkVSQk9TRWAgbG9ncyB3aWxsIG5vdClcclxuICovXHJcbnZhciBMb2dMZXZlbDtcclxuKGZ1bmN0aW9uIChMb2dMZXZlbCkge1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJERUJVR1wiXSA9IDBdID0gXCJERUJVR1wiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJWRVJCT1NFXCJdID0gMV0gPSBcIlZFUkJPU0VcIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiSU5GT1wiXSA9IDJdID0gXCJJTkZPXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIldBUk5cIl0gPSAzXSA9IFwiV0FSTlwiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJFUlJPUlwiXSA9IDRdID0gXCJFUlJPUlwiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJTSUxFTlRcIl0gPSA1XSA9IFwiU0lMRU5UXCI7XHJcbn0pKExvZ0xldmVsIHx8IChMb2dMZXZlbCA9IHt9KSk7XHJcbmNvbnN0IGxldmVsU3RyaW5nVG9FbnVtID0ge1xyXG4gICAgJ2RlYnVnJzogTG9nTGV2ZWwuREVCVUcsXHJcbiAgICAndmVyYm9zZSc6IExvZ0xldmVsLlZFUkJPU0UsXHJcbiAgICAnaW5mbyc6IExvZ0xldmVsLklORk8sXHJcbiAgICAnd2Fybic6IExvZ0xldmVsLldBUk4sXHJcbiAgICAnZXJyb3InOiBMb2dMZXZlbC5FUlJPUixcclxuICAgICdzaWxlbnQnOiBMb2dMZXZlbC5TSUxFTlRcclxufTtcclxuLyoqXHJcbiAqIFRoZSBkZWZhdWx0IGxvZyBsZXZlbFxyXG4gKi9cclxuY29uc3QgZGVmYXVsdExvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTztcclxuLyoqXHJcbiAqIEJ5IGRlZmF1bHQsIGBjb25zb2xlLmRlYnVnYCBpcyBub3QgZGlzcGxheWVkIGluIHRoZSBkZXZlbG9wZXIgY29uc29sZSAoaW5cclxuICogY2hyb21lKS4gVG8gYXZvaWQgZm9yY2luZyB1c2VycyB0byBoYXZlIHRvIG9wdC1pbiB0byB0aGVzZSBsb2dzIHR3aWNlXHJcbiAqIChpLmUuIG9uY2UgZm9yIGZpcmViYXNlLCBhbmQgb25jZSBpbiB0aGUgY29uc29sZSksIHdlIGFyZSBzZW5kaW5nIGBERUJVR2BcclxuICogbG9ncyB0byB0aGUgYGNvbnNvbGUubG9nYCBmdW5jdGlvbi5cclxuICovXHJcbmNvbnN0IENvbnNvbGVNZXRob2QgPSB7XHJcbiAgICBbTG9nTGV2ZWwuREVCVUddOiAnbG9nJyxcclxuICAgIFtMb2dMZXZlbC5WRVJCT1NFXTogJ2xvZycsXHJcbiAgICBbTG9nTGV2ZWwuSU5GT106ICdpbmZvJyxcclxuICAgIFtMb2dMZXZlbC5XQVJOXTogJ3dhcm4nLFxyXG4gICAgW0xvZ0xldmVsLkVSUk9SXTogJ2Vycm9yJ1xyXG59O1xyXG4vKipcclxuICogVGhlIGRlZmF1bHQgbG9nIGhhbmRsZXIgd2lsbCBmb3J3YXJkIERFQlVHLCBWRVJCT1NFLCBJTkZPLCBXQVJOLCBhbmQgRVJST1JcclxuICogbWVzc2FnZXMgb24gdG8gdGhlaXIgY29ycmVzcG9uZGluZyBjb25zb2xlIGNvdW50ZXJwYXJ0cyAoaWYgdGhlIGxvZyBtZXRob2RcclxuICogaXMgc3VwcG9ydGVkIGJ5IHRoZSBjdXJyZW50IGxvZyBsZXZlbClcclxuICovXHJcbmNvbnN0IGRlZmF1bHRMb2dIYW5kbGVyID0gKGluc3RhbmNlLCBsb2dUeXBlLCAuLi5hcmdzKSA9PiB7XHJcbiAgICBpZiAobG9nVHlwZSA8IGluc3RhbmNlLmxvZ0xldmVsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgY29uc3QgbWV0aG9kID0gQ29uc29sZU1ldGhvZFtsb2dUeXBlXTtcclxuICAgIGlmIChtZXRob2QpIHtcclxuICAgICAgICBjb25zb2xlW21ldGhvZF0oYFske25vd31dICAke2luc3RhbmNlLm5hbWV9OmAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBdHRlbXB0ZWQgdG8gbG9nIGEgbWVzc2FnZSB3aXRoIGFuIGludmFsaWQgbG9nVHlwZSAodmFsdWU6ICR7bG9nVHlwZX0pYCk7XHJcbiAgICB9XHJcbn07XHJcbmNsYXNzIExvZ2dlciB7XHJcbiAgICAvKipcclxuICAgICAqIEdpdmVzIHlvdSBhbiBpbnN0YW5jZSBvZiBhIExvZ2dlciB0byBjYXB0dXJlIG1lc3NhZ2VzIGFjY29yZGluZyB0b1xyXG4gICAgICogRmlyZWJhc2UncyBsb2dnaW5nIHNjaGVtZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSB0aGF0IHRoZSBsb2dzIHdpbGwgYmUgYXNzb2NpYXRlZCB3aXRoXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBsb2cgbGV2ZWwgb2YgdGhlIGdpdmVuIExvZ2dlciBpbnN0YW5jZS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9sb2dMZXZlbCA9IGRlZmF1bHRMb2dMZXZlbDtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUaGUgbWFpbiAoaW50ZXJuYWwpIGxvZyBoYW5kbGVyIGZvciB0aGUgTG9nZ2VyIGluc3RhbmNlLlxyXG4gICAgICAgICAqIENhbiBiZSBzZXQgdG8gYSBuZXcgZnVuY3Rpb24gaW4gaW50ZXJuYWwgcGFja2FnZSBjb2RlIGJ1dCBub3QgYnkgdXNlci5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyID0gZGVmYXVsdExvZ0hhbmRsZXI7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIG9wdGlvbmFsLCBhZGRpdGlvbmFsLCB1c2VyLWRlZmluZWQgbG9nIGhhbmRsZXIgZm9yIHRoZSBMb2dnZXIgaW5zdGFuY2UuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENhcHR1cmUgdGhlIGN1cnJlbnQgaW5zdGFuY2UgZm9yIGxhdGVyIHVzZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGluc3RhbmNlcy5wdXNoKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgZ2V0IGxvZ0xldmVsKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9sb2dMZXZlbDtcclxuICAgIH1cclxuICAgIHNldCBsb2dMZXZlbCh2YWwpIHtcclxuICAgICAgICBpZiAoISh2YWwgaW4gTG9nTGV2ZWwpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYEludmFsaWQgdmFsdWUgXCIke3ZhbH1cIiBhc3NpZ25lZCB0byBcXGBsb2dMZXZlbFxcYGApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9sb2dMZXZlbCA9IHZhbDtcclxuICAgIH1cclxuICAgIC8vIFdvcmthcm91bmQgZm9yIHNldHRlci9nZXR0ZXIgaGF2aW5nIHRvIGJlIHRoZSBzYW1lIHR5cGUuXHJcbiAgICBzZXRMb2dMZXZlbCh2YWwpIHtcclxuICAgICAgICB0aGlzLl9sb2dMZXZlbCA9IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gbGV2ZWxTdHJpbmdUb0VudW1bdmFsXSA6IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBsb2dIYW5kbGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9sb2dIYW5kbGVyO1xyXG4gICAgfVxyXG4gICAgc2V0IGxvZ0hhbmRsZXIodmFsKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWwgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVmFsdWUgYXNzaWduZWQgdG8gYGxvZ0hhbmRsZXJgIG11c3QgYmUgYSBmdW5jdGlvbicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyID0gdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IHVzZXJMb2dIYW5kbGVyKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl91c2VyTG9nSGFuZGxlcjtcclxuICAgIH1cclxuICAgIHNldCB1c2VyTG9nSGFuZGxlcih2YWwpIHtcclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciA9IHZhbDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVGhlIGZ1bmN0aW9ucyBiZWxvdyBhcmUgYWxsIGJhc2VkIG9uIHRoZSBgY29uc29sZWAgaW50ZXJmYWNlXHJcbiAgICAgKi9cclxuICAgIGRlYnVnKC4uLmFyZ3MpIHtcclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5ERUJVRywgLi4uYXJncyk7XHJcbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5ERUJVRywgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBsb2coLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyICYmXHJcbiAgICAgICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpO1xyXG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuVkVSQk9TRSwgLi4uYXJncyk7XHJcbiAgICB9XHJcbiAgICBpbmZvKC4uLmFyZ3MpIHtcclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5JTkZPLCAuLi5hcmdzKTtcclxuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLklORk8sIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG4gICAgd2FybiguLi5hcmdzKSB7XHJcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuV0FSTiwgLi4uYXJncyk7XHJcbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTtcclxuICAgIH1cclxuICAgIGVycm9yKC4uLmFyZ3MpIHtcclxuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5FUlJPUiwgLi4uYXJncyk7XHJcbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5FUlJPUiwgLi4uYXJncyk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gc2V0TG9nTGV2ZWwobGV2ZWwpIHtcclxuICAgIGluc3RhbmNlcy5mb3JFYWNoKGluc3QgPT4ge1xyXG4gICAgICAgIGluc3Quc2V0TG9nTGV2ZWwobGV2ZWwpO1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gc2V0VXNlckxvZ0hhbmRsZXIobG9nQ2FsbGJhY2ssIG9wdGlvbnMpIHtcclxuICAgIGZvciAoY29uc3QgaW5zdGFuY2Ugb2YgaW5zdGFuY2VzKSB7XHJcbiAgICAgICAgbGV0IGN1c3RvbUxvZ0xldmVsID0gbnVsbDtcclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmxldmVsKSB7XHJcbiAgICAgICAgICAgIGN1c3RvbUxvZ0xldmVsID0gbGV2ZWxTdHJpbmdUb0VudW1bb3B0aW9ucy5sZXZlbF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsb2dDYWxsYmFjayA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS51c2VyTG9nSGFuZGxlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS51c2VyTG9nSGFuZGxlciA9IChpbnN0YW5jZSwgbGV2ZWwsIC4uLmFyZ3MpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBhcmdzXHJcbiAgICAgICAgICAgICAgICAgICAgLm1hcChhcmcgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmcgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFyZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGFyZyA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGFyZyA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhcmcudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYXJnIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZy5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChpZ25vcmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihhcmcgPT4gYXJnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5qb2luKCcgJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAobGV2ZWwgPj0gKGN1c3RvbUxvZ0xldmVsICE9PSBudWxsICYmIGN1c3RvbUxvZ0xldmVsICE9PSB2b2lkIDAgPyBjdXN0b21Mb2dMZXZlbCA6IGluc3RhbmNlLmxvZ0xldmVsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ0NhbGxiYWNrKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV2ZWw6IExvZ0xldmVsW2xldmVsXS50b0xvd2VyQ2FzZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpbnN0YW5jZS5uYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbmV4cG9ydCB7IExvZ0xldmVsLCBMb2dnZXIsIHNldExvZ0xldmVsLCBzZXRVc2VyTG9nSGFuZGxlciB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsImNvbnN0IGluc3RhbmNlT2ZBbnkgPSAob2JqZWN0LCBjb25zdHJ1Y3RvcnMpID0+IGNvbnN0cnVjdG9ycy5zb21lKChjKSA9PiBvYmplY3QgaW5zdGFuY2VvZiBjKTtcblxubGV0IGlkYlByb3h5YWJsZVR5cGVzO1xubGV0IGN1cnNvckFkdmFuY2VNZXRob2RzO1xuLy8gVGhpcyBpcyBhIGZ1bmN0aW9uIHRvIHByZXZlbnQgaXQgdGhyb3dpbmcgdXAgaW4gbm9kZSBlbnZpcm9ubWVudHMuXG5mdW5jdGlvbiBnZXRJZGJQcm94eWFibGVUeXBlcygpIHtcbiAgICByZXR1cm4gKGlkYlByb3h5YWJsZVR5cGVzIHx8XG4gICAgICAgIChpZGJQcm94eWFibGVUeXBlcyA9IFtcbiAgICAgICAgICAgIElEQkRhdGFiYXNlLFxuICAgICAgICAgICAgSURCT2JqZWN0U3RvcmUsXG4gICAgICAgICAgICBJREJJbmRleCxcbiAgICAgICAgICAgIElEQkN1cnNvcixcbiAgICAgICAgICAgIElEQlRyYW5zYWN0aW9uLFxuICAgICAgICBdKSk7XG59XG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cbmZ1bmN0aW9uIGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkge1xuICAgIHJldHVybiAoY3Vyc29yQWR2YW5jZU1ldGhvZHMgfHxcbiAgICAgICAgKGN1cnNvckFkdmFuY2VNZXRob2RzID0gW1xuICAgICAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5hZHZhbmNlLFxuICAgICAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZSxcbiAgICAgICAgICAgIElEQkN1cnNvci5wcm90b3R5cGUuY29udGludWVQcmltYXJ5S2V5LFxuICAgICAgICBdKSk7XG59XG5jb25zdCBjdXJzb3JSZXF1ZXN0TWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHRyYW5zYWN0aW9uRG9uZU1hcCA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCB0cmFuc2FjdGlvblN0b3JlTmFtZXNNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgdHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcbmZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3QocmVxdWVzdCkge1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVxdWVzdC5yZW1vdmVFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzdWNjZXNzID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZSh3cmFwKHJlcXVlc3QucmVzdWx0KSk7XG4gICAgICAgICAgICB1bmxpc3RlbigpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBlcnJvciA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIHN1Y2Nlc3MpO1xuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3IpO1xuICAgIH0pO1xuICAgIHByb21pc2VcbiAgICAgICAgLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgICAgIC8vIFNpbmNlIGN1cnNvcmluZyByZXVzZXMgdGhlIElEQlJlcXVlc3QgKCpzaWdoKiksIHdlIGNhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWxcbiAgICAgICAgLy8gKHNlZSB3cmFwRnVuY3Rpb24pLlxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJDdXJzb3IpIHtcbiAgICAgICAgICAgIGN1cnNvclJlcXVlc3RNYXAuc2V0KHZhbHVlLCByZXF1ZXN0KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDYXRjaGluZyB0byBhdm9pZCBcIlVuY2F1Z2h0IFByb21pc2UgZXhjZXB0aW9uc1wiXG4gICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgLy8gVGhpcyBtYXBwaW5nIGV4aXN0cyBpbiByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgYnV0IGRvZXNuJ3QgZG9lc24ndCBleGlzdCBpbiB0cmFuc2Zvcm1DYWNoZS4gVGhpc1xuICAgIC8vIGlzIGJlY2F1c2Ugd2UgY3JlYXRlIG1hbnkgcHJvbWlzZXMgZnJvbSBhIHNpbmdsZSBJREJSZXF1ZXN0LlxuICAgIHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5zZXQocHJvbWlzZSwgcmVxdWVzdCk7XG4gICAgcmV0dXJuIHByb21pc2U7XG59XG5mdW5jdGlvbiBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odHgpIHtcbiAgICAvLyBFYXJseSBiYWlsIGlmIHdlJ3ZlIGFscmVhZHkgY3JlYXRlZCBhIGRvbmUgcHJvbWlzZSBmb3IgdGhpcyB0cmFuc2FjdGlvbi5cbiAgICBpZiAodHJhbnNhY3Rpb25Eb25lTWFwLmhhcyh0eCkpXG4gICAgICAgIHJldHVybjtcbiAgICBjb25zdCBkb25lID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCB1bmxpc3RlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIGVycm9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgY29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB1bmxpc3RlbigpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBlcnJvciA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlamVjdCh0eC5lcnJvciB8fCBuZXcgRE9NRXhjZXB0aW9uKCdBYm9ydEVycm9yJywgJ0Fib3J0RXJyb3InKSk7XG4gICAgICAgICAgICB1bmxpc3RlbigpO1xuICAgICAgICB9O1xuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdjb21wbGV0ZScsIGNvbXBsZXRlKTtcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xuICAgIH0pO1xuICAgIC8vIENhY2hlIGl0IGZvciBsYXRlciByZXRyaWV2YWwuXG4gICAgdHJhbnNhY3Rpb25Eb25lTWFwLnNldCh0eCwgZG9uZSk7XG59XG5sZXQgaWRiUHJveHlUcmFwcyA9IHtcbiAgICBnZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikge1xuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24pIHtcbiAgICAgICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHRyYW5zYWN0aW9uLmRvbmUuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ2RvbmUnKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbkRvbmVNYXAuZ2V0KHRhcmdldCk7XG4gICAgICAgICAgICAvLyBQb2x5ZmlsbCBmb3Igb2JqZWN0U3RvcmVOYW1lcyBiZWNhdXNlIG9mIEVkZ2UuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ29iamVjdFN0b3JlTmFtZXMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldC5vYmplY3RTdG9yZU5hbWVzIHx8IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5nZXQodGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE1ha2UgdHguc3RvcmUgcmV0dXJuIHRoZSBvbmx5IHN0b3JlIGluIHRoZSB0cmFuc2FjdGlvbiwgb3IgdW5kZWZpbmVkIGlmIHRoZXJlIGFyZSBtYW55LlxuICAgICAgICAgICAgaWYgKHByb3AgPT09ICdzdG9yZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1sxXVxuICAgICAgICAgICAgICAgICAgICA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICA6IHJlY2VpdmVyLm9iamVjdFN0b3JlKHJlY2VpdmVyLm9iamVjdFN0b3JlTmFtZXNbMF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEVsc2UgdHJhbnNmb3JtIHdoYXRldmVyIHdlIGdldCBiYWNrLlxuICAgICAgICByZXR1cm4gd3JhcCh0YXJnZXRbcHJvcF0pO1xuICAgIH0sXG4gICAgc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUpIHtcbiAgICAgICAgdGFyZ2V0W3Byb3BdID0gdmFsdWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgaGFzKHRhcmdldCwgcHJvcCkge1xuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSURCVHJhbnNhY3Rpb24gJiZcbiAgICAgICAgICAgIChwcm9wID09PSAnZG9uZScgfHwgcHJvcCA9PT0gJ3N0b3JlJykpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9wIGluIHRhcmdldDtcbiAgICB9LFxufTtcbmZ1bmN0aW9uIHJlcGxhY2VUcmFwcyhjYWxsYmFjaykge1xuICAgIGlkYlByb3h5VHJhcHMgPSBjYWxsYmFjayhpZGJQcm94eVRyYXBzKTtcbn1cbmZ1bmN0aW9uIHdyYXBGdW5jdGlvbihmdW5jKSB7XG4gICAgLy8gRHVlIHRvIGV4cGVjdGVkIG9iamVjdCBlcXVhbGl0eSAod2hpY2ggaXMgZW5mb3JjZWQgYnkgdGhlIGNhY2hpbmcgaW4gYHdyYXBgKSwgd2VcbiAgICAvLyBvbmx5IGNyZWF0ZSBvbmUgbmV3IGZ1bmMgcGVyIGZ1bmMuXG4gICAgLy8gRWRnZSBkb2Vzbid0IHN1cHBvcnQgb2JqZWN0U3RvcmVOYW1lcyAoYm9vbyksIHNvIHdlIHBvbHlmaWxsIGl0IGhlcmUuXG4gICAgaWYgKGZ1bmMgPT09IElEQkRhdGFiYXNlLnByb3RvdHlwZS50cmFuc2FjdGlvbiAmJlxuICAgICAgICAhKCdvYmplY3RTdG9yZU5hbWVzJyBpbiBJREJUcmFuc2FjdGlvbi5wcm90b3R5cGUpKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RvcmVOYW1lcywgLi4uYXJncykge1xuICAgICAgICAgICAgY29uc3QgdHggPSBmdW5jLmNhbGwodW53cmFwKHRoaXMpLCBzdG9yZU5hbWVzLCAuLi5hcmdzKTtcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcC5zZXQodHgsIHN0b3JlTmFtZXMuc29ydCA/IHN0b3JlTmFtZXMuc29ydCgpIDogW3N0b3JlTmFtZXNdKTtcbiAgICAgICAgICAgIHJldHVybiB3cmFwKHR4KTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLy8gQ3Vyc29yIG1ldGhvZHMgYXJlIHNwZWNpYWwsIGFzIHRoZSBiZWhhdmlvdXIgaXMgYSBsaXR0bGUgbW9yZSBkaWZmZXJlbnQgdG8gc3RhbmRhcmQgSURCLiBJblxuICAgIC8vIElEQiwgeW91IGFkdmFuY2UgdGhlIGN1cnNvciBhbmQgd2FpdCBmb3IgYSBuZXcgJ3N1Y2Nlc3MnIG9uIHRoZSBJREJSZXF1ZXN0IHRoYXQgZ2F2ZSB5b3UgdGhlXG4gICAgLy8gY3Vyc29yLiBJdCdzIGtpbmRhIGxpa2UgYSBwcm9taXNlIHRoYXQgY2FuIHJlc29sdmUgd2l0aCBtYW55IHZhbHVlcy4gVGhhdCBkb2Vzbid0IG1ha2Ugc2Vuc2VcbiAgICAvLyB3aXRoIHJlYWwgcHJvbWlzZXMsIHNvIGVhY2ggYWR2YW5jZSBtZXRob2RzIHJldHVybnMgYSBuZXcgcHJvbWlzZSBmb3IgdGhlIGN1cnNvciBvYmplY3QsIG9yXG4gICAgLy8gdW5kZWZpbmVkIGlmIHRoZSBlbmQgb2YgdGhlIGN1cnNvciBoYXMgYmVlbiByZWFjaGVkLlxuICAgIGlmIChnZXRDdXJzb3JBZHZhbmNlTWV0aG9kcygpLmluY2x1ZGVzKGZ1bmMpKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxuICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC5cbiAgICAgICAgICAgIGZ1bmMuYXBwbHkodW53cmFwKHRoaXMpLCBhcmdzKTtcbiAgICAgICAgICAgIHJldHVybiB3cmFwKGN1cnNvclJlcXVlc3RNYXAuZ2V0KHRoaXMpKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgIC8vIENhbGxpbmcgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uIHdpdGggdGhlIHByb3h5IGFzICd0aGlzJyBjYXVzZXMgSUxMRUdBTCBJTlZPQ0FUSU9OLCBzbyB3ZSB1c2VcbiAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdC5cbiAgICAgICAgcmV0dXJuIHdyYXAoZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpKTtcbiAgICB9O1xufVxuZnVuY3Rpb24gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXG4gICAgICAgIHJldHVybiB3cmFwRnVuY3Rpb24odmFsdWUpO1xuICAgIC8vIFRoaXMgZG9lc24ndCByZXR1cm4sIGl0IGp1c3QgY3JlYXRlcyBhICdkb25lJyBwcm9taXNlIGZvciB0aGUgdHJhbnNhY3Rpb24sXG4gICAgLy8gd2hpY2ggaXMgbGF0ZXIgcmV0dXJuZWQgZm9yIHRyYW5zYWN0aW9uLmRvbmUgKHNlZSBpZGJPYmplY3RIYW5kbGVyKS5cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbilcbiAgICAgICAgY2FjaGVEb25lUHJvbWlzZUZvclRyYW5zYWN0aW9uKHZhbHVlKTtcbiAgICBpZiAoaW5zdGFuY2VPZkFueSh2YWx1ZSwgZ2V0SWRiUHJveHlhYmxlVHlwZXMoKSkpXG4gICAgICAgIHJldHVybiBuZXcgUHJveHkodmFsdWUsIGlkYlByb3h5VHJhcHMpO1xuICAgIC8vIFJldHVybiB0aGUgc2FtZSB2YWx1ZSBiYWNrIGlmIHdlJ3JlIG5vdCBnb2luZyB0byB0cmFuc2Zvcm0gaXQuXG4gICAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gd3JhcCh2YWx1ZSkge1xuICAgIC8vIFdlIHNvbWV0aW1lcyBnZW5lcmF0ZSBtdWx0aXBsZSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QgKGVnIHdoZW4gY3Vyc29yaW5nKSwgYmVjYXVzZVxuICAgIC8vIElEQiBpcyB3ZWlyZCBhbmQgYSBzaW5nbGUgSURCUmVxdWVzdCBjYW4geWllbGQgbWFueSByZXNwb25zZXMsIHNvIHRoZXNlIGNhbid0IGJlIGNhY2hlZC5cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBJREJSZXF1ZXN0KVxuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdCh2YWx1ZSk7XG4gICAgLy8gSWYgd2UndmUgYWxyZWFkeSB0cmFuc2Zvcm1lZCB0aGlzIHZhbHVlIGJlZm9yZSwgcmV1c2UgdGhlIHRyYW5zZm9ybWVkIHZhbHVlLlxuICAgIC8vIFRoaXMgaXMgZmFzdGVyLCBidXQgaXQgYWxzbyBwcm92aWRlcyBvYmplY3QgZXF1YWxpdHkuXG4gICAgaWYgKHRyYW5zZm9ybUNhY2hlLmhhcyh2YWx1ZSkpXG4gICAgICAgIHJldHVybiB0cmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpO1xuICAgIGNvbnN0IG5ld1ZhbHVlID0gdHJhbnNmb3JtQ2FjaGFibGVWYWx1ZSh2YWx1ZSk7XG4gICAgLy8gTm90IGFsbCB0eXBlcyBhcmUgdHJhbnNmb3JtZWQuXG4gICAgLy8gVGhlc2UgbWF5IGJlIHByaW1pdGl2ZSB0eXBlcywgc28gdGhleSBjYW4ndCBiZSBXZWFrTWFwIGtleXMuXG4gICAgaWYgKG5ld1ZhbHVlICE9PSB2YWx1ZSkge1xuICAgICAgICB0cmFuc2Zvcm1DYWNoZS5zZXQodmFsdWUsIG5ld1ZhbHVlKTtcbiAgICAgICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChuZXdWYWx1ZSwgdmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3VmFsdWU7XG59XG5jb25zdCB1bndyYXAgPSAodmFsdWUpID0+IHJldmVyc2VUcmFuc2Zvcm1DYWNoZS5nZXQodmFsdWUpO1xuXG5leHBvcnQgeyByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgYXMgYSwgaW5zdGFuY2VPZkFueSBhcyBpLCByZXBsYWNlVHJhcHMgYXMgciwgdW53cmFwIGFzIHUsIHdyYXAgYXMgdyB9O1xuIiwiaW1wb3J0IHsgdyBhcyB3cmFwLCByIGFzIHJlcGxhY2VUcmFwcyB9IGZyb20gJy4vd3JhcC1pZGItdmFsdWUuanMnO1xuZXhwb3J0IHsgdSBhcyB1bndyYXAsIHcgYXMgd3JhcCB9IGZyb20gJy4vd3JhcC1pZGItdmFsdWUuanMnO1xuXG4vKipcbiAqIE9wZW4gYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqIEBwYXJhbSB2ZXJzaW9uIFNjaGVtYSB2ZXJzaW9uLlxuICogQHBhcmFtIGNhbGxiYWNrcyBBZGRpdGlvbmFsIGNhbGxiYWNrcy5cbiAqL1xuZnVuY3Rpb24gb3BlbkRCKG5hbWUsIHZlcnNpb24sIHsgYmxvY2tlZCwgdXBncmFkZSwgYmxvY2tpbmcsIHRlcm1pbmF0ZWQgfSA9IHt9KSB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKG5hbWUsIHZlcnNpb24pO1xuICAgIGNvbnN0IG9wZW5Qcm9taXNlID0gd3JhcChyZXF1ZXN0KTtcbiAgICBpZiAodXBncmFkZSkge1xuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHVwZ3JhZGUod3JhcChyZXF1ZXN0LnJlc3VsdCksIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIHdyYXAocmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJsb2NrZWQpXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XG4gICAgb3BlblByb21pc2VcbiAgICAgICAgLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgIGlmICh0ZXJtaW5hdGVkKVxuICAgICAgICAgICAgZGIuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCAoKSA9PiB0ZXJtaW5hdGVkKCkpO1xuICAgICAgICBpZiAoYmxvY2tpbmcpXG4gICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKCkgPT4gYmxvY2tpbmcoKSk7XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgcmV0dXJuIG9wZW5Qcm9taXNlO1xufVxuLyoqXG4gKiBEZWxldGUgYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqL1xuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XG4gICAgaWYgKGJsb2NrZWQpXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignYmxvY2tlZCcsICgpID0+IGJsb2NrZWQoKSk7XG4gICAgcmV0dXJuIHdyYXAocmVxdWVzdCkudGhlbigoKSA9PiB1bmRlZmluZWQpO1xufVxuXG5jb25zdCByZWFkTWV0aG9kcyA9IFsnZ2V0JywgJ2dldEtleScsICdnZXRBbGwnLCAnZ2V0QWxsS2V5cycsICdjb3VudCddO1xuY29uc3Qgd3JpdGVNZXRob2RzID0gWydwdXQnLCAnYWRkJywgJ2RlbGV0ZScsICdjbGVhciddO1xuY29uc3QgY2FjaGVkTWV0aG9kcyA9IG5ldyBNYXAoKTtcbmZ1bmN0aW9uIGdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHtcbiAgICBpZiAoISh0YXJnZXQgaW5zdGFuY2VvZiBJREJEYXRhYmFzZSAmJlxuICAgICAgICAhKHByb3AgaW4gdGFyZ2V0KSAmJlxuICAgICAgICB0eXBlb2YgcHJvcCA9PT0gJ3N0cmluZycpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApKVxuICAgICAgICByZXR1cm4gY2FjaGVkTWV0aG9kcy5nZXQocHJvcCk7XG4gICAgY29uc3QgdGFyZ2V0RnVuY05hbWUgPSBwcm9wLnJlcGxhY2UoL0Zyb21JbmRleCQvLCAnJyk7XG4gICAgY29uc3QgdXNlSW5kZXggPSBwcm9wICE9PSB0YXJnZXRGdW5jTmFtZTtcbiAgICBjb25zdCBpc1dyaXRlID0gd3JpdGVNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKTtcbiAgICBpZiAoXG4gICAgLy8gQmFpbCBpZiB0aGUgdGFyZ2V0IGRvZXNuJ3QgZXhpc3Qgb24gdGhlIHRhcmdldC4gRWcsIGdldEFsbCBpc24ndCBpbiBFZGdlLlxuICAgICEodGFyZ2V0RnVuY05hbWUgaW4gKHVzZUluZGV4ID8gSURCSW5kZXggOiBJREJPYmplY3RTdG9yZSkucHJvdG90eXBlKSB8fFxuICAgICAgICAhKGlzV3JpdGUgfHwgcmVhZE1ldGhvZHMuaW5jbHVkZXModGFyZ2V0RnVuY05hbWUpKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1ldGhvZCA9IGFzeW5jIGZ1bmN0aW9uIChzdG9yZU5hbWUsIC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gaXNXcml0ZSA/ICdyZWFkd3JpdGUnIDogdW5kZWZpbmVkIGd6aXBwcyBiZXR0ZXIsIGJ1dCBmYWlscyBpbiBFZGdlIDooXG4gICAgICAgIGNvbnN0IHR4ID0gdGhpcy50cmFuc2FjdGlvbihzdG9yZU5hbWUsIGlzV3JpdGUgPyAncmVhZHdyaXRlJyA6ICdyZWFkb25seScpO1xuICAgICAgICBsZXQgdGFyZ2V0ID0gdHguc3RvcmU7XG4gICAgICAgIGlmICh1c2VJbmRleClcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5pbmRleChhcmdzLnNoaWZ0KCkpO1xuICAgICAgICAvLyBNdXN0IHJlamVjdCBpZiBvcCByZWplY3RzLlxuICAgICAgICAvLyBJZiBpdCdzIGEgd3JpdGUgb3BlcmF0aW9uLCBtdXN0IHJlamVjdCBpZiB0eC5kb25lIHJlamVjdHMuXG4gICAgICAgIC8vIE11c3QgcmVqZWN0IHdpdGggb3AgcmVqZWN0aW9uIGZpcnN0LlxuICAgICAgICAvLyBNdXN0IHJlc29sdmUgd2l0aCBvcCB2YWx1ZS5cbiAgICAgICAgLy8gTXVzdCBoYW5kbGUgYm90aCBwcm9taXNlcyAobm8gdW5oYW5kbGVkIHJlamVjdGlvbnMpXG4gICAgICAgIHJldHVybiAoYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGFyZ2V0W3RhcmdldEZ1bmNOYW1lXSguLi5hcmdzKSxcbiAgICAgICAgICAgIGlzV3JpdGUgJiYgdHguZG9uZSxcbiAgICAgICAgXSkpWzBdO1xuICAgIH07XG4gICAgY2FjaGVkTWV0aG9kcy5zZXQocHJvcCwgbWV0aG9kKTtcbiAgICByZXR1cm4gbWV0aG9kO1xufVxucmVwbGFjZVRyYXBzKChvbGRUcmFwcykgPT4gKHtcbiAgICAuLi5vbGRUcmFwcyxcbiAgICBnZXQ6ICh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSA9PiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5nZXQodGFyZ2V0LCBwcm9wLCByZWNlaXZlciksXG4gICAgaGFzOiAodGFyZ2V0LCBwcm9wKSA9PiAhIWdldE1ldGhvZCh0YXJnZXQsIHByb3ApIHx8IG9sZFRyYXBzLmhhcyh0YXJnZXQsIHByb3ApLFxufSkpO1xuXG5leHBvcnQgeyBkZWxldGVEQiwgb3BlbkRCIH07XG4iLCJpbXBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudENvbnRhaW5lciB9IGZyb20gJ0BmaXJlYmFzZS9jb21wb25lbnQnO1xuaW1wb3J0IHsgTG9nZ2VyLCBzZXRVc2VyTG9nSGFuZGxlciwgc2V0TG9nTGV2ZWwgYXMgc2V0TG9nTGV2ZWwkMSB9IGZyb20gJ0BmaXJlYmFzZS9sb2dnZXInO1xuaW1wb3J0IHsgRXJyb3JGYWN0b3J5LCBnZXREZWZhdWx0QXBwQ29uZmlnLCBkZWVwRXF1YWwsIEZpcmViYXNlRXJyb3IsIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nLCBpc0luZGV4ZWREQkF2YWlsYWJsZSwgdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcbmV4cG9ydCB7IEZpcmViYXNlRXJyb3IgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBvcGVuREIgfSBmcm9tICdpZGInO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBQbGF0Zm9ybUxvZ2dlclNlcnZpY2VJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgfVxyXG4gICAgLy8gSW4gaW5pdGlhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3aWxsIGJlIGNhbGxlZCBieSBpbnN0YWxsYXRpb25zIG9uXHJcbiAgICAvLyBhdXRoIHRva2VuIHJlZnJlc2gsIGFuZCBpbnN0YWxsYXRpb25zIHdpbGwgc2VuZCB0aGlzIHN0cmluZy5cclxuICAgIGdldFBsYXRmb3JtSW5mb1N0cmluZygpIHtcclxuICAgICAgICBjb25zdCBwcm92aWRlcnMgPSB0aGlzLmNvbnRhaW5lci5nZXRQcm92aWRlcnMoKTtcclxuICAgICAgICAvLyBMb29wIHRocm91Z2ggcHJvdmlkZXJzIGFuZCBnZXQgbGlicmFyeS92ZXJzaW9uIHBhaXJzIGZyb20gYW55IHRoYXQgYXJlXHJcbiAgICAgICAgLy8gdmVyc2lvbiBjb21wb25lbnRzLlxyXG4gICAgICAgIHJldHVybiBwcm92aWRlcnNcclxuICAgICAgICAgICAgLm1hcChwcm92aWRlciA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpc1ZlcnNpb25TZXJ2aWNlUHJvdmlkZXIocHJvdmlkZXIpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2aWNlID0gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7c2VydmljZS5saWJyYXJ5fS8ke3NlcnZpY2UudmVyc2lvbn1gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuZmlsdGVyKGxvZ1N0cmluZyA9PiBsb2dTdHJpbmcpXHJcbiAgICAgICAgICAgIC5qb2luKCcgJyk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBwcm92aWRlciBjaGVjayBpZiB0aGlzIHByb3ZpZGVyIHByb3ZpZGVzIGEgVmVyc2lvblNlcnZpY2VcclxuICpcclxuICogTk9URTogVXNpbmcgUHJvdmlkZXI8J2FwcC12ZXJzaW9uJz4gaXMgYSBoYWNrIHRvIGluZGljYXRlIHRoYXQgdGhlIHByb3ZpZGVyXHJcbiAqIHByb3ZpZGVzIFZlcnNpb25TZXJ2aWNlLiBUaGUgcHJvdmlkZXIgaXMgbm90IG5lY2Vzc2FyaWx5IGEgJ2FwcC12ZXJzaW9uJ1xyXG4gKiBwcm92aWRlci5cclxuICovXHJcbmZ1bmN0aW9uIGlzVmVyc2lvblNlcnZpY2VQcm92aWRlcihwcm92aWRlcikge1xyXG4gICAgY29uc3QgY29tcG9uZW50ID0gcHJvdmlkZXIuZ2V0Q29tcG9uZW50KCk7XHJcbiAgICByZXR1cm4gKGNvbXBvbmVudCA9PT0gbnVsbCB8fCBjb21wb25lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbXBvbmVudC50eXBlKSA9PT0gXCJWRVJTSU9OXCIgLyogQ29tcG9uZW50VHlwZS5WRVJTSU9OICovO1xyXG59XG5cbmNvbnN0IG5hbWUkbyA9IFwiQGZpcmViYXNlL2FwcFwiO1xuY29uc3QgdmVyc2lvbiQxID0gXCIwLjkuMVwiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXBwJyk7XG5cbmNvbnN0IG5hbWUkbiA9IFwiQGZpcmViYXNlL2FwcC1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRtID0gXCJAZmlyZWJhc2UvYW5hbHl0aWNzLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGwgPSBcIkBmaXJlYmFzZS9hbmFseXRpY3NcIjtcblxuY29uc3QgbmFtZSRrID0gXCJAZmlyZWJhc2UvYXBwLWNoZWNrLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGogPSBcIkBmaXJlYmFzZS9hcHAtY2hlY2tcIjtcblxuY29uc3QgbmFtZSRpID0gXCJAZmlyZWJhc2UvYXV0aFwiO1xuXG5jb25zdCBuYW1lJGggPSBcIkBmaXJlYmFzZS9hdXRoLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGcgPSBcIkBmaXJlYmFzZS9kYXRhYmFzZVwiO1xuXG5jb25zdCBuYW1lJGYgPSBcIkBmaXJlYmFzZS9kYXRhYmFzZS1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRlID0gXCJAZmlyZWJhc2UvZnVuY3Rpb25zXCI7XG5cbmNvbnN0IG5hbWUkZCA9IFwiQGZpcmViYXNlL2Z1bmN0aW9ucy1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRjID0gXCJAZmlyZWJhc2UvaW5zdGFsbGF0aW9uc1wiO1xuXG5jb25zdCBuYW1lJGIgPSBcIkBmaXJlYmFzZS9pbnN0YWxsYXRpb25zLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGEgPSBcIkBmaXJlYmFzZS9tZXNzYWdpbmdcIjtcblxuY29uc3QgbmFtZSQ5ID0gXCJAZmlyZWJhc2UvbWVzc2FnaW5nLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJDggPSBcIkBmaXJlYmFzZS9wZXJmb3JtYW5jZVwiO1xuXG5jb25zdCBuYW1lJDcgPSBcIkBmaXJlYmFzZS9wZXJmb3JtYW5jZS1jb21wYXRcIjtcblxuY29uc3QgbmFtZSQ2ID0gXCJAZmlyZWJhc2UvcmVtb3RlLWNvbmZpZ1wiO1xuXG5jb25zdCBuYW1lJDUgPSBcIkBmaXJlYmFzZS9yZW1vdGUtY29uZmlnLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJDQgPSBcIkBmaXJlYmFzZS9zdG9yYWdlXCI7XG5cbmNvbnN0IG5hbWUkMyA9IFwiQGZpcmViYXNlL3N0b3JhZ2UtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkMiA9IFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuXG5jb25zdCBuYW1lJDEgPSBcIkBmaXJlYmFzZS9maXJlc3RvcmUtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUgPSBcImZpcmViYXNlXCI7XG5jb25zdCB2ZXJzaW9uID0gXCI5LjE2LjBcIjtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRoZSBkZWZhdWx0IGFwcCBuYW1lXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgREVGQVVMVF9FTlRSWV9OQU1FID0gJ1tERUZBVUxUXSc7XHJcbmNvbnN0IFBMQVRGT1JNX0xPR19TVFJJTkcgPSB7XHJcbiAgICBbbmFtZSRvXTogJ2ZpcmUtY29yZScsXHJcbiAgICBbbmFtZSRuXTogJ2ZpcmUtY29yZS1jb21wYXQnLFxyXG4gICAgW25hbWUkbF06ICdmaXJlLWFuYWx5dGljcycsXHJcbiAgICBbbmFtZSRtXTogJ2ZpcmUtYW5hbHl0aWNzLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRqXTogJ2ZpcmUtYXBwLWNoZWNrJyxcclxuICAgIFtuYW1lJGtdOiAnZmlyZS1hcHAtY2hlY2stY29tcGF0JyxcclxuICAgIFtuYW1lJGldOiAnZmlyZS1hdXRoJyxcclxuICAgIFtuYW1lJGhdOiAnZmlyZS1hdXRoLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRnXTogJ2ZpcmUtcnRkYicsXHJcbiAgICBbbmFtZSRmXTogJ2ZpcmUtcnRkYi1jb21wYXQnLFxyXG4gICAgW25hbWUkZV06ICdmaXJlLWZuJyxcclxuICAgIFtuYW1lJGRdOiAnZmlyZS1mbi1jb21wYXQnLFxyXG4gICAgW25hbWUkY106ICdmaXJlLWlpZCcsXHJcbiAgICBbbmFtZSRiXTogJ2ZpcmUtaWlkLWNvbXBhdCcsXHJcbiAgICBbbmFtZSRhXTogJ2ZpcmUtZmNtJyxcclxuICAgIFtuYW1lJDldOiAnZmlyZS1mY20tY29tcGF0JyxcclxuICAgIFtuYW1lJDhdOiAnZmlyZS1wZXJmJyxcclxuICAgIFtuYW1lJDddOiAnZmlyZS1wZXJmLWNvbXBhdCcsXHJcbiAgICBbbmFtZSQ2XTogJ2ZpcmUtcmMnLFxyXG4gICAgW25hbWUkNV06ICdmaXJlLXJjLWNvbXBhdCcsXHJcbiAgICBbbmFtZSQ0XTogJ2ZpcmUtZ2NzJyxcclxuICAgIFtuYW1lJDNdOiAnZmlyZS1nY3MtY29tcGF0JyxcclxuICAgIFtuYW1lJDJdOiAnZmlyZS1mc3QnLFxyXG4gICAgW25hbWUkMV06ICdmaXJlLWZzdC1jb21wYXQnLFxyXG4gICAgJ2ZpcmUtanMnOiAnZmlyZS1qcycsXHJcbiAgICBbbmFtZV06ICdmaXJlLWpzLWFsbCdcclxufTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgX2FwcHMgPSBuZXcgTWFwKCk7XHJcbi8qKlxyXG4gKiBSZWdpc3RlcmVkIGNvbXBvbmVudHMuXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuY29uc3QgX2NvbXBvbmVudHMgPSBuZXcgTWFwKCk7XHJcbi8qKlxyXG4gKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCBiZWluZyBhZGRlZCB0byB0aGlzIGFwcCdzIGNvbnRhaW5lclxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9hZGRDb21wb25lbnQoYXBwLCBjb21wb25lbnQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgYXBwLmNvbnRhaW5lci5hZGRDb21wb25lbnQoY29tcG9uZW50KTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gZmFpbGVkIHRvIHJlZ2lzdGVyIHdpdGggRmlyZWJhc2VBcHAgJHthcHAubmFtZX1gLCBlKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBfYWRkT3JPdmVyd3JpdGVDb21wb25lbnQoYXBwLCBjb21wb25lbnQpIHtcclxuICAgIGFwcC5jb250YWluZXIuYWRkT3JPdmVyd3JpdGVDb21wb25lbnQoY29tcG9uZW50KTtcclxufVxyXG4vKipcclxuICpcclxuICogQHBhcmFtIGNvbXBvbmVudCAtIHRoZSBjb21wb25lbnQgdG8gcmVnaXN0ZXJcclxuICogQHJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGNvbXBvbmVudCBpcyByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseVxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9yZWdpc3RlckNvbXBvbmVudChjb21wb25lbnQpIHtcclxuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBjb21wb25lbnQubmFtZTtcclxuICAgIGlmIChfY29tcG9uZW50cy5oYXMoY29tcG9uZW50TmFtZSkpIHtcclxuICAgICAgICBsb2dnZXIuZGVidWcoYFRoZXJlIHdlcmUgbXVsdGlwbGUgYXR0ZW1wdHMgdG8gcmVnaXN0ZXIgY29tcG9uZW50ICR7Y29tcG9uZW50TmFtZX0uYCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgX2NvbXBvbmVudHMuc2V0KGNvbXBvbmVudE5hbWUsIGNvbXBvbmVudCk7XHJcbiAgICAvLyBhZGQgdGhlIGNvbXBvbmVudCB0byBleGlzdGluZyBhcHAgaW5zdGFuY2VzXHJcbiAgICBmb3IgKGNvbnN0IGFwcCBvZiBfYXBwcy52YWx1ZXMoKSkge1xyXG4gICAgICAgIF9hZGRDb21wb25lbnQoYXBwLCBjb21wb25lbnQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSBhcHAgLSBGaXJlYmFzZUFwcCBpbnN0YW5jZVxyXG4gKiBAcGFyYW0gbmFtZSAtIHNlcnZpY2UgbmFtZVxyXG4gKlxyXG4gKiBAcmV0dXJucyB0aGUgcHJvdmlkZXIgZm9yIHRoZSBzZXJ2aWNlIHdpdGggdGhlIG1hdGNoaW5nIG5hbWVcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBfZ2V0UHJvdmlkZXIoYXBwLCBuYW1lKSB7XHJcbiAgICBjb25zdCBoZWFydGJlYXRDb250cm9sbGVyID0gYXBwLmNvbnRhaW5lclxyXG4gICAgICAgIC5nZXRQcm92aWRlcignaGVhcnRiZWF0JylcclxuICAgICAgICAuZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSk7XHJcbiAgICBpZiAoaGVhcnRiZWF0Q29udHJvbGxlcikge1xyXG4gICAgICAgIHZvaWQgaGVhcnRiZWF0Q29udHJvbGxlci50cmlnZ2VySGVhcnRiZWF0KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXBwLmNvbnRhaW5lci5nZXRQcm92aWRlcihuYW1lKTtcclxufVxyXG4vKipcclxuICpcclxuICogQHBhcmFtIGFwcCAtIEZpcmViYXNlQXBwIGluc3RhbmNlXHJcbiAqIEBwYXJhbSBuYW1lIC0gc2VydmljZSBuYW1lXHJcbiAqIEBwYXJhbSBpbnN0YW5jZUlkZW50aWZpZXIgLSBzZXJ2aWNlIGluc3RhbmNlIGlkZW50aWZpZXIgaW4gY2FzZSB0aGUgc2VydmljZSBzdXBwb3J0cyBtdWx0aXBsZSBpbnN0YW5jZXNcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBfcmVtb3ZlU2VydmljZUluc3RhbmNlKGFwcCwgbmFtZSwgaW5zdGFuY2VJZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICBfZ2V0UHJvdmlkZXIoYXBwLCBuYW1lKS5jbGVhckluc3RhbmNlKGluc3RhbmNlSWRlbnRpZmllcik7XHJcbn1cclxuLyoqXHJcbiAqIFRlc3Qgb25seVxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmZ1bmN0aW9uIF9jbGVhckNvbXBvbmVudHMoKSB7XHJcbiAgICBfY29tcG9uZW50cy5jbGVhcigpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IEVSUk9SUyA9IHtcclxuICAgIFtcIm5vLWFwcFwiIC8qIEFwcEVycm9yLk5PX0FQUCAqL106IFwiTm8gRmlyZWJhc2UgQXBwICd7JGFwcE5hbWV9JyBoYXMgYmVlbiBjcmVhdGVkIC0gXCIgK1xyXG4gICAgICAgICdjYWxsIEZpcmViYXNlIEFwcC5pbml0aWFsaXplQXBwKCknLFxyXG4gICAgW1wiYmFkLWFwcC1uYW1lXCIgLyogQXBwRXJyb3IuQkFEX0FQUF9OQU1FICovXTogXCJJbGxlZ2FsIEFwcCBuYW1lOiAneyRhcHBOYW1lfVwiLFxyXG4gICAgW1wiZHVwbGljYXRlLWFwcFwiIC8qIEFwcEVycm9yLkRVUExJQ0FURV9BUFAgKi9dOiBcIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBleGlzdHMgd2l0aCBkaWZmZXJlbnQgb3B0aW9ucyBvciBjb25maWdcIixcclxuICAgIFtcImFwcC1kZWxldGVkXCIgLyogQXBwRXJyb3IuQVBQX0RFTEVURUQgKi9dOiBcIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBkZWxldGVkXCIsXHJcbiAgICBbXCJuby1vcHRpb25zXCIgLyogQXBwRXJyb3IuTk9fT1BUSU9OUyAqL106ICdOZWVkIHRvIHByb3ZpZGUgb3B0aW9ucywgd2hlbiBub3QgYmVpbmcgZGVwbG95ZWQgdG8gaG9zdGluZyB2aWEgc291cmNlLicsXHJcbiAgICBbXCJpbnZhbGlkLWFwcC1hcmd1bWVudFwiIC8qIEFwcEVycm9yLklOVkFMSURfQVBQX0FSR1VNRU5UICovXTogJ2ZpcmViYXNlLnskYXBwTmFtZX0oKSB0YWtlcyBlaXRoZXIgbm8gYXJndW1lbnQgb3IgYSAnICtcclxuICAgICAgICAnRmlyZWJhc2UgQXBwIGluc3RhbmNlLicsXHJcbiAgICBbXCJpbnZhbGlkLWxvZy1hcmd1bWVudFwiIC8qIEFwcEVycm9yLklOVkFMSURfTE9HX0FSR1VNRU5UICovXTogJ0ZpcnN0IGFyZ3VtZW50IHRvIGBvbkxvZ2AgbXVzdCBiZSBudWxsIG9yIGEgZnVuY3Rpb24uJyxcclxuICAgIFtcImlkYi1vcGVuXCIgLyogQXBwRXJyb3IuSURCX09QRU4gKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gb3BlbmluZyBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLFxyXG4gICAgW1wiaWRiLWdldFwiIC8qIEFwcEVycm9yLklEQl9HRVQgKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gcmVhZGluZyBmcm9tIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXHJcbiAgICBbXCJpZGItc2V0XCIgLyogQXBwRXJyb3IuSURCX1dSSVRFICovXTogJ0Vycm9yIHRocm93biB3aGVuIHdyaXRpbmcgdG8gSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJyxcclxuICAgIFtcImlkYi1kZWxldGVcIiAvKiBBcHBFcnJvci5JREJfREVMRVRFICovXTogJ0Vycm9yIHRocm93biB3aGVuIGRlbGV0aW5nIGZyb20gSW5kZXhlZERCLiBPcmlnaW5hbCBlcnJvcjogeyRvcmlnaW5hbEVycm9yTWVzc2FnZX0uJ1xyXG59O1xyXG5jb25zdCBFUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeSgnYXBwJywgJ0ZpcmViYXNlJywgRVJST1JTKTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgRmlyZWJhc2VBcHBJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5faXNEZWxldGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7XHJcbiAgICAgICAgdGhpcy5fbmFtZSA9IGNvbmZpZy5uYW1lO1xyXG4gICAgICAgIHRoaXMuX2F1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9XHJcbiAgICAgICAgICAgIGNvbmZpZy5hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmFkZENvbXBvbmVudChuZXcgQ29tcG9uZW50KCdhcHAnLCAoKSA9PiB0aGlzLCBcIlBVQkxJQ1wiIC8qIENvbXBvbmVudFR5cGUuUFVCTElDICovKSk7XHJcbiAgICB9XHJcbiAgICBnZXQgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkO1xyXG4gICAgfVxyXG4gICAgc2V0IGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCh2YWwpIHtcclxuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XHJcbiAgICAgICAgdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkID0gdmFsO1xyXG4gICAgfVxyXG4gICAgZ2V0IG5hbWUoKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9uYW1lO1xyXG4gICAgfVxyXG4gICAgZ2V0IG9wdGlvbnMoKSB7XHJcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xyXG4gICAgfVxyXG4gICAgZ2V0IGNvbmZpZygpIHtcclxuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcclxuICAgIH1cclxuICAgIGdldCBjb250YWluZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjtcclxuICAgIH1cclxuICAgIGdldCBpc0RlbGV0ZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGVsZXRlZDtcclxuICAgIH1cclxuICAgIHNldCBpc0RlbGV0ZWQodmFsKSB7XHJcbiAgICAgICAgdGhpcy5faXNEZWxldGVkID0gdmFsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYW4gRXJyb3IgaWYgdGhlIEFwcCBoYXMgYWxyZWFkeSBiZWVuIGRlbGV0ZWQgLVxyXG4gICAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuXHJcbiAgICAgKi9cclxuICAgIGNoZWNrRGVzdHJveWVkKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImFwcC1kZWxldGVkXCIgLyogQXBwRXJyb3IuQVBQX0RFTEVURUQgKi8sIHsgYXBwTmFtZTogdGhpcy5fbmFtZSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRoZSBjdXJyZW50IFNESyB2ZXJzaW9uLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBTREtfVkVSU0lPTiA9IHZlcnNpb247XHJcbmZ1bmN0aW9uIGluaXRpYWxpemVBcHAoX29wdGlvbnMsIHJhd0NvbmZpZyA9IHt9KSB7XHJcbiAgICBsZXQgb3B0aW9ucyA9IF9vcHRpb25zO1xyXG4gICAgaWYgKHR5cGVvZiByYXdDb25maWcgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgY29uc3QgbmFtZSA9IHJhd0NvbmZpZztcclxuICAgICAgICByYXdDb25maWcgPSB7IG5hbWUgfTtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oeyBuYW1lOiBERUZBVUxUX0VOVFJZX05BTUUsIGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDogZmFsc2UgfSwgcmF3Q29uZmlnKTtcclxuICAgIGNvbnN0IG5hbWUgPSBjb25maWcubmFtZTtcclxuICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gJ3N0cmluZycgfHwgIW5hbWUpIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImJhZC1hcHAtbmFtZVwiIC8qIEFwcEVycm9yLkJBRF9BUFBfTkFNRSAqLywge1xyXG4gICAgICAgICAgICBhcHBOYW1lOiBTdHJpbmcobmFtZSlcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSBnZXREZWZhdWx0QXBwQ29uZmlnKCkpO1xyXG4gICAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJuby1vcHRpb25zXCIgLyogQXBwRXJyb3IuTk9fT1BUSU9OUyAqLyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBleGlzdGluZ0FwcCA9IF9hcHBzLmdldChuYW1lKTtcclxuICAgIGlmIChleGlzdGluZ0FwcCkge1xyXG4gICAgICAgIC8vIHJldHVybiB0aGUgZXhpc3RpbmcgYXBwIGlmIG9wdGlvbnMgYW5kIGNvbmZpZyBkZWVwIGVxdWFsIHRoZSBvbmVzIGluIHRoZSBleGlzdGluZyBhcHAuXHJcbiAgICAgICAgaWYgKGRlZXBFcXVhbChvcHRpb25zLCBleGlzdGluZ0FwcC5vcHRpb25zKSAmJlxyXG4gICAgICAgICAgICBkZWVwRXF1YWwoY29uZmlnLCBleGlzdGluZ0FwcC5jb25maWcpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleGlzdGluZ0FwcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiZHVwbGljYXRlLWFwcFwiIC8qIEFwcEVycm9yLkRVUExJQ0FURV9BUFAgKi8sIHsgYXBwTmFtZTogbmFtZSB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBjb250YWluZXIgPSBuZXcgQ29tcG9uZW50Q29udGFpbmVyKG5hbWUpO1xyXG4gICAgZm9yIChjb25zdCBjb21wb25lbnQgb2YgX2NvbXBvbmVudHMudmFsdWVzKCkpIHtcclxuICAgICAgICBjb250YWluZXIuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBuZXdBcHAgPSBuZXcgRmlyZWJhc2VBcHBJbXBsKG9wdGlvbnMsIGNvbmZpZywgY29udGFpbmVyKTtcclxuICAgIF9hcHBzLnNldChuYW1lLCBuZXdBcHApO1xyXG4gICAgcmV0dXJuIG5ld0FwcDtcclxufVxyXG4vKipcclxuICogUmV0cmlldmVzIGEge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBXaGVuIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50cywgdGhlIGRlZmF1bHQgYXBwIGlzIHJldHVybmVkLiBXaGVuIGFuIGFwcCBuYW1lXHJcbiAqIGlzIHByb3ZpZGVkLCB0aGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhhdCBuYW1lIGlzIHJldHVybmVkLlxyXG4gKlxyXG4gKiBBbiBleGNlcHRpb24gaXMgdGhyb3duIGlmIHRoZSBhcHAgYmVpbmcgcmV0cmlldmVkIGhhcyBub3QgeWV0IGJlZW5cclxuICogaW5pdGlhbGl6ZWQuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gUmV0dXJuIHRoZSBkZWZhdWx0IGFwcFxyXG4gKiBjb25zdCBhcHAgPSBnZXRBcHAoKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gUmV0dXJuIGEgbmFtZWQgYXBwXHJcbiAqIGNvbnN0IG90aGVyQXBwID0gZ2V0QXBwKFwib3RoZXJBcHBcIik7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gbmFtZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGFwcCB0byByZXR1cm4uIElmIG5vIG5hbWUgaXNcclxuICogICBwcm92aWRlZCwgdGhlIGRlZmF1bHQgaXMgYFwiW0RFRkFVTFRdXCJgLlxyXG4gKlxyXG4gKiBAcmV0dXJucyBUaGUgYXBwIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3ZpZGVkIGFwcCBuYW1lLlxyXG4gKiAgIElmIG5vIGFwcCBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgZGVmYXVsdCBhcHAgaXMgcmV0dXJuZWQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEFwcChuYW1lID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XHJcbiAgICBjb25zdCBhcHAgPSBfYXBwcy5nZXQobmFtZSk7XHJcbiAgICBpZiAoIWFwcCAmJiBuYW1lID09PSBERUZBVUxUX0VOVFJZX05BTUUpIHtcclxuICAgICAgICByZXR1cm4gaW5pdGlhbGl6ZUFwcCgpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFhcHApIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcIm5vLWFwcFwiIC8qIEFwcEVycm9yLk5PX0FQUCAqLywgeyBhcHBOYW1lOiBuYW1lIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFwcDtcclxufVxyXG4vKipcclxuICogQSAocmVhZC1vbmx5KSBhcnJheSBvZiBhbGwgaW5pdGlhbGl6ZWQgYXBwcy5cclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0QXBwcygpIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKF9hcHBzLnZhbHVlcygpKTtcclxufVxyXG4vKipcclxuICogUmVuZGVycyB0aGlzIGFwcCB1bnVzYWJsZSBhbmQgZnJlZXMgdGhlIHJlc291cmNlcyBvZiBhbGwgYXNzb2NpYXRlZFxyXG4gKiBzZXJ2aWNlcy5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBkZWxldGVBcHAoYXBwKVxyXG4gKiAgIC50aGVuKGZ1bmN0aW9uKCkge1xyXG4gKiAgICAgY29uc29sZS5sb2coXCJBcHAgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIik7XHJcbiAqICAgfSlcclxuICogICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcclxuICogICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgZGVsZXRpbmcgYXBwOlwiLCBlcnJvcik7XHJcbiAqICAgfSk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBkZWxldGVBcHAoYXBwKSB7XHJcbiAgICBjb25zdCBuYW1lID0gYXBwLm5hbWU7XHJcbiAgICBpZiAoX2FwcHMuaGFzKG5hbWUpKSB7XHJcbiAgICAgICAgX2FwcHMuZGVsZXRlKG5hbWUpO1xyXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKGFwcC5jb250YWluZXJcclxuICAgICAgICAgICAgLmdldFByb3ZpZGVycygpXHJcbiAgICAgICAgICAgIC5tYXAocHJvdmlkZXIgPT4gcHJvdmlkZXIuZGVsZXRlKCkpKTtcclxuICAgICAgICBhcHAuaXNEZWxldGVkID0gdHJ1ZTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogUmVnaXN0ZXJzIGEgbGlicmFyeSdzIG5hbWUgYW5kIHZlcnNpb24gZm9yIHBsYXRmb3JtIGxvZ2dpbmcgcHVycG9zZXMuXHJcbiAqIEBwYXJhbSBsaWJyYXJ5IC0gTmFtZSBvZiAxcCBvciAzcCBsaWJyYXJ5IChlLmcuIGZpcmVzdG9yZSwgYW5ndWxhcmZpcmUpXHJcbiAqIEBwYXJhbSB2ZXJzaW9uIC0gQ3VycmVudCB2ZXJzaW9uIG9mIHRoYXQgbGlicmFyeS5cclxuICogQHBhcmFtIHZhcmlhbnQgLSBCdW5kbGUgdmFyaWFudCwgZS5nLiwgbm9kZSwgcm4sIGV0Yy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gcmVnaXN0ZXJWZXJzaW9uKGxpYnJhcnlLZXlPck5hbWUsIHZlcnNpb24sIHZhcmlhbnQpIHtcclxuICAgIHZhciBfYTtcclxuICAgIC8vIFRPRE86IFdlIGNhbiB1c2UgdGhpcyBjaGVjayB0byB3aGl0ZWxpc3Qgc3RyaW5ncyB3aGVuL2lmIHdlIHNldCB1cFxyXG4gICAgLy8gYSBnb29kIHdoaXRlbGlzdCBzeXN0ZW0uXHJcbiAgICBsZXQgbGlicmFyeSA9IChfYSA9IFBMQVRGT1JNX0xPR19TVFJJTkdbbGlicmFyeUtleU9yTmFtZV0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGxpYnJhcnlLZXlPck5hbWU7XHJcbiAgICBpZiAodmFyaWFudCkge1xyXG4gICAgICAgIGxpYnJhcnkgKz0gYC0ke3ZhcmlhbnR9YDtcclxuICAgIH1cclxuICAgIGNvbnN0IGxpYnJhcnlNaXNtYXRjaCA9IGxpYnJhcnkubWF0Y2goL1xcc3xcXC8vKTtcclxuICAgIGNvbnN0IHZlcnNpb25NaXNtYXRjaCA9IHZlcnNpb24ubWF0Y2goL1xcc3xcXC8vKTtcclxuICAgIGlmIChsaWJyYXJ5TWlzbWF0Y2ggfHwgdmVyc2lvbk1pc21hdGNoKSB7XHJcbiAgICAgICAgY29uc3Qgd2FybmluZyA9IFtcclxuICAgICAgICAgICAgYFVuYWJsZSB0byByZWdpc3RlciBsaWJyYXJ5IFwiJHtsaWJyYXJ5fVwiIHdpdGggdmVyc2lvbiBcIiR7dmVyc2lvbn1cIjpgXHJcbiAgICAgICAgXTtcclxuICAgICAgICBpZiAobGlicmFyeU1pc21hdGNoKSB7XHJcbiAgICAgICAgICAgIHdhcm5pbmcucHVzaChgbGlicmFyeSBuYW1lIFwiJHtsaWJyYXJ5fVwiIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycyAod2hpdGVzcGFjZSBvciBcIi9cIilgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCAmJiB2ZXJzaW9uTWlzbWF0Y2gpIHtcclxuICAgICAgICAgICAgd2FybmluZy5wdXNoKCdhbmQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZlcnNpb25NaXNtYXRjaCkge1xyXG4gICAgICAgICAgICB3YXJuaW5nLnB1c2goYHZlcnNpb24gbmFtZSBcIiR7dmVyc2lvbn1cIiBjb250YWlucyBpbGxlZ2FsIGNoYXJhY3RlcnMgKHdoaXRlc3BhY2Ugb3IgXCIvXCIpYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvZ2dlci53YXJuKHdhcm5pbmcuam9pbignICcpKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudChgJHtsaWJyYXJ5fS12ZXJzaW9uYCwgKCkgPT4gKHsgbGlicmFyeSwgdmVyc2lvbiB9KSwgXCJWRVJTSU9OXCIgLyogQ29tcG9uZW50VHlwZS5WRVJTSU9OICovKSk7XHJcbn1cclxuLyoqXHJcbiAqIFNldHMgbG9nIGhhbmRsZXIgZm9yIGFsbCBGaXJlYmFzZSBTREtzLlxyXG4gKiBAcGFyYW0gbG9nQ2FsbGJhY2sgLSBBbiBvcHRpb25hbCBjdXN0b20gbG9nIGhhbmRsZXIgdGhhdCBleGVjdXRlcyB1c2VyIGNvZGUgd2hlbmV2ZXJcclxuICogdGhlIEZpcmViYXNlIFNESyBtYWtlcyBhIGxvZ2dpbmcgY2FsbC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gb25Mb2cobG9nQ2FsbGJhY2ssIG9wdGlvbnMpIHtcclxuICAgIGlmIChsb2dDYWxsYmFjayAhPT0gbnVsbCAmJiB0eXBlb2YgbG9nQ2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImludmFsaWQtbG9nLWFyZ3VtZW50XCIgLyogQXBwRXJyb3IuSU5WQUxJRF9MT0dfQVJHVU1FTlQgKi8pO1xyXG4gICAgfVxyXG4gICAgc2V0VXNlckxvZ0hhbmRsZXIobG9nQ2FsbGJhY2ssIG9wdGlvbnMpO1xyXG59XHJcbi8qKlxyXG4gKiBTZXRzIGxvZyBsZXZlbCBmb3IgYWxsIEZpcmViYXNlIFNES3MuXHJcbiAqXHJcbiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCBhcmUgY2FwdHVyZWQgKGkuZS4gaWZcclxuICogeW91IHNldCB0aGUgbG9nIGxldmVsIHRvIGBpbmZvYCwgZXJyb3JzIGFyZSBsb2dnZWQsIGJ1dCBgZGVidWdgIGFuZFxyXG4gKiBgdmVyYm9zZWAgbG9ncyBhcmUgbm90KS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gc2V0TG9nTGV2ZWwobG9nTGV2ZWwpIHtcclxuICAgIHNldExvZ0xldmVsJDEobG9nTGV2ZWwpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERCX05BTUUgPSAnZmlyZWJhc2UtaGVhcnRiZWF0LWRhdGFiYXNlJztcclxuY29uc3QgREJfVkVSU0lPTiA9IDE7XHJcbmNvbnN0IFNUT1JFX05BTUUgPSAnZmlyZWJhc2UtaGVhcnRiZWF0LXN0b3JlJztcclxubGV0IGRiUHJvbWlzZSA9IG51bGw7XHJcbmZ1bmN0aW9uIGdldERiUHJvbWlzZSgpIHtcclxuICAgIGlmICghZGJQcm9taXNlKSB7XHJcbiAgICAgICAgZGJQcm9taXNlID0gb3BlbkRCKERCX05BTUUsIERCX1ZFUlNJT04sIHtcclxuICAgICAgICAgICAgdXBncmFkZTogKGRiLCBvbGRWZXJzaW9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCB1c2UgJ2JyZWFrJyBpbiB0aGlzIHN3aXRjaCBzdGF0ZW1lbnQsIHRoZSBmYWxsLXRocm91Z2hcclxuICAgICAgICAgICAgICAgIC8vIGJlaGF2aW9yIGlzIHdoYXQgd2Ugd2FudCwgYmVjYXVzZSBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgdmVyc2lvbnMgYmV0d2VlblxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIG9sZCB2ZXJzaW9uIGFuZCB0aGUgY3VycmVudCB2ZXJzaW9uLCB3ZSB3YW50IEFMTCB0aGUgbWlncmF0aW9uc1xyXG4gICAgICAgICAgICAgICAgLy8gdGhhdCBjb3JyZXNwb25kIHRvIHRob3NlIHZlcnNpb25zIHRvIHJ1biwgbm90IG9ubHkgdGhlIGxhc3Qgb25lLlxyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlZmF1bHQtY2FzZVxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChvbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShTVE9SRV9OQU1FKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImlkYi1vcGVuXCIgLyogQXBwRXJyb3IuSURCX09QRU4gKi8sIHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlLm1lc3NhZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGJQcm9taXNlO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQihhcHApIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYlByb21pc2UoKTtcclxuICAgICAgICByZXR1cm4gZGJcclxuICAgICAgICAgICAgLnRyYW5zYWN0aW9uKFNUT1JFX05BTUUpXHJcbiAgICAgICAgICAgIC5vYmplY3RTdG9yZShTVE9SRV9OQU1FKVxyXG4gICAgICAgICAgICAuZ2V0KGNvbXB1dGVLZXkoYXBwKSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvcikge1xyXG4gICAgICAgICAgICBsb2dnZXIud2FybihlLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgaWRiR2V0RXJyb3IgPSBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImlkYi1nZXRcIiAvKiBBcHBFcnJvci5JREJfR0VUICovLCB7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLm1lc3NhZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGlkYkdldEVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5hc3luYyBmdW5jdGlvbiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQihhcHAsIGhlYXJ0YmVhdE9iamVjdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGNvbnN0IG9iamVjdFN0b3JlID0gdHgub2JqZWN0U3RvcmUoU1RPUkVfTkFNRSk7XHJcbiAgICAgICAgYXdhaXQgb2JqZWN0U3RvcmUucHV0KGhlYXJ0YmVhdE9iamVjdCwgY29tcHV0ZUtleShhcHApKTtcclxuICAgICAgICByZXR1cm4gdHguZG9uZTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGUubWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBpZGJHZXRFcnJvciA9IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaWRiLXNldFwiIC8qIEFwcEVycm9yLklEQl9XUklURSAqLywge1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvck1lc3NhZ2U6IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5tZXNzYWdlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBsb2dnZXIud2FybihpZGJHZXRFcnJvci5tZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gY29tcHV0ZUtleShhcHApIHtcclxuICAgIHJldHVybiBgJHthcHAubmFtZX0hJHthcHAub3B0aW9ucy5hcHBJZH1gO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IE1BWF9IRUFERVJfQllURVMgPSAxMDI0O1xyXG4vLyAzMCBkYXlzXHJcbmNvbnN0IFNUT1JFRF9IRUFSVEJFQVRfUkVURU5USU9OX01BWF9NSUxMSVMgPSAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDA7XHJcbmNsYXNzIEhlYXJ0YmVhdFNlcnZpY2VJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluLW1lbW9yeSBjYWNoZSBmb3IgaGVhcnRiZWF0cywgdXNlZCBieSBnZXRIZWFydGJlYXRzSGVhZGVyKCkgdG8gZ2VuZXJhdGVcclxuICAgICAgICAgKiB0aGUgaGVhZGVyIHN0cmluZy5cclxuICAgICAgICAgKiBTdG9yZXMgb25lIHJlY29yZCBwZXIgZGF0ZS4gVGhpcyB3aWxsIGJlIGNvbnNvbGlkYXRlZCBpbnRvIHRoZSBzdGFuZGFyZFxyXG4gICAgICAgICAqIGZvcm1hdCBvZiBvbmUgcmVjb3JkIHBlciB1c2VyIGFnZW50IHN0cmluZyBiZWZvcmUgYmVpbmcgc2VudCBhcyBhIGhlYWRlci5cclxuICAgICAgICAgKiBQb3B1bGF0ZWQgZnJvbSBpbmRleGVkREIgd2hlbiB0aGUgY29udHJvbGxlciBpcyBpbnN0YW50aWF0ZWQgYW5kIHNob3VsZFxyXG4gICAgICAgICAqIGJlIGtlcHQgaW4gc3luYyB3aXRoIGluZGV4ZWREQi5cclxuICAgICAgICAgKiBMZWF2ZSBwdWJsaWMgZm9yIGVhc2llciB0ZXN0aW5nLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9IG51bGw7XHJcbiAgICAgICAgY29uc3QgYXBwID0gdGhpcy5jb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcCcpLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgICAgIHRoaXMuX3N0b3JhZ2UgPSBuZXcgSGVhcnRiZWF0U3RvcmFnZUltcGwoYXBwKTtcclxuICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlID0gdGhpcy5fc3RvcmFnZS5yZWFkKCkudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENhbGxlZCB0byByZXBvcnQgYSBoZWFydGJlYXQuIFRoZSBmdW5jdGlvbiB3aWxsIGdlbmVyYXRlXHJcbiAgICAgKiBhIEhlYXJ0YmVhdHNCeVVzZXJBZ2VudCBvYmplY3QsIHVwZGF0ZSBoZWFydGJlYXRzQ2FjaGUsIGFuZCBwZXJzaXN0IGl0XHJcbiAgICAgKiB0byBJbmRleGVkREIuXHJcbiAgICAgKiBOb3RlIHRoYXQgd2Ugb25seSBzdG9yZSBvbmUgaGVhcnRiZWF0IHBlciBkYXkuIFNvIGlmIGEgaGVhcnRiZWF0IGZvciB0b2RheSBpc1xyXG4gICAgICogYWxyZWFkeSBsb2dnZWQsIHN1YnNlcXVlbnQgY2FsbHMgdG8gdGhpcyBmdW5jdGlvbiBpbiB0aGUgc2FtZSBkYXkgd2lsbCBiZSBpZ25vcmVkLlxyXG4gICAgICovXHJcbiAgICBhc3luYyB0cmlnZ2VySGVhcnRiZWF0KCkge1xyXG4gICAgICAgIGNvbnN0IHBsYXRmb3JtTG9nZ2VyID0gdGhpcy5jb250YWluZXJcclxuICAgICAgICAgICAgLmdldFByb3ZpZGVyKCdwbGF0Zm9ybS1sb2dnZXInKVxyXG4gICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICAgICAgLy8gVGhpcyBpcyB0aGUgXCJGaXJlYmFzZSB1c2VyIGFnZW50XCIgc3RyaW5nIGZyb20gdGhlIHBsYXRmb3JtIGxvZ2dlclxyXG4gICAgICAgIC8vIHNlcnZpY2UsIG5vdCB0aGUgYnJvd3NlciB1c2VyIGFnZW50LlxyXG4gICAgICAgIGNvbnN0IGFnZW50ID0gcGxhdGZvcm1Mb2dnZXIuZ2V0UGxhdGZvcm1JbmZvU3RyaW5nKCk7XHJcbiAgICAgICAgY29uc3QgZGF0ZSA9IGdldFVUQ0RhdGVTdHJpbmcoKTtcclxuICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9IGF3YWl0IHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIERvIG5vdCBzdG9yZSBhIGhlYXJ0YmVhdCBpZiBvbmUgaXMgYWxyZWFkeSBzdG9yZWQgZm9yIHRoaXMgZGF5XHJcbiAgICAgICAgLy8gb3IgaWYgYSBoZWFkZXIgaGFzIGFscmVhZHkgYmVlbiBzZW50IHRvZGF5LlxyXG4gICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUubGFzdFNlbnRIZWFydGJlYXREYXRlID09PSBkYXRlIHx8XHJcbiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLnNvbWUoc2luZ2xlRGF0ZUhlYXJ0YmVhdCA9PiBzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGUgPT09IGRhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGVudHJ5IGZvciB0aGlzIGRhdGUuIENyZWF0ZSBvbmUuXHJcbiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLnB1c2goeyBkYXRlLCBhZ2VudCB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUmVtb3ZlIGVudHJpZXMgb2xkZXIgdGhhbiAzMCBkYXlzLlxyXG4gICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzID0gdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMuZmlsdGVyKHNpbmdsZURhdGVIZWFydGJlYXQgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBoYlRpbWVzdGFtcCA9IG5ldyBEYXRlKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSkudmFsdWVPZigpO1xyXG4gICAgICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgICAgICAgICByZXR1cm4gbm93IC0gaGJUaW1lc3RhbXAgPD0gU1RPUkVEX0hFQVJUQkVBVF9SRVRFTlRJT05fTUFYX01JTExJUztcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3RvcmFnZS5vdmVyd3JpdGUodGhpcy5faGVhcnRiZWF0c0NhY2hlKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIGJhc2U2NCBlbmNvZGVkIHN0cmluZyB3aGljaCBjYW4gYmUgYXR0YWNoZWQgdG8gdGhlIGhlYXJ0YmVhdC1zcGVjaWZpYyBoZWFkZXIgZGlyZWN0bHkuXHJcbiAgICAgKiBJdCBhbHNvIGNsZWFycyBhbGwgaGVhcnRiZWF0cyBmcm9tIG1lbW9yeSBhcyB3ZWxsIGFzIGluIEluZGV4ZWREQi5cclxuICAgICAqXHJcbiAgICAgKiBOT1RFOiBDb25zdW1pbmcgcHJvZHVjdCBTREtzIHNob3VsZCBub3Qgc2VuZCB0aGUgaGVhZGVyIGlmIHRoaXMgbWV0aG9kXHJcbiAgICAgKiByZXR1cm5zIGFuIGVtcHR5IHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgZ2V0SGVhcnRiZWF0c0hlYWRlcigpIHtcclxuICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2hlYXJ0YmVhdHNDYWNoZVByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIElmIGl0J3Mgc3RpbGwgbnVsbCBvciB0aGUgYXJyYXkgaXMgZW1wdHksIHRoZXJlIGlzIG5vIGRhdGEgdG8gc2VuZC5cclxuICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsIHx8XHJcbiAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRhdGUgPSBnZXRVVENEYXRlU3RyaW5nKCk7XHJcbiAgICAgICAgLy8gRXh0cmFjdCBhcyBtYW55IGhlYXJ0YmVhdHMgZnJvbSB0aGUgY2FjaGUgYXMgd2lsbCBmaXQgdW5kZXIgdGhlIHNpemUgbGltaXQuXHJcbiAgICAgICAgY29uc3QgeyBoZWFydGJlYXRzVG9TZW5kLCB1bnNlbnRFbnRyaWVzIH0gPSBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcih0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyk7XHJcbiAgICAgICAgY29uc3QgaGVhZGVyU3RyaW5nID0gYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkoeyB2ZXJzaW9uOiAyLCBoZWFydGJlYXRzOiBoZWFydGJlYXRzVG9TZW5kIH0pKTtcclxuICAgICAgICAvLyBTdG9yZSBsYXN0IHNlbnQgZGF0ZSB0byBwcmV2ZW50IGFub3RoZXIgYmVpbmcgbG9nZ2VkL3NlbnQgZm9yIHRoZSBzYW1lIGRheS5cclxuICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUubGFzdFNlbnRIZWFydGJlYXREYXRlID0gZGF0ZTtcclxuICAgICAgICBpZiAodW5zZW50RW50cmllcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vIFN0b3JlIGFueSB1bnNlbnQgZW50cmllcyBpZiB0aGV5IGV4aXN0LlxyXG4gICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cyA9IHVuc2VudEVudHJpZXM7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgc2VlbXMgbW9yZSBsaWtlbHkgdGhhbiBlbXB0eWluZyB0aGUgYXJyYXkgKGJlbG93KSB0byBsZWFkIHRvIHNvbWUgb2RkIHN0YXRlXHJcbiAgICAgICAgICAgIC8vIHNpbmNlIHRoZSBjYWNoZSBpc24ndCBlbXB0eSBhbmQgdGhpcyB3aWxsIGJlIGNhbGxlZCBhZ2FpbiBvbiB0aGUgbmV4dCByZXF1ZXN0LFxyXG4gICAgICAgICAgICAvLyBhbmQgaXMgcHJvYmFibHkgc2FmZXN0IGlmIHdlIGF3YWl0IGl0LlxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl9zdG9yYWdlLm92ZXJ3cml0ZSh0aGlzLl9oZWFydGJlYXRzQ2FjaGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSBbXTtcclxuICAgICAgICAgICAgLy8gRG8gbm90IHdhaXQgZm9yIHRoaXMsIHRvIHJlZHVjZSBsYXRlbmN5LlxyXG4gICAgICAgICAgICB2b2lkIHRoaXMuX3N0b3JhZ2Uub3ZlcndyaXRlKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoZWFkZXJTdHJpbmc7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0VVRDRGF0ZVN0cmluZygpIHtcclxuICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgIC8vIFJldHVybnMgZGF0ZSBmb3JtYXQgJ1lZWVktTU0tREQnXHJcbiAgICByZXR1cm4gdG9kYXkudG9JU09TdHJpbmcoKS5zdWJzdHJpbmcoMCwgMTApO1xyXG59XHJcbmZ1bmN0aW9uIGV4dHJhY3RIZWFydGJlYXRzRm9ySGVhZGVyKGhlYXJ0YmVhdHNDYWNoZSwgbWF4U2l6ZSA9IE1BWF9IRUFERVJfQllURVMpIHtcclxuICAgIC8vIEhlYXJ0YmVhdHMgZ3JvdXBlZCBieSB1c2VyIGFnZW50IGluIHRoZSBzdGFuZGFyZCBmb3JtYXQgdG8gYmUgc2VudCBpblxyXG4gICAgLy8gdGhlIGhlYWRlci5cclxuICAgIGNvbnN0IGhlYXJ0YmVhdHNUb1NlbmQgPSBbXTtcclxuICAgIC8vIFNpbmdsZSBkYXRlIGZvcm1hdCBoZWFydGJlYXRzIHRoYXQgYXJlIG5vdCBzZW50LlxyXG4gICAgbGV0IHVuc2VudEVudHJpZXMgPSBoZWFydGJlYXRzQ2FjaGUuc2xpY2UoKTtcclxuICAgIGZvciAoY29uc3Qgc2luZ2xlRGF0ZUhlYXJ0YmVhdCBvZiBoZWFydGJlYXRzQ2FjaGUpIHtcclxuICAgICAgICAvLyBMb29rIGZvciBhbiBleGlzdGluZyBlbnRyeSB3aXRoIHRoZSBzYW1lIHVzZXIgYWdlbnQuXHJcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0RW50cnkgPSBoZWFydGJlYXRzVG9TZW5kLmZpbmQoaGIgPT4gaGIuYWdlbnQgPT09IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQpO1xyXG4gICAgICAgIGlmICghaGVhcnRiZWF0RW50cnkpIHtcclxuICAgICAgICAgICAgLy8gSWYgbm8gZW50cnkgZm9yIHRoaXMgdXNlciBhZ2VudCBleGlzdHMsIGNyZWF0ZSBvbmUuXHJcbiAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBhZ2VudDogc2luZ2xlRGF0ZUhlYXJ0YmVhdC5hZ2VudCxcclxuICAgICAgICAgICAgICAgIGRhdGVzOiBbc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKGNvdW50Qnl0ZXMoaGVhcnRiZWF0c1RvU2VuZCkgPiBtYXhTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgaGVhZGVyIHdvdWxkIGV4Y2VlZCBtYXggc2l6ZSwgcmVtb3ZlIHRoZSBhZGRlZCBoZWFydGJlYXRcclxuICAgICAgICAgICAgICAgIC8vIGVudHJ5IGFuZCBzdG9wIGFkZGluZyB0byB0aGUgaGVhZGVyLlxyXG4gICAgICAgICAgICAgICAgaGVhcnRiZWF0c1RvU2VuZC5wb3AoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBoZWFydGJlYXRFbnRyeS5kYXRlcy5wdXNoKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSk7XHJcbiAgICAgICAgICAgIC8vIElmIHRoZSBoZWFkZXIgd291bGQgZXhjZWVkIG1heCBzaXplLCByZW1vdmUgdGhlIGFkZGVkIGRhdGVcclxuICAgICAgICAgICAgLy8gYW5kIHN0b3AgYWRkaW5nIHRvIHRoZSBoZWFkZXIuXHJcbiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgaGVhcnRiZWF0RW50cnkuZGF0ZXMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBQb3AgdW5zZW50IGVudHJ5IGZyb20gcXVldWUuIChTa2lwcGVkIGlmIGFkZGluZyB0aGUgZW50cnkgZXhjZWVkZWRcclxuICAgICAgICAvLyBxdW90YSBhbmQgdGhlIGxvb3AgYnJlYWtzIGVhcmx5LilcclxuICAgICAgICB1bnNlbnRFbnRyaWVzID0gdW5zZW50RW50cmllcy5zbGljZSgxKTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaGVhcnRiZWF0c1RvU2VuZCxcclxuICAgICAgICB1bnNlbnRFbnRyaWVzXHJcbiAgICB9O1xyXG59XHJcbmNsYXNzIEhlYXJ0YmVhdFN0b3JhZ2VJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xyXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xyXG4gICAgICAgIHRoaXMuX2NhblVzZUluZGV4ZWREQlByb21pc2UgPSB0aGlzLnJ1bkluZGV4ZWREQkVudmlyb25tZW50Q2hlY2soKTtcclxuICAgIH1cclxuICAgIGFzeW5jIHJ1bkluZGV4ZWREQkVudmlyb25tZW50Q2hlY2soKSB7XHJcbiAgICAgICAgaWYgKCFpc0luZGV4ZWREQkF2YWlsYWJsZSgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKClcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRydWUpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4gZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVhZCBhbGwgaGVhcnRiZWF0cy5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgcmVhZCgpIHtcclxuICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xyXG4gICAgICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGhlYXJ0YmVhdHM6IFtdIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBpZGJIZWFydGJlYXRPYmplY3QgPSBhd2FpdCByZWFkSGVhcnRiZWF0c0Zyb21JbmRleGVkREIodGhpcy5hcHApO1xyXG4gICAgICAgICAgICByZXR1cm4gaWRiSGVhcnRiZWF0T2JqZWN0IHx8IHsgaGVhcnRiZWF0czogW10gfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBvdmVyd3JpdGUgdGhlIHN0b3JhZ2Ugd2l0aCB0aGUgcHJvdmlkZWQgaGVhcnRiZWF0c1xyXG4gICAgYXN5bmMgb3ZlcndyaXRlKGhlYXJ0YmVhdHNPYmplY3QpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgY2FuVXNlSW5kZXhlZERCID0gYXdhaXQgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZTtcclxuICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QgPSBhd2FpdCB0aGlzLnJlYWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7XHJcbiAgICAgICAgICAgICAgICBsYXN0U2VudEhlYXJ0YmVhdERhdGU6IChfYSA9IGhlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlLFxyXG4gICAgICAgICAgICAgICAgaGVhcnRiZWF0czogaGVhcnRiZWF0c09iamVjdC5oZWFydGJlYXRzXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIGFkZCBoZWFydGJlYXRzXHJcbiAgICBhc3luYyBhZGQoaGVhcnRiZWF0c09iamVjdCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xyXG4gICAgICAgIGlmICghY2FuVXNlSW5kZXhlZERCKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gd3JpdGVIZWFydGJlYXRzVG9JbmRleGVkREIodGhpcy5hcHAsIHtcclxuICAgICAgICAgICAgICAgIGxhc3RTZW50SGVhcnRiZWF0RGF0ZTogKF9hID0gaGVhcnRiZWF0c09iamVjdC5sYXN0U2VudEhlYXJ0YmVhdERhdGUpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdC5sYXN0U2VudEhlYXJ0YmVhdERhdGUsXHJcbiAgICAgICAgICAgICAgICBoZWFydGJlYXRzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHMsXHJcbiAgICAgICAgICAgICAgICAgICAgLi4uaGVhcnRiZWF0c09iamVjdC5oZWFydGJlYXRzXHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKipcclxuICogQ2FsY3VsYXRlIGJ5dGVzIG9mIGEgSGVhcnRiZWF0c0J5VXNlckFnZW50IGFycmF5IGFmdGVyIGJlaW5nIHdyYXBwZWRcclxuICogaW4gYSBwbGF0Zm9ybSBsb2dnaW5nIGhlYWRlciBKU09OIG9iamVjdCwgc3RyaW5naWZpZWQsIGFuZCBjb252ZXJ0ZWRcclxuICogdG8gYmFzZSA2NC5cclxuICovXHJcbmZ1bmN0aW9uIGNvdW50Qnl0ZXMoaGVhcnRiZWF0c0NhY2hlKSB7XHJcbiAgICAvLyBiYXNlNjQgaGFzIGEgcmVzdHJpY3RlZCBzZXQgb2YgY2hhcmFjdGVycywgYWxsIG9mIHdoaWNoIHNob3VsZCBiZSAxIGJ5dGUuXHJcbiAgICByZXR1cm4gYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoXHJcbiAgICAvLyBoZWFydGJlYXRzQ2FjaGUgd3JhcHBlciBwcm9wZXJ0aWVzXHJcbiAgICBKU09OLnN0cmluZ2lmeSh7IHZlcnNpb246IDIsIGhlYXJ0YmVhdHM6IGhlYXJ0YmVhdHNDYWNoZSB9KSkubGVuZ3RoO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIHJlZ2lzdGVyQ29yZUNvbXBvbmVudHModmFyaWFudCkge1xyXG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoJ3BsYXRmb3JtLWxvZ2dlcicsIGNvbnRhaW5lciA9PiBuZXcgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbChjb250YWluZXIpLCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdoZWFydGJlYXQnLCBjb250YWluZXIgPT4gbmV3IEhlYXJ0YmVhdFNlcnZpY2VJbXBsKGNvbnRhaW5lciksIFwiUFJJVkFURVwiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykpO1xyXG4gICAgLy8gUmVnaXN0ZXIgYGFwcGAgcGFja2FnZS5cclxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJG8sIHZlcnNpb24kMSwgdmFyaWFudCk7XHJcbiAgICAvLyBCVUlMRF9UQVJHRVQgd2lsbCBiZSByZXBsYWNlZCBieSB2YWx1ZXMgbGlrZSBlc201LCBlc20yMDE3LCBjanM1LCBldGMgZHVyaW5nIHRoZSBjb21waWxhdGlvblxyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUkbywgdmVyc2lvbiQxLCAnZXNtMjAxNycpO1xyXG4gICAgLy8gUmVnaXN0ZXIgcGxhdGZvcm0gU0RLIGlkZW50aWZpZXIgKG5vIHZlcnNpb24pLlxyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKCdmaXJlLWpzJywgJycpO1xyXG59XG5cbi8qKlxyXG4gKiBGaXJlYmFzZSBBcHBcclxuICpcclxuICogQHJlbWFya3MgVGhpcyBwYWNrYWdlIGNvb3JkaW5hdGVzIHRoZSBjb21tdW5pY2F0aW9uIGJldHdlZW4gdGhlIGRpZmZlcmVudCBGaXJlYmFzZSBjb21wb25lbnRzXHJcbiAqIEBwYWNrYWdlRG9jdW1lbnRhdGlvblxyXG4gKi9cclxucmVnaXN0ZXJDb3JlQ29tcG9uZW50cygnJyk7XG5cbmV4cG9ydCB7IFNES19WRVJTSU9OLCBERUZBVUxUX0VOVFJZX05BTUUgYXMgX0RFRkFVTFRfRU5UUllfTkFNRSwgX2FkZENvbXBvbmVudCwgX2FkZE9yT3ZlcndyaXRlQ29tcG9uZW50LCBfYXBwcywgX2NsZWFyQ29tcG9uZW50cywgX2NvbXBvbmVudHMsIF9nZXRQcm92aWRlciwgX3JlZ2lzdGVyQ29tcG9uZW50LCBfcmVtb3ZlU2VydmljZUluc3RhbmNlLCBkZWxldGVBcHAsIGdldEFwcCwgZ2V0QXBwcywgaW5pdGlhbGl6ZUFwcCwgb25Mb2csIHJlZ2lzdGVyVmVyc2lvbiwgc2V0TG9nTGV2ZWwgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XHJcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEhcclxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXHJcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcclxuSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NXHJcbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXHJcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcclxuUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuLyogZ2xvYmFsIFJlZmxlY3QsIFByb21pc2UgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH1cclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcclxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5tZXRhZGF0YSA9PT0gXCJmdW5jdGlvblwiKSByZXR1cm4gUmVmbGVjdC5tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0ZXIodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cclxuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cclxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxyXG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xyXG4gICAgdmFyIF8gPSB7IGxhYmVsOiAwLCBzZW50OiBmdW5jdGlvbigpIHsgaWYgKHRbMF0gJiAxKSB0aHJvdyB0WzFdOyByZXR1cm4gdFsxXTsgfSwgdHJ5czogW10sIG9wczogW10gfSwgZiwgeSwgdCwgZztcclxuICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCBcInRocm93XCI6IHZlcmIoMSksIFwicmV0dXJuXCI6IHZlcmIoMikgfSwgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IHJldHVybiBmdW5jdGlvbiAodikgeyByZXR1cm4gc3RlcChbbiwgdl0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKG9wKSB7XHJcbiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO1xyXG4gICAgICAgIHdoaWxlIChnICYmIChnID0gMCwgb3BbMF0gJiYgKF8gPSAwKSksIF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0sIGspO1xyXG4gICAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbS5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcclxuICAgICAgICBkZXNjID0geyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9O1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCBkZXNjKTtcclxufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICBvW2syXSA9IG1ba107XHJcbn0pO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBvKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmIChwICE9PSBcImRlZmF1bHRcIiAmJiAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIHApKSBfX2NyZWF0ZUJpbmRpbmcobywgbSwgcCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09IFwibnVtYmVyXCIpIHJldHVybiB7XHJcbiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwO1xyXG4gICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/IFwiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS5cIiA6IFwiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVhZChvLCBuKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XHJcbiAgICBpZiAoIW0pIHJldHVybiBvO1xyXG4gICAgdmFyIGkgPSBtLmNhbGwobyksIHIsIGFyID0gW10sIGU7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHdoaWxlICgobiA9PT0gdm9pZCAwIHx8IG4tLSA+IDApICYmICEociA9IGkubmV4dCgpKS5kb25lKSBhci5wdXNoKHIudmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7IGlmIChlKSB0aHJvdyBlLmVycm9yOyB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbi8qKiBAZGVwcmVjYXRlZCAqL1xyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheXMoKSB7XHJcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcclxuICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKylcclxuICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKylcclxuICAgICAgICAgICAgcltrXSA9IGFbal07XHJcbiAgICByZXR1cm4gcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXkodG8sIGZyb20sIHBhY2spIHtcclxuICAgIGlmIChwYWNrIHx8IGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIGZvciAodmFyIGkgPSAwLCBsID0gZnJvbS5sZW5ndGgsIGFyOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xyXG4gICAgICAgICAgICBpZiAoIWFyKSBhciA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20sIDAsIGkpO1xyXG4gICAgICAgICAgICBhcltpXSA9IGZyb21baV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRvLmNvbmNhdChhciB8fCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2F3YWl0KHYpIHtcclxuICAgIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgZyA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSwgaSwgcSA9IFtdO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlmIChnW25dKSBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyB9XHJcbiAgICBmdW5jdGlvbiByZXN1bWUobiwgdikgeyB0cnkgeyBzdGVwKGdbbl0odikpOyB9IGNhdGNoIChlKSB7IHNldHRsZShxWzBdWzNdLCBlKTsgfSB9XHJcbiAgICBmdW5jdGlvbiBzdGVwKHIpIHsgci52YWx1ZSBpbnN0YW5jZW9mIF9fYXdhaXQgPyBQcm9taXNlLnJlc29sdmUoci52YWx1ZS52KS50aGVuKGZ1bGZpbGwsIHJlamVjdCkgOiBzZXR0bGUocVswXVsyXSwgcik7IH1cclxuICAgIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHJlamVjdCh2YWx1ZSkgeyByZXN1bWUoXCJ0aHJvd1wiLCB2YWx1ZSk7IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShmLCB2KSB7IGlmIChmKHYpLCBxLnNoaWZ0KCksIHEubGVuZ3RoKSByZXN1bWUocVswXVswXSwgcVswXVsxXSk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXN5bmNEZWxlZ2F0b3Iobykge1xyXG4gICAgdmFyIGksIHA7XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIsIGZ1bmN0aW9uIChlKSB7IHRocm93IGU7IH0pLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlbbl0gPSBvW25dID8gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIChwID0gIXApID8geyB2YWx1ZTogX19hd2FpdChvW25dKHYpKSwgZG9uZTogbiA9PT0gXCJyZXR1cm5cIiB9IDogZiA/IGYodikgOiB2OyB9IDogZjsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY1ZhbHVlcyhvKSB7XHJcbiAgICBpZiAoIVN5bWJvbC5hc3luY0l0ZXJhdG9yKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3ltYm9sLmFzeW5jSXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcclxuICAgIHJldHVybiBtID8gbS5jYWxsKG8pIDogKG8gPSB0eXBlb2YgX192YWx1ZXMgPT09IFwiZnVuY3Rpb25cIiA/IF9fdmFsdWVzKG8pIDogb1tTeW1ib2wuaXRlcmF0b3JdKCksIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpKTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobikgeyBpW25dID0gb1tuXSAmJiBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2ID0gb1tuXSh2KSwgc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgdi5kb25lLCB2LnZhbHVlKTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZCwgcmF3KSB7XHJcbiAgICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjb29rZWQsIFwicmF3XCIsIHsgdmFsdWU6IHJhdyB9KTsgfSBlbHNlIHsgY29va2VkLnJhdyA9IHJhdzsgfVxyXG4gICAgcmV0dXJuIGNvb2tlZDtcclxufTtcclxuXHJcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcclxufSkgOiBmdW5jdGlvbihvLCB2KSB7XHJcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcclxuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRHZXQocmVjZWl2ZXIsIHN0YXRlLCBraW5kLCBmKSB7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBnZXR0ZXJcIik7XHJcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiBraW5kID09PSBcIm1cIiA/IGYgOiBraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlcikgOiBmID8gZi52YWx1ZSA6IHN0YXRlLmdldChyZWNlaXZlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0KHJlY2VpdmVyLCBzdGF0ZSwgdmFsdWUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcIm1cIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgbWV0aG9kIGlzIG5vdCB3cml0YWJsZVwiKTtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIHNldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHdyaXRlIHByaXZhdGUgbWVtYmVyIHRvIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XHJcbiAgICByZXR1cm4gKGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyLCB2YWx1ZSkgOiBmID8gZi52YWx1ZSA9IHZhbHVlIDogc3RhdGUuc2V0KHJlY2VpdmVyLCB2YWx1ZSkpLCB2YWx1ZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRJbihzdGF0ZSwgcmVjZWl2ZXIpIHtcclxuICAgIGlmIChyZWNlaXZlciA9PT0gbnVsbCB8fCAodHlwZW9mIHJlY2VpdmVyICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiByZWNlaXZlciAhPT0gXCJmdW5jdGlvblwiKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB1c2UgJ2luJyBvcGVyYXRvciBvbiBub24tb2JqZWN0XCIpO1xyXG4gICAgcmV0dXJuIHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgPT09IHN0YXRlIDogc3RhdGUuaGFzKHJlY2VpdmVyKTtcclxufVxyXG4iLCJpbXBvcnQgeyByZWdpc3RlclZlcnNpb24gfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmV4cG9ydCAqIGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuXG52YXIgbmFtZSA9IFwiZmlyZWJhc2VcIjtcbnZhciB2ZXJzaW9uID0gXCI5LjE2LjBcIjtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxucmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24sICdhcHAnKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbS5qcy5tYXBcbiIsImltcG9ydCB7IEVycm9yRmFjdG9yeSwgZGVlcEVxdWFsLCBpc0Jyb3dzZXJFeHRlbnNpb24sIGlzTW9iaWxlQ29yZG92YSwgaXNSZWFjdE5hdGl2ZSwgRmlyZWJhc2VFcnJvciwgcXVlcnlzdHJpbmcsIGdldE1vZHVsYXJJbnN0YW5jZSwgYmFzZTY0RGVjb2RlLCBnZXRVQSwgaXNJRSwgY3JlYXRlU3Vic2NyaWJlLCBxdWVyeXN0cmluZ0RlY29kZSwgZXh0cmFjdFF1ZXJ5c3RyaW5nLCBpc0VtcHR5LCBnZXRFeHBlcmltZW50YWxTZXR0aW5nLCBnZXREZWZhdWx0RW11bGF0b3JIb3N0IH0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHsgU0RLX1ZFUlNJT04sIF9nZXRQcm92aWRlciwgX3JlZ2lzdGVyQ29tcG9uZW50LCByZWdpc3RlclZlcnNpb24sIGdldEFwcCB9IGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuaW1wb3J0IHsgTG9nZ2VyLCBMb2dMZXZlbCB9IGZyb20gJ0BmaXJlYmFzZS9sb2dnZXInO1xuaW1wb3J0IHsgX19yZXN0IH0gZnJvbSAndHNsaWInO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBbiBlbnVtIG9mIGZhY3RvcnMgdGhhdCBtYXkgYmUgdXNlZCBmb3IgbXVsdGlmYWN0b3IgYXV0aGVudGljYXRpb24uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IEZhY3RvcklkID0ge1xyXG4gICAgLyoqIFBob25lIGFzIHNlY29uZCBmYWN0b3IgKi9cclxuICAgIFBIT05FOiAncGhvbmUnXHJcbn07XHJcbi8qKlxyXG4gKiBFbnVtZXJhdGlvbiBvZiBzdXBwb3J0ZWQgcHJvdmlkZXJzLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBQcm92aWRlcklkID0ge1xyXG4gICAgLyoqIEZhY2Vib29rIHByb3ZpZGVyIElEICovXHJcbiAgICBGQUNFQk9PSzogJ2ZhY2Vib29rLmNvbScsXHJcbiAgICAvKiogR2l0SHViIHByb3ZpZGVyIElEICovXHJcbiAgICBHSVRIVUI6ICdnaXRodWIuY29tJyxcclxuICAgIC8qKiBHb29nbGUgcHJvdmlkZXIgSUQgKi9cclxuICAgIEdPT0dMRTogJ2dvb2dsZS5jb20nLFxyXG4gICAgLyoqIFBhc3N3b3JkIHByb3ZpZGVyICovXHJcbiAgICBQQVNTV09SRDogJ3Bhc3N3b3JkJyxcclxuICAgIC8qKiBQaG9uZSBwcm92aWRlciAqL1xyXG4gICAgUEhPTkU6ICdwaG9uZScsXHJcbiAgICAvKiogVHdpdHRlciBwcm92aWRlciBJRCAqL1xyXG4gICAgVFdJVFRFUjogJ3R3aXR0ZXIuY29tJ1xyXG59O1xyXG4vKipcclxuICogRW51bWVyYXRpb24gb2Ygc3VwcG9ydGVkIHNpZ24taW4gbWV0aG9kcy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgU2lnbkluTWV0aG9kID0ge1xyXG4gICAgLyoqIEVtYWlsIGxpbmsgc2lnbiBpbiBtZXRob2QgKi9cclxuICAgIEVNQUlMX0xJTks6ICdlbWFpbExpbmsnLFxyXG4gICAgLyoqIEVtYWlsL3Bhc3N3b3JkIHNpZ24gaW4gbWV0aG9kICovXHJcbiAgICBFTUFJTF9QQVNTV09SRDogJ3Bhc3N3b3JkJyxcclxuICAgIC8qKiBGYWNlYm9vayBzaWduIGluIG1ldGhvZCAqL1xyXG4gICAgRkFDRUJPT0s6ICdmYWNlYm9vay5jb20nLFxyXG4gICAgLyoqIEdpdEh1YiBzaWduIGluIG1ldGhvZCAqL1xyXG4gICAgR0lUSFVCOiAnZ2l0aHViLmNvbScsXHJcbiAgICAvKiogR29vZ2xlIHNpZ24gaW4gbWV0aG9kICovXHJcbiAgICBHT09HTEU6ICdnb29nbGUuY29tJyxcclxuICAgIC8qKiBQaG9uZSBzaWduIGluIG1ldGhvZCAqL1xyXG4gICAgUEhPTkU6ICdwaG9uZScsXHJcbiAgICAvKiogVHdpdHRlciBzaWduIGluIG1ldGhvZCAqL1xyXG4gICAgVFdJVFRFUjogJ3R3aXR0ZXIuY29tJ1xyXG59O1xyXG4vKipcclxuICogRW51bWVyYXRpb24gb2Ygc3VwcG9ydGVkIG9wZXJhdGlvbiB0eXBlcy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgT3BlcmF0aW9uVHlwZSA9IHtcclxuICAgIC8qKiBPcGVyYXRpb24gaW52b2x2aW5nIGxpbmtpbmcgYW4gYWRkaXRpb25hbCBwcm92aWRlciB0byBhbiBhbHJlYWR5IHNpZ25lZC1pbiB1c2VyLiAqL1xyXG4gICAgTElOSzogJ2xpbmsnLFxyXG4gICAgLyoqIE9wZXJhdGlvbiBpbnZvbHZpbmcgdXNpbmcgYSBwcm92aWRlciB0byByZWF1dGhlbnRpY2F0ZSBhbiBhbHJlYWR5IHNpZ25lZC1pbiB1c2VyLiAqL1xyXG4gICAgUkVBVVRIRU5USUNBVEU6ICdyZWF1dGhlbnRpY2F0ZScsXHJcbiAgICAvKiogT3BlcmF0aW9uIGludm9sdmluZyBzaWduaW5nIGluIGEgdXNlci4gKi9cclxuICAgIFNJR05fSU46ICdzaWduSW4nXHJcbn07XHJcbi8qKlxyXG4gKiBBbiBlbnVtZXJhdGlvbiBvZiB0aGUgcG9zc2libGUgZW1haWwgYWN0aW9uIHR5cGVzLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBBY3Rpb25Db2RlT3BlcmF0aW9uID0ge1xyXG4gICAgLyoqIFRoZSBlbWFpbCBsaW5rIHNpZ24taW4gYWN0aW9uLiAqL1xyXG4gICAgRU1BSUxfU0lHTklOOiAnRU1BSUxfU0lHTklOJyxcclxuICAgIC8qKiBUaGUgcGFzc3dvcmQgcmVzZXQgYWN0aW9uLiAqL1xyXG4gICAgUEFTU1dPUkRfUkVTRVQ6ICdQQVNTV09SRF9SRVNFVCcsXHJcbiAgICAvKiogVGhlIGVtYWlsIHJldm9jYXRpb24gYWN0aW9uLiAqL1xyXG4gICAgUkVDT1ZFUl9FTUFJTDogJ1JFQ09WRVJfRU1BSUwnLFxyXG4gICAgLyoqIFRoZSByZXZlcnQgc2Vjb25kIGZhY3RvciBhZGRpdGlvbiBlbWFpbCBhY3Rpb24uICovXHJcbiAgICBSRVZFUlRfU0VDT05EX0ZBQ1RPUl9BRERJVElPTjogJ1JFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OJyxcclxuICAgIC8qKiBUaGUgcmV2ZXJ0IHNlY29uZCBmYWN0b3IgYWRkaXRpb24gZW1haWwgYWN0aW9uLiAqL1xyXG4gICAgVkVSSUZZX0FORF9DSEFOR0VfRU1BSUw6ICdWRVJJRllfQU5EX0NIQU5HRV9FTUFJTCcsXHJcbiAgICAvKiogVGhlIGVtYWlsIHZlcmlmaWNhdGlvbiBhY3Rpb24uICovXHJcbiAgICBWRVJJRllfRU1BSUw6ICdWRVJJRllfRU1BSUwnXHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIF9kZWJ1Z0Vycm9yTWFwKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBbXCJhZG1pbi1yZXN0cmljdGVkLW9wZXJhdGlvblwiIC8qIEF1dGhFcnJvckNvZGUuQURNSU5fT05MWV9PUEVSQVRJT04gKi9dOiAnVGhpcyBvcGVyYXRpb24gaXMgcmVzdHJpY3RlZCB0byBhZG1pbmlzdHJhdG9ycyBvbmx5LicsXHJcbiAgICAgICAgW1wiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovXTogJycsXHJcbiAgICAgICAgW1wiYXBwLW5vdC1hdXRob3JpemVkXCIgLyogQXV0aEVycm9yQ29kZS5BUFBfTk9UX0FVVEhPUklaRUQgKi9dOiBcIlRoaXMgYXBwLCBpZGVudGlmaWVkIGJ5IHRoZSBkb21haW4gd2hlcmUgaXQncyBob3N0ZWQsIGlzIG5vdCBcIiArXHJcbiAgICAgICAgICAgICdhdXRob3JpemVkIHRvIHVzZSBGaXJlYmFzZSBBdXRoZW50aWNhdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBBUEkga2V5LiAnICtcclxuICAgICAgICAgICAgJ1JldmlldyB5b3VyIGtleSBjb25maWd1cmF0aW9uIGluIHRoZSBHb29nbGUgQVBJIGNvbnNvbGUuJyxcclxuICAgICAgICBbXCJhcHAtbm90LWluc3RhbGxlZFwiIC8qIEF1dGhFcnJvckNvZGUuQVBQX05PVF9JTlNUQUxMRUQgKi9dOiAnVGhlIHJlcXVlc3RlZCBtb2JpbGUgYXBwbGljYXRpb24gY29ycmVzcG9uZGluZyB0byB0aGUgaWRlbnRpZmllciAoJyArXHJcbiAgICAgICAgICAgICdBbmRyb2lkIHBhY2thZ2UgbmFtZSBvciBpT1MgYnVuZGxlIElEKSBwcm92aWRlZCBpcyBub3QgaW5zdGFsbGVkIG9uICcgK1xyXG4gICAgICAgICAgICAndGhpcyBkZXZpY2UuJyxcclxuICAgICAgICBbXCJjYXB0Y2hhLWNoZWNrLWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuQ0FQVENIQV9DSEVDS19GQUlMRUQgKi9dOiAnVGhlIHJlQ0FQVENIQSByZXNwb25zZSB0b2tlbiBwcm92aWRlZCBpcyBlaXRoZXIgaW52YWxpZCwgZXhwaXJlZCwgJyArXHJcbiAgICAgICAgICAgICdhbHJlYWR5IHVzZWQgb3IgdGhlIGRvbWFpbiBhc3NvY2lhdGVkIHdpdGggaXQgZG9lcyBub3QgbWF0Y2ggdGhlIGxpc3QgJyArXHJcbiAgICAgICAgICAgICdvZiB3aGl0ZWxpc3RlZCBkb21haW5zLicsXHJcbiAgICAgICAgW1wiY29kZS1leHBpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5DT0RFX0VYUElSRUQgKi9dOiAnVGhlIFNNUyBjb2RlIGhhcyBleHBpcmVkLiBQbGVhc2UgcmUtc2VuZCB0aGUgdmVyaWZpY2F0aW9uIGNvZGUgdG8gdHJ5ICcgK1xyXG4gICAgICAgICAgICAnYWdhaW4uJyxcclxuICAgICAgICBbXCJjb3Jkb3ZhLW5vdC1yZWFkeVwiIC8qIEF1dGhFcnJvckNvZGUuQ09SRE9WQV9OT1RfUkVBRFkgKi9dOiAnQ29yZG92YSBmcmFtZXdvcmsgaXMgbm90IHJlYWR5LicsXHJcbiAgICAgICAgW1wiY29ycy11bnN1cHBvcnRlZFwiIC8qIEF1dGhFcnJvckNvZGUuQ09SU19VTlNVUFBPUlRFRCAqL106ICdUaGlzIGJyb3dzZXIgaXMgbm90IHN1cHBvcnRlZC4nLFxyXG4gICAgICAgIFtcImNyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfQUxSRUFEWV9JTl9VU0UgKi9dOiAnVGhpcyBjcmVkZW50aWFsIGlzIGFscmVhZHkgYXNzb2NpYXRlZCB3aXRoIGEgZGlmZmVyZW50IHVzZXIgYWNjb3VudC4nLFxyXG4gICAgICAgIFtcImN1c3RvbS10b2tlbi1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9NSVNNQVRDSCAqL106ICdUaGUgY3VzdG9tIHRva2VuIGNvcnJlc3BvbmRzIHRvIGEgZGlmZmVyZW50IGF1ZGllbmNlLicsXHJcbiAgICAgICAgW1wicmVxdWlyZXMtcmVjZW50LWxvZ2luXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU4gKi9dOiAnVGhpcyBvcGVyYXRpb24gaXMgc2Vuc2l0aXZlIGFuZCByZXF1aXJlcyByZWNlbnQgYXV0aGVudGljYXRpb24uIExvZyBpbiAnICtcclxuICAgICAgICAgICAgJ2FnYWluIGJlZm9yZSByZXRyeWluZyB0aGlzIHJlcXVlc3QuJyxcclxuICAgICAgICBbXCJkZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoXCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi9dOiAnQW5vdGhlciBGaXJlYmFzZSBTREsgd2FzIGluaXRpYWxpemVkIGFuZCBpcyB0cnlpbmcgdG8gdXNlIEF1dGggYmVmb3JlIEF1dGggaXMgJyArXHJcbiAgICAgICAgICAgICdpbml0aWFsaXplZC4gUGxlYXNlIGJlIHN1cmUgdG8gY2FsbCBgaW5pdGlhbGl6ZUF1dGhgIG9yIGBnZXRBdXRoYCBiZWZvcmUgJyArXHJcbiAgICAgICAgICAgICdzdGFydGluZyBhbnkgb3RoZXIgRmlyZWJhc2UgU0RLLicsXHJcbiAgICAgICAgW1wiZHluYW1pYy1saW5rLW5vdC1hY3RpdmF0ZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkRZTkFNSUNfTElOS19OT1RfQUNUSVZBVEVEICovXTogJ1BsZWFzZSBhY3RpdmF0ZSBEeW5hbWljIExpbmtzIGluIHRoZSBGaXJlYmFzZSBDb25zb2xlIGFuZCBhZ3JlZSB0byB0aGUgdGVybXMgYW5kICcgK1xyXG4gICAgICAgICAgICAnY29uZGl0aW9ucy4nLFxyXG4gICAgICAgIFtcImVtYWlsLWNoYW5nZS1uZWVkcy12ZXJpZmljYXRpb25cIiAvKiBBdXRoRXJyb3JDb2RlLkVNQUlMX0NIQU5HRV9ORUVEU19WRVJJRklDQVRJT04gKi9dOiAnTXVsdGktZmFjdG9yIHVzZXJzIG11c3QgYWx3YXlzIGhhdmUgYSB2ZXJpZmllZCBlbWFpbC4nLFxyXG4gICAgICAgIFtcImVtYWlsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9FWElTVFMgKi9dOiAnVGhlIGVtYWlsIGFkZHJlc3MgaXMgYWxyZWFkeSBpbiB1c2UgYnkgYW5vdGhlciBhY2NvdW50LicsXHJcbiAgICAgICAgW1wiZW11bGF0b3ItY29uZmlnLWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuRU1VTEFUT1JfQ09ORklHX0ZBSUxFRCAqL106ICdBdXRoIGluc3RhbmNlIGhhcyBhbHJlYWR5IGJlZW4gdXNlZCB0byBtYWtlIGEgbmV0d29yayBjYWxsLiBBdXRoIGNhbiAnICtcclxuICAgICAgICAgICAgJ25vIGxvbmdlciBiZSBjb25maWd1cmVkIHRvIHVzZSB0aGUgZW11bGF0b3IuIFRyeSBjYWxsaW5nICcgK1xyXG4gICAgICAgICAgICAnXCJjb25uZWN0QXV0aEVtdWxhdG9yKClcIiBzb29uZXIuJyxcclxuICAgICAgICBbXCJleHBpcmVkLWFjdGlvbi1jb2RlXCIgLyogQXV0aEVycm9yQ29kZS5FWFBJUkVEX09PQl9DT0RFICovXTogJ1RoZSBhY3Rpb24gY29kZSBoYXMgZXhwaXJlZC4nLFxyXG4gICAgICAgIFtcImNhbmNlbGxlZC1wb3B1cC1yZXF1ZXN0XCIgLyogQXV0aEVycm9yQ29kZS5FWFBJUkVEX1BPUFVQX1JFUVVFU1QgKi9dOiAnVGhpcyBvcGVyYXRpb24gaGFzIGJlZW4gY2FuY2VsbGVkIGR1ZSB0byBhbm90aGVyIGNvbmZsaWN0aW5nIHBvcHVwIGJlaW5nIG9wZW5lZC4nLFxyXG4gICAgICAgIFtcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqL106ICdBbiBpbnRlcm5hbCBBdXRoRXJyb3IgaGFzIG9jY3VycmVkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1hcHAtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUFBfQ1JFREVOVElBTCAqL106ICdUaGUgcGhvbmUgdmVyaWZpY2F0aW9uIHJlcXVlc3QgY29udGFpbnMgYW4gaW52YWxpZCBhcHBsaWNhdGlvbiB2ZXJpZmllci4nICtcclxuICAgICAgICAgICAgJyBUaGUgcmVDQVBUQ0hBIHRva2VuIHJlc3BvbnNlIGlzIGVpdGhlciBpbnZhbGlkIG9yIGV4cGlyZWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWFwcC1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUFBfSUQgKi9dOiAnVGhlIG1vYmlsZSBhcHAgaWRlbnRpZmllciBpcyBub3QgcmVnaXN0ZWQgZm9yIHRoZSBjdXJyZW50IHByb2plY3QuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXVzZXItdG9rZW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSCAqL106IFwiVGhpcyB1c2VyJ3MgY3JlZGVudGlhbCBpc24ndCB2YWxpZCBmb3IgdGhpcyBwcm9qZWN0LiBUaGlzIGNhbiBoYXBwZW4gXCIgK1xyXG4gICAgICAgICAgICBcImlmIHRoZSB1c2VyJ3MgdG9rZW4gaGFzIGJlZW4gdGFtcGVyZWQgd2l0aCwgb3IgaWYgdGhlIHVzZXIgaXNuJ3QgZm9yIFwiICtcclxuICAgICAgICAgICAgJ3RoZSBwcm9qZWN0IGFzc29jaWF0ZWQgd2l0aCB0aGlzIEFQSSBrZXkuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWF1dGgtZXZlbnRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSF9FVkVOVCAqL106ICdBbiBpbnRlcm5hbCBBdXRoRXJyb3IgaGFzIG9jY3VycmVkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC12ZXJpZmljYXRpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT0RFICovXTogJ1RoZSBTTVMgdmVyaWZpY2F0aW9uIGNvZGUgdXNlZCB0byBjcmVhdGUgdGhlIHBob25lIGF1dGggY3JlZGVudGlhbCBpcyAnICtcclxuICAgICAgICAgICAgJ2ludmFsaWQuIFBsZWFzZSByZXNlbmQgdGhlIHZlcmlmaWNhdGlvbiBjb2RlIHNtcyBhbmQgYmUgc3VyZSB0byB1c2UgdGhlICcgK1xyXG4gICAgICAgICAgICAndmVyaWZpY2F0aW9uIGNvZGUgcHJvdmlkZWQgYnkgdGhlIHVzZXIuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT05USU5VRV9VUkkgKi9dOiAnVGhlIGNvbnRpbnVlIFVSTCBwcm92aWRlZCBpbiB0aGUgcmVxdWVzdCBpcyBpbnZhbGlkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1jb3Jkb3ZhLWNvbmZpZ3VyYXRpb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ09SRE9WQV9DT05GSUdVUkFUSU9OICovXTogJ1RoZSBmb2xsb3dpbmcgQ29yZG92YSBwbHVnaW5zIG11c3QgYmUgaW5zdGFsbGVkIHRvIGVuYWJsZSBPQXV0aCBzaWduLWluOiAnICtcclxuICAgICAgICAgICAgJ2NvcmRvdmEtcGx1Z2luLWJ1aWxkaW5mbywgY29yZG92YS11bml2ZXJzYWwtbGlua3MtcGx1Z2luLCAnICtcclxuICAgICAgICAgICAgJ2NvcmRvdmEtcGx1Z2luLWJyb3dzZXJ0YWIsIGNvcmRvdmEtcGx1Z2luLWluYXBwYnJvd3NlciBhbmQgJyArXHJcbiAgICAgICAgICAgICdjb3Jkb3ZhLXBsdWdpbi1jdXN0b211cmxzY2hlbWUuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWN1c3RvbS10b2tlblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DVVNUT01fVE9LRU4gKi9dOiAnVGhlIGN1c3RvbSB0b2tlbiBmb3JtYXQgaXMgaW5jb3JyZWN0LiBQbGVhc2UgY2hlY2sgdGhlIGRvY3VtZW50YXRpb24uJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWR5bmFtaWMtbGluay1kb21haW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRFlOQU1JQ19MSU5LX0RPTUFJTiAqL106ICdUaGUgcHJvdmlkZWQgZHluYW1pYyBsaW5rIGRvbWFpbiBpcyBub3QgY29uZmlndXJlZCBvciBhdXRob3JpemVkIGZvciB0aGUgY3VycmVudCBwcm9qZWN0LicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1lbWFpbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9FTUFJTCAqL106ICdUaGUgZW1haWwgYWRkcmVzcyBpcyBiYWRseSBmb3JtYXR0ZWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWVtdWxhdG9yLXNjaGVtZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9FTVVMQVRPUl9TQ0hFTUUgKi9dOiAnRW11bGF0b3IgVVJMIG11c3Qgc3RhcnQgd2l0aCBhIHZhbGlkIHNjaGVtZSAoaHR0cDovLyBvciBodHRwczovLykuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWFwaS1rZXlcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVBJX0tFWSAqL106ICdZb3VyIEFQSSBrZXkgaXMgaW52YWxpZCwgcGxlYXNlIGNoZWNrIHlvdSBoYXZlIGNvcGllZCBpdCBjb3JyZWN0bHkuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLWNlcnQtaGFzaFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DRVJUX0hBU0ggKi9dOiAnVGhlIFNIQS0xIGNlcnRpZmljYXRlIGhhc2ggcHJvdmlkZWQgaXMgaW52YWxpZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi9dOiAnVGhlIHN1cHBsaWVkIGF1dGggY3JlZGVudGlhbCBpcyBtYWxmb3JtZWQgb3IgaGFzIGV4cGlyZWQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLW1lc3NhZ2UtcGF5bG9hZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9NRVNTQUdFX1BBWUxPQUQgKi9dOiAnVGhlIGVtYWlsIHRlbXBsYXRlIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBhY3Rpb24gY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzIGluIGl0cyBtZXNzYWdlLiAnICtcclxuICAgICAgICAgICAgJ1BsZWFzZSBmaXggYnkgZ29pbmcgdG8gdGhlIEF1dGggZW1haWwgdGVtcGxhdGVzIHNlY3Rpb24gaW4gdGhlIEZpcmViYXNlIENvbnNvbGUuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLW11bHRpLWZhY3Rvci1zZXNzaW9uXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX01GQV9TRVNTSU9OICovXTogJ1RoZSByZXF1ZXN0IGRvZXMgbm90IGNvbnRhaW4gYSB2YWxpZCBwcm9vZiBvZiBmaXJzdCBmYWN0b3Igc3VjY2Vzc2Z1bCBzaWduLWluLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1vYXV0aC1wcm92aWRlclwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PQVVUSF9QUk9WSURFUiAqL106ICdFbWFpbEF1dGhQcm92aWRlciBpcyBub3Qgc3VwcG9ydGVkIGZvciB0aGlzIG9wZXJhdGlvbi4gVGhpcyBvcGVyYXRpb24gJyArXHJcbiAgICAgICAgICAgICdvbmx5IHN1cHBvcnRzIE9BdXRoIHByb3ZpZGVycy4nLFxyXG4gICAgICAgIFtcImludmFsaWQtb2F1dGgtY2xpZW50LWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX09BVVRIX0NMSUVOVF9JRCAqL106ICdUaGUgT0F1dGggY2xpZW50IElEIHByb3ZpZGVkIGlzIGVpdGhlciBpbnZhbGlkIG9yIGRvZXMgbm90IG1hdGNoIHRoZSAnICtcclxuICAgICAgICAgICAgJ3NwZWNpZmllZCBBUEkga2V5LicsXHJcbiAgICAgICAgW1widW5hdXRob3JpemVkLWRvbWFpblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PUklHSU4gKi9dOiAnVGhpcyBkb21haW4gaXMgbm90IGF1dGhvcml6ZWQgZm9yIE9BdXRoIG9wZXJhdGlvbnMgZm9yIHlvdXIgRmlyZWJhc2UgJyArXHJcbiAgICAgICAgICAgICdwcm9qZWN0LiBFZGl0IHRoZSBsaXN0IG9mIGF1dGhvcml6ZWQgZG9tYWlucyBmcm9tIHRoZSBGaXJlYmFzZSBjb25zb2xlLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1hY3Rpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PT0JfQ09ERSAqL106ICdUaGUgYWN0aW9uIGNvZGUgaXMgaW52YWxpZC4gVGhpcyBjYW4gaGFwcGVuIGlmIHRoZSBjb2RlIGlzIG1hbGZvcm1lZCwgJyArXHJcbiAgICAgICAgICAgICdleHBpcmVkLCBvciBoYXMgYWxyZWFkeSBiZWVuIHVzZWQuJyxcclxuICAgICAgICBbXCJ3cm9uZy1wYXNzd29yZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9QQVNTV09SRCAqL106ICdUaGUgcGFzc3dvcmQgaXMgaW52YWxpZCBvciB0aGUgdXNlciBkb2VzIG5vdCBoYXZlIGEgcGFzc3dvcmQuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXBlcnNpc3RlbmNlLXR5cGVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEVSU0lTVEVOQ0UgKi9dOiAnVGhlIHNwZWNpZmllZCBwZXJzaXN0ZW5jZSB0eXBlIGlzIGludmFsaWQuIEl0IGNhbiBvbmx5IGJlIGxvY2FsLCBzZXNzaW9uIG9yIG5vbmUuJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXBob25lLW51bWJlclwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9QSE9ORV9OVU1CRVIgKi9dOiAnVGhlIGZvcm1hdCBvZiB0aGUgcGhvbmUgbnVtYmVyIHByb3ZpZGVkIGlzIGluY29ycmVjdC4gUGxlYXNlIGVudGVyIHRoZSAnICtcclxuICAgICAgICAgICAgJ3Bob25lIG51bWJlciBpbiBhIGZvcm1hdCB0aGF0IGNhbiBiZSBwYXJzZWQgaW50byBFLjE2NCBmb3JtYXQuIEUuMTY0ICcgK1xyXG4gICAgICAgICAgICAncGhvbmUgbnVtYmVycyBhcmUgd3JpdHRlbiBpbiB0aGUgZm9ybWF0IFsrXVtjb3VudHJ5IGNvZGVdW3N1YnNjcmliZXIgJyArXHJcbiAgICAgICAgICAgICdudW1iZXIgaW5jbHVkaW5nIGFyZWEgY29kZV0uJyxcclxuICAgICAgICBbXCJpbnZhbGlkLXByb3ZpZGVyLWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1BST1ZJREVSX0lEICovXTogJ1RoZSBzcGVjaWZpZWQgcHJvdmlkZXIgSUQgaXMgaW52YWxpZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtcmVjaXBpZW50LWVtYWlsXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0lQSUVOVF9FTUFJTCAqL106ICdUaGUgZW1haWwgY29ycmVzcG9uZGluZyB0byB0aGlzIGFjdGlvbiBmYWlsZWQgdG8gc2VuZCBhcyB0aGUgcHJvdmlkZWQgJyArXHJcbiAgICAgICAgICAgICdyZWNpcGllbnQgZW1haWwgYWRkcmVzcyBpcyBpbnZhbGlkLicsXHJcbiAgICAgICAgW1wiaW52YWxpZC1zZW5kZXJcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfU0VOREVSICovXTogJ1RoZSBlbWFpbCB0ZW1wbGF0ZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgYWN0aW9uIGNvbnRhaW5zIGFuIGludmFsaWQgc2VuZGVyIGVtYWlsIG9yIG5hbWUuICcgK1xyXG4gICAgICAgICAgICAnUGxlYXNlIGZpeCBieSBnb2luZyB0byB0aGUgQXV0aCBlbWFpbCB0ZW1wbGF0ZXMgc2VjdGlvbiBpbiB0aGUgRmlyZWJhc2UgQ29uc29sZS4nLFxyXG4gICAgICAgIFtcImludmFsaWQtdmVyaWZpY2F0aW9uLWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1NFU1NJT05fSU5GTyAqL106ICdUaGUgdmVyaWZpY2F0aW9uIElEIHVzZWQgdG8gY3JlYXRlIHRoZSBwaG9uZSBhdXRoIGNyZWRlbnRpYWwgaXMgaW52YWxpZC4nLFxyXG4gICAgICAgIFtcImludmFsaWQtdGVuYW50LWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1RFTkFOVF9JRCAqL106IFwiVGhlIEF1dGggaW5zdGFuY2UncyB0ZW5hbnQgSUQgaXMgaW52YWxpZC5cIixcclxuICAgICAgICBbXCJsb2dpbi1ibG9ja2VkXCIgLyogQXV0aEVycm9yQ29kZS5MT0dJTl9CTE9DS0VEICovXTogJ0xvZ2luIGJsb2NrZWQgYnkgdXNlci1wcm92aWRlZCBtZXRob2Q6IHskb3JpZ2luYWxNZXNzYWdlfScsXHJcbiAgICAgICAgW1wibWlzc2luZy1hbmRyb2lkLXBrZy1uYW1lXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FICovXTogJ0FuIEFuZHJvaWQgUGFja2FnZSBOYW1lIG11c3QgYmUgcHJvdmlkZWQgaWYgdGhlIEFuZHJvaWQgQXBwIGlzIHJlcXVpcmVkIHRvIGJlIGluc3RhbGxlZC4nLFxyXG4gICAgICAgIFtcImF1dGgtZG9tYWluLWNvbmZpZy1yZXF1aXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BVVRIX0RPTUFJTiAqL106ICdCZSBzdXJlIHRvIGluY2x1ZGUgYXV0aERvbWFpbiB3aGVuIGNhbGxpbmcgZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcCgpLCAnICtcclxuICAgICAgICAgICAgJ2J5IGZvbGxvd2luZyB0aGUgaW5zdHJ1Y3Rpb25zIGluIHRoZSBGaXJlYmFzZSBjb25zb2xlLicsXHJcbiAgICAgICAgW1wibWlzc2luZy1hcHAtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BUFBfQ1JFREVOVElBTCAqL106ICdUaGUgcGhvbmUgdmVyaWZpY2F0aW9uIHJlcXVlc3QgaXMgbWlzc2luZyBhbiBhcHBsaWNhdGlvbiB2ZXJpZmllciAnICtcclxuICAgICAgICAgICAgJ2Fzc2VydGlvbi4gQSByZUNBUFRDSEEgcmVzcG9uc2UgdG9rZW4gbmVlZHMgdG8gYmUgcHJvdmlkZWQuJyxcclxuICAgICAgICBbXCJtaXNzaW5nLXZlcmlmaWNhdGlvbi1jb2RlXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0NPREUgKi9dOiAnVGhlIHBob25lIGF1dGggY3JlZGVudGlhbCB3YXMgY3JlYXRlZCB3aXRoIGFuIGVtcHR5IFNNUyB2ZXJpZmljYXRpb24gY29kZS4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctY29udGludWUtdXJpXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0NPTlRJTlVFX1VSSSAqL106ICdBIGNvbnRpbnVlIFVSTCBtdXN0IGJlIHByb3ZpZGVkIGluIHRoZSByZXF1ZXN0LicsXHJcbiAgICAgICAgW1wibWlzc2luZy1pZnJhbWUtc3RhcnRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfSUZSQU1FX1NUQVJUICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcclxuICAgICAgICBbXCJtaXNzaW5nLWlvcy1idW5kbGUtaWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfSU9TX0JVTkRMRV9JRCAqL106ICdBbiBpT1MgQnVuZGxlIElEIG11c3QgYmUgcHJvdmlkZWQgaWYgYW4gQXBwIFN0b3JlIElEIGlzIHByb3ZpZGVkLicsXHJcbiAgICAgICAgW1wibWlzc2luZy1vci1pbnZhbGlkLW5vbmNlXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX09SX0lOVkFMSURfTk9OQ0UgKi9dOiAnVGhlIHJlcXVlc3QgZG9lcyBub3QgY29udGFpbiBhIHZhbGlkIG5vbmNlLiBUaGlzIGNhbiBvY2N1ciBpZiB0aGUgJyArXHJcbiAgICAgICAgICAgICdTSEEtMjU2IGhhc2ggb2YgdGhlIHByb3ZpZGVkIHJhdyBub25jZSBkb2VzIG5vdCBtYXRjaCB0aGUgaGFzaGVkIG5vbmNlICcgK1xyXG4gICAgICAgICAgICAnaW4gdGhlIElEIHRva2VuIHBheWxvYWQuJyxcclxuICAgICAgICBbXCJtaXNzaW5nLW11bHRpLWZhY3Rvci1pbmZvXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX01GQV9JTkZPICovXTogJ05vIHNlY29uZCBmYWN0b3IgaWRlbnRpZmllciBpcyBwcm92aWRlZC4nLFxyXG4gICAgICAgIFtcIm1pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX1NFU1NJT04gKi9dOiAnVGhlIHJlcXVlc3QgaXMgbWlzc2luZyBwcm9vZiBvZiBmaXJzdCBmYWN0b3Igc3VjY2Vzc2Z1bCBzaWduLWluLicsXHJcbiAgICAgICAgW1wibWlzc2luZy1waG9uZS1udW1iZXJcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUEhPTkVfTlVNQkVSICovXTogJ1RvIHNlbmQgdmVyaWZpY2F0aW9uIGNvZGVzLCBwcm92aWRlIGEgcGhvbmUgbnVtYmVyIGZvciB0aGUgcmVjaXBpZW50LicsXHJcbiAgICAgICAgW1wibWlzc2luZy12ZXJpZmljYXRpb24taWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfU0VTU0lPTl9JTkZPICovXTogJ1RoZSBwaG9uZSBhdXRoIGNyZWRlbnRpYWwgd2FzIGNyZWF0ZWQgd2l0aCBhbiBlbXB0eSB2ZXJpZmljYXRpb24gSUQuJyxcclxuICAgICAgICBbXCJhcHAtZGVsZXRlZFwiIC8qIEF1dGhFcnJvckNvZGUuTU9EVUxFX0RFU1RST1lFRCAqL106ICdUaGlzIGluc3RhbmNlIG9mIEZpcmViYXNlQXBwIGhhcyBiZWVuIGRlbGV0ZWQuJyxcclxuICAgICAgICBbXCJtdWx0aS1mYWN0b3ItaW5mby1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9JTkZPX05PVF9GT1VORCAqL106ICdUaGUgdXNlciBkb2VzIG5vdCBoYXZlIGEgc2Vjb25kIGZhY3RvciBtYXRjaGluZyB0aGUgaWRlbnRpZmllciBwcm92aWRlZC4nLFxyXG4gICAgICAgIFtcIm11bHRpLWZhY3Rvci1hdXRoLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NRkFfUkVRVUlSRUQgKi9dOiAnUHJvb2Ygb2Ygb3duZXJzaGlwIG9mIGEgc2Vjb25kIGZhY3RvciBpcyByZXF1aXJlZCB0byBjb21wbGV0ZSBzaWduLWluLicsXHJcbiAgICAgICAgW1wiYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuTkVFRF9DT05GSVJNQVRJT04gKi9dOiAnQW4gYWNjb3VudCBhbHJlYWR5IGV4aXN0cyB3aXRoIHRoZSBzYW1lIGVtYWlsIGFkZHJlc3MgYnV0IGRpZmZlcmVudCAnICtcclxuICAgICAgICAgICAgJ3NpZ24taW4gY3JlZGVudGlhbHMuIFNpZ24gaW4gdXNpbmcgYSBwcm92aWRlciBhc3NvY2lhdGVkIHdpdGggdGhpcyAnICtcclxuICAgICAgICAgICAgJ2VtYWlsIGFkZHJlc3MuJyxcclxuICAgICAgICBbXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovXTogJ0EgbmV0d29yayBBdXRoRXJyb3IgKHN1Y2ggYXMgdGltZW91dCwgaW50ZXJydXB0ZWQgY29ubmVjdGlvbiBvciB1bnJlYWNoYWJsZSBob3N0KSBoYXMgb2NjdXJyZWQuJyxcclxuICAgICAgICBbXCJuby1hdXRoLWV2ZW50XCIgLyogQXV0aEVycm9yQ29kZS5OT19BVVRIX0VWRU5UICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcclxuICAgICAgICBbXCJuby1zdWNoLXByb3ZpZGVyXCIgLyogQXV0aEVycm9yQ29kZS5OT19TVUNIX1BST1ZJREVSICovXTogJ1VzZXIgd2FzIG5vdCBsaW5rZWQgdG8gYW4gYWNjb3VudCB3aXRoIHRoZSBnaXZlbiBwcm92aWRlci4nLFxyXG4gICAgICAgIFtcIm51bGwtdXNlclwiIC8qIEF1dGhFcnJvckNvZGUuTlVMTF9VU0VSICovXTogJ0EgbnVsbCB1c2VyIG9iamVjdCB3YXMgcHJvdmlkZWQgYXMgdGhlIGFyZ3VtZW50IGZvciBhbiBvcGVyYXRpb24gd2hpY2ggJyArXHJcbiAgICAgICAgICAgICdyZXF1aXJlcyBhIG5vbi1udWxsIHVzZXIgb2JqZWN0LicsXHJcbiAgICAgICAgW1wib3BlcmF0aW9uLW5vdC1hbGxvd2VkXCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX0FMTE9XRUQgKi9dOiAnVGhlIGdpdmVuIHNpZ24taW4gcHJvdmlkZXIgaXMgZGlzYWJsZWQgZm9yIHRoaXMgRmlyZWJhc2UgcHJvamVjdC4gJyArXHJcbiAgICAgICAgICAgICdFbmFibGUgaXQgaW4gdGhlIEZpcmViYXNlIGNvbnNvbGUsIHVuZGVyIHRoZSBzaWduLWluIG1ldGhvZCB0YWIgb2YgdGhlICcgK1xyXG4gICAgICAgICAgICAnQXV0aCBzZWN0aW9uLicsXHJcbiAgICAgICAgW1wib3BlcmF0aW9uLW5vdC1zdXBwb3J0ZWQtaW4tdGhpcy1lbnZpcm9ubWVudFwiIC8qIEF1dGhFcnJvckNvZGUuT1BFUkFUSU9OX05PVF9TVVBQT1JURUQgKi9dOiAnVGhpcyBvcGVyYXRpb24gaXMgbm90IHN1cHBvcnRlZCBpbiB0aGUgZW52aXJvbm1lbnQgdGhpcyBhcHBsaWNhdGlvbiBpcyAnICtcclxuICAgICAgICAgICAgJ3J1bm5pbmcgb24uIFwibG9jYXRpb24ucHJvdG9jb2xcIiBtdXN0IGJlIGh0dHAsIGh0dHBzIG9yIGNocm9tZS1leHRlbnNpb24nICtcclxuICAgICAgICAgICAgJyBhbmQgd2ViIHN0b3JhZ2UgbXVzdCBiZSBlbmFibGVkLicsXHJcbiAgICAgICAgW1wicG9wdXAtYmxvY2tlZFwiIC8qIEF1dGhFcnJvckNvZGUuUE9QVVBfQkxPQ0tFRCAqL106ICdVbmFibGUgdG8gZXN0YWJsaXNoIGEgY29ubmVjdGlvbiB3aXRoIHRoZSBwb3B1cC4gSXQgbWF5IGhhdmUgYmVlbiBibG9ja2VkIGJ5IHRoZSBicm93c2VyLicsXHJcbiAgICAgICAgW1wicG9wdXAtY2xvc2VkLWJ5LXVzZXJcIiAvKiBBdXRoRXJyb3JDb2RlLlBPUFVQX0NMT1NFRF9CWV9VU0VSICovXTogJ1RoZSBwb3B1cCBoYXMgYmVlbiBjbG9zZWQgYnkgdGhlIHVzZXIgYmVmb3JlIGZpbmFsaXppbmcgdGhlIG9wZXJhdGlvbi4nLFxyXG4gICAgICAgIFtcInByb3ZpZGVyLWFscmVhZHktbGlua2VkXCIgLyogQXV0aEVycm9yQ29kZS5QUk9WSURFUl9BTFJFQURZX0xJTktFRCAqL106ICdVc2VyIGNhbiBvbmx5IGJlIGxpbmtlZCB0byBvbmUgaWRlbnRpdHkgZm9yIHRoZSBnaXZlbiBwcm92aWRlci4nLFxyXG4gICAgICAgIFtcInF1b3RhLWV4Y2VlZGVkXCIgLyogQXV0aEVycm9yQ29kZS5RVU9UQV9FWENFRURFRCAqL106IFwiVGhlIHByb2plY3QncyBxdW90YSBmb3IgdGhpcyBvcGVyYXRpb24gaGFzIGJlZW4gZXhjZWVkZWQuXCIsXHJcbiAgICAgICAgW1wicmVkaXJlY3QtY2FuY2VsbGVkLWJ5LXVzZXJcIiAvKiBBdXRoRXJyb3JDb2RlLlJFRElSRUNUX0NBTkNFTExFRF9CWV9VU0VSICovXTogJ1RoZSByZWRpcmVjdCBvcGVyYXRpb24gaGFzIGJlZW4gY2FuY2VsbGVkIGJ5IHRoZSB1c2VyIGJlZm9yZSBmaW5hbGl6aW5nLicsXHJcbiAgICAgICAgW1wicmVkaXJlY3Qtb3BlcmF0aW9uLXBlbmRpbmdcIiAvKiBBdXRoRXJyb3JDb2RlLlJFRElSRUNUX09QRVJBVElPTl9QRU5ESU5HICovXTogJ0EgcmVkaXJlY3Qgc2lnbi1pbiBvcGVyYXRpb24gaXMgYWxyZWFkeSBwZW5kaW5nLicsXHJcbiAgICAgICAgW1wicmVqZWN0ZWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuUkVKRUNURURfQ1JFREVOVElBTCAqL106ICdUaGUgcmVxdWVzdCBjb250YWlucyBtYWxmb3JtZWQgb3IgbWlzbWF0Y2hpbmcgY3JlZGVudGlhbHMuJyxcclxuICAgICAgICBbXCJzZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQgKi9dOiAnVGhlIHNlY29uZCBmYWN0b3IgaXMgYWxyZWFkeSBlbnJvbGxlZCBvbiB0aGlzIGFjY291bnQuJyxcclxuICAgICAgICBbXCJtYXhpbXVtLXNlY29uZC1mYWN0b3ItY291bnQtZXhjZWVkZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQgKi9dOiAnVGhlIG1heGltdW0gYWxsb3dlZCBudW1iZXIgb2Ygc2Vjb25kIGZhY3RvcnMgb24gYSB1c2VyIGhhcyBiZWVuIGV4Y2VlZGVkLicsXHJcbiAgICAgICAgW1widGVuYW50LWlkLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5URU5BTlRfSURfTUlTTUFUQ0ggKi9dOiBcIlRoZSBwcm92aWRlZCB0ZW5hbnQgSUQgZG9lcyBub3QgbWF0Y2ggdGhlIEF1dGggaW5zdGFuY2UncyB0ZW5hbnQgSURcIixcclxuICAgICAgICBbXCJ0aW1lb3V0XCIgLyogQXV0aEVycm9yQ29kZS5USU1FT1VUICovXTogJ1RoZSBvcGVyYXRpb24gaGFzIHRpbWVkIG91dC4nLFxyXG4gICAgICAgIFtcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqL106IFwiVGhlIHVzZXIncyBjcmVkZW50aWFsIGlzIG5vIGxvbmdlciB2YWxpZC4gVGhlIHVzZXIgbXVzdCBzaWduIGluIGFnYWluLlwiLFxyXG4gICAgICAgIFtcInRvby1tYW55LXJlcXVlc3RzXCIgLyogQXV0aEVycm9yQ29kZS5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi9dOiAnV2UgaGF2ZSBibG9ja2VkIGFsbCByZXF1ZXN0cyBmcm9tIHRoaXMgZGV2aWNlIGR1ZSB0byB1bnVzdWFsIGFjdGl2aXR5LiAnICtcclxuICAgICAgICAgICAgJ1RyeSBhZ2FpbiBsYXRlci4nLFxyXG4gICAgICAgIFtcInVuYXV0aG9yaXplZC1jb250aW51ZS11cmlcIiAvKiBBdXRoRXJyb3JDb2RlLlVOQVVUSE9SSVpFRF9ET01BSU4gKi9dOiAnVGhlIGRvbWFpbiBvZiB0aGUgY29udGludWUgVVJMIGlzIG5vdCB3aGl0ZWxpc3RlZC4gIFBsZWFzZSB3aGl0ZWxpc3QgJyArXHJcbiAgICAgICAgICAgICd0aGUgZG9tYWluIGluIHRoZSBGaXJlYmFzZSBjb25zb2xlLicsXHJcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtZmlyc3QtZmFjdG9yXCIgLyogQXV0aEVycm9yQ29kZS5VTlNVUFBPUlRFRF9GSVJTVF9GQUNUT1IgKi9dOiAnRW5yb2xsaW5nIGEgc2Vjb25kIGZhY3RvciBvciBzaWduaW5nIGluIHdpdGggYSBtdWx0aS1mYWN0b3IgYWNjb3VudCByZXF1aXJlcyBzaWduLWluIHdpdGggYSBzdXBwb3J0ZWQgZmlyc3QgZmFjdG9yLicsXHJcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtcGVyc2lzdGVuY2UtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuVU5TVVBQT1JURURfUEVSU0lTVEVOQ0UgKi9dOiAnVGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc3BlY2lmaWVkIHBlcnNpc3RlbmNlIHR5cGUuJyxcclxuICAgICAgICBbXCJ1bnN1cHBvcnRlZC10ZW5hbnQtb3BlcmF0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5VTlNVUFBPUlRFRF9URU5BTlRfT1BFUkFUSU9OICovXTogJ1RoaXMgb3BlcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYSBtdWx0aS10ZW5hbnQgY29udGV4dC4nLFxyXG4gICAgICAgIFtcInVudmVyaWZpZWQtZW1haWxcIiAvKiBBdXRoRXJyb3JDb2RlLlVOVkVSSUZJRURfRU1BSUwgKi9dOiAnVGhlIG9wZXJhdGlvbiByZXF1aXJlcyBhIHZlcmlmaWVkIGVtYWlsLicsXHJcbiAgICAgICAgW1widXNlci1jYW5jZWxsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfQ0FOQ0VMTEVEICovXTogJ1RoZSB1c2VyIGRpZCBub3QgZ3JhbnQgeW91ciBhcHBsaWNhdGlvbiB0aGUgcGVybWlzc2lvbnMgaXQgcmVxdWVzdGVkLicsXHJcbiAgICAgICAgW1widXNlci1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfREVMRVRFRCAqL106ICdUaGVyZSBpcyBubyB1c2VyIHJlY29yZCBjb3JyZXNwb25kaW5nIHRvIHRoaXMgaWRlbnRpZmllci4gVGhlIHVzZXIgbWF5ICcgK1xyXG4gICAgICAgICAgICAnaGF2ZSBiZWVuIGRlbGV0ZWQuJyxcclxuICAgICAgICBbXCJ1c2VyLWRpc2FibGVkXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovXTogJ1RoZSB1c2VyIGFjY291bnQgaGFzIGJlZW4gZGlzYWJsZWQgYnkgYW4gYWRtaW5pc3RyYXRvci4nLFxyXG4gICAgICAgIFtcInVzZXItbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfTUlTTUFUQ0ggKi9dOiAnVGhlIHN1cHBsaWVkIGNyZWRlbnRpYWxzIGRvIG5vdCBjb3JyZXNwb25kIHRvIHRoZSBwcmV2aW91c2x5IHNpZ25lZCBpbiB1c2VyLicsXHJcbiAgICAgICAgW1widXNlci1zaWduZWQtb3V0XCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX1NJR05FRF9PVVQgKi9dOiAnJyxcclxuICAgICAgICBbXCJ3ZWFrLXBhc3N3b3JkXCIgLyogQXV0aEVycm9yQ29kZS5XRUFLX1BBU1NXT1JEICovXTogJ1RoZSBwYXNzd29yZCBtdXN0IGJlIDYgY2hhcmFjdGVycyBsb25nIG9yIG1vcmUuJyxcclxuICAgICAgICBbXCJ3ZWItc3RvcmFnZS11bnN1cHBvcnRlZFwiIC8qIEF1dGhFcnJvckNvZGUuV0VCX1NUT1JBR0VfVU5TVVBQT1JURUQgKi9dOiAnVGhpcyBicm93c2VyIGlzIG5vdCBzdXBwb3J0ZWQgb3IgM3JkIHBhcnR5IGNvb2tpZXMgYW5kIGRhdGEgbWF5IGJlIGRpc2FibGVkLicsXHJcbiAgICAgICAgW1wiYWxyZWFkeS1pbml0aWFsaXplZFwiIC8qIEF1dGhFcnJvckNvZGUuQUxSRUFEWV9JTklUSUFMSVpFRCAqL106ICdpbml0aWFsaXplQXV0aCgpIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIHdpdGggJyArXHJcbiAgICAgICAgICAgICdkaWZmZXJlbnQgb3B0aW9ucy4gVG8gYXZvaWQgdGhpcyBlcnJvciwgY2FsbCBpbml0aWFsaXplQXV0aCgpIHdpdGggdGhlICcgK1xyXG4gICAgICAgICAgICAnc2FtZSBvcHRpb25zIGFzIHdoZW4gaXQgd2FzIG9yaWdpbmFsbHkgY2FsbGVkLCBvciBjYWxsIGdldEF1dGgoKSB0byByZXR1cm4gdGhlJyArXHJcbiAgICAgICAgICAgICcgYWxyZWFkeSBpbml0aWFsaXplZCBpbnN0YW5jZS4nXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIF9wcm9kRXJyb3JNYXAoKSB7XHJcbiAgICAvLyBXZSB3aWxsIGluY2x1ZGUgdGhpcyBvbmUgbWVzc2FnZSBpbiB0aGUgcHJvZCBlcnJvciBtYXAgc2luY2UgYnkgdGhlIHZlcnlcclxuICAgIC8vIG5hdHVyZSBvZiB0aGlzIGVycm9yLCBkZXZlbG9wZXJzIHdpbGwgbmV2ZXIgYmUgYWJsZSB0byBzZWUgdGhlIG1lc3NhZ2VcclxuICAgIC8vIHVzaW5nIHRoZSBkZWJ1Z0Vycm9yTWFwICh3aGljaCBpcyBpbnN0YWxsZWQgZHVyaW5nIGF1dGggaW5pdGlhbGl6YXRpb24pLlxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBbXCJkZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoXCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi9dOiAnQW5vdGhlciBGaXJlYmFzZSBTREsgd2FzIGluaXRpYWxpemVkIGFuZCBpcyB0cnlpbmcgdG8gdXNlIEF1dGggYmVmb3JlIEF1dGggaXMgJyArXHJcbiAgICAgICAgICAgICdpbml0aWFsaXplZC4gUGxlYXNlIGJlIHN1cmUgdG8gY2FsbCBgaW5pdGlhbGl6ZUF1dGhgIG9yIGBnZXRBdXRoYCBiZWZvcmUgJyArXHJcbiAgICAgICAgICAgICdzdGFydGluZyBhbnkgb3RoZXIgRmlyZWJhc2UgU0RLLidcclxuICAgIH07XHJcbn1cclxuLyoqXHJcbiAqIEEgdmVyYm9zZSBlcnJvciBtYXAgd2l0aCBkZXRhaWxlZCBkZXNjcmlwdGlvbnMgZm9yIG1vc3QgZXJyb3IgY29kZXMuXHJcbiAqXHJcbiAqIFNlZSBkaXNjdXNzaW9uIGF0IHtAbGluayBBdXRoRXJyb3JNYXB9XHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGRlYnVnRXJyb3JNYXAgPSBfZGVidWdFcnJvck1hcDtcclxuLyoqXHJcbiAqIEEgbWluaW1hbCBlcnJvciBtYXAgd2l0aCBhbGwgdmVyYm9zZSBlcnJvciBtZXNzYWdlcyBzdHJpcHBlZC5cclxuICpcclxuICogU2VlIGRpc2N1c3Npb24gYXQge0BsaW5rIEF1dGhFcnJvck1hcH1cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgcHJvZEVycm9yTWFwID0gX3Byb2RFcnJvck1hcDtcclxuY29uc3QgX0RFRkFVTFRfQVVUSF9FUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIF9wcm9kRXJyb3JNYXAoKSk7XHJcbi8qKlxyXG4gKiBBIG1hcCBvZiBwb3RlbnRpYWwgYEF1dGhgIGVycm9yIGNvZGVzLCBmb3IgZWFzaWVyIGNvbXBhcmlzb24gd2l0aCBlcnJvcnNcclxuICogdGhyb3duIGJ5IHRoZSBTREsuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIE5vdGUgdGhhdCB5b3UgY2FuJ3QgdHJlZS1zaGFrZSBpbmRpdmlkdWFsIGtleXNcclxuICogaW4gdGhlIG1hcCwgc28gYnkgdXNpbmcgdGhlIG1hcCB5b3UgbWlnaHQgc3Vic3RhbnRpYWxseSBpbmNyZWFzZSB5b3VyXHJcbiAqIGJ1bmRsZSBzaXplLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jb25zdCBBVVRIX0VSUk9SX0NPREVTX01BUF9ET19OT1RfVVNFX0lOVEVSTkFMTFkgPSB7XHJcbiAgICBBRE1JTl9PTkxZX09QRVJBVElPTjogJ2F1dGgvYWRtaW4tcmVzdHJpY3RlZC1vcGVyYXRpb24nLFxyXG4gICAgQVJHVU1FTlRfRVJST1I6ICdhdXRoL2FyZ3VtZW50LWVycm9yJyxcclxuICAgIEFQUF9OT1RfQVVUSE9SSVpFRDogJ2F1dGgvYXBwLW5vdC1hdXRob3JpemVkJyxcclxuICAgIEFQUF9OT1RfSU5TVEFMTEVEOiAnYXV0aC9hcHAtbm90LWluc3RhbGxlZCcsXHJcbiAgICBDQVBUQ0hBX0NIRUNLX0ZBSUxFRDogJ2F1dGgvY2FwdGNoYS1jaGVjay1mYWlsZWQnLFxyXG4gICAgQ09ERV9FWFBJUkVEOiAnYXV0aC9jb2RlLWV4cGlyZWQnLFxyXG4gICAgQ09SRE9WQV9OT1RfUkVBRFk6ICdhdXRoL2NvcmRvdmEtbm90LXJlYWR5JyxcclxuICAgIENPUlNfVU5TVVBQT1JURUQ6ICdhdXRoL2NvcnMtdW5zdXBwb3J0ZWQnLFxyXG4gICAgQ1JFREVOVElBTF9BTFJFQURZX0lOX1VTRTogJ2F1dGgvY3JlZGVudGlhbC1hbHJlYWR5LWluLXVzZScsXHJcbiAgICBDUkVERU5USUFMX01JU01BVENIOiAnYXV0aC9jdXN0b20tdG9rZW4tbWlzbWF0Y2gnLFxyXG4gICAgQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOOiAnYXV0aC9yZXF1aXJlcy1yZWNlbnQtbG9naW4nLFxyXG4gICAgREVQRU5ERU5UX1NES19JTklUX0JFRk9SRV9BVVRIOiAnYXV0aC9kZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoJyxcclxuICAgIERZTkFNSUNfTElOS19OT1RfQUNUSVZBVEVEOiAnYXV0aC9keW5hbWljLWxpbmstbm90LWFjdGl2YXRlZCcsXHJcbiAgICBFTUFJTF9DSEFOR0VfTkVFRFNfVkVSSUZJQ0FUSU9OOiAnYXV0aC9lbWFpbC1jaGFuZ2UtbmVlZHMtdmVyaWZpY2F0aW9uJyxcclxuICAgIEVNQUlMX0VYSVNUUzogJ2F1dGgvZW1haWwtYWxyZWFkeS1pbi11c2UnLFxyXG4gICAgRU1VTEFUT1JfQ09ORklHX0ZBSUxFRDogJ2F1dGgvZW11bGF0b3ItY29uZmlnLWZhaWxlZCcsXHJcbiAgICBFWFBJUkVEX09PQl9DT0RFOiAnYXV0aC9leHBpcmVkLWFjdGlvbi1jb2RlJyxcclxuICAgIEVYUElSRURfUE9QVVBfUkVRVUVTVDogJ2F1dGgvY2FuY2VsbGVkLXBvcHVwLXJlcXVlc3QnLFxyXG4gICAgSU5URVJOQUxfRVJST1I6ICdhdXRoL2ludGVybmFsLWVycm9yJyxcclxuICAgIElOVkFMSURfQVBJX0tFWTogJ2F1dGgvaW52YWxpZC1hcGkta2V5JyxcclxuICAgIElOVkFMSURfQVBQX0NSRURFTlRJQUw6ICdhdXRoL2ludmFsaWQtYXBwLWNyZWRlbnRpYWwnLFxyXG4gICAgSU5WQUxJRF9BUFBfSUQ6ICdhdXRoL2ludmFsaWQtYXBwLWlkJyxcclxuICAgIElOVkFMSURfQVVUSDogJ2F1dGgvaW52YWxpZC11c2VyLXRva2VuJyxcclxuICAgIElOVkFMSURfQVVUSF9FVkVOVDogJ2F1dGgvaW52YWxpZC1hdXRoLWV2ZW50JyxcclxuICAgIElOVkFMSURfQ0VSVF9IQVNIOiAnYXV0aC9pbnZhbGlkLWNlcnQtaGFzaCcsXHJcbiAgICBJTlZBTElEX0NPREU6ICdhdXRoL2ludmFsaWQtdmVyaWZpY2F0aW9uLWNvZGUnLFxyXG4gICAgSU5WQUxJRF9DT05USU5VRV9VUkk6ICdhdXRoL2ludmFsaWQtY29udGludWUtdXJpJyxcclxuICAgIElOVkFMSURfQ09SRE9WQV9DT05GSUdVUkFUSU9OOiAnYXV0aC9pbnZhbGlkLWNvcmRvdmEtY29uZmlndXJhdGlvbicsXHJcbiAgICBJTlZBTElEX0NVU1RPTV9UT0tFTjogJ2F1dGgvaW52YWxpZC1jdXN0b20tdG9rZW4nLFxyXG4gICAgSU5WQUxJRF9EWU5BTUlDX0xJTktfRE9NQUlOOiAnYXV0aC9pbnZhbGlkLWR5bmFtaWMtbGluay1kb21haW4nLFxyXG4gICAgSU5WQUxJRF9FTUFJTDogJ2F1dGgvaW52YWxpZC1lbWFpbCcsXHJcbiAgICBJTlZBTElEX0VNVUxBVE9SX1NDSEVNRTogJ2F1dGgvaW52YWxpZC1lbXVsYXRvci1zY2hlbWUnLFxyXG4gICAgSU5WQUxJRF9JRFBfUkVTUE9OU0U6ICdhdXRoL2ludmFsaWQtY3JlZGVudGlhbCcsXHJcbiAgICBJTlZBTElEX01FU1NBR0VfUEFZTE9BRDogJ2F1dGgvaW52YWxpZC1tZXNzYWdlLXBheWxvYWQnLFxyXG4gICAgSU5WQUxJRF9NRkFfU0VTU0lPTjogJ2F1dGgvaW52YWxpZC1tdWx0aS1mYWN0b3Itc2Vzc2lvbicsXHJcbiAgICBJTlZBTElEX09BVVRIX0NMSUVOVF9JRDogJ2F1dGgvaW52YWxpZC1vYXV0aC1jbGllbnQtaWQnLFxyXG4gICAgSU5WQUxJRF9PQVVUSF9QUk9WSURFUjogJ2F1dGgvaW52YWxpZC1vYXV0aC1wcm92aWRlcicsXHJcbiAgICBJTlZBTElEX09PQl9DT0RFOiAnYXV0aC9pbnZhbGlkLWFjdGlvbi1jb2RlJyxcclxuICAgIElOVkFMSURfT1JJR0lOOiAnYXV0aC91bmF1dGhvcml6ZWQtZG9tYWluJyxcclxuICAgIElOVkFMSURfUEFTU1dPUkQ6ICdhdXRoL3dyb25nLXBhc3N3b3JkJyxcclxuICAgIElOVkFMSURfUEVSU0lTVEVOQ0U6ICdhdXRoL2ludmFsaWQtcGVyc2lzdGVuY2UtdHlwZScsXHJcbiAgICBJTlZBTElEX1BIT05FX05VTUJFUjogJ2F1dGgvaW52YWxpZC1waG9uZS1udW1iZXInLFxyXG4gICAgSU5WQUxJRF9QUk9WSURFUl9JRDogJ2F1dGgvaW52YWxpZC1wcm92aWRlci1pZCcsXHJcbiAgICBJTlZBTElEX1JFQ0lQSUVOVF9FTUFJTDogJ2F1dGgvaW52YWxpZC1yZWNpcGllbnQtZW1haWwnLFxyXG4gICAgSU5WQUxJRF9TRU5ERVI6ICdhdXRoL2ludmFsaWQtc2VuZGVyJyxcclxuICAgIElOVkFMSURfU0VTU0lPTl9JTkZPOiAnYXV0aC9pbnZhbGlkLXZlcmlmaWNhdGlvbi1pZCcsXHJcbiAgICBJTlZBTElEX1RFTkFOVF9JRDogJ2F1dGgvaW52YWxpZC10ZW5hbnQtaWQnLFxyXG4gICAgTUZBX0lORk9fTk9UX0ZPVU5EOiAnYXV0aC9tdWx0aS1mYWN0b3ItaW5mby1ub3QtZm91bmQnLFxyXG4gICAgTUZBX1JFUVVJUkVEOiAnYXV0aC9tdWx0aS1mYWN0b3ItYXV0aC1yZXF1aXJlZCcsXHJcbiAgICBNSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FOiAnYXV0aC9taXNzaW5nLWFuZHJvaWQtcGtnLW5hbWUnLFxyXG4gICAgTUlTU0lOR19BUFBfQ1JFREVOVElBTDogJ2F1dGgvbWlzc2luZy1hcHAtY3JlZGVudGlhbCcsXHJcbiAgICBNSVNTSU5HX0FVVEhfRE9NQUlOOiAnYXV0aC9hdXRoLWRvbWFpbi1jb25maWctcmVxdWlyZWQnLFxyXG4gICAgTUlTU0lOR19DT0RFOiAnYXV0aC9taXNzaW5nLXZlcmlmaWNhdGlvbi1jb2RlJyxcclxuICAgIE1JU1NJTkdfQ09OVElOVUVfVVJJOiAnYXV0aC9taXNzaW5nLWNvbnRpbnVlLXVyaScsXHJcbiAgICBNSVNTSU5HX0lGUkFNRV9TVEFSVDogJ2F1dGgvbWlzc2luZy1pZnJhbWUtc3RhcnQnLFxyXG4gICAgTUlTU0lOR19JT1NfQlVORExFX0lEOiAnYXV0aC9taXNzaW5nLWlvcy1idW5kbGUtaWQnLFxyXG4gICAgTUlTU0lOR19PUl9JTlZBTElEX05PTkNFOiAnYXV0aC9taXNzaW5nLW9yLWludmFsaWQtbm9uY2UnLFxyXG4gICAgTUlTU0lOR19NRkFfSU5GTzogJ2F1dGgvbWlzc2luZy1tdWx0aS1mYWN0b3ItaW5mbycsXHJcbiAgICBNSVNTSU5HX01GQV9TRVNTSU9OOiAnYXV0aC9taXNzaW5nLW11bHRpLWZhY3Rvci1zZXNzaW9uJyxcclxuICAgIE1JU1NJTkdfUEhPTkVfTlVNQkVSOiAnYXV0aC9taXNzaW5nLXBob25lLW51bWJlcicsXHJcbiAgICBNSVNTSU5HX1NFU1NJT05fSU5GTzogJ2F1dGgvbWlzc2luZy12ZXJpZmljYXRpb24taWQnLFxyXG4gICAgTU9EVUxFX0RFU1RST1lFRDogJ2F1dGgvYXBwLWRlbGV0ZWQnLFxyXG4gICAgTkVFRF9DT05GSVJNQVRJT046ICdhdXRoL2FjY291bnQtZXhpc3RzLXdpdGgtZGlmZmVyZW50LWNyZWRlbnRpYWwnLFxyXG4gICAgTkVUV09SS19SRVFVRVNUX0ZBSUxFRDogJ2F1dGgvbmV0d29yay1yZXF1ZXN0LWZhaWxlZCcsXHJcbiAgICBOVUxMX1VTRVI6ICdhdXRoL251bGwtdXNlcicsXHJcbiAgICBOT19BVVRIX0VWRU5UOiAnYXV0aC9uby1hdXRoLWV2ZW50JyxcclxuICAgIE5PX1NVQ0hfUFJPVklERVI6ICdhdXRoL25vLXN1Y2gtcHJvdmlkZXInLFxyXG4gICAgT1BFUkFUSU9OX05PVF9BTExPV0VEOiAnYXV0aC9vcGVyYXRpb24tbm90LWFsbG93ZWQnLFxyXG4gICAgT1BFUkFUSU9OX05PVF9TVVBQT1JURUQ6ICdhdXRoL29wZXJhdGlvbi1ub3Qtc3VwcG9ydGVkLWluLXRoaXMtZW52aXJvbm1lbnQnLFxyXG4gICAgUE9QVVBfQkxPQ0tFRDogJ2F1dGgvcG9wdXAtYmxvY2tlZCcsXHJcbiAgICBQT1BVUF9DTE9TRURfQllfVVNFUjogJ2F1dGgvcG9wdXAtY2xvc2VkLWJ5LXVzZXInLFxyXG4gICAgUFJPVklERVJfQUxSRUFEWV9MSU5LRUQ6ICdhdXRoL3Byb3ZpZGVyLWFscmVhZHktbGlua2VkJyxcclxuICAgIFFVT1RBX0VYQ0VFREVEOiAnYXV0aC9xdW90YS1leGNlZWRlZCcsXHJcbiAgICBSRURJUkVDVF9DQU5DRUxMRURfQllfVVNFUjogJ2F1dGgvcmVkaXJlY3QtY2FuY2VsbGVkLWJ5LXVzZXInLFxyXG4gICAgUkVESVJFQ1RfT1BFUkFUSU9OX1BFTkRJTkc6ICdhdXRoL3JlZGlyZWN0LW9wZXJhdGlvbi1wZW5kaW5nJyxcclxuICAgIFJFSkVDVEVEX0NSRURFTlRJQUw6ICdhdXRoL3JlamVjdGVkLWNyZWRlbnRpYWwnLFxyXG4gICAgU0VDT05EX0ZBQ1RPUl9BTFJFQURZX0VOUk9MTEVEOiAnYXV0aC9zZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlJyxcclxuICAgIFNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQ6ICdhdXRoL21heGltdW0tc2Vjb25kLWZhY3Rvci1jb3VudC1leGNlZWRlZCcsXHJcbiAgICBURU5BTlRfSURfTUlTTUFUQ0g6ICdhdXRoL3RlbmFudC1pZC1taXNtYXRjaCcsXHJcbiAgICBUSU1FT1VUOiAnYXV0aC90aW1lb3V0JyxcclxuICAgIFRPS0VOX0VYUElSRUQ6ICdhdXRoL3VzZXItdG9rZW4tZXhwaXJlZCcsXHJcbiAgICBUT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVI6ICdhdXRoL3Rvby1tYW55LXJlcXVlc3RzJyxcclxuICAgIFVOQVVUSE9SSVpFRF9ET01BSU46ICdhdXRoL3VuYXV0aG9yaXplZC1jb250aW51ZS11cmknLFxyXG4gICAgVU5TVVBQT1JURURfRklSU1RfRkFDVE9SOiAnYXV0aC91bnN1cHBvcnRlZC1maXJzdC1mYWN0b3InLFxyXG4gICAgVU5TVVBQT1JURURfUEVSU0lTVEVOQ0U6ICdhdXRoL3Vuc3VwcG9ydGVkLXBlcnNpc3RlbmNlLXR5cGUnLFxyXG4gICAgVU5TVVBQT1JURURfVEVOQU5UX09QRVJBVElPTjogJ2F1dGgvdW5zdXBwb3J0ZWQtdGVuYW50LW9wZXJhdGlvbicsXHJcbiAgICBVTlZFUklGSUVEX0VNQUlMOiAnYXV0aC91bnZlcmlmaWVkLWVtYWlsJyxcclxuICAgIFVTRVJfQ0FOQ0VMTEVEOiAnYXV0aC91c2VyLWNhbmNlbGxlZCcsXHJcbiAgICBVU0VSX0RFTEVURUQ6ICdhdXRoL3VzZXItbm90LWZvdW5kJyxcclxuICAgIFVTRVJfRElTQUJMRUQ6ICdhdXRoL3VzZXItZGlzYWJsZWQnLFxyXG4gICAgVVNFUl9NSVNNQVRDSDogJ2F1dGgvdXNlci1taXNtYXRjaCcsXHJcbiAgICBVU0VSX1NJR05FRF9PVVQ6ICdhdXRoL3VzZXItc2lnbmVkLW91dCcsXHJcbiAgICBXRUFLX1BBU1NXT1JEOiAnYXV0aC93ZWFrLXBhc3N3b3JkJyxcclxuICAgIFdFQl9TVE9SQUdFX1VOU1VQUE9SVEVEOiAnYXV0aC93ZWItc3RvcmFnZS11bnN1cHBvcnRlZCcsXHJcbiAgICBBTFJFQURZX0lOSVRJQUxJWkVEOiAnYXV0aC9hbHJlYWR5LWluaXRpYWxpemVkJ1xyXG59O1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBsb2dDbGllbnQgPSBuZXcgTG9nZ2VyKCdAZmlyZWJhc2UvYXV0aCcpO1xyXG5mdW5jdGlvbiBfbG9nRXJyb3IobXNnLCAuLi5hcmdzKSB7XHJcbiAgICBpZiAobG9nQ2xpZW50LmxvZ0xldmVsIDw9IExvZ0xldmVsLkVSUk9SKSB7XHJcbiAgICAgICAgbG9nQ2xpZW50LmVycm9yKGBBdXRoICgke1NES19WRVJTSU9OfSk6ICR7bXNnfWAsIC4uLmFyZ3MpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIF9mYWlsKGF1dGhPckNvZGUsIC4uLnJlc3QpIHtcclxuICAgIHRocm93IGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCk7XHJcbn1cclxuZnVuY3Rpb24gX2NyZWF0ZUVycm9yKGF1dGhPckNvZGUsIC4uLnJlc3QpIHtcclxuICAgIHJldHVybiBjcmVhdGVFcnJvckludGVybmFsKGF1dGhPckNvZGUsIC4uLnJlc3QpO1xyXG59XHJcbmZ1bmN0aW9uIF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIGNvZGUsIG1lc3NhZ2UpIHtcclxuICAgIGNvbnN0IGVycm9yTWFwID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBwcm9kRXJyb3JNYXAoKSksIHsgW2NvZGVdOiBtZXNzYWdlIH0pO1xyXG4gICAgY29uc3QgZmFjdG9yeSA9IG5ldyBFcnJvckZhY3RvcnkoJ2F1dGgnLCAnRmlyZWJhc2UnLCBlcnJvck1hcCk7XHJcbiAgICByZXR1cm4gZmFjdG9yeS5jcmVhdGUoY29kZSwge1xyXG4gICAgICAgIGFwcE5hbWU6IGF1dGgubmFtZVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gX2Fzc2VydEluc3RhbmNlT2YoYXV0aCwgb2JqZWN0LCBpbnN0YW5jZSkge1xyXG4gICAgY29uc3QgY29uc3RydWN0b3JJbnN0YW5jZSA9IGluc3RhbmNlO1xyXG4gICAgaWYgKCEob2JqZWN0IGluc3RhbmNlb2YgY29uc3RydWN0b3JJbnN0YW5jZSkpIHtcclxuICAgICAgICBpZiAoY29uc3RydWN0b3JJbnN0YW5jZS5uYW1lICE9PSBvYmplY3QuY29uc3RydWN0b3IubmFtZSkge1xyXG4gICAgICAgICAgICBfZmFpbChhdXRoLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovLCBgVHlwZSBvZiAke29iamVjdC5jb25zdHJ1Y3Rvci5uYW1lfSBkb2VzIG5vdCBtYXRjaCBleHBlY3RlZCBpbnN0YW5jZS5gICtcclxuICAgICAgICAgICAgYERpZCB5b3UgcGFzcyBhIHJlZmVyZW5jZSBmcm9tIGEgZGlmZmVyZW50IEF1dGggU0RLP2ApO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCkge1xyXG4gICAgaWYgKHR5cGVvZiBhdXRoT3JDb2RlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGNvbnN0IGNvZGUgPSByZXN0WzBdO1xyXG4gICAgICAgIGNvbnN0IGZ1bGxQYXJhbXMgPSBbLi4ucmVzdC5zbGljZSgxKV07XHJcbiAgICAgICAgaWYgKGZ1bGxQYXJhbXNbMF0pIHtcclxuICAgICAgICAgICAgZnVsbFBhcmFtc1swXS5hcHBOYW1lID0gYXV0aE9yQ29kZS5uYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXV0aE9yQ29kZS5fZXJyb3JGYWN0b3J5LmNyZWF0ZShjb2RlLCAuLi5mdWxsUGFyYW1zKTtcclxuICAgIH1cclxuICAgIHJldHVybiBfREVGQVVMVF9BVVRIX0VSUk9SX0ZBQ1RPUlkuY3JlYXRlKGF1dGhPckNvZGUsIC4uLnJlc3QpO1xyXG59XHJcbmZ1bmN0aW9uIF9hc3NlcnQoYXNzZXJ0aW9uLCBhdXRoT3JDb2RlLCAuLi5yZXN0KSB7XHJcbiAgICBpZiAoIWFzc2VydGlvbikge1xyXG4gICAgICAgIHRocm93IGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFVuY29uZGl0aW9uYWxseSBmYWlscywgdGhyb3dpbmcgYW4gaW50ZXJuYWwgZXJyb3Igd2l0aCB0aGUgZ2l2ZW4gbWVzc2FnZS5cclxuICpcclxuICogQHBhcmFtIGZhaWx1cmUgdHlwZSBvZiBmYWlsdXJlIGVuY291bnRlcmVkXHJcbiAqIEB0aHJvd3MgRXJyb3JcclxuICovXHJcbmZ1bmN0aW9uIGRlYnVnRmFpbChmYWlsdXJlKSB7XHJcbiAgICAvLyBMb2cgdGhlIGZhaWx1cmUgaW4gYWRkaXRpb24gdG8gdGhyb3cgYW4gZXhjZXB0aW9uLCBqdXN0IGluIGNhc2UgdGhlXHJcbiAgICAvLyBleGNlcHRpb24gaXMgc3dhbGxvd2VkLlxyXG4gICAgY29uc3QgbWVzc2FnZSA9IGBJTlRFUk5BTCBBU1NFUlRJT04gRkFJTEVEOiBgICsgZmFpbHVyZTtcclxuICAgIF9sb2dFcnJvcihtZXNzYWdlKTtcclxuICAgIC8vIE5PVEU6IFdlIGRvbid0IHVzZSBGaXJlYmFzZUVycm9yIGhlcmUgYmVjYXVzZSB0aGVzZSBhcmUgaW50ZXJuYWwgZmFpbHVyZXNcclxuICAgIC8vIHRoYXQgY2Fubm90IGJlIGhhbmRsZWQgYnkgdGhlIHVzZXIuIChBbHNvIGl0IHdvdWxkIGNyZWF0ZSBhIGNpcmN1bGFyXHJcbiAgICAvLyBkZXBlbmRlbmN5IGJldHdlZW4gdGhlIGVycm9yIGFuZCBhc3NlcnQgbW9kdWxlcyB3aGljaCBkb2Vzbid0IHdvcmsuKVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG59XHJcbi8qKlxyXG4gKiBGYWlscyBpZiB0aGUgZ2l2ZW4gYXNzZXJ0aW9uIGNvbmRpdGlvbiBpcyBmYWxzZSwgdGhyb3dpbmcgYW4gRXJyb3Igd2l0aCB0aGVcclxuICogZ2l2ZW4gbWVzc2FnZSBpZiBpdCBkaWQuXHJcbiAqXHJcbiAqIEBwYXJhbSBhc3NlcnRpb25cclxuICogQHBhcmFtIG1lc3NhZ2VcclxuICovXHJcbmZ1bmN0aW9uIGRlYnVnQXNzZXJ0KGFzc2VydGlvbiwgbWVzc2FnZSkge1xyXG4gICAgaWYgKCFhc3NlcnRpb24pIHtcclxuICAgICAgICBkZWJ1Z0ZhaWwobWVzc2FnZSk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgaW5zdGFuY2VDYWNoZSA9IG5ldyBNYXAoKTtcclxuZnVuY3Rpb24gX2dldEluc3RhbmNlKGNscykge1xyXG4gICAgZGVidWdBc3NlcnQoY2xzIGluc3RhbmNlb2YgRnVuY3Rpb24sICdFeHBlY3RlZCBhIGNsYXNzIGRlZmluaXRpb24nKTtcclxuICAgIGxldCBpbnN0YW5jZSA9IGluc3RhbmNlQ2FjaGUuZ2V0KGNscyk7XHJcbiAgICBpZiAoaW5zdGFuY2UpIHtcclxuICAgICAgICBkZWJ1Z0Fzc2VydChpbnN0YW5jZSBpbnN0YW5jZW9mIGNscywgJ0luc3RhbmNlIHN0b3JlZCBpbiBjYWNoZSBtaXNtYXRjaGVkIHdpdGggY2xhc3MnKTtcclxuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgICBpbnN0YW5jZSA9IG5ldyBjbHMoKTtcclxuICAgIGluc3RhbmNlQ2FjaGUuc2V0KGNscywgaW5zdGFuY2UpO1xyXG4gICAgcmV0dXJuIGluc3RhbmNlO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplcyBhbiB7QGxpbmsgQXV0aH0gaW5zdGFuY2Ugd2l0aCBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyXHJcbiAqIHtAbGluayBEZXBlbmRlbmNpZXN9LlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKlxyXG4gKiBUaGlzIGZ1bmN0aW9uIGFsbG93cyBtb3JlIGNvbnRyb2wgb3ZlciB0aGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIHRoYW5cclxuICoge0BsaW5rIGdldEF1dGh9LiBgZ2V0QXV0aGAgdXNlcyBwbGF0Zm9ybS1zcGVjaWZpYyBkZWZhdWx0cyB0byBzdXBwbHlcclxuICogdGhlIHtAbGluayBEZXBlbmRlbmNpZXN9LiBJbiBnZW5lcmFsLCBgZ2V0QXV0aGAgaXMgdGhlIGVhc2llc3Qgd2F5IHRvXHJcbiAqIGluaXRpYWxpemUgQXV0aCBhbmQgd29ya3MgZm9yIG1vc3QgdXNlIGNhc2VzLiBVc2UgYGluaXRpYWxpemVBdXRoYCBpZiB5b3VcclxuICogbmVlZCBjb250cm9sIG92ZXIgd2hpY2ggcGVyc2lzdGVuY2UgbGF5ZXIgaXMgdXNlZCwgb3IgdG8gbWluaW1pemUgYnVuZGxlXHJcbiAqIHNpemUgaWYgeW91J3JlIG5vdCB1c2luZyBlaXRoZXIgYHNpZ25JbldpdGhQb3B1cGAgb3IgYHNpZ25JbldpdGhSZWRpcmVjdGAuXHJcbiAqXHJcbiAqIEZvciBleGFtcGxlLCBpZiB5b3VyIGFwcCBvbmx5IHVzZXMgYW5vbnltb3VzIGFjY291bnRzIGFuZCB5b3Ugb25seSB3YW50XHJcbiAqIGFjY291bnRzIHNhdmVkIGZvciB0aGUgY3VycmVudCBzZXNzaW9uLCBpbml0aWFsaXplIGBBdXRoYCB3aXRoOlxyXG4gKlxyXG4gKiBgYGBqc1xyXG4gKiBjb25zdCBhdXRoID0gaW5pdGlhbGl6ZUF1dGgoYXBwLCB7XHJcbiAqICAgcGVyc2lzdGVuY2U6IGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UsXHJcbiAqICAgcG9wdXBSZWRpcmVjdFJlc29sdmVyOiB1bmRlZmluZWQsXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gaW5pdGlhbGl6ZUF1dGgoYXBwLCBkZXBzKSB7XHJcbiAgICBjb25zdCBwcm92aWRlciA9IF9nZXRQcm92aWRlcihhcHAsICdhdXRoJyk7XHJcbiAgICBpZiAocHJvdmlkZXIuaXNJbml0aWFsaXplZCgpKSB7XHJcbiAgICAgICAgY29uc3QgYXV0aCA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWxPcHRpb25zID0gcHJvdmlkZXIuZ2V0T3B0aW9ucygpO1xyXG4gICAgICAgIGlmIChkZWVwRXF1YWwoaW5pdGlhbE9wdGlvbnMsIGRlcHMgIT09IG51bGwgJiYgZGVwcyAhPT0gdm9pZCAwID8gZGVwcyA6IHt9KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gYXV0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiYWxyZWFkeS1pbml0aWFsaXplZFwiIC8qIEF1dGhFcnJvckNvZGUuQUxSRUFEWV9JTklUSUFMSVpFRCAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgYXV0aCA9IHByb3ZpZGVyLmluaXRpYWxpemUoeyBvcHRpb25zOiBkZXBzIH0pO1xyXG4gICAgcmV0dXJuIGF1dGg7XHJcbn1cclxuZnVuY3Rpb24gX2luaXRpYWxpemVBdXRoSW5zdGFuY2UoYXV0aCwgZGVwcykge1xyXG4gICAgY29uc3QgcGVyc2lzdGVuY2UgPSAoZGVwcyA9PT0gbnVsbCB8fCBkZXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkZXBzLnBlcnNpc3RlbmNlKSB8fCBbXTtcclxuICAgIGNvbnN0IGhpZXJhcmNoeSA9IChBcnJheS5pc0FycmF5KHBlcnNpc3RlbmNlKSA/IHBlcnNpc3RlbmNlIDogW3BlcnNpc3RlbmNlXSkubWFwKF9nZXRJbnN0YW5jZSk7XHJcbiAgICBpZiAoZGVwcyA9PT0gbnVsbCB8fCBkZXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkZXBzLmVycm9yTWFwKSB7XHJcbiAgICAgICAgYXV0aC5fdXBkYXRlRXJyb3JNYXAoZGVwcy5lcnJvck1hcCk7XHJcbiAgICB9XHJcbiAgICAvLyBUaGlzIHByb21pc2UgaXMgaW50ZW5kZWQgdG8gZmxvYXQ7IGF1dGggaW5pdGlhbGl6YXRpb24gaGFwcGVucyBpbiB0aGVcclxuICAgIC8vIGJhY2tncm91bmQsIG1lYW53aGlsZSB0aGUgYXV0aCBvYmplY3QgbWF5IGJlIHVzZWQgYnkgdGhlIGFwcC5cclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcclxuICAgIGF1dGguX2luaXRpYWxpemVXaXRoUGVyc2lzdGVuY2UoaGllcmFyY2h5LCBkZXBzID09PSBudWxsIHx8IGRlcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlcHMucG9wdXBSZWRpcmVjdFJlc29sdmVyKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBfZ2V0Q3VycmVudFVybCgpIHtcclxuICAgIHZhciBfYTtcclxuICAgIHJldHVybiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICgoX2EgPSBzZWxmLmxvY2F0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaHJlZikpIHx8ICcnO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0h0dHBPckh0dHBzKCkge1xyXG4gICAgcmV0dXJuIF9nZXRDdXJyZW50U2NoZW1lKCkgPT09ICdodHRwOicgfHwgX2dldEN1cnJlbnRTY2hlbWUoKSA9PT0gJ2h0dHBzOic7XHJcbn1cclxuZnVuY3Rpb24gX2dldEN1cnJlbnRTY2hlbWUoKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICByZXR1cm4gKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAoKF9hID0gc2VsZi5sb2NhdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb3RvY29sKSkgfHwgbnVsbDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGJyb3dzZXIgaXMgd29ya2luZyBvbmxpbmVcclxuICovXHJcbmZ1bmN0aW9uIF9pc09ubGluZSgpIHtcclxuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJlxyXG4gICAgICAgIG5hdmlnYXRvciAmJlxyXG4gICAgICAgICdvbkxpbmUnIGluIG5hdmlnYXRvciAmJlxyXG4gICAgICAgIHR5cGVvZiBuYXZpZ2F0b3Iub25MaW5lID09PSAnYm9vbGVhbicgJiZcclxuICAgICAgICAvLyBBcHBseSBvbmx5IGZvciB0cmFkaXRpb25hbCB3ZWIgYXBwcyBhbmQgQ2hyb21lIGV4dGVuc2lvbnMuXHJcbiAgICAgICAgLy8gVGhpcyBpcyBlc3BlY2lhbGx5IHRydWUgZm9yIENvcmRvdmEgYXBwcyB3aGljaCBoYXZlIHVucmVsaWFibGVcclxuICAgICAgICAvLyBuYXZpZ2F0b3Iub25MaW5lIGJlaGF2aW9yIHVubGVzcyBjb3Jkb3ZhLXBsdWdpbi1uZXR3b3JrLWluZm9ybWF0aW9uIGlzXHJcbiAgICAgICAgLy8gaW5zdGFsbGVkIHdoaWNoIG92ZXJ3cml0ZXMgdGhlIG5hdGl2ZSBuYXZpZ2F0b3Iub25MaW5lIHZhbHVlIGFuZFxyXG4gICAgICAgIC8vIGRlZmluZXMgbmF2aWdhdG9yLmNvbm5lY3Rpb24uXHJcbiAgICAgICAgKF9pc0h0dHBPckh0dHBzKCkgfHwgaXNCcm93c2VyRXh0ZW5zaW9uKCkgfHwgJ2Nvbm5lY3Rpb24nIGluIG5hdmlnYXRvcikpIHtcclxuICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm9uTGluZTtcclxuICAgIH1cclxuICAgIC8vIElmIHdlIGNhbid0IGRldGVybWluZSB0aGUgc3RhdGUsIGFzc3VtZSBpdCBpcyBvbmxpbmUuXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxyXG5mdW5jdGlvbiBfZ2V0VXNlckxhbmd1YWdlKCkge1xyXG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBuYXZpZ2F0b3JMYW5ndWFnZSA9IG5hdmlnYXRvcjtcclxuICAgIHJldHVybiAoXHJcbiAgICAvLyBNb3N0IHJlbGlhYmxlLCBidXQgb25seSBzdXBwb3J0ZWQgaW4gQ2hyb21lL0ZpcmVmb3guXHJcbiAgICAobmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2VzICYmIG5hdmlnYXRvckxhbmd1YWdlLmxhbmd1YWdlc1swXSkgfHxcclxuICAgICAgICAvLyBTdXBwb3J0ZWQgaW4gbW9zdCBicm93c2VycywgYnV0IHJldHVybnMgdGhlIGxhbmd1YWdlIG9mIHRoZSBicm93c2VyXHJcbiAgICAgICAgLy8gVUksIG5vdCB0aGUgbGFuZ3VhZ2Ugc2V0IGluIGJyb3dzZXIgc2V0dGluZ3MuXHJcbiAgICAgICAgbmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2UgfHxcclxuICAgICAgICAvLyBDb3VsZG4ndCBkZXRlcm1pbmUgbGFuZ3VhZ2UuXHJcbiAgICAgICAgbnVsbCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEEgc3RydWN0dXJlIHRvIGhlbHAgcGljayBiZXR3ZWVuIGEgcmFuZ2Ugb2YgbG9uZyBhbmQgc2hvcnQgZGVsYXkgZHVyYXRpb25zXHJcbiAqIGRlcGVuZGluZyBvbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudC4gSW4gZ2VuZXJhbCwgdGhlIGxvbmcgZGVsYXkgaXMgdXNlZCBmb3JcclxuICogbW9iaWxlIGVudmlyb25tZW50cyB3aGVyZWFzIHNob3J0IGRlbGF5cyBhcmUgdXNlZCBmb3IgZGVza3RvcCBlbnZpcm9ubWVudHMuXHJcbiAqL1xyXG5jbGFzcyBEZWxheSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzaG9ydERlbGF5LCBsb25nRGVsYXkpIHtcclxuICAgICAgICB0aGlzLnNob3J0RGVsYXkgPSBzaG9ydERlbGF5O1xyXG4gICAgICAgIHRoaXMubG9uZ0RlbGF5ID0gbG9uZ0RlbGF5O1xyXG4gICAgICAgIC8vIEludGVybmFsIGVycm9yIHdoZW4gaW1wcm9wZXJseSBpbml0aWFsaXplZC5cclxuICAgICAgICBkZWJ1Z0Fzc2VydChsb25nRGVsYXkgPiBzaG9ydERlbGF5LCAnU2hvcnQgZGVsYXkgc2hvdWxkIGJlIGxlc3MgdGhhbiBsb25nIGRlbGF5IScpO1xyXG4gICAgICAgIHRoaXMuaXNNb2JpbGUgPSBpc01vYmlsZUNvcmRvdmEoKSB8fCBpc1JlYWN0TmF0aXZlKCk7XHJcbiAgICB9XHJcbiAgICBnZXQoKSB7XHJcbiAgICAgICAgaWYgKCFfaXNPbmxpbmUoKSkge1xyXG4gICAgICAgICAgICAvLyBQaWNrIHRoZSBzaG9ydGVyIHRpbWVvdXQuXHJcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbig1MDAwIC8qIERlbGF5TWluLk9GRkxJTkUgKi8sIHRoaXMuc2hvcnREZWxheSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIElmIHJ1bm5pbmcgaW4gYSBtb2JpbGUgZW52aXJvbm1lbnQsIHJldHVybiB0aGUgbG9uZyBkZWxheSwgb3RoZXJ3aXNlXHJcbiAgICAgICAgLy8gcmV0dXJuIHRoZSBzaG9ydCBkZWxheS5cclxuICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIGltcHJvdmVkIGluIHRoZSBmdXR1cmUgdG8gZHluYW1pY2FsbHkgY2hhbmdlIGJhc2VkIG9uIG90aGVyXHJcbiAgICAgICAgLy8gdmFyaWFibGVzIGluc3RlYWQgb2YganVzdCByZWFkaW5nIHRoZSBjdXJyZW50IGVudmlyb25tZW50LlxyXG4gICAgICAgIHJldHVybiB0aGlzLmlzTW9iaWxlID8gdGhpcy5sb25nRGVsYXkgOiB0aGlzLnNob3J0RGVsYXk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX2VtdWxhdG9yVXJsKGNvbmZpZywgcGF0aCkge1xyXG4gICAgZGVidWdBc3NlcnQoY29uZmlnLmVtdWxhdG9yLCAnRW11bGF0b3Igc2hvdWxkIGFsd2F5cyBiZSBzZXQgaGVyZScpO1xyXG4gICAgY29uc3QgeyB1cmwgfSA9IGNvbmZpZy5lbXVsYXRvcjtcclxuICAgIGlmICghcGF0aCkge1xyXG4gICAgICAgIHJldHVybiB1cmw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7dXJsfSR7cGF0aC5zdGFydHNXaXRoKCcvJykgPyBwYXRoLnNsaWNlKDEpIDogcGF0aH1gO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIEZldGNoUHJvdmlkZXIge1xyXG4gICAgc3RhdGljIGluaXRpYWxpemUoZmV0Y2hJbXBsLCBoZWFkZXJzSW1wbCwgcmVzcG9uc2VJbXBsKSB7XHJcbiAgICAgICAgdGhpcy5mZXRjaEltcGwgPSBmZXRjaEltcGw7XHJcbiAgICAgICAgaWYgKGhlYWRlcnNJbXBsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGVhZGVyc0ltcGwgPSBoZWFkZXJzSW1wbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlSW1wbCkge1xyXG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlSW1wbCA9IHJlc3BvbnNlSW1wbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZmV0Y2goKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZmV0Y2hJbXBsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoSW1wbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAnZmV0Y2gnIGluIHNlbGYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZmV0Y2g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlYnVnRmFpbCgnQ291bGQgbm90IGZpbmQgZmV0Y2ggaW1wbGVtZW50YXRpb24sIG1ha2Ugc3VyZSB5b3UgY2FsbCBGZXRjaFByb3ZpZGVyLmluaXRpYWxpemUoKSB3aXRoIGFuIGFwcHJvcHJpYXRlIHBvbHlmaWxsJyk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgaGVhZGVycygpIHtcclxuICAgICAgICBpZiAodGhpcy5oZWFkZXJzSW1wbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5oZWFkZXJzSW1wbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAnSGVhZGVycycgaW4gc2VsZikge1xyXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5IZWFkZXJzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZWJ1Z0ZhaWwoJ0NvdWxkIG5vdCBmaW5kIEhlYWRlcnMgaW1wbGVtZW50YXRpb24sIG1ha2Ugc3VyZSB5b3UgY2FsbCBGZXRjaFByb3ZpZGVyLmluaXRpYWxpemUoKSB3aXRoIGFuIGFwcHJvcHJpYXRlIHBvbHlmaWxsJyk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgcmVzcG9uc2UoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVzcG9uc2VJbXBsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc3BvbnNlSW1wbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAnUmVzcG9uc2UnIGluIHNlbGYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuUmVzcG9uc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlYnVnRmFpbCgnQ291bGQgbm90IGZpbmQgUmVzcG9uc2UgaW1wbGVtZW50YXRpb24sIG1ha2Ugc3VyZSB5b3UgY2FsbCBGZXRjaFByb3ZpZGVyLmluaXRpYWxpemUoKSB3aXRoIGFuIGFwcHJvcHJpYXRlIHBvbHlmaWxsJyk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIE1hcCBmcm9tIGVycm9ycyByZXR1cm5lZCBieSB0aGUgc2VydmVyIHRvIGVycm9ycyB0byBkZXZlbG9wZXIgdmlzaWJsZSBlcnJvcnNcclxuICovXHJcbmNvbnN0IFNFUlZFUl9FUlJPUl9NQVAgPSB7XHJcbiAgICAvLyBDdXN0b20gdG9rZW4gZXJyb3JzLlxyXG4gICAgW1wiQ1JFREVOVElBTF9NSVNNQVRDSFwiIC8qIFNlcnZlckVycm9yLkNSRURFTlRJQUxfTUlTTUFUQ0ggKi9dOiBcImN1c3RvbS10b2tlbi1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9NSVNNQVRDSCAqLyxcclxuICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC5cclxuICAgIFtcIk1JU1NJTkdfQ1VTVE9NX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DVVNUT01fVE9LRU4gKi9dOiBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyxcclxuICAgIC8vIENyZWF0ZSBBdXRoIFVSSSBlcnJvcnMuXHJcbiAgICBbXCJJTlZBTElEX0lERU5USUZJRVJcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX0lERU5USUZJRVIgKi9dOiBcImludmFsaWQtZW1haWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRU1BSUwgKi8sXHJcbiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuXHJcbiAgICBbXCJNSVNTSU5HX0NPTlRJTlVFX1VSSVwiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfQ09OVElOVUVfVVJJICovXTogXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sXHJcbiAgICAvLyBTaWduIGluIHdpdGggZW1haWwgYW5kIHBhc3N3b3JkIGVycm9ycyAoc29tZSBhcHBseSB0byBzaWduIHVwIHRvbykuXHJcbiAgICBbXCJJTlZBTElEX1BBU1NXT1JEXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9QQVNTV09SRCAqL106IFwid3JvbmctcGFzc3dvcmRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEFTU1dPUkQgKi8sXHJcbiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuXHJcbiAgICBbXCJNSVNTSU5HX1BBU1NXT1JEXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19QQVNTV09SRCAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxyXG4gICAgLy8gU2lnbiB1cCB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZCBlcnJvcnMuXHJcbiAgICBbXCJFTUFJTF9FWElTVFNcIiAvKiBTZXJ2ZXJFcnJvci5FTUFJTF9FWElTVFMgKi9dOiBcImVtYWlsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9FWElTVFMgKi8sXHJcbiAgICBbXCJQQVNTV09SRF9MT0dJTl9ESVNBQkxFRFwiIC8qIFNlcnZlckVycm9yLlBBU1NXT1JEX0xPR0lOX0RJU0FCTEVEICovXTogXCJvcGVyYXRpb24tbm90LWFsbG93ZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfQUxMT1dFRCAqLyxcclxuICAgIC8vIFZlcmlmeSBhc3NlcnRpb24gZm9yIHNpZ24gaW4gd2l0aCBjcmVkZW50aWFsIGVycm9yczpcclxuICAgIFtcIklOVkFMSURfSURQX1JFU1BPTlNFXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi9dOiBcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi8sXHJcbiAgICBbXCJJTlZBTElEX1BFTkRJTkdfVE9LRU5cIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX1BFTkRJTkdfVE9LRU4gKi9dOiBcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9JRFBfUkVTUE9OU0UgKi8sXHJcbiAgICBbXCJGRURFUkFURURfVVNFUl9JRF9BTFJFQURZX0xJTktFRFwiIC8qIFNlcnZlckVycm9yLkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEICovXTogXCJjcmVkZW50aWFsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX0FMUkVBRFlfSU5fVVNFICovLFxyXG4gICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0LlxyXG4gICAgW1wiTUlTU0lOR19SRVFfVFlQRVwiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfUkVRX1RZUEUgKi9dOiBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyxcclxuICAgIC8vIFNlbmQgUGFzc3dvcmQgcmVzZXQgZW1haWwgZXJyb3JzOlxyXG4gICAgW1wiRU1BSUxfTk9UX0ZPVU5EXCIgLyogU2VydmVyRXJyb3IuRU1BSUxfTk9UX0ZPVU5EICovXTogXCJ1c2VyLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ERUxFVEVEICovLFxyXG4gICAgW1wiUkVTRVRfUEFTU1dPUkRfRVhDRUVEX0xJTUlUXCIgLyogU2VydmVyRXJyb3IuUkVTRVRfUEFTU1dPUkRfRVhDRUVEX0xJTUlUICovXTogXCJ0b28tbWFueS1yZXF1ZXN0c1wiIC8qIEF1dGhFcnJvckNvZGUuVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSICovLFxyXG4gICAgW1wiRVhQSVJFRF9PT0JfQ09ERVwiIC8qIFNlcnZlckVycm9yLkVYUElSRURfT09CX0NPREUgKi9dOiBcImV4cGlyZWQtYWN0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLkVYUElSRURfT09CX0NPREUgKi8sXHJcbiAgICBbXCJJTlZBTElEX09PQl9DT0RFXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9PT0JfQ09ERSAqL106IFwiaW52YWxpZC1hY3Rpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PT0JfQ09ERSAqLyxcclxuICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC5cclxuICAgIFtcIk1JU1NJTkdfT09CX0NPREVcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX09PQl9DT0RFICovXTogXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sXHJcbiAgICAvLyBPcGVyYXRpb25zIHRoYXQgcmVxdWlyZSBJRCB0b2tlbiBpbiByZXF1ZXN0OlxyXG4gICAgW1wiQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOXCIgLyogU2VydmVyRXJyb3IuQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOICovXTogXCJyZXF1aXJlcy1yZWNlbnQtbG9naW5cIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfVE9PX09MRF9MT0dJTl9BR0FJTiAqLyxcclxuICAgIFtcIklOVkFMSURfSURfVE9LRU5cIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX0lEX1RPS0VOICovXTogXCJpbnZhbGlkLXVzZXItdG9rZW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSCAqLyxcclxuICAgIFtcIlRPS0VOX0VYUElSRURcIiAvKiBTZXJ2ZXJFcnJvci5UT0tFTl9FWFBJUkVEICovXTogXCJ1c2VyLXRva2VuLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi8sXHJcbiAgICBbXCJVU0VSX05PVF9GT1VORFwiIC8qIFNlcnZlckVycm9yLlVTRVJfTk9UX0ZPVU5EICovXTogXCJ1c2VyLXRva2VuLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi8sXHJcbiAgICAvLyBPdGhlciBlcnJvcnMuXHJcbiAgICBbXCJUT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVJcIiAvKiBTZXJ2ZXJFcnJvci5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi9dOiBcInRvby1tYW55LXJlcXVlc3RzXCIgLyogQXV0aEVycm9yQ29kZS5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi8sXHJcbiAgICAvLyBQaG9uZSBBdXRoIHJlbGF0ZWQgZXJyb3JzLlxyXG4gICAgW1wiSU5WQUxJRF9DT0RFXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9DT0RFICovXTogXCJpbnZhbGlkLXZlcmlmaWNhdGlvbi1jb2RlXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0NPREUgKi8sXHJcbiAgICBbXCJJTlZBTElEX1NFU1NJT05fSU5GT1wiIC8qIFNlcnZlckVycm9yLklOVkFMSURfU0VTU0lPTl9JTkZPICovXTogXCJpbnZhbGlkLXZlcmlmaWNhdGlvbi1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9TRVNTSU9OX0lORk8gKi8sXHJcbiAgICBbXCJJTlZBTElEX1RFTVBPUkFSWV9QUk9PRlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfVEVNUE9SQVJZX1BST09GICovXTogXCJpbnZhbGlkLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfSURQX1JFU1BPTlNFICovLFxyXG4gICAgW1wiTUlTU0lOR19TRVNTSU9OX0lORk9cIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1NFU1NJT05fSU5GTyAqL106IFwibWlzc2luZy12ZXJpZmljYXRpb24taWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfU0VTU0lPTl9JTkZPICovLFxyXG4gICAgW1wiU0VTU0lPTl9FWFBJUkVEXCIgLyogU2VydmVyRXJyb3IuU0VTU0lPTl9FWFBJUkVEICovXTogXCJjb2RlLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkNPREVfRVhQSVJFRCAqLyxcclxuICAgIC8vIE90aGVyIGFjdGlvbiBjb2RlIGVycm9ycyB3aGVuIGFkZGl0aW9uYWwgc2V0dGluZ3MgcGFzc2VkLlxyXG4gICAgLy8gTUlTU0lOR19DT05USU5VRV9VUkkgaXMgZ2V0dGluZyBtYXBwZWQgdG8gSU5URVJOQUxfRVJST1IgYWJvdmUuXHJcbiAgICAvLyBUaGlzIGlzIE9LIGFzIHRoaXMgZXJyb3Igd2lsbCBiZSBjYXVnaHQgYnkgY2xpZW50IHNpZGUgdmFsaWRhdGlvbi5cclxuICAgIFtcIk1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUVcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FICovXTogXCJtaXNzaW5nLWFuZHJvaWQtcGtnLW5hbWVcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUUgKi8sXHJcbiAgICBbXCJVTkFVVEhPUklaRURfRE9NQUlOXCIgLyogU2VydmVyRXJyb3IuVU5BVVRIT1JJWkVEX0RPTUFJTiAqL106IFwidW5hdXRob3JpemVkLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuVU5BVVRIT1JJWkVEX0RPTUFJTiAqLyxcclxuICAgIC8vIGdldFByb2plY3RDb25maWcgZXJyb3JzIHdoZW4gY2xpZW50SWQgaXMgcGFzc2VkLlxyXG4gICAgW1wiSU5WQUxJRF9PQVVUSF9DTElFTlRfSURcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX09BVVRIX0NMSUVOVF9JRCAqL106IFwiaW52YWxpZC1vYXV0aC1jbGllbnQtaWRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT0FVVEhfQ0xJRU5UX0lEICovLFxyXG4gICAgLy8gVXNlciBhY3Rpb25zIChzaWduLXVwIG9yIGRlbGV0aW9uKSBkaXNhYmxlZCBlcnJvcnMuXHJcbiAgICBbXCJBRE1JTl9PTkxZX09QRVJBVElPTlwiIC8qIFNlcnZlckVycm9yLkFETUlOX09OTFlfT1BFUkFUSU9OICovXTogXCJhZG1pbi1yZXN0cmljdGVkLW9wZXJhdGlvblwiIC8qIEF1dGhFcnJvckNvZGUuQURNSU5fT05MWV9PUEVSQVRJT04gKi8sXHJcbiAgICAvLyBNdWx0aSBmYWN0b3IgcmVsYXRlZCBlcnJvcnMuXHJcbiAgICBbXCJJTlZBTElEX01GQV9QRU5ESU5HX0NSRURFTlRJQUxcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX01GQV9QRU5ESU5HX0NSRURFTlRJQUwgKi9dOiBcImludmFsaWQtbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfTUZBX1NFU1NJT04gKi8sXHJcbiAgICBbXCJNRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkRcIiAvKiBTZXJ2ZXJFcnJvci5NRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkQgKi9dOiBcIm11bHRpLWZhY3Rvci1pbmZvLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuTUZBX0lORk9fTk9UX0ZPVU5EICovLFxyXG4gICAgW1wiTUlTU0lOR19NRkFfRU5ST0xMTUVOVF9JRFwiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfTUZBX0VOUk9MTE1FTlRfSUQgKi9dOiBcIm1pc3NpbmctbXVsdGktZmFjdG9yLWluZm9cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX0lORk8gKi8sXHJcbiAgICBbXCJNSVNTSU5HX01GQV9QRU5ESU5HX0NSRURFTlRJQUxcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX01GQV9QRU5ESU5HX0NSRURFTlRJQUwgKi9dOiBcIm1pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX1NFU1NJT04gKi8sXHJcbiAgICBbXCJTRUNPTkRfRkFDVE9SX0VYSVNUU1wiIC8qIFNlcnZlckVycm9yLlNFQ09ORF9GQUNUT1JfRVhJU1RTICovXTogXCJzZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQgKi8sXHJcbiAgICBbXCJTRUNPTkRfRkFDVE9SX0xJTUlUX0VYQ0VFREVEXCIgLyogU2VydmVyRXJyb3IuU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRCAqL106IFwibWF4aW11bS1zZWNvbmQtZmFjdG9yLWNvdW50LWV4Y2VlZGVkXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0xJTUlUX0VYQ0VFREVEICovLFxyXG4gICAgLy8gQmxvY2tpbmcgZnVuY3Rpb25zIHJlbGF0ZWQgZXJyb3JzLlxyXG4gICAgW1wiQkxPQ0tJTkdfRlVOQ1RJT05fRVJST1JfUkVTUE9OU0VcIiAvKiBTZXJ2ZXJFcnJvci5CTE9DS0lOR19GVU5DVElPTl9FUlJPUl9SRVNQT05TRSAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovXHJcbn07XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfQVBJX1RJTUVPVVRfTVMgPSBuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTtcclxuZnVuY3Rpb24gX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIGlmIChhdXRoLnRlbmFudElkICYmICFyZXF1ZXN0LnRlbmFudElkKSB7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdCksIHsgdGVuYW50SWQ6IGF1dGgudGVuYW50SWQgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVxdWVzdDtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgbWV0aG9kLCBwYXRoLCByZXF1ZXN0LCBjdXN0b21FcnJvck1hcCA9IHt9KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIGN1c3RvbUVycm9yTWFwLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgbGV0IGJvZHkgPSB7fTtcclxuICAgICAgICBsZXQgcGFyYW1zID0ge307XHJcbiAgICAgICAgaWYgKHJlcXVlc3QpIHtcclxuICAgICAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJHRVRcIiAvKiBIdHRwTWV0aG9kLkdFVCAqLykge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zID0gcmVxdWVzdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGJvZHkgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdClcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcXVlcnkgPSBxdWVyeXN0cmluZyhPYmplY3QuYXNzaWduKHsga2V5OiBhdXRoLmNvbmZpZy5hcGlLZXkgfSwgcGFyYW1zKSkuc2xpY2UoMSk7XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IGF3YWl0IGF1dGguX2dldEFkZGl0aW9uYWxIZWFkZXJzKCk7XHJcbiAgICAgICAgaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiIC8qIEh0dHBIZWFkZXIuQ09OVEVOVF9UWVBFICovXSA9ICdhcHBsaWNhdGlvbi9qc29uJztcclxuICAgICAgICBpZiAoYXV0aC5sYW5ndWFnZUNvZGUpIHtcclxuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtTG9jYWxlXCIgLyogSHR0cEhlYWRlci5YX0ZJUkVCQVNFX0xPQ0FMRSAqL10gPSBhdXRoLmxhbmd1YWdlQ29kZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIEZldGNoUHJvdmlkZXIuZmV0Y2goKShfZ2V0RmluYWxUYXJnZXQoYXV0aCwgYXV0aC5jb25maWcuYXBpSG9zdCwgcGF0aCwgcXVlcnkpLCBPYmplY3QuYXNzaWduKHsgbWV0aG9kLFxyXG4gICAgICAgICAgICBoZWFkZXJzLCByZWZlcnJlclBvbGljeTogJ25vLXJlZmVycmVyJyB9LCBib2R5KSk7XHJcbiAgICB9KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfcGVyZm9ybUZldGNoV2l0aEVycm9ySGFuZGxpbmcoYXV0aCwgY3VzdG9tRXJyb3JNYXAsIGZldGNoRm4pIHtcclxuICAgIGF1dGguX2NhbkluaXRFbXVsYXRvciA9IGZhbHNlO1xyXG4gICAgY29uc3QgZXJyb3JNYXAgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIFNFUlZFUl9FUlJPUl9NQVApLCBjdXN0b21FcnJvck1hcCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IG5ldHdvcmtUaW1lb3V0ID0gbmV3IE5ldHdvcmtUaW1lb3V0KGF1dGgpO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtcclxuICAgICAgICAgICAgZmV0Y2hGbigpLFxyXG4gICAgICAgICAgICBuZXR3b3JrVGltZW91dC5wcm9taXNlXHJcbiAgICAgICAgXSk7XHJcbiAgICAgICAgLy8gSWYgd2UndmUgcmVhY2hlZCB0aGlzIHBvaW50LCB0aGUgZmV0Y2ggc3VjY2VlZGVkIGFuZCB0aGUgbmV0d29ya1RpbWVvdXRcclxuICAgICAgICAvLyBkaWRuJ3QgdGhyb3c7IGNsZWFyIHRoZSBuZXR3b3JrIHRpbWVvdXQgZGVsYXkgc28gdGhhdCBOb2RlIHdvbid0IGhhbmdcclxuICAgICAgICBuZXR3b3JrVGltZW91dC5jbGVhck5ldHdvcmtUaW1lb3V0KCk7XHJcbiAgICAgICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICBpZiAoJ25lZWRDb25maXJtYXRpb24nIGluIGpzb24pIHtcclxuICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcImFjY291bnQtZXhpc3RzLXdpdGgtZGlmZmVyZW50LWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLk5FRURfQ09ORklSTUFUSU9OICovLCBqc29uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLm9rICYmICEoJ2Vycm9yTWVzc2FnZScgaW4ganNvbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGpzb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5vayA/IGpzb24uZXJyb3JNZXNzYWdlIDoganNvbi5lcnJvci5tZXNzYWdlO1xyXG4gICAgICAgICAgICBjb25zdCBbc2VydmVyRXJyb3JDb2RlLCBzZXJ2ZXJFcnJvck1lc3NhZ2VdID0gZXJyb3JNZXNzYWdlLnNwbGl0KCcgOiAnKTtcclxuICAgICAgICAgICAgaWYgKHNlcnZlckVycm9yQ29kZSA9PT0gXCJGRURFUkFURURfVVNFUl9JRF9BTFJFQURZX0xJTktFRFwiIC8qIFNlcnZlckVycm9yLkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEICovKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBfbWFrZVRhZ2dlZEVycm9yKGF1dGgsIFwiY3JlZGVudGlhbC1hbHJlYWR5LWluLXVzZVwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9BTFJFQURZX0lOX1VTRSAqLywganNvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoc2VydmVyRXJyb3JDb2RlID09PSBcIkVNQUlMX0VYSVNUU1wiIC8qIFNlcnZlckVycm9yLkVNQUlMX0VYSVNUUyAqLykge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcImVtYWlsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9FWElTVFMgKi8sIGpzb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHNlcnZlckVycm9yQ29kZSA9PT0gXCJVU0VSX0RJU0FCTEVEXCIgLyogU2VydmVyRXJyb3IuVVNFUl9ESVNBQkxFRCAqLykge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcInVzZXItZGlzYWJsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfRElTQUJMRUQgKi8sIGpzb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGF1dGhFcnJvciA9IGVycm9yTWFwW3NlcnZlckVycm9yQ29kZV0gfHxcclxuICAgICAgICAgICAgICAgIHNlcnZlckVycm9yQ29kZVxyXG4gICAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tfXFxzXSsvZywgJy0nKTtcclxuICAgICAgICAgICAgaWYgKHNlcnZlckVycm9yTWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UoYXV0aCwgYXV0aEVycm9yLCBzZXJ2ZXJFcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgYXV0aEVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7XHJcbiAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF9mYWlsKGF1dGgsIFwibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLyk7XHJcbiAgICB9XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIG1ldGhvZCwgcGF0aCwgcmVxdWVzdCwgY3VzdG9tRXJyb3JNYXAgPSB7fSkge1xyXG4gICAgY29uc3Qgc2VydmVyUmVzcG9uc2UgPSAoYXdhaXQgX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIG1ldGhvZCwgcGF0aCwgcmVxdWVzdCwgY3VzdG9tRXJyb3JNYXApKTtcclxuICAgIGlmICgnbWZhUGVuZGluZ0NyZWRlbnRpYWwnIGluIHNlcnZlclJlc3BvbnNlKSB7XHJcbiAgICAgICAgX2ZhaWwoYXV0aCwgXCJtdWx0aS1mYWN0b3ItYXV0aC1yZXF1aXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuTUZBX1JFUVVJUkVEICovLCB7XHJcbiAgICAgICAgICAgIF9zZXJ2ZXJSZXNwb25zZTogc2VydmVyUmVzcG9uc2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBzZXJ2ZXJSZXNwb25zZTtcclxufVxyXG5mdW5jdGlvbiBfZ2V0RmluYWxUYXJnZXQoYXV0aCwgaG9zdCwgcGF0aCwgcXVlcnkpIHtcclxuICAgIGNvbnN0IGJhc2UgPSBgJHtob3N0fSR7cGF0aH0/JHtxdWVyeX1gO1xyXG4gICAgaWYgKCFhdXRoLmNvbmZpZy5lbXVsYXRvcikge1xyXG4gICAgICAgIHJldHVybiBgJHthdXRoLmNvbmZpZy5hcGlTY2hlbWV9Oi8vJHtiYXNlfWA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX2VtdWxhdG9yVXJsKGF1dGguY29uZmlnLCBiYXNlKTtcclxufVxyXG5jbGFzcyBOZXR3b3JrVGltZW91dCB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgYXJlIGZ1bmRhbWVudGFsbHkgaW5jb21wYXRpYmxlLCBidXQgd2VcclxuICAgICAgICAvLyBkb24ndCBjYXJlIGFib3V0IHRoZSB2YWx1ZSBoZXJlXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICB0aGlzLnRpbWVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKSk7XHJcbiAgICAgICAgICAgIH0sIERFRkFVTFRfQVBJX1RJTUVPVVRfTVMuZ2V0KCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY2xlYXJOZXR3b3JrVGltZW91dCgpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gX21ha2VUYWdnZWRFcnJvcihhdXRoLCBjb2RlLCByZXNwb25zZSkge1xyXG4gICAgY29uc3QgZXJyb3JQYXJhbXMgPSB7XHJcbiAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lXHJcbiAgICB9O1xyXG4gICAgaWYgKHJlc3BvbnNlLmVtYWlsKSB7XHJcbiAgICAgICAgZXJyb3JQYXJhbXMuZW1haWwgPSByZXNwb25zZS5lbWFpbDtcclxuICAgIH1cclxuICAgIGlmIChyZXNwb25zZS5waG9uZU51bWJlcikge1xyXG4gICAgICAgIGVycm9yUGFyYW1zLnBob25lTnVtYmVyID0gcmVzcG9uc2UucGhvbmVOdW1iZXI7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlcnJvciA9IF9jcmVhdGVFcnJvcihhdXRoLCBjb2RlLCBlcnJvclBhcmFtcyk7XHJcbiAgICAvLyBXZSBrbm93IGN1c3RvbURhdGEgaXMgZGVmaW5lZCBvbiBlcnJvciBiZWNhdXNlIGVycm9yUGFyYW1zIGlzIGRlZmluZWRcclxuICAgIGVycm9yLmN1c3RvbURhdGEuX3Rva2VuUmVzcG9uc2UgPSByZXNwb25zZTtcclxuICAgIHJldHVybiBlcnJvcjtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBkZWxldGVBY2NvdW50KGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpkZWxldGVcIiAvKiBFbmRwb2ludC5ERUxFVEVfQUNDT1VOVCAqLywgcmVxdWVzdCk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlTGlua2VkQWNjb3VudHMoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnVwZGF0ZVwiIC8qIEVuZHBvaW50LlNFVF9BQ0NPVU5UX0lORk8gKi8sIHJlcXVlc3QpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGdldEFjY291bnRJbmZvKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpsb29rdXBcIiAvKiBFbmRwb2ludC5HRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcodXRjVGltZXN0YW1wKSB7XHJcbiAgICBpZiAoIXV0Y1RpbWVzdGFtcCkge1xyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIENvbnZlcnQgdG8gZGF0ZSBvYmplY3QuXHJcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKE51bWJlcih1dGNUaW1lc3RhbXApKTtcclxuICAgICAgICAvLyBUZXN0IGRhdGUgaXMgdmFsaWQuXHJcbiAgICAgICAgaWYgKCFpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcclxuICAgICAgICAgICAgLy8gQ29udmVydCB0byBVVEMgZGF0ZSBzdHJpbmcuXHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLnRvVVRDU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAvLyBEbyBub3RoaW5nLiB1bmRlZmluZWQgd2lsbCBiZSByZXR1cm5lZC5cclxuICAgIH1cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFJldHVybnMgYSBKU09OIFdlYiBUb2tlbiAoSldUKSB1c2VkIHRvIGlkZW50aWZ5IHRoZSB1c2VyIHRvIGEgRmlyZWJhc2Ugc2VydmljZS5cclxuICpcclxuICogQHJlbWFya3NcclxuICogUmV0dXJucyB0aGUgY3VycmVudCB0b2tlbiBpZiBpdCBoYXMgbm90IGV4cGlyZWQgb3IgaWYgaXQgd2lsbCBub3QgZXhwaXJlIGluIHRoZSBuZXh0IGZpdmVcclxuICogbWludXRlcy4gT3RoZXJ3aXNlLCB0aGlzIHdpbGwgcmVmcmVzaCB0aGUgdG9rZW4gYW5kIHJldHVybiBhIG5ldyBvbmUuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBmb3JjZVJlZnJlc2ggLSBGb3JjZSByZWZyZXNoIHJlZ2FyZGxlc3Mgb2YgdG9rZW4gZXhwaXJhdGlvbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0SWRUb2tlbih1c2VyLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkge1xyXG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKS5nZXRJZFRva2VuKGZvcmNlUmVmcmVzaCk7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgYSBkZXNlcmlhbGl6ZWQgSlNPTiBXZWIgVG9rZW4gKEpXVCkgdXNlZCB0byBpZGVudGl0ZnkgdGhlIHVzZXIgdG8gYSBGaXJlYmFzZSBzZXJ2aWNlLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBSZXR1cm5zIHRoZSBjdXJyZW50IHRva2VuIGlmIGl0IGhhcyBub3QgZXhwaXJlZCBvciBpZiBpdCB3aWxsIG5vdCBleHBpcmUgaW4gdGhlIG5leHQgZml2ZVxyXG4gKiBtaW51dGVzLiBPdGhlcndpc2UsIHRoaXMgd2lsbCByZWZyZXNoIHRoZSB0b2tlbiBhbmQgcmV0dXJuIGEgbmV3IG9uZS5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIGZvcmNlUmVmcmVzaCAtIEZvcmNlIHJlZnJlc2ggcmVnYXJkbGVzcyBvZiB0b2tlbiBleHBpcmF0aW9uLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRJZFRva2VuUmVzdWx0KHVzZXIsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHVzZXJJbnRlcm5hbC5nZXRJZFRva2VuKGZvcmNlUmVmcmVzaCk7XHJcbiAgICBjb25zdCBjbGFpbXMgPSBfcGFyc2VUb2tlbih0b2tlbik7XHJcbiAgICBfYXNzZXJ0KGNsYWltcyAmJiBjbGFpbXMuZXhwICYmIGNsYWltcy5hdXRoX3RpbWUgJiYgY2xhaW1zLmlhdCwgdXNlckludGVybmFsLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIGNvbnN0IGZpcmViYXNlID0gdHlwZW9mIGNsYWltcy5maXJlYmFzZSA9PT0gJ29iamVjdCcgPyBjbGFpbXMuZmlyZWJhc2UgOiB1bmRlZmluZWQ7XHJcbiAgICBjb25zdCBzaWduSW5Qcm92aWRlciA9IGZpcmViYXNlID09PSBudWxsIHx8IGZpcmViYXNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaXJlYmFzZVsnc2lnbl9pbl9wcm92aWRlciddO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBjbGFpbXMsXHJcbiAgICAgICAgdG9rZW4sXHJcbiAgICAgICAgYXV0aFRpbWU6IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyhzZWNvbmRzU3RyaW5nVG9NaWxsaXNlY29uZHMoY2xhaW1zLmF1dGhfdGltZSkpLFxyXG4gICAgICAgIGlzc3VlZEF0VGltZTogdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhjbGFpbXMuaWF0KSksXHJcbiAgICAgICAgZXhwaXJhdGlvblRpbWU6IHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyhzZWNvbmRzU3RyaW5nVG9NaWxsaXNlY29uZHMoY2xhaW1zLmV4cCkpLFxyXG4gICAgICAgIHNpZ25JblByb3ZpZGVyOiBzaWduSW5Qcm92aWRlciB8fCBudWxsLFxyXG4gICAgICAgIHNpZ25JblNlY29uZEZhY3RvcjogKGZpcmViYXNlID09PSBudWxsIHx8IGZpcmViYXNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaXJlYmFzZVsnc2lnbl9pbl9zZWNvbmRfZmFjdG9yJ10pIHx8IG51bGxcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKHNlY29uZHMpIHtcclxuICAgIHJldHVybiBOdW1iZXIoc2Vjb25kcykgKiAxMDAwO1xyXG59XHJcbmZ1bmN0aW9uIF9wYXJzZVRva2VuKHRva2VuKSB7XHJcbiAgICBjb25zdCBbYWxnb3JpdGhtLCBwYXlsb2FkLCBzaWduYXR1cmVdID0gdG9rZW4uc3BsaXQoJy4nKTtcclxuICAgIGlmIChhbGdvcml0aG0gPT09IHVuZGVmaW5lZCB8fFxyXG4gICAgICAgIHBheWxvYWQgPT09IHVuZGVmaW5lZCB8fFxyXG4gICAgICAgIHNpZ25hdHVyZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgX2xvZ0Vycm9yKCdKV1QgbWFsZm9ybWVkLCBjb250YWluZWQgZmV3ZXIgdGhhbiAzIHNlY3Rpb25zJyk7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRlY29kZWQgPSBiYXNlNjREZWNvZGUocGF5bG9hZCk7XHJcbiAgICAgICAgaWYgKCFkZWNvZGVkKSB7XHJcbiAgICAgICAgICAgIF9sb2dFcnJvcignRmFpbGVkIHRvIGRlY29kZSBiYXNlNjQgSldUIHBheWxvYWQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGRlY29kZWQpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBfbG9nRXJyb3IoJ0NhdWdodCBlcnJvciBwYXJzaW5nIEpXVCBwYXlsb2FkIGFzIEpTT04nLCBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEV4dHJhY3QgZXhwaXJlc0luIFRUTCBmcm9tIGEgdG9rZW4gYnkgc3VidHJhY3RpbmcgdGhlIGV4cGlyYXRpb24gZnJvbSB0aGUgaXNzdWFuY2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBfdG9rZW5FeHBpcmVzSW4odG9rZW4pIHtcclxuICAgIGNvbnN0IHBhcnNlZFRva2VuID0gX3BhcnNlVG9rZW4odG9rZW4pO1xyXG4gICAgX2Fzc2VydChwYXJzZWRUb2tlbiwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgX2Fzc2VydCh0eXBlb2YgcGFyc2VkVG9rZW4uZXhwICE9PSAndW5kZWZpbmVkJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgX2Fzc2VydCh0eXBlb2YgcGFyc2VkVG9rZW4uaWF0ICE9PSAndW5kZWZpbmVkJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgcmV0dXJuIE51bWJlcihwYXJzZWRUb2tlbi5leHApIC0gTnVtYmVyKHBhcnNlZFRva2VuLmlhdCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgcHJvbWlzZSwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHtcclxuICAgIGlmIChieXBhc3NBdXRoU3RhdGUpIHtcclxuICAgICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgIH1cclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHByb21pc2U7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvciAmJiBpc1VzZXJJbnZhbGlkYXRlZChlKSkge1xyXG4gICAgICAgICAgICBpZiAodXNlci5hdXRoLmN1cnJlbnRVc2VyID09PSB1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB1c2VyLmF1dGguc2lnbk91dCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gaXNVc2VySW52YWxpZGF0ZWQoeyBjb2RlIH0pIHtcclxuICAgIHJldHVybiAoY29kZSA9PT0gYGF1dGgvJHtcInVzZXItZGlzYWJsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfRElTQUJMRUQgKi99YCB8fFxyXG4gICAgICAgIGNvZGUgPT09IGBhdXRoLyR7XCJ1c2VyLXRva2VuLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi99YCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgUHJvYWN0aXZlUmVmcmVzaCB7XHJcbiAgICBjb25zdHJ1Y3Rvcih1c2VyKSB7XHJcbiAgICAgICAgdGhpcy51c2VyID0gdXNlcjtcclxuICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgIC8vIE5vZGUgdGltZXJzIGFuZCBicm93c2VyIHRpbWVycyByZXR1cm4gZnVuZGFtZW50YWxseSBkaWZmZXJlbnQgdHlwZXMuXHJcbiAgICAgICAgLy8gV2UgZG9uJ3QgYWN0dWFsbHkgY2FyZSB3aGF0IHRoZSB2YWx1ZSBpcyBidXQgVFMgd29uJ3QgYWNjZXB0IHVua25vd24gYW5kXHJcbiAgICAgICAgLy8gd2UgY2FuJ3QgY2FzdCBwcm9wZXJseSBpbiBib3RoIGVudmlyb25tZW50cy5cclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgIHRoaXMudGltZXJJZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5lcnJvckJhY2tvZmYgPSAzMDAwMCAvKiBEdXJhdGlvbi5SRVRSWV9CQUNLT0ZGX01JTiAqLztcclxuICAgIH1cclxuICAgIF9zdGFydCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzUnVubmluZyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZSgpO1xyXG4gICAgfVxyXG4gICAgX3N0b3AoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUnVubmluZykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNSdW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZXJJZCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBnZXRJbnRlcnZhbCh3YXNFcnJvcikge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBpZiAod2FzRXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSB0aGlzLmVycm9yQmFja29mZjtcclxuICAgICAgICAgICAgdGhpcy5lcnJvckJhY2tvZmYgPSBNYXRoLm1pbih0aGlzLmVycm9yQmFja29mZiAqIDIsIDk2MDAwMCAvKiBEdXJhdGlvbi5SRVRSWV9CQUNLT0ZGX01BWCAqLyk7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnRlcnZhbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBlcnJvciBiYWNrb2ZmXHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gMzAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NSU4gKi87XHJcbiAgICAgICAgICAgIGNvbnN0IGV4cFRpbWUgPSAoX2EgPSB0aGlzLnVzZXIuc3RzVG9rZW5NYW5hZ2VyLmV4cGlyYXRpb25UaW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAwO1xyXG4gICAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IGV4cFRpbWUgLSBEYXRlLm5vdygpIC0gMzAwMDAwIC8qIER1cmF0aW9uLk9GRlNFVCAqLztcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIGludGVydmFsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzY2hlZHVsZSh3YXNFcnJvciA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzUnVubmluZykge1xyXG4gICAgICAgICAgICAvLyBKdXN0IGluIGNhc2UuLi5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHRoaXMuZ2V0SW50ZXJ2YWwod2FzRXJyb3IpO1xyXG4gICAgICAgIHRoaXMudGltZXJJZCA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLml0ZXJhdGlvbigpO1xyXG4gICAgICAgIH0sIGludGVydmFsKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGl0ZXJhdGlvbigpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbih0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gT25seSByZXRyeSBvbiBuZXR3b3JrIGVycm9yc1xyXG4gICAgICAgICAgICBpZiAoKGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5jb2RlKSA9PT1cclxuICAgICAgICAgICAgICAgIGBhdXRoLyR7XCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovfWApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGUoLyogd2FzRXJyb3IgKi8gdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNjaGVkdWxlKCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgVXNlck1ldGFkYXRhIHtcclxuICAgIGNvbnN0cnVjdG9yKGNyZWF0ZWRBdCwgbGFzdExvZ2luQXQpIHtcclxuICAgICAgICB0aGlzLmNyZWF0ZWRBdCA9IGNyZWF0ZWRBdDtcclxuICAgICAgICB0aGlzLmxhc3RMb2dpbkF0ID0gbGFzdExvZ2luQXQ7XHJcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZVRpbWUoKTtcclxuICAgIH1cclxuICAgIF9pbml0aWFsaXplVGltZSgpIHtcclxuICAgICAgICB0aGlzLmxhc3RTaWduSW5UaW1lID0gdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHRoaXMubGFzdExvZ2luQXQpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRpb25UaW1lID0gdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHRoaXMuY3JlYXRlZEF0KTtcclxuICAgIH1cclxuICAgIF9jb3B5KG1ldGFkYXRhKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVkQXQgPSBtZXRhZGF0YS5jcmVhdGVkQXQ7XHJcbiAgICAgICAgdGhpcy5sYXN0TG9naW5BdCA9IG1ldGFkYXRhLmxhc3RMb2dpbkF0O1xyXG4gICAgICAgIHRoaXMuX2luaXRpYWxpemVUaW1lKCk7XHJcbiAgICB9XHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlZEF0OiB0aGlzLmNyZWF0ZWRBdCxcclxuICAgICAgICAgICAgbGFzdExvZ2luQXQ6IHRoaXMubGFzdExvZ2luQXRcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXIpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IGF1dGggPSB1c2VyLmF1dGg7XHJcbiAgICBjb25zdCBpZFRva2VuID0gYXdhaXQgdXNlci5nZXRJZFRva2VuKCk7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIGdldEFjY291bnRJbmZvKGF1dGgsIHsgaWRUb2tlbiB9KSk7XHJcbiAgICBfYXNzZXJ0KHJlc3BvbnNlID09PSBudWxsIHx8IHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZXNwb25zZS51c2Vycy5sZW5ndGgsIGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIGNvbnN0IGNvcmVBY2NvdW50ID0gcmVzcG9uc2UudXNlcnNbMF07XHJcbiAgICB1c2VyLl9ub3RpZnlSZWxvYWRMaXN0ZW5lcihjb3JlQWNjb3VudCk7XHJcbiAgICBjb25zdCBuZXdQcm92aWRlckRhdGEgPSAoKF9hID0gY29yZUFjY291bnQucHJvdmlkZXJVc2VySW5mbykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmxlbmd0aClcclxuICAgICAgICA/IGV4dHJhY3RQcm92aWRlckRhdGEoY29yZUFjY291bnQucHJvdmlkZXJVc2VySW5mbylcclxuICAgICAgICA6IFtdO1xyXG4gICAgY29uc3QgcHJvdmlkZXJEYXRhID0gbWVyZ2VQcm92aWRlckRhdGEodXNlci5wcm92aWRlckRhdGEsIG5ld1Byb3ZpZGVyRGF0YSk7XHJcbiAgICAvLyBQcmVzZXJ2ZXMgdGhlIG5vbi1ub255bW91cyBzdGF0dXMgb2YgdGhlIHN0b3JlZCB1c2VyLCBldmVuIGlmIG5vIG1vcmVcclxuICAgIC8vIGNyZWRlbnRpYWxzIChmZWRlcmF0ZWQgb3IgZW1haWwvcGFzc3dvcmQpIGFyZSBsaW5rZWQgdG8gdGhlIHVzZXIuIElmXHJcbiAgICAvLyB0aGUgdXNlciB3YXMgcHJldmlvdXNseSBhbm9ueW1vdXMsIHRoZW4gdXNlIHByb3ZpZGVyIGRhdGEgdG8gdXBkYXRlLlxyXG4gICAgLy8gT24gdGhlIG90aGVyIGhhbmQsIGlmIGl0IHdhcyBub3QgYW5vbnltb3VzIGJlZm9yZSwgaXQgc2hvdWxkIG5ldmVyIGJlXHJcbiAgICAvLyBjb25zaWRlcmVkIGFub255bW91cyBub3cuXHJcbiAgICBjb25zdCBvbGRJc0Fub255bW91cyA9IHVzZXIuaXNBbm9ueW1vdXM7XHJcbiAgICBjb25zdCBuZXdJc0Fub255bW91cyA9ICEodXNlci5lbWFpbCAmJiBjb3JlQWNjb3VudC5wYXNzd29yZEhhc2gpICYmICEocHJvdmlkZXJEYXRhID09PSBudWxsIHx8IHByb3ZpZGVyRGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvdmlkZXJEYXRhLmxlbmd0aCk7XHJcbiAgICBjb25zdCBpc0Fub255bW91cyA9ICFvbGRJc0Fub255bW91cyA/IGZhbHNlIDogbmV3SXNBbm9ueW1vdXM7XHJcbiAgICBjb25zdCB1cGRhdGVzID0ge1xyXG4gICAgICAgIHVpZDogY29yZUFjY291bnQubG9jYWxJZCxcclxuICAgICAgICBkaXNwbGF5TmFtZTogY29yZUFjY291bnQuZGlzcGxheU5hbWUgfHwgbnVsbCxcclxuICAgICAgICBwaG90b1VSTDogY29yZUFjY291bnQucGhvdG9VcmwgfHwgbnVsbCxcclxuICAgICAgICBlbWFpbDogY29yZUFjY291bnQuZW1haWwgfHwgbnVsbCxcclxuICAgICAgICBlbWFpbFZlcmlmaWVkOiBjb3JlQWNjb3VudC5lbWFpbFZlcmlmaWVkIHx8IGZhbHNlLFxyXG4gICAgICAgIHBob25lTnVtYmVyOiBjb3JlQWNjb3VudC5waG9uZU51bWJlciB8fCBudWxsLFxyXG4gICAgICAgIHRlbmFudElkOiBjb3JlQWNjb3VudC50ZW5hbnRJZCB8fCBudWxsLFxyXG4gICAgICAgIHByb3ZpZGVyRGF0YSxcclxuICAgICAgICBtZXRhZGF0YTogbmV3IFVzZXJNZXRhZGF0YShjb3JlQWNjb3VudC5jcmVhdGVkQXQsIGNvcmVBY2NvdW50Lmxhc3RMb2dpbkF0KSxcclxuICAgICAgICBpc0Fub255bW91c1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5hc3NpZ24odXNlciwgdXBkYXRlcyk7XHJcbn1cclxuLyoqXHJcbiAqIFJlbG9hZHMgdXNlciBhY2NvdW50IGRhdGEsIGlmIHNpZ25lZCBpbi5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcmVsb2FkKHVzZXIpIHtcclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXJJbnRlcm5hbCk7XHJcbiAgICAvLyBFdmVuIHRob3VnaCB0aGUgY3VycmVudCB1c2VyIGhhc24ndCBjaGFuZ2VkLCB1cGRhdGVcclxuICAgIC8vIGN1cnJlbnQgdXNlciB3aWxsIHRyaWdnZXIgYSBwZXJzaXN0ZW5jZSB1cGRhdGUgdy8gdGhlXHJcbiAgICAvLyBuZXcgaW5mby5cclxuICAgIGF3YWl0IHVzZXJJbnRlcm5hbC5hdXRoLl9wZXJzaXN0VXNlcklmQ3VycmVudCh1c2VySW50ZXJuYWwpO1xyXG4gICAgdXNlckludGVybmFsLmF1dGguX25vdGlmeUxpc3RlbmVyc0lmQ3VycmVudCh1c2VySW50ZXJuYWwpO1xyXG59XHJcbmZ1bmN0aW9uIG1lcmdlUHJvdmlkZXJEYXRhKG9yaWdpbmFsLCBuZXdEYXRhKSB7XHJcbiAgICBjb25zdCBkZWR1cGVkID0gb3JpZ2luYWwuZmlsdGVyKG8gPT4gIW5ld0RhdGEuc29tZShuID0+IG4ucHJvdmlkZXJJZCA9PT0gby5wcm92aWRlcklkKSk7XHJcbiAgICByZXR1cm4gWy4uLmRlZHVwZWQsIC4uLm5ld0RhdGFdO1xyXG59XHJcbmZ1bmN0aW9uIGV4dHJhY3RQcm92aWRlckRhdGEocHJvdmlkZXJzKSB7XHJcbiAgICByZXR1cm4gcHJvdmlkZXJzLm1hcCgoX2EpID0+IHtcclxuICAgICAgICB2YXIgeyBwcm92aWRlcklkIH0gPSBfYSwgcHJvdmlkZXIgPSBfX3Jlc3QoX2EsIFtcInByb3ZpZGVySWRcIl0pO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQsXHJcbiAgICAgICAgICAgIHVpZDogcHJvdmlkZXIucmF3SWQgfHwgJycsXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBwcm92aWRlci5kaXNwbGF5TmFtZSB8fCBudWxsLFxyXG4gICAgICAgICAgICBlbWFpbDogcHJvdmlkZXIuZW1haWwgfHwgbnVsbCxcclxuICAgICAgICAgICAgcGhvbmVOdW1iZXI6IHByb3ZpZGVyLnBob25lTnVtYmVyIHx8IG51bGwsXHJcbiAgICAgICAgICAgIHBob3RvVVJMOiBwcm92aWRlci5waG90b1VybCB8fCBudWxsXHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3RTdHNUb2tlbihhdXRoLCByZWZyZXNoVG9rZW4pIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIHt9LCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYm9keSA9IHF1ZXJ5c3RyaW5nKHtcclxuICAgICAgICAgICAgJ2dyYW50X3R5cGUnOiAncmVmcmVzaF90b2tlbicsXHJcbiAgICAgICAgICAgICdyZWZyZXNoX3Rva2VuJzogcmVmcmVzaFRva2VuXHJcbiAgICAgICAgfSkuc2xpY2UoMSk7XHJcbiAgICAgICAgY29uc3QgeyB0b2tlbkFwaUhvc3QsIGFwaUtleSB9ID0gYXV0aC5jb25maWc7XHJcbiAgICAgICAgY29uc3QgdXJsID0gX2dldEZpbmFsVGFyZ2V0KGF1dGgsIHRva2VuQXBpSG9zdCwgXCIvdjEvdG9rZW5cIiAvKiBFbmRwb2ludC5UT0tFTiAqLywgYGtleT0ke2FwaUtleX1gKTtcclxuICAgICAgICBjb25zdCBoZWFkZXJzID0gYXdhaXQgYXV0aC5fZ2V0QWRkaXRpb25hbEhlYWRlcnMoKTtcclxuICAgICAgICBoZWFkZXJzW1wiQ29udGVudC1UeXBlXCIgLyogSHR0cEhlYWRlci5DT05URU5UX1RZUEUgKi9dID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XHJcbiAgICAgICAgcmV0dXJuIEZldGNoUHJvdmlkZXIuZmV0Y2goKSh1cmwsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sXHJcbiAgICAgICAgICAgIGhlYWRlcnMsXHJcbiAgICAgICAgICAgIGJvZHlcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgLy8gVGhlIHJlc3BvbnNlIGNvbWVzIGJhY2sgaW4gc25ha2VfY2FzZS4gQ29udmVydCB0byBjYW1lbDpcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgYWNjZXNzVG9rZW46IHJlc3BvbnNlLmFjY2Vzc190b2tlbixcclxuICAgICAgICBleHBpcmVzSW46IHJlc3BvbnNlLmV4cGlyZXNfaW4sXHJcbiAgICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5yZWZyZXNoX3Rva2VuXHJcbiAgICB9O1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBXZSBuZWVkIHRvIG1hcmsgdGhpcyBjbGFzcyBhcyBpbnRlcm5hbCBleHBsaWNpdGx5IHRvIGV4Y2x1ZGUgaXQgaW4gdGhlIHB1YmxpYyB0eXBpbmdzLCBiZWNhdXNlXHJcbiAqIGl0IHJlZmVyZW5jZXMgQXV0aEludGVybmFsIHdoaWNoIGhhcyBhIGNpcmN1bGFyIGRlcGVuZGVuY3kgd2l0aCBVc2VySW50ZXJuYWwuXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY2xhc3MgU3RzVG9rZW5NYW5hZ2VyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gbnVsbDtcclxuICAgICAgICB0aGlzLmV4cGlyYXRpb25UaW1lID0gbnVsbDtcclxuICAgIH1cclxuICAgIGdldCBpc0V4cGlyZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuICghdGhpcy5leHBpcmF0aW9uVGltZSB8fFxyXG4gICAgICAgICAgICBEYXRlLm5vdygpID4gdGhpcy5leHBpcmF0aW9uVGltZSAtIDMwMDAwIC8qIEJ1ZmZlci5UT0tFTl9SRUZSRVNIICovKTtcclxuICAgIH1cclxuICAgIHVwZGF0ZUZyb21TZXJ2ZXJSZXNwb25zZShyZXNwb25zZSkge1xyXG4gICAgICAgIF9hc3NlcnQocmVzcG9uc2UuaWRUb2tlbiwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIF9hc3NlcnQodHlwZW9mIHJlc3BvbnNlLmlkVG9rZW4gIT09ICd1bmRlZmluZWQnLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgcmVzcG9uc2UucmVmcmVzaFRva2VuICE9PSAndW5kZWZpbmVkJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IGV4cGlyZXNJbiA9ICdleHBpcmVzSW4nIGluIHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZS5leHBpcmVzSW4gIT09ICd1bmRlZmluZWQnXHJcbiAgICAgICAgICAgID8gTnVtYmVyKHJlc3BvbnNlLmV4cGlyZXNJbilcclxuICAgICAgICAgICAgOiBfdG9rZW5FeHBpcmVzSW4ocmVzcG9uc2UuaWRUb2tlbik7XHJcbiAgICAgICAgdGhpcy51cGRhdGVUb2tlbnNBbmRFeHBpcmF0aW9uKHJlc3BvbnNlLmlkVG9rZW4sIHJlc3BvbnNlLnJlZnJlc2hUb2tlbiwgZXhwaXJlc0luKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldFRva2VuKGF1dGgsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7XHJcbiAgICAgICAgX2Fzc2VydCghdGhpcy5hY2Nlc3NUb2tlbiB8fCB0aGlzLnJlZnJlc2hUb2tlbiwgYXV0aCwgXCJ1c2VyLXRva2VuLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi8pO1xyXG4gICAgICAgIGlmICghZm9yY2VSZWZyZXNoICYmIHRoaXMuYWNjZXNzVG9rZW4gJiYgIXRoaXMuaXNFeHBpcmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5yZWZyZXNoVG9rZW4pIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWZyZXNoKGF1dGgsIHRoaXMucmVmcmVzaFRva2VuKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNjZXNzVG9rZW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY2xlYXJSZWZyZXNoVG9rZW4oKSB7XHJcbiAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgcmVmcmVzaChhdXRoLCBvbGRUb2tlbikge1xyXG4gICAgICAgIGNvbnN0IHsgYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgZXhwaXJlc0luIH0gPSBhd2FpdCByZXF1ZXN0U3RzVG9rZW4oYXV0aCwgb2xkVG9rZW4pO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVG9rZW5zQW5kRXhwaXJhdGlvbihhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuLCBOdW1iZXIoZXhwaXJlc0luKSk7XHJcbiAgICB9XHJcbiAgICB1cGRhdGVUb2tlbnNBbmRFeHBpcmF0aW9uKGFjY2Vzc1Rva2VuLCByZWZyZXNoVG9rZW4sIGV4cGlyZXNJblNlYykge1xyXG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gcmVmcmVzaFRva2VuIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IGFjY2Vzc1Rva2VuIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IERhdGUubm93KCkgKyBleHBpcmVzSW5TZWMgKiAxMDAwO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGZyb21KU09OKGFwcE5hbWUsIG9iamVjdCkge1xyXG4gICAgICAgIGNvbnN0IHsgcmVmcmVzaFRva2VuLCBhY2Nlc3NUb2tlbiwgZXhwaXJhdGlvblRpbWUgfSA9IG9iamVjdDtcclxuICAgICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IFN0c1Rva2VuTWFuYWdlcigpO1xyXG4gICAgICAgIGlmIChyZWZyZXNoVG9rZW4pIHtcclxuICAgICAgICAgICAgX2Fzc2VydCh0eXBlb2YgcmVmcmVzaFRva2VuID09PSAnc3RyaW5nJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sIHtcclxuICAgICAgICAgICAgICAgIGFwcE5hbWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1hbmFnZXIucmVmcmVzaFRva2VuID0gcmVmcmVzaFRva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgX2Fzc2VydCh0eXBlb2YgYWNjZXNzVG9rZW4gPT09ICdzdHJpbmcnLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywge1xyXG4gICAgICAgICAgICAgICAgYXBwTmFtZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbWFuYWdlci5hY2Nlc3NUb2tlbiA9IGFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZXhwaXJhdGlvblRpbWUpIHtcclxuICAgICAgICAgICAgX2Fzc2VydCh0eXBlb2YgZXhwaXJhdGlvblRpbWUgPT09ICdudW1iZXInLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywge1xyXG4gICAgICAgICAgICAgICAgYXBwTmFtZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbWFuYWdlci5leHBpcmF0aW9uVGltZSA9IGV4cGlyYXRpb25UaW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbWFuYWdlcjtcclxuICAgIH1cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IHRoaXMucmVmcmVzaFRva2VuLFxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgZXhwaXJhdGlvblRpbWU6IHRoaXMuZXhwaXJhdGlvblRpbWVcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgX2Fzc2lnbihzdHNUb2tlbk1hbmFnZXIpIHtcclxuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gc3RzVG9rZW5NYW5hZ2VyLnJlZnJlc2hUb2tlbjtcclxuICAgICAgICB0aGlzLmV4cGlyYXRpb25UaW1lID0gc3RzVG9rZW5NYW5hZ2VyLmV4cGlyYXRpb25UaW1lO1xyXG4gICAgfVxyXG4gICAgX2Nsb25lKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBTdHNUb2tlbk1hbmFnZXIoKSwgdGhpcy50b0pTT04oKSk7XHJcbiAgICB9XHJcbiAgICBfcGVyZm9ybVJlZnJlc2goKSB7XHJcbiAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgnbm90IGltcGxlbWVudGVkJyk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoYXNzZXJ0aW9uLCBhcHBOYW1lKSB7XHJcbiAgICBfYXNzZXJ0KHR5cGVvZiBhc3NlcnRpb24gPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBhc3NlcnRpb24gPT09ICd1bmRlZmluZWQnLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywgeyBhcHBOYW1lIH0pO1xyXG59XHJcbmNsYXNzIFVzZXJJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKF9hKSB7XHJcbiAgICAgICAgdmFyIHsgdWlkLCBhdXRoLCBzdHNUb2tlbk1hbmFnZXIgfSA9IF9hLCBvcHQgPSBfX3Jlc3QoX2EsIFtcInVpZFwiLCBcImF1dGhcIiwgXCJzdHNUb2tlbk1hbmFnZXJcIl0pO1xyXG4gICAgICAgIC8vIEZvciB0aGUgdXNlciBvYmplY3QsIHByb3ZpZGVyIGlzIGFsd2F5cyBGaXJlYmFzZS5cclxuICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSBcImZpcmViYXNlXCIgLyogUHJvdmlkZXJJZC5GSVJFQkFTRSAqLztcclxuICAgICAgICB0aGlzLnByb2FjdGl2ZVJlZnJlc2ggPSBuZXcgUHJvYWN0aXZlUmVmcmVzaCh0aGlzKTtcclxuICAgICAgICB0aGlzLnJlbG9hZFVzZXJJbmZvID0gbnVsbDtcclxuICAgICAgICB0aGlzLnJlbG9hZExpc3RlbmVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnVpZCA9IHVpZDtcclxuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xyXG4gICAgICAgIHRoaXMuc3RzVG9rZW5NYW5hZ2VyID0gc3RzVG9rZW5NYW5hZ2VyO1xyXG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBzdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW47XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IG9wdC5kaXNwbGF5TmFtZSB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuZW1haWwgPSBvcHQuZW1haWwgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmVtYWlsVmVyaWZpZWQgPSBvcHQuZW1haWxWZXJpZmllZCB8fCBmYWxzZTtcclxuICAgICAgICB0aGlzLnBob25lTnVtYmVyID0gb3B0LnBob25lTnVtYmVyIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5waG90b1VSTCA9IG9wdC5waG90b1VSTCB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNBbm9ueW1vdXMgPSBvcHQuaXNBbm9ueW1vdXMgfHwgZmFsc2U7XHJcbiAgICAgICAgdGhpcy50ZW5hbnRJZCA9IG9wdC50ZW5hbnRJZCB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJEYXRhID0gb3B0LnByb3ZpZGVyRGF0YSA/IFsuLi5vcHQucHJvdmlkZXJEYXRhXSA6IFtdO1xyXG4gICAgICAgIHRoaXMubWV0YWRhdGEgPSBuZXcgVXNlck1ldGFkYXRhKG9wdC5jcmVhdGVkQXQgfHwgdW5kZWZpbmVkLCBvcHQubGFzdExvZ2luQXQgfHwgdW5kZWZpbmVkKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldElkVG9rZW4oZm9yY2VSZWZyZXNoKSB7XHJcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLCB0aGlzLnN0c1Rva2VuTWFuYWdlci5nZXRUb2tlbih0aGlzLmF1dGgsIGZvcmNlUmVmcmVzaCkpO1xyXG4gICAgICAgIF9hc3NlcnQoYWNjZXNzVG9rZW4sIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuICE9PSBhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXV0aC5fcGVyc2lzdFVzZXJJZkN1cnJlbnQodGhpcyk7XHJcbiAgICAgICAgICAgIHRoaXMuYXV0aC5fbm90aWZ5TGlzdGVuZXJzSWZDdXJyZW50KHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYWNjZXNzVG9rZW47XHJcbiAgICB9XHJcbiAgICBnZXRJZFRva2VuUmVzdWx0KGZvcmNlUmVmcmVzaCkge1xyXG4gICAgICAgIHJldHVybiBnZXRJZFRva2VuUmVzdWx0KHRoaXMsIGZvcmNlUmVmcmVzaCk7XHJcbiAgICB9XHJcbiAgICByZWxvYWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlbG9hZCh0aGlzKTtcclxuICAgIH1cclxuICAgIF9hc3NpZ24odXNlcikge1xyXG4gICAgICAgIGlmICh0aGlzID09PSB1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgX2Fzc2VydCh0aGlzLnVpZCA9PT0gdXNlci51aWQsIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSB1c2VyLmRpc3BsYXlOYW1lO1xyXG4gICAgICAgIHRoaXMucGhvdG9VUkwgPSB1c2VyLnBob3RvVVJMO1xyXG4gICAgICAgIHRoaXMuZW1haWwgPSB1c2VyLmVtYWlsO1xyXG4gICAgICAgIHRoaXMuZW1haWxWZXJpZmllZCA9IHVzZXIuZW1haWxWZXJpZmllZDtcclxuICAgICAgICB0aGlzLnBob25lTnVtYmVyID0gdXNlci5waG9uZU51bWJlcjtcclxuICAgICAgICB0aGlzLmlzQW5vbnltb3VzID0gdXNlci5pc0Fub255bW91cztcclxuICAgICAgICB0aGlzLnRlbmFudElkID0gdXNlci50ZW5hbnRJZDtcclxuICAgICAgICB0aGlzLnByb3ZpZGVyRGF0YSA9IHVzZXIucHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSk7XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YS5fY29weSh1c2VyLm1ldGFkYXRhKTtcclxuICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci5fYXNzaWduKHVzZXIuc3RzVG9rZW5NYW5hZ2VyKTtcclxuICAgIH1cclxuICAgIF9jbG9uZShhdXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBVc2VySW1wbChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHRoaXMpLCB7IGF1dGgsIHN0c1Rva2VuTWFuYWdlcjogdGhpcy5zdHNUb2tlbk1hbmFnZXIuX2Nsb25lKCkgfSkpO1xyXG4gICAgfVxyXG4gICAgX29uUmVsb2FkKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgbGlzdGVuZXIsIGFuZCB0aGF0IGlzIGEgc2luZ2xlIGluc3RhbmNlIG9mIE11bHRpRmFjdG9yVXNlclxyXG4gICAgICAgIF9hc3NlcnQoIXRoaXMucmVsb2FkTGlzdGVuZXIsIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIHRoaXMucmVsb2FkTGlzdGVuZXIgPSBjYWxsYmFjaztcclxuICAgICAgICBpZiAodGhpcy5yZWxvYWRVc2VySW5mbykge1xyXG4gICAgICAgICAgICB0aGlzLl9ub3RpZnlSZWxvYWRMaXN0ZW5lcih0aGlzLnJlbG9hZFVzZXJJbmZvKTtcclxuICAgICAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX25vdGlmeVJlbG9hZExpc3RlbmVyKHVzZXJJbmZvKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVsb2FkTGlzdGVuZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lcih1c2VySW5mbyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBJZiBubyBsaXN0ZW5lciBpcyBzdWJzY3JpYmVkIHlldCwgc2F2ZSB0aGUgcmVzdWx0IHNvIGl0J3MgYXZhaWxhYmxlIHdoZW4gdGhleSBkbyBzdWJzY3JpYmVcclxuICAgICAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IHVzZXJJbmZvO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIF9zdGFydFByb2FjdGl2ZVJlZnJlc2goKSB7XHJcbiAgICAgICAgdGhpcy5wcm9hY3RpdmVSZWZyZXNoLl9zdGFydCgpO1xyXG4gICAgfVxyXG4gICAgX3N0b3BQcm9hY3RpdmVSZWZyZXNoKCkge1xyXG4gICAgICAgIHRoaXMucHJvYWN0aXZlUmVmcmVzaC5fc3RvcCgpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3VwZGF0ZVRva2Vuc0lmTmVjZXNzYXJ5KHJlc3BvbnNlLCByZWxvYWQgPSBmYWxzZSkge1xyXG4gICAgICAgIGxldCB0b2tlbnNSZWZyZXNoZWQgPSBmYWxzZTtcclxuICAgICAgICBpZiAocmVzcG9uc2UuaWRUb2tlbiAmJlxyXG4gICAgICAgICAgICByZXNwb25zZS5pZFRva2VuICE9PSB0aGlzLnN0c1Rva2VuTWFuYWdlci5hY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB0b2tlbnNSZWZyZXNoZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVsb2FkKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpO1xyXG4gICAgICAgIGlmICh0b2tlbnNSZWZyZXNoZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRoLl9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXN5bmMgZGVsZXRlKCkge1xyXG4gICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLmdldElkVG9rZW4oKTtcclxuICAgICAgICBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLCBkZWxldGVBY2NvdW50KHRoaXMuYXV0aCwgeyBpZFRva2VuIH0pKTtcclxuICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci5jbGVhclJlZnJlc2hUb2tlbigpO1xyXG4gICAgICAgIC8vIFRPRE86IERldGVybWluZSBpZiBjYW5jZWxsYWJsZS1wcm9taXNlcyBhcmUgbmVjZXNzYXJ5IHRvIHVzZSBpbiB0aGlzIGNsYXNzIHNvIHRoYXQgZGVsZXRlKClcclxuICAgICAgICAvLyAgICAgICBjYW5jZWxzIHBlbmRpbmcgYWN0aW9ucy4uLlxyXG4gICAgICAgIHJldHVybiB0aGlzLmF1dGguc2lnbk91dCgpO1xyXG4gICAgfVxyXG4gICAgdG9KU09OKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oeyB1aWQ6IHRoaXMudWlkLCBlbWFpbDogdGhpcy5lbWFpbCB8fCB1bmRlZmluZWQsIGVtYWlsVmVyaWZpZWQ6IHRoaXMuZW1haWxWZXJpZmllZCwgZGlzcGxheU5hbWU6IHRoaXMuZGlzcGxheU5hbWUgfHwgdW5kZWZpbmVkLCBpc0Fub255bW91czogdGhpcy5pc0Fub255bW91cywgcGhvdG9VUkw6IHRoaXMucGhvdG9VUkwgfHwgdW5kZWZpbmVkLCBwaG9uZU51bWJlcjogdGhpcy5waG9uZU51bWJlciB8fCB1bmRlZmluZWQsIHRlbmFudElkOiB0aGlzLnRlbmFudElkIHx8IHVuZGVmaW5lZCwgcHJvdmlkZXJEYXRhOiB0aGlzLnByb3ZpZGVyRGF0YS5tYXAodXNlckluZm8gPT4gKE9iamVjdC5hc3NpZ24oe30sIHVzZXJJbmZvKSkpLCBzdHNUb2tlbk1hbmFnZXI6IHRoaXMuc3RzVG9rZW5NYW5hZ2VyLnRvSlNPTigpLCBcclxuICAgICAgICAgICAgLy8gUmVkaXJlY3QgZXZlbnQgSUQgbXVzdCBiZSBtYWludGFpbmVkIGluIGNhc2UgdGhlcmUgaXMgYSBwZW5kaW5nXHJcbiAgICAgICAgICAgIC8vIHJlZGlyZWN0IGV2ZW50LlxyXG4gICAgICAgICAgICBfcmVkaXJlY3RFdmVudElkOiB0aGlzLl9yZWRpcmVjdEV2ZW50SWQgfSwgdGhpcy5tZXRhZGF0YS50b0pTT04oKSksIHsgXHJcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBjb21wYXRpYmlsaXR5IHdpdGggdGhlIGxlZ2FjeSBTREsgKGdvL2ZpcmViYXNlLWF1dGgtc2RrLXBlcnNpc3RlbmNlLXBhcnNpbmcpOlxyXG4gICAgICAgICAgICBhcGlLZXk6IHRoaXMuYXV0aC5jb25maWcuYXBpS2V5LCBhcHBOYW1lOiB0aGlzLmF1dGgubmFtZSB9KTtcclxuICAgIH1cclxuICAgIGdldCByZWZyZXNoVG9rZW4oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLnJlZnJlc2hUb2tlbiB8fCAnJztcclxuICAgIH1cclxuICAgIHN0YXRpYyBfZnJvbUpTT04oYXV0aCwgb2JqZWN0KSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaDtcclxuICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IChfYSA9IG9iamVjdC5kaXNwbGF5TmFtZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IGVtYWlsID0gKF9iID0gb2JqZWN0LmVtYWlsKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgcGhvbmVOdW1iZXIgPSAoX2MgPSBvYmplY3QucGhvbmVOdW1iZXIpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IHVuZGVmaW5lZDtcclxuICAgICAgICBjb25zdCBwaG90b1VSTCA9IChfZCA9IG9iamVjdC5waG90b1VSTCkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IHRlbmFudElkID0gKF9lID0gb2JqZWN0LnRlbmFudElkKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgX3JlZGlyZWN0RXZlbnRJZCA9IChfZiA9IG9iamVjdC5fcmVkaXJlY3RFdmVudElkKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgY3JlYXRlZEF0ID0gKF9nID0gb2JqZWN0LmNyZWF0ZWRBdCkgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGNvbnN0IGxhc3RMb2dpbkF0ID0gKF9oID0gb2JqZWN0Lmxhc3RMb2dpbkF0KSAhPT0gbnVsbCAmJiBfaCAhPT0gdm9pZCAwID8gX2ggOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgY29uc3QgeyB1aWQsIGVtYWlsVmVyaWZpZWQsIGlzQW5vbnltb3VzLCBwcm92aWRlckRhdGEsIHN0c1Rva2VuTWFuYWdlcjogcGxhaW5PYmplY3RUb2tlbk1hbmFnZXIgfSA9IG9iamVjdDtcclxuICAgICAgICBfYXNzZXJ0KHVpZCAmJiBwbGFpbk9iamVjdFRva2VuTWFuYWdlciwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IFN0c1Rva2VuTWFuYWdlci5mcm9tSlNPTih0aGlzLm5hbWUsIHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyKTtcclxuICAgICAgICBfYXNzZXJ0KHR5cGVvZiB1aWQgPT09ICdzdHJpbmcnLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoZGlzcGxheU5hbWUsIGF1dGgubmFtZSk7XHJcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoZW1haWwsIGF1dGgubmFtZSk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgZW1haWxWZXJpZmllZCA9PT0gJ2Jvb2xlYW4nLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgaXNBbm9ueW1vdXMgPT09ICdib29sZWFuJywgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHBob25lTnVtYmVyLCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHBob3RvVVJMLCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHRlbmFudElkLCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKF9yZWRpcmVjdEV2ZW50SWQsIGF1dGgubmFtZSk7XHJcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoY3JlYXRlZEF0LCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGxhc3RMb2dpbkF0LCBhdXRoLm5hbWUpO1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoe1xyXG4gICAgICAgICAgICB1aWQsXHJcbiAgICAgICAgICAgIGF1dGgsXHJcbiAgICAgICAgICAgIGVtYWlsLFxyXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZSxcclxuICAgICAgICAgICAgaXNBbm9ueW1vdXMsXHJcbiAgICAgICAgICAgIHBob3RvVVJMLFxyXG4gICAgICAgICAgICBwaG9uZU51bWJlcixcclxuICAgICAgICAgICAgdGVuYW50SWQsXHJcbiAgICAgICAgICAgIHN0c1Rva2VuTWFuYWdlcixcclxuICAgICAgICAgICAgY3JlYXRlZEF0LFxyXG4gICAgICAgICAgICBsYXN0TG9naW5BdFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChwcm92aWRlckRhdGEgJiYgQXJyYXkuaXNBcnJheShwcm92aWRlckRhdGEpKSB7XHJcbiAgICAgICAgICAgIHVzZXIucHJvdmlkZXJEYXRhID0gcHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfcmVkaXJlY3RFdmVudElkKSB7XHJcbiAgICAgICAgICAgIHVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9IF9yZWRpcmVjdEV2ZW50SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIGEgVXNlciBmcm9tIGFuIGlkVG9rZW4gc2VydmVyIHJlc3BvbnNlXHJcbiAgICAgKiBAcGFyYW0gYXV0aFxyXG4gICAgICogQHBhcmFtIGlkVG9rZW5SZXNwb25zZVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyA9IGZhbHNlKSB7XHJcbiAgICAgICAgY29uc3Qgc3RzVG9rZW5NYW5hZ2VyID0gbmV3IFN0c1Rva2VuTWFuYWdlcigpO1xyXG4gICAgICAgIHN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UoaWRUb2tlblJlc3BvbnNlKTtcclxuICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBGaXJlYmFzZSBBdXRoIHVzZXIuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IG5ldyBVc2VySW1wbCh7XHJcbiAgICAgICAgICAgIHVpZDogaWRUb2tlblJlc3BvbnNlLmxvY2FsSWQsXHJcbiAgICAgICAgICAgIGF1dGgsXHJcbiAgICAgICAgICAgIHN0c1Rva2VuTWFuYWdlcixcclxuICAgICAgICAgICAgaXNBbm9ueW1vdXNcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBVcGRhdGVzIHRoZSB1c2VyIGluZm8gYW5kIGRhdGEgYW5kIHJlc29sdmVzIHdpdGggYSB1c2VyIGluc3RhbmNlLlxyXG4gICAgICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXIpO1xyXG4gICAgICAgIHJldHVybiB1c2VyO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIEluTWVtb3J5UGVyc2lzdGVuY2Uge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy50eXBlID0gXCJOT05FXCIgLyogUGVyc2lzdGVuY2VUeXBlLk5PTkUgKi87XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlID0ge307XHJcbiAgICB9XHJcbiAgICBhc3luYyBfaXNBdmFpbGFibGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfc2V0KGtleSwgdmFsdWUpIHtcclxuICAgICAgICB0aGlzLnN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2dldChrZXkpIHtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuc3RvcmFnZVtrZXldO1xyXG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3JlbW92ZShrZXkpIHtcclxuICAgICAgICBkZWxldGUgdGhpcy5zdG9yYWdlW2tleV07XHJcbiAgICB9XHJcbiAgICBfYWRkTGlzdGVuZXIoX2tleSwgX2xpc3RlbmVyKSB7XHJcbiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBpbi1tZW1vcnkgc3RvcmFnZSBzaW5jZSBpdCBjYW5ub3QgYmUgc2hhcmVkIGFjcm9zcyB3aW5kb3dzL3dvcmtlcnNcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBfcmVtb3ZlTGlzdGVuZXIoX2tleSwgX2xpc3RlbmVyKSB7XHJcbiAgICAgICAgLy8gTGlzdGVuZXJzIGFyZSBub3Qgc3VwcG9ydGVkIGZvciBpbi1tZW1vcnkgc3RvcmFnZSBzaW5jZSBpdCBjYW5ub3QgYmUgc2hhcmVkIGFjcm9zcyB3aW5kb3dzL3dvcmtlcnNcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbn1cclxuSW5NZW1vcnlQZXJzaXN0ZW5jZS50eXBlID0gJ05PTkUnO1xyXG4vKipcclxuICogQW4gaW1wbGVtZW50YXRpb24gb2Yge0BsaW5rIFBlcnNpc3RlbmNlfSBvZiB0eXBlICdOT05FJy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgaW5NZW1vcnlQZXJzaXN0ZW5jZSA9IEluTWVtb3J5UGVyc2lzdGVuY2U7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIF9wZXJzaXN0ZW5jZUtleU5hbWUoa2V5LCBhcGlLZXksIGFwcE5hbWUpIHtcclxuICAgIHJldHVybiBgJHtcImZpcmViYXNlXCIgLyogTmFtZXNwYWNlLlBFUlNJU1RFTkNFICovfToke2tleX06JHthcGlLZXl9OiR7YXBwTmFtZX1gO1xyXG59XHJcbmNsYXNzIFBlcnNpc3RlbmNlVXNlck1hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IocGVyc2lzdGVuY2UsIGF1dGgsIHVzZXJLZXkpIHtcclxuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gcGVyc2lzdGVuY2U7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLnVzZXJLZXkgPSB1c2VyS2V5O1xyXG4gICAgICAgIGNvbnN0IHsgY29uZmlnLCBuYW1lIH0gPSB0aGlzLmF1dGg7XHJcbiAgICAgICAgdGhpcy5mdWxsVXNlcktleSA9IF9wZXJzaXN0ZW5jZUtleU5hbWUodGhpcy51c2VyS2V5LCBjb25maWcuYXBpS2V5LCBuYW1lKTtcclxuICAgICAgICB0aGlzLmZ1bGxQZXJzaXN0ZW5jZUtleSA9IF9wZXJzaXN0ZW5jZUtleU5hbWUoXCJwZXJzaXN0ZW5jZVwiIC8qIEtleU5hbWUuUEVSU0lTVEVOQ0VfVVNFUiAqLywgY29uZmlnLmFwaUtleSwgbmFtZSk7XHJcbiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlciA9IGF1dGguX29uU3RvcmFnZUV2ZW50LmJpbmQoYXV0aCk7XHJcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZS5fYWRkTGlzdGVuZXIodGhpcy5mdWxsVXNlcktleSwgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICBzZXRDdXJyZW50VXNlcih1c2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3NldCh0aGlzLmZ1bGxVc2VyS2V5LCB1c2VyLnRvSlNPTigpKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGdldEN1cnJlbnRVc2VyKCkge1xyXG4gICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLl9nZXQodGhpcy5mdWxsVXNlcktleSk7XHJcbiAgICAgICAgcmV0dXJuIGJsb2IgPyBVc2VySW1wbC5fZnJvbUpTT04odGhpcy5hdXRoLCBibG9iKSA6IG51bGw7XHJcbiAgICB9XHJcbiAgICByZW1vdmVDdXJyZW50VXNlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5fcmVtb3ZlKHRoaXMuZnVsbFVzZXJLZXkpO1xyXG4gICAgfVxyXG4gICAgc2F2ZVBlcnNpc3RlbmNlRm9yUmVkaXJlY3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3NldCh0aGlzLmZ1bGxQZXJzaXN0ZW5jZUtleSwgdGhpcy5wZXJzaXN0ZW5jZS50eXBlKTtcclxuICAgIH1cclxuICAgIGFzeW5jIHNldFBlcnNpc3RlbmNlKG5ld1BlcnNpc3RlbmNlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGVyc2lzdGVuY2UgPT09IG5ld1BlcnNpc3RlbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5yZW1vdmVDdXJyZW50VXNlcigpO1xyXG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBuZXdQZXJzaXN0ZW5jZTtcclxuICAgICAgICBpZiAoY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0Q3VycmVudFVzZXIoY3VycmVudFVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGRlbGV0ZSgpIHtcclxuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlLl9yZW1vdmVMaXN0ZW5lcih0aGlzLmZ1bGxVc2VyS2V5LCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBjcmVhdGUoYXV0aCwgcGVyc2lzdGVuY2VIaWVyYXJjaHksIHVzZXJLZXkgPSBcImF1dGhVc2VyXCIgLyogS2V5TmFtZS5BVVRIX1VTRVIgKi8pIHtcclxuICAgICAgICBpZiAoIXBlcnNpc3RlbmNlSGllcmFyY2h5Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoX2dldEluc3RhbmNlKGluTWVtb3J5UGVyc2lzdGVuY2UpLCBhdXRoLCB1c2VyS2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRWxpbWluYXRlIGFueSBwZXJzaXN0ZW5jZXMgdGhhdCBhcmUgbm90IGF2YWlsYWJsZVxyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZVBlcnNpc3RlbmNlcyA9IChhd2FpdCBQcm9taXNlLmFsbChwZXJzaXN0ZW5jZUhpZXJhcmNoeS5tYXAoYXN5bmMgKHBlcnNpc3RlbmNlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChhd2FpdCBwZXJzaXN0ZW5jZS5faXNBdmFpbGFibGUoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBlcnNpc3RlbmNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSkpKS5maWx0ZXIocGVyc2lzdGVuY2UgPT4gcGVyc2lzdGVuY2UpO1xyXG4gICAgICAgIC8vIEZhbGwgYmFjayB0byB0aGUgZmlyc3QgcGVyc2lzdGVuY2UgbGlzdGVkLCBvciBpbiBtZW1vcnkgaWYgbm9uZSBhdmFpbGFibGVcclxuICAgICAgICBsZXQgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IGF2YWlsYWJsZVBlcnNpc3RlbmNlc1swXSB8fFxyXG4gICAgICAgICAgICBfZ2V0SW5zdGFuY2UoaW5NZW1vcnlQZXJzaXN0ZW5jZSk7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gX3BlcnNpc3RlbmNlS2V5TmFtZSh1c2VyS2V5LCBhdXRoLmNvbmZpZy5hcGlLZXksIGF1dGgubmFtZSk7XHJcbiAgICAgICAgLy8gUHVsbCBvdXQgdGhlIGV4aXN0aW5nIHVzZXIsIHNldHRpbmcgdGhlIGNob3NlbiBwZXJzaXN0ZW5jZSB0byB0aGF0XHJcbiAgICAgICAgLy8gcGVyc2lzdGVuY2UgaWYgdGhlIHVzZXIgZXhpc3RzLlxyXG4gICAgICAgIGxldCB1c2VyVG9NaWdyYXRlID0gbnVsbDtcclxuICAgICAgICAvLyBOb3RlLCBoZXJlIHdlIGNoZWNrIGZvciBhIHVzZXIgaW4gX2FsbF8gcGVyc2lzdGVuY2VzLCBub3QganVzdCB0aGVcclxuICAgICAgICAvLyBvbmVzIGRlZW1lZCBhdmFpbGFibGUuIElmIHdlIGNhbiBtaWdyYXRlIGEgdXNlciBvdXQgb2YgYSBicm9rZW5cclxuICAgICAgICAvLyBwZXJzaXN0ZW5jZSwgd2Ugd2lsbCAoYnV0IG9ubHkgaWYgdGhhdCBwZXJzaXN0ZW5jZSBzdXBwb3J0cyBtaWdyYXRpb24pLlxyXG4gICAgICAgIGZvciAoY29uc3QgcGVyc2lzdGVuY2Ugb2YgcGVyc2lzdGVuY2VIaWVyYXJjaHkpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBwZXJzaXN0ZW5jZS5fZ2V0KGtleSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmxvYikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBVc2VySW1wbC5fZnJvbUpTT04oYXV0aCwgYmxvYik7IC8vIHRocm93cyBmb3IgdW5wYXJzYWJsZSBibG9iICh3cm9uZyBmb3JtYXQpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBlcnNpc3RlbmNlICE9PSBzZWxlY3RlZFBlcnNpc3RlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJUb01pZ3JhdGUgPSB1c2VyO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFBlcnNpc3RlbmNlID0gcGVyc2lzdGVuY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgd2UgZmluZCB0aGUgdXNlciBpbiBhIHBlcnNpc3RlbmNlIHRoYXQgZG9lcyBzdXBwb3J0IG1pZ3JhdGlvbiwgdXNlXHJcbiAgICAgICAgLy8gdGhhdCBtaWdyYXRpb24gcGF0aCAob2Ygb25seSBwZXJzaXN0ZW5jZXMgdGhhdCBzdXBwb3J0IG1pZ3JhdGlvbilcclxuICAgICAgICBjb25zdCBtaWdyYXRpb25IaWVyYXJjaHkgPSBhdmFpbGFibGVQZXJzaXN0ZW5jZXMuZmlsdGVyKHAgPT4gcC5fc2hvdWxkQWxsb3dNaWdyYXRpb24pO1xyXG4gICAgICAgIC8vIElmIHRoZSBwZXJzaXN0ZW5jZSBkb2VzIF9ub3RfIGFsbG93IG1pZ3JhdGlvbiwganVzdCBmaW5pc2ggb2ZmIGhlcmVcclxuICAgICAgICBpZiAoIXNlbGVjdGVkUGVyc2lzdGVuY2UuX3Nob3VsZEFsbG93TWlncmF0aW9uIHx8XHJcbiAgICAgICAgICAgICFtaWdyYXRpb25IaWVyYXJjaHkubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VVc2VyTWFuYWdlcihzZWxlY3RlZFBlcnNpc3RlbmNlLCBhdXRoLCB1c2VyS2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IG1pZ3JhdGlvbkhpZXJhcmNoeVswXTtcclxuICAgICAgICBpZiAodXNlclRvTWlncmF0ZSkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIG5vcm1hbGx5IHNob3VsZG4ndCB0aHJvdyBzaW5jZSBjaG9zZW5QZXJzaXN0ZW5jZS5pc0F2YWlsYWJsZSgpIGlzIHRydWUsIGJ1dCBpZiBpdCBkb2VzXHJcbiAgICAgICAgICAgIC8vIHdlJ2xsIGp1c3QgbGV0IGl0IGJ1YmJsZSB0byBzdXJmYWNlIHRoZSBlcnJvci5cclxuICAgICAgICAgICAgYXdhaXQgc2VsZWN0ZWRQZXJzaXN0ZW5jZS5fc2V0KGtleSwgdXNlclRvTWlncmF0ZS50b0pTT04oKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEF0dGVtcHQgdG8gY2xlYXIgdGhlIGtleSBpbiBvdGhlciBwZXJzaXN0ZW5jZXMgYnV0IGlnbm9yZSBlcnJvcnMuIFRoaXMgaGVscHMgcHJldmVudCBpc3N1ZXNcclxuICAgICAgICAvLyBzdWNoIGFzIHVzZXJzIGdldHRpbmcgc3R1Y2sgd2l0aCBhIHByZXZpb3VzIGFjY291bnQgYWZ0ZXIgc2lnbmluZyBvdXQgYW5kIHJlZnJlc2hpbmcgdGhlIHRhYi5cclxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwZXJzaXN0ZW5jZUhpZXJhcmNoeS5tYXAoYXN5bmMgKHBlcnNpc3RlbmNlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwZXJzaXN0ZW5jZSAhPT0gc2VsZWN0ZWRQZXJzaXN0ZW5jZSkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBwZXJzaXN0ZW5jZS5fcmVtb3ZlKGtleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoX2EpIHsgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VVc2VyTWFuYWdlcihzZWxlY3RlZFBlcnNpc3RlbmNlLCBhdXRoLCB1c2VyS2V5KTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRGV0ZXJtaW5lIHRoZSBicm93c2VyIGZvciB0aGUgcHVycG9zZXMgb2YgcmVwb3J0aW5nIHVzYWdlIHRvIHRoZSBBUElcclxuICovXHJcbmZ1bmN0aW9uIF9nZXRCcm93c2VyTmFtZSh1c2VyQWdlbnQpIHtcclxuICAgIGNvbnN0IHVhID0gdXNlckFnZW50LnRvTG93ZXJDYXNlKCk7XHJcbiAgICBpZiAodWEuaW5jbHVkZXMoJ29wZXJhLycpIHx8IHVhLmluY2x1ZGVzKCdvcHIvJykgfHwgdWEuaW5jbHVkZXMoJ29waW9zLycpKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiT3BlcmFcIiAvKiBCcm93c2VyTmFtZS5PUEVSQSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKF9pc0lFTW9iaWxlKHVhKSkge1xyXG4gICAgICAgIC8vIFdpbmRvd3MgcGhvbmUgSUVNb2JpbGUgYnJvd3Nlci5cclxuICAgICAgICByZXR1cm4gXCJJRU1vYmlsZVwiIC8qIEJyb3dzZXJOYW1lLklFTU9CSUxFICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ21zaWUnKSB8fCB1YS5pbmNsdWRlcygndHJpZGVudC8nKSkge1xyXG4gICAgICAgIHJldHVybiBcIklFXCIgLyogQnJvd3Nlck5hbWUuSUUgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh1YS5pbmNsdWRlcygnZWRnZS8nKSkge1xyXG4gICAgICAgIHJldHVybiBcIkVkZ2VcIiAvKiBCcm93c2VyTmFtZS5FREdFICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoX2lzRmlyZWZveCh1YSkpIHtcclxuICAgICAgICByZXR1cm4gXCJGaXJlZm94XCIgLyogQnJvd3Nlck5hbWUuRklSRUZPWCAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdzaWxrLycpKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiU2lsa1wiIC8qIEJyb3dzZXJOYW1lLlNJTEsgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChfaXNCbGFja0JlcnJ5KHVhKSkge1xyXG4gICAgICAgIC8vIEJsYWNrYmVycnkgYnJvd3Nlci5cclxuICAgICAgICByZXR1cm4gXCJCbGFja2JlcnJ5XCIgLyogQnJvd3Nlck5hbWUuQkxBQ0tCRVJSWSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKF9pc1dlYk9TKHVhKSkge1xyXG4gICAgICAgIC8vIFdlYk9TIGRlZmF1bHQgYnJvd3Nlci5cclxuICAgICAgICByZXR1cm4gXCJXZWJvc1wiIC8qIEJyb3dzZXJOYW1lLldFQk9TICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoX2lzU2FmYXJpKHVhKSkge1xyXG4gICAgICAgIHJldHVybiBcIlNhZmFyaVwiIC8qIEJyb3dzZXJOYW1lLlNBRkFSSSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCh1YS5pbmNsdWRlcygnY2hyb21lLycpIHx8IF9pc0Nocm9tZUlPUyh1YSkpICYmXHJcbiAgICAgICAgIXVhLmluY2x1ZGVzKCdlZGdlLycpKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiQ2hyb21lXCIgLyogQnJvd3Nlck5hbWUuQ0hST01FICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoX2lzQW5kcm9pZCh1YSkpIHtcclxuICAgICAgICAvLyBBbmRyb2lkIHN0b2NrIGJyb3dzZXIuXHJcbiAgICAgICAgcmV0dXJuIFwiQW5kcm9pZFwiIC8qIEJyb3dzZXJOYW1lLkFORFJPSUQgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAvLyBNb3N0IG1vZGVybiBicm93c2VycyBoYXZlIG5hbWUvdmVyc2lvbiBhdCBlbmQgb2YgdXNlciBhZ2VudCBzdHJpbmcuXHJcbiAgICAgICAgY29uc3QgcmUgPSAvKFthLXpBLVpcXGRcXC5dKylcXC9bYS16QS1aXFxkXFwuXSokLztcclxuICAgICAgICBjb25zdCBtYXRjaGVzID0gdXNlckFnZW50Lm1hdGNoKHJlKTtcclxuICAgICAgICBpZiAoKG1hdGNoZXMgPT09IG51bGwgfHwgbWF0Y2hlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlcy5sZW5ndGgpID09PSAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBcIk90aGVyXCIgLyogQnJvd3Nlck5hbWUuT1RIRVIgKi87XHJcbn1cclxuZnVuY3Rpb24gX2lzRmlyZWZveCh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAvZmlyZWZveFxcLy9pLnRlc3QodWEpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc1NhZmFyaSh1c2VyQWdlbnQgPSBnZXRVQSgpKSB7XHJcbiAgICBjb25zdCB1YSA9IHVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgcmV0dXJuICh1YS5pbmNsdWRlcygnc2FmYXJpLycpICYmXHJcbiAgICAgICAgIXVhLmluY2x1ZGVzKCdjaHJvbWUvJykgJiZcclxuICAgICAgICAhdWEuaW5jbHVkZXMoJ2NyaW9zLycpICYmXHJcbiAgICAgICAgIXVhLmluY2x1ZGVzKCdhbmRyb2lkJykpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0Nocm9tZUlPUyh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAvY3Jpb3NcXC8vaS50ZXN0KHVhKTtcclxufVxyXG5mdW5jdGlvbiBfaXNJRU1vYmlsZSh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAvaWVtb2JpbGUvaS50ZXN0KHVhKTtcclxufVxyXG5mdW5jdGlvbiBfaXNBbmRyb2lkKHVhID0gZ2V0VUEoKSkge1xyXG4gICAgcmV0dXJuIC9hbmRyb2lkL2kudGVzdCh1YSk7XHJcbn1cclxuZnVuY3Rpb24gX2lzQmxhY2tCZXJyeSh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAvYmxhY2tiZXJyeS9pLnRlc3QodWEpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc1dlYk9TKHVhID0gZ2V0VUEoKSkge1xyXG4gICAgcmV0dXJuIC93ZWJvcy9pLnRlc3QodWEpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0lPUyh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAoL2lwaG9uZXxpcGFkfGlwb2QvaS50ZXN0KHVhKSB8fFxyXG4gICAgICAgICgvbWFjaW50b3NoL2kudGVzdCh1YSkgJiYgL21vYmlsZS9pLnRlc3QodWEpKSk7XHJcbn1cclxuZnVuY3Rpb24gX2lzSU9TN09yOCh1YSA9IGdldFVBKCkpIHtcclxuICAgIHJldHVybiAoLyhpUGFkfGlQaG9uZXxpUG9kKS4qT1MgN19cXGQvaS50ZXN0KHVhKSB8fFxyXG4gICAgICAgIC8oaVBhZHxpUGhvbmV8aVBvZCkuKk9TIDhfXFxkL2kudGVzdCh1YSkpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0lPU1N0YW5kYWxvbmUodWEgPSBnZXRVQSgpKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICByZXR1cm4gX2lzSU9TKHVhKSAmJiAhISgoX2EgPSB3aW5kb3cubmF2aWdhdG9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3RhbmRhbG9uZSk7XHJcbn1cclxuZnVuY3Rpb24gX2lzSUUxMCgpIHtcclxuICAgIHJldHVybiBpc0lFKCkgJiYgZG9jdW1lbnQuZG9jdW1lbnRNb2RlID09PSAxMDtcclxufVxyXG5mdW5jdGlvbiBfaXNNb2JpbGVCcm93c2VyKHVhID0gZ2V0VUEoKSkge1xyXG4gICAgLy8gVE9ETzogaW1wbGVtZW50IGdldEJyb3dzZXJOYW1lIGVxdWl2YWxlbnQgZm9yIE9TLlxyXG4gICAgcmV0dXJuIChfaXNJT1ModWEpIHx8XHJcbiAgICAgICAgX2lzQW5kcm9pZCh1YSkgfHxcclxuICAgICAgICBfaXNXZWJPUyh1YSkgfHxcclxuICAgICAgICBfaXNCbGFja0JlcnJ5KHVhKSB8fFxyXG4gICAgICAgIC93aW5kb3dzIHBob25lL2kudGVzdCh1YSkgfHxcclxuICAgICAgICBfaXNJRU1vYmlsZSh1YSkpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0lmcmFtZSgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgY3VycmVudCB3aW5kb3cgaXMgbm90IHRoZSB0b3Agd2luZG93LlxyXG4gICAgICAgIC8vIElmIHNvLCByZXR1cm4gdHJ1ZS5cclxuICAgICAgICByZXR1cm4gISEod2luZG93ICYmIHdpbmRvdyAhPT0gd2luZG93LnRvcCk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKlxyXG4gKiBEZXRlcm1pbmUgdGhlIFNESyB2ZXJzaW9uIHN0cmluZ1xyXG4gKi9cclxuZnVuY3Rpb24gX2dldENsaWVudFZlcnNpb24oY2xpZW50UGxhdGZvcm0sIGZyYW1ld29ya3MgPSBbXSkge1xyXG4gICAgbGV0IHJlcG9ydGVkUGxhdGZvcm07XHJcbiAgICBzd2l0Y2ggKGNsaWVudFBsYXRmb3JtKSB7XHJcbiAgICAgICAgY2FzZSBcIkJyb3dzZXJcIiAvKiBDbGllbnRQbGF0Zm9ybS5CUk9XU0VSICovOlxyXG4gICAgICAgICAgICAvLyBJbiBhIGJyb3dzZXIgZW52aXJvbm1lbnQsIHJlcG9ydCB0aGUgYnJvd3NlciBuYW1lLlxyXG4gICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gX2dldEJyb3dzZXJOYW1lKGdldFVBKCkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiV29ya2VyXCIgLyogQ2xpZW50UGxhdGZvcm0uV09SS0VSICovOlxyXG4gICAgICAgICAgICAvLyBUZWNobmljYWxseSBhIHdvcmtlciBydW5zIGZyb20gYSBicm93c2VyIGJ1dCB3ZSBuZWVkIHRvIGRpZmZlcmVudGlhdGUgYVxyXG4gICAgICAgICAgICAvLyB3b3JrZXIgZnJvbSBhIGJyb3dzZXIuXHJcbiAgICAgICAgICAgIC8vIEZvciBleGFtcGxlOiBDaHJvbWUtV29ya2VyL0pzQ29yZS80LjkuMS9GaXJlYmFzZUNvcmUtd2ViLlxyXG4gICAgICAgICAgICByZXBvcnRlZFBsYXRmb3JtID0gYCR7X2dldEJyb3dzZXJOYW1lKGdldFVBKCkpfS0ke2NsaWVudFBsYXRmb3JtfWA7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJlcG9ydGVkUGxhdGZvcm0gPSBjbGllbnRQbGF0Zm9ybTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcG9ydGVkRnJhbWV3b3JrcyA9IGZyYW1ld29ya3MubGVuZ3RoXHJcbiAgICAgICAgPyBmcmFtZXdvcmtzLmpvaW4oJywnKVxyXG4gICAgICAgIDogJ0ZpcmViYXNlQ29yZS13ZWInOyAvKiBkZWZhdWx0IHZhbHVlIGlmIG5vIG90aGVyIGZyYW1ld29yayBpcyB1c2VkICovXHJcbiAgICByZXR1cm4gYCR7cmVwb3J0ZWRQbGF0Zm9ybX0vJHtcIkpzQ29yZVwiIC8qIENsaWVudEltcGxlbWVudGF0aW9uLkNPUkUgKi99LyR7U0RLX1ZFUlNJT059LyR7cmVwb3J0ZWRGcmFtZXdvcmtzfWA7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgQXV0aE1pZGRsZXdhcmVRdWV1ZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLnF1ZXVlID0gW107XHJcbiAgICB9XHJcbiAgICBwdXNoQ2FsbGJhY2soY2FsbGJhY2ssIG9uQWJvcnQpIHtcclxuICAgICAgICAvLyBUaGUgY2FsbGJhY2sgY291bGQgYmUgc3luYyBvciBhc3luYy4gV3JhcCBpdCBpbnRvIGFcclxuICAgICAgICAvLyBmdW5jdGlvbiB0aGF0IGlzIGFsd2F5cyBhc3luYy5cclxuICAgICAgICBjb25zdCB3cmFwcGVkQ2FsbGJhY2sgPSAodXNlcikgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gY2FsbGJhY2sodXNlcik7XHJcbiAgICAgICAgICAgICAgICAvLyBFaXRoZXIgcmVzb2x2ZSB3aXRoIGV4aXN0aW5nIHByb21pc2Ugb3Igd3JhcCBhIG5vbi1wcm9taXNlXHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gdmFsdWUgaW50byBhIHByb21pc2UuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIC8vIFN5bmMgY2FsbGJhY2sgdGhyb3dzLlxyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gQXR0YWNoIHRoZSBvbkFib3J0IGlmIHByZXNlbnRcclxuICAgICAgICB3cmFwcGVkQ2FsbGJhY2sub25BYm9ydCA9IG9uQWJvcnQ7XHJcbiAgICAgICAgdGhpcy5xdWV1ZS5wdXNoKHdyYXBwZWRDYWxsYmFjayk7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnF1ZXVlLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICAgICAgLy8gVW5zdWJzY3JpYmUuIFJlcGxhY2Ugd2l0aCBuby1vcC4gRG8gbm90IHJlbW92ZSBmcm9tIGFycmF5LCBvciBpdCB3aWxsIGRpc3R1cmJcclxuICAgICAgICAgICAgLy8gaW5kZXhpbmcgb2Ygb3RoZXIgZWxlbWVudHMuXHJcbiAgICAgICAgICAgIHRoaXMucXVldWVbaW5kZXhdID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGFzeW5jIHJ1bk1pZGRsZXdhcmUobmV4dFVzZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5hdXRoLmN1cnJlbnRVc2VyID09PSBuZXh0VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFdoaWxlIHJ1bm5pbmcgdGhlIG1pZGRsZXdhcmUsIGJ1aWxkIGEgdGVtcG9yYXJ5IHN0YWNrIG9mIG9uQWJvcnRcclxuICAgICAgICAvLyBjYWxsYmFja3MgdG8gY2FsbCBpZiBvbmUgbWlkZGxld2FyZSBjYWxsYmFjayByZWplY3RzLlxyXG4gICAgICAgIGNvbnN0IG9uQWJvcnRTdGFjayA9IFtdO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgYmVmb3JlU3RhdGVDYWxsYmFjayBvZiB0aGlzLnF1ZXVlKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBiZWZvcmVTdGF0ZUNhbGxiYWNrKG5leHRVc2VyKTtcclxuICAgICAgICAgICAgICAgIC8vIE9ubHkgcHVzaCB0aGUgb25BYm9ydCBpZiB0aGUgY2FsbGJhY2sgc3VjY2VlZHNcclxuICAgICAgICAgICAgICAgIGlmIChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvbkFib3J0U3RhY2sucHVzaChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIC8vIFJ1biBhbGwgb25BYm9ydCwgd2l0aCBzZXBhcmF0ZSB0cnkvY2F0Y2ggdG8gaWdub3JlIGFueSBlcnJvcnMgYW5kXHJcbiAgICAgICAgICAgIC8vIGNvbnRpbnVlXHJcbiAgICAgICAgICAgIG9uQWJvcnRTdGFjay5yZXZlcnNlKCk7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3Qgb25BYm9ydCBvZiBvbkFib3J0U3RhY2spIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25BYm9ydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKF8pIHtcclxuICAgICAgICAgICAgICAgICAgICAvKiBzd2FsbG93IGVycm9yICovXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhyb3cgdGhpcy5hdXRoLl9lcnJvckZhY3RvcnkuY3JlYXRlKFwibG9naW4tYmxvY2tlZFwiIC8qIEF1dGhFcnJvckNvZGUuTE9HSU5fQkxPQ0tFRCAqLywge1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgQXV0aEltcGwge1xyXG4gICAgY29uc3RydWN0b3IoYXBwLCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIsIGNvbmZpZykge1xyXG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xyXG4gICAgICAgIHRoaXMuaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyID0gaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyO1xyXG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZW11bGF0b3JDb25maWcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgIHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbih0aGlzKTtcclxuICAgICAgICB0aGlzLmlkVG9rZW5TdWJzY3JpcHRpb24gPSBuZXcgU3Vic2NyaXB0aW9uKHRoaXMpO1xyXG4gICAgICAgIHRoaXMuYmVmb3JlU3RhdGVRdWV1ZSA9IG5ldyBBdXRoTWlkZGxld2FyZVF1ZXVlKHRoaXMpO1xyXG4gICAgICAgIHRoaXMucmVkaXJlY3RVc2VyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAvLyBBbnkgbmV0d29yayBjYWxscyB3aWxsIHNldCB0aGlzIHRvIHRydWUgYW5kIHByZXZlbnQgc3Vic2VxdWVudCBlbXVsYXRvclxyXG4gICAgICAgIC8vIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgdGhpcy5fY2FuSW5pdEVtdWxhdG9yID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fZGVsZXRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9lcnJvckZhY3RvcnkgPSBfREVGQVVMVF9BVVRIX0VSUk9SX0ZBQ1RPUlk7XHJcbiAgICAgICAgLy8gVHJhY2tzIHRoZSBsYXN0IG5vdGlmaWVkIFVJRCBmb3Igc3RhdGUgY2hhbmdlIGxpc3RlbmVycyB0byBwcmV2ZW50XHJcbiAgICAgICAgLy8gcmVwZWF0ZWQgY2FsbHMgdG8gdGhlIGNhbGxiYWNrcy4gVW5kZWZpbmVkIG1lYW5zIGl0J3MgbmV2ZXIgYmVlblxyXG4gICAgICAgIC8vIGNhbGxlZCwgd2hlcmVhcyBudWxsIG1lYW5zIGl0J3MgYmVlbiBjYWxsZWQgd2l0aCBhIHNpZ25lZCBvdXQgdXNlclxyXG4gICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnRlbmFudElkID0gbnVsbDtcclxuICAgICAgICB0aGlzLnNldHRpbmdzID0geyBhcHBWZXJpZmljYXRpb25EaXNhYmxlZEZvclRlc3Rpbmc6IGZhbHNlIH07XHJcbiAgICAgICAgdGhpcy5mcmFtZXdvcmtzID0gW107XHJcbiAgICAgICAgdGhpcy5uYW1lID0gYXBwLm5hbWU7XHJcbiAgICAgICAgdGhpcy5jbGllbnRWZXJzaW9uID0gY29uZmlnLnNka0NsaWVudFZlcnNpb247XHJcbiAgICB9XHJcbiAgICBfaW5pdGlhbGl6ZVdpdGhQZXJzaXN0ZW5jZShwZXJzaXN0ZW5jZUhpZXJhcmNoeSwgcG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7XHJcbiAgICAgICAgaWYgKHBvcHVwUmVkaXJlY3RSZXNvbHZlcikge1xyXG4gICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIgPSBfZ2V0SW5zdGFuY2UocG9wdXBSZWRpcmVjdFJlc29sdmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSGF2ZSB0byBjaGVjayBmb3IgYXBwIGRlbGV0aW9uIHRocm91Z2hvdXQgaW5pdGlhbGl6YXRpb24gKGFmdGVyIGVhY2hcclxuICAgICAgICAvLyBwcm9taXNlIHJlc29sdXRpb24pXHJcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6YXRpb25Qcm9taXNlID0gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIgPSBhd2FpdCBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyLmNyZWF0ZSh0aGlzLCBwZXJzaXN0ZW5jZUhpZXJhcmNoeSk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgcmVzb2x2ZXIgZWFybHkgaWYgbmVjZXNzYXJ5IChvbmx5IGFwcGxpY2FibGUgdG8gd2ViOlxyXG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgY2F1c2UgdGhlIGlmcmFtZSB0byBsb2FkIGltbWVkaWF0ZWx5IGluIGNlcnRhaW4gY2FzZXMpXHJcbiAgICAgICAgICAgIGlmICgoX2EgPSB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5fc2hvdWxkSW5pdFByb2FjdGl2ZWx5KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGZhaWxzLCBkb24ndCBoYWx0IGF1dGggbG9hZGluZ1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIuX2luaXRpYWxpemUodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8qIElnbm9yZSB0aGUgZXJyb3IgKi9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVDdXJyZW50VXNlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmxhc3ROb3RpZmllZFVpZCA9ICgoX2IgPSB0aGlzLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudWlkKSB8fCBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIElmIHRoZSBwZXJzaXN0ZW5jZSBpcyBjaGFuZ2VkIGluIGFub3RoZXIgd2luZG93LCB0aGUgdXNlciBtYW5hZ2VyIHdpbGwgbGV0IHVzIGtub3dcclxuICAgICAqL1xyXG4gICAgYXN5bmMgX29uU3RvcmFnZUV2ZW50KCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5nZXRDdXJyZW50VXNlcigpO1xyXG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50VXNlciAmJiAhdXNlcikge1xyXG4gICAgICAgICAgICAvLyBObyBjaGFuZ2UsIGRvIG5vdGhpbmcgKHdhcyBzaWduZWQgb3V0IGFuZCByZW1haW5lZCBzaWduZWQgb3V0KS5cclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiB0aGUgc2FtZSB1c2VyIGlzIHRvIGJlIHN5bmNocm9uaXplZC5cclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlciAmJiB1c2VyICYmIHRoaXMuY3VycmVudFVzZXIudWlkID09PSB1c2VyLnVpZCkge1xyXG4gICAgICAgICAgICAvLyBEYXRhIHVwZGF0ZSwgc2ltcGx5IGNvcHkgZGF0YSBjaGFuZ2VzLlxyXG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fYXNzaWduKHVzZXIpO1xyXG4gICAgICAgICAgICAvLyBJZiB0b2tlbnMgY2hhbmdlZCBmcm9tIHByZXZpb3VzIHVzZXIgdG9rZW5zLCB0aGlzIHdpbGwgdHJpZ2dlclxyXG4gICAgICAgICAgICAvLyBub3RpZnlBdXRoTGlzdGVuZXJzXy5cclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5jdXJyZW50VXNlci5nZXRJZFRva2VuKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVXBkYXRlIGN1cnJlbnQgQXV0aCBzdGF0ZS4gRWl0aGVyIGEgbmV3IGxvZ2luIG9yIGxvZ291dC5cclxuICAgICAgICAvLyBTa2lwIGJsb2NraW5nIGNhbGxiYWNrcywgdGhleSBzaG91bGQgbm90IGFwcGx5IHRvIGEgY2hhbmdlIGluIGFub3RoZXIgdGFiLlxyXG4gICAgICAgIGF3YWl0IHRoaXMuX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXIsIC8qIHNraXBCZWZvcmVTdGF0ZUNhbGxiYWNrcyAqLyB0cnVlKTtcclxuICAgIH1cclxuICAgIGFzeW5jIGluaXRpYWxpemVDdXJyZW50VXNlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgLy8gRmlyc3QgY2hlY2sgdG8gc2VlIGlmIHdlIGhhdmUgYSBwZW5kaW5nIHJlZGlyZWN0IGV2ZW50LlxyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzbHlTdG9yZWRVc2VyID0gKGF3YWl0IHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5nZXRDdXJyZW50VXNlcigpKTtcclxuICAgICAgICBsZXQgZnV0dXJlQ3VycmVudFVzZXIgPSBwcmV2aW91c2x5U3RvcmVkVXNlcjtcclxuICAgICAgICBsZXQgbmVlZHNUb2NoZWNrTWlkZGxld2FyZSA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChwb3B1cFJlZGlyZWN0UmVzb2x2ZXIgJiYgdGhpcy5jb25maWcuYXV0aERvbWFpbikge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZGlyZWN0VXNlckV2ZW50SWQgPSAoX2EgPSB0aGlzLnJlZGlyZWN0VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLl9yZWRpcmVjdEV2ZW50SWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0b3JlZFVzZXJFdmVudElkID0gZnV0dXJlQ3VycmVudFVzZXIgPT09IG51bGwgfHwgZnV0dXJlQ3VycmVudFVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGZ1dHVyZUN1cnJlbnRVc2VyLl9yZWRpcmVjdEV2ZW50SWQ7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudHJ5UmVkaXJlY3RTaWduSW4ocG9wdXBSZWRpcmVjdFJlc29sdmVyKTtcclxuICAgICAgICAgICAgLy8gSWYgdGhlIHN0b3JlZCB1c2VyIChpLmUuIHRoZSBvbGQgXCJjdXJyZW50VXNlclwiKSBoYXMgYSByZWRpcmVjdElkIHRoYXRcclxuICAgICAgICAgICAgLy8gbWF0Y2hlcyB0aGUgcmVkaXJlY3QgdXNlciwgdGhlbiB3ZSB3YW50IHRvIGluaXRpYWxseSBzaWduIGluIHdpdGggdGhlXHJcbiAgICAgICAgICAgIC8vIG5ldyB1c2VyIG9iamVjdCBmcm9tIHJlc3VsdC5cclxuICAgICAgICAgICAgLy8gVE9ETyhzYW1naG8pOiBNb3JlIHRob3JvdWdobHkgdGVzdCBhbGwgb2YgdGhpc1xyXG4gICAgICAgICAgICBpZiAoKCFyZWRpcmVjdFVzZXJFdmVudElkIHx8IHJlZGlyZWN0VXNlckV2ZW50SWQgPT09IHN0b3JlZFVzZXJFdmVudElkKSAmJlxyXG4gICAgICAgICAgICAgICAgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdC51c2VyKSkge1xyXG4gICAgICAgICAgICAgICAgZnV0dXJlQ3VycmVudFVzZXIgPSByZXN1bHQudXNlcjtcclxuICAgICAgICAgICAgICAgIG5lZWRzVG9jaGVja01pZGRsZXdhcmUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIElmIG5vIHVzZXIgaW4gcGVyc2lzdGVuY2UsIHRoZXJlIGlzIG5vIGN1cnJlbnQgdXNlci4gU2V0IHRvIG51bGwuXHJcbiAgICAgICAgaWYgKCFmdXR1cmVDdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWZ1dHVyZUN1cnJlbnRVc2VyLl9yZWRpcmVjdEV2ZW50SWQpIHtcclxuICAgICAgICAgICAgLy8gVGhpcyBpc24ndCBhIHJlZGlyZWN0IGxpbmsgb3BlcmF0aW9uLCB3ZSBjYW4gcmVsb2FkIGFuZCBiYWlsLlxyXG4gICAgICAgICAgICAvLyBGaXJzdCB0aG91Z2gsIGVuc3VyZSB0aGF0IHdlIGNoZWNrIHRoZSBtaWRkbGV3YXJlIGlzIGhhcHB5LlxyXG4gICAgICAgICAgICBpZiAobmVlZHNUb2NoZWNrTWlkZGxld2FyZSkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmJlZm9yZVN0YXRlUXVldWUucnVuTWlkZGxld2FyZShmdXR1cmVDdXJyZW50VXNlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1dHVyZUN1cnJlbnRVc2VyID0gcHJldmlvdXNseVN0b3JlZFVzZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gV2Uga25vdyB0aGlzIGlzIGF2YWlsYWJsZSBzaW5jZSB0aGUgYml0IGlzIG9ubHkgc2V0IHdoZW4gdGhlXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzb2x2ZXIgaXMgYXZhaWxhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLl9vdmVycmlkZVJlZGlyZWN0UmVzdWx0KHRoaXMsICgpID0+IFByb21pc2UucmVqZWN0KGUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZnV0dXJlQ3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcihmdXR1cmVDdXJyZW50VXNlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF9hc3NlcnQodGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLCB0aGlzLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5nZXRPckluaXRSZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcigpO1xyXG4gICAgICAgIC8vIElmIHRoZSByZWRpcmVjdCB1c2VyJ3MgZXZlbnQgSUQgbWF0Y2hlcyB0aGUgY3VycmVudCB1c2VyJ3MgZXZlbnQgSUQsXHJcbiAgICAgICAgLy8gRE8gTk9UIHJlbG9hZCB0aGUgY3VycmVudCB1c2VyLCBvdGhlcndpc2UgdGhleSdsbCBiZSBjbGVhcmVkIGZyb20gc3RvcmFnZS5cclxuICAgICAgICAvLyBUaGlzIGlzIGltcG9ydGFudCBmb3IgdGhlIHJlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0KCkgZmxvdy5cclxuICAgICAgICBpZiAodGhpcy5yZWRpcmVjdFVzZXIgJiZcclxuICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9PT0gZnV0dXJlQ3VycmVudFVzZXIuX3JlZGlyZWN0RXZlbnRJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKGZ1dHVyZUN1cnJlbnRVc2VyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVsb2FkQW5kU2V0Q3VycmVudFVzZXJPckNsZWFyKGZ1dHVyZUN1cnJlbnRVc2VyKTtcclxuICAgIH1cclxuICAgIGFzeW5jIHRyeVJlZGlyZWN0U2lnbkluKHJlZGlyZWN0UmVzb2x2ZXIpIHtcclxuICAgICAgICAvLyBUaGUgcmVkaXJlY3QgdXNlciBuZWVkcyB0byBiZSBjaGVja2VkIChhbmQgc2lnbmVkIGluIGlmIGF2YWlsYWJsZSlcclxuICAgICAgICAvLyBkdXJpbmcgYXV0aCBpbml0aWFsaXphdGlvbi4gQWxsIG9mIHRoZSBub3JtYWwgc2lnbiBpbiBhbmQgbGluay9yZWF1dGhcclxuICAgICAgICAvLyBmbG93cyBjYWxsIGJhY2sgaW50byBhdXRoIGFuZCBwdXNoIHRoaW5ncyBvbnRvIHRoZSBwcm9taXNlIHF1ZXVlLiBXZVxyXG4gICAgICAgIC8vIG5lZWQgdG8gYXdhaXQgdGhlIHJlc3VsdCBvZiB0aGUgcmVkaXJlY3Qgc2lnbiBpbiAqaW5zaWRlIHRoZSBwcm9taXNlXHJcbiAgICAgICAgLy8gcXVldWUqLiBUaGlzIHByZXNlbnRzIGEgcHJvYmxlbTogd2UgcnVuIGludG8gZGVhZGxvY2suIFNlZTpcclxuICAgICAgICAvLyAgICDilIw+IFtJbml0aWFsaXphdGlvbl0g4pSA4pSA4pSA4pSA4pSA4pSQXHJcbiAgICAgICAgLy8gICAg4pSMPiBbPG90aGVyIHF1ZXVlIHRhc2tzPl0g4pSCXHJcbiAgICAgICAgLy8gICAg4pSU4pSAIFtnZXRSZWRpcmVjdFJlc3VsdF0gPOKUgOKUmFxyXG4gICAgICAgIC8vICAgIHdoZXJlIFtdIGFyZSB0YXNrcyBvbiB0aGUgcXVldWUgYW5kIGFycm93cyBkZW5vdGUgYXdhaXRzXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6YXRpb24gd2lsbCBuZXZlciBjb21wbGV0ZSBiZWNhdXNlIGl0J3Mgd2FpdGluZyBvbiBzb21ldGhpbmdcclxuICAgICAgICAvLyB0aGF0J3Mgd2FpdGluZyBmb3IgaW5pdGlhbGl6YXRpb24gdG8gY29tcGxldGUhXHJcbiAgICAgICAgLy9cclxuICAgICAgICAvLyBJbnN0ZWFkLCB0aGlzIG1ldGhvZCBjYWxscyBnZXRSZWRpcmVjdFJlc3VsdCgpIChzdG9yZWQgaW5cclxuICAgICAgICAvLyBfY29tcGxldGVSZWRpcmVjdEZuKSB3aXRoIGFuIG9wdGlvbmFsIHBhcmFtZXRlciB0aGF0IGluc3RydWN0cyBhbGwgb2ZcclxuICAgICAgICAvLyB0aGUgdW5kZXJseWluZyBhdXRoIG9wZXJhdGlvbnMgdG8gc2tpcCBhbnl0aGluZyB0aGF0IG11dGF0ZXMgYXV0aCBzdGF0ZS5cclxuICAgICAgICBsZXQgcmVzdWx0ID0gbnVsbDtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBXZSBrbm93IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlciBpcyBzZXQgc2luY2UgcmVkaXJlY3RSZXNvbHZlclxyXG4gICAgICAgICAgICAvLyBpcyBwYXNzZWQgaW4uIFRoZSBfY29tcGxldGVSZWRpcmVjdEZuIGV4cGVjdHMgdGhlIHVud3JhcHBlZCBleHRlcm4uXHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlci5fY29tcGxldGVSZWRpcmVjdEZuKHRoaXMsIHJlZGlyZWN0UmVzb2x2ZXIsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAvLyBTd2FsbG93IGFueSBlcnJvcnMgaGVyZTsgdGhlIGNvZGUgY2FuIHJldHJpZXZlIHRoZW0gaW5cclxuICAgICAgICAgICAgLy8gZ2V0UmVkaXJlY3RSZXN1bHQoKS5cclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fc2V0UmVkaXJlY3RVc2VyKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgYXN5bmMgcmVsb2FkQW5kU2V0Q3VycmVudFVzZXJPckNsZWFyKHVzZXIpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBhd2FpdCBfcmVsb2FkV2l0aG91dFNhdmluZyh1c2VyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgIT09XHJcbiAgICAgICAgICAgICAgICBgYXV0aC8ke1wibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqL31gKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTb21ldGhpbmcncyB3cm9uZyB3aXRoIHRoZSB1c2VyJ3MgdG9rZW4uIExvZyB0aGVtIG91dCBhbmQgcmVtb3ZlXHJcbiAgICAgICAgICAgICAgICAvLyB0aGVtIGZyb20gc3RvcmFnZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpO1xyXG4gICAgfVxyXG4gICAgdXNlRGV2aWNlTGFuZ3VhZ2UoKSB7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSBfZ2V0VXNlckxhbmd1YWdlKCk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfZGVsZXRlKCkge1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgdXBkYXRlQ3VycmVudFVzZXIodXNlckV4dGVybikge1xyXG4gICAgICAgIC8vIFRoZSBwdWJsaWMgdXBkYXRlQ3VycmVudFVzZXIgbWV0aG9kIG5lZWRzIHRvIG1ha2UgYSBjb3B5IG9mIHRoZSB1c2VyLFxyXG4gICAgICAgIC8vIGFuZCBhbHNvIGNoZWNrIHRoYXQgdGhlIHByb2plY3QgbWF0Y2hlc1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSB1c2VyRXh0ZXJuXHJcbiAgICAgICAgICAgID8gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXJFeHRlcm4pXHJcbiAgICAgICAgICAgIDogbnVsbDtcclxuICAgICAgICBpZiAodXNlcikge1xyXG4gICAgICAgICAgICBfYXNzZXJ0KHVzZXIuYXV0aC5jb25maWcuYXBpS2V5ID09PSB0aGlzLmNvbmZpZy5hcGlLZXksIHRoaXMsIFwiaW52YWxpZC11c2VyLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FVVEggKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIodXNlciAmJiB1c2VyLl9jbG9uZSh0aGlzKSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfdXBkYXRlQ3VycmVudFVzZXIodXNlciwgc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAodGhpcy5fZGVsZXRlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgIF9hc3NlcnQodGhpcy50ZW5hbnRJZCA9PT0gdXNlci50ZW5hbnRJZCwgdGhpcywgXCJ0ZW5hbnQtaWQtbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlRFTkFOVF9JRF9NSVNNQVRDSCAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKHVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTtcclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBzaWduT3V0KCkge1xyXG4gICAgICAgIC8vIFJ1biBmaXJzdCwgdG8gYmxvY2sgX3NldFJlZGlyZWN0VXNlcigpIGlmIGFueSBjYWxsYmFja3MgZmFpbC5cclxuICAgICAgICBhd2FpdCB0aGlzLmJlZm9yZVN0YXRlUXVldWUucnVuTWlkZGxld2FyZShudWxsKTtcclxuICAgICAgICAvLyBDbGVhciB0aGUgcmVkaXJlY3QgdXNlciB3aGVuIHNpZ25PdXQgaXMgY2FsbGVkXHJcbiAgICAgICAgaWYgKHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIgfHwgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3NldFJlZGlyZWN0VXNlcihudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUHJldmVudCBjYWxsYmFja3MgZnJvbSBiZWluZyBjYWxsZWQgYWdhaW4gaW4gX3VwZGF0ZUN1cnJlbnRVc2VyLCBhc1xyXG4gICAgICAgIC8vIHRoZXkgd2VyZSBhbHJlYWR5IGNhbGxlZCBpbiB0aGUgZmlyc3QgbGluZS5cclxuICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIobnVsbCwgLyogc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzICovIHRydWUpO1xyXG4gICAgfVxyXG4gICAgc2V0UGVyc2lzdGVuY2UocGVyc2lzdGVuY2UpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5zZXRQZXJzaXN0ZW5jZShfZ2V0SW5zdGFuY2UocGVyc2lzdGVuY2UpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIF9nZXRQZXJzaXN0ZW5jZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnBlcnNpc3RlbmNlLnR5cGU7XHJcbiAgICB9XHJcbiAgICBfdXBkYXRlRXJyb3JNYXAoZXJyb3JNYXApIHtcclxuICAgICAgICB0aGlzLl9lcnJvckZhY3RvcnkgPSBuZXcgRXJyb3JGYWN0b3J5KCdhdXRoJywgJ0ZpcmViYXNlJywgZXJyb3JNYXAoKSk7XHJcbiAgICB9XHJcbiAgICBvbkF1dGhTdGF0ZUNoYW5nZWQobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlclN0YXRlTGlzdGVuZXIodGhpcy5hdXRoU3RhdGVTdWJzY3JpcHRpb24sIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKTtcclxuICAgIH1cclxuICAgIGJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQoY2FsbGJhY2ssIG9uQWJvcnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iZWZvcmVTdGF0ZVF1ZXVlLnB1c2hDYWxsYmFjayhjYWxsYmFjaywgb25BYm9ydCk7XHJcbiAgICB9XHJcbiAgICBvbklkVG9rZW5DaGFuZ2VkKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHRoaXMuaWRUb2tlblN1YnNjcmlwdGlvbiwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpO1xyXG4gICAgfVxyXG4gICAgdG9KU09OKCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhcGlLZXk6IHRoaXMuY29uZmlnLmFwaUtleSxcclxuICAgICAgICAgICAgYXV0aERvbWFpbjogdGhpcy5jb25maWcuYXV0aERvbWFpbixcclxuICAgICAgICAgICAgYXBwTmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICAgICAgICBjdXJyZW50VXNlcjogKF9hID0gdGhpcy5fY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0pTT04oKVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBhc3luYyBfc2V0UmVkaXJlY3RVc2VyKHVzZXIsIHBvcHVwUmVkaXJlY3RSZXNvbHZlcikge1xyXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0TWFuYWdlciA9IGF3YWl0IHRoaXMuZ2V0T3JJbml0UmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIocG9wdXBSZWRpcmVjdFJlc29sdmVyKTtcclxuICAgICAgICByZXR1cm4gdXNlciA9PT0gbnVsbFxyXG4gICAgICAgICAgICA/IHJlZGlyZWN0TWFuYWdlci5yZW1vdmVDdXJyZW50VXNlcigpXHJcbiAgICAgICAgICAgIDogcmVkaXJlY3RNYW5hZ2VyLnNldEN1cnJlbnRVc2VyKHVzZXIpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgZ2V0T3JJbml0UmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIocG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gKHBvcHVwUmVkaXJlY3RSZXNvbHZlciAmJiBfZ2V0SW5zdGFuY2UocG9wdXBSZWRpcmVjdFJlc29sdmVyKSkgfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlcjtcclxuICAgICAgICAgICAgX2Fzc2VydChyZXNvbHZlciwgdGhpcywgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICB0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyID0gYXdhaXQgUGVyc2lzdGVuY2VVc2VyTWFuYWdlci5jcmVhdGUodGhpcywgW19nZXRJbnN0YW5jZShyZXNvbHZlci5fcmVkaXJlY3RQZXJzaXN0ZW5jZSldLCBcInJlZGlyZWN0VXNlclwiIC8qIEtleU5hbWUuUkVESVJFQ1RfVVNFUiAqLyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVc2VyID1cclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIuZ2V0Q3VycmVudFVzZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXI7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfcmVkaXJlY3RVc2VyRm9ySWQoaWQpIHtcclxuICAgICAgICB2YXIgX2EsIF9iO1xyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSd2ZSBjbGVhcmVkIGFueSBwZW5kaW5nIHBlcnNpc3RlbmNlIGFjdGlvbnMgaWYgd2UncmUgbm90IGluXHJcbiAgICAgICAgLy8gdGhlIGluaXRpYWxpemVyXHJcbiAgICAgICAgaWYgKHRoaXMuX2lzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuX3JlZGlyZWN0RXZlbnRJZCkgPT09IGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50VXNlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCgoX2IgPSB0aGlzLnJlZGlyZWN0VXNlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLl9yZWRpcmVjdEV2ZW50SWQpID09PSBpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yZWRpcmVjdFVzZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3BlcnNpc3RVc2VySWZDdXJyZW50KHVzZXIpIHtcclxuICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIodXNlcikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKiBOb3RpZmllcyBsaXN0ZW5lcnMgb25seSBpZiB0aGUgdXNlciBpcyBjdXJyZW50ICovXHJcbiAgICBfbm90aWZ5TGlzdGVuZXJzSWZDdXJyZW50KHVzZXIpIHtcclxuICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICB0aGlzLm5vdGlmeUF1dGhMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfa2V5KCkge1xyXG4gICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZy5hdXRoRG9tYWlufToke3RoaXMuY29uZmlnLmFwaUtleX06JHt0aGlzLm5hbWV9YDtcclxuICAgIH1cclxuICAgIF9zdGFydFByb2FjdGl2ZVJlZnJlc2goKSB7XHJcbiAgICAgICAgdGhpcy5pc1Byb2FjdGl2ZVJlZnJlc2hFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikge1xyXG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX3N0b3BQcm9hY3RpdmVSZWZyZXNoKCkge1xyXG4gICAgICAgIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRVc2VyLl9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKiBSZXR1cm5zIHRoZSBjdXJyZW50IHVzZXIgY2FzdCBhcyB0aGUgaW50ZXJuYWwgdHlwZSAqL1xyXG4gICAgZ2V0IF9jdXJyZW50VXNlcigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlcjtcclxuICAgIH1cclxuICAgIG5vdGlmeUF1dGhMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICBpZiAoIXRoaXMuX2lzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlkVG9rZW5TdWJzY3JpcHRpb24ubmV4dCh0aGlzLmN1cnJlbnRVc2VyKTtcclxuICAgICAgICBjb25zdCBjdXJyZW50VWlkID0gKF9iID0gKF9hID0gdGhpcy5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnVpZCkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5sYXN0Tm90aWZpZWRVaWQgIT09IGN1cnJlbnRVaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5sYXN0Tm90aWZpZWRVaWQgPSBjdXJyZW50VWlkO1xyXG4gICAgICAgICAgICB0aGlzLmF1dGhTdGF0ZVN1YnNjcmlwdGlvbi5uZXh0KHRoaXMuY3VycmVudFVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlZ2lzdGVyU3RhdGVMaXN0ZW5lcihzdWJzY3JpcHRpb24sIG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICgpID0+IHsgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgY2IgPSB0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbidcclxuICAgICAgICAgICAgPyBuZXh0T3JPYnNlcnZlclxyXG4gICAgICAgICAgICA6IG5leHRPck9ic2VydmVyLm5leHQuYmluZChuZXh0T3JPYnNlcnZlcik7XHJcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9IHRoaXMuX2lzSW5pdGlhbGl6ZWRcclxuICAgICAgICAgICAgPyBQcm9taXNlLnJlc29sdmUoKVxyXG4gICAgICAgICAgICA6IHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcclxuICAgICAgICBfYXNzZXJ0KHByb21pc2UsIHRoaXMsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICAvLyBUaGUgY2FsbGJhY2sgbmVlZHMgdG8gYmUgY2FsbGVkIGFzeW5jaHJvbm91c2x5IHBlciB0aGUgc3BlYy5cclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICAgICAgcHJvbWlzZS50aGVuKCgpID0+IGNiKHRoaXMuY3VycmVudFVzZXIpKTtcclxuICAgICAgICBpZiAodHlwZW9mIG5leHRPck9ic2VydmVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdWJzY3JpcHRpb24uYWRkT2JzZXJ2ZXIobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbi5hZGRPYnNlcnZlcihuZXh0T3JPYnNlcnZlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVbnByb3RlY3RlZCAoZnJvbSByYWNlIGNvbmRpdGlvbnMpIG1ldGhvZCB0byBzZXQgdGhlIGN1cnJlbnQgdXNlci4gVGhpc1xyXG4gICAgICogc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gd2l0aGluIGEgcXVldWVkIGNhbGxiYWNrLiBUaGlzIGlzIG5lY2Vzc2FyeVxyXG4gICAgICogYmVjYXVzZSB0aGUgcXVldWUgc2hvdWxkbid0IHJlbHkgb24gYW5vdGhlciBxdWV1ZWQgY2FsbGJhY2suXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGRpcmVjdGx5U2V0Q3VycmVudFVzZXIodXNlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyICYmIHRoaXMuY3VycmVudFVzZXIgIT09IHVzZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX3N0b3BQcm9hY3RpdmVSZWZyZXNoKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1c2VyICYmIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCkge1xyXG4gICAgICAgICAgICB1c2VyLl9zdGFydFByb2FjdGl2ZVJlZnJlc2goKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXI7XHJcbiAgICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnNldEN1cnJlbnRVc2VyKHVzZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnJlbW92ZUN1cnJlbnRVc2VyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcXVldWUoYWN0aW9uKSB7XHJcbiAgICAgICAgLy8gSW4gY2FzZSBzb21ldGhpbmcgZXJyb3JzLCB0aGUgY2FsbGJhY2sgc3RpbGwgc2hvdWxkIGJlIGNhbGxlZCBpbiBvcmRlclxyXG4gICAgICAgIC8vIHRvIGtlZXAgdGhlIHByb21pc2UgY2hhaW4gYWxpdmVcclxuICAgICAgICB0aGlzLm9wZXJhdGlvbnMgPSB0aGlzLm9wZXJhdGlvbnMudGhlbihhY3Rpb24sIGFjdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlcmF0aW9ucztcclxuICAgIH1cclxuICAgIGdldCBhc3NlcnRlZFBlcnNpc3RlbmNlKCkge1xyXG4gICAgICAgIF9hc3NlcnQodGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIsIHRoaXMsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXI7XHJcbiAgICB9XHJcbiAgICBfbG9nRnJhbWV3b3JrKGZyYW1ld29yaykge1xyXG4gICAgICAgIGlmICghZnJhbWV3b3JrIHx8IHRoaXMuZnJhbWV3b3Jrcy5pbmNsdWRlcyhmcmFtZXdvcmspKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mcmFtZXdvcmtzLnB1c2goZnJhbWV3b3JrKTtcclxuICAgICAgICAvLyBTb3J0IGFscGhhYmV0aWNhbGx5IHNvIHRoYXQgXCJGaXJlYmFzZUNvcmUtd2ViLEZpcmViYXNlVUktd2ViXCIgYW5kXHJcbiAgICAgICAgLy8gXCJGaXJlYmFzZVVJLXdlYixGaXJlYmFzZUNvcmUtd2ViXCIgYXJlbid0IHZpZXdlZCBhcyBkaWZmZXJlbnQuXHJcbiAgICAgICAgdGhpcy5mcmFtZXdvcmtzLnNvcnQoKTtcclxuICAgICAgICB0aGlzLmNsaWVudFZlcnNpb24gPSBfZ2V0Q2xpZW50VmVyc2lvbih0aGlzLmNvbmZpZy5jbGllbnRQbGF0Zm9ybSwgdGhpcy5fZ2V0RnJhbWV3b3JrcygpKTtcclxuICAgIH1cclxuICAgIF9nZXRGcmFtZXdvcmtzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZyYW1ld29ya3M7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfZ2V0QWRkaXRpb25hbEhlYWRlcnMoKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIC8vIEFkZGl0aW9uYWwgaGVhZGVycyBvbiBldmVyeSByZXF1ZXN0XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IHtcclxuICAgICAgICAgICAgW1wiWC1DbGllbnQtVmVyc2lvblwiIC8qIEh0dHBIZWFkZXIuWF9DTElFTlRfVkVSU0lPTiAqL106IHRoaXMuY2xpZW50VmVyc2lvblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMuYXBwLm9wdGlvbnMuYXBwSWQpIHtcclxuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtZ21waWRcIiAvKiBIdHRwSGVhZGVyLlhfRklSRUJBU0VfR01QSUQgKi9dID0gdGhpcy5hcHAub3B0aW9ucy5hcHBJZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgdGhlIGhlYXJ0YmVhdCBzZXJ2aWNlIGV4aXN0cywgYWRkIHRoZSBoZWFydGJlYXQgc3RyaW5nXHJcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0c0hlYWRlciA9IGF3YWl0ICgoX2EgPSB0aGlzLmhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlclxyXG4gICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHtcclxuICAgICAgICAgICAgb3B0aW9uYWw6IHRydWVcclxuICAgICAgICB9KSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEhlYXJ0YmVhdHNIZWFkZXIoKSk7XHJcbiAgICAgICAgaWYgKGhlYXJ0YmVhdHNIZWFkZXIpIHtcclxuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtQ2xpZW50XCIgLyogSHR0cEhlYWRlci5YX0ZJUkVCQVNFX0NMSUVOVCAqL10gPSBoZWFydGJlYXRzSGVhZGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGVhZGVycztcclxuICAgIH1cclxufVxyXG4vKipcclxuICogTWV0aG9kIHRvIGJlIHVzZWQgdG8gY2FzdCBkb3duIHRvIG91ciBwcml2YXRlIGltcGxtZW50YXRpb24gb2YgQXV0aC5cclxuICogSXQgd2lsbCBhbHNvIGhhbmRsZSB1bndyYXBwaW5nIGZyb20gdGhlIGNvbXBhdCB0eXBlIGlmIG5lY2Vzc2FyeVxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCBBdXRoIG9iamVjdCBwYXNzZWQgaW4gZnJvbSBkZXZlbG9wZXJcclxuICovXHJcbmZ1bmN0aW9uIF9jYXN0QXV0aChhdXRoKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpO1xyXG59XHJcbi8qKiBIZWxwZXIgY2xhc3MgdG8gd3JhcCBzdWJzY3JpYmVyIGxvZ2ljICovXHJcbmNsYXNzIFN1YnNjcmlwdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLm9ic2VydmVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFkZE9ic2VydmVyID0gY3JlYXRlU3Vic2NyaWJlKG9ic2VydmVyID0+ICh0aGlzLm9ic2VydmVyID0gb2JzZXJ2ZXIpKTtcclxuICAgIH1cclxuICAgIGdldCBuZXh0KCkge1xyXG4gICAgICAgIF9hc3NlcnQodGhpcy5vYnNlcnZlciwgdGhpcy5hdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIubmV4dC5iaW5kKHRoaXMub2JzZXJ2ZXIpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBDaGFuZ2VzIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdG8gY29tbXVuaWNhdGUgd2l0aCB0aGUgRmlyZWJhc2UgQXV0aCBFbXVsYXRvciwgaW5zdGVhZCBvZiBwcm9kdWN0aW9uXHJcbiAqIEZpcmViYXNlIEF1dGggc2VydmljZXMuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoaXMgbXVzdCBiZSBjYWxsZWQgc3luY2hyb25vdXNseSBpbW1lZGlhdGVseSBmb2xsb3dpbmcgdGhlIGZpcnN0IGNhbGwgdG9cclxuICoge0BsaW5rIGluaXRpYWxpemVBdXRofS4gIERvIG5vdCB1c2Ugd2l0aCBwcm9kdWN0aW9uIGNyZWRlbnRpYWxzIGFzIGVtdWxhdG9yXHJcbiAqIHRyYWZmaWMgaXMgbm90IGVuY3J5cHRlZC5cclxuICpcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsICdodHRwOi8vMTI3LjAuMC4xOjkwOTknLCB7IGRpc2FibGVXYXJuaW5nczogdHJ1ZSB9KTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIHVybCAtIFRoZSBVUkwgYXQgd2hpY2ggdGhlIGVtdWxhdG9yIGlzIHJ1bm5pbmcgKGVnLCAnaHR0cDovL2xvY2FsaG9zdDo5MDk5JykuXHJcbiAqIEBwYXJhbSBvcHRpb25zIC0gT3B0aW9uYWwuIGBvcHRpb25zLmRpc2FibGVXYXJuaW5nc2AgZGVmYXVsdHMgdG8gYGZhbHNlYC4gU2V0IGl0IHRvXHJcbiAqIGB0cnVlYCB0byBkaXNhYmxlIHRoZSB3YXJuaW5nIGJhbm5lciBhdHRhY2hlZCB0byB0aGUgRE9NLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsIHVybCwgb3B0aW9ucykge1xyXG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xyXG4gICAgX2Fzc2VydChhdXRoSW50ZXJuYWwuX2NhbkluaXRFbXVsYXRvciwgYXV0aEludGVybmFsLCBcImVtdWxhdG9yLWNvbmZpZy1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkVNVUxBVE9SX0NPTkZJR19GQUlMRUQgKi8pO1xyXG4gICAgX2Fzc2VydCgvXmh0dHBzPzpcXC9cXC8vLnRlc3QodXJsKSwgYXV0aEludGVybmFsLCBcImludmFsaWQtZW11bGF0b3Itc2NoZW1lXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0VNVUxBVE9SX1NDSEVNRSAqLyk7XHJcbiAgICBjb25zdCBkaXNhYmxlV2FybmluZ3MgPSAhIShvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuZGlzYWJsZVdhcm5pbmdzKTtcclxuICAgIGNvbnN0IHByb3RvY29sID0gZXh0cmFjdFByb3RvY29sKHVybCk7XHJcbiAgICBjb25zdCB7IGhvc3QsIHBvcnQgfSA9IGV4dHJhY3RIb3N0QW5kUG9ydCh1cmwpO1xyXG4gICAgY29uc3QgcG9ydFN0ciA9IHBvcnQgPT09IG51bGwgPyAnJyA6IGA6JHtwb3J0fWA7XHJcbiAgICAvLyBBbHdheXMgcmVwbGFjZSBwYXRoIHdpdGggXCIvXCIgKGV2ZW4gaWYgaW5wdXQgdXJsIGhhZCBubyBwYXRoIGF0IGFsbCwgb3IgaGFkIGEgZGlmZmVyZW50IG9uZSkuXHJcbiAgICBhdXRoSW50ZXJuYWwuY29uZmlnLmVtdWxhdG9yID0geyB1cmw6IGAke3Byb3RvY29sfS8vJHtob3N0fSR7cG9ydFN0cn0vYCB9O1xyXG4gICAgYXV0aEludGVybmFsLnNldHRpbmdzLmFwcFZlcmlmaWNhdGlvbkRpc2FibGVkRm9yVGVzdGluZyA9IHRydWU7XHJcbiAgICBhdXRoSW50ZXJuYWwuZW11bGF0b3JDb25maWcgPSBPYmplY3QuZnJlZXplKHtcclxuICAgICAgICBob3N0LFxyXG4gICAgICAgIHBvcnQsXHJcbiAgICAgICAgcHJvdG9jb2w6IHByb3RvY29sLnJlcGxhY2UoJzonLCAnJyksXHJcbiAgICAgICAgb3B0aW9uczogT2JqZWN0LmZyZWV6ZSh7IGRpc2FibGVXYXJuaW5ncyB9KVxyXG4gICAgfSk7XHJcbiAgICBpZiAoIWRpc2FibGVXYXJuaW5ncykge1xyXG4gICAgICAgIGVtaXRFbXVsYXRvcldhcm5pbmcoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBleHRyYWN0UHJvdG9jb2wodXJsKSB7XHJcbiAgICBjb25zdCBwcm90b2NvbEVuZCA9IHVybC5pbmRleE9mKCc6Jyk7XHJcbiAgICByZXR1cm4gcHJvdG9jb2xFbmQgPCAwID8gJycgOiB1cmwuc3Vic3RyKDAsIHByb3RvY29sRW5kICsgMSk7XHJcbn1cclxuZnVuY3Rpb24gZXh0cmFjdEhvc3RBbmRQb3J0KHVybCkge1xyXG4gICAgY29uc3QgcHJvdG9jb2wgPSBleHRyYWN0UHJvdG9jb2wodXJsKTtcclxuICAgIGNvbnN0IGF1dGhvcml0eSA9IC8oXFwvXFwvKT8oW14/Iy9dKykvLmV4ZWModXJsLnN1YnN0cihwcm90b2NvbC5sZW5ndGgpKTsgLy8gQmV0d2VlbiAvLyBhbmQgLywgPyBvciAjLlxyXG4gICAgaWYgKCFhdXRob3JpdHkpIHtcclxuICAgICAgICByZXR1cm4geyBob3N0OiAnJywgcG9ydDogbnVsbCB9O1xyXG4gICAgfVxyXG4gICAgY29uc3QgaG9zdEFuZFBvcnQgPSBhdXRob3JpdHlbMl0uc3BsaXQoJ0AnKS5wb3AoKSB8fCAnJzsgLy8gU3RyaXAgb3V0IFwidXNlcm5hbWU6cGFzc3dvcmRAXCIuXHJcbiAgICBjb25zdCBicmFja2V0ZWRJUHY2ID0gL14oXFxbW15cXF1dK1xcXSkoOnwkKS8uZXhlYyhob3N0QW5kUG9ydCk7XHJcbiAgICBpZiAoYnJhY2tldGVkSVB2Nikge1xyXG4gICAgICAgIGNvbnN0IGhvc3QgPSBicmFja2V0ZWRJUHY2WzFdO1xyXG4gICAgICAgIHJldHVybiB7IGhvc3QsIHBvcnQ6IHBhcnNlUG9ydChob3N0QW5kUG9ydC5zdWJzdHIoaG9zdC5sZW5ndGggKyAxKSkgfTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IFtob3N0LCBwb3J0XSA9IGhvc3RBbmRQb3J0LnNwbGl0KCc6Jyk7XHJcbiAgICAgICAgcmV0dXJuIHsgaG9zdCwgcG9ydDogcGFyc2VQb3J0KHBvcnQpIH07XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gcGFyc2VQb3J0KHBvcnRTdHIpIHtcclxuICAgIGlmICghcG9ydFN0cikge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcG9ydCA9IE51bWJlcihwb3J0U3RyKTtcclxuICAgIGlmIChpc05hTihwb3J0KSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHBvcnQ7XHJcbn1cclxuZnVuY3Rpb24gZW1pdEVtdWxhdG9yV2FybmluZygpIHtcclxuICAgIGZ1bmN0aW9uIGF0dGFjaEJhbm5lcigpIHtcclxuICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgICBjb25zdCBzdHkgPSBlbC5zdHlsZTtcclxuICAgICAgICBlbC5pbm5lclRleHQgPVxyXG4gICAgICAgICAgICAnUnVubmluZyBpbiBlbXVsYXRvciBtb2RlLiBEbyBub3QgdXNlIHdpdGggcHJvZHVjdGlvbiBjcmVkZW50aWFscy4nO1xyXG4gICAgICAgIHN0eS5wb3NpdGlvbiA9ICdmaXhlZCc7XHJcbiAgICAgICAgc3R5LndpZHRoID0gJzEwMCUnO1xyXG4gICAgICAgIHN0eS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2ZmZmZmZic7XHJcbiAgICAgICAgc3R5LmJvcmRlciA9ICcuMWVtIHNvbGlkICMwMDAwMDAnO1xyXG4gICAgICAgIHN0eS5jb2xvciA9ICcjYjUwMDAwJztcclxuICAgICAgICBzdHkuYm90dG9tID0gJzBweCc7XHJcbiAgICAgICAgc3R5LmxlZnQgPSAnMHB4JztcclxuICAgICAgICBzdHkubWFyZ2luID0gJzBweCc7XHJcbiAgICAgICAgc3R5LnpJbmRleCA9ICcxMDAwMCc7XHJcbiAgICAgICAgc3R5LnRleHRBbGlnbiA9ICdjZW50ZXInO1xyXG4gICAgICAgIGVsLmNsYXNzTGlzdC5hZGQoJ2ZpcmViYXNlLWVtdWxhdG9yLXdhcm5pbmcnKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGNvbnNvbGUuaW5mbyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIGNvbnNvbGUuaW5mbygnV0FSTklORzogWW91IGFyZSB1c2luZyB0aGUgQXV0aCBFbXVsYXRvciwnICtcclxuICAgICAgICAgICAgJyB3aGljaCBpcyBpbnRlbmRlZCBmb3IgbG9jYWwgdGVzdGluZyBvbmx5LiAgRG8gbm90IHVzZSB3aXRoJyArXHJcbiAgICAgICAgICAgICcgcHJvZHVjdGlvbiBjcmVkZW50aWFscy4nKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdsb2FkaW5nJykge1xyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGF0dGFjaEJhbm5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBhdHRhY2hCYW5uZXIoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEludGVyZmFjZSB0aGF0IHJlcHJlc2VudHMgdGhlIGNyZWRlbnRpYWxzIHJldHVybmVkIGJ5IGFuIHtAbGluayBBdXRoUHJvdmlkZXJ9LlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBJbXBsZW1lbnRhdGlvbnMgc3BlY2lmeSB0aGUgZGV0YWlscyBhYm91dCBlYWNoIGF1dGggcHJvdmlkZXIncyBjcmVkZW50aWFsIHJlcXVpcmVtZW50cy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBhdXRoZW50aWNhdGlvbiBwcm92aWRlciBJRCBmb3IgdGhlIGNyZWRlbnRpYWwuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIEZvciBleGFtcGxlLCAnZmFjZWJvb2suY29tJywgb3IgJ2dvb2dsZS5jb20nLlxyXG4gICAgICovXHJcbiAgICBwcm92aWRlcklkLCBcclxuICAgIC8qKlxyXG4gICAgICogVGhlIGF1dGhlbnRpY2F0aW9uIHNpZ24gaW4gbWV0aG9kIGZvciB0aGUgY3JlZGVudGlhbC5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICogRm9yIGV4YW1wbGUsIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JELCBvclxyXG4gICAgICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgc2lnbi1pbiBtZXRob2RcclxuICAgICAqIGlkZW50aWZpZXIgYXMgcmV0dXJuZWQgaW4ge0BsaW5rIGZldGNoU2lnbkluTWV0aG9kc0ZvckVtYWlsfS5cclxuICAgICAqL1xyXG4gICAgc2lnbkluTWV0aG9kKSB7XHJcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDtcclxuICAgICAgICB0aGlzLnNpZ25Jbk1ldGhvZCA9IHNpZ25Jbk1ldGhvZDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0LlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoX2F1dGgpIHtcclxuICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9saW5rVG9JZFRva2VuKF9hdXRoLCBfaWRUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihfYXV0aCkge1xyXG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlc2V0UGFzc3dvcmQoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnJlc2V0UGFzc3dvcmRcIiAvKiBFbmRwb2ludC5SRVNFVF9QQVNTV09SRCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVFbWFpbFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czp1cGRhdGVcIiAvKiBFbmRwb2ludC5TRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBhcHBseUFjdGlvbkNvZGUkMShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6dXBkYXRlXCIgLyogRW5kcG9pbnQuU0VUX0FDQ09VTlRfSU5GTyAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoUGFzc3dvcmQoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQYXNzd29yZFwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9QQVNTV09SRCAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBzZW5kT29iQ29kZShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2VuZE9vYkNvZGVcIiAvKiBFbmRwb2ludC5TRU5EX09PQl9DT0RFICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHNlbmRFbWFpbFZlcmlmaWNhdGlvbiQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBzZW5kT29iQ29kZShhdXRoLCByZXF1ZXN0KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBzZW5kUGFzc3dvcmRSZXNldEVtYWlsJDEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIHNlbmRPb2JDb2RlKGF1dGgsIHJlcXVlc3QpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHNlbmRTaWduSW5MaW5rVG9FbWFpbCQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBzZW5kT29iQ29kZShhdXRoLCByZXF1ZXN0KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlBbmRDaGFuZ2VFbWFpbChhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gc2VuZE9vYkNvZGUoYXV0aCwgcmVxdWVzdCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEVtYWlsTGluayQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoRW1haWxMaW5rXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0VNQUlMX0xJTksgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEVtYWlsTGlua0ZvckxpbmtpbmcoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhFbWFpbExpbmtcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfRU1BSUxfTElOSyAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogSW50ZXJmYWNlIHRoYXQgcmVwcmVzZW50cyB0aGUgY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSBmb3JcclxuICoge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JEXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIENvdmVycyBib3RoIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JEIGFuZFxyXG4gKiB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9MSU5LLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBFbWFpbEF1dGhDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZW1haWwsIFxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX3Bhc3N3b3JkLCBzaWduSW5NZXRob2QsIFxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX3RlbmFudElkID0gbnVsbCkge1xyXG4gICAgICAgIHN1cGVyKFwicGFzc3dvcmRcIiAvKiBQcm92aWRlcklkLlBBU1NXT1JEICovLCBzaWduSW5NZXRob2QpO1xyXG4gICAgICAgIHRoaXMuX2VtYWlsID0gX2VtYWlsO1xyXG4gICAgICAgIHRoaXMuX3Bhc3N3b3JkID0gX3Bhc3N3b3JkO1xyXG4gICAgICAgIHRoaXMuX3RlbmFudElkID0gX3RlbmFudElkO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIF9mcm9tRW1haWxBbmRQYXNzd29yZChlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEVtYWlsQXV0aENyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkLCBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbUVtYWlsQW5kQ29kZShlbWFpbCwgb29iQ29kZSwgdGVuYW50SWQgPSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBFbWFpbEF1dGhDcmVkZW50aWFsKGVtYWlsLCBvb2JDb2RlLCBcImVtYWlsTGlua1wiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovLCB0ZW5hbnRJZCk7XHJcbiAgICB9XHJcbiAgICAvKioge0Bpbmhlcml0ZG9jIEF1dGhDcmVkZW50aWFsLnRvSlNPTn0gKi9cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLl9wYXNzd29yZCxcclxuICAgICAgICAgICAgc2lnbkluTWV0aG9kOiB0aGlzLnNpZ25Jbk1ldGhvZCxcclxuICAgICAgICAgICAgdGVuYW50SWQ6IHRoaXMuX3RlbmFudElkXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU3RhdGljIG1ldGhvZCB0byBkZXNlcmlhbGl6ZSBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0IGludG8gYW4ge0BsaW5rICBBdXRoQ3JlZGVudGlhbH0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGpzb24gLSBFaXRoZXIgYG9iamVjdGAgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuIFdoZW4gc3RyaW5nIGlzXHJcbiAgICAgKiBwcm92aWRlZCwgYEpTT04ucGFyc2VgIHdvdWxkIGJlIGNhbGxlZCBmaXJzdC5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBJZiB0aGUgSlNPTiBpbnB1dCBkb2VzIG5vdCByZXByZXNlbnQgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSwgbnVsbCBpcyByZXR1cm5lZC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZyb21KU09OKGpzb24pIHtcclxuICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjtcclxuICAgICAgICBpZiAoKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9iai5lbWFpbCkgJiYgKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9iai5wYXNzd29yZCkpIHtcclxuICAgICAgICAgICAgaWYgKG9iai5zaWduSW5NZXRob2QgPT09IFwicGFzc3dvcmRcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi8pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRW1haWxBbmRQYXNzd29yZChvYmouZW1haWwsIG9iai5wYXNzd29yZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAob2JqLnNpZ25Jbk1ldGhvZCA9PT0gXCJlbWFpbExpbmtcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21FbWFpbEFuZENvZGUob2JqLmVtYWlsLCBvYmoucGFzc3dvcmQsIG9iai50ZW5hbnRJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBhc3luYyBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuc2lnbkluTWV0aG9kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJwYXNzd29yZFwiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9QQVNTV09SRCAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBzaWduSW5XaXRoUGFzc3dvcmQoYXV0aCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjYXNlIFwiZW1haWxMaW5rXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi86XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aEVtYWlsTGluayQxKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsXHJcbiAgICAgICAgICAgICAgICAgICAgb29iQ29kZTogdGhpcy5fcGFzc3dvcmRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIGFzeW5jIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuc2lnbkluTWV0aG9kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJwYXNzd29yZFwiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9QQVNTV09SRCAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVFbWFpbFBhc3N3b3JkKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjYXNlIFwiZW1haWxMaW5rXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi86XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aEVtYWlsTGlua0ZvckxpbmtpbmcoYXV0aCwge1xyXG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLFxyXG4gICAgICAgICAgICAgICAgICAgIG9vYkNvZGU6IHRoaXMuX3Bhc3N3b3JkXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhJZHBcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfSURQICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IElEUF9SRVFVRVNUX1VSSSQxID0gJ2h0dHA6Ly9sb2NhbGhvc3QnO1xyXG4vKipcclxuICogUmVwcmVzZW50cyB0aGUgT0F1dGggY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9LlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBJbXBsZW1lbnRhdGlvbnMgc3BlY2lmeSB0aGUgZGV0YWlscyBhYm91dCBlYWNoIGF1dGggcHJvdmlkZXIncyBjcmVkZW50aWFsIHJlcXVpcmVtZW50cy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgT0F1dGhDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgICAgICB0aGlzLnBlbmRpbmdUb2tlbiA9IG51bGw7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBzdGF0aWMgX2Zyb21QYXJhbXMocGFyYW1zKSB7XHJcbiAgICAgICAgY29uc3QgY3JlZCA9IG5ldyBPQXV0aENyZWRlbnRpYWwocGFyYW1zLnByb3ZpZGVySWQsIHBhcmFtcy5zaWduSW5NZXRob2QpO1xyXG4gICAgICAgIGlmIChwYXJhbXMuaWRUb2tlbiB8fCBwYXJhbXMuYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgLy8gT0F1dGggMiBhbmQgZWl0aGVyIElEIHRva2VuIG9yIGFjY2VzcyB0b2tlbi5cclxuICAgICAgICAgICAgaWYgKHBhcmFtcy5pZFRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjcmVkLmlkVG9rZW4gPSBwYXJhbXMuaWRUb2tlbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocGFyYW1zLmFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcGFyYW1zLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIEFkZCBub25jZSBpZiBhdmFpbGFibGUgYW5kIG5vIHBlbmRpbmdUb2tlbiBpcyBwcmVzZW50LlxyXG4gICAgICAgICAgICBpZiAocGFyYW1zLm5vbmNlICYmICFwYXJhbXMucGVuZGluZ1Rva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjcmVkLm5vbmNlID0gcGFyYW1zLm5vbmNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwYXJhbXMucGVuZGluZ1Rva2VuKSB7XHJcbiAgICAgICAgICAgICAgICBjcmVkLnBlbmRpbmdUb2tlbiA9IHBhcmFtcy5wZW5kaW5nVG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocGFyYW1zLm9hdXRoVG9rZW4gJiYgcGFyYW1zLm9hdXRoVG9rZW5TZWNyZXQpIHtcclxuICAgICAgICAgICAgLy8gT0F1dGggMSBhbmQgT0F1dGggdG9rZW4gd2l0aCB0b2tlbiBzZWNyZXRcclxuICAgICAgICAgICAgY3JlZC5hY2Nlc3NUb2tlbiA9IHBhcmFtcy5vYXV0aFRva2VuO1xyXG4gICAgICAgICAgICBjcmVkLnNlY3JldCA9IHBhcmFtcy5vYXV0aFRva2VuU2VjcmV0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgX2ZhaWwoXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY3JlZDtcclxuICAgIH1cclxuICAgIC8qKiB7QGluaGVyaXRkb2MgQXV0aENyZWRlbnRpYWwudG9KU09OfSAgKi9cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpZFRva2VuOiB0aGlzLmlkVG9rZW4sXHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICBzZWNyZXQ6IHRoaXMuc2VjcmV0LFxyXG4gICAgICAgICAgICBub25jZTogdGhpcy5ub25jZSxcclxuICAgICAgICAgICAgcGVuZGluZ1Rva2VuOiB0aGlzLnBlbmRpbmdUb2tlbixcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogdGhpcy5wcm92aWRlcklkLFxyXG4gICAgICAgICAgICBzaWduSW5NZXRob2Q6IHRoaXMuc2lnbkluTWV0aG9kXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU3RhdGljIG1ldGhvZCB0byBkZXNlcmlhbGl6ZSBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0IGludG8gYW5cclxuICAgICAqIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBqc29uIC0gSW5wdXQgY2FuIGJlIGVpdGhlciBPYmplY3Qgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuXHJcbiAgICAgKiBXaGVuIHN0cmluZyBpcyBwcm92aWRlZCwgSlNPTi5wYXJzZSB3b3VsZCBiZSBjYWxsZWQgZmlyc3QuXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMgSWYgdGhlIEpTT04gaW5wdXQgZG9lcyBub3QgcmVwcmVzZW50IGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LCBudWxsIGlzIHJldHVybmVkLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikge1xyXG4gICAgICAgIGNvbnN0IG9iaiA9IHR5cGVvZiBqc29uID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UoanNvbikgOiBqc29uO1xyXG4gICAgICAgIGNvbnN0IHsgcHJvdmlkZXJJZCwgc2lnbkluTWV0aG9kIH0gPSBvYmosIHJlc3QgPSBfX3Jlc3Qob2JqLCBbXCJwcm92aWRlcklkXCIsIFwic2lnbkluTWV0aG9kXCJdKTtcclxuICAgICAgICBpZiAoIXByb3ZpZGVySWQgfHwgIXNpZ25Jbk1ldGhvZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgY3JlZCA9IG5ldyBPQXV0aENyZWRlbnRpYWwocHJvdmlkZXJJZCwgc2lnbkluTWV0aG9kKTtcclxuICAgICAgICBjcmVkLmlkVG9rZW4gPSByZXN0LmlkVG9rZW4gfHwgdW5kZWZpbmVkO1xyXG4gICAgICAgIGNyZWQuYWNjZXNzVG9rZW4gPSByZXN0LmFjY2Vzc1Rva2VuIHx8IHVuZGVmaW5lZDtcclxuICAgICAgICBjcmVkLnNlY3JldCA9IHJlc3Quc2VjcmV0O1xyXG4gICAgICAgIGNyZWQubm9uY2UgPSByZXN0Lm5vbmNlO1xyXG4gICAgICAgIGNyZWQucGVuZGluZ1Rva2VuID0gcmVzdC5wZW5kaW5nVG9rZW4gfHwgbnVsbDtcclxuICAgICAgICByZXR1cm4gY3JlZDtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCkge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpO1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpO1xyXG4gICAgICAgIHJlcXVlc3QuaWRUb2tlbiA9IGlkVG9rZW47XHJcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcclxuICAgICAgICByZXF1ZXN0LmF1dG9DcmVhdGUgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTtcclxuICAgIH1cclxuICAgIGJ1aWxkUmVxdWVzdCgpIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICByZXF1ZXN0VXJpOiBJRFBfUkVRVUVTVF9VUkkkMSxcclxuICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLnBlbmRpbmdUb2tlbikge1xyXG4gICAgICAgICAgICByZXF1ZXN0LnBlbmRpbmdUb2tlbiA9IHRoaXMucGVuZGluZ1Rva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgcG9zdEJvZHkgPSB7fTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaWRUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgcG9zdEJvZHlbJ2lkX3Rva2VuJ10gPSB0aGlzLmlkVG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHBvc3RCb2R5WydhY2Nlc3NfdG9rZW4nXSA9IHRoaXMuYWNjZXNzVG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VjcmV0KSB7XHJcbiAgICAgICAgICAgICAgICBwb3N0Qm9keVsnb2F1dGhfdG9rZW5fc2VjcmV0J10gPSB0aGlzLnNlY3JldDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwb3N0Qm9keVsncHJvdmlkZXJJZCddID0gdGhpcy5wcm92aWRlcklkO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5ub25jZSAmJiAhdGhpcy5wZW5kaW5nVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHBvc3RCb2R5Wydub25jZSddID0gdGhpcy5ub25jZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXF1ZXN0LnBvc3RCb2R5ID0gcXVlcnlzdHJpbmcocG9zdEJvZHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVxdWVzdDtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzZW5kUGhvbmVWZXJpZmljYXRpb25Db2RlKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzZW5kVmVyaWZpY2F0aW9uQ29kZVwiIC8qIEVuZHBvaW50LlNFTkRfVkVSSUZJQ0FUSU9OX0NPREUgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aFBob25lTnVtYmVyJDEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQaG9uZU51bWJlclwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9QSE9ORV9OVU1CRVIgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gbGlua1dpdGhQaG9uZU51bWJlciQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aFBob25lTnVtYmVyXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX1BIT05FX05VTUJFUiAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcclxuICAgIGlmIChyZXNwb25zZS50ZW1wb3JhcnlQcm9vZikge1xyXG4gICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgXCJhY2NvdW50LWV4aXN0cy13aXRoLWRpZmZlcmVudC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5ORUVEX0NPTkZJUk1BVElPTiAqLywgcmVzcG9uc2UpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xyXG59XHJcbmNvbnN0IFZFUklGWV9QSE9ORV9OVU1CRVJfRk9SX0VYSVNUSU5HX0VSUk9SX01BUF8gPSB7XHJcbiAgICBbXCJVU0VSX05PVF9GT1VORFwiIC8qIFNlcnZlckVycm9yLlVTRVJfTk9UX0ZPVU5EICovXTogXCJ1c2VyLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ERUxFVEVEICovXHJcbn07XHJcbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeVBob25lTnVtYmVyRm9yRXhpc3RpbmcoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgY29uc3QgYXBpUmVxdWVzdCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdCksIHsgb3BlcmF0aW9uOiAnUkVBVVRIJyB9KTtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoUGhvbmVOdW1iZXJcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfUEhPTkVfTlVNQkVSICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgYXBpUmVxdWVzdCksIFZFUklGWV9QSE9ORV9OVU1CRVJfRk9SX0VYSVNUSU5HX0VSUk9SX01BUF8pO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIHRoZSBjcmVkZW50aWFscyByZXR1cm5lZCBieSB7QGxpbmsgUGhvbmVBdXRoUHJvdmlkZXJ9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBQaG9uZUF1dGhDcmVkZW50aWFsIGV4dGVuZHMgQXV0aENyZWRlbnRpYWwge1xyXG4gICAgY29uc3RydWN0b3IocGFyYW1zKSB7XHJcbiAgICAgICAgc3VwZXIoXCJwaG9uZVwiIC8qIFByb3ZpZGVySWQuUEhPTkUgKi8sIFwicGhvbmVcIiAvKiBTaWduSW5NZXRob2QuUEhPTkUgKi8pO1xyXG4gICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIF9mcm9tVmVyaWZpY2F0aW9uKHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQaG9uZUF1dGhDcmVkZW50aWFsKHsgdmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUgfSk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBzdGF0aWMgX2Zyb21Ub2tlblJlc3BvbnNlKHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZikge1xyXG4gICAgICAgIHJldHVybiBuZXcgUGhvbmVBdXRoQ3JlZGVudGlhbCh7IHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZiB9KTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCkge1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoUGhvbmVOdW1iZXIkMShhdXRoLCB0aGlzLl9tYWtlVmVyaWZpY2F0aW9uUmVxdWVzdCgpKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gbGlua1dpdGhQaG9uZU51bWJlciQxKGF1dGgsIE9iamVjdC5hc3NpZ24oeyBpZFRva2VuIH0sIHRoaXMuX21ha2VWZXJpZmljYXRpb25SZXF1ZXN0KCkpKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9nZXRSZWF1dGhlbnRpY2F0aW9uUmVzb2x2ZXIoYXV0aCkge1xyXG4gICAgICAgIHJldHVybiB2ZXJpZnlQaG9uZU51bWJlckZvckV4aXN0aW5nKGF1dGgsIHRoaXMuX21ha2VWZXJpZmljYXRpb25SZXF1ZXN0KCkpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX21ha2VWZXJpZmljYXRpb25SZXF1ZXN0KCkge1xyXG4gICAgICAgIGNvbnN0IHsgdGVtcG9yYXJ5UHJvb2YsIHBob25lTnVtYmVyLCB2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSB9ID0gdGhpcy5wYXJhbXM7XHJcbiAgICAgICAgaWYgKHRlbXBvcmFyeVByb29mICYmIHBob25lTnVtYmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHRlbXBvcmFyeVByb29mLCBwaG9uZU51bWJlciB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzZXNzaW9uSW5mbzogdmVyaWZpY2F0aW9uSWQsXHJcbiAgICAgICAgICAgIGNvZGU6IHZlcmlmaWNhdGlvbkNvZGVcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICovXHJcbiAgICB0b0pTT04oKSB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0ge1xyXG4gICAgICAgICAgICBwcm92aWRlcklkOiB0aGlzLnByb3ZpZGVySWRcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmFtcy5waG9uZU51bWJlcikge1xyXG4gICAgICAgICAgICBvYmoucGhvbmVOdW1iZXIgPSB0aGlzLnBhcmFtcy5waG9uZU51bWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMucGFyYW1zLnRlbXBvcmFyeVByb29mKSB7XHJcbiAgICAgICAgICAgIG9iai50ZW1wb3JhcnlQcm9vZiA9IHRoaXMucGFyYW1zLnRlbXBvcmFyeVByb29mO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5wYXJhbXMudmVyaWZpY2F0aW9uQ29kZSkge1xyXG4gICAgICAgICAgICBvYmoudmVyaWZpY2F0aW9uQ29kZSA9IHRoaXMucGFyYW1zLnZlcmlmaWNhdGlvbkNvZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBhcmFtcy52ZXJpZmljYXRpb25JZCkge1xyXG4gICAgICAgICAgICBvYmoudmVyaWZpY2F0aW9uSWQgPSB0aGlzLnBhcmFtcy52ZXJpZmljYXRpb25JZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH1cclxuICAgIC8qKiBHZW5lcmF0ZXMgYSBwaG9uZSBjcmVkZW50aWFsIGJhc2VkIG9uIGEgcGxhaW4gb2JqZWN0IG9yIGEgSlNPTiBzdHJpbmcuICovXHJcbiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikge1xyXG4gICAgICAgIGlmICh0eXBlb2YganNvbiA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAganNvbiA9IEpTT04ucGFyc2UoanNvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgdmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUsIHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZiB9ID0ganNvbjtcclxuICAgICAgICBpZiAoIXZlcmlmaWNhdGlvbkNvZGUgJiZcclxuICAgICAgICAgICAgIXZlcmlmaWNhdGlvbklkICYmXHJcbiAgICAgICAgICAgICFwaG9uZU51bWJlciAmJlxyXG4gICAgICAgICAgICAhdGVtcG9yYXJ5UHJvb2YpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUGhvbmVBdXRoQ3JlZGVudGlhbCh7XHJcbiAgICAgICAgICAgIHZlcmlmaWNhdGlvbklkLFxyXG4gICAgICAgICAgICB2ZXJpZmljYXRpb25Db2RlLFxyXG4gICAgICAgICAgICBwaG9uZU51bWJlcixcclxuICAgICAgICAgICAgdGVtcG9yYXJ5UHJvb2ZcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogTWFwcyB0aGUgbW9kZSBzdHJpbmcgaW4gYWN0aW9uIGNvZGUgVVJMIHRvIEFjdGlvbiBDb2RlIEluZm8gb3BlcmF0aW9uLlxyXG4gKlxyXG4gKiBAcGFyYW0gbW9kZVxyXG4gKi9cclxuZnVuY3Rpb24gcGFyc2VNb2RlKG1vZGUpIHtcclxuICAgIHN3aXRjaCAobW9kZSkge1xyXG4gICAgICAgIGNhc2UgJ3JlY292ZXJFbWFpbCc6XHJcbiAgICAgICAgICAgIHJldHVybiBcIlJFQ09WRVJfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlJFQ09WRVJfRU1BSUwgKi87XHJcbiAgICAgICAgY2FzZSAncmVzZXRQYXNzd29yZCc6XHJcbiAgICAgICAgICAgIHJldHVybiBcIlBBU1NXT1JEX1JFU0VUXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5QQVNTV09SRF9SRVNFVCAqLztcclxuICAgICAgICBjYXNlICdzaWduSW4nOlxyXG4gICAgICAgICAgICByZXR1cm4gXCJFTUFJTF9TSUdOSU5cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLkVNQUlMX1NJR05JTiAqLztcclxuICAgICAgICBjYXNlICd2ZXJpZnlFbWFpbCc6XHJcbiAgICAgICAgICAgIHJldHVybiBcIlZFUklGWV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0VNQUlMICovO1xyXG4gICAgICAgIGNhc2UgJ3ZlcmlmeUFuZENoYW5nZUVtYWlsJzpcclxuICAgICAgICAgICAgcmV0dXJuIFwiVkVSSUZZX0FORF9DSEFOR0VfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMICovO1xyXG4gICAgICAgIGNhc2UgJ3JldmVydFNlY29uZEZhY3RvckFkZGl0aW9uJzpcclxuICAgICAgICAgICAgcmV0dXJuIFwiUkVWRVJUX1NFQ09ORF9GQUNUT1JfQURESVRJT05cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OICovO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBIZWxwZXIgdG8gcGFyc2UgRkRMIGxpbmtzXHJcbiAqXHJcbiAqIEBwYXJhbSB1cmxcclxuICovXHJcbmZ1bmN0aW9uIHBhcnNlRGVlcExpbmsodXJsKSB7XHJcbiAgICBjb25zdCBsaW5rID0gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkpWydsaW5rJ107XHJcbiAgICAvLyBEb3VibGUgbGluayBjYXNlIChhdXRvbWF0aWMgcmVkaXJlY3QpLlxyXG4gICAgY29uc3QgZG91YmxlRGVlcExpbmsgPSBsaW5rXHJcbiAgICAgICAgPyBxdWVyeXN0cmluZ0RlY29kZShleHRyYWN0UXVlcnlzdHJpbmcobGluaykpWydkZWVwX2xpbmtfaWQnXVxyXG4gICAgICAgIDogbnVsbDtcclxuICAgIC8vIGlPUyBjdXN0b20gc2NoZW1lIGxpbmtzLlxyXG4gICAgY29uc3QgaU9TRGVlcExpbmsgPSBxdWVyeXN0cmluZ0RlY29kZShleHRyYWN0UXVlcnlzdHJpbmcodXJsKSlbJ2RlZXBfbGlua19pZCddO1xyXG4gICAgY29uc3QgaU9TRG91YmxlRGVlcExpbmsgPSBpT1NEZWVwTGlua1xyXG4gICAgICAgID8gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKGlPU0RlZXBMaW5rKSlbJ2xpbmsnXVxyXG4gICAgICAgIDogbnVsbDtcclxuICAgIHJldHVybiBpT1NEb3VibGVEZWVwTGluayB8fCBpT1NEZWVwTGluayB8fCBkb3VibGVEZWVwTGluayB8fCBsaW5rIHx8IHVybDtcclxufVxyXG4vKipcclxuICogQSB1dGlsaXR5IGNsYXNzIHRvIHBhcnNlIGVtYWlsIGFjdGlvbiBVUkxzIHN1Y2ggYXMgcGFzc3dvcmQgcmVzZXQsIGVtYWlsIHZlcmlmaWNhdGlvbixcclxuICogZW1haWwgbGluayBzaWduIGluLCBldGMuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIEFjdGlvbkNvZGVVUkwge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gYWN0aW9uTGluayAtIFRoZSBsaW5rIGZyb20gd2hpY2ggdG8gZXh0cmFjdCB0aGUgVVJMLlxyXG4gICAgICogQHJldHVybnMgVGhlIHtAbGluayBBY3Rpb25Db2RlVVJMfSBvYmplY3QsIG9yIG51bGwgaWYgdGhlIGxpbmsgaXMgaW52YWxpZC5cclxuICAgICAqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoYWN0aW9uTGluaykge1xyXG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mO1xyXG4gICAgICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyhhY3Rpb25MaW5rKSk7XHJcbiAgICAgICAgY29uc3QgYXBpS2V5ID0gKF9hID0gc2VhcmNoUGFyYW1zW1wiYXBpS2V5XCIgLyogUXVlcnlGaWVsZC5BUElfS0VZICovXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbDtcclxuICAgICAgICBjb25zdCBjb2RlID0gKF9iID0gc2VhcmNoUGFyYW1zW1wib29iQ29kZVwiIC8qIFF1ZXJ5RmllbGQuQ09ERSAqL10pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IG51bGw7XHJcbiAgICAgICAgY29uc3Qgb3BlcmF0aW9uID0gcGFyc2VNb2RlKChfYyA9IHNlYXJjaFBhcmFtc1tcIm1vZGVcIiAvKiBRdWVyeUZpZWxkLk1PREUgKi9dKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiBudWxsKTtcclxuICAgICAgICAvLyBWYWxpZGF0ZSBBUEkga2V5LCBjb2RlIGFuZCBtb2RlLlxyXG4gICAgICAgIF9hc3NlcnQoYXBpS2V5ICYmIGNvZGUgJiYgb3BlcmF0aW9uLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgdGhpcy5hcGlLZXkgPSBhcGlLZXk7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb24gPSBvcGVyYXRpb247XHJcbiAgICAgICAgdGhpcy5jb2RlID0gY29kZTtcclxuICAgICAgICB0aGlzLmNvbnRpbnVlVXJsID0gKF9kID0gc2VhcmNoUGFyYW1zW1wiY29udGludWVVcmxcIiAvKiBRdWVyeUZpZWxkLkNPTlRJTlVFX1VSTCAqL10pICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSAoX2UgPSBzZWFyY2hQYXJhbXNbXCJsYW5ndWFnZUNvZGVcIiAvKiBRdWVyeUZpZWxkLkxBTkdVQUdFX0NPREUgKi9dKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiBudWxsO1xyXG4gICAgICAgIHRoaXMudGVuYW50SWQgPSAoX2YgPSBzZWFyY2hQYXJhbXNbXCJ0ZW5hbnRJZFwiIC8qIFF1ZXJ5RmllbGQuVEVOQU5UX0lEICovXSkgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogbnVsbDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUGFyc2VzIHRoZSBlbWFpbCBhY3Rpb24gbGluayBzdHJpbmcgYW5kIHJldHVybnMgYW4ge0BsaW5rIEFjdGlvbkNvZGVVUkx9IGlmIHRoZSBsaW5rIGlzIHZhbGlkLFxyXG4gICAgICogb3RoZXJ3aXNlIHJldHVybnMgbnVsbC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbGluayAgLSBUaGUgZW1haWwgYWN0aW9uIGxpbmsgc3RyaW5nLlxyXG4gICAgICogQHJldHVybnMgVGhlIHtAbGluayBBY3Rpb25Db2RlVVJMfSBvYmplY3QsIG9yIG51bGwgaWYgdGhlIGxpbmsgaXMgaW52YWxpZC5cclxuICAgICAqXHJcbiAgICAgKiBAcHVibGljXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBwYXJzZUxpbmsobGluaykge1xyXG4gICAgICAgIGNvbnN0IGFjdGlvbkxpbmsgPSBwYXJzZURlZXBMaW5rKGxpbmspO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQWN0aW9uQ29kZVVSTChhY3Rpb25MaW5rKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKipcclxuICogUGFyc2VzIHRoZSBlbWFpbCBhY3Rpb24gbGluayBzdHJpbmcgYW5kIHJldHVybnMgYW4ge0BsaW5rIEFjdGlvbkNvZGVVUkx9IGlmXHJcbiAqIHRoZSBsaW5rIGlzIHZhbGlkLCBvdGhlcndpc2UgcmV0dXJucyBudWxsLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBwYXJzZUFjdGlvbkNvZGVVUkwobGluaykge1xyXG4gICAgcmV0dXJuIEFjdGlvbkNvZGVVUkwucGFyc2VMaW5rKGxpbmspO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyB7QGxpbmsgRW1haWxBdXRoQ3JlZGVudGlhbH0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIEVtYWlsQXV0aFByb3ZpZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JELCBldmVuIGZvciBlbWFpbCBsaW5rLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IEVtYWlsQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbml0aWFsaXplIGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0gdXNpbmcgYW4gZW1haWwgYW5kIHBhc3N3b3JkLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiBjb25zdCBhdXRoQ3JlZGVudGlhbCA9IEVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKTtcclxuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgYXV0aENyZWRlbnRpYWwpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlbWFpbCAtIEVtYWlsIGFkZHJlc3MuXHJcbiAgICAgKiBAcGFyYW0gcGFzc3dvcmQgLSBVc2VyIGFjY291bnQgcGFzc3dvcmQuXHJcbiAgICAgKiBAcmV0dXJucyBUaGUgYXV0aCBwcm92aWRlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgICAgICByZXR1cm4gRW1haWxBdXRoQ3JlZGVudGlhbC5fZnJvbUVtYWlsQW5kUGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGl6ZSBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9IHVzaW5nIGFuIGVtYWlsIGFuZCBhbiBlbWFpbCBsaW5rIGFmdGVyIGEgc2lnbiBpbiB3aXRoXHJcbiAgICAgKiBlbWFpbCBsaW5rIG9wZXJhdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogY29uc3QgYXV0aENyZWRlbnRpYWwgPSBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsV2l0aExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluayk7XHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGF1dGhDcmVkZW50aWFsKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiBhd2FpdCBzZW5kU2lnbkluTGlua1RvRW1haWwoYXV0aCwgZW1haWwpO1xyXG4gICAgICogLy8gT2J0YWluIGVtYWlsTGluayBmcm9tIHVzZXIuXHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluayk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdXNlZCB0byB2ZXJpZnkgdGhlIGxpbmsuXHJcbiAgICAgKiBAcGFyYW0gZW1haWwgLSBFbWFpbCBhZGRyZXNzLlxyXG4gICAgICogQHBhcmFtIGVtYWlsTGluayAtIFNpZ24taW4gZW1haWwgbGluay5cclxuICAgICAqIEByZXR1cm5zIC0gVGhlIGF1dGggcHJvdmlkZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxXaXRoTGluayhlbWFpbCwgZW1haWxMaW5rKSB7XHJcbiAgICAgICAgY29uc3QgYWN0aW9uQ29kZVVybCA9IEFjdGlvbkNvZGVVUkwucGFyc2VMaW5rKGVtYWlsTGluayk7XHJcbiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlVXJsLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgcmV0dXJuIEVtYWlsQXV0aENyZWRlbnRpYWwuX2Zyb21FbWFpbEFuZENvZGUoZW1haWwsIGFjdGlvbkNvZGVVcmwuY29kZSwgYWN0aW9uQ29kZVVybC50ZW5hbnRJZCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JELCBldmVuIGZvciBlbWFpbCBsaW5rLlxyXG4gKi9cclxuRW1haWxBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSBcInBhc3N3b3JkXCIgLyogUHJvdmlkZXJJZC5QQVNTV09SRCAqLztcclxuLyoqXHJcbiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfUEFTU1dPUkQuXHJcbiAqL1xyXG5FbWFpbEF1dGhQcm92aWRlci5FTUFJTF9QQVNTV09SRF9TSUdOX0lOX01FVEhPRCA9IFwicGFzc3dvcmRcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi87XHJcbi8qKlxyXG4gKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX0xJTksuXHJcbiAqL1xyXG5FbWFpbEF1dGhQcm92aWRlci5FTUFJTF9MSU5LX1NJR05fSU5fTUVUSE9EID0gXCJlbWFpbExpbmtcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRoZSBiYXNlIGNsYXNzIGZvciBhbGwgRmVkZXJhdGVkIHByb3ZpZGVycyAoT0F1dGggKGluY2x1ZGluZyBPSURDKSwgU0FNTCkuXHJcbiAqXHJcbiAqIFRoaXMgY2xhc3MgaXMgbm90IG1lYW50IHRvIGJlIGluc3RhbnRpYXRlZCBkaXJlY3RseS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgRmVkZXJhdGVkQXV0aFByb3ZpZGVyIHtcclxuICAgIC8qKlxyXG4gICAgICogQ29uc3RydWN0b3IgZm9yIGdlbmVyaWMgT0F1dGggcHJvdmlkZXJzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwcm92aWRlcklkIC0gUHJvdmlkZXIgZm9yIHdoaWNoIGNyZWRlbnRpYWxzIHNob3VsZCBiZSBnZW5lcmF0ZWQuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHByb3ZpZGVySWQpIHtcclxuICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSBwcm92aWRlcklkO1xyXG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgICAgICB0aGlzLmRlZmF1bHRMYW5ndWFnZUNvZGUgPSBudWxsO1xyXG4gICAgICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgICAgICB0aGlzLmN1c3RvbVBhcmFtZXRlcnMgPSB7fTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU2V0IHRoZSBsYW5ndWFnZSBnb2RlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsYW5ndWFnZUNvZGUgLSBsYW5ndWFnZSBjb2RlXHJcbiAgICAgKi9cclxuICAgIHNldERlZmF1bHRMYW5ndWFnZShsYW5ndWFnZUNvZGUpIHtcclxuICAgICAgICB0aGlzLmRlZmF1bHRMYW5ndWFnZUNvZGUgPSBsYW5ndWFnZUNvZGU7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNldHMgdGhlIE9BdXRoIGN1c3RvbSBwYXJhbWV0ZXJzIHRvIHBhc3MgaW4gYW4gT0F1dGggcmVxdWVzdCBmb3IgcG9wdXAgYW5kIHJlZGlyZWN0IHNpZ24taW5cclxuICAgICAqIG9wZXJhdGlvbnMuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIEZvciBhIGRldGFpbGVkIGxpc3QsIGNoZWNrIHRoZSByZXNlcnZlZCByZXF1aXJlZCBPQXV0aCAyLjAgcGFyYW1ldGVycyBzdWNoIGFzIGBjbGllbnRfaWRgLFxyXG4gICAgICogYHJlZGlyZWN0X3VyaWAsIGBzY29wZWAsIGByZXNwb25zZV90eXBlYCwgYW5kIGBzdGF0ZWAgYXJlIG5vdCBhbGxvd2VkIGFuZCB3aWxsIGJlIGlnbm9yZWQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGN1c3RvbU9BdXRoUGFyYW1ldGVycyAtIFRoZSBjdXN0b20gT0F1dGggcGFyYW1ldGVycyB0byBwYXNzIGluIHRoZSBPQXV0aCByZXF1ZXN0LlxyXG4gICAgICovXHJcbiAgICBzZXRDdXN0b21QYXJhbWV0ZXJzKGN1c3RvbU9BdXRoUGFyYW1ldGVycykge1xyXG4gICAgICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IGN1c3RvbU9BdXRoUGFyYW1ldGVycztcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgbGlzdCBvZiB7QGxpbmsgQ3VzdG9tUGFyYW1ldGVyc30uXHJcbiAgICAgKi9cclxuICAgIGdldEN1c3RvbVBhcmFtZXRlcnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tUGFyYW1ldGVycztcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ29tbW9uIGNvZGUgdG8gYWxsIE9BdXRoIHByb3ZpZGVycy4gVGhpcyBpcyBzZXBhcmF0ZSBmcm9tIHRoZVxyXG4gKiB7QGxpbmsgT0F1dGhQcm92aWRlcn0gc28gdGhhdCBjaGlsZCBwcm92aWRlcnMgKGxpa2VcclxuICoge0BsaW5rIEdvb2dsZUF1dGhQcm92aWRlcn0pIGRvbid0IGluaGVyaXQgdGhlIGBjcmVkZW50aWFsYCBpbnN0YW5jZSBtZXRob2QuXHJcbiAqIEluc3RlYWQsIHRoZXkgcmVseSBvbiBhIHN0YXRpYyBgY3JlZGVudGlhbGAgbWV0aG9kLlxyXG4gKi9cclxuY2xhc3MgQmFzZU9BdXRoUHJvdmlkZXIgZXh0ZW5kcyBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcclxuICAgICAgICAvKiogQGludGVybmFsICovXHJcbiAgICAgICAgdGhpcy5zY29wZXMgPSBbXTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkIGFuIE9BdXRoIHNjb3BlIHRvIHRoZSBjcmVkZW50aWFsLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzY29wZSAtIFByb3ZpZGVyIE9BdXRoIHNjb3BlIHRvIGFkZC5cclxuICAgICAqL1xyXG4gICAgYWRkU2NvcGUoc2NvcGUpIHtcclxuICAgICAgICAvLyBJZiBub3QgYWxyZWFkeSBhZGRlZCwgYWRkIHNjb3BlIHRvIGxpc3QuXHJcbiAgICAgICAgaWYgKCF0aGlzLnNjb3Blcy5pbmNsdWRlcyhzY29wZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5zY29wZXMucHVzaChzY29wZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXRyaWV2ZSB0aGUgY3VycmVudCBsaXN0IG9mIE9BdXRoIHNjb3Blcy5cclxuICAgICAqL1xyXG4gICAgZ2V0U2NvcGVzKCkge1xyXG4gICAgICAgIHJldHVybiBbLi4udGhpcy5zY29wZXNdO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBnZW5lcmljIHtAbGluayBPQXV0aENyZWRlbnRpYWx9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgT0F1dGhQcm92aWRlcignZ29vZ2xlLmNvbScpO1xyXG4gKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuXHJcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdwcm9maWxlJyk7XHJcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdlbWFpbCcpO1xyXG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogaWYgKHJlc3VsdCkge1xyXG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXHJcbiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgT0F1dGggQWNjZXNzIFRva2VuIGZvciB0aGUgcHJvdmlkZXIuXHJcbiAqICAgY29uc3QgY3JlZGVudGlhbCA9IHByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KGF1dGgsIHJlc3VsdCk7XHJcbiAqICAgY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiB9XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSBwb3B1cC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgT0F1dGhQcm92aWRlcignZ29vZ2xlLmNvbScpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyKTtcclxuICpcclxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXHJcbiAqIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogLy8gVGhpcyBnaXZlcyB5b3UgYSBPQXV0aCBBY2Nlc3MgVG9rZW4gZm9yIHRoZSBwcm92aWRlci5cclxuICogY29uc3QgY3JlZGVudGlhbCA9IHByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KGF1dGgsIHJlc3VsdCk7XHJcbiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogYGBgXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIE9BdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIEpTT04gc3RyaW5nIG9yIGEgcGxhaW4gb2JqZWN0LlxyXG4gICAgICogQHBhcmFtIGpzb24gLSBBIHBsYWluIG9iamVjdCBvciBhIEpTT04gc3RyaW5nXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUpTT04oanNvbikge1xyXG4gICAgICAgIGNvbnN0IG9iaiA9IHR5cGVvZiBqc29uID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UoanNvbikgOiBqc29uO1xyXG4gICAgICAgIF9hc3NlcnQoJ3Byb3ZpZGVySWQnIGluIG9iaiAmJiAnc2lnbkluTWV0aG9kJyBpbiBvYmosIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKG9iaik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEgZ2VuZXJpYyBPQXV0aCBwcm92aWRlcidzIGFjY2VzcyB0b2tlbiBvciBJRCB0b2tlbi5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICogVGhlIHJhdyBub25jZSBpcyByZXF1aXJlZCB3aGVuIGFuIElEIHRva2VuIHdpdGggYSBub25jZSBmaWVsZCBpcyBwcm92aWRlZC4gVGhlIFNIQS0yNTYgaGFzaCBvZlxyXG4gICAgICogdGhlIHJhdyBub25jZSBtdXN0IG1hdGNoIHRoZSBub25jZSBmaWVsZCBpbiB0aGUgSUQgdG9rZW4uXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAqIC8vIGBnb29nbGVVc2VyYCBmcm9tIHRoZSBvbnN1Y2Nlc3MgR29vZ2xlIFNpZ24gSW4gY2FsbGJhY2suXHJcbiAgICAgKiAvLyBJbml0aWFsaXplIGEgZ2VuZXJhdGUgT0F1dGggcHJvdmlkZXIgd2l0aCBhIGBnb29nbGUuY29tYCBwcm92aWRlcklkLlxyXG4gICAgICogY29uc3QgcHJvdmlkZXIgPSBuZXcgT0F1dGhQcm92aWRlcignZ29vZ2xlLmNvbScpO1xyXG4gICAgICogY29uc3QgY3JlZGVudGlhbCA9IHByb3ZpZGVyLmNyZWRlbnRpYWwoe1xyXG4gICAgICogICBpZFRva2VuOiBnb29nbGVVc2VyLmdldEF1dGhSZXNwb25zZSgpLmlkX3Rva2VuLFxyXG4gICAgICogfSk7XHJcbiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChjcmVkZW50aWFsKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwYXJhbXMgLSBFaXRoZXIgdGhlIG9wdGlvbnMgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIElEIHRva2VuLCBhY2Nlc3MgdG9rZW4gYW5kIHJhdyBub25jZVxyXG4gICAgICogb3IgdGhlIElEIHRva2VuIHN0cmluZy5cclxuICAgICAqL1xyXG4gICAgY3JlZGVudGlhbChwYXJhbXMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3JlZGVudGlhbChPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyksIHsgbm9uY2U6IHBhcmFtcy5yYXdOb25jZSB9KSk7XHJcbiAgICB9XHJcbiAgICAvKiogQW4gaW50ZXJuYWwgY3JlZGVudGlhbCBtZXRob2QgdGhhdCBhY2NlcHRzIG1vcmUgcGVybWlzc2l2ZSBvcHRpb25zICovXHJcbiAgICBfY3JlZGVudGlhbChwYXJhbXMpIHtcclxuICAgICAgICBfYXNzZXJ0KHBhcmFtcy5pZFRva2VuIHx8IHBhcmFtcy5hY2Nlc3NUb2tlbiwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIC8vIEZvciBPQXV0aENyZWRlbnRpYWwsIHNpZ24gaW4gbWV0aG9kIGlzIHNhbWUgYXMgcHJvdmlkZXJJZC5cclxuICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcGFyYW1zKSwgeyBwcm92aWRlcklkOiB0aGlzLnByb3ZpZGVySWQsIHNpZ25Jbk1ldGhvZDogdGhpcy5wcm92aWRlcklkIH0pKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBPQXV0aFByb3ZpZGVyLm9hdXRoQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhc1xyXG4gICAgICogdGhyb3duIGR1cmluZyBhIHNpZ24taW4sIGxpbmssIG9yIHJlYXV0aGVudGljYXRlIG9wZXJhdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBPQXV0aFByb3ZpZGVyLm9hdXRoQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBvYXV0aENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHsgX3Rva2VuUmVzcG9uc2U6IHRva2VuUmVzcG9uc2UgfSkge1xyXG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeyBvYXV0aElkVG9rZW4sIG9hdXRoQWNjZXNzVG9rZW4sIG9hdXRoVG9rZW5TZWNyZXQsIHBlbmRpbmdUb2tlbiwgbm9uY2UsIHByb3ZpZGVySWQgfSA9IHRva2VuUmVzcG9uc2U7XHJcbiAgICAgICAgaWYgKCFvYXV0aEFjY2Vzc1Rva2VuICYmXHJcbiAgICAgICAgICAgICFvYXV0aFRva2VuU2VjcmV0ICYmXHJcbiAgICAgICAgICAgICFvYXV0aElkVG9rZW4gJiZcclxuICAgICAgICAgICAgIXBlbmRpbmdUb2tlbikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFwcm92aWRlcklkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE9BdXRoUHJvdmlkZXIocHJvdmlkZXJJZCkuX2NyZWRlbnRpYWwoe1xyXG4gICAgICAgICAgICAgICAgaWRUb2tlbjogb2F1dGhJZFRva2VuLFxyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IG9hdXRoQWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgICAgICBub25jZSxcclxuICAgICAgICAgICAgICAgIHBlbmRpbmdUb2tlblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkZBQ0VCT09LLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTtcclxuICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLlxyXG4gKiBwcm92aWRlci5hZGRTY29wZSgndXNlcl9iaXJ0aGRheScpO1xyXG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogaWYgKHJlc3VsdCkge1xyXG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXHJcbiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgRmFjZWJvb2sgQWNjZXNzIFRva2VuLlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xyXG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCd1c2VyX2JpcnRoZGF5Jyk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqXHJcbiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLlxyXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgRmFjZWJvb2sgQWNjZXNzIFRva2VuLlxyXG4gKiBjb25zdCBjcmVkZW50aWFsID0gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiBgYGBcclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgRmFjZWJvb2tBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcihcImZhY2Vib29rLmNvbVwiIC8qIFByb3ZpZGVySWQuRkFDRUJPT0sgKi8pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgRmFjZWJvb2suXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAqIC8vIGBldmVudGAgZnJvbSB0aGUgRmFjZWJvb2sgYXV0aC5hdXRoUmVzcG9uc2VDaGFuZ2UgY2FsbGJhY2suXHJcbiAgICAgKiBjb25zdCBjcmVkZW50aWFsID0gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChldmVudC5hdXRoUmVzcG9uc2UuYWNjZXNzVG9rZW4pO1xyXG4gICAgICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoY3JlZGVudGlhbCk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4gLSBGYWNlYm9vayBhY2Nlc3MgdG9rZW4uXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyh7XHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEZhY2Vib29rQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lELFxyXG4gICAgICAgICAgICBzaWduSW5NZXRob2Q6IEZhY2Vib29rQXV0aFByb3ZpZGVyLkZBQ0VCT09LX1NJR05fSU5fTUVUSE9ELFxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlblxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcclxuICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UgfHwgISgnb2F1dGhBY2Nlc3NUb2tlbicgaW4gdG9rZW5SZXNwb25zZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZS5vYXV0aEFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkZBQ0VCT09LLiAqL1xyXG5GYWNlYm9va0F1dGhQcm92aWRlci5GQUNFQk9PS19TSUdOX0lOX01FVEhPRCA9IFwiZmFjZWJvb2suY29tXCIgLyogU2lnbkluTWV0aG9kLkZBQ0VCT09LICovO1xyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uRkFDRUJPT0suICovXHJcbkZhY2Vib29rQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJmYWNlYm9vay5jb21cIiAvKiBQcm92aWRlcklkLkZBQ0VCT09LICovO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4gYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5HT09HTEUuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0LlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBHb29nbGVBdXRoUHJvdmlkZXIoKTtcclxuICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLlxyXG4gKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcclxuICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIGlmIChyZXN1bHQpIHtcclxuICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlclxyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEdvb2dsZSBBY2Nlc3MgVG9rZW4uXHJcbiAqICAgY29uc3QgY3JlZGVudGlhbCA9IEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xyXG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEdvb2dsZUF1dGhQcm92aWRlcigpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHByb3ZpZGVyKTtcclxuICpcclxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXHJcbiAqIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogLy8gVGhpcyBnaXZlcyB5b3UgYSBHb29nbGUgQWNjZXNzIFRva2VuLlxyXG4gKiBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XHJcbiAqIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIEdvb2dsZUF1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKFwiZ29vZ2xlLmNvbVwiIC8qIFByb3ZpZGVySWQuR09PR0xFICovKTtcclxuICAgICAgICB0aGlzLmFkZFNjb3BlKCdwcm9maWxlJyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIGZvciBHb29nbGUuIEF0IGxlYXN0IG9uZSBvZiBJRCB0b2tlbiBhbmQgYWNjZXNzIHRva2VuIGlzIHJlcXVpcmVkLlxyXG4gICAgICpcclxuICAgICAqIEBleGFtcGxlXHJcbiAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgKiAvLyBcXGBnb29nbGVVc2VyXFxgIGZyb20gdGhlIG9uc3VjY2VzcyBHb29nbGUgU2lnbiBJbiBjYWxsYmFjay5cclxuICAgICAqIGNvbnN0IGNyZWRlbnRpYWwgPSBHb29nbGVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChnb29nbGVVc2VyLmdldEF1dGhSZXNwb25zZSgpLmlkX3Rva2VuKTtcclxuICAgICAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGNyZWRlbnRpYWwpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkVG9rZW4gLSBHb29nbGUgSUQgdG9rZW4uXHJcbiAgICAgKiBAcGFyYW0gYWNjZXNzVG9rZW4gLSBHb29nbGUgYWNjZXNzIHRva2VuLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbChpZFRva2VuLCBhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoe1xyXG4gICAgICAgICAgICBwcm92aWRlcklkOiBHb29nbGVBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQsXHJcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogR29vZ2xlQXV0aFByb3ZpZGVyLkdPT0dMRV9TSUdOX0lOX01FVEhPRCxcclxuICAgICAgICAgICAgaWRUb2tlbixcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBHb29nbGVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhc1xyXG4gICAgICogdGhyb3duIGR1cmluZyBhIHNpZ24taW4sIGxpbmssIG9yIHJlYXV0aGVudGljYXRlIG9wZXJhdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBHb29nbGVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgb2F1dGhJZFRva2VuLCBvYXV0aEFjY2Vzc1Rva2VuIH0gPSB0b2tlblJlc3BvbnNlO1xyXG4gICAgICAgIGlmICghb2F1dGhJZFRva2VuICYmICFvYXV0aEFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgY291bGQgYmUgYW4gb2F1dGggMSBjcmVkZW50aWFsIG9yIGEgcGhvbmUgY3JlZGVudGlhbFxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKG9hdXRoSWRUb2tlbiwgb2F1dGhBY2Nlc3NUb2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uR09PR0xFLiAqL1xyXG5Hb29nbGVBdXRoUHJvdmlkZXIuR09PR0xFX1NJR05fSU5fTUVUSE9EID0gXCJnb29nbGUuY29tXCIgLyogU2lnbkluTWV0aG9kLkdPT0dMRSAqLztcclxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LkdPT0dMRS4gKi9cclxuR29vZ2xlQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJnb29nbGUuY29tXCIgLyogUHJvdmlkZXJJZC5HT09HTEUgKi87XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkdJVEhVQi5cclxuICpcclxuICogQHJlbWFya3NcclxuICogR2l0SHViIHJlcXVpcmVzIGFuIE9BdXRoIDIuMCByZWRpcmVjdCwgc28geW91IGNhbiBlaXRoZXIgaGFuZGxlIHRoZSByZWRpcmVjdCBkaXJlY3RseSwgb3IgdXNlXHJcbiAqIHRoZSB7QGxpbmsgc2lnbkluV2l0aFBvcHVwfSBoYW5kbGVyOlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR2l0aHViQXV0aFByb3ZpZGVyKCk7XHJcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3JlcG8nKTtcclxuICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIGlmIChyZXN1bHQpIHtcclxuICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlclxyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEdpdGh1YiBBY2Nlc3MgVG9rZW4uXHJcbiAqICAgY29uc3QgY3JlZGVudGlhbCA9IEdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xyXG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEdpdGh1YkF1dGhQcm92aWRlcigpO1xyXG4gKiBwcm92aWRlci5hZGRTY29wZSgncmVwbycpO1xyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKlxyXG4gKiAvLyBUaGUgc2lnbmVkLWluIHVzZXIgaW5mby5cclxuICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEdpdGh1YiBBY2Nlc3MgVG9rZW4uXHJcbiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiBgYGBcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgR2l0aHViQXV0aFByb3ZpZGVyIGV4dGVuZHMgQmFzZU9BdXRoUHJvdmlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJnaXRodWIuY29tXCIgLyogUHJvdmlkZXJJZC5HSVRIVUIgKi8pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgR2l0aHViLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBhY2Nlc3NUb2tlbiAtIEdpdGh1YiBhY2Nlc3MgdG9rZW4uXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyh7XHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEdpdGh1YkF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcclxuICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBHaXRodWJBdXRoUHJvdmlkZXIuR0lUSFVCX1NJR05fSU5fTUVUSE9ELFxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlblxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIEdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzXHJcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIEdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHsgX3Rva2VuUmVzcG9uc2U6IHRva2VuUmVzcG9uc2UgfSkge1xyXG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZSB8fCAhKCdvYXV0aEFjY2Vzc1Rva2VuJyBpbiB0b2tlblJlc3BvbnNlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkdJVEhVQi4gKi9cclxuR2l0aHViQXV0aFByb3ZpZGVyLkdJVEhVQl9TSUdOX0lOX01FVEhPRCA9IFwiZ2l0aHViLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5HSVRIVUIgKi87XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5HSVRIVUIuICovXHJcbkdpdGh1YkF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9IFwiZ2l0aHViLmNvbVwiIC8qIFByb3ZpZGVySWQuR0lUSFVCICovO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBJRFBfUkVRVUVTVF9VUkkgPSAnaHR0cDovL2xvY2FsaG9zdCc7XHJcbi8qKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBTQU1MQXV0aENyZWRlbnRpYWwgZXh0ZW5kcyBBdXRoQ3JlZGVudGlhbCB7XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm92aWRlcklkLCBwZW5kaW5nVG9rZW4pIHtcclxuICAgICAgICBzdXBlcihwcm92aWRlcklkLCBwcm92aWRlcklkKTtcclxuICAgICAgICB0aGlzLnBlbmRpbmdUb2tlbiA9IHBlbmRpbmdUb2tlbjtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCkge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpO1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikge1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpO1xyXG4gICAgICAgIHJlcXVlc3QuaWRUb2tlbiA9IGlkVG9rZW47XHJcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcclxuICAgICAgICByZXF1ZXN0LmF1dG9DcmVhdGUgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTtcclxuICAgIH1cclxuICAgIC8qKiB7QGluaGVyaXRkb2MgQXV0aENyZWRlbnRpYWwudG9KU09OfSAgKi9cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzaWduSW5NZXRob2Q6IHRoaXMuc2lnbkluTWV0aG9kLFxyXG4gICAgICAgICAgICBwcm92aWRlcklkOiB0aGlzLnByb3ZpZGVySWQsXHJcbiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wZW5kaW5nVG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTdGF0aWMgbWV0aG9kIHRvIGRlc2VyaWFsaXplIGEgSlNPTiByZXByZXNlbnRhdGlvbiBvZiBhbiBvYmplY3QgaW50byBhblxyXG4gICAgICoge0BsaW5rICBBdXRoQ3JlZGVudGlhbH0uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGpzb24gLSBJbnB1dCBjYW4gYmUgZWl0aGVyIE9iamVjdCBvciB0aGUgc3RyaW5naWZpZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlIG9iamVjdC5cclxuICAgICAqIFdoZW4gc3RyaW5nIGlzIHByb3ZpZGVkLCBKU09OLnBhcnNlIHdvdWxkIGJlIGNhbGxlZCBmaXJzdC5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBJZiB0aGUgSlNPTiBpbnB1dCBkb2VzIG5vdCByZXByZXNlbnQgYW4ge0BsaW5rICBBdXRoQ3JlZGVudGlhbH0sIG51bGwgaXMgcmV0dXJuZWQuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmcm9tSlNPTihqc29uKSB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gdHlwZW9mIGpzb24gPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShqc29uKSA6IGpzb247XHJcbiAgICAgICAgY29uc3QgeyBwcm92aWRlcklkLCBzaWduSW5NZXRob2QsIHBlbmRpbmdUb2tlbiB9ID0gb2JqO1xyXG4gICAgICAgIGlmICghcHJvdmlkZXJJZCB8fFxyXG4gICAgICAgICAgICAhc2lnbkluTWV0aG9kIHx8XHJcbiAgICAgICAgICAgICFwZW5kaW5nVG9rZW4gfHxcclxuICAgICAgICAgICAgcHJvdmlkZXJJZCAhPT0gc2lnbkluTWV0aG9kKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFNBTUxBdXRoQ3JlZGVudGlhbChwcm92aWRlcklkLCBwZW5kaW5nVG9rZW4pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBIZWxwZXIgc3RhdGljIG1ldGhvZCB0byBhdm9pZCBleHBvc2luZyB0aGUgY29uc3RydWN0b3IgdG8gZW5kIHVzZXJzLlxyXG4gICAgICpcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgX2NyZWF0ZShwcm92aWRlcklkLCBwZW5kaW5nVG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gbmV3IFNBTUxBdXRoQ3JlZGVudGlhbChwcm92aWRlcklkLCBwZW5kaW5nVG9rZW4pO1xyXG4gICAgfVxyXG4gICAgYnVpbGRSZXF1ZXN0KCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RVcmk6IElEUF9SRVFVRVNUX1VSSSxcclxuICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWUsXHJcbiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wZW5kaW5nVG9rZW5cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IFNBTUxfUFJPVklERVJfUFJFRklYID0gJ3NhbWwuJztcclxuLyoqXHJcbiAqIEFuIHtAbGluayBBdXRoUHJvdmlkZXJ9IGZvciBTQU1MLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5jbGFzcyBTQU1MQXV0aFByb3ZpZGVyIGV4dGVuZHMgRmVkZXJhdGVkQXV0aFByb3ZpZGVyIHtcclxuICAgIC8qKlxyXG4gICAgICogQ29uc3RydWN0b3IuIFRoZSBwcm92aWRlcklkIG11c3Qgc3RhcnQgd2l0aCBcInNhbWwuXCJcclxuICAgICAqIEBwYXJhbSBwcm92aWRlcklkIC0gU0FNTCBwcm92aWRlciBJRC5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IocHJvdmlkZXJJZCkge1xyXG4gICAgICAgIF9hc3NlcnQocHJvdmlkZXJJZC5zdGFydHNXaXRoKFNBTUxfUFJPVklERVJfUFJFRklYKSwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIHN1cGVyKHByb3ZpZGVySWQpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZW5lcmF0ZXMgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfSBhZnRlciBhXHJcbiAgICAgKiBzdWNjZXNzZnVsIFNBTUwgZmxvdyBjb21wbGV0ZXMuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqXHJcbiAgICAgKiBGb3IgZXhhbXBsZSwgdG8gZ2V0IGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0sIHlvdSBjb3VsZCB3cml0ZSB0aGVcclxuICAgICAqIGZvbGxvd2luZyBjb2RlOlxyXG4gICAgICpcclxuICAgICAqIGBgYGpzXHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBzYW1sUHJvdmlkZXIpO1xyXG4gICAgICogY29uc3QgY3JlZGVudGlhbCA9IFNBTUxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIFNBTUxBdXRoUHJvdmlkZXIuc2FtbENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcclxuICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gU0FNTEF1dGhQcm92aWRlci5zYW1sQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9IGZyb20gYSBKU09OIHN0cmluZyBvciBhIHBsYWluIG9iamVjdC5cclxuICAgICAqIEBwYXJhbSBqc29uIC0gQSBwbGFpbiBvYmplY3Qgb3IgYSBKU09OIHN0cmluZ1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21KU09OKGpzb24pIHtcclxuICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gU0FNTEF1dGhDcmVkZW50aWFsLmZyb21KU09OKGpzb24pO1xyXG4gICAgICAgIF9hc3NlcnQoY3JlZGVudGlhbCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIHJldHVybiBjcmVkZW50aWFsO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIHNhbWxDcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcclxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHsgcGVuZGluZ1Rva2VuLCBwcm92aWRlcklkIH0gPSB0b2tlblJlc3BvbnNlO1xyXG4gICAgICAgIGlmICghcGVuZGluZ1Rva2VuIHx8ICFwcm92aWRlcklkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gU0FNTEF1dGhDcmVkZW50aWFsLl9jcmVhdGUocHJvdmlkZXJJZCwgcGVuZGluZ1Rva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LlRXSVRURVIuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0LlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBUd2l0dGVyQXV0aFByb3ZpZGVyKCk7XHJcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cclxuICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIGlmIChyZXN1bHQpIHtcclxuICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlclxyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIFR3aXR0ZXIgQWNjZXNzIFRva2VuIGFuZCBTZWNyZXQuXHJcbiAqICAgY29uc3QgY3JlZGVudGlhbCA9IFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqICAgY29uc3Qgc2VjcmV0ID0gY3JlZGVudGlhbC5zZWNyZXQ7XHJcbiAqIH1cclxuICogYGBgXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHBvcHVwLlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBUd2l0dGVyQXV0aFByb3ZpZGVyKCk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqXHJcbiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLlxyXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgVHdpdHRlciBBY2Nlc3MgVG9rZW4gYW5kIFNlY3JldC5cclxuICogY29uc3QgY3JlZGVudGlhbCA9IFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQocmVzdWx0KTtcclxuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiBjb25zdCBzZWNyZXQgPSBjcmVkZW50aWFsLnNlY3JldDtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIFR3aXR0ZXJBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcihcInR3aXR0ZXIuY29tXCIgLyogUHJvdmlkZXJJZC5UV0lUVEVSICovKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIGNyZWRlbnRpYWwgZm9yIFR3aXR0ZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHRva2VuIC0gVHdpdHRlciBhY2Nlc3MgdG9rZW4uXHJcbiAgICAgKiBAcGFyYW0gc2VjcmV0IC0gVHdpdHRlciBzZWNyZXQuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsKHRva2VuLCBzZWNyZXQpIHtcclxuICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHtcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogVHdpdHRlckF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcclxuICAgICAgICAgICAgc2lnbkluTWV0aG9kOiBUd2l0dGVyQXV0aFByb3ZpZGVyLlRXSVRURVJfU0lHTl9JTl9NRVRIT0QsXHJcbiAgICAgICAgICAgIG9hdXRoVG9rZW46IHRva2VuLFxyXG4gICAgICAgICAgICBvYXV0aFRva2VuU2VjcmV0OiBzZWNyZXRcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcclxuICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHsgX3Rva2VuUmVzcG9uc2U6IHRva2VuUmVzcG9uc2UgfSkge1xyXG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgeyBvYXV0aEFjY2Vzc1Rva2VuLCBvYXV0aFRva2VuU2VjcmV0IH0gPSB0b2tlblJlc3BvbnNlO1xyXG4gICAgICAgIGlmICghb2F1dGhBY2Nlc3NUb2tlbiB8fCAhb2F1dGhUb2tlblNlY3JldCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgcmV0dXJuIFR3aXR0ZXJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChvYXV0aEFjY2Vzc1Rva2VuLCBvYXV0aFRva2VuU2VjcmV0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5UV0lUVEVSLiAqL1xyXG5Ud2l0dGVyQXV0aFByb3ZpZGVyLlRXSVRURVJfU0lHTl9JTl9NRVRIT0QgPSBcInR3aXR0ZXIuY29tXCIgLyogU2lnbkluTWV0aG9kLlRXSVRURVIgKi87XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5UV0lUVEVSLiAqL1xyXG5Ud2l0dGVyQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJ0d2l0dGVyLmNvbVwiIC8qIFByb3ZpZGVySWQuVFdJVFRFUiAqLztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnblVwKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduVXBcIiAvKiBFbmRwb2ludC5TSUdOX1VQICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIFVzZXJDcmVkZW50aWFsSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihwYXJhbXMpIHtcclxuICAgICAgICB0aGlzLnVzZXIgPSBwYXJhbXMudXNlcjtcclxuICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSBwYXJhbXMucHJvdmlkZXJJZDtcclxuICAgICAgICB0aGlzLl90b2tlblJlc3BvbnNlID0gcGFyYW1zLl90b2tlblJlc3BvbnNlO1xyXG4gICAgICAgIHRoaXMub3BlcmF0aW9uVHlwZSA9IHBhcmFtcy5vcGVyYXRpb25UeXBlO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGFzeW5jIF9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIG9wZXJhdGlvblR5cGUsIGlkVG9rZW5SZXNwb25zZSwgaXNBbm9ueW1vdXMgPSBmYWxzZSkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VySW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBpZFRva2VuUmVzcG9uc2UsIGlzQW5vbnltb3VzKTtcclxuICAgICAgICBjb25zdCBwcm92aWRlcklkID0gcHJvdmlkZXJJZEZvclJlc3BvbnNlKGlkVG9rZW5SZXNwb25zZSk7XHJcbiAgICAgICAgY29uc3QgdXNlckNyZWQgPSBuZXcgVXNlckNyZWRlbnRpYWxJbXBsKHtcclxuICAgICAgICAgICAgdXNlcixcclxuICAgICAgICAgICAgcHJvdmlkZXJJZCxcclxuICAgICAgICAgICAgX3Rva2VuUmVzcG9uc2U6IGlkVG9rZW5SZXNwb25zZSxcclxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB1c2VyQ3JlZDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBhc3luYyBfZm9yT3BlcmF0aW9uKHVzZXIsIG9wZXJhdGlvblR5cGUsIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgYXdhaXQgdXNlci5fdXBkYXRlVG9rZW5zSWZOZWNlc3NhcnkocmVzcG9uc2UsIC8qIHJlbG9hZCAqLyB0cnVlKTtcclxuICAgICAgICBjb25zdCBwcm92aWRlcklkID0gcHJvdmlkZXJJZEZvclJlc3BvbnNlKHJlc3BvbnNlKTtcclxuICAgICAgICByZXR1cm4gbmV3IFVzZXJDcmVkZW50aWFsSW1wbCh7XHJcbiAgICAgICAgICAgIHVzZXIsXHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQsXHJcbiAgICAgICAgICAgIF90b2tlblJlc3BvbnNlOiByZXNwb25zZSxcclxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHByb3ZpZGVySWRGb3JSZXNwb25zZShyZXNwb25zZSkge1xyXG4gICAgaWYgKHJlc3BvbnNlLnByb3ZpZGVySWQpIHtcclxuICAgICAgICByZXR1cm4gcmVzcG9uc2UucHJvdmlkZXJJZDtcclxuICAgIH1cclxuICAgIGlmICgncGhvbmVOdW1iZXInIGluIHJlc3BvbnNlKSB7XHJcbiAgICAgICAgcmV0dXJuIFwicGhvbmVcIiAvKiBQcm92aWRlcklkLlBIT05FICovO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEFzeW5jaHJvbm91c2x5IHNpZ25zIGluIGFzIGFuIGFub255bW91cyB1c2VyLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBJZiB0aGVyZSBpcyBhbHJlYWR5IGFuIGFub255bW91cyB1c2VyIHNpZ25lZCBpbiwgdGhhdCB1c2VyIHdpbGwgYmUgcmV0dXJuZWQ7IG90aGVyd2lzZSwgYVxyXG4gKiBuZXcgYW5vbnltb3VzIHVzZXIgaWRlbnRpdHkgd2lsbCBiZSBjcmVhdGVkIGFuZCByZXR1cm5lZC5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5Bbm9ueW1vdXNseShhdXRoKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XHJcbiAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcclxuICAgIGlmICgoX2EgPSBhdXRoSW50ZXJuYWwuY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pc0Fub255bW91cykge1xyXG4gICAgICAgIC8vIElmIGFuIGFub255bW91cyB1c2VyIGlzIGFscmVhZHkgc2lnbmVkIGluLCBubyBuZWVkIHRvIHNpZ24gdGhlbSBpbiBhZ2Fpbi5cclxuICAgICAgICByZXR1cm4gbmV3IFVzZXJDcmVkZW50aWFsSW1wbCh7XHJcbiAgICAgICAgICAgIHVzZXI6IGF1dGhJbnRlcm5hbC5jdXJyZW50VXNlcixcclxuICAgICAgICAgICAgcHJvdmlkZXJJZDogbnVsbCxcclxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZTogXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi9cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2lnblVwKGF1dGhJbnRlcm5hbCwge1xyXG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGhJbnRlcm5hbCwgXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi8sIHJlc3BvbnNlLCB0cnVlKTtcclxuICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7XHJcbiAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgTXVsdGlGYWN0b3JFcnJvciBleHRlbmRzIEZpcmViYXNlRXJyb3Ige1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCwgZXJyb3IsIG9wZXJhdGlvblR5cGUsIHVzZXIpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgc3VwZXIoZXJyb3IuY29kZSwgZXJyb3IubWVzc2FnZSk7XHJcbiAgICAgICAgdGhpcy5vcGVyYXRpb25UeXBlID0gb3BlcmF0aW9uVHlwZTtcclxuICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrXHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIE11bHRpRmFjdG9yRXJyb3IucHJvdG90eXBlKTtcclxuICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSB7XHJcbiAgICAgICAgICAgIGFwcE5hbWU6IGF1dGgubmFtZSxcclxuICAgICAgICAgICAgdGVuYW50SWQ6IChfYSA9IGF1dGgudGVuYW50SWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgX3NlcnZlclJlc3BvbnNlOiBlcnJvci5jdXN0b21EYXRhLl9zZXJ2ZXJSZXNwb25zZSxcclxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgX2Zyb21FcnJvckFuZE9wZXJhdGlvbihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JFcnJvcihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpIHtcclxuICAgIGNvbnN0IGlkVG9rZW5Qcm92aWRlciA9IG9wZXJhdGlvblR5cGUgPT09IFwicmVhdXRoZW50aWNhdGVcIiAvKiBPcGVyYXRpb25UeXBlLlJFQVVUSEVOVElDQVRFICovXHJcbiAgICAgICAgPyBjcmVkZW50aWFsLl9nZXRSZWF1dGhlbnRpY2F0aW9uUmVzb2x2ZXIoYXV0aClcclxuICAgICAgICA6IGNyZWRlbnRpYWwuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTtcclxuICAgIHJldHVybiBpZFRva2VuUHJvdmlkZXIuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8ke1wibXVsdGktZmFjdG9yLWF1dGgtcmVxdWlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9SRVFVSVJFRCAqL31gKSB7XHJcbiAgICAgICAgICAgIHRocm93IE11bHRpRmFjdG9yRXJyb3IuX2Zyb21FcnJvckFuZE9wZXJhdGlvbihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFRha2VzIGEgc2V0IG9mIFVzZXJJbmZvIHByb3ZpZGVyIGRhdGEgYW5kIGNvbnZlcnRzIGl0IHRvIGEgc2V0IG9mIG5hbWVzXHJcbiAqL1xyXG5mdW5jdGlvbiBwcm92aWRlckRhdGFBc05hbWVzKHByb3ZpZGVyRGF0YSkge1xyXG4gICAgcmV0dXJuIG5ldyBTZXQocHJvdmlkZXJEYXRhXHJcbiAgICAgICAgLm1hcCgoeyBwcm92aWRlcklkIH0pID0+IHByb3ZpZGVySWQpXHJcbiAgICAgICAgLmZpbHRlcihwaWQgPT4gISFwaWQpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVW5saW5rcyBhIHByb3ZpZGVyIGZyb20gYSB1c2VyIGFjY291bnQuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm92aWRlcklkIC0gVGhlIHByb3ZpZGVyIHRvIHVubGluay5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdW5saW5rKHVzZXIsIHByb3ZpZGVySWQpIHtcclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGF3YWl0IF9hc3NlcnRMaW5rZWRTdGF0dXModHJ1ZSwgdXNlckludGVybmFsLCBwcm92aWRlcklkKTtcclxuICAgIGNvbnN0IHsgcHJvdmlkZXJVc2VySW5mbyB9ID0gYXdhaXQgZGVsZXRlTGlua2VkQWNjb3VudHModXNlckludGVybmFsLmF1dGgsIHtcclxuICAgICAgICBpZFRva2VuOiBhd2FpdCB1c2VySW50ZXJuYWwuZ2V0SWRUb2tlbigpLFxyXG4gICAgICAgIGRlbGV0ZVByb3ZpZGVyOiBbcHJvdmlkZXJJZF1cclxuICAgIH0pO1xyXG4gICAgY29uc3QgcHJvdmlkZXJzTGVmdCA9IHByb3ZpZGVyRGF0YUFzTmFtZXMocHJvdmlkZXJVc2VySW5mbyB8fCBbXSk7XHJcbiAgICB1c2VySW50ZXJuYWwucHJvdmlkZXJEYXRhID0gdXNlckludGVybmFsLnByb3ZpZGVyRGF0YS5maWx0ZXIocGQgPT4gcHJvdmlkZXJzTGVmdC5oYXMocGQucHJvdmlkZXJJZCkpO1xyXG4gICAgaWYgKCFwcm92aWRlcnNMZWZ0LmhhcyhcInBob25lXCIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLykpIHtcclxuICAgICAgICB1c2VySW50ZXJuYWwucGhvbmVOdW1iZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgdXNlckludGVybmFsLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHVzZXJJbnRlcm5hbCk7XHJcbiAgICByZXR1cm4gdXNlckludGVybmFsO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9saW5rJDEodXNlciwgY3JlZGVudGlhbCwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgY3JlZGVudGlhbC5fbGlua1RvSWRUb2tlbih1c2VyLmF1dGgsIGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpKSwgYnlwYXNzQXV0aFN0YXRlKTtcclxuICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbih1c2VyLCBcImxpbmtcIiAvKiBPcGVyYXRpb25UeXBlLkxJTksgKi8sIHJlc3BvbnNlKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfYXNzZXJ0TGlua2VkU3RhdHVzKGV4cGVjdGVkLCB1c2VyLCBwcm92aWRlcikge1xyXG4gICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7XHJcbiAgICBjb25zdCBwcm92aWRlcklkcyA9IHByb3ZpZGVyRGF0YUFzTmFtZXModXNlci5wcm92aWRlckRhdGEpO1xyXG4gICAgY29uc3QgY29kZSA9IGV4cGVjdGVkID09PSBmYWxzZVxyXG4gICAgICAgID8gXCJwcm92aWRlci1hbHJlYWR5LWxpbmtlZFwiIC8qIEF1dGhFcnJvckNvZGUuUFJPVklERVJfQUxSRUFEWV9MSU5LRUQgKi9cclxuICAgICAgICA6IFwibm8tc3VjaC1wcm92aWRlclwiIC8qIEF1dGhFcnJvckNvZGUuTk9fU1VDSF9QUk9WSURFUiAqLztcclxuICAgIF9hc3NlcnQocHJvdmlkZXJJZHMuaGFzKHByb3ZpZGVyKSA9PT0gZXhwZWN0ZWQsIHVzZXIuYXV0aCwgY29kZSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gX3JlYXV0aGVudGljYXRlKHVzZXIsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCB7IGF1dGggfSA9IHVzZXI7XHJcbiAgICBjb25zdCBvcGVyYXRpb25UeXBlID0gXCJyZWF1dGhlbnRpY2F0ZVwiIC8qIE9wZXJhdGlvblR5cGUuUkVBVVRIRU5USUNBVEUgKi87XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpLCBieXBhc3NBdXRoU3RhdGUpO1xyXG4gICAgICAgIF9hc3NlcnQocmVzcG9uc2UuaWRUb2tlbiwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IF9wYXJzZVRva2VuKHJlc3BvbnNlLmlkVG9rZW4pO1xyXG4gICAgICAgIF9hc3NlcnQocGFyc2VkLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgY29uc3QgeyBzdWI6IGxvY2FsSWQgfSA9IHBhcnNlZDtcclxuICAgICAgICBfYXNzZXJ0KHVzZXIudWlkID09PSBsb2NhbElkLCBhdXRoLCBcInVzZXItbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfTUlTTUFUQ0ggKi8pO1xyXG4gICAgICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbih1c2VyLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vIENvbnZlcnQgdXNlciBkZWxldGVkIGVycm9yIGludG8gdXNlciBtaXNtYXRjaFxyXG4gICAgICAgIGlmICgoZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLmNvZGUpID09PSBgYXV0aC8ke1widXNlci1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfREVMRVRFRCAqL31gKSB7XHJcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwidXNlci1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9NSVNNQVRDSCAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gX3NpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBvcGVyYXRpb25UeXBlID0gXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi87XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wcm9jZXNzQ3JlZGVudGlhbFNhdmluZ01mYUNvbnRleHRJZk5lY2Vzc2FyeShhdXRoLCBvcGVyYXRpb25UeXBlLCBjcmVkZW50aWFsKTtcclxuICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIG9wZXJhdGlvblR5cGUsIHJlc3BvbnNlKTtcclxuICAgIGlmICghYnlwYXNzQXV0aFN0YXRlKSB7XHJcbiAgICAgICAgYXdhaXQgYXV0aC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7XHJcbn1cclxuLyoqXHJcbiAqIEFzeW5jaHJvbm91c2x5IHNpZ25zIGluIHdpdGggdGhlIGdpdmVuIGNyZWRlbnRpYWxzLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBBbiB7QGxpbmsgQXV0aFByb3ZpZGVyfSBjYW4gYmUgdXNlZCB0byBnZW5lcmF0ZSB0aGUgY3JlZGVudGlhbC5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gY3JlZGVudGlhbCAtIFRoZSBhdXRoIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGNyZWRlbnRpYWwpIHtcclxuICAgIHJldHVybiBfc2lnbkluV2l0aENyZWRlbnRpYWwoX2Nhc3RBdXRoKGF1dGgpLCBjcmVkZW50aWFsKTtcclxufVxyXG4vKipcclxuICogTGlua3MgdGhlIHVzZXIgYWNjb3VudCB3aXRoIHRoZSBnaXZlbiBjcmVkZW50aWFscy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogQW4ge0BsaW5rIEF1dGhQcm92aWRlcn0gY2FuIGJlIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBjcmVkZW50aWFsIC0gVGhlIGF1dGggY3JlZGVudGlhbC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gbGlua1dpdGhDcmVkZW50aWFsKHVzZXIsIGNyZWRlbnRpYWwpIHtcclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGF3YWl0IF9hc3NlcnRMaW5rZWRTdGF0dXMoZmFsc2UsIHVzZXJJbnRlcm5hbCwgY3JlZGVudGlhbC5wcm92aWRlcklkKTtcclxuICAgIHJldHVybiBfbGluayQxKHVzZXJJbnRlcm5hbCwgY3JlZGVudGlhbCk7XHJcbn1cclxuLyoqXHJcbiAqIFJlLWF1dGhlbnRpY2F0ZXMgYSB1c2VyIHVzaW5nIGEgZnJlc2ggY3JlZGVudGlhbC5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVXNlIGJlZm9yZSBvcGVyYXRpb25zIHN1Y2ggYXMge0BsaW5rIHVwZGF0ZVBhc3N3b3JkfSB0aGF0IHJlcXVpcmUgdG9rZW5zIGZyb20gcmVjZW50IHNpZ24taW5cclxuICogYXR0ZW1wdHMuIFRoaXMgbWV0aG9kIGNhbiBiZSB1c2VkIHRvIHJlY292ZXIgZnJvbSBhIGBDUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU5gIGVycm9yLlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gY3JlZGVudGlhbCAtIFRoZSBhdXRoIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwodXNlciwgY3JlZGVudGlhbCkge1xyXG4gICAgcmV0dXJuIF9yZWF1dGhlbnRpY2F0ZShnZXRNb2R1bGFySW5zdGFuY2UodXNlciksIGNyZWRlbnRpYWwpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhDdXN0b21Ub2tlbiQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoQ3VzdG9tVG9rZW5cIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfQ1VTVE9NX1RPS0VOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB1c2luZyBhIGN1c3RvbSB0b2tlbi5cclxuICpcclxuICogQHJlbWFya3NcclxuICogQ3VzdG9tIHRva2VucyBhcmUgdXNlZCB0byBpbnRlZ3JhdGUgRmlyZWJhc2UgQXV0aCB3aXRoIGV4aXN0aW5nIGF1dGggc3lzdGVtcywgYW5kIG11c3RcclxuICogYmUgZ2VuZXJhdGVkIGJ5IGFuIGF1dGggYmFja2VuZCB1c2luZyB0aGVcclxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL3JlZmVyZW5jZS9hZG1pbi9ub2RlL2FkbWluLmF1dGguQXV0aCNjcmVhdGVjdXN0b210b2tlbiB8IGNyZWF0ZUN1c3RvbVRva2VufVxyXG4gKiBtZXRob2QgaW4gdGhlIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9hdXRoL2FkbWluIHwgQWRtaW4gU0RLfSAuXHJcbiAqXHJcbiAqIEZhaWxzIHdpdGggYW4gZXJyb3IgaWYgdGhlIHRva2VuIGlzIGludmFsaWQsIGV4cGlyZWQsIG9yIG5vdCBhY2NlcHRlZCBieSB0aGUgRmlyZWJhc2UgQXV0aCBzZXJ2aWNlLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBjdXN0b21Ub2tlbiAtIFRoZSBjdXN0b20gdG9rZW4gdG8gc2lnbiBpbiB3aXRoLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoQ3VzdG9tVG9rZW4oYXV0aCwgY3VzdG9tVG9rZW4pIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2lnbkluV2l0aEN1c3RvbVRva2VuJDEoYXV0aEludGVybmFsLCB7XHJcbiAgICAgICAgdG9rZW46IGN1c3RvbVRva2VuLFxyXG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGNyZWQgPSBhd2FpdCBVc2VyQ3JlZGVudGlhbEltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aEludGVybmFsLCBcInNpZ25JblwiIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLywgcmVzcG9uc2UpO1xyXG4gICAgYXdhaXQgYXV0aEludGVybmFsLl91cGRhdGVDdXJyZW50VXNlcihjcmVkLnVzZXIpO1xyXG4gICAgcmV0dXJuIGNyZWQ7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgTXVsdGlGYWN0b3JJbmZvSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihmYWN0b3JJZCwgcmVzcG9uc2UpIHtcclxuICAgICAgICB0aGlzLmZhY3RvcklkID0gZmFjdG9ySWQ7XHJcbiAgICAgICAgdGhpcy51aWQgPSByZXNwb25zZS5tZmFFbnJvbGxtZW50SWQ7XHJcbiAgICAgICAgdGhpcy5lbnJvbGxtZW50VGltZSA9IG5ldyBEYXRlKHJlc3BvbnNlLmVucm9sbGVkQXQpLnRvVVRDU3RyaW5nKCk7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IHJlc3BvbnNlLmRpc3BsYXlOYW1lO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIF9mcm9tU2VydmVyUmVzcG9uc2UoYXV0aCwgZW5yb2xsbWVudCkge1xyXG4gICAgICAgIGlmICgncGhvbmVJbmZvJyBpbiBlbnJvbGxtZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQaG9uZU11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZShhdXRoLCBlbnJvbGxtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF9mYWlsKGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBQaG9uZU11bHRpRmFjdG9ySW5mb0ltcGwgZXh0ZW5kcyBNdWx0aUZhY3RvckluZm9JbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgc3VwZXIoXCJwaG9uZVwiIC8qIEZhY3RvcklkLlBIT05FICovLCByZXNwb25zZSk7XHJcbiAgICAgICAgdGhpcy5waG9uZU51bWJlciA9IHJlc3BvbnNlLnBob25lSW5mbztcclxuICAgIH1cclxuICAgIHN0YXRpYyBfZnJvbVNlcnZlclJlc3BvbnNlKF9hdXRoLCBlbnJvbGxtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQaG9uZU11bHRpRmFjdG9ySW5mb0ltcGwoZW5yb2xsbWVudCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gX3NldEFjdGlvbkNvZGVTZXR0aW5nc09uUmVxdWVzdChhdXRoLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgIHZhciBfYTtcclxuICAgIF9hc3NlcnQoKChfYSA9IGFjdGlvbkNvZGVTZXR0aW5ncy51cmwpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCwgYXV0aCwgXCJpbnZhbGlkLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT05USU5VRV9VUkkgKi8pO1xyXG4gICAgX2Fzc2VydCh0eXBlb2YgYWN0aW9uQ29kZVNldHRpbmdzLmR5bmFtaWNMaW5rRG9tYWluID09PSAndW5kZWZpbmVkJyB8fFxyXG4gICAgICAgIGFjdGlvbkNvZGVTZXR0aW5ncy5keW5hbWljTGlua0RvbWFpbi5sZW5ndGggPiAwLCBhdXRoLCBcImludmFsaWQtZHluYW1pYy1saW5rLWRvbWFpblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9EWU5BTUlDX0xJTktfRE9NQUlOICovKTtcclxuICAgIHJlcXVlc3QuY29udGludWVVcmwgPSBhY3Rpb25Db2RlU2V0dGluZ3MudXJsO1xyXG4gICAgcmVxdWVzdC5keW5hbWljTGlua0RvbWFpbiA9IGFjdGlvbkNvZGVTZXR0aW5ncy5keW5hbWljTGlua0RvbWFpbjtcclxuICAgIHJlcXVlc3QuY2FuSGFuZGxlQ29kZUluQXBwID0gYWN0aW9uQ29kZVNldHRpbmdzLmhhbmRsZUNvZGVJbkFwcDtcclxuICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MuaU9TKSB7XHJcbiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlU2V0dGluZ3MuaU9TLmJ1bmRsZUlkLmxlbmd0aCA+IDAsIGF1dGgsIFwibWlzc2luZy1pb3MtYnVuZGxlLWlkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0lPU19CVU5ETEVfSUQgKi8pO1xyXG4gICAgICAgIHJlcXVlc3QuaU9TQnVuZGxlSWQgPSBhY3Rpb25Db2RlU2V0dGluZ3MuaU9TLmJ1bmRsZUlkO1xyXG4gICAgfVxyXG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkKSB7XHJcbiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlU2V0dGluZ3MuYW5kcm9pZC5wYWNrYWdlTmFtZS5sZW5ndGggPiAwLCBhdXRoLCBcIm1pc3NpbmctYW5kcm9pZC1wa2ctbmFtZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqLyk7XHJcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkSW5zdGFsbEFwcCA9IGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkLmluc3RhbGxBcHA7XHJcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkTWluaW11bVZlcnNpb25Db2RlID1cclxuICAgICAgICAgICAgYWN0aW9uQ29kZVNldHRpbmdzLmFuZHJvaWQubWluaW11bVZlcnNpb247XHJcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkUGFja2FnZU5hbWUgPSBhY3Rpb25Db2RlU2V0dGluZ3MuYW5kcm9pZC5wYWNrYWdlTmFtZTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogU2VuZHMgYSBwYXNzd29yZCByZXNldCBlbWFpbCB0byB0aGUgZ2l2ZW4gZW1haWwgYWRkcmVzcy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVG8gY29tcGxldGUgdGhlIHBhc3N3b3JkIHJlc2V0LCBjYWxsIHtAbGluayBjb25maXJtUGFzc3dvcmRSZXNldH0gd2l0aCB0aGUgY29kZSBzdXBwbGllZCBpblxyXG4gKiB0aGUgZW1haWwgc2VudCB0byB0aGUgdXNlciwgYWxvbmcgd2l0aCB0aGUgbmV3IHBhc3N3b3JkIHNwZWNpZmllZCBieSB0aGUgdXNlci5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBjb25zdCBhY3Rpb25Db2RlU2V0dGluZ3MgPSB7XHJcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxyXG4gKiAgIGlPUzoge1xyXG4gKiAgICAgIGJ1bmRsZUlkOiAnY29tLmV4YW1wbGUuaW9zJ1xyXG4gKiAgIH0sXHJcbiAqICAgYW5kcm9pZDoge1xyXG4gKiAgICAgcGFja2FnZU5hbWU6ICdjb20uZXhhbXBsZS5hbmRyb2lkJyxcclxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXHJcbiAqICAgICBtaW5pbXVtVmVyc2lvbjogJzEyJ1xyXG4gKiAgIH0sXHJcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXHJcbiAqIH07XHJcbiAqIGF3YWl0IHNlbmRQYXNzd29yZFJlc2V0RW1haWwoYXV0aCwgJ3VzZXJAZXhhbXBsZS5jb20nLCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gKiAvLyBPYnRhaW4gY29kZSBmcm9tIHVzZXIuXHJcbiAqIGF3YWl0IGNvbmZpcm1QYXNzd29yZFJlc2V0KCd1c2VyQGV4YW1wbGUuY29tJywgY29kZSk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VuZFBhc3N3b3JkUmVzZXRFbWFpbChhdXRoLCBlbWFpbCwgYWN0aW9uQ29kZVNldHRpbmdzKSB7XHJcbiAgICBjb25zdCBhdXRoTW9kdWxhciA9IGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgcmVxdWVzdFR5cGU6IFwiUEFTU1dPUkRfUkVTRVRcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlBBU1NXT1JEX1JFU0VUICovLFxyXG4gICAgICAgIGVtYWlsXHJcbiAgICB9O1xyXG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QoYXV0aE1vZHVsYXIsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBhd2FpdCBzZW5kUGFzc3dvcmRSZXNldEVtYWlsJDEoYXV0aE1vZHVsYXIsIHJlcXVlc3QpO1xyXG59XHJcbi8qKlxyXG4gKiBDb21wbGV0ZXMgdGhlIHBhc3N3b3JkIHJlc2V0IHByb2Nlc3MsIGdpdmVuIGEgY29uZmlybWF0aW9uIGNvZGUgYW5kIG5ldyBwYXNzd29yZC5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gb29iQ29kZSAtIEEgY29uZmlybWF0aW9uIGNvZGUgc2VudCB0byB0aGUgdXNlci5cclxuICogQHBhcmFtIG5ld1Bhc3N3b3JkIC0gVGhlIG5ldyBwYXNzd29yZC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY29uZmlybVBhc3N3b3JkUmVzZXQoYXV0aCwgb29iQ29kZSwgbmV3UGFzc3dvcmQpIHtcclxuICAgIGF3YWl0IHJlc2V0UGFzc3dvcmQoZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLCB7XHJcbiAgICAgICAgb29iQ29kZSxcclxuICAgICAgICBuZXdQYXNzd29yZFxyXG4gICAgfSk7XHJcbiAgICAvLyBEbyBub3QgcmV0dXJuIHRoZSBlbWFpbC5cclxufVxyXG4vKipcclxuICogQXBwbGllcyBhIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIgYnkgZW1haWwgb3Igb3RoZXIgb3V0LW9mLWJhbmQgbWVjaGFuaXNtLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBvb2JDb2RlIC0gQSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBhcHBseUFjdGlvbkNvZGUoYXV0aCwgb29iQ29kZSkge1xyXG4gICAgYXdhaXQgYXBwbHlBY3Rpb25Db2RlJDEoZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLCB7IG9vYkNvZGUgfSk7XHJcbn1cclxuLyoqXHJcbiAqIENoZWNrcyBhIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIgYnkgZW1haWwgb3Igb3RoZXIgb3V0LW9mLWJhbmQgbWVjaGFuaXNtLlxyXG4gKlxyXG4gKiBAcmV0dXJucyBtZXRhZGF0YSBhYm91dCB0aGUgY29kZS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gb29iQ29kZSAtIEEgdmVyaWZpY2F0aW9uIGNvZGUgc2VudCB0byB0aGUgdXNlci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY2hlY2tBY3Rpb25Db2RlKGF1dGgsIG9vYkNvZGUpIHtcclxuICAgIGNvbnN0IGF1dGhNb2R1bGFyID0gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXNldFBhc3N3b3JkKGF1dGhNb2R1bGFyLCB7IG9vYkNvZGUgfSk7XHJcbiAgICAvLyBFbWFpbCBjb3VsZCBiZSBlbXB0eSBvbmx5IGlmIHRoZSByZXF1ZXN0IHR5cGUgaXMgRU1BSUxfU0lHTklOIG9yXHJcbiAgICAvLyBWRVJJRllfQU5EX0NIQU5HRV9FTUFJTC5cclxuICAgIC8vIE5ldyBlbWFpbCBzaG91bGQgbm90IGJlIGVtcHR5IGlmIHRoZSByZXF1ZXN0IHR5cGUgaXNcclxuICAgIC8vIFZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMLlxyXG4gICAgLy8gTXVsdGktZmFjdG9yIGluZm8gY291bGQgbm90IGJlIGVtcHR5IGlmIHRoZSByZXF1ZXN0IHR5cGUgaXNcclxuICAgIC8vIFJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OLlxyXG4gICAgY29uc3Qgb3BlcmF0aW9uID0gcmVzcG9uc2UucmVxdWVzdFR5cGU7XHJcbiAgICBfYXNzZXJ0KG9wZXJhdGlvbiwgYXV0aE1vZHVsYXIsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7XHJcbiAgICAgICAgY2FzZSBcIkVNQUlMX1NJR05JTlwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uRU1BSUxfU0lHTklOICovOlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiVkVSSUZZX0FORF9DSEFOR0VfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMICovOlxyXG4gICAgICAgICAgICBfYXNzZXJ0KHJlc3BvbnNlLm5ld0VtYWlsLCBhdXRoTW9kdWxhciwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIFwiUkVWRVJUX1NFQ09ORF9GQUNUT1JfQURESVRJT05cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OICovOlxyXG4gICAgICAgICAgICBfYXNzZXJ0KHJlc3BvbnNlLm1mYUluZm8sIGF1dGhNb2R1bGFyLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgLy8gZmFsbCB0aHJvdWdoXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgX2Fzc2VydChyZXNwb25zZS5lbWFpbCwgYXV0aE1vZHVsYXIsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgIH1cclxuICAgIC8vIFRoZSBtdWx0aS1mYWN0b3IgaW5mbyBmb3IgcmV2ZXJ0IHNlY29uZCBmYWN0b3IgYWRkaXRpb25cclxuICAgIGxldCBtdWx0aUZhY3RvckluZm8gPSBudWxsO1xyXG4gICAgaWYgKHJlc3BvbnNlLm1mYUluZm8pIHtcclxuICAgICAgICBtdWx0aUZhY3RvckluZm8gPSBNdWx0aUZhY3RvckluZm9JbXBsLl9mcm9tU2VydmVyUmVzcG9uc2UoX2Nhc3RBdXRoKGF1dGhNb2R1bGFyKSwgcmVzcG9uc2UubWZhSW5mbyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgZW1haWw6IChyZXNwb25zZS5yZXF1ZXN0VHlwZSA9PT0gXCJWRVJJRllfQU5EX0NIQU5HRV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwgKi9cclxuICAgICAgICAgICAgICAgID8gcmVzcG9uc2UubmV3RW1haWxcclxuICAgICAgICAgICAgICAgIDogcmVzcG9uc2UuZW1haWwpIHx8IG51bGwsXHJcbiAgICAgICAgICAgIHByZXZpb3VzRW1haWw6IChyZXNwb25zZS5yZXF1ZXN0VHlwZSA9PT0gXCJWRVJJRllfQU5EX0NIQU5HRV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwgKi9cclxuICAgICAgICAgICAgICAgID8gcmVzcG9uc2UuZW1haWxcclxuICAgICAgICAgICAgICAgIDogcmVzcG9uc2UubmV3RW1haWwpIHx8IG51bGwsXHJcbiAgICAgICAgICAgIG11bHRpRmFjdG9ySW5mb1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3BlcmF0aW9uXHJcbiAgICB9O1xyXG59XHJcbi8qKlxyXG4gKiBDaGVja3MgYSBwYXNzd29yZCByZXNldCBjb2RlIHNlbnQgdG8gdGhlIHVzZXIgYnkgZW1haWwgb3Igb3RoZXIgb3V0LW9mLWJhbmQgbWVjaGFuaXNtLlxyXG4gKlxyXG4gKiBAcmV0dXJucyB0aGUgdXNlcidzIGVtYWlsIGFkZHJlc3MgaWYgdmFsaWQuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGNvZGUgLSBBIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeVBhc3N3b3JkUmVzZXRDb2RlKGF1dGgsIGNvZGUpIHtcclxuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgY2hlY2tBY3Rpb25Db2RlKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgY29kZSk7XHJcbiAgICAvLyBFbWFpbCBzaG91bGQgYWx3YXlzIGJlIHByZXNlbnQgc2luY2UgYSBjb2RlIHdhcyBzZW50IHRvIGl0XHJcbiAgICByZXR1cm4gZGF0YS5lbWFpbDtcclxufVxyXG4vKipcclxuICogQ3JlYXRlcyBhIG5ldyB1c2VyIGFjY291bnQgYXNzb2NpYXRlZCB3aXRoIHRoZSBzcGVjaWZpZWQgZW1haWwgYWRkcmVzcyBhbmQgcGFzc3dvcmQuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIE9uIHN1Y2Nlc3NmdWwgY3JlYXRpb24gb2YgdGhlIHVzZXIgYWNjb3VudCwgdGhpcyB1c2VyIHdpbGwgYWxzbyBiZSBzaWduZWQgaW4gdG8geW91ciBhcHBsaWNhdGlvbi5cclxuICpcclxuICogVXNlciBhY2NvdW50IGNyZWF0aW9uIGNhbiBmYWlsIGlmIHRoZSBhY2NvdW50IGFscmVhZHkgZXhpc3RzIG9yIHRoZSBwYXNzd29yZCBpcyBpbnZhbGlkLlxyXG4gKlxyXG4gKiBOb3RlOiBUaGUgZW1haWwgYWRkcmVzcyBhY3RzIGFzIGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSB1c2VyIGFuZCBlbmFibGVzIGFuIGVtYWlsLWJhc2VkXHJcbiAqIHBhc3N3b3JkIHJlc2V0LiBUaGlzIGZ1bmN0aW9uIHdpbGwgY3JlYXRlIGEgbmV3IHVzZXIgYWNjb3VudCBhbmQgc2V0IHRoZSBpbml0aWFsIHVzZXIgcGFzc3dvcmQuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKiBAcGFyYW0gcGFzc3dvcmQgLSBUaGUgdXNlcidzIGNob3NlbiBwYXNzd29yZC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCkge1xyXG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzaWduVXAoYXV0aEludGVybmFsLCB7XHJcbiAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWUsXHJcbiAgICAgICAgZW1haWwsXHJcbiAgICAgICAgcGFzc3dvcmRcclxuICAgIH0pO1xyXG4gICAgY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBVc2VyQ3JlZGVudGlhbEltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aEludGVybmFsLCBcInNpZ25JblwiIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLywgcmVzcG9uc2UpO1xyXG4gICAgYXdhaXQgYXV0aEludGVybmFsLl91cGRhdGVDdXJyZW50VXNlcih1c2VyQ3JlZGVudGlhbC51c2VyKTtcclxuICAgIHJldHVybiB1c2VyQ3JlZGVudGlhbDtcclxufVxyXG4vKipcclxuICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gdXNpbmcgYW4gZW1haWwgYW5kIHBhc3N3b3JkLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBGYWlscyB3aXRoIGFuIGVycm9yIGlmIHRoZSBlbWFpbCBhZGRyZXNzIGFuZCBwYXNzd29yZCBkbyBub3QgbWF0Y2guXHJcbiAqXHJcbiAqIE5vdGU6IFRoZSB1c2VyJ3MgcGFzc3dvcmQgaXMgTk9UIHRoZSBwYXNzd29yZCB1c2VkIHRvIGFjY2VzcyB0aGUgdXNlcidzIGVtYWlsIGFjY291bnQuIFRoZVxyXG4gKiBlbWFpbCBhZGRyZXNzIHNlcnZlcyBhcyBhIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdXNlciwgYW5kIHRoZSBwYXNzd29yZCBpcyB1c2VkIHRvIGFjY2Vzc1xyXG4gKiB0aGUgdXNlcidzIGFjY291bnQgaW4geW91ciBGaXJlYmFzZSBwcm9qZWN0LiBTZWUgYWxzbzoge0BsaW5rIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZH0uXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXJzIGVtYWlsIGFkZHJlc3MuXHJcbiAqIEBwYXJhbSBwYXNzd29yZCAtIFRoZSB1c2VycyBwYXNzd29yZC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgICByZXR1cm4gc2lnbkluV2l0aENyZWRlbnRpYWwoZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLCBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsKGVtYWlsLCBwYXNzd29yZCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBTZW5kcyBhIHNpZ24taW4gZW1haWwgbGluayB0byB0aGUgdXNlciB3aXRoIHRoZSBzcGVjaWZpZWQgZW1haWwuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoZSBzaWduLWluIG9wZXJhdGlvbiBoYXMgdG8gYWx3YXlzIGJlIGNvbXBsZXRlZCBpbiB0aGUgYXBwIHVubGlrZSBvdGhlciBvdXQgb2YgYmFuZCBlbWFpbFxyXG4gKiBhY3Rpb25zIChwYXNzd29yZCByZXNldCBhbmQgZW1haWwgdmVyaWZpY2F0aW9ucykuIFRoaXMgaXMgYmVjYXVzZSwgYXQgdGhlIGVuZCBvZiB0aGUgZmxvdyxcclxuICogdGhlIHVzZXIgaXMgZXhwZWN0ZWQgdG8gYmUgc2lnbmVkIGluIGFuZCB0aGVpciBBdXRoIHN0YXRlIHBlcnNpc3RlZCB3aXRoaW4gdGhlIGFwcC5cclxuICpcclxuICogVG8gY29tcGxldGUgc2lnbiBpbiB3aXRoIHRoZSBlbWFpbCBsaW5rLCBjYWxsIHtAbGluayBzaWduSW5XaXRoRW1haWxMaW5rfSB3aXRoIHRoZSBlbWFpbFxyXG4gKiBhZGRyZXNzIGFuZCB0aGUgZW1haWwgbGluayBzdXBwbGllZCBpbiB0aGUgZW1haWwgc2VudCB0byB0aGUgdXNlci5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBjb25zdCBhY3Rpb25Db2RlU2V0dGluZ3MgPSB7XHJcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxyXG4gKiAgIGlPUzoge1xyXG4gKiAgICAgIGJ1bmRsZUlkOiAnY29tLmV4YW1wbGUuaW9zJ1xyXG4gKiAgIH0sXHJcbiAqICAgYW5kcm9pZDoge1xyXG4gKiAgICAgcGFja2FnZU5hbWU6ICdjb20uZXhhbXBsZS5hbmRyb2lkJyxcclxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXHJcbiAqICAgICBtaW5pbXVtVmVyc2lvbjogJzEyJ1xyXG4gKiAgIH0sXHJcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXHJcbiAqIH07XHJcbiAqIGF3YWl0IHNlbmRTaWduSW5MaW5rVG9FbWFpbChhdXRoLCAndXNlckBleGFtcGxlLmNvbScsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB0aGUgdXNlci5cclxuICogaWYoaXNTaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsIGVtYWlsTGluaykpIHtcclxuICogICBhd2FpdCBzaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsICd1c2VyQGV4YW1wbGUuY29tJywgZW1haWxMaW5rKTtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIGF1dGhJbnRlcm5hbCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsIGVtYWlsLCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgIGNvbnN0IGF1dGhNb2R1bGFyID0gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICByZXF1ZXN0VHlwZTogXCJFTUFJTF9TSUdOSU5cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLkVNQUlMX1NJR05JTiAqLyxcclxuICAgICAgICBlbWFpbFxyXG4gICAgfTtcclxuICAgIF9hc3NlcnQoYWN0aW9uQ29kZVNldHRpbmdzLmhhbmRsZUNvZGVJbkFwcCwgYXV0aE1vZHVsYXIsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgICAgICBfc2V0QWN0aW9uQ29kZVNldHRpbmdzT25SZXF1ZXN0KGF1dGhNb2R1bGFyLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgc2VuZFNpZ25JbkxpbmtUb0VtYWlsJDEoYXV0aE1vZHVsYXIsIHJlcXVlc3QpO1xyXG59XHJcbi8qKlxyXG4gKiBDaGVja3MgaWYgYW4gaW5jb21pbmcgbGluayBpcyBhIHNpZ24taW4gd2l0aCBlbWFpbCBsaW5rIHN1aXRhYmxlIGZvciB7QGxpbmsgc2lnbkluV2l0aEVtYWlsTGlua30uXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVtYWlsTGluayAtIFRoZSBsaW5rIHNlbnQgdG8gdGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBpc1NpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgZW1haWxMaW5rKSB7XHJcbiAgICBjb25zdCBhY3Rpb25Db2RlVXJsID0gQWN0aW9uQ29kZVVSTC5wYXJzZUxpbmsoZW1haWxMaW5rKTtcclxuICAgIHJldHVybiAoYWN0aW9uQ29kZVVybCA9PT0gbnVsbCB8fCBhY3Rpb25Db2RlVXJsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3Rpb25Db2RlVXJsLm9wZXJhdGlvbikgPT09IFwiRU1BSUxfU0lHTklOXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5FTUFJTF9TSUdOSU4gKi87XHJcbn1cclxuLyoqXHJcbiAqIEFzeW5jaHJvbm91c2x5IHNpZ25zIGluIHVzaW5nIGFuIGVtYWlsIGFuZCBzaWduLWluIGVtYWlsIGxpbmsuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIElmIG5vIGxpbmsgaXMgcGFzc2VkLCB0aGUgbGluayBpcyBpbmZlcnJlZCBmcm9tIHRoZSBjdXJyZW50IFVSTC5cclxuICpcclxuICogRmFpbHMgd2l0aCBhbiBlcnJvciBpZiB0aGUgZW1haWwgYWRkcmVzcyBpcyBpbnZhbGlkIG9yIE9UUCBpbiBlbWFpbCBsaW5rIGV4cGlyZXMuXHJcbiAqXHJcbiAqIE5vdGU6IENvbmZpcm0gdGhlIGxpbmsgaXMgYSBzaWduLWluIGVtYWlsIGxpbmsgYmVmb3JlIGNhbGxpbmcgdGhpcyBtZXRob2QgZmlyZWJhc2UuYXV0aC5BdXRoLmlzU2lnbkluV2l0aEVtYWlsTGluay5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBjb25zdCBhY3Rpb25Db2RlU2V0dGluZ3MgPSB7XHJcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxyXG4gKiAgIGlPUzoge1xyXG4gKiAgICAgIGJ1bmRsZUlkOiAnY29tLmV4YW1wbGUuaW9zJ1xyXG4gKiAgIH0sXHJcbiAqICAgYW5kcm9pZDoge1xyXG4gKiAgICAgcGFja2FnZU5hbWU6ICdjb20uZXhhbXBsZS5hbmRyb2lkJyxcclxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXHJcbiAqICAgICBtaW5pbXVtVmVyc2lvbjogJzEyJ1xyXG4gKiAgIH0sXHJcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXHJcbiAqIH07XHJcbiAqIGF3YWl0IHNlbmRTaWduSW5MaW5rVG9FbWFpbChhdXRoLCAndXNlckBleGFtcGxlLmNvbScsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB0aGUgdXNlci5cclxuICogaWYoaXNTaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsIGVtYWlsTGluaykpIHtcclxuICogICBhd2FpdCBzaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsICd1c2VyQGV4YW1wbGUuY29tJywgZW1haWxMaW5rKTtcclxuICogfVxyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gZW1haWwgLSBUaGUgdXNlcidzIGVtYWlsIGFkZHJlc3MuXHJcbiAqIEBwYXJhbSBlbWFpbExpbmsgLSBUaGUgbGluayBzZW50IHRvIHRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEVtYWlsTGluayhhdXRoLCBlbWFpbCwgZW1haWxMaW5rKSB7XHJcbiAgICBjb25zdCBhdXRoTW9kdWxhciA9IGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcclxuICAgIGNvbnN0IGNyZWRlbnRpYWwgPSBFbWFpbEF1dGhQcm92aWRlci5jcmVkZW50aWFsV2l0aExpbmsoZW1haWwsIGVtYWlsTGluayB8fCBfZ2V0Q3VycmVudFVybCgpKTtcclxuICAgIC8vIENoZWNrIGlmIHRoZSB0ZW5hbnQgSUQgaW4gdGhlIGVtYWlsIGxpbmsgbWF0Y2hlcyB0aGUgdGVuYW50IElEIG9uIEF1dGhcclxuICAgIC8vIGluc3RhbmNlLlxyXG4gICAgX2Fzc2VydChjcmVkZW50aWFsLl90ZW5hbnRJZCA9PT0gKGF1dGhNb2R1bGFyLnRlbmFudElkIHx8IG51bGwpLCBhdXRoTW9kdWxhciwgXCJ0ZW5hbnQtaWQtbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlRFTkFOVF9JRF9NSVNNQVRDSCAqLyk7XHJcbiAgICByZXR1cm4gc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aE1vZHVsYXIsIGNyZWRlbnRpYWwpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUF1dGhVcmkoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOmNyZWF0ZUF1dGhVcmlcIiAvKiBFbmRwb2ludC5DUkVBVEVfQVVUSF9VUkkgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEdldHMgdGhlIGxpc3Qgb2YgcG9zc2libGUgc2lnbiBpbiBtZXRob2RzIGZvciB0aGUgZ2l2ZW4gZW1haWwgYWRkcmVzcy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBpcyB1c2VmdWwgdG8gZGlmZmVyZW50aWF0ZSBtZXRob2RzIG9mIHNpZ24taW4gZm9yIHRoZSBzYW1lIHByb3ZpZGVyLCBlZy5cclxuICoge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSB3aGljaCBoYXMgMiBtZXRob2RzIG9mIHNpZ24taW4sXHJcbiAqIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JEIGFuZFxyXG4gKiB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9MSU5LLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hTaWduSW5NZXRob2RzRm9yRW1haWwoYXV0aCwgZW1haWwpIHtcclxuICAgIC8vIGNyZWF0ZUF1dGhVcmkgcmV0dXJucyBhbiBlcnJvciBpZiBjb250aW51ZSBVUkkgaXMgbm90IGh0dHAgb3IgaHR0cHMuXHJcbiAgICAvLyBGb3IgZW52aXJvbm1lbnRzIGxpa2UgQ29yZG92YSwgQ2hyb21lIGV4dGVuc2lvbnMsIG5hdGl2ZSBmcmFtZXdvcmtzLCBmaWxlXHJcbiAgICAvLyBzeXN0ZW1zLCBldGMsIHVzZSBodHRwOi8vbG9jYWxob3N0IGFzIGNvbnRpbnVlIFVSTC5cclxuICAgIGNvbnN0IGNvbnRpbnVlVXJpID0gX2lzSHR0cE9ySHR0cHMoKSA/IF9nZXRDdXJyZW50VXJsKCkgOiAnaHR0cDovL2xvY2FsaG9zdCc7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgICAgIGlkZW50aWZpZXI6IGVtYWlsLFxyXG4gICAgICAgIGNvbnRpbnVlVXJpXHJcbiAgICB9O1xyXG4gICAgY29uc3QgeyBzaWduaW5NZXRob2RzIH0gPSBhd2FpdCBjcmVhdGVBdXRoVXJpKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgcmVxdWVzdCk7XHJcbiAgICByZXR1cm4gc2lnbmluTWV0aG9kcyB8fCBbXTtcclxufVxyXG4vKipcclxuICogU2VuZHMgYSB2ZXJpZmljYXRpb24gZW1haWwgdG8gYSB1c2VyLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGUgdmVyaWZpY2F0aW9uIHByb2Nlc3MgaXMgY29tcGxldGVkIGJ5IGNhbGxpbmcge0BsaW5rIGFwcGx5QWN0aW9uQ29kZX0uXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xyXG4gKiAgIHVybDogJ2h0dHBzOi8vd3d3LmV4YW1wbGUuY29tLz9lbWFpbD11c2VyQGV4YW1wbGUuY29tJyxcclxuICogICBpT1M6IHtcclxuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcclxuICogICB9LFxyXG4gKiAgIGFuZHJvaWQ6IHtcclxuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXHJcbiAqICAgICBpbnN0YWxsQXBwOiB0cnVlLFxyXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcclxuICogICB9LFxyXG4gKiAgIGhhbmRsZUNvZGVJbkFwcDogdHJ1ZVxyXG4gKiB9O1xyXG4gKiBhd2FpdCBzZW5kRW1haWxWZXJpZmljYXRpb24odXNlciwgYWN0aW9uQ29kZVNldHRpbmdzKTtcclxuICogLy8gT2J0YWluIGNvZGUgZnJvbSB0aGUgdXNlci5cclxuICogYXdhaXQgYXBwbHlBY3Rpb25Db2RlKGF1dGgsIGNvZGUpO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2VuZEVtYWlsVmVyaWZpY2F0aW9uKHVzZXIsIGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICByZXF1ZXN0VHlwZTogXCJWRVJJRllfRU1BSUxcIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlZFUklGWV9FTUFJTCAqLyxcclxuICAgICAgICBpZFRva2VuXHJcbiAgICB9O1xyXG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QodXNlckludGVybmFsLmF1dGgsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB7IGVtYWlsIH0gPSBhd2FpdCBzZW5kRW1haWxWZXJpZmljYXRpb24kMSh1c2VySW50ZXJuYWwuYXV0aCwgcmVxdWVzdCk7XHJcbiAgICBpZiAoZW1haWwgIT09IHVzZXIuZW1haWwpIHtcclxuICAgICAgICBhd2FpdCB1c2VyLnJlbG9hZCgpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBTZW5kcyBhIHZlcmlmaWNhdGlvbiBlbWFpbCB0byBhIG5ldyBlbWFpbCBhZGRyZXNzLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUaGUgdXNlcidzIGVtYWlsIHdpbGwgYmUgdXBkYXRlZCB0byB0aGUgbmV3IG9uZSBhZnRlciBiZWluZyB2ZXJpZmllZC5cclxuICpcclxuICogSWYgeW91IGhhdmUgYSBjdXN0b20gZW1haWwgYWN0aW9uIGhhbmRsZXIsIHlvdSBjYW4gY29tcGxldGUgdGhlIHZlcmlmaWNhdGlvbiBwcm9jZXNzIGJ5IGNhbGxpbmdcclxuICoge0BsaW5rIGFwcGx5QWN0aW9uQ29kZX0uXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xyXG4gKiAgIHVybDogJ2h0dHBzOi8vd3d3LmV4YW1wbGUuY29tLz9lbWFpbD11c2VyQGV4YW1wbGUuY29tJyxcclxuICogICBpT1M6IHtcclxuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcclxuICogICB9LFxyXG4gKiAgIGFuZHJvaWQ6IHtcclxuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXHJcbiAqICAgICBpbnN0YWxsQXBwOiB0cnVlLFxyXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcclxuICogICB9LFxyXG4gKiAgIGhhbmRsZUNvZGVJbkFwcDogdHJ1ZVxyXG4gKiB9O1xyXG4gKiBhd2FpdCB2ZXJpZnlCZWZvcmVVcGRhdGVFbWFpbCh1c2VyLCAnbmV3ZW1haWxAZXhhbXBsZS5jb20nLCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gKiAvLyBPYnRhaW4gY29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gKiBhd2FpdCBhcHBseUFjdGlvbkNvZGUoYXV0aCwgY29kZSk7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gbmV3RW1haWwgLSBUaGUgbmV3IGVtYWlsIGFkZHJlc3MgdG8gYmUgdmVyaWZpZWQgYmVmb3JlIHVwZGF0ZS5cclxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QmVmb3JlVXBkYXRlRW1haWwodXNlciwgbmV3RW1haWwsIGFjdGlvbkNvZGVTZXR0aW5ncykge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICByZXF1ZXN0VHlwZTogXCJWRVJJRllfQU5EX0NIQU5HRV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwgKi8sXHJcbiAgICAgICAgaWRUb2tlbixcclxuICAgICAgICBuZXdFbWFpbFxyXG4gICAgfTtcclxuICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MpIHtcclxuICAgICAgICBfc2V0QWN0aW9uQ29kZVNldHRpbmdzT25SZXF1ZXN0KHVzZXJJbnRlcm5hbC5hdXRoLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBlbWFpbCB9ID0gYXdhaXQgdmVyaWZ5QW5kQ2hhbmdlRW1haWwodXNlckludGVybmFsLmF1dGgsIHJlcXVlc3QpO1xyXG4gICAgaWYgKGVtYWlsICE9PSB1c2VyLmVtYWlsKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlIGxvY2FsIGNvcHkgb2YgdGhlIGVtYWlsIG9uIHVzZXIgaXMgb3V0ZGF0ZWQsIHJlbG9hZCB0aGVcclxuICAgICAgICAvLyB1c2VyLlxyXG4gICAgICAgIGF3YWl0IHVzZXIucmVsb2FkKCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUHJvZmlsZSQxKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czp1cGRhdGVcIiAvKiBFbmRwb2ludC5TRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogVXBkYXRlcyBhIHVzZXIncyBwcm9maWxlIGRhdGEuXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm9maWxlIC0gVGhlIHByb2ZpbGUncyBgZGlzcGxheU5hbWVgIGFuZCBgcGhvdG9VUkxgIHRvIHVwZGF0ZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlUHJvZmlsZSh1c2VyLCB7IGRpc3BsYXlOYW1lLCBwaG90b1VSTDogcGhvdG9VcmwgfSkge1xyXG4gICAgaWYgKGRpc3BsYXlOYW1lID09PSB1bmRlZmluZWQgJiYgcGhvdG9VcmwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcclxuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VySW50ZXJuYWwuZ2V0SWRUb2tlbigpO1xyXG4gICAgY29uc3QgcHJvZmlsZVJlcXVlc3QgPSB7XHJcbiAgICAgICAgaWRUb2tlbixcclxuICAgICAgICBkaXNwbGF5TmFtZSxcclxuICAgICAgICBwaG90b1VybCxcclxuICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZVxyXG4gICAgfTtcclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlckludGVybmFsLCB1cGRhdGVQcm9maWxlJDEodXNlckludGVybmFsLmF1dGgsIHByb2ZpbGVSZXF1ZXN0KSk7XHJcbiAgICB1c2VySW50ZXJuYWwuZGlzcGxheU5hbWUgPSByZXNwb25zZS5kaXNwbGF5TmFtZSB8fCBudWxsO1xyXG4gICAgdXNlckludGVybmFsLnBob3RvVVJMID0gcmVzcG9uc2UucGhvdG9VcmwgfHwgbnVsbDtcclxuICAgIC8vIFVwZGF0ZSB0aGUgcGFzc3dvcmQgcHJvdmlkZXIgYXMgd2VsbFxyXG4gICAgY29uc3QgcGFzc3dvcmRQcm92aWRlciA9IHVzZXJJbnRlcm5hbC5wcm92aWRlckRhdGEuZmluZCgoeyBwcm92aWRlcklkIH0pID0+IHByb3ZpZGVySWQgPT09IFwicGFzc3dvcmRcIiAvKiBQcm92aWRlcklkLlBBU1NXT1JEICovKTtcclxuICAgIGlmIChwYXNzd29yZFByb3ZpZGVyKSB7XHJcbiAgICAgICAgcGFzc3dvcmRQcm92aWRlci5kaXNwbGF5TmFtZSA9IHVzZXJJbnRlcm5hbC5kaXNwbGF5TmFtZTtcclxuICAgICAgICBwYXNzd29yZFByb3ZpZGVyLnBob3RvVVJMID0gdXNlckludGVybmFsLnBob3RvVVJMO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgdXNlckludGVybmFsLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSk7XHJcbn1cclxuLyoqXHJcbiAqIFVwZGF0ZXMgdGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBBbiBlbWFpbCB3aWxsIGJlIHNlbnQgdG8gdGhlIG9yaWdpbmFsIGVtYWlsIGFkZHJlc3MgKGlmIGl0IHdhcyBzZXQpIHRoYXQgYWxsb3dzIHRvIHJldm9rZSB0aGVcclxuICogZW1haWwgYWRkcmVzcyBjaGFuZ2UsIGluIG9yZGVyIHRvIHByb3RlY3QgdGhlbSBmcm9tIGFjY291bnQgaGlqYWNraW5nLlxyXG4gKlxyXG4gKiBJbXBvcnRhbnQ6IHRoaXMgaXMgYSBzZWN1cml0eSBzZW5zaXRpdmUgb3BlcmF0aW9uIHRoYXQgcmVxdWlyZXMgdGhlIHVzZXIgdG8gaGF2ZSByZWNlbnRseSBzaWduZWRcclxuICogaW4uIElmIHRoaXMgcmVxdWlyZW1lbnQgaXNuJ3QgbWV0LCBhc2sgdGhlIHVzZXIgdG8gYXV0aGVudGljYXRlIGFnYWluIGFuZCB0aGVuIGNhbGxcclxuICoge0BsaW5rIHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWx9LlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gbmV3RW1haWwgLSBUaGUgbmV3IGVtYWlsIGFkZHJlc3MuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZUVtYWlsKHVzZXIsIG5ld0VtYWlsKSB7XHJcbiAgICByZXR1cm4gdXBkYXRlRW1haWxPclBhc3N3b3JkKGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKSwgbmV3RW1haWwsIG51bGwpO1xyXG59XHJcbi8qKlxyXG4gKiBVcGRhdGVzIHRoZSB1c2VyJ3MgcGFzc3dvcmQuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIEltcG9ydGFudDogdGhpcyBpcyBhIHNlY3VyaXR5IHNlbnNpdGl2ZSBvcGVyYXRpb24gdGhhdCByZXF1aXJlcyB0aGUgdXNlciB0byBoYXZlIHJlY2VudGx5IHNpZ25lZFxyXG4gKiBpbi4gSWYgdGhpcyByZXF1aXJlbWVudCBpc24ndCBtZXQsIGFzayB0aGUgdXNlciB0byBhdXRoZW50aWNhdGUgYWdhaW4gYW5kIHRoZW4gY2FsbFxyXG4gKiB7QGxpbmsgcmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbH0uXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBuZXdQYXNzd29yZCAtIFRoZSBuZXcgcGFzc3dvcmQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZVBhc3N3b3JkKHVzZXIsIG5ld1Bhc3N3b3JkKSB7XHJcbiAgICByZXR1cm4gdXBkYXRlRW1haWxPclBhc3N3b3JkKGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKSwgbnVsbCwgbmV3UGFzc3dvcmQpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUVtYWlsT3JQYXNzd29yZCh1c2VyLCBlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgIGNvbnN0IHsgYXV0aCB9ID0gdXNlcjtcclxuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VyLmdldElkVG9rZW4oKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgaWRUb2tlbixcclxuICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZVxyXG4gICAgfTtcclxuICAgIGlmIChlbWFpbCkge1xyXG4gICAgICAgIHJlcXVlc3QuZW1haWwgPSBlbWFpbDtcclxuICAgIH1cclxuICAgIGlmIChwYXNzd29yZCkge1xyXG4gICAgICAgIHJlcXVlc3QucGFzc3dvcmQgPSBwYXNzd29yZDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodXNlciwgdXBkYXRlRW1haWxQYXNzd29yZChhdXRoLCByZXF1ZXN0KSk7XHJcbiAgICBhd2FpdCB1c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSwgLyogcmVsb2FkICovIHRydWUpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBQYXJzZSB0aGUgYEFkZGl0aW9uYWxVc2VySW5mb2AgZnJvbSB0aGUgSUQgdG9rZW4gcmVzcG9uc2UuXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBfZnJvbUlkVG9rZW5SZXNwb25zZShpZFRva2VuUmVzcG9uc2UpIHtcclxuICAgIHZhciBfYSwgX2I7XHJcbiAgICBpZiAoIWlkVG9rZW5SZXNwb25zZSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgeyBwcm92aWRlcklkIH0gPSBpZFRva2VuUmVzcG9uc2U7XHJcbiAgICBjb25zdCBwcm9maWxlID0gaWRUb2tlblJlc3BvbnNlLnJhd1VzZXJJbmZvXHJcbiAgICAgICAgPyBKU09OLnBhcnNlKGlkVG9rZW5SZXNwb25zZS5yYXdVc2VySW5mbylcclxuICAgICAgICA6IHt9O1xyXG4gICAgY29uc3QgaXNOZXdVc2VyID0gaWRUb2tlblJlc3BvbnNlLmlzTmV3VXNlciB8fFxyXG4gICAgICAgIGlkVG9rZW5SZXNwb25zZS5raW5kID09PSBcImlkZW50aXR5dG9vbGtpdCNTaWdudXBOZXdVc2VyUmVzcG9uc2VcIiAvKiBJZFRva2VuUmVzcG9uc2VLaW5kLlNpZ251cE5ld1VzZXIgKi87XHJcbiAgICBpZiAoIXByb3ZpZGVySWQgJiYgKGlkVG9rZW5SZXNwb25zZSA9PT0gbnVsbCB8fCBpZFRva2VuUmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlkVG9rZW5SZXNwb25zZS5pZFRva2VuKSkge1xyXG4gICAgICAgIGNvbnN0IHNpZ25JblByb3ZpZGVyID0gKF9iID0gKF9hID0gX3BhcnNlVG9rZW4oaWRUb2tlblJlc3BvbnNlLmlkVG9rZW4pKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlyZWJhc2UpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlsnc2lnbl9pbl9wcm92aWRlciddO1xyXG4gICAgICAgIGlmIChzaWduSW5Qcm92aWRlcikge1xyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXJlZFByb3ZpZGVySWQgPSBzaWduSW5Qcm92aWRlciAhPT0gXCJhbm9ueW1vdXNcIiAvKiBQcm92aWRlcklkLkFOT05ZTU9VUyAqLyAmJlxyXG4gICAgICAgICAgICAgICAgc2lnbkluUHJvdmlkZXIgIT09IFwiY3VzdG9tXCIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi9cclxuICAgICAgICAgICAgICAgID8gc2lnbkluUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgIDogbnVsbDtcclxuICAgICAgICAgICAgLy8gVXNlcyBnZW5lcmljIGNsYXNzIGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgbGVnYWN5IFNESy5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgZmlsdGVyZWRQcm92aWRlcklkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoIXByb3ZpZGVySWQpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHN3aXRjaCAocHJvdmlkZXJJZCkge1xyXG4gICAgICAgIGNhc2UgXCJmYWNlYm9vay5jb21cIiAvKiBQcm92aWRlcklkLkZBQ0VCT09LICovOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEZhY2Vib29rQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgcHJvZmlsZSk7XHJcbiAgICAgICAgY2FzZSBcImdpdGh1Yi5jb21cIiAvKiBQcm92aWRlcklkLkdJVEhVQiAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBHaXRodWJBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBwcm9maWxlKTtcclxuICAgICAgICBjYXNlIFwiZ29vZ2xlLmNvbVwiIC8qIFByb3ZpZGVySWQuR09PR0xFICovOlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEdvb2dsZUFkZGl0aW9uYWxVc2VySW5mbyhpc05ld1VzZXIsIHByb2ZpbGUpO1xyXG4gICAgICAgIGNhc2UgXCJ0d2l0dGVyLmNvbVwiIC8qIFByb3ZpZGVySWQuVFdJVFRFUiAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUd2l0dGVyQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgcHJvZmlsZSwgaWRUb2tlblJlc3BvbnNlLnNjcmVlbk5hbWUgfHwgbnVsbCk7XHJcbiAgICAgICAgY2FzZSBcImN1c3RvbVwiIC8qIFByb3ZpZGVySWQuQ1VTVE9NICovOlxyXG4gICAgICAgIGNhc2UgXCJhbm9ueW1vdXNcIiAvKiBQcm92aWRlcklkLkFOT05ZTU9VUyAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgbnVsbCk7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgcHJvdmlkZXJJZCwgcHJvZmlsZSk7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgR2VuZXJpY0FkZGl0aW9uYWxVc2VySW5mbyB7XHJcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb3ZpZGVySWQsIHByb2ZpbGUgPSB7fSkge1xyXG4gICAgICAgIHRoaXMuaXNOZXdVc2VyID0gaXNOZXdVc2VyO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IHByb3ZpZGVySWQ7XHJcbiAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBGZWRlcmF0ZWRBZGRpdGlvbmFsVXNlckluZm9XaXRoVXNlcm5hbWUgZXh0ZW5kcyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvIHtcclxuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvdmlkZXJJZCwgcHJvZmlsZSwgdXNlcm5hbWUpIHtcclxuICAgICAgICBzdXBlcihpc05ld1VzZXIsIHByb3ZpZGVySWQsIHByb2ZpbGUpO1xyXG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBGYWNlYm9va0FkZGl0aW9uYWxVc2VySW5mbyBleHRlbmRzIEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8ge1xyXG4gICAgY29uc3RydWN0b3IoaXNOZXdVc2VyLCBwcm9maWxlKSB7XHJcbiAgICAgICAgc3VwZXIoaXNOZXdVc2VyLCBcImZhY2Vib29rLmNvbVwiIC8qIFByb3ZpZGVySWQuRkFDRUJPT0sgKi8sIHByb2ZpbGUpO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIEdpdGh1YkFkZGl0aW9uYWxVc2VySW5mbyBleHRlbmRzIEZlZGVyYXRlZEFkZGl0aW9uYWxVc2VySW5mb1dpdGhVc2VybmFtZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb2ZpbGUpIHtcclxuICAgICAgICBzdXBlcihpc05ld1VzZXIsIFwiZ2l0aHViLmNvbVwiIC8qIFByb3ZpZGVySWQuR0lUSFVCICovLCBwcm9maWxlLCB0eXBlb2YgKHByb2ZpbGUgPT09IG51bGwgfHwgcHJvZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvZmlsZS5sb2dpbikgPT09ICdzdHJpbmcnID8gcHJvZmlsZSA9PT0gbnVsbCB8fCBwcm9maWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm9maWxlLmxvZ2luIDogbnVsbCk7XHJcbiAgICB9XHJcbn1cclxuY2xhc3MgR29vZ2xlQWRkaXRpb25hbFVzZXJJbmZvIGV4dGVuZHMgR2VuZXJpY0FkZGl0aW9uYWxVc2VySW5mbyB7XHJcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb2ZpbGUpIHtcclxuICAgICAgICBzdXBlcihpc05ld1VzZXIsIFwiZ29vZ2xlLmNvbVwiIC8qIFByb3ZpZGVySWQuR09PR0xFICovLCBwcm9maWxlKTtcclxuICAgIH1cclxufVxyXG5jbGFzcyBUd2l0dGVyQWRkaXRpb25hbFVzZXJJbmZvIGV4dGVuZHMgRmVkZXJhdGVkQWRkaXRpb25hbFVzZXJJbmZvV2l0aFVzZXJuYW1lIHtcclxuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvZmlsZSwgc2NyZWVuTmFtZSkge1xyXG4gICAgICAgIHN1cGVyKGlzTmV3VXNlciwgXCJ0d2l0dGVyLmNvbVwiIC8qIFByb3ZpZGVySWQuVFdJVFRFUiAqLywgcHJvZmlsZSwgc2NyZWVuTmFtZSk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEV4dHJhY3RzIHByb3ZpZGVyIHNwZWNpZmljIHtAbGluayBBZGRpdGlvbmFsVXNlckluZm99IGZvciB0aGUgZ2l2ZW4gY3JlZGVudGlhbC5cclxuICpcclxuICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0QWRkaXRpb25hbFVzZXJJbmZvKHVzZXJDcmVkZW50aWFsKSB7XHJcbiAgICBjb25zdCB7IHVzZXIsIF90b2tlblJlc3BvbnNlIH0gPSB1c2VyQ3JlZGVudGlhbDtcclxuICAgIGlmICh1c2VyLmlzQW5vbnltb3VzICYmICFfdG9rZW5SZXNwb25zZSkge1xyXG4gICAgICAgIC8vIEhhbmRsZSB0aGUgc3BlY2lhbCBjYXNlIHdoZXJlIHNpZ25JbkFub255bW91c2x5KCkgZ2V0cyBjYWxsZWQgdHdpY2UuXHJcbiAgICAgICAgLy8gTm8gbmV0d29yayBjYWxsIGlzIG1hZGUgc28gdGhlcmUncyBub3RoaW5nIHRvIGFjdHVhbGx5IGZpbGwgdGhpcyBpblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IG51bGwsXHJcbiAgICAgICAgICAgIGlzTmV3VXNlcjogZmFsc2UsXHJcbiAgICAgICAgICAgIHByb2ZpbGU6IG51bGxcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9mcm9tSWRUb2tlblJlc3BvbnNlKF90b2tlblJlc3BvbnNlKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vLyBOb24tb3B0aW9uYWwgYXV0aCBtZXRob2RzLlxyXG4vKipcclxuICogQ2hhbmdlcyB0aGUgdHlwZSBvZiBwZXJzaXN0ZW5jZSBvbiB0aGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIGZvciB0aGUgY3VycmVudGx5IHNhdmVkXHJcbiAqIGBBdXRoYCBzZXNzaW9uIGFuZCBhcHBsaWVzIHRoaXMgdHlwZSBvZiBwZXJzaXN0ZW5jZSBmb3IgZnV0dXJlIHNpZ24taW4gcmVxdWVzdHMsIGluY2x1ZGluZ1xyXG4gKiBzaWduLWluIHdpdGggcmVkaXJlY3QgcmVxdWVzdHMuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRoaXMgbWFrZXMgaXQgZWFzeSBmb3IgYSB1c2VyIHNpZ25pbmcgaW4gdG8gc3BlY2lmeSB3aGV0aGVyIHRoZWlyIHNlc3Npb24gc2hvdWxkIGJlXHJcbiAqIHJlbWVtYmVyZWQgb3Igbm90LiBJdCBhbHNvIG1ha2VzIGl0IGVhc2llciB0byBuZXZlciBwZXJzaXN0IHRoZSBgQXV0aGAgc3RhdGUgZm9yIGFwcGxpY2F0aW9uc1xyXG4gKiB0aGF0IGFyZSBzaGFyZWQgYnkgb3RoZXIgdXNlcnMgb3IgaGF2ZSBzZW5zaXRpdmUgZGF0YS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiBzZXRQZXJzaXN0ZW5jZShhdXRoLCBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIHBlcnNpc3RlbmNlIC0gVGhlIHtAbGluayBQZXJzaXN0ZW5jZX0gdG8gdXNlLlxyXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIG9uY2UgdGhlIHBlcnNpc3RlbmNlIGNoYW5nZSBoYXMgY29tcGxldGVkXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHNldFBlcnNpc3RlbmNlKGF1dGgsIHBlcnNpc3RlbmNlKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLnNldFBlcnNpc3RlbmNlKHBlcnNpc3RlbmNlKTtcclxufVxyXG4vKipcclxuICogQWRkcyBhbiBvYnNlcnZlciBmb3IgY2hhbmdlcyB0byB0aGUgc2lnbmVkLWluIHVzZXIncyBJRCB0b2tlbi5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBpbmNsdWRlcyBzaWduLWluLCBzaWduLW91dCwgYW5kIHRva2VuIHJlZnJlc2ggZXZlbnRzLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSBuZXh0T3JPYnNlcnZlciAtIGNhbGxiYWNrIHRyaWdnZXJlZCBvbiBjaGFuZ2UuXHJcbiAqIEBwYXJhbSBlcnJvciAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLiBFcnJvcnNcclxuICogb24gc2lnbmluZyBpbi9vdXQgY2FuIGJlIGNhdWdodCBpbiBwcm9taXNlcyByZXR1cm5lZCBmcm9tXHJcbiAqIHNpZ24taW4vc2lnbi1vdXQgZnVuY3Rpb25zLlxyXG4gKiBAcGFyYW0gY29tcGxldGVkIC0gRGVwcmVjYXRlZC4gVGhpcyBjYWxsYmFjayBpcyBuZXZlciB0cmlnZ2VyZWQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIG9uSWRUb2tlbkNoYW5nZWQoYXV0aCwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkub25JZFRva2VuQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7XHJcbn1cclxuLyoqXHJcbiAqIEFkZHMgYSBibG9ja2luZyBjYWxsYmFjayB0aGF0IHJ1bnMgYmVmb3JlIGFuIGF1dGggc3RhdGUgY2hhbmdlXHJcbiAqIHNldHMgYSBuZXcgdXNlci5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gY2FsbGJhY2sgLSBjYWxsYmFjayB0cmlnZ2VyZWQgYmVmb3JlIG5ldyB1c2VyIHZhbHVlIGlzIHNldC5cclxuICogICBJZiB0aGlzIHRocm93cywgaXQgYmxvY2tzIHRoZSB1c2VyIGZyb20gYmVpbmcgc2V0LlxyXG4gKiBAcGFyYW0gb25BYm9ydCAtIGNhbGxiYWNrIHRyaWdnZXJlZCBpZiBhIGxhdGVyIGBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKClgXHJcbiAqICAgY2FsbGJhY2sgdGhyb3dzLCBhbGxvd2luZyB5b3UgdG8gdW5kbyBhbnkgc2lkZSBlZmZlY3RzLlxyXG4gKi9cclxuZnVuY3Rpb24gYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBjYWxsYmFjaywgb25BYm9ydCkge1xyXG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKS5iZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKGNhbGxiYWNrLCBvbkFib3J0KTtcclxufVxyXG4vKipcclxuICogQWRkcyBhbiBvYnNlcnZlciBmb3IgY2hhbmdlcyB0byB0aGUgdXNlcidzIHNpZ24taW4gc3RhdGUuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRvIGtlZXAgdGhlIG9sZCBiZWhhdmlvciwgc2VlIHtAbGluayBvbklkVG9rZW5DaGFuZ2VkfS5cclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gbmV4dE9yT2JzZXJ2ZXIgLSBjYWxsYmFjayB0cmlnZ2VyZWQgb24gY2hhbmdlLlxyXG4gKiBAcGFyYW0gZXJyb3IgLSBEZXByZWNhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5ldmVyIHRyaWdnZXJlZC4gRXJyb3JzXHJcbiAqIG9uIHNpZ25pbmcgaW4vb3V0IGNhbiBiZSBjYXVnaHQgaW4gcHJvbWlzZXMgcmV0dXJuZWQgZnJvbVxyXG4gKiBzaWduLWluL3NpZ24tb3V0IGZ1bmN0aW9ucy5cclxuICogQHBhcmFtIGNvbXBsZXRlZCAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBvbkF1dGhTdGF0ZUNoYW5nZWQoYXV0aCwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkub25BdXRoU3RhdGVDaGFuZ2VkKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKTtcclxufVxyXG4vKipcclxuICogU2V0cyB0aGUgY3VycmVudCBsYW5ndWFnZSB0byB0aGUgZGVmYXVsdCBkZXZpY2UvYnJvd3NlciBwcmVmZXJlbmNlLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHVzZURldmljZUxhbmd1YWdlKGF1dGgpIHtcclxuICAgIGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKS51c2VEZXZpY2VMYW5ndWFnZSgpO1xyXG59XHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzZXRzIHRoZSBwcm92aWRlZCB1c2VyIGFzIHtAbGluayBBdXRoLmN1cnJlbnRVc2VyfSBvbiB0aGVcclxuICoge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBBIG5ldyBpbnN0YW5jZSBjb3B5IG9mIHRoZSB1c2VyIHByb3ZpZGVkIHdpbGwgYmUgbWFkZSBhbmQgc2V0IGFzIGN1cnJlbnRVc2VyLlxyXG4gKlxyXG4gKiBUaGlzIHdpbGwgdHJpZ2dlciB7QGxpbmsgb25BdXRoU3RhdGVDaGFuZ2VkfSBhbmQge0BsaW5rIG9uSWRUb2tlbkNoYW5nZWR9IGxpc3RlbmVyc1xyXG4gKiBsaWtlIG90aGVyIHNpZ24gaW4gbWV0aG9kcy5cclxuICpcclxuICogVGhlIG9wZXJhdGlvbiBmYWlscyB3aXRoIGFuIGVycm9yIGlmIHRoZSB1c2VyIHRvIGJlIHVwZGF0ZWQgYmVsb25ncyB0byBhIGRpZmZlcmVudCBGaXJlYmFzZVxyXG4gKiBwcm9qZWN0LlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIG5ldyB7QGxpbmsgVXNlcn0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZUN1cnJlbnRVc2VyKGF1dGgsIHVzZXIpIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkudXBkYXRlQ3VycmVudFVzZXIodXNlcik7XHJcbn1cclxuLyoqXHJcbiAqIFNpZ25zIG91dCB0aGUgY3VycmVudCB1c2VyLlxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHNpZ25PdXQoYXV0aCkge1xyXG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKS5zaWduT3V0KCk7XHJcbn1cclxuLyoqXHJcbiAqIERlbGV0ZXMgYW5kIHNpZ25zIG91dCB0aGUgdXNlci5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSW1wb3J0YW50OiB0aGlzIGlzIGEgc2VjdXJpdHktc2Vuc2l0aXZlIG9wZXJhdGlvbiB0aGF0IHJlcXVpcmVzIHRoZSB1c2VyIHRvIGhhdmUgcmVjZW50bHlcclxuICogc2lnbmVkIGluLiBJZiB0aGlzIHJlcXVpcmVtZW50IGlzbid0IG1ldCwgYXNrIHRoZSB1c2VyIHRvIGF1dGhlbnRpY2F0ZSBhZ2FpbiBhbmQgdGhlbiBjYWxsXHJcbiAqIHtAbGluayByZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsfS5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlVXNlcih1c2VyKSB7XHJcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpLmRlbGV0ZSgpO1xyXG59XG5cbmNsYXNzIE11bHRpRmFjdG9yU2Vzc2lvbkltcGwge1xyXG4gICAgY29uc3RydWN0b3IodHlwZSwgY3JlZGVudGlhbCwgYXV0aCkge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgdGhpcy5jcmVkZW50aWFsID0gY3JlZGVudGlhbDtcclxuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIF9mcm9tSWR0b2tlbihpZFRva2VuLCBhdXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBNdWx0aUZhY3RvclNlc3Npb25JbXBsKFwiZW5yb2xsXCIgLyogTXVsdGlGYWN0b3JTZXNzaW9uVHlwZS5FTlJPTEwgKi8sIGlkVG9rZW4sIGF1dGgpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIF9mcm9tTWZhUGVuZGluZ0NyZWRlbnRpYWwobWZhUGVuZGluZ0NyZWRlbnRpYWwpIHtcclxuICAgICAgICByZXR1cm4gbmV3IE11bHRpRmFjdG9yU2Vzc2lvbkltcGwoXCJzaWduaW5cIiAvKiBNdWx0aUZhY3RvclNlc3Npb25UeXBlLlNJR05fSU4gKi8sIG1mYVBlbmRpbmdDcmVkZW50aWFsKTtcclxuICAgIH1cclxuICAgIHRvSlNPTigpIHtcclxuICAgICAgICBjb25zdCBrZXkgPSB0aGlzLnR5cGUgPT09IFwiZW5yb2xsXCIgLyogTXVsdGlGYWN0b3JTZXNzaW9uVHlwZS5FTlJPTEwgKi9cclxuICAgICAgICAgICAgPyAnaWRUb2tlbidcclxuICAgICAgICAgICAgOiAncGVuZGluZ0NyZWRlbnRpYWwnO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIG11bHRpRmFjdG9yU2Vzc2lvbjoge1xyXG4gICAgICAgICAgICAgICAgW2tleV06IHRoaXMuY3JlZGVudGlhbFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBmcm9tSlNPTihvYmopIHtcclxuICAgICAgICB2YXIgX2EsIF9iO1xyXG4gICAgICAgIGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmoubXVsdGlGYWN0b3JTZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIGlmICgoX2EgPSBvYmoubXVsdGlGYWN0b3JTZXNzaW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucGVuZGluZ0NyZWRlbnRpYWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNdWx0aUZhY3RvclNlc3Npb25JbXBsLl9mcm9tTWZhUGVuZGluZ0NyZWRlbnRpYWwob2JqLm11bHRpRmFjdG9yU2Vzc2lvbi5wZW5kaW5nQ3JlZGVudGlhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoKF9iID0gb2JqLm11bHRpRmFjdG9yU2Vzc2lvbikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmlkVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBNdWx0aUZhY3RvclNlc3Npb25JbXBsLl9mcm9tSWR0b2tlbihvYmoubXVsdGlGYWN0b3JTZXNzaW9uLmlkVG9rZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIE11bHRpRmFjdG9yUmVzb2x2ZXJJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlc3Npb24sIGhpbnRzLCBzaWduSW5SZXNvbHZlcikge1xyXG4gICAgICAgIHRoaXMuc2Vzc2lvbiA9IHNlc3Npb247XHJcbiAgICAgICAgdGhpcy5oaW50cyA9IGhpbnRzO1xyXG4gICAgICAgIHRoaXMuc2lnbkluUmVzb2x2ZXIgPSBzaWduSW5SZXNvbHZlcjtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbUVycm9yKGF1dGhFeHRlcm4sIGVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgYXV0aCA9IF9jYXN0QXV0aChhdXRoRXh0ZXJuKTtcclxuICAgICAgICBjb25zdCBzZXJ2ZXJSZXNwb25zZSA9IGVycm9yLmN1c3RvbURhdGEuX3NlcnZlclJlc3BvbnNlO1xyXG4gICAgICAgIGNvbnN0IGhpbnRzID0gKHNlcnZlclJlc3BvbnNlLm1mYUluZm8gfHwgW10pLm1hcChlbnJvbGxtZW50ID0+IE11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZShhdXRoLCBlbnJvbGxtZW50KSk7XHJcbiAgICAgICAgX2Fzc2VydChzZXJ2ZXJSZXNwb25zZS5tZmFQZW5kaW5nQ3JlZGVudGlhbCwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBNdWx0aUZhY3RvclNlc3Npb25JbXBsLl9mcm9tTWZhUGVuZGluZ0NyZWRlbnRpYWwoc2VydmVyUmVzcG9uc2UubWZhUGVuZGluZ0NyZWRlbnRpYWwpO1xyXG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JSZXNvbHZlckltcGwoc2Vzc2lvbiwgaGludHMsIGFzeW5jIChhc3NlcnRpb24pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbWZhUmVzcG9uc2UgPSBhd2FpdCBhc3NlcnRpb24uX3Byb2Nlc3MoYXV0aCwgc2Vzc2lvbik7XHJcbiAgICAgICAgICAgIC8vIENsZWFyIG91dCB0aGUgdW5uZWVkZWQgZmllbGRzIGZyb20gdGhlIG9sZCBsb2dpbiByZXNwb25zZVxyXG4gICAgICAgICAgICBkZWxldGUgc2VydmVyUmVzcG9uc2UubWZhSW5mbztcclxuICAgICAgICAgICAgZGVsZXRlIHNlcnZlclJlc3BvbnNlLm1mYVBlbmRpbmdDcmVkZW50aWFsO1xyXG4gICAgICAgICAgICAvLyBVc2UgaW4gdGhlIG5ldyB0b2tlbiAmIHJlZnJlc2ggdG9rZW4gaW4gdGhlIG9sZCByZXNwb25zZVxyXG4gICAgICAgICAgICBjb25zdCBpZFRva2VuUmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHNlcnZlclJlc3BvbnNlKSwgeyBpZFRva2VuOiBtZmFSZXNwb25zZS5pZFRva2VuLCByZWZyZXNoVG9rZW46IG1mYVJlc3BvbnNlLnJlZnJlc2hUb2tlbiB9KTtcclxuICAgICAgICAgICAgLy8gVE9ETzogd2Ugc2hvdWxkIGNvbGxhcHNlIHRoaXMgc3dpdGNoIHN0YXRlbWVudCBpbnRvIFVzZXJDcmVkZW50aWFsSW1wbC5fZm9yT3BlcmF0aW9uIGFuZCBoYXZlIGl0IHN1cHBvcnQgdGhlIFNJR05fSU4gY2FzZVxyXG4gICAgICAgICAgICBzd2l0Y2ggKGVycm9yLm9wZXJhdGlvblR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi86XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBVc2VyQ3JlZGVudGlhbEltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgZXJyb3Iub3BlcmF0aW9uVHlwZSwgaWRUb2tlblJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBhdXRoLl91cGRhdGVDdXJyZW50VXNlcih1c2VyQ3JlZGVudGlhbC51c2VyKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVhdXRoZW50aWNhdGVcIiAvKiBPcGVyYXRpb25UeXBlLlJFQVVUSEVOVElDQVRFICovOlxyXG4gICAgICAgICAgICAgICAgICAgIF9hc3NlcnQoZXJyb3IudXNlciwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbihlcnJvci51c2VyLCBlcnJvci5vcGVyYXRpb25UeXBlLCBpZFRva2VuUmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBfZmFpbChhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGFzeW5jIHJlc29sdmVTaWduSW4oYXNzZXJ0aW9uRXh0ZXJuKSB7XHJcbiAgICAgICAgY29uc3QgYXNzZXJ0aW9uID0gYXNzZXJ0aW9uRXh0ZXJuO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNpZ25JblJlc29sdmVyKGFzc2VydGlvbik7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFByb3ZpZGVzIGEge0BsaW5rIE11bHRpRmFjdG9yUmVzb2x2ZXJ9IHN1aXRhYmxlIGZvciBjb21wbGV0aW9uIG9mIGFcclxuICogbXVsdGktZmFjdG9yIGZsb3cuXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGVycm9yIC0gVGhlIHtAbGluayBNdWx0aUZhY3RvckVycm9yfSByYWlzZWQgZHVyaW5nIGEgc2lnbi1pbiwgb3JcclxuICogcmVhdXRoZW50aWNhdGlvbiBvcGVyYXRpb24uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldE11bHRpRmFjdG9yUmVzb2x2ZXIoYXV0aCwgZXJyb3IpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IGF1dGhNb2R1bGFyID0gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpO1xyXG4gICAgY29uc3QgZXJyb3JJbnRlcm5hbCA9IGVycm9yO1xyXG4gICAgX2Fzc2VydChlcnJvci5jdXN0b21EYXRhLm9wZXJhdGlvblR5cGUsIGF1dGhNb2R1bGFyLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICBfYXNzZXJ0KChfYSA9IGVycm9ySW50ZXJuYWwuY3VzdG9tRGF0YS5fc2VydmVyUmVzcG9uc2UpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5tZmFQZW5kaW5nQ3JlZGVudGlhbCwgYXV0aE1vZHVsYXIsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgIHJldHVybiBNdWx0aUZhY3RvclJlc29sdmVySW1wbC5fZnJvbUVycm9yKGF1dGhNb2R1bGFyLCBlcnJvckludGVybmFsKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBzdGFydEVucm9sbFBob25lTWZhKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92Mi9hY2NvdW50cy9tZmFFbnJvbGxtZW50OnN0YXJ0XCIgLyogRW5kcG9pbnQuU1RBUlRfTUZBX0VOUk9MTE1FTlQgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XHJcbn1cclxuZnVuY3Rpb24gZmluYWxpemVFbnJvbGxQaG9uZU1mYShhdXRoLCByZXF1ZXN0KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhRW5yb2xsbWVudDpmaW5hbGl6ZVwiIC8qIEVuZHBvaW50LkZJTkFMSVpFX01GQV9FTlJPTExNRU5UICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmZ1bmN0aW9uIHdpdGhkcmF3TWZhKGF1dGgsIHJlcXVlc3QpIHtcclxuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92Mi9hY2NvdW50cy9tZmFFbnJvbGxtZW50OndpdGhkcmF3XCIgLyogRW5kcG9pbnQuV0lUSERSQVdfTUZBICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XG5cbmNsYXNzIE11bHRpRmFjdG9yVXNlckltcGwge1xyXG4gICAgY29uc3RydWN0b3IodXNlcikge1xyXG4gICAgICAgIHRoaXMudXNlciA9IHVzZXI7XHJcbiAgICAgICAgdGhpcy5lbnJvbGxlZEZhY3RvcnMgPSBbXTtcclxuICAgICAgICB1c2VyLl9vblJlbG9hZCh1c2VySW5mbyA9PiB7XHJcbiAgICAgICAgICAgIGlmICh1c2VySW5mby5tZmFJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVucm9sbGVkRmFjdG9ycyA9IHVzZXJJbmZvLm1mYUluZm8ubWFwKGVucm9sbG1lbnQgPT4gTXVsdGlGYWN0b3JJbmZvSW1wbC5fZnJvbVNlcnZlclJlc3BvbnNlKHVzZXIuYXV0aCwgZW5yb2xsbWVudCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgX2Zyb21Vc2VyKHVzZXIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IE11bHRpRmFjdG9yVXNlckltcGwodXNlcik7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRTZXNzaW9uKCkge1xyXG4gICAgICAgIHJldHVybiBNdWx0aUZhY3RvclNlc3Npb25JbXBsLl9mcm9tSWR0b2tlbihhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbigpLCB0aGlzLnVzZXIuYXV0aCk7XHJcbiAgICB9XHJcbiAgICBhc3luYyBlbnJvbGwoYXNzZXJ0aW9uRXh0ZXJuLCBkaXNwbGF5TmFtZSkge1xyXG4gICAgICAgIGNvbnN0IGFzc2VydGlvbiA9IGFzc2VydGlvbkV4dGVybjtcclxuICAgICAgICBjb25zdCBzZXNzaW9uID0gKGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpKTtcclxuICAgICAgICBjb25zdCBmaW5hbGl6ZU1mYVJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodGhpcy51c2VyLCBhc3NlcnRpb24uX3Byb2Nlc3ModGhpcy51c2VyLmF1dGgsIHNlc3Npb24sIGRpc3BsYXlOYW1lKSk7XHJcbiAgICAgICAgLy8gTmV3IHRva2VucyB3aWxsIGJlIGlzc3VlZCBhZnRlciBlbnJvbGxtZW50IG9mIHRoZSBuZXcgc2Vjb25kIGZhY3RvcnMuXHJcbiAgICAgICAgLy8gVGhleSBuZWVkIHRvIGJlIHVwZGF0ZWQgb24gdGhlIHVzZXIuXHJcbiAgICAgICAgYXdhaXQgdGhpcy51c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShmaW5hbGl6ZU1mYVJlc3BvbnNlKTtcclxuICAgICAgICAvLyBUaGUgdXNlciBuZWVkcyB0byBiZSByZWxvYWRlZCB0byBnZXQgdGhlIG5ldyBtdWx0aS1mYWN0b3IgaW5mb3JtYXRpb25cclxuICAgICAgICAvLyBmcm9tIHNlcnZlci4gVVNFUl9SRUxPQURFRCBldmVudCB3aWxsIGJlIHRyaWdnZXJlZCBhbmQgYGVucm9sbGVkRmFjdG9yc2BcclxuICAgICAgICAvLyB3aWxsIGJlIHVwZGF0ZWQuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMudXNlci5yZWxvYWQoKTtcclxuICAgIH1cclxuICAgIGFzeW5jIHVuZW5yb2xsKGluZm9PclVpZCkge1xyXG4gICAgICAgIGNvbnN0IG1mYUVucm9sbG1lbnRJZCA9IHR5cGVvZiBpbmZvT3JVaWQgPT09ICdzdHJpbmcnID8gaW5mb09yVWlkIDogaW5mb09yVWlkLnVpZDtcclxuICAgICAgICBjb25zdCBpZFRva2VuID0gYXdhaXQgdGhpcy51c2VyLmdldElkVG9rZW4oKTtcclxuICAgICAgICBjb25zdCBpZFRva2VuUmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLnVzZXIsIHdpdGhkcmF3TWZhKHRoaXMudXNlci5hdXRoLCB7XHJcbiAgICAgICAgICAgIGlkVG9rZW4sXHJcbiAgICAgICAgICAgIG1mYUVucm9sbG1lbnRJZFxyXG4gICAgICAgIH0pKTtcclxuICAgICAgICAvLyBSZW1vdmUgdGhlIHNlY29uZCBmYWN0b3IgZnJvbSB0aGUgdXNlcidzIGxpc3QuXHJcbiAgICAgICAgdGhpcy5lbnJvbGxlZEZhY3RvcnMgPSB0aGlzLmVucm9sbGVkRmFjdG9ycy5maWx0ZXIoKHsgdWlkIH0pID0+IHVpZCAhPT0gbWZhRW5yb2xsbWVudElkKTtcclxuICAgICAgICAvLyBEZXBlbmRpbmcgb24gd2hldGhlciB0aGUgYmFja2VuZCBkZWNpZGVkIHRvIHJldm9rZSB0aGUgdXNlcidzIHNlc3Npb24sXHJcbiAgICAgICAgLy8gdGhlIHRva2VuUmVzcG9uc2UgbWF5IGJlIGVtcHR5LiBJZiB0aGUgdG9rZW5zIHdlcmUgbm90IHVwZGF0ZWQgKGFuZCB0aGV5XHJcbiAgICAgICAgLy8gYXJlIG5vdyBpbnZhbGlkKSwgcmVsb2FkaW5nIHRoZSB1c2VyIHdpbGwgZGlzY292ZXIgdGhpcyBhbmQgaW52YWxpZGF0ZVxyXG4gICAgICAgIC8vIHRoZSB1c2VyJ3Mgc3RhdGUgYWNjb3JkaW5nbHkuXHJcbiAgICAgICAgYXdhaXQgdGhpcy51c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShpZFRva2VuUmVzcG9uc2UpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudXNlci5yZWxvYWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgIT09IGBhdXRoLyR7XCJ1c2VyLXRva2VuLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlRPS0VOX0VYUElSRUQgKi99YCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5jb25zdCBtdWx0aUZhY3RvclVzZXJDYWNoZSA9IG5ldyBXZWFrTWFwKCk7XHJcbi8qKlxyXG4gKiBUaGUge0BsaW5rIE11bHRpRmFjdG9yVXNlcn0gY29ycmVzcG9uZGluZyB0byB0aGUgdXNlci5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBpcyB1c2VkIHRvIGFjY2VzcyBhbGwgbXVsdGktZmFjdG9yIHByb3BlcnRpZXMgYW5kIG9wZXJhdGlvbnMgcmVsYXRlZCB0byB0aGUgdXNlci5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gbXVsdGlGYWN0b3IodXNlcikge1xyXG4gICAgY29uc3QgdXNlck1vZHVsYXIgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBpZiAoIW11bHRpRmFjdG9yVXNlckNhY2hlLmhhcyh1c2VyTW9kdWxhcikpIHtcclxuICAgICAgICBtdWx0aUZhY3RvclVzZXJDYWNoZS5zZXQodXNlck1vZHVsYXIsIE11bHRpRmFjdG9yVXNlckltcGwuX2Zyb21Vc2VyKHVzZXJNb2R1bGFyKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbXVsdGlGYWN0b3JVc2VyQ2FjaGUuZ2V0KHVzZXJNb2R1bGFyKTtcclxufVxuXG5jb25zdCBTVE9SQUdFX0FWQUlMQUJMRV9LRVkgPSAnX19zYWsnO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vLyBUaGVyZSBhcmUgdHdvIGRpZmZlcmVudCBicm93c2VyIHBlcnNpc3RlbmNlIHR5cGVzOiBsb2NhbCBhbmQgc2Vzc2lvbi5cclxuLy8gQm90aCBoYXZlIHRoZSBzYW1lIGltcGxlbWVudGF0aW9uIGJ1dCB1c2UgYSBkaWZmZXJlbnQgdW5kZXJseWluZyBzdG9yYWdlXHJcbi8vIG9iamVjdC5cclxuY2xhc3MgQnJvd3NlclBlcnNpc3RlbmNlQ2xhc3Mge1xyXG4gICAgY29uc3RydWN0b3Ioc3RvcmFnZVJldHJpZXZlciwgdHlwZSkge1xyXG4gICAgICAgIHRoaXMuc3RvcmFnZVJldHJpZXZlciA9IHN0b3JhZ2VSZXRyaWV2ZXI7XHJcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgIH1cclxuICAgIF9pc0F2YWlsYWJsZSgpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuc3RvcmFnZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9BVkFJTEFCTEVfS0VZLCAnMScpO1xyXG4gICAgICAgICAgICB0aGlzLnN0b3JhZ2UucmVtb3ZlSXRlbShTVE9SQUdFX0FWQUlMQUJMRV9LRVkpO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX3NldChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuICAgIF9nZXQoa2V5KSB7XHJcbiAgICAgICAgY29uc3QganNvbiA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShqc29uID8gSlNPTi5wYXJzZShqc29uKSA6IG51bGwpO1xyXG4gICAgfVxyXG4gICAgX3JlbW92ZShrZXkpIHtcclxuICAgICAgICB0aGlzLnN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuICAgIGdldCBzdG9yYWdlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JhZ2VSZXRyaWV2ZXIoKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBfaWZyYW1lQ2Fubm90U3luY1dlYlN0b3JhZ2UoKSB7XHJcbiAgICBjb25zdCB1YSA9IGdldFVBKCk7XHJcbiAgICByZXR1cm4gX2lzU2FmYXJpKHVhKSB8fCBfaXNJT1ModWEpO1xyXG59XHJcbi8vIFRoZSBwb2xsaW5nIHBlcmlvZCBpbiBjYXNlIGV2ZW50cyBhcmUgbm90IHN1cHBvcnRlZFxyXG5jb25zdCBfUE9MTElOR19JTlRFUlZBTF9NUyQxID0gMTAwMDtcclxuLy8gVGhlIElFIDEwIGxvY2FsU3RvcmFnZSBjcm9zcyB0YWIgc3luY2hyb25pemF0aW9uIGRlbGF5IGluIG1pbGxpc2Vjb25kc1xyXG5jb25zdCBJRTEwX0xPQ0FMX1NUT1JBR0VfU1lOQ19ERUxBWSA9IDEwO1xyXG5jbGFzcyBCcm93c2VyTG9jYWxQZXJzaXN0ZW5jZSBleHRlbmRzIEJyb3dzZXJQZXJzaXN0ZW5jZUNsYXNzIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKCgpID0+IHdpbmRvdy5sb2NhbFN0b3JhZ2UsIFwiTE9DQUxcIiAvKiBQZXJzaXN0ZW5jZVR5cGUuTE9DQUwgKi8pO1xyXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSAoZXZlbnQsIHBvbGwpID0+IHRoaXMub25TdG9yYWdlRXZlbnQoZXZlbnQsIHBvbGwpO1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307XHJcbiAgICAgICAgdGhpcy5sb2NhbENhY2hlID0ge307XHJcbiAgICAgICAgLy8gc2V0VGltZW91dCByZXR1cm4gdmFsdWUgaXMgcGxhdGZvcm0gc3BlY2lmaWNcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgICAgIHRoaXMucG9sbFRpbWVyID0gbnVsbDtcclxuICAgICAgICAvLyBTYWZhcmkgb3IgaU9TIGJyb3dzZXIgYW5kIGVtYmVkZGVkIGluIGFuIGlmcmFtZS5cclxuICAgICAgICB0aGlzLnNhZmFyaUxvY2FsU3RvcmFnZU5vdFN5bmNlZCA9IF9pZnJhbWVDYW5ub3RTeW5jV2ViU3RvcmFnZSgpICYmIF9pc0lmcmFtZSgpO1xyXG4gICAgICAgIC8vIFdoZXRoZXIgdG8gdXNlIHBvbGxpbmcgaW5zdGVhZCBvZiBkZXBlbmRpbmcgb24gd2luZG93IGV2ZW50c1xyXG4gICAgICAgIHRoaXMuZmFsbGJhY2tUb1BvbGxpbmcgPSBfaXNNb2JpbGVCcm93c2VyKCk7XHJcbiAgICAgICAgdGhpcy5fc2hvdWxkQWxsb3dNaWdyYXRpb24gPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgZm9yQWxsQ2hhbmdlZEtleXMoY2IpIHtcclxuICAgICAgICAvLyBDaGVjayBhbGwga2V5cyB3aXRoIGxpc3RlbmVycyBvbiB0aGVtLlxyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHRoaXMubGlzdGVuZXJzKSkge1xyXG4gICAgICAgICAgICAvLyBHZXQgdmFsdWUgZnJvbSBsb2NhbFN0b3JhZ2UuXHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLmxvY2FsQ2FjaGVba2V5XTtcclxuICAgICAgICAgICAgLy8gSWYgbG9jYWwgbWFwIHZhbHVlIGRvZXMgbm90IG1hdGNoLCB0cmlnZ2VyIGxpc3RlbmVyIHdpdGggc3RvcmFnZSBldmVudC5cclxuICAgICAgICAgICAgLy8gRGlmZmVyZW50aWF0ZSB0aGlzIHNpbXVsYXRlZCBldmVudCBmcm9tIHRoZSByZWFsIHN0b3JhZ2UgZXZlbnQuXHJcbiAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGNiKGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG9uU3RvcmFnZUV2ZW50KGV2ZW50LCBwb2xsID0gZmFsc2UpIHtcclxuICAgICAgICAvLyBLZXkgd291bGQgYmUgbnVsbCBpbiBzb21lIHNpdHVhdGlvbnMsIGxpa2Ugd2hlbiBsb2NhbFN0b3JhZ2UgaXMgY2xlYXJlZFxyXG4gICAgICAgIGlmICghZXZlbnQua2V5KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yQWxsQ2hhbmdlZEtleXMoKGtleSwgX29sZFZhbHVlLCBuZXdWYWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoa2V5LCBuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleTtcclxuICAgICAgICAvLyBDaGVjayB0aGUgbWVjaGFuaXNtIGhvdyB0aGlzIGV2ZW50IHdhcyBkZXRlY3RlZC5cclxuICAgICAgICAvLyBUaGUgZmlyc3QgZXZlbnQgd2lsbCBkaWN0YXRlIHRoZSBtZWNoYW5pc20gdG8gYmUgdXNlZC5cclxuICAgICAgICBpZiAocG9sbCkge1xyXG4gICAgICAgICAgICAvLyBFbnZpcm9ubWVudCBkZXRlY3RzIHN0b3JhZ2UgY2hhbmdlcyB2aWEgcG9sbGluZy5cclxuICAgICAgICAgICAgLy8gUmVtb3ZlIHN0b3JhZ2UgZXZlbnQgbGlzdGVuZXIgdG8gcHJldmVudCBwb3NzaWJsZSBldmVudCBkdXBsaWNhdGlvbi5cclxuICAgICAgICAgICAgdGhpcy5kZXRhY2hMaXN0ZW5lcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gRW52aXJvbm1lbnQgZGV0ZWN0cyBzdG9yYWdlIGNoYW5nZXMgdmlhIHN0b3JhZ2UgZXZlbnQgbGlzdGVuZXIuXHJcbiAgICAgICAgICAgIC8vIFJlbW92ZSBwb2xsaW5nIGxpc3RlbmVyIHRvIHByZXZlbnQgcG9zc2libGUgZXZlbnQgZHVwbGljYXRpb24uXHJcbiAgICAgICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU2FmYXJpIGVtYmVkZGVkIGlmcmFtZS4gU3RvcmFnZSBldmVudCB3aWxsIHRyaWdnZXIgd2l0aCB0aGUgZGVsdGFcclxuICAgICAgICAvLyBjaGFuZ2VzIGJ1dCBubyBjaGFuZ2VzIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgaWZyYW1lIGxvY2FsU3RvcmFnZS5cclxuICAgICAgICBpZiAodGhpcy5zYWZhcmlMb2NhbFN0b3JhZ2VOb3RTeW5jZWQpIHtcclxuICAgICAgICAgICAgLy8gR2V0IGN1cnJlbnQgaWZyYW1lIHBhZ2UgdmFsdWUuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0b3JlZFZhbHVlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgLy8gVmFsdWUgbm90IHN5bmNocm9uaXplZCwgc3luY2hyb25pemUgbWFudWFsbHkuXHJcbiAgICAgICAgICAgIGlmIChldmVudC5uZXdWYWx1ZSAhPT0gc3RvcmVkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC5uZXdWYWx1ZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFZhbHVlIGNoYW5nZWQgZnJvbSBjdXJyZW50IHZhbHVlLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZS5zZXRJdGVtKGtleSwgZXZlbnQubmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3VycmVudCB2YWx1ZSBkZWxldGVkLlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5sb2NhbENhY2hlW2tleV0gPT09IGV2ZW50Lm5ld1ZhbHVlICYmICFwb2xsKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBBbHJlYWR5IGRldGVjdGVkIGFuZCBwcm9jZXNzZWQsIGRvIG5vdCB0cmlnZ2VyIGxpc3RlbmVycyBhZ2Fpbi5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB0cmlnZ2VyTGlzdGVuZXJzID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyBLZWVwIGxvY2FsIG1hcCB1cCB0byBkYXRlIGluIGNhc2Ugc3RvcmFnZSBldmVudCBpcyB0cmlnZ2VyZWQgYmVmb3JlXHJcbiAgICAgICAgICAgIC8vIHBvbGwuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0b3JlZFZhbHVlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgaWYgKCFwb2xsICYmIHRoaXMubG9jYWxDYWNoZVtrZXldID09PSBzdG9yZWRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gUmVhbCBzdG9yYWdlIGV2ZW50IHdoaWNoIGhhcyBhbHJlYWR5IGJlZW4gZGV0ZWN0ZWQsIGRvIG5vdGhpbmcuXHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHNlZW1zIHRvIHRyaWdnZXIgaW4gc29tZSBJRSBicm93c2VycyBmb3Igc29tZSByZWFzb24uXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoa2V5LCBzdG9yZWRWYWx1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgaWYgKF9pc0lFMTAoKSAmJlxyXG4gICAgICAgICAgICBzdG9yZWRWYWx1ZSAhPT0gZXZlbnQubmV3VmFsdWUgJiZcclxuICAgICAgICAgICAgZXZlbnQubmV3VmFsdWUgIT09IGV2ZW50Lm9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vIElFIDEwIGhhcyB0aGlzIHdlaXJkIGJ1ZyB3aGVyZSBhIHN0b3JhZ2UgZXZlbnQgd291bGQgdHJpZ2dlciB3aXRoIHRoZVxyXG4gICAgICAgICAgICAvLyBjb3JyZWN0IGtleSwgb2xkVmFsdWUgYW5kIG5ld1ZhbHVlIGJ1dCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpIGRvZXNcclxuICAgICAgICAgICAgLy8gbm90IHlpZWxkIHRoZSB1cGRhdGVkIHZhbHVlIHVudGlsIGEgZmV3IG1pbGxpc2Vjb25kcy4gVGhpcyBlbnN1cmVzXHJcbiAgICAgICAgICAgIC8vIHRoaXMgcmVjb3ZlcnMgZnJvbSB0aGF0IHNpdHVhdGlvbi5cclxuICAgICAgICAgICAgc2V0VGltZW91dCh0cmlnZ2VyTGlzdGVuZXJzLCBJRTEwX0xPQ0FMX1NUT1JBR0VfU1lOQ19ERUxBWSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0cmlnZ2VyTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgbm90aWZ5TGlzdGVuZXJzKGtleSwgdmFsdWUpIHtcclxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzW2tleV07XHJcbiAgICAgICAgaWYgKGxpc3RlbmVycykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIEFycmF5LmZyb20obGlzdGVuZXJzKSkge1xyXG4gICAgICAgICAgICAgICAgbGlzdGVuZXIodmFsdWUgPyBKU09OLnBhcnNlKHZhbHVlKSA6IHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHN0YXJ0UG9sbGluZygpIHtcclxuICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7XHJcbiAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yQWxsQ2hhbmdlZEtleXMoKGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uU3RvcmFnZUV2ZW50KG5ldyBTdG9yYWdlRXZlbnQoJ3N0b3JhZ2UnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5LFxyXG4gICAgICAgICAgICAgICAgICAgIG9sZFZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIG5ld1ZhbHVlXHJcbiAgICAgICAgICAgICAgICB9KSwgXHJcbiAgICAgICAgICAgICAgICAvKiBwb2xsICovIHRydWUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCBfUE9MTElOR19JTlRFUlZBTF9NUyQxKTtcclxuICAgIH1cclxuICAgIHN0b3BQb2xsaW5nKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnBvbGxUaW1lcikge1xyXG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMucG9sbFRpbWVyKTtcclxuICAgICAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGF0dGFjaExpc3RlbmVyKCkge1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICBkZXRhY2hMaXN0ZW5lcigpIHtcclxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3RvcmFnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpO1xyXG4gICAgfVxyXG4gICAgX2FkZExpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAvLyBXaGV0aGVyIGJyb3dzZXIgY2FuIGRldGVjdCBzdG9yYWdlIGV2ZW50IHdoZW4gaXQgaGFkIGFscmVhZHkgYmVlbiBwdXNoZWQgdG8gdGhlIGJhY2tncm91bmQuXHJcbiAgICAgICAgICAgIC8vIFRoaXMgbWF5IGhhcHBlbiBpbiBzb21lIG1vYmlsZSBicm93c2Vycy4gQSBsb2NhbFN0b3JhZ2UgY2hhbmdlIGluIHRoZSBmb3JlZ3JvdW5kIHdpbmRvd1xyXG4gICAgICAgICAgICAvLyB3aWxsIG5vdCBiZSBkZXRlY3RlZCBpbiB0aGUgYmFja2dyb3VuZCB3aW5kb3cgdmlhIHRoZSBzdG9yYWdlIGV2ZW50LlxyXG4gICAgICAgICAgICAvLyBUaGlzIHdhcyBkZXRlY3RlZCBpbiBpT1MgNy54IG1vYmlsZSBicm93c2Vyc1xyXG4gICAgICAgICAgICBpZiAodGhpcy5mYWxsYmFja1RvUG9sbGluZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydFBvbGxpbmcoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNoTGlzdGVuZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMubGlzdGVuZXJzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XSA9IG5ldyBTZXQoKTtcclxuICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGNhY2hlIHRvIGF2b2lkIHNwdXJpb3VzbHkgdHJpZ2dlcmluZyBvbiBmaXJzdCBwb2xsLlxyXG4gICAgICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uYWRkKGxpc3RlbmVyKTtcclxuICAgIH1cclxuICAgIF9yZW1vdmVMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XS5kZWxldGUobGlzdGVuZXIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XS5zaXplID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmRldGFjaExpc3RlbmVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBVcGRhdGUgbG9jYWwgY2FjaGUgb24gYmFzZSBvcGVyYXRpb25zOlxyXG4gICAgYXN5bmMgX3NldChrZXksIHZhbHVlKSB7XHJcbiAgICAgICAgYXdhaXQgc3VwZXIuX3NldChrZXksIHZhbHVlKTtcclxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9nZXQoa2V5KSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBzdXBlci5fZ2V0KGtleSk7XHJcbiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX3JlbW92ZShrZXkpIHtcclxuICAgICAgICBhd2FpdCBzdXBlci5fcmVtb3ZlKGtleSk7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMubG9jYWxDYWNoZVtrZXldO1xyXG4gICAgfVxyXG59XHJcbkJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlLnR5cGUgPSAnTE9DQUwnO1xyXG4vKipcclxuICogQW4gaW1wbGVtZW50YXRpb24gb2Yge0BsaW5rIFBlcnNpc3RlbmNlfSBvZiB0eXBlIGBMT0NBTGAgdXNpbmcgYGxvY2FsU3RvcmFnZWBcclxuICogZm9yIHRoZSB1bmRlcmx5aW5nIHN0b3JhZ2UuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlID0gQnJvd3NlckxvY2FsUGVyc2lzdGVuY2U7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIEJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UgZXh0ZW5kcyBCcm93c2VyUGVyc2lzdGVuY2VDbGFzcyB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcigoKSA9PiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UsIFwiU0VTU0lPTlwiIC8qIFBlcnNpc3RlbmNlVHlwZS5TRVNTSU9OICovKTtcclxuICAgIH1cclxuICAgIF9hZGRMaXN0ZW5lcihfa2V5LCBfbGlzdGVuZXIpIHtcclxuICAgICAgICAvLyBMaXN0ZW5lcnMgYXJlIG5vdCBzdXBwb3J0ZWQgZm9yIHNlc3Npb24gc3RvcmFnZSBzaW5jZSBpdCBjYW5ub3QgYmUgc2hhcmVkIGFjcm9zcyB3aW5kb3dzXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgX3JlbW92ZUxpc3RlbmVyKF9rZXksIF9saXN0ZW5lcikge1xyXG4gICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3Igc2Vzc2lvbiBzdG9yYWdlIHNpbmNlIGl0IGNhbm5vdCBiZSBzaGFyZWQgYWNyb3NzIHdpbmRvd3NcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbn1cclxuQnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZS50eXBlID0gJ1NFU1NJT04nO1xyXG4vKipcclxuICogQW4gaW1wbGVtZW50YXRpb24gb2Yge0BsaW5rIFBlcnNpc3RlbmNlfSBvZiBgU0VTU0lPTmAgdXNpbmcgYHNlc3Npb25TdG9yYWdlYFxyXG4gKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSA9IEJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2U7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBTaGltIGZvciBQcm9taXNlLmFsbFNldHRsZWQsIG5vdGUgdGhlIHNsaWdodGx5IGRpZmZlcmVudCBmb3JtYXQgb2YgYGZ1bGZpbGxlZGAgdnMgYHN0YXR1c2AuXHJcbiAqXHJcbiAqIEBwYXJhbSBwcm9taXNlcyAtIEFycmF5IG9mIHByb21pc2VzIHRvIHdhaXQgb24uXHJcbiAqL1xyXG5mdW5jdGlvbiBfYWxsU2V0dGxlZChwcm9taXNlcykge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzLm1hcChhc3luYyAocHJvbWlzZSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgcHJvbWlzZTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHZhbHVlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChyZWFzb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZWFzb25cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9KSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEludGVyZmFjZSBjbGFzcyBmb3IgcmVjZWl2aW5nIG1lc3NhZ2VzLlxyXG4gKlxyXG4gKi9cclxuY2xhc3MgUmVjZWl2ZXIge1xyXG4gICAgY29uc3RydWN0b3IoZXZlbnRUYXJnZXQpIHtcclxuICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0ID0gZXZlbnRUYXJnZXQ7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVyc01hcCA9IHt9O1xyXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXIgPSB0aGlzLmhhbmRsZUV2ZW50LmJpbmQodGhpcyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE9idGFpbiBhbiBpbnN0YW5jZSBvZiBhIFJlY2VpdmVyIGZvciBhIGdpdmVuIGV2ZW50IHRhcmdldCwgaWYgbm9uZSBleGlzdHMgaXQgd2lsbCBiZSBjcmVhdGVkLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBldmVudFRhcmdldCAtIEFuIGV2ZW50IHRhcmdldCAoc3VjaCBhcyB3aW5kb3cgb3Igc2VsZikgdGhyb3VnaCB3aGljaCB0aGUgdW5kZXJseWluZ1xyXG4gICAgICogbWVzc2FnZXMgd2lsbCBiZSByZWNlaXZlZC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIF9nZXRJbnN0YW5jZShldmVudFRhcmdldCkge1xyXG4gICAgICAgIC8vIFRoZSByZXN1bHRzIGFyZSBzdG9yZWQgaW4gYW4gYXJyYXkgc2luY2Ugb2JqZWN0cyBjYW4ndCBiZSBrZXlzIGZvciBvdGhlclxyXG4gICAgICAgIC8vIG9iamVjdHMuIEluIGFkZGl0aW9uLCBzZXR0aW5nIGEgdW5pcXVlIHByb3BlcnR5IG9uIGFuIGV2ZW50IHRhcmdldCBhcyBhXHJcbiAgICAgICAgLy8gaGFzaCBtYXAga2V5IG1heSBub3QgYmUgYWxsb3dlZCBkdWUgdG8gQ09SUyByZXN0cmljdGlvbnMuXHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdJbnN0YW5jZSA9IHRoaXMucmVjZWl2ZXJzLmZpbmQocmVjZWl2ZXIgPT4gcmVjZWl2ZXIuaXNMaXN0ZW5pbmd0byhldmVudFRhcmdldCkpO1xyXG4gICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleGlzdGluZ0luc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBuZXdJbnN0YW5jZSA9IG5ldyBSZWNlaXZlcihldmVudFRhcmdldCk7XHJcbiAgICAgICAgdGhpcy5yZWNlaXZlcnMucHVzaChuZXdJbnN0YW5jZSk7XHJcbiAgICAgICAgcmV0dXJuIG5ld0luc3RhbmNlO1xyXG4gICAgfVxyXG4gICAgaXNMaXN0ZW5pbmd0byhldmVudFRhcmdldCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmV2ZW50VGFyZ2V0ID09PSBldmVudFRhcmdldDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogRmFucyBvdXQgYSBNZXNzYWdlRXZlbnQgdG8gdGhlIGFwcHJvcHJpYXRlIGxpc3RlbmVycy5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICogU2VuZHMgYW4ge0BsaW5rIFN0YXR1cy5BQ0t9IHVwb24gcmVjZWlwdCBhbmQgYSB7QGxpbmsgU3RhdHVzLkRPTkV9IG9uY2UgYWxsIGhhbmRsZXJzIGhhdmVcclxuICAgICAqIGZpbmlzaGVkIHByb2Nlc3NpbmcuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV2ZW50IC0gVGhlIE1lc3NhZ2VFdmVudC5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGhhbmRsZUV2ZW50KGV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZUV2ZW50ID0gZXZlbnQ7XHJcbiAgICAgICAgY29uc3QgeyBldmVudElkLCBldmVudFR5cGUsIGRhdGEgfSA9IG1lc3NhZ2VFdmVudC5kYXRhO1xyXG4gICAgICAgIGNvbnN0IGhhbmRsZXJzID0gdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdO1xyXG4gICAgICAgIGlmICghKGhhbmRsZXJzID09PSBudWxsIHx8IGhhbmRsZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBoYW5kbGVycy5zaXplKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1lc3NhZ2VFdmVudC5wb3J0c1swXS5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICAgIHN0YXR1czogXCJhY2tcIiAvKiBfU3RhdHVzLkFDSyAqLyxcclxuICAgICAgICAgICAgZXZlbnRJZCxcclxuICAgICAgICAgICAgZXZlbnRUeXBlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBBcnJheS5mcm9tKGhhbmRsZXJzKS5tYXAoYXN5bmMgKGhhbmRsZXIpID0+IGhhbmRsZXIobWVzc2FnZUV2ZW50Lm9yaWdpbiwgZGF0YSkpO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2FsbFNldHRsZWQocHJvbWlzZXMpO1xyXG4gICAgICAgIG1lc3NhZ2VFdmVudC5wb3J0c1swXS5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICAgIHN0YXR1czogXCJkb25lXCIgLyogX1N0YXR1cy5ET05FICovLFxyXG4gICAgICAgICAgICBldmVudElkLFxyXG4gICAgICAgICAgICBldmVudFR5cGUsXHJcbiAgICAgICAgICAgIHJlc3BvbnNlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFN1YnNjcmliZSBhbiBldmVudCBoYW5kbGVyIGZvciBhIHBhcnRpY3VsYXIgZXZlbnQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV2ZW50VHlwZSAtIEV2ZW50IG5hbWUgdG8gc3Vic2NyaWJlIHRvLlxyXG4gICAgICogQHBhcmFtIGV2ZW50SGFuZGxlciAtIFRoZSBldmVudCBoYW5kbGVyIHdoaWNoIHNob3VsZCByZWNlaXZlIHRoZSBldmVudHMuXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBfc3Vic2NyaWJlKGV2ZW50VHlwZSwgZXZlbnRIYW5kbGVyKSB7XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuaGFuZGxlcnNNYXApLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0pIHtcclxuICAgICAgICAgICAgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdID0gbmV3IFNldCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0uYWRkKGV2ZW50SGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVuc3Vic2NyaWJlIGFuIGV2ZW50IGhhbmRsZXIgZnJvbSBhIHBhcnRpY3VsYXIgZXZlbnQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV2ZW50VHlwZSAtIEV2ZW50IG5hbWUgdG8gdW5zdWJzY3JpYmUgZnJvbS5cclxuICAgICAqIEBwYXJhbSBldmVudEhhbmRsZXIgLSBPcHRpbm9hbCBldmVudCBoYW5kbGVyLCBpZiBub25lIHByb3ZpZGVkLCB1bnN1YnNjcmliZSBhbGwgaGFuZGxlcnMgb24gdGhpcyBldmVudC5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIF91bnN1YnNjcmliZShldmVudFR5cGUsIGV2ZW50SGFuZGxlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0gJiYgZXZlbnRIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXS5kZWxldGUoZXZlbnRIYW5kbGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFldmVudEhhbmRsZXIgfHwgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdLnNpemUgPT09IDApIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuaGFuZGxlcnNNYXApLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuUmVjZWl2ZXIucmVjZWl2ZXJzID0gW107XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIF9nZW5lcmF0ZUV2ZW50SWQocHJlZml4ID0gJycsIGRpZ2l0cyA9IDEwKSB7XHJcbiAgICBsZXQgcmFuZG9tID0gJyc7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRpZ2l0czsgaSsrKSB7XHJcbiAgICAgICAgcmFuZG9tICs9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcclxuICAgIH1cclxuICAgIHJldHVybiBwcmVmaXggKyByYW5kb207XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEludGVyZmFjZSBmb3Igc2VuZGluZyBtZXNzYWdlcyBhbmQgd2FpdGluZyBmb3IgYSBjb21wbGV0aW9uIHJlc3BvbnNlLlxyXG4gKlxyXG4gKi9cclxuY2xhc3MgU2VuZGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKHRhcmdldCkge1xyXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIHRoaXMuaGFuZGxlcnMgPSBuZXcgU2V0KCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFVuc3Vic2NyaWJlIHRoZSBoYW5kbGVyIGFuZCByZW1vdmUgaXQgZnJvbSBvdXIgdHJhY2tpbmcgU2V0LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBoYW5kbGVyIC0gVGhlIGhhbmRsZXIgdG8gdW5zdWJzY3JpYmUuXHJcbiAgICAgKi9cclxuICAgIHJlbW92ZU1lc3NhZ2VIYW5kbGVyKGhhbmRsZXIpIHtcclxuICAgICAgICBpZiAoaGFuZGxlci5tZXNzYWdlQ2hhbm5lbCkge1xyXG4gICAgICAgICAgICBoYW5kbGVyLm1lc3NhZ2VDaGFubmVsLnBvcnQxLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVyLm9uTWVzc2FnZSk7XHJcbiAgICAgICAgICAgIGhhbmRsZXIubWVzc2FnZUNoYW5uZWwucG9ydDEuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5oYW5kbGVycy5kZWxldGUoaGFuZGxlcik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFNlbmQgYSBtZXNzYWdlIHRvIHRoZSBSZWNlaXZlciBsb2NhdGVkIGF0IHtAbGluayB0YXJnZXR9LlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKiBXZSdsbCBmaXJzdCB3YWl0IGEgYml0IGZvciBhbiBBQ0sgLCBpZiB3ZSBnZXQgb25lIHdlIHdpbGwgd2FpdCBzaWduaWZpY2FudGx5IGxvbmdlciB1bnRpbCB0aGVcclxuICAgICAqIHJlY2VpdmVyIGhhcyBoYWQgYSBjaGFuY2UgdG8gZnVsbHkgcHJvY2VzcyB0aGUgZXZlbnQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV2ZW50VHlwZSAtIFR5cGUgb2YgZXZlbnQgdG8gc2VuZC5cclxuICAgICAqIEBwYXJhbSBkYXRhIC0gVGhlIHBheWxvYWQgb2YgdGhlIGV2ZW50LlxyXG4gICAgICogQHBhcmFtIHRpbWVvdXQgLSBUaW1lb3V0IGZvciB3YWl0aW5nIG9uIGFuIEFDSyBmcm9tIHRoZSByZWNlaXZlci5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBBbiBhcnJheSBvZiBzZXR0bGVkIHByb21pc2VzIGZyb20gYWxsIHRoZSBoYW5kbGVycyB0aGF0IHdlcmUgbGlzdGVuaW5nIG9uIHRoZSByZWNlaXZlci5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgX3NlbmQoZXZlbnRUeXBlLCBkYXRhLCB0aW1lb3V0ID0gNTAgLyogX1RpbWVvdXREdXJhdGlvbi5BQ0sgKi8pIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlQ2hhbm5lbCA9IHR5cGVvZiBNZXNzYWdlQ2hhbm5lbCAhPT0gJ3VuZGVmaW5lZCcgPyBuZXcgTWVzc2FnZUNoYW5uZWwoKSA6IG51bGw7XHJcbiAgICAgICAgaWYgKCFtZXNzYWdlQ2hhbm5lbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb25uZWN0aW9uX3VuYXZhaWxhYmxlXCIgLyogX01lc3NhZ2VFcnJvci5DT05ORUNUSU9OX1VOQVZBSUxBQkxFICovKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gTm9kZSB0aW1lcnMgYW5kIGJyb3dzZXIgdGltZXJzIHJldHVybiBmdW5kYW1lbnRhbGx5IGRpZmZlcmVudCB0eXBlcy5cclxuICAgICAgICAvLyBXZSBkb24ndCBhY3R1YWxseSBjYXJlIHdoYXQgdGhlIHZhbHVlIGlzIGJ1dCBUUyB3b24ndCBhY2NlcHQgdW5rbm93biBhbmRcclxuICAgICAgICAvLyB3ZSBjYW4ndCBjYXN0IHByb3Blcmx5IGluIGJvdGggZW52aXJvbm1lbnRzLlxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgICAgICAgbGV0IGNvbXBsZXRpb25UaW1lcjtcclxuICAgICAgICBsZXQgaGFuZGxlcjtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBldmVudElkID0gX2dlbmVyYXRlRXZlbnRJZCgnJywgMjApO1xyXG4gICAgICAgICAgICBtZXNzYWdlQ2hhbm5lbC5wb3J0MS5zdGFydCgpO1xyXG4gICAgICAgICAgICBjb25zdCBhY2tUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihcInVuc3VwcG9ydGVkX2V2ZW50XCIgLyogX01lc3NhZ2VFcnJvci5VTlNVUFBPUlRFRF9FVkVOVCAqLykpO1xyXG4gICAgICAgICAgICB9LCB0aW1lb3V0KTtcclxuICAgICAgICAgICAgaGFuZGxlciA9IHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLFxyXG4gICAgICAgICAgICAgICAgb25NZXNzYWdlKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUV2ZW50ID0gZXZlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VFdmVudC5kYXRhLmV2ZW50SWQgIT09IGV2ZW50SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1lc3NhZ2VFdmVudC5kYXRhLnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYWNrXCIgLyogX1N0YXR1cy5BQ0sgKi86XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcmVjZWl2ZXIgc2hvdWxkIEFDSyBmaXJzdC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChhY2tUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwidGltZW91dFwiIC8qIF9NZXNzYWdlRXJyb3IuVElNRU9VVCAqLykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzAwMCAvKiBfVGltZW91dER1cmF0aW9uLkNPTVBMRVRJT04gKi8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkb25lXCIgLyogX1N0YXR1cy5ET05FICovOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT25jZSB0aGUgcmVjZWl2ZXIncyBoYW5kbGVycyBhcmUgZmluaXNoZWQgd2Ugd2lsbCBnZXQgdGhlIHJlc3VsdHMuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoY29tcGxldGlvblRpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZUV2ZW50LmRhdGEucmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoYWNrVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGNvbXBsZXRpb25UaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwiaW52YWxpZF9yZXNwb25zZVwiIC8qIF9NZXNzYWdlRXJyb3IuSU5WQUxJRF9SRVNQT05TRSAqLykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZXJzLmFkZChoYW5kbGVyKTtcclxuICAgICAgICAgICAgbWVzc2FnZUNoYW5uZWwucG9ydDEuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGhhbmRsZXIub25NZXNzYWdlKTtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgZXZlbnRUeXBlLFxyXG4gICAgICAgICAgICAgICAgZXZlbnRJZCxcclxuICAgICAgICAgICAgICAgIGRhdGFcclxuICAgICAgICAgICAgfSwgW21lc3NhZ2VDaGFubmVsLnBvcnQyXSk7XHJcbiAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChoYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZU1lc3NhZ2VIYW5kbGVyKGhhbmRsZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIExhenkgYWNjZXNzb3IgZm9yIHdpbmRvdywgc2luY2UgdGhlIGNvbXBhdCBsYXllciB3b24ndCB0cmVlIHNoYWtlIHRoaXMgb3V0LFxyXG4gKiB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSBub3QgdG8gbWVzcyB3aXRoIHdpbmRvdyB1bmxlc3Mgd2UgaGF2ZSB0b1xyXG4gKi9cclxuZnVuY3Rpb24gX3dpbmRvdygpIHtcclxuICAgIHJldHVybiB3aW5kb3c7XHJcbn1cclxuZnVuY3Rpb24gX3NldFdpbmRvd0xvY2F0aW9uKHVybCkge1xyXG4gICAgX3dpbmRvdygpLmxvY2F0aW9uLmhyZWYgPSB1cmw7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTEMuXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIF9pc1dvcmtlcigpIHtcclxuICAgIHJldHVybiAodHlwZW9mIF93aW5kb3coKVsnV29ya2VyR2xvYmFsU2NvcGUnXSAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICB0eXBlb2YgX3dpbmRvdygpWydpbXBvcnRTY3JpcHRzJ10gPT09ICdmdW5jdGlvbicpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9nZXRBY3RpdmVTZXJ2aWNlV29ya2VyKCkge1xyXG4gICAgaWYgKCEobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5O1xyXG4gICAgICAgIHJldHVybiByZWdpc3RyYXRpb24uYWN0aXZlO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gX2dldFNlcnZpY2VXb3JrZXJDb250cm9sbGVyKCkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgcmV0dXJuICgoX2EgPSBuYXZpZ2F0b3IgPT09IG51bGwgfHwgbmF2aWdhdG9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmNvbnRyb2xsZXIpIHx8IG51bGw7XHJcbn1cclxuZnVuY3Rpb24gX2dldFdvcmtlckdsb2JhbFNjb3BlKCkge1xyXG4gICAgcmV0dXJuIF9pc1dvcmtlcigpID8gc2VsZiA6IG51bGw7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgREJfTkFNRSA9ICdmaXJlYmFzZUxvY2FsU3RvcmFnZURiJztcclxuY29uc3QgREJfVkVSU0lPTiA9IDE7XHJcbmNvbnN0IERCX09CSkVDVFNUT1JFX05BTUUgPSAnZmlyZWJhc2VMb2NhbFN0b3JhZ2UnO1xyXG5jb25zdCBEQl9EQVRBX0tFWVBBVEggPSAnZmJhc2Vfa2V5JztcclxuLyoqXHJcbiAqIFByb21pc2Ugd3JhcHBlciBmb3IgSURCUmVxdWVzdFxyXG4gKlxyXG4gKiBVbmZvcnR1bmF0ZWx5IHdlIGNhbid0IGNsZWFubHkgZXh0ZW5kIFByb21pc2U8VD4gc2luY2UgcHJvbWlzZXMgYXJlIG5vdCBjYWxsYWJsZSBpbiBFUzZcclxuICpcclxuICovXHJcbmNsYXNzIERCUHJvbWlzZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihyZXF1ZXN0KSB7XHJcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDtcclxuICAgIH1cclxuICAgIHRvUHJvbWlzZSgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUodGhpcy5yZXF1ZXN0LnJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QodGhpcy5yZXF1ZXN0LmVycm9yKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0T2JqZWN0U3RvcmUoZGIsIGlzUmVhZFdyaXRlKSB7XHJcbiAgICByZXR1cm4gZGJcclxuICAgICAgICAudHJhbnNhY3Rpb24oW0RCX09CSkVDVFNUT1JFX05BTUVdLCBpc1JlYWRXcml0ZSA/ICdyZWFkd3JpdGUnIDogJ3JlYWRvbmx5JylcclxuICAgICAgICAub2JqZWN0U3RvcmUoREJfT0JKRUNUU1RPUkVfTkFNRSk7XHJcbn1cclxuZnVuY3Rpb24gX2RlbGV0ZURhdGFiYXNlKCkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShEQl9OQU1FKTtcclxuICAgIHJldHVybiBuZXcgREJQcm9taXNlKHJlcXVlc3QpLnRvUHJvbWlzZSgpO1xyXG59XHJcbmZ1bmN0aW9uIF9vcGVuRGF0YWJhc2UoKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oREJfTkFNRSwgREJfVkVSU0lPTik7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChyZXF1ZXN0LmVycm9yKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3VwZ3JhZGVuZWVkZWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRiID0gcmVxdWVzdC5yZXN1bHQ7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShEQl9PQkpFQ1RTVE9SRV9OQU1FLCB7IGtleVBhdGg6IERCX0RBVEFfS0VZUEFUSCB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYiA9IHJlcXVlc3QucmVzdWx0O1xyXG4gICAgICAgICAgICAvLyBTdHJhbmdlIGJ1ZyB0aGF0IG9jY3VycyBpbiBGaXJlZm94IHdoZW4gbXVsdGlwbGUgdGFicyBhcmUgb3BlbmVkIGF0IHRoZVxyXG4gICAgICAgICAgICAvLyBzYW1lIHRpbWUuIFRoZSBvbmx5IHdheSB0byByZWNvdmVyIHNlZW1zIHRvIGJlIGRlbGV0aW5nIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgICAvLyBhbmQgcmUtaW5pdGlhbGl6aW5nIGl0LlxyXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82MzRcclxuICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKERCX09CSkVDVFNUT1JFX05BTUUpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBOZWVkIHRvIGNsb3NlIHRoZSBkYXRhYmFzZSBvciBlbHNlIHlvdSBnZXQgYSBgYmxvY2tlZGAgZXZlbnRcclxuICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBfZGVsZXRlRGF0YWJhc2UoKTtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoYXdhaXQgX29wZW5EYXRhYmFzZSgpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoZGIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfcHV0T2JqZWN0KGRiLCBrZXksIHZhbHVlKSB7XHJcbiAgICBjb25zdCByZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIHRydWUpLnB1dCh7XHJcbiAgICAgICAgW0RCX0RBVEFfS0VZUEFUSF06IGtleSxcclxuICAgICAgICB2YWx1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBnZXRPYmplY3QoZGIsIGtleSkge1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IGdldE9iamVjdFN0b3JlKGRiLCBmYWxzZSkuZ2V0KGtleSk7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTtcclxuICAgIHJldHVybiBkYXRhID09PSB1bmRlZmluZWQgPyBudWxsIDogZGF0YS52YWx1ZTtcclxufVxyXG5mdW5jdGlvbiBfZGVsZXRlT2JqZWN0KGRiLCBrZXkpIHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBnZXRPYmplY3RTdG9yZShkYiwgdHJ1ZSkuZGVsZXRlKGtleSk7XHJcbiAgICByZXR1cm4gbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTtcclxufVxyXG5jb25zdCBfUE9MTElOR19JTlRFUlZBTF9NUyA9IDgwMDtcclxuY29uc3QgX1RSQU5TQUNUSU9OX1JFVFJZX0NPVU5UID0gMztcclxuY2xhc3MgSW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnR5cGUgPSBcIkxPQ0FMXCIgLyogUGVyc2lzdGVuY2VUeXBlLkxPQ0FMICovO1xyXG4gICAgICAgIHRoaXMuX3Nob3VsZEFsbG93TWlncmF0aW9uID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmxpc3RlbmVycyA9IHt9O1xyXG4gICAgICAgIHRoaXMubG9jYWxDYWNoZSA9IHt9O1xyXG4gICAgICAgIC8vIHNldFRpbWVvdXQgcmV0dXJuIHZhbHVlIGlzIHBsYXRmb3JtIHNwZWNpZmljXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nV3JpdGVzID0gMDtcclxuICAgICAgICB0aGlzLnJlY2VpdmVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnNlbmRlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5zZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIgPSBudWxsO1xyXG4gICAgICAgIC8vIEZpcmUgJiBmb3JnZXQgdGhlIHNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiBhcyBpdCBtYXkgbmV2ZXIgcmVzb2x2ZVxyXG4gICAgICAgIHRoaXMuX3dvcmtlckluaXRpYWxpemF0aW9uUHJvbWlzZSA9XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZVNlcnZpY2VXb3JrZXJNZXNzYWdpbmcoKS50aGVuKCgpID0+IHsgfSwgKCkgPT4geyB9KTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9vcGVuRGIoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGIgPSBhd2FpdCBfb3BlbkRhdGFiYXNlKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGI7XHJcbiAgICB9XHJcbiAgICBhc3luYyBfd2l0aFJldHJpZXMob3ApIHtcclxuICAgICAgICBsZXQgbnVtQXR0ZW1wdHMgPSAwO1xyXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IHRoaXMuX29wZW5EYigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG9wKGRiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG51bUF0dGVtcHRzKysgPiBfVFJBTlNBQ1RJT05fUkVUUllfQ09VTlQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZGIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRiLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYiA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGNvbnNpZGVyIGFkZGluZyBleHBvbmVudGlhbCBiYWNrb2ZmXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEluZGV4ZWREQiBldmVudHMgZG8gbm90IHByb3BhZ2F0ZSBmcm9tIHRoZSBtYWluIHdpbmRvdyB0byB0aGUgd29ya2VyIGNvbnRleHQuICBXZSByZWx5IG9uIGFcclxuICAgICAqIHBvc3RNZXNzYWdlIGludGVyZmFjZSB0byBzZW5kIHRoZXNlIGV2ZW50cyB0byB0aGUgd29ya2VyIG91cnNlbHZlcy5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgaW5pdGlhbGl6ZVNlcnZpY2VXb3JrZXJNZXNzYWdpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9pc1dvcmtlcigpID8gdGhpcy5pbml0aWFsaXplUmVjZWl2ZXIoKSA6IHRoaXMuaW5pdGlhbGl6ZVNlbmRlcigpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBcyB0aGUgd29ya2VyIHdlIHNob3VsZCBsaXN0ZW4gdG8gZXZlbnRzIGZyb20gdGhlIG1haW4gd2luZG93LlxyXG4gICAgICovXHJcbiAgICBhc3luYyBpbml0aWFsaXplUmVjZWl2ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5yZWNlaXZlciA9IFJlY2VpdmVyLl9nZXRJbnN0YW5jZShfZ2V0V29ya2VyR2xvYmFsU2NvcGUoKSk7XHJcbiAgICAgICAgLy8gUmVmcmVzaCBmcm9tIHBlcnNpc3RlbmNlIGlmIHdlIHJlY2VpdmUgYSBLZXlDaGFuZ2VkIG1lc3NhZ2UuXHJcbiAgICAgICAgdGhpcy5yZWNlaXZlci5fc3Vic2NyaWJlKFwia2V5Q2hhbmdlZFwiIC8qIF9FdmVudFR5cGUuS0VZX0NIQU5HRUQgKi8sIGFzeW5jIChfb3JpZ2luLCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLl9wb2xsKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBrZXlQcm9jZXNzZWQ6IGtleXMuaW5jbHVkZXMoZGF0YS5rZXkpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gTGV0IHRoZSBzZW5kZXIga25vdyB0aGF0IHdlIGFyZSBsaXN0ZW5pbmcgc28gdGhleSBnaXZlIHVzIG1vcmUgdGltZW91dC5cclxuICAgICAgICB0aGlzLnJlY2VpdmVyLl9zdWJzY3JpYmUoXCJwaW5nXCIgLyogX0V2ZW50VHlwZS5QSU5HICovLCBhc3luYyAoX29yaWdpbiwgX2RhdGEpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIFtcImtleUNoYW5nZWRcIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovXTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQXMgdGhlIG1haW4gd2luZG93LCB3ZSBzaG91bGQgbGV0IHRoZSB3b3JrZXIga25vdyB3aGVuIGtleXMgY2hhbmdlIChzZXQgYW5kIHJlbW92ZSkuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIHtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvU2VydmljZVdvcmtlckNvbnRhaW5lci9yZWFkeSB8IFNlcnZpY2VXb3JrZXJDb250YWluZXIucmVhZHl9XHJcbiAgICAgKiBtYXkgbm90IHJlc29sdmUuXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGluaXRpYWxpemVTZW5kZXIoKSB7XHJcbiAgICAgICAgdmFyIF9hLCBfYjtcclxuICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUncyBhbiBhY3RpdmUgc2VydmljZSB3b3JrZXIuXHJcbiAgICAgICAgdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyID0gYXdhaXQgX2dldEFjdGl2ZVNlcnZpY2VXb3JrZXIoKTtcclxuICAgICAgICBpZiAoIXRoaXMuYWN0aXZlU2VydmljZVdvcmtlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2VuZGVyID0gbmV3IFNlbmRlcih0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIpO1xyXG4gICAgICAgIC8vIFBpbmcgdGhlIHNlcnZpY2Ugd29ya2VyIHRvIGNoZWNrIHdoYXQgZXZlbnRzIHRoZXkgY2FuIGhhbmRsZS5cclxuICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgdGhpcy5zZW5kZXIuX3NlbmQoXCJwaW5nXCIgLyogX0V2ZW50VHlwZS5QSU5HICovLCB7fSwgODAwIC8qIF9UaW1lb3V0RHVyYXRpb24uTE9OR19BQ0sgKi8pO1xyXG4gICAgICAgIGlmICghcmVzdWx0cykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoKF9hID0gcmVzdWx0c1swXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZ1bGZpbGxlZCkgJiZcclxuICAgICAgICAgICAgKChfYiA9IHJlc3VsdHNbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi52YWx1ZS5pbmNsdWRlcyhcImtleUNoYW5nZWRcIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovKSkpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTGV0IHRoZSB3b3JrZXIga25vdyBhYm91dCBhIGNoYW5nZWQga2V5LCB0aGUgZXhhY3Qga2V5IGRvZXNuJ3QgdGVjaG5pY2FsbHkgbWF0dGVyIHNpbmNlIHRoZVxyXG4gICAgICogd29ya2VyIHdpbGwganVzdCB0cmlnZ2VyIGEgZnVsbCBzeW5jIGFueXdheS5cclxuICAgICAqXHJcbiAgICAgKiBAcmVtYXJrc1xyXG4gICAgICogRm9yIG5vdywgd2Ugb25seSBzdXBwb3J0IG9uZSBzZXJ2aWNlIHdvcmtlciBwZXIgcGFnZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ga2V5IC0gU3RvcmFnZSBrZXkgd2hpY2ggY2hhbmdlZC5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgbm90aWZ5U2VydmljZVdvcmtlcihrZXkpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc2VuZGVyIHx8XHJcbiAgICAgICAgICAgICF0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIgfHxcclxuICAgICAgICAgICAgX2dldFNlcnZpY2VXb3JrZXJDb250cm9sbGVyKCkgIT09IHRoaXMuYWN0aXZlU2VydmljZVdvcmtlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZGVyLl9zZW5kKFwia2V5Q2hhbmdlZFwiIC8qIF9FdmVudFR5cGUuS0VZX0NIQU5HRUQgKi8sIHsga2V5IH0sIFxyXG4gICAgICAgICAgICAvLyBVc2UgbG9uZyB0aW1lb3V0IGlmIHJlY2VpdmVyIGhhcyBwcmV2aW91c2x5IHJlc3BvbmRlZCB0byBhIHBpbmcgZnJvbSB1cy5cclxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGVcclxuICAgICAgICAgICAgICAgID8gODAwIC8qIF9UaW1lb3V0RHVyYXRpb24uTE9OR19BQ0sgKi9cclxuICAgICAgICAgICAgICAgIDogNTAgLyogX1RpbWVvdXREdXJhdGlvbi5BQ0sgKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGJlc3QgZWZmb3J0IGFwcHJvYWNoLiBJZ25vcmUgZXJyb3JzLlxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIF9pc0F2YWlsYWJsZSgpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAoIWluZGV4ZWREQikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGRiID0gYXdhaXQgX29wZW5EYXRhYmFzZSgpO1xyXG4gICAgICAgICAgICBhd2FpdCBfcHV0T2JqZWN0KGRiLCBTVE9SQUdFX0FWQUlMQUJMRV9LRVksICcxJyk7XHJcbiAgICAgICAgICAgIGF3YWl0IF9kZWxldGVPYmplY3QoZGIsIFNUT1JBR0VfQVZBSUxBQkxFX0tFWSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoX2EpIHsgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGFzeW5jIF93aXRoUGVuZGluZ1dyaXRlKHdyaXRlKSB7XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nV3JpdGVzKys7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgd3JpdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZmluYWxseSB7XHJcbiAgICAgICAgICAgIHRoaXMucGVuZGluZ1dyaXRlcy0tO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIF9zZXQoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl93aXRoUGVuZGluZ1dyaXRlKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiBfcHV0T2JqZWN0KGRiLCBrZXksIHZhbHVlKSk7XHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdGlmeVNlcnZpY2VXb3JrZXIoa2V5KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9nZXQoa2V5KSB7XHJcbiAgICAgICAgY29uc3Qgb2JqID0gKGF3YWl0IHRoaXMuX3dpdGhSZXRyaWVzKChkYikgPT4gZ2V0T2JqZWN0KGRiLCBrZXkpKSk7XHJcbiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBvYmo7XHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH1cclxuICAgIGFzeW5jIF9yZW1vdmUoa2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpdGhQZW5kaW5nV3JpdGUoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IF9kZWxldGVPYmplY3QoZGIsIGtleSkpO1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5sb2NhbENhY2hlW2tleV07XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm5vdGlmeVNlcnZpY2VXb3JrZXIoa2V5KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9wb2xsKCkge1xyXG4gICAgICAgIC8vIFRPRE86IGNoZWNrIGlmIHdlIG5lZWQgdG8gZmFsbGJhY2sgaWYgZ2V0QWxsIGlzIG5vdCBzdXBwb3J0ZWRcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZ2V0QWxsUmVxdWVzdCA9IGdldE9iamVjdFN0b3JlKGRiLCBmYWxzZSkuZ2V0QWxsKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgREJQcm9taXNlKGdldEFsbFJlcXVlc3QpLnRvUHJvbWlzZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICghcmVzdWx0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgd2UgaGF2ZSBwZW5kaW5nIHdyaXRlcyBpbiBwcm9ncmVzcyBhYm9ydCwgd2UnbGwgZ2V0IHBpY2tlZCB1cCBvbiB0aGUgbmV4dCBwb2xsXHJcbiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1dyaXRlcyAhPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGtleXMgPSBbXTtcclxuICAgICAgICBjb25zdCBrZXlzSW5SZXN1bHQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgZm9yIChjb25zdCB7IGZiYXNlX2tleToga2V5LCB2YWx1ZSB9IG9mIHJlc3VsdCkge1xyXG4gICAgICAgICAgICBrZXlzSW5SZXN1bHQuYWRkKGtleSk7XHJcbiAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLmxvY2FsQ2FjaGVba2V5XSkgIT09IEpTT04uc3RyaW5naWZ5KHZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoa2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBrZXlzLnB1c2goa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IGxvY2FsS2V5IG9mIE9iamVjdC5rZXlzKHRoaXMubG9jYWxDYWNoZSkpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubG9jYWxDYWNoZVtsb2NhbEtleV0gJiYgIWtleXNJblJlc3VsdC5oYXMobG9jYWxLZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBEZWxldGVkXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhsb2NhbEtleSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICBrZXlzLnB1c2gobG9jYWxLZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBrZXlzO1xyXG4gICAgfVxyXG4gICAgbm90aWZ5TGlzdGVuZXJzKGtleSwgbmV3VmFsdWUpIHtcclxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzW2tleV07XHJcbiAgICAgICAgaWYgKGxpc3RlbmVycykge1xyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyIG9mIEFycmF5LmZyb20obGlzdGVuZXJzKSkge1xyXG4gICAgICAgICAgICAgICAgbGlzdGVuZXIobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc3RhcnRQb2xsaW5nKCkge1xyXG4gICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICB0aGlzLnBvbGxUaW1lciA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHRoaXMuX3BvbGwoKSwgX1BPTExJTkdfSU5URVJWQUxfTVMpO1xyXG4gICAgfVxyXG4gICAgc3RvcFBvbGxpbmcoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucG9sbFRpbWVyKSB7XHJcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX2FkZExpc3RlbmVyKGtleSwgbGlzdGVuZXIpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9sbGluZygpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMubGlzdGVuZXJzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XSA9IG5ldyBTZXQoKTtcclxuICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGNhY2hlIHRvIGF2b2lkIHNwdXJpb3VzbHkgdHJpZ2dlcmluZyBvbiBmaXJzdCBwb2xsLlxyXG4gICAgICAgICAgICB2b2lkIHRoaXMuX2dldChrZXkpOyAvLyBUaGlzIGNhbiBoYXBwZW4gaW4gdGhlIGJhY2tncm91bmQgYXN5bmMgYW5kIHdlIGNhbiByZXR1cm4gaW1tZWRpYXRlbHkuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGlzdGVuZXJzW2tleV0uYWRkKGxpc3RlbmVyKTtcclxuICAgIH1cclxuICAgIF9yZW1vdmVMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlzdGVuZXJzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XS5kZWxldGUobGlzdGVuZXIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XS5zaXplID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5saXN0ZW5lcnMpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbkluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7XHJcbi8qKlxyXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIHR5cGUgYExPQ0FMYCB1c2luZyBgaW5kZXhlZERCYFxyXG4gKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY29uc3QgaW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSA9IEluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2U7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIHN0YXJ0U2lnbkluUGhvbmVNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYVNpZ25JbjpzdGFydFwiIC8qIEVuZHBvaW50LlNUQVJUX01GQV9TSUdOX0lOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmFsaXplU2lnbkluUGhvbmVNZmEoYXV0aCwgcmVxdWVzdCkge1xyXG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYVNpZ25JbjpmaW5hbGl6ZVwiIC8qIEVuZHBvaW50LkZJTkFMSVpFX01GQV9TSUdOX0lOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFJlY2FwdGNoYVBhcmFtcyhhdXRoKSB7XHJcbiAgICByZXR1cm4gKChhd2FpdCBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJHRVRcIiAvKiBIdHRwTWV0aG9kLkdFVCAqLywgXCIvdjEvcmVjYXB0Y2hhUGFyYW1zXCIgLyogRW5kcG9pbnQuR0VUX1JFQ0FQVENIQV9QQVJBTSAqLykpLnJlY2FwdGNoYVNpdGVLZXkgfHwgJycpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGdldFNjcmlwdFBhcmVudEVsZW1lbnQoKSB7XHJcbiAgICB2YXIgX2EsIF9iO1xyXG4gICAgcmV0dXJuIChfYiA9IChfYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJykpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogZG9jdW1lbnQ7XHJcbn1cclxuZnVuY3Rpb24gX2xvYWRKUyh1cmwpIHtcclxuICAgIC8vIFRPRE86IGNvbnNpZGVyIGFkZGluZyB0aW1lb3V0IHN1cHBvcnQgJiBjYW5jZWxsYXRpb25cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcclxuICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ3NyYycsIHVybCk7XHJcbiAgICAgICAgZWwub25sb2FkID0gcmVzb2x2ZTtcclxuICAgICAgICBlbC5vbmVycm9yID0gZSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gX2NyZWF0ZUVycm9yKFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICAgICAgZXJyb3IuY3VzdG9tRGF0YSA9IGU7XHJcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBlbC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XHJcbiAgICAgICAgZWwuY2hhcnNldCA9ICdVVEYtOCc7XHJcbiAgICAgICAgZ2V0U2NyaXB0UGFyZW50RWxlbWVudCgpLmFwcGVuZENoaWxkKGVsKTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIF9nZW5lcmF0ZUNhbGxiYWNrTmFtZShwcmVmaXgpIHtcclxuICAgIHJldHVybiBgX18ke3ByZWZpeH0ke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApfWA7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgX1NPTFZFX1RJTUVfTVMgPSA1MDA7XHJcbmNvbnN0IF9FWFBJUkFUSU9OX1RJTUVfTVMgPSA2MDAwMDtcclxuY29uc3QgX1dJREdFVF9JRF9TVEFSVCA9IDEwMDAwMDAwMDAwMDA7XHJcbmNsYXNzIE1vY2tSZUNhcHRjaGEge1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyID0gX1dJREdFVF9JRF9TVEFSVDtcclxuICAgICAgICB0aGlzLl93aWRnZXRzID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgcmVuZGVyKGNvbnRhaW5lciwgcGFyYW1ldGVycykge1xyXG4gICAgICAgIGNvbnN0IGlkID0gdGhpcy5jb3VudGVyO1xyXG4gICAgICAgIHRoaXMuX3dpZGdldHMuc2V0KGlkLCBuZXcgTW9ja1dpZGdldChjb250YWluZXIsIHRoaXMuYXV0aC5uYW1lLCBwYXJhbWV0ZXJzIHx8IHt9KSk7XHJcbiAgICAgICAgdGhpcy5jb3VudGVyKys7XHJcbiAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgfVxyXG4gICAgcmVzZXQob3B0V2lkZ2V0SWQpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgaWQgPSBvcHRXaWRnZXRJZCB8fCBfV0lER0VUX0lEX1NUQVJUO1xyXG4gICAgICAgIHZvaWQgKChfYSA9IHRoaXMuX3dpZGdldHMuZ2V0KGlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlbGV0ZSgpKTtcclxuICAgICAgICB0aGlzLl93aWRnZXRzLmRlbGV0ZShpZCk7XHJcbiAgICB9XHJcbiAgICBnZXRSZXNwb25zZShvcHRXaWRnZXRJZCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBjb25zdCBpZCA9IG9wdFdpZGdldElkIHx8IF9XSURHRVRfSURfU1RBUlQ7XHJcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLl93aWRnZXRzLmdldChpZCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRSZXNwb25zZSgpKSB8fCAnJztcclxuICAgIH1cclxuICAgIGFzeW5jIGV4ZWN1dGUob3B0V2lkZ2V0SWQpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgY29uc3QgaWQgPSBvcHRXaWRnZXRJZCB8fCBfV0lER0VUX0lEX1NUQVJUO1xyXG4gICAgICAgIHZvaWQgKChfYSA9IHRoaXMuX3dpZGdldHMuZ2V0KGlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmV4ZWN1dGUoKSk7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcbmNsYXNzIE1vY2tXaWRnZXQge1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyT3JJZCwgYXBwTmFtZSwgcGFyYW1zKSB7XHJcbiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRlbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJlc3BvbnNlVG9rZW4gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY2xpY2tIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHR5cGVvZiBjb250YWluZXJPcklkID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lck9ySWQpXHJcbiAgICAgICAgICAgIDogY29udGFpbmVyT3JJZDtcclxuICAgICAgICBfYXNzZXJ0KGNvbnRhaW5lciwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8sIHsgYXBwTmFtZSB9KTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IHRoaXMucGFyYW1zLnNpemUgIT09ICdpbnZpc2libGUnO1xyXG4gICAgICAgIGlmICh0aGlzLmlzVmlzaWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldFJlc3BvbnNlKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tJZkRlbGV0ZWQoKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZXNwb25zZVRva2VuO1xyXG4gICAgfVxyXG4gICAgZGVsZXRlKCkge1xyXG4gICAgICAgIHRoaXMuY2hlY2tJZkRlbGV0ZWQoKTtcclxuICAgICAgICB0aGlzLmRlbGV0ZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLnRpbWVySWQpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJJZCk7XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIpO1xyXG4gICAgfVxyXG4gICAgZXhlY3V0ZSgpIHtcclxuICAgICAgICB0aGlzLmNoZWNrSWZEZWxldGVkKCk7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZXJJZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZXNwb25zZVRva2VuID0gZ2VuZXJhdGVSYW5kb21BbHBoYU51bWVyaWNTdHJpbmcoNTApO1xyXG4gICAgICAgICAgICBjb25zdCB7IGNhbGxiYWNrLCAnZXhwaXJlZC1jYWxsYmFjayc6IGV4cGlyZWRDYWxsYmFjayB9ID0gdGhpcy5wYXJhbXM7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh0aGlzLnJlc3BvbnNlVG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlVG9rZW4gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4cGlyZWRDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZWRDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgX0VYUElSQVRJT05fVElNRV9NUyk7XHJcbiAgICAgICAgfSwgX1NPTFZFX1RJTUVfTVMpO1xyXG4gICAgfVxyXG4gICAgY2hlY2tJZkRlbGV0ZWQoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVsZXRlZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlQ0FQVENIQSBtb2NrIHdhcyBhbHJlYWR5IGRlbGV0ZWQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQWxwaGFOdW1lcmljU3RyaW5nKGxlbikge1xyXG4gICAgY29uc3QgY2hhcnMgPSBbXTtcclxuICAgIGNvbnN0IGFsbG93ZWRDaGFycyA9ICcxMjM0NTY3ODkwYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgY2hhcnMucHVzaChhbGxvd2VkQ2hhcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFsbG93ZWRDaGFycy5sZW5ndGgpKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2hhcnMuam9pbignJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLy8gUmVDYXB0Y2hhIHdpbGwgbG9hZCB1c2luZyB0aGUgc2FtZSBjYWxsYmFjaywgc28gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIG5lZWRzXHJcbi8vIHRvIGJlIGtlcHQgYXJvdW5kXHJcbmNvbnN0IF9KU0xPQURfQ0FMTEJBQ0sgPSBfZ2VuZXJhdGVDYWxsYmFja05hbWUoJ3JjYicpO1xyXG5jb25zdCBORVRXT1JLX1RJTUVPVVRfREVMQVkgPSBuZXcgRGVsYXkoMzAwMDAsIDYwMDAwKTtcclxuY29uc3QgUkVDQVBUQ0hBX0JBU0UgPSAnaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLmpzPyc7XHJcbi8qKlxyXG4gKiBMb2FkZXIgZm9yIHRoZSBHUmVDYXB0Y2hhIGxpYnJhcnkuIFRoZXJlIHNob3VsZCBvbmx5IGV2ZXIgYmUgb25lIG9mIHRoaXMuXHJcbiAqL1xyXG5jbGFzcyBSZUNhcHRjaGFMb2FkZXJJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICB0aGlzLmhvc3RMYW5ndWFnZSA9ICcnO1xyXG4gICAgICAgIHRoaXMuY291bnRlciA9IDA7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ2hlY2sgZm9yIGByZW5kZXIoKWAgbWV0aG9kLiBgd2luZG93LmdyZWNhcHRjaGFgIHdpbGwgZXhpc3QgaWYgdGhlIEVudGVycHJpc2VcclxuICAgICAgICAgKiB2ZXJzaW9uIG9mIHRoZSBSZUNBUFRDSEEgc2NyaXB0IHdhcyBsb2FkZWQgYnkgc29tZW9uZSBlbHNlIChlLmcuIEFwcCBDaGVjaykgYnV0XHJcbiAgICAgICAgICogYHdpbmRvdy5ncmVjYXB0Y2hhLnJlbmRlcigpYCB3aWxsIG5vdC4gQW5vdGhlciBsb2FkIHdpbGwgYWRkIGl0LlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMubGlicmFyeVNlcGFyYXRlbHlMb2FkZWQgPSAhISgoX2EgPSBfd2luZG93KCkuZ3JlY2FwdGNoYSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnJlbmRlcik7XHJcbiAgICB9XHJcbiAgICBsb2FkKGF1dGgsIGhsID0gJycpIHtcclxuICAgICAgICBfYXNzZXJ0KGlzSG9zdExhbmd1YWdlVmFsaWQoaGwpLCBhdXRoLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkUmVzb2x2ZUltbWVkaWF0ZWx5KGhsKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKF93aW5kb3coKS5ncmVjYXB0Y2hhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbmV0d29ya1RpbWVvdXQgPSBfd2luZG93KCkuc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoX2NyZWF0ZUVycm9yKGF1dGgsIFwibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLykpO1xyXG4gICAgICAgICAgICB9LCBORVRXT1JLX1RJTUVPVVRfREVMQVkuZ2V0KCkpO1xyXG4gICAgICAgICAgICBfd2luZG93KClbX0pTTE9BRF9DQUxMQkFDS10gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBfd2luZG93KCkuY2xlYXJUaW1lb3V0KG5ldHdvcmtUaW1lb3V0KTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBfd2luZG93KClbX0pTTE9BRF9DQUxMQkFDS107XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWNhcHRjaGEgPSBfd2luZG93KCkuZ3JlY2FwdGNoYTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVjYXB0Y2hhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KF9jcmVhdGVFcnJvcihhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLykpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIFdyYXAgdGhlIGdyZXB0Y2hhIHJlbmRlciBmdW5jdGlvbiBzbyB0aGF0IHdlIGtub3cgaWYgdGhlIGRldmVsb3BlciBoYXNcclxuICAgICAgICAgICAgICAgIC8vIGNhbGxlZCBpdCBzZXBhcmF0ZWx5XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZW5kZXIgPSByZWNhcHRjaGEucmVuZGVyO1xyXG4gICAgICAgICAgICAgICAgcmVjYXB0Y2hhLnJlbmRlciA9IChjb250YWluZXIsIHBhcmFtcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpZGdldElkID0gcmVuZGVyKGNvbnRhaW5lciwgcGFyYW1zKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2lkZ2V0SWQ7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ob3N0TGFuZ3VhZ2UgPSBobDtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVjYXB0Y2hhKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gYCR7UkVDQVBUQ0hBX0JBU0V9PyR7cXVlcnlzdHJpbmcoe1xyXG4gICAgICAgICAgICAgICAgb25sb2FkOiBfSlNMT0FEX0NBTExCQUNLLFxyXG4gICAgICAgICAgICAgICAgcmVuZGVyOiAnZXhwbGljaXQnLFxyXG4gICAgICAgICAgICAgICAgaGxcclxuICAgICAgICAgICAgfSl9YDtcclxuICAgICAgICAgICAgX2xvYWRKUyh1cmwpLmNhdGNoKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChuZXR3b3JrVGltZW91dCk7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoX2NyZWF0ZUVycm9yKGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgY2xlYXJlZE9uZUluc3RhbmNlKCkge1xyXG4gICAgICAgIHRoaXMuY291bnRlci0tO1xyXG4gICAgfVxyXG4gICAgc2hvdWxkUmVzb2x2ZUltbWVkaWF0ZWx5KGhsKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIC8vIFdlIGNhbiByZXNvbHZlIGltbWVkaWF0ZWx5IGlmOlxyXG4gICAgICAgIC8vICAg4oCiIGdyZWNhcHRjaGEgaXMgYWxyZWFkeSBkZWZpbmVkIEFORCAoXHJcbiAgICAgICAgLy8gICAgIDEuIHRoZSByZXF1ZXN0ZWQgbGFuZ3VhZ2UgY29kZXMgYXJlIHRoZSBzYW1lIE9SXHJcbiAgICAgICAgLy8gICAgIDIuIHRoZXJlIGV4aXN0cyBhbHJlYWR5IGEgUmVDYXB0Y2hhIG9uIHRoZSBwYWdlXHJcbiAgICAgICAgLy8gICAgIDMuIHRoZSBsaWJyYXJ5IHdhcyBhbHJlYWR5IGxvYWRlZCBieSB0aGUgYXBwXHJcbiAgICAgICAgLy8gSW4gY2FzZXMgKDIpIGFuZCAoMyksIHdlIF9jYW4ndF8gcmVsb2FkIGFzIGl0IHdvdWxkIGJyZWFrIHRoZSByZWNhcHRjaGFzXHJcbiAgICAgICAgLy8gdGhhdCBhcmUgYWxyZWFkeSBpbiB0aGUgcGFnZVxyXG4gICAgICAgIHJldHVybiAoISEoKF9hID0gX3dpbmRvdygpLmdyZWNhcHRjaGEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5yZW5kZXIpICYmXHJcbiAgICAgICAgICAgIChobCA9PT0gdGhpcy5ob3N0TGFuZ3VhZ2UgfHxcclxuICAgICAgICAgICAgICAgIHRoaXMuY291bnRlciA+IDAgfHxcclxuICAgICAgICAgICAgICAgIHRoaXMubGlicmFyeVNlcGFyYXRlbHlMb2FkZWQpKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpc0hvc3RMYW5ndWFnZVZhbGlkKGhsKSB7XHJcbiAgICByZXR1cm4gaGwubGVuZ3RoIDw9IDYgJiYgL15cXHMqW2EtekEtWjAtOVxcLV0qXFxzKiQvLnRlc3QoaGwpO1xyXG59XHJcbmNsYXNzIE1vY2tSZUNhcHRjaGFMb2FkZXJJbXBsIHtcclxuICAgIGFzeW5jIGxvYWQoYXV0aCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgTW9ja1JlQ2FwdGNoYShhdXRoKTtcclxuICAgIH1cclxuICAgIGNsZWFyZWRPbmVJbnN0YW5jZSgpIHsgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IFJFQ0FQVENIQV9WRVJJRklFUl9UWVBFID0gJ3JlY2FwdGNoYSc7XHJcbmNvbnN0IERFRkFVTFRfUEFSQU1TID0ge1xyXG4gICAgdGhlbWU6ICdsaWdodCcsXHJcbiAgICB0eXBlOiAnaW1hZ2UnXHJcbn07XHJcbi8qKlxyXG4gKiBBbiB7QGxpbmsgaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvIHwgcmVDQVBUQ0hBfS1iYXNlZCBhcHBsaWNhdGlvbiB2ZXJpZmllci5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgUmVjYXB0Y2hhVmVyaWZpZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbnRhaW5lck9ySWQgLSBUaGUgcmVDQVBUQ0hBIGNvbnRhaW5lciBwYXJhbWV0ZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqIFRoaXMgaGFzIGRpZmZlcmVudCBtZWFuaW5nIGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSByZUNBUFRDSEEgaXMgaGlkZGVuIG9yIHZpc2libGUuIEZvciBhXHJcbiAgICAgKiB2aXNpYmxlIHJlQ0FQVENIQSB0aGUgY29udGFpbmVyIG11c3QgYmUgZW1wdHkuIElmIGEgc3RyaW5nIGlzIHVzZWQsIGl0IGhhcyB0byBjb3JyZXNwb25kIHRvXHJcbiAgICAgKiBhbiBlbGVtZW50IElELiBUaGUgY29ycmVzcG9uZGluZyBlbGVtZW50IG11c3QgYWxzbyBtdXN0IGJlIGluIHRoZSBET00gYXQgdGhlIHRpbWUgb2ZcclxuICAgICAqIGluaXRpYWxpemF0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwYXJhbWV0ZXJzIC0gVGhlIG9wdGlvbmFsIHJlQ0FQVENIQSBwYXJhbWV0ZXJzLlxyXG4gICAgICpcclxuICAgICAqIEByZW1hcmtzXHJcbiAgICAgKiBDaGVjayB0aGUgcmVDQVBUQ0hBIGRvY3MgZm9yIGEgY29tcHJlaGVuc2l2ZSBsaXN0LiBBbGwgcGFyYW1ldGVycyBhcmUgYWNjZXB0ZWQgZXhjZXB0IGZvclxyXG4gICAgICogdGhlIHNpdGVrZXkuIEZpcmViYXNlIEF1dGggYmFja2VuZCBwcm92aXNpb25zIGEgcmVDQVBUQ0hBIGZvciBlYWNoIHByb2plY3QgYW5kIHdpbGxcclxuICAgICAqIGNvbmZpZ3VyZSB0aGlzIHVwb24gcmVuZGVyaW5nLiBGb3IgYW4gaW52aXNpYmxlIHJlQ0FQVENIQSwgYSBzaXplIGtleSBtdXN0IGhhdmUgdGhlIHZhbHVlXHJcbiAgICAgKiAnaW52aXNpYmxlJy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYXV0aEV4dGVybiAtIFRoZSBjb3JyZXNwb25kaW5nIEZpcmViYXNlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyT3JJZCwgcGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfUEFSQU1TKSwgYXV0aEV4dGVybikge1xyXG4gICAgICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIGFwcGxpY2F0aW9uIHZlcmlmaWVyIHR5cGUuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmVtYXJrc1xyXG4gICAgICAgICAqIEZvciBhIHJlQ0FQVENIQSB2ZXJpZmllciwgdGhpcyBpcyAncmVjYXB0Y2hhJy5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnR5cGUgPSBSRUNBUFRDSEFfVkVSSUZJRVJfVFlQRTtcclxuICAgICAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMud2lkZ2V0SWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudG9rZW5DaGFuZ2VMaXN0ZW5lcnMgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJQcm9taXNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnJlY2FwdGNoYSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gX2Nhc3RBdXRoKGF1dGhFeHRlcm4pO1xyXG4gICAgICAgIHRoaXMuaXNJbnZpc2libGUgPSB0aGlzLnBhcmFtZXRlcnMuc2l6ZSA9PT0gJ2ludmlzaWJsZSc7XHJcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnLCB0aGlzLmF1dGgsIFwib3BlcmF0aW9uLW5vdC1zdXBwb3J0ZWQtaW4tdGhpcy1lbnZpcm9ubWVudFwiIC8qIEF1dGhFcnJvckNvZGUuT1BFUkFUSU9OX05PVF9TVVBQT1JURUQgKi8pO1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IHR5cGVvZiBjb250YWluZXJPcklkID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lck9ySWQpXHJcbiAgICAgICAgICAgIDogY29udGFpbmVyT3JJZDtcclxuICAgICAgICBfYXNzZXJ0KGNvbnRhaW5lciwgdGhpcy5hdXRoLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLmNhbGxiYWNrID0gdGhpcy5tYWtlVG9rZW5DYWxsYmFjayh0aGlzLnBhcmFtZXRlcnMuY2FsbGJhY2spO1xyXG4gICAgICAgIHRoaXMuX3JlY2FwdGNoYUxvYWRlciA9IHRoaXMuYXV0aC5zZXR0aW5ncy5hcHBWZXJpZmljYXRpb25EaXNhYmxlZEZvclRlc3RpbmdcclxuICAgICAgICAgICAgPyBuZXcgTW9ja1JlQ2FwdGNoYUxvYWRlckltcGwoKVxyXG4gICAgICAgICAgICA6IG5ldyBSZUNhcHRjaGFMb2FkZXJJbXBsKCk7XHJcbiAgICAgICAgdGhpcy52YWxpZGF0ZVN0YXJ0aW5nU3RhdGUoKTtcclxuICAgICAgICAvLyBUT0RPOiBGaWd1cmUgb3V0IGlmIHNkayB2ZXJzaW9uIGlzIG5lZWRlZFxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBXYWl0cyBmb3IgdGhlIHVzZXIgdG8gc29sdmUgdGhlIHJlQ0FQVENIQSBhbmQgcmVzb2x2ZXMgd2l0aCB0aGUgcmVDQVBUQ0hBIHRva2VuLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIEEgUHJvbWlzZSBmb3IgdGhlIHJlQ0FQVENIQSB0b2tlbi5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgdmVyaWZ5KCkge1xyXG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90RGVzdHJveWVkKCk7XHJcbiAgICAgICAgY29uc3QgaWQgPSBhd2FpdCB0aGlzLnJlbmRlcigpO1xyXG4gICAgICAgIGNvbnN0IHJlY2FwdGNoYSA9IHRoaXMuZ2V0QXNzZXJ0ZWRSZWNhcHRjaGEoKTtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IHJlY2FwdGNoYS5nZXRSZXNwb25zZShpZCk7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0b2tlbkNoYW5nZSA9ICh0b2tlbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0b2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gSWdub3JlIHRva2VuIGV4cGlyYXRpb25zLlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy50b2tlbkNoYW5nZUxpc3RlbmVycy5kZWxldGUodG9rZW5DaGFuZ2UpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0b2tlbik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMudG9rZW5DaGFuZ2VMaXN0ZW5lcnMuYWRkKHRva2VuQ2hhbmdlKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNJbnZpc2libGUpIHtcclxuICAgICAgICAgICAgICAgIHJlY2FwdGNoYS5leGVjdXRlKGlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW5kZXJzIHRoZSByZUNBUFRDSEEgd2lkZ2V0IG9uIHRoZSBwYWdlLlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggdGhlIHJlQ0FQVENIQSB3aWRnZXQgSUQuXHJcbiAgICAgKi9cclxuICAgIHJlbmRlcigpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB0aGlzLmFzc2VydE5vdERlc3Ryb3llZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAvLyBUaGlzIG1ldGhvZCByZXR1cm5zIGEgcHJvbWlzZS4gU2luY2UgaXQncyBub3QgYXN5bmMgKHdlIHdhbnQgdG8gcmV0dXJuIHRoZVxyXG4gICAgICAgICAgICAvLyBfc2FtZV8gcHJvbWlzZSBpZiByZW5kZXJpbmcgaXMgc3RpbGwgb2NjdXJyaW5nKSwgdGhlIEFQSSBzdXJmYWNlIHNob3VsZFxyXG4gICAgICAgICAgICAvLyByZWplY3Qgd2l0aCB0aGUgZXJyb3IgcmF0aGVyIHRoYW4ganVzdCB0aHJvd1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnJlbmRlclByb21pc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyUHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZW5kZXJQcm9taXNlID0gdGhpcy5tYWtlUmVuZGVyUHJvbWlzZSgpLmNhdGNoKGUgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclByb21pc2UgPSBudWxsO1xyXG4gICAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlbmRlclByb21pc2U7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfcmVzZXQoKSB7XHJcbiAgICAgICAgdGhpcy5hc3NlcnROb3REZXN0cm95ZWQoKTtcclxuICAgICAgICBpZiAodGhpcy53aWRnZXRJZCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmdldEFzc2VydGVkUmVjYXB0Y2hhKCkucmVzZXQodGhpcy53aWRnZXRJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhcnMgdGhlIHJlQ0FQVENIQSB3aWRnZXQgZnJvbSB0aGUgcGFnZSBhbmQgZGVzdHJveXMgdGhlIGluc3RhbmNlLlxyXG4gICAgICovXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLmFzc2VydE5vdERlc3Ryb3llZCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveWVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9yZWNhcHRjaGFMb2FkZXIuY2xlYXJlZE9uZUluc3RhbmNlKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzSW52aXNpYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNoaWxkTm9kZXMuZm9yRWFjaChub2RlID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKG5vZGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB2YWxpZGF0ZVN0YXJ0aW5nU3RhdGUoKSB7XHJcbiAgICAgICAgX2Fzc2VydCghdGhpcy5wYXJhbWV0ZXJzLnNpdGVrZXksIHRoaXMuYXV0aCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIF9hc3NlcnQodGhpcy5pc0ludmlzaWJsZSB8fCAhdGhpcy5jb250YWluZXIuaGFzQ2hpbGROb2RlcygpLCB0aGlzLmF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBfYXNzZXJ0KHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcsIHRoaXMuYXV0aCwgXCJvcGVyYXRpb24tbm90LXN1cHBvcnRlZC1pbi10aGlzLWVudmlyb25tZW50XCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX1NVUFBPUlRFRCAqLyk7XHJcbiAgICB9XHJcbiAgICBtYWtlVG9rZW5DYWxsYmFjayhleGlzdGluZykge1xyXG4gICAgICAgIHJldHVybiB0b2tlbiA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudG9rZW5DaGFuZ2VMaXN0ZW5lcnMuZm9yRWFjaChsaXN0ZW5lciA9PiBsaXN0ZW5lcih0b2tlbikpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGV4aXN0aW5nID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBleGlzdGluZyh0b2tlbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGV4aXN0aW5nID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ2xvYmFsRnVuYyA9IF93aW5kb3coKVtleGlzdGluZ107XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGdsb2JhbEZ1bmMgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBnbG9iYWxGdW5jKHRva2VuKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBhc3NlcnROb3REZXN0cm95ZWQoKSB7XHJcbiAgICAgICAgX2Fzc2VydCghdGhpcy5kZXN0cm95ZWQsIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgbWFrZVJlbmRlclByb21pc2UoKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLndpZGdldElkKSB7XHJcbiAgICAgICAgICAgIGxldCBjb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcjtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzSW52aXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBndWFyYW50ZWVkRW1wdHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChndWFyYW50ZWVkRW1wdHkpO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gZ3VhcmFudGVlZEVtcHR5O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0SWQgPSB0aGlzLmdldEFzc2VydGVkUmVjYXB0Y2hhKCkucmVuZGVyKGNvbnRhaW5lciwgdGhpcy5wYXJhbWV0ZXJzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMud2lkZ2V0SWQ7XHJcbiAgICB9XHJcbiAgICBhc3luYyBpbml0KCkge1xyXG4gICAgICAgIF9hc3NlcnQoX2lzSHR0cE9ySHR0cHMoKSAmJiAhX2lzV29ya2VyKCksIHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIGF3YWl0IGRvbVJlYWR5KCk7XHJcbiAgICAgICAgdGhpcy5yZWNhcHRjaGEgPSBhd2FpdCB0aGlzLl9yZWNhcHRjaGFMb2FkZXIubG9hZCh0aGlzLmF1dGgsIHRoaXMuYXV0aC5sYW5ndWFnZUNvZGUgfHwgdW5kZWZpbmVkKTtcclxuICAgICAgICBjb25zdCBzaXRlS2V5ID0gYXdhaXQgZ2V0UmVjYXB0Y2hhUGFyYW1zKHRoaXMuYXV0aCk7XHJcbiAgICAgICAgX2Fzc2VydChzaXRlS2V5LCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICB0aGlzLnBhcmFtZXRlcnMuc2l0ZWtleSA9IHNpdGVLZXk7XHJcbiAgICB9XHJcbiAgICBnZXRBc3NlcnRlZFJlY2FwdGNoYSgpIHtcclxuICAgICAgICBfYXNzZXJ0KHRoaXMucmVjYXB0Y2hhLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWNhcHRjaGE7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZG9tUmVhZHkoKSB7XHJcbiAgICBsZXQgcmVzb2x2ZXIgPSBudWxsO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7XHJcbiAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBEb2N1bWVudCBub3QgcmVhZHksIHdhaXQgZm9yIGxvYWQgYmVmb3JlIHJlc29sdmluZy5cclxuICAgICAgICAvLyBTYXZlIHJlc29sdmVyLCBzbyB3ZSBjYW4gcmVtb3ZlIGxpc3RlbmVyIGluIGNhc2UgaXQgd2FzIGV4dGVybmFsbHlcclxuICAgICAgICAvLyBjYW5jZWxsZWQuXHJcbiAgICAgICAgcmVzb2x2ZXIgPSAoKSA9PiByZXNvbHZlKCk7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCByZXNvbHZlcik7XHJcbiAgICB9KS5jYXRjaChlID0+IHtcclxuICAgICAgICBpZiAocmVzb2x2ZXIpIHtcclxuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2xvYWQnLCByZXNvbHZlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBDb25maXJtYXRpb25SZXN1bHRJbXBsIHtcclxuICAgIGNvbnN0cnVjdG9yKHZlcmlmaWNhdGlvbklkLCBvbkNvbmZpcm1hdGlvbikge1xyXG4gICAgICAgIHRoaXMudmVyaWZpY2F0aW9uSWQgPSB2ZXJpZmljYXRpb25JZDtcclxuICAgICAgICB0aGlzLm9uQ29uZmlybWF0aW9uID0gb25Db25maXJtYXRpb247XHJcbiAgICB9XHJcbiAgICBjb25maXJtKHZlcmlmaWNhdGlvbkNvZGUpIHtcclxuICAgICAgICBjb25zdCBhdXRoQ3JlZGVudGlhbCA9IFBob25lQXV0aENyZWRlbnRpYWwuX2Zyb21WZXJpZmljYXRpb24odGhpcy52ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub25Db25maXJtYXRpb24oYXV0aENyZWRlbnRpYWwpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiB1c2luZyBhIHBob25lIG51bWJlci5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVGhpcyBtZXRob2Qgc2VuZHMgYSBjb2RlIHZpYSBTTVMgdG8gdGhlIGdpdmVuXHJcbiAqIHBob25lIG51bWJlciwgYW5kIHJldHVybnMgYSB7QGxpbmsgQ29uZmlybWF0aW9uUmVzdWx0fS4gQWZ0ZXIgdGhlIHVzZXJcclxuICogcHJvdmlkZXMgdGhlIGNvZGUgc2VudCB0byB0aGVpciBwaG9uZSwgY2FsbCB7QGxpbmsgQ29uZmlybWF0aW9uUmVzdWx0LmNvbmZpcm19XHJcbiAqIHdpdGggdGhlIGNvZGUgdG8gc2lnbiB0aGUgdXNlciBpbi5cclxuICpcclxuICogRm9yIGFidXNlIHByZXZlbnRpb24sIHRoaXMgbWV0aG9kIGFsc28gcmVxdWlyZXMgYSB7QGxpbmsgQXBwbGljYXRpb25WZXJpZmllcn0uXHJcbiAqIFRoaXMgU0RLIGluY2x1ZGVzIGEgcmVDQVBUQ0hBLWJhc2VkIGltcGxlbWVudGF0aW9uLCB7QGxpbmsgUmVjYXB0Y2hhVmVyaWZpZXJ9LlxyXG4gKiBUaGlzIGZ1bmN0aW9uIGNhbiB3b3JrIG9uIG90aGVyIHBsYXRmb3JtcyB0aGF0IGRvIG5vdCBzdXBwb3J0IHRoZVxyXG4gKiB7QGxpbmsgUmVjYXB0Y2hhVmVyaWZpZXJ9IChsaWtlIFJlYWN0IE5hdGl2ZSksIGJ1dCB5b3UgbmVlZCB0byB1c2UgYVxyXG4gKiB0aGlyZC1wYXJ0eSB7QGxpbmsgQXBwbGljYXRpb25WZXJpZmllcn0gaW1wbGVtZW50YXRpb24uXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gJ3JlY2FwdGNoYS1jb250YWluZXInIGlzIHRoZSBJRCBvZiBhbiBlbGVtZW50IGluIHRoZSBET00uXHJcbiAqIGNvbnN0IGFwcGxpY2F0aW9uVmVyaWZpZXIgPSBuZXcgZmlyZWJhc2UuYXV0aC5SZWNhcHRjaGFWZXJpZmllcigncmVjYXB0Y2hhLWNvbnRhaW5lcicpO1xyXG4gKiBjb25zdCBjb25maXJtYXRpb25SZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUGhvbmVOdW1iZXIoYXV0aCwgcGhvbmVOdW1iZXIsIGFwcGxpY2F0aW9uVmVyaWZpZXIpO1xyXG4gKiAvLyBPYnRhaW4gYSB2ZXJpZmljYXRpb25Db2RlIGZyb20gdGhlIHVzZXIuXHJcbiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBhd2FpdCBjb25maXJtYXRpb25SZXN1bHQuY29uZmlybSh2ZXJpZmljYXRpb25Db2RlKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cclxuICogQHBhcmFtIHBob25lTnVtYmVyIC0gVGhlIHVzZXIncyBwaG9uZSBudW1iZXIgaW4gRS4xNjQgZm9ybWF0IChlLmcuICsxNjUwNTU1MDEwMSkuXHJcbiAqIEBwYXJhbSBhcHBWZXJpZmllciAtIFRoZSB7QGxpbmsgQXBwbGljYXRpb25WZXJpZmllcn0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhQaG9uZU51bWJlcihhdXRoLCBwaG9uZU51bWJlciwgYXBwVmVyaWZpZXIpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIGNvbnN0IHZlcmlmaWNhdGlvbklkID0gYXdhaXQgX3ZlcmlmeVBob25lTnVtYmVyKGF1dGhJbnRlcm5hbCwgcGhvbmVOdW1iZXIsIGdldE1vZHVsYXJJbnN0YW5jZShhcHBWZXJpZmllcikpO1xyXG4gICAgcmV0dXJuIG5ldyBDb25maXJtYXRpb25SZXN1bHRJbXBsKHZlcmlmaWNhdGlvbklkLCBjcmVkID0+IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGhJbnRlcm5hbCwgY3JlZCkpO1xyXG59XHJcbi8qKlxyXG4gKiBMaW5rcyB0aGUgdXNlciBhY2NvdW50IHdpdGggdGhlIGdpdmVuIHBob25lIG51bWJlci5cclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIHBob25lTnVtYmVyIC0gVGhlIHVzZXIncyBwaG9uZSBudW1iZXIgaW4gRS4xNjQgZm9ybWF0IChlLmcuICsxNjUwNTU1MDEwMSkuXHJcbiAqIEBwYXJhbSBhcHBWZXJpZmllciAtIFRoZSB7QGxpbmsgQXBwbGljYXRpb25WZXJpZmllcn0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGxpbmtXaXRoUGhvbmVOdW1iZXIodXNlciwgcGhvbmVOdW1iZXIsIGFwcFZlcmlmaWVyKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBhd2FpdCBfYXNzZXJ0TGlua2VkU3RhdHVzKGZhbHNlLCB1c2VySW50ZXJuYWwsIFwicGhvbmVcIiAvKiBQcm92aWRlcklkLlBIT05FICovKTtcclxuICAgIGNvbnN0IHZlcmlmaWNhdGlvbklkID0gYXdhaXQgX3ZlcmlmeVBob25lTnVtYmVyKHVzZXJJbnRlcm5hbC5hdXRoLCBwaG9uZU51bWJlciwgZ2V0TW9kdWxhckluc3RhbmNlKGFwcFZlcmlmaWVyKSk7XHJcbiAgICByZXR1cm4gbmV3IENvbmZpcm1hdGlvblJlc3VsdEltcGwodmVyaWZpY2F0aW9uSWQsIGNyZWQgPT4gbGlua1dpdGhDcmVkZW50aWFsKHVzZXJJbnRlcm5hbCwgY3JlZCkpO1xyXG59XHJcbi8qKlxyXG4gKiBSZS1hdXRoZW50aWNhdGVzIGEgdXNlciB1c2luZyBhIGZyZXNoIHBob25lIGNyZWRlbnRpYWwuXHJcbiAqXHJcbiAqIEByZW1hcmtzIFVzZSBiZWZvcmUgb3BlcmF0aW9ucyBzdWNoIGFzIHtAbGluayB1cGRhdGVQYXNzd29yZH0gdGhhdCByZXF1aXJlIHRva2VucyBmcm9tIHJlY2VudCBzaWduLWluIGF0dGVtcHRzLlxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gcGhvbmVOdW1iZXIgLSBUaGUgdXNlcidzIHBob25lIG51bWJlciBpbiBFLjE2NCBmb3JtYXQgKGUuZy4gKzE2NTA1NTUwMTAxKS5cclxuICogQHBhcmFtIGFwcFZlcmlmaWVyIC0gVGhlIHtAbGluayBBcHBsaWNhdGlvblZlcmlmaWVyfS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcmVhdXRoZW50aWNhdGVXaXRoUGhvbmVOdW1iZXIodXNlciwgcGhvbmVOdW1iZXIsIGFwcFZlcmlmaWVyKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBjb25zdCB2ZXJpZmljYXRpb25JZCA9IGF3YWl0IF92ZXJpZnlQaG9uZU51bWJlcih1c2VySW50ZXJuYWwuYXV0aCwgcGhvbmVOdW1iZXIsIGdldE1vZHVsYXJJbnN0YW5jZShhcHBWZXJpZmllcikpO1xyXG4gICAgcmV0dXJuIG5ldyBDb25maXJtYXRpb25SZXN1bHRJbXBsKHZlcmlmaWNhdGlvbklkLCBjcmVkID0+IHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwodXNlckludGVybmFsLCBjcmVkKSk7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgYSB2ZXJpZmljYXRpb24gSUQgdG8gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIHRoZSBTTVMgY29kZSB0aGF0IGlzIHNlbnQuXHJcbiAqXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBfdmVyaWZ5UGhvbmVOdW1iZXIoYXV0aCwgb3B0aW9ucywgdmVyaWZpZXIpIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IHJlY2FwdGNoYVRva2VuID0gYXdhaXQgdmVyaWZpZXIudmVyaWZ5KCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIF9hc3NlcnQodHlwZW9mIHJlY2FwdGNoYVRva2VuID09PSAnc3RyaW5nJywgYXV0aCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xyXG4gICAgICAgIF9hc3NlcnQodmVyaWZpZXIudHlwZSA9PT0gUkVDQVBUQ0hBX1ZFUklGSUVSX1RZUEUsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgICAgICBsZXQgcGhvbmVJbmZvT3B0aW9ucztcclxuICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHBob25lSW5mb09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBwaG9uZU51bWJlcjogb3B0aW9uc1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcGhvbmVJbmZvT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgnc2Vzc2lvbicgaW4gcGhvbmVJbmZvT3B0aW9ucykge1xyXG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gcGhvbmVJbmZvT3B0aW9ucy5zZXNzaW9uO1xyXG4gICAgICAgICAgICBpZiAoJ3Bob25lTnVtYmVyJyBpbiBwaG9uZUluZm9PcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBfYXNzZXJ0KHNlc3Npb24udHlwZSA9PT0gXCJlbnJvbGxcIiAvKiBNdWx0aUZhY3RvclNlc3Npb25UeXBlLkVOUk9MTCAqLywgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdGFydEVucm9sbFBob25lTWZhKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuOiBzZXNzaW9uLmNyZWRlbnRpYWwsXHJcbiAgICAgICAgICAgICAgICAgICAgcGhvbmVFbnJvbGxtZW50SW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaG9uZU51bWJlcjogcGhvbmVJbmZvT3B0aW9ucy5waG9uZU51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjYXB0Y2hhVG9rZW5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5waG9uZVNlc3Npb25JbmZvLnNlc3Npb25JbmZvO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgX2Fzc2VydChzZXNzaW9uLnR5cGUgPT09IFwic2lnbmluXCIgLyogTXVsdGlGYWN0b3JTZXNzaW9uVHlwZS5TSUdOX0lOICovLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtZmFFbnJvbGxtZW50SWQgPSAoKF9hID0gcGhvbmVJbmZvT3B0aW9ucy5tdWx0aUZhY3RvckhpbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgcGhvbmVJbmZvT3B0aW9ucy5tdWx0aUZhY3RvclVpZDtcclxuICAgICAgICAgICAgICAgIF9hc3NlcnQobWZhRW5yb2xsbWVudElkLCBhdXRoLCBcIm1pc3NpbmctbXVsdGktZmFjdG9yLWluZm9cIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfTUZBX0lORk8gKi8pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdGFydFNpZ25JblBob25lTWZhKGF1dGgsIHtcclxuICAgICAgICAgICAgICAgICAgICBtZmFQZW5kaW5nQ3JlZGVudGlhbDogc2Vzc2lvbi5jcmVkZW50aWFsLFxyXG4gICAgICAgICAgICAgICAgICAgIG1mYUVucm9sbG1lbnRJZCxcclxuICAgICAgICAgICAgICAgICAgICBwaG9uZVNpZ25JbkluZm86IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVjYXB0Y2hhVG9rZW5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5waG9uZVJlc3BvbnNlSW5mby5zZXNzaW9uSW5mbztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgeyBzZXNzaW9uSW5mbyB9ID0gYXdhaXQgc2VuZFBob25lVmVyaWZpY2F0aW9uQ29kZShhdXRoLCB7XHJcbiAgICAgICAgICAgICAgICBwaG9uZU51bWJlcjogcGhvbmVJbmZvT3B0aW9ucy5waG9uZU51bWJlcixcclxuICAgICAgICAgICAgICAgIHJlY2FwdGNoYVRva2VuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gc2Vzc2lvbkluZm87XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdmVyaWZpZXIuX3Jlc2V0KCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFVwZGF0ZXMgdGhlIHVzZXIncyBwaG9uZSBudW1iZXIuXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYFxyXG4gKiAvLyAncmVjYXB0Y2hhLWNvbnRhaW5lcicgaXMgdGhlIElEIG9mIGFuIGVsZW1lbnQgaW4gdGhlIERPTS5cclxuICogY29uc3QgYXBwbGljYXRpb25WZXJpZmllciA9IG5ldyBSZWNhcHRjaGFWZXJpZmllcigncmVjYXB0Y2hhLWNvbnRhaW5lcicpO1xyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBQaG9uZUF1dGhQcm92aWRlcihhdXRoKTtcclxuICogY29uc3QgdmVyaWZpY2F0aW9uSWQgPSBhd2FpdCBwcm92aWRlci52ZXJpZnlQaG9uZU51bWJlcignKzE2NTA1NTUwMTAxJywgYXBwbGljYXRpb25WZXJpZmllcik7XHJcbiAqIC8vIE9idGFpbiB0aGUgdmVyaWZpY2F0aW9uQ29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gKiBjb25zdCBwaG9uZUNyZWRlbnRpYWwgPSBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlKTtcclxuICogYXdhaXQgdXBkYXRlUGhvbmVOdW1iZXIodXNlciwgcGhvbmVDcmVkZW50aWFsKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBjcmVkZW50aWFsIC0gQSBjcmVkZW50aWFsIGF1dGhlbnRpY2F0aW5nIHRoZSBuZXcgcGhvbmUgbnVtYmVyLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVQaG9uZU51bWJlcih1c2VyLCBjcmVkZW50aWFsKSB7XHJcbiAgICBhd2FpdCBfbGluayQxKGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKSwgY3JlZGVudGlhbCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGFuIHtAbGluayBQaG9uZUF1dGhDcmVkZW50aWFsfS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyAncmVjYXB0Y2hhLWNvbnRhaW5lcicgaXMgdGhlIElEIG9mIGFuIGVsZW1lbnQgaW4gdGhlIERPTS5cclxuICogY29uc3QgYXBwbGljYXRpb25WZXJpZmllciA9IG5ldyBSZWNhcHRjaGFWZXJpZmllcigncmVjYXB0Y2hhLWNvbnRhaW5lcicpO1xyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBQaG9uZUF1dGhQcm92aWRlcihhdXRoKTtcclxuICogY29uc3QgdmVyaWZpY2F0aW9uSWQgPSBhd2FpdCBwcm92aWRlci52ZXJpZnlQaG9uZU51bWJlcignKzE2NTA1NTUwMTAxJywgYXBwbGljYXRpb25WZXJpZmllcik7XHJcbiAqIC8vIE9idGFpbiB0aGUgdmVyaWZpY2F0aW9uQ29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gKiBjb25zdCBwaG9uZUNyZWRlbnRpYWwgPSBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlKTtcclxuICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChhdXRoLCBwaG9uZUNyZWRlbnRpYWwpO1xyXG4gKiBgYGBcclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgUGhvbmVBdXRoUHJvdmlkZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gYXV0aCAtIFRoZSBGaXJlYmFzZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgaW4gd2hpY2ggc2lnbi1pbnMgc2hvdWxkIG9jY3VyLlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xyXG4gICAgICAgIC8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5QSE9ORS4gKi9cclxuICAgICAgICB0aGlzLnByb3ZpZGVySWQgPSBQaG9uZUF1dGhQcm92aWRlci5QUk9WSURFUl9JRDtcclxuICAgICAgICB0aGlzLmF1dGggPSBfY2FzdEF1dGgoYXV0aCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBTdGFydHMgYSBwaG9uZSBudW1iZXIgYXV0aGVudGljYXRpb24gZmxvdyBieSBzZW5kaW5nIGEgdmVyaWZpY2F0aW9uIGNvZGUgdG8gdGhlIGdpdmVuIHBob25lXHJcbiAgICAgKiBudW1iZXIuXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IFBob25lQXV0aFByb3ZpZGVyKGF1dGgpO1xyXG4gICAgICogY29uc3QgdmVyaWZpY2F0aW9uSWQgPSBhd2FpdCBwcm92aWRlci52ZXJpZnlQaG9uZU51bWJlcihwaG9uZU51bWJlciwgYXBwbGljYXRpb25WZXJpZmllcik7XHJcbiAgICAgKiAvLyBPYnRhaW4gdmVyaWZpY2F0aW9uQ29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gICAgICogY29uc3QgYXV0aENyZWRlbnRpYWwgPSBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlKTtcclxuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgYXV0aENyZWRlbnRpYWwpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQGV4YW1wbGVcclxuICAgICAqIEFuIGFsdGVybmF0aXZlIGZsb3cgaXMgcHJvdmlkZWQgdXNpbmcgdGhlIGBzaWduSW5XaXRoUGhvbmVOdW1iZXJgIG1ldGhvZC5cclxuICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAqIGNvbnN0IGNvbmZpcm1hdGlvblJlc3VsdCA9IHNpZ25JbldpdGhQaG9uZU51bWJlcihhdXRoLCBwaG9uZU51bWJlciwgYXBwbGljYXRpb25WZXJpZmllcik7XHJcbiAgICAgKiAvLyBPYnRhaW4gdmVyaWZpY2F0aW9uQ29kZSBmcm9tIHRoZSB1c2VyLlxyXG4gICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBjb25maXJtYXRpb25SZXN1bHQuY29uZmlybSh2ZXJpZmljYXRpb25Db2RlKTtcclxuICAgICAqIGBgYFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwaG9uZUluZm9PcHRpb25zIC0gVGhlIHVzZXIncyB7QGxpbmsgUGhvbmVJbmZvT3B0aW9uc30uIFRoZSBwaG9uZSBudW1iZXIgc2hvdWxkIGJlIGluXHJcbiAgICAgKiBFLjE2NCBmb3JtYXQgKGUuZy4gKzE2NTA1NTUwMTAxKS5cclxuICAgICAqIEBwYXJhbSBhcHBsaWNhdGlvblZlcmlmaWVyIC0gRm9yIGFidXNlIHByZXZlbnRpb24sIHRoaXMgbWV0aG9kIGFsc28gcmVxdWlyZXMgYVxyXG4gICAgICoge0BsaW5rIEFwcGxpY2F0aW9uVmVyaWZpZXJ9LiBUaGlzIFNESyBpbmNsdWRlcyBhIHJlQ0FQVENIQS1iYXNlZCBpbXBsZW1lbnRhdGlvbixcclxuICAgICAqIHtAbGluayBSZWNhcHRjaGFWZXJpZmllcn0uXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMgQSBQcm9taXNlIGZvciBhIHZlcmlmaWNhdGlvbiBJRCB0aGF0IGNhbiBiZSBwYXNzZWQgdG9cclxuICAgICAqIHtAbGluayBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsfSB0byBpZGVudGlmeSB0aGlzIGZsb3cuLlxyXG4gICAgICovXHJcbiAgICB2ZXJpZnlQaG9uZU51bWJlcihwaG9uZU9wdGlvbnMsIGFwcGxpY2F0aW9uVmVyaWZpZXIpIHtcclxuICAgICAgICByZXR1cm4gX3ZlcmlmeVBob25lTnVtYmVyKHRoaXMuYXV0aCwgcGhvbmVPcHRpb25zLCBnZXRNb2R1bGFySW5zdGFuY2UoYXBwbGljYXRpb25WZXJpZmllcikpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgcGhvbmUgYXV0aCBjcmVkZW50aWFsLCBnaXZlbiB0aGUgdmVyaWZpY2F0aW9uIElEIGZyb21cclxuICAgICAqIHtAbGluayBQaG9uZUF1dGhQcm92aWRlci52ZXJpZnlQaG9uZU51bWJlcn0gYW5kIHRoZSBjb2RlIHRoYXQgd2FzIHNlbnQgdG8gdGhlIHVzZXInc1xyXG4gICAgICogbW9iaWxlIGRldmljZS5cclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogY29uc3QgcHJvdmlkZXIgPSBuZXcgUGhvbmVBdXRoUHJvdmlkZXIoYXV0aCk7XHJcbiAgICAgKiBjb25zdCB2ZXJpZmljYXRpb25JZCA9IHByb3ZpZGVyLnZlcmlmeVBob25lTnVtYmVyKHBob25lTnVtYmVyLCBhcHBsaWNhdGlvblZlcmlmaWVyKTtcclxuICAgICAqIC8vIE9idGFpbiB2ZXJpZmljYXRpb25Db2RlIGZyb20gdGhlIHVzZXIuXHJcbiAgICAgKiBjb25zdCBhdXRoQ3JlZGVudGlhbCA9IFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwodmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gICAgICogY29uc3QgdXNlckNyZWRlbnRpYWwgPSBzaWduSW5XaXRoQ3JlZGVudGlhbChhdXRoLCBhdXRoQ3JlZGVudGlhbCk7XHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAZXhhbXBsZVxyXG4gICAgICogQW4gYWx0ZXJuYXRpdmUgZmxvdyBpcyBwcm92aWRlZCB1c2luZyB0aGUgYHNpZ25JbldpdGhQaG9uZU51bWJlcmAgbWV0aG9kLlxyXG4gICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICogY29uc3QgY29uZmlybWF0aW9uUmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFBob25lTnVtYmVyKGF1dGgsIHBob25lTnVtYmVyLCBhcHBsaWNhdGlvblZlcmlmaWVyKTtcclxuICAgICAqIC8vIE9idGFpbiB2ZXJpZmljYXRpb25Db2RlIGZyb20gdGhlIHVzZXIuXHJcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IGNvbmZpcm1hdGlvblJlc3VsdC5jb25maXJtKHZlcmlmaWNhdGlvbkNvZGUpO1xyXG4gICAgICogYGBgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHZlcmlmaWNhdGlvbklkIC0gVGhlIHZlcmlmaWNhdGlvbiBJRCByZXR1cm5lZCBmcm9tIHtAbGluayBQaG9uZUF1dGhQcm92aWRlci52ZXJpZnlQaG9uZU51bWJlcn0uXHJcbiAgICAgKiBAcGFyYW0gdmVyaWZpY2F0aW9uQ29kZSAtIFRoZSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyJ3MgbW9iaWxlIGRldmljZS5cclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyBUaGUgYXV0aCBwcm92aWRlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbCh2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSkge1xyXG4gICAgICAgIHJldHVybiBQaG9uZUF1dGhDcmVkZW50aWFsLl9mcm9tVmVyaWZpY2F0aW9uKHZlcmlmaWNhdGlvbklkLCB2ZXJpZmljYXRpb25Db2RlKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2VuZXJhdGVzIGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uXHJcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHtcclxuICAgICAgICBjb25zdCBjcmVkZW50aWFsID0gdXNlckNyZWRlbnRpYWw7XHJcbiAgICAgICAgcmV0dXJuIFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KGNyZWRlbnRpYWwpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0gd2hlbiBwYXNzZWQgYW4gZXJyb3IuXHJcbiAgICAgKlxyXG4gICAgICogQHJlbWFya3NcclxuICAgICAqXHJcbiAgICAgKiBUaGlzIG1ldGhvZCB3b3JrcyBmb3IgZXJyb3JzIGxpa2VcclxuICAgICAqIGBhdXRoL2FjY291bnQtZXhpc3RzLXdpdGgtZGlmZmVyZW50LWNyZWRlbnRpYWxzYC4gVGhpcyBpcyB1c2VmdWwgZm9yXHJcbiAgICAgKiByZWNvdmVyaW5nIHdoZW4gYXR0ZW1wdGluZyB0byBzZXQgYSB1c2VyJ3MgcGhvbmUgbnVtYmVyIGJ1dCB0aGUgbnVtYmVyXHJcbiAgICAgKiBpbiBxdWVzdGlvbiBpcyBhbHJlYWR5IHRpZWQgdG8gYW5vdGhlciBhY2NvdW50LiBGb3IgZXhhbXBsZSwgdGhlIGZvbGxvd2luZ1xyXG4gICAgICogY29kZSB0cmllcyB0byB1cGRhdGUgdGhlIGN1cnJlbnQgdXNlcidzIHBob25lIG51bWJlciwgYW5kIGlmIHRoYXRcclxuICAgICAqIGZhaWxzLCBsaW5rcyB0aGUgdXNlciB3aXRoIHRoZSBhY2NvdW50IGFzc29jaWF0ZWQgd2l0aCB0aGF0IG51bWJlcjpcclxuICAgICAqXHJcbiAgICAgKiBgYGBqc1xyXG4gICAgICogY29uc3QgcHJvdmlkZXIgPSBuZXcgUGhvbmVBdXRoUHJvdmlkZXIoYXV0aCk7XHJcbiAgICAgKiBjb25zdCB2ZXJpZmljYXRpb25JZCA9IGF3YWl0IHByb3ZpZGVyLnZlcmlmeVBob25lTnVtYmVyKG51bWJlciwgdmVyaWZpZXIpO1xyXG4gICAgICogdHJ5IHtcclxuICAgICAqICAgY29uc3QgY29kZSA9ICcnOyAvLyBQcm9tcHQgdGhlIHVzZXIgZm9yIHRoZSB2ZXJpZmljYXRpb24gY29kZVxyXG4gICAgICogICBhd2FpdCB1cGRhdGVQaG9uZU51bWJlcihcclxuICAgICAqICAgICAgIGF1dGguY3VycmVudFVzZXIsXHJcbiAgICAgKiAgICAgICBQaG9uZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKHZlcmlmaWNhdGlvbklkLCBjb2RlKSk7XHJcbiAgICAgKiB9IGNhdGNoIChlKSB7XHJcbiAgICAgKiAgIGlmICgoZSBhcyBGaXJlYmFzZUVycm9yKT8uY29kZSA9PT0gJ2F1dGgvYWNjb3VudC1leGlzdHMtd2l0aC1kaWZmZXJlbnQtY3JlZGVudGlhbCcpIHtcclxuICAgICAqICAgICBjb25zdCBjcmVkID0gUGhvbmVBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21FcnJvcihlKTtcclxuICAgICAqICAgICBhd2FpdCBsaW5rV2l0aENyZWRlbnRpYWwoYXV0aC5jdXJyZW50VXNlciwgY3JlZCk7XHJcbiAgICAgKiAgIH1cclxuICAgICAqIH1cclxuICAgICAqXHJcbiAgICAgKiAvLyBBdCB0aGlzIHBvaW50LCBhdXRoLmN1cnJlbnRVc2VyLnBob25lTnVtYmVyID09PSBudW1iZXIuXHJcbiAgICAgKiBgYGBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZXJyb3IgLSBUaGUgZXJyb3IgdG8gZ2VuZXJhdGUgYSBjcmVkZW50aWFsIGZyb20uXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XHJcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB7IHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZiB9ID0gdG9rZW5SZXNwb25zZTtcclxuICAgICAgICBpZiAocGhvbmVOdW1iZXIgJiYgdGVtcG9yYXJ5UHJvb2YpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFBob25lQXV0aENyZWRlbnRpYWwuX2Zyb21Ub2tlblJlc3BvbnNlKHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG59XHJcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5QSE9ORS4gKi9cclxuUGhvbmVBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSBcInBob25lXCIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLztcclxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uUEhPTkUuICovXHJcblBob25lQXV0aFByb3ZpZGVyLlBIT05FX1NJR05fSU5fTUVUSE9EID0gXCJwaG9uZVwiIC8qIFNpZ25Jbk1ldGhvZC5QSE9ORSAqLztcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIENob29zZXMgYSBwb3B1cC9yZWRpcmVjdCByZXNvbHZlciB0byB1c2UuIFRoaXMgcHJlZmVycyB0aGUgb3ZlcnJpZGUgKHdoaWNoXHJcbiAqIGlzIGRpcmVjdGx5IHBhc3NlZCBpbiksIGFuZCBmYWxscyBiYWNrIHRvIHRoZSBwcm9wZXJ0eSBzZXQgb24gdGhlIGF1dGhcclxuICogb2JqZWN0LiBJZiBuZWl0aGVyIGFyZSBhdmFpbGFibGUsIHRoaXMgZnVuY3Rpb24gZXJyb3JzIHcvIGFuIGFyZ3VtZW50IGVycm9yLlxyXG4gKi9cclxuZnVuY3Rpb24gX3dpdGhEZWZhdWx0UmVzb2x2ZXIoYXV0aCwgcmVzb2x2ZXJPdmVycmlkZSkge1xyXG4gICAgaWYgKHJlc29sdmVyT3ZlcnJpZGUpIHtcclxuICAgICAgICByZXR1cm4gX2dldEluc3RhbmNlKHJlc29sdmVyT3ZlcnJpZGUpO1xyXG4gICAgfVxyXG4gICAgX2Fzc2VydChhdXRoLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcclxuICAgIHJldHVybiBhdXRoLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXI7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgSWRwQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHtcclxuICAgIGNvbnN0cnVjdG9yKHBhcmFtcykge1xyXG4gICAgICAgIHN1cGVyKFwiY3VzdG9tXCIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi8sIFwiY3VzdG9tXCIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi8pO1xyXG4gICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xyXG4gICAgfVxyXG4gICAgX2dldElkVG9rZW5SZXNwb25zZShhdXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgdGhpcy5fYnVpbGRJZHBSZXF1ZXN0KCkpO1xyXG4gICAgfVxyXG4gICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHRoaXMuX2J1aWxkSWRwUmVxdWVzdChpZFRva2VuKSk7XHJcbiAgICB9XHJcbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcclxuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCB0aGlzLl9idWlsZElkcFJlcXVlc3QoKSk7XHJcbiAgICB9XHJcbiAgICBfYnVpbGRJZHBSZXF1ZXN0KGlkVG9rZW4pIHtcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICByZXF1ZXN0VXJpOiB0aGlzLnBhcmFtcy5yZXF1ZXN0VXJpLFxyXG4gICAgICAgICAgICBzZXNzaW9uSWQ6IHRoaXMucGFyYW1zLnNlc3Npb25JZCxcclxuICAgICAgICAgICAgcG9zdEJvZHk6IHRoaXMucGFyYW1zLnBvc3RCb2R5LFxyXG4gICAgICAgICAgICB0ZW5hbnRJZDogdGhpcy5wYXJhbXMudGVuYW50SWQsXHJcbiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wYXJhbXMucGVuZGluZ1Rva2VuLFxyXG4gICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZSxcclxuICAgICAgICAgICAgcmV0dXJuSWRwQ3JlZGVudGlhbDogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGlkVG9rZW4pIHtcclxuICAgICAgICAgICAgcmVxdWVzdC5pZFRva2VuID0gaWRUb2tlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gX3NpZ25JbihwYXJhbXMpIHtcclxuICAgIHJldHVybiBfc2lnbkluV2l0aENyZWRlbnRpYWwocGFyYW1zLmF1dGgsIG5ldyBJZHBDcmVkZW50aWFsKHBhcmFtcyksIHBhcmFtcy5ieXBhc3NBdXRoU3RhdGUpO1xyXG59XHJcbmZ1bmN0aW9uIF9yZWF1dGgocGFyYW1zKSB7XHJcbiAgICBjb25zdCB7IGF1dGgsIHVzZXIgfSA9IHBhcmFtcztcclxuICAgIF9hc3NlcnQodXNlciwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgcmV0dXJuIF9yZWF1dGhlbnRpY2F0ZSh1c2VyLCBuZXcgSWRwQ3JlZGVudGlhbChwYXJhbXMpLCBwYXJhbXMuYnlwYXNzQXV0aFN0YXRlKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfbGluayhwYXJhbXMpIHtcclxuICAgIGNvbnN0IHsgYXV0aCwgdXNlciB9ID0gcGFyYW1zO1xyXG4gICAgX2Fzc2VydCh1c2VyLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICByZXR1cm4gX2xpbmskMSh1c2VyLCBuZXcgSWRwQ3JlZGVudGlhbChwYXJhbXMpLCBwYXJhbXMuYnlwYXNzQXV0aFN0YXRlKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUG9wdXAgZXZlbnQgbWFuYWdlci4gSGFuZGxlcyB0aGUgcG9wdXAncyBlbnRpcmUgbGlmZWN5Y2xlOyBsaXN0ZW5zIHRvIGF1dGhcclxuICogZXZlbnRzXHJcbiAqL1xyXG5jbGFzcyBBYnN0cmFjdFBvcHVwUmVkaXJlY3RPcGVyYXRpb24ge1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCwgZmlsdGVyLCByZXNvbHZlciwgdXNlciwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xyXG4gICAgICAgIHRoaXMucmVzb2x2ZXIgPSByZXNvbHZlcjtcclxuICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIHRoaXMuYnlwYXNzQXV0aFN0YXRlID0gYnlwYXNzQXV0aFN0YXRlO1xyXG4gICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmZpbHRlciA9IEFycmF5LmlzQXJyYXkoZmlsdGVyKSA/IGZpbHRlciA6IFtmaWx0ZXJdO1xyXG4gICAgfVxyXG4gICAgZXhlY3V0ZSgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdQcm9taXNlID0geyByZXNvbHZlLCByZWplY3QgfTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gYXdhaXQgdGhpcy5yZXNvbHZlci5faW5pdGlhbGl6ZSh0aGlzLmF1dGgpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5vbkV4ZWN1dGlvbigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIucmVnaXN0ZXJDb25zdW1lcih0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZWplY3QoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGFzeW5jIG9uQXV0aEV2ZW50KGV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgeyB1cmxSZXNwb25zZSwgc2Vzc2lvbklkLCBwb3N0Qm9keSwgdGVuYW50SWQsIGVycm9yLCB0eXBlIH0gPSBldmVudDtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgICAgICAgYXV0aDogdGhpcy5hdXRoLFxyXG4gICAgICAgICAgICByZXF1ZXN0VXJpOiB1cmxSZXNwb25zZSxcclxuICAgICAgICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uSWQsXHJcbiAgICAgICAgICAgIHRlbmFudElkOiB0ZW5hbnRJZCB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHBvc3RCb2R5OiBwb3N0Qm9keSB8fCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgIHVzZXI6IHRoaXMudXNlcixcclxuICAgICAgICAgICAgYnlwYXNzQXV0aFN0YXRlOiB0aGlzLmJ5cGFzc0F1dGhTdGF0ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy5yZXNvbHZlKGF3YWl0IHRoaXMuZ2V0SWRwVGFzayh0eXBlKShwYXJhbXMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhpcy5yZWplY3QoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb25FcnJvcihlcnJvcikge1xyXG4gICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTtcclxuICAgIH1cclxuICAgIGdldElkcFRhc2sodHlwZSkge1xyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwic2lnbkluVmlhUG9wdXBcIiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1BPUFVQICovOlxyXG4gICAgICAgICAgICBjYXNlIFwic2lnbkluVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9zaWduSW47XHJcbiAgICAgICAgICAgIGNhc2UgXCJsaW5rVmlhUG9wdXBcIiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1BPUFVQICovOlxyXG4gICAgICAgICAgICBjYXNlIFwibGlua1ZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBfbGluaztcclxuICAgICAgICAgICAgY2FzZSBcInJlYXV0aFZpYVBvcHVwXCIgLyogQXV0aEV2ZW50VHlwZS5SRUFVVEhfVklBX1BPUFVQICovOlxyXG4gICAgICAgICAgICBjYXNlIFwicmVhdXRoVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUkVESVJFQ1QgKi86XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3JlYXV0aDtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIF9mYWlsKHRoaXMuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlc29sdmUoY3JlZCkge1xyXG4gICAgICAgIGRlYnVnQXNzZXJ0KHRoaXMucGVuZGluZ1Byb21pc2UsICdQZW5kaW5nIHByb21pc2Ugd2FzIG5ldmVyIHNldCcpO1xyXG4gICAgICAgIHRoaXMucGVuZGluZ1Byb21pc2UucmVzb2x2ZShjcmVkKTtcclxuICAgICAgICB0aGlzLnVucmVnaXN0ZXJBbmRDbGVhblVwKCk7XHJcbiAgICB9XHJcbiAgICByZWplY3QoZXJyb3IpIHtcclxuICAgICAgICBkZWJ1Z0Fzc2VydCh0aGlzLnBlbmRpbmdQcm9taXNlLCAnUGVuZGluZyBwcm9taXNlIHdhcyBuZXZlciBzZXQnKTtcclxuICAgICAgICB0aGlzLnBlbmRpbmdQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgdGhpcy51bnJlZ2lzdGVyQW5kQ2xlYW5VcCgpO1xyXG4gICAgfVxyXG4gICAgdW5yZWdpc3RlckFuZENsZWFuVXAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRNYW5hZ2VyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyLnVucmVnaXN0ZXJDb25zdW1lcih0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wZW5kaW5nUHJvbWlzZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jbGVhblVwKCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgX1BPTExfV0lORE9XX0NMT1NFX1RJTUVPVVQgPSBuZXcgRGVsYXkoMjAwMCwgMTAwMDApO1xyXG4vKipcclxuICogQXV0aGVudGljYXRlcyBhIEZpcmViYXNlIGNsaWVudCB1c2luZyBhIHBvcHVwLWJhc2VkIE9BdXRoIGF1dGhlbnRpY2F0aW9uIGZsb3cuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIElmIHN1Y2NlZWRzLCByZXR1cm5zIHRoZSBzaWduZWQgaW4gdXNlciBhbG9uZyB3aXRoIHRoZSBwcm92aWRlcidzIGNyZWRlbnRpYWwuIElmIHNpZ24gaW4gd2FzXHJcbiAqIHVuc3VjY2Vzc2Z1bCwgcmV0dXJucyBhbiBlcnJvciBvYmplY3QgY29udGFpbmluZyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBlcnJvci5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqXHJcbiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLlxyXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XHJcbiAqIC8vIFRoaXMgZ2l2ZXMgeW91IGEgRmFjZWJvb2sgQWNjZXNzIFRva2VuLlxyXG4gKiBjb25zdCBjcmVkZW50aWFsID0gcHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQoYXV0aCwgcmVzdWx0KTtcclxuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgLSBUaGUgcHJvdmlkZXIgdG8gYXV0aGVudGljYXRlLiBUaGUgcHJvdmlkZXIgaGFzIHRvIGJlIGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICogTm9uLU9BdXRoIHByb3ZpZGVycyBsaWtlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gd2lsbCB0aHJvdyBhbiBlcnJvci5cclxuICogQHBhcmFtIHJlc29sdmVyIC0gQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFBvcHVwUmVkaXJlY3RSZXNvbHZlcn0sIG9wdGlvbmFsXHJcbiAqIGlmIGFscmVhZHkgc3VwcGxpZWQgdG8ge0BsaW5rIGluaXRpYWxpemVBdXRofSBvciBwcm92aWRlZCBieSB7QGxpbmsgZ2V0QXV0aH0uXHJcbiAqXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlciwgcmVzb2x2ZXIpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIF9hc3NlcnRJbnN0YW5jZU9mKGF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgY29uc3QgcmVzb2x2ZXJJbnRlcm5hbCA9IF93aXRoRGVmYXVsdFJlc29sdmVyKGF1dGhJbnRlcm5hbCwgcmVzb2x2ZXIpO1xyXG4gICAgY29uc3QgYWN0aW9uID0gbmV3IFBvcHVwT3BlcmF0aW9uKGF1dGhJbnRlcm5hbCwgXCJzaWduSW5WaWFQb3B1cFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUE9QVVAgKi8sIHByb3ZpZGVyLCByZXNvbHZlckludGVybmFsKTtcclxuICAgIHJldHVybiBhY3Rpb24uZXhlY3V0ZU5vdE51bGwoKTtcclxufVxyXG4vKipcclxuICogUmVhdXRoZW50aWNhdGVzIHRoZSBjdXJyZW50IHVzZXIgd2l0aCB0aGUgc3BlY2lmaWVkIHtAbGluayBPQXV0aFByb3ZpZGVyfSB1c2luZyBhIHBvcC11cCBiYXNlZFxyXG4gKiBPQXV0aCBmbG93LlxyXG4gKlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBJZiB0aGUgcmVhdXRoZW50aWNhdGlvbiBpcyBzdWNjZXNzZnVsLCB0aGUgcmV0dXJuZWQgcmVzdWx0IHdpbGwgY29udGFpbiB0aGUgdXNlciBhbmQgdGhlXHJcbiAqIHByb3ZpZGVyJ3MgY3JlZGVudGlhbC5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XHJcbiAqIC8vIFJlYXV0aGVudGljYXRlIHVzaW5nIGEgcG9wdXAuXHJcbiAqIGF3YWl0IHJlYXV0aGVudGljYXRlV2l0aFBvcHVwKHJlc3VsdC51c2VyLCBwcm92aWRlcik7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgLSBUaGUgcHJvdmlkZXIgdG8gYXV0aGVudGljYXRlLiBUaGUgcHJvdmlkZXIgaGFzIHRvIGJlIGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICogTm9uLU9BdXRoIHByb3ZpZGVycyBsaWtlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gd2lsbCB0aHJvdyBhbiBlcnJvci5cclxuICogQHBhcmFtIHJlc29sdmVyIC0gQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFBvcHVwUmVkaXJlY3RSZXNvbHZlcn0sIG9wdGlvbmFsXHJcbiAqIGlmIGFscmVhZHkgc3VwcGxpZWQgdG8ge0BsaW5rIGluaXRpYWxpemVBdXRofSBvciBwcm92aWRlZCBieSB7QGxpbmsgZ2V0QXV0aH0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlYXV0aGVudGljYXRlV2l0aFBvcHVwKHVzZXIsIHByb3ZpZGVyLCByZXNvbHZlcikge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgX2Fzc2VydEluc3RhbmNlT2YodXNlckludGVybmFsLmF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgY29uc3QgcmVzb2x2ZXJJbnRlcm5hbCA9IF93aXRoRGVmYXVsdFJlc29sdmVyKHVzZXJJbnRlcm5hbC5hdXRoLCByZXNvbHZlcik7XHJcbiAgICBjb25zdCBhY3Rpb24gPSBuZXcgUG9wdXBPcGVyYXRpb24odXNlckludGVybmFsLmF1dGgsIFwicmVhdXRoVmlhUG9wdXBcIiAvKiBBdXRoRXZlbnRUeXBlLlJFQVVUSF9WSUFfUE9QVVAgKi8sIHByb3ZpZGVyLCByZXNvbHZlckludGVybmFsLCB1c2VySW50ZXJuYWwpO1xyXG4gICAgcmV0dXJuIGFjdGlvbi5leGVjdXRlTm90TnVsbCgpO1xyXG59XHJcbi8qKlxyXG4gKiBMaW5rcyB0aGUgYXV0aGVudGljYXRlZCBwcm92aWRlciB0byB0aGUgdXNlciBhY2NvdW50IHVzaW5nIGEgcG9wLXVwIGJhc2VkIE9BdXRoIGZsb3cuXHJcbiAqXHJcbiAqIEByZW1hcmtzXHJcbiAqIElmIHRoZSBsaW5raW5nIGlzIHN1Y2Nlc3NmdWwsIHRoZSByZXR1cm5lZCByZXN1bHQgd2lsbCBjb250YWluIHRoZSB1c2VyIGFuZCB0aGUgcHJvdmlkZXIncyBjcmVkZW50aWFsLlxyXG4gKlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgc29tZSBvdGhlciBwcm92aWRlci5cclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcclxuICogLy8gTGluayB1c2luZyBhIHBvcHVwLlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpO1xyXG4gKiBhd2FpdCBsaW5rV2l0aFBvcHVwKHJlc3VsdC51c2VyLCBwcm92aWRlcik7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgLSBUaGUgcHJvdmlkZXIgdG8gYXV0aGVudGljYXRlLiBUaGUgcHJvdmlkZXIgaGFzIHRvIGJlIGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICogTm9uLU9BdXRoIHByb3ZpZGVycyBsaWtlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gd2lsbCB0aHJvdyBhbiBlcnJvci5cclxuICogQHBhcmFtIHJlc29sdmVyIC0gQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFBvcHVwUmVkaXJlY3RSZXNvbHZlcn0sIG9wdGlvbmFsXHJcbiAqIGlmIGFscmVhZHkgc3VwcGxpZWQgdG8ge0BsaW5rIGluaXRpYWxpemVBdXRofSBvciBwcm92aWRlZCBieSB7QGxpbmsgZ2V0QXV0aH0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGxpbmtXaXRoUG9wdXAodXNlciwgcHJvdmlkZXIsIHJlc29sdmVyKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBfYXNzZXJ0SW5zdGFuY2VPZih1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIEZlZGVyYXRlZEF1dGhQcm92aWRlcik7XHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIodXNlckludGVybmFsLmF1dGgsIHJlc29sdmVyKTtcclxuICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBQb3B1cE9wZXJhdGlvbih1c2VySW50ZXJuYWwuYXV0aCwgXCJsaW5rVmlhUG9wdXBcIiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1BPUFVQICovLCBwcm92aWRlciwgcmVzb2x2ZXJJbnRlcm5hbCwgdXNlckludGVybmFsKTtcclxuICAgIHJldHVybiBhY3Rpb24uZXhlY3V0ZU5vdE51bGwoKTtcclxufVxyXG4vKipcclxuICogUG9wdXAgZXZlbnQgbWFuYWdlci4gSGFuZGxlcyB0aGUgcG9wdXAncyBlbnRpcmUgbGlmZWN5Y2xlOyBsaXN0ZW5zIHRvIGF1dGhcclxuICogZXZlbnRzXHJcbiAqXHJcbiAqL1xyXG5jbGFzcyBQb3B1cE9wZXJhdGlvbiBleHRlbmRzIEFic3RyYWN0UG9wdXBSZWRpcmVjdE9wZXJhdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoLCBmaWx0ZXIsIHByb3ZpZGVyLCByZXNvbHZlciwgdXNlcikge1xyXG4gICAgICAgIHN1cGVyKGF1dGgsIGZpbHRlciwgcmVzb2x2ZXIsIHVzZXIpO1xyXG4gICAgICAgIHRoaXMucHJvdmlkZXIgPSBwcm92aWRlcjtcclxuICAgICAgICB0aGlzLmF1dGhXaW5kb3cgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucG9sbElkID0gbnVsbDtcclxuICAgICAgICBpZiAoUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uKSB7XHJcbiAgICAgICAgICAgIFBvcHVwT3BlcmF0aW9uLmN1cnJlbnRQb3B1cEFjdGlvbi5jYW5jZWwoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gdGhpcztcclxuICAgIH1cclxuICAgIGFzeW5jIGV4ZWN1dGVOb3ROdWxsKCkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZSgpO1xyXG4gICAgICAgIF9hc3NlcnQocmVzdWx0LCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgYXN5bmMgb25FeGVjdXRpb24oKSB7XHJcbiAgICAgICAgZGVidWdBc3NlcnQodGhpcy5maWx0ZXIubGVuZ3RoID09PSAxLCAnUG9wdXAgb3BlcmF0aW9ucyBvbmx5IGhhbmRsZSBvbmUgZXZlbnQnKTtcclxuICAgICAgICBjb25zdCBldmVudElkID0gX2dlbmVyYXRlRXZlbnRJZCgpO1xyXG4gICAgICAgIHRoaXMuYXV0aFdpbmRvdyA9IGF3YWl0IHRoaXMucmVzb2x2ZXIuX29wZW5Qb3B1cCh0aGlzLmF1dGgsIHRoaXMucHJvdmlkZXIsIHRoaXMuZmlsdGVyWzBdLCAvLyBUaGVyZSdzIGFsd2F5cyBvbmUsIHNlZSBjb25zdHJ1Y3RvclxyXG4gICAgICAgIGV2ZW50SWQpO1xyXG4gICAgICAgIHRoaXMuYXV0aFdpbmRvdy5hc3NvY2lhdGVkRXZlbnQgPSBldmVudElkO1xyXG4gICAgICAgIC8vIENoZWNrIGZvciB3ZWIgc3RvcmFnZSBzdXBwb3J0IGFuZCBvcmlnaW4gdmFsaWRhdGlvbiBfYWZ0ZXJfIHRoZSBwb3B1cCBpc1xyXG4gICAgICAgIC8vIGxvYWRlZC4gVGhlc2Ugb3BlcmF0aW9ucyBhcmUgc2xvdyAofjEgc2Vjb25kIG9yIHNvKSBSYXRoZXIgdGhhblxyXG4gICAgICAgIC8vIHdhaXRpbmcgb24gdGhlbSBiZWZvcmUgb3BlbmluZyB0aGUgd2luZG93LCBvcHRpbWlzdGljYWxseSBvcGVuIHRoZSBwb3B1cFxyXG4gICAgICAgIC8vIGFuZCBjaGVjayBmb3Igc3RvcmFnZSBzdXBwb3J0IGF0IHRoZSBzYW1lIHRpbWUuIElmIHN0b3JhZ2Ugc3VwcG9ydCBpc1xyXG4gICAgICAgIC8vIG5vdCBhdmFpbGFibGUsIHRoaXMgd2lsbCBjYXVzZSB0aGUgd2hvbGUgdGhpbmcgdG8gcmVqZWN0IHByb3Blcmx5LiBJdFxyXG4gICAgICAgIC8vIHdpbGwgYWxzbyBjbG9zZSB0aGUgcG9wdXAsIGJ1dCBzaW5jZSB0aGUgcHJvbWlzZSBoYXMgYWxyZWFkeSByZWplY3RlZCxcclxuICAgICAgICAvLyB0aGUgcG9wdXAgY2xvc2VkIGJ5IHVzZXIgcG9sbCB3aWxsIHJlamVjdCBpbnRvIHRoZSB2b2lkLlxyXG4gICAgICAgIHRoaXMucmVzb2x2ZXIuX29yaWdpblZhbGlkYXRpb24odGhpcy5hdXRoKS5jYXRjaChlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZWplY3QoZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlci5faXNJZnJhbWVXZWJTdG9yYWdlU3VwcG9ydGVkKHRoaXMuYXV0aCwgaXNTdXBwb3J0ZWQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWlzU3VwcG9ydGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlamVjdChfY3JlYXRlRXJyb3IodGhpcy5hdXRoLCBcIndlYi1zdG9yYWdlLXVuc3VwcG9ydGVkXCIgLyogQXV0aEVycm9yQ29kZS5XRUJfU1RPUkFHRV9VTlNVUFBPUlRFRCAqLykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gSGFuZGxlIHVzZXIgY2xvc3VyZS4gTm90aWNlIHRoaXMgZG9lcyAqbm90KiB1c2UgYXdhaXRcclxuICAgICAgICB0aGlzLnBvbGxVc2VyQ2FuY2VsbGF0aW9uKCk7XHJcbiAgICB9XHJcbiAgICBnZXQgZXZlbnRJZCgpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGhXaW5kb3cpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hc3NvY2lhdGVkRXZlbnQpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBjYW5jZWwoKSB7XHJcbiAgICAgICAgdGhpcy5yZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgXCJjYW5jZWxsZWQtcG9wdXAtcmVxdWVzdFwiIC8qIEF1dGhFcnJvckNvZGUuRVhQSVJFRF9QT1BVUF9SRVFVRVNUICovKSk7XHJcbiAgICB9XHJcbiAgICBjbGVhblVwKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmF1dGhXaW5kb3cpIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRoV2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBvbGxJZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMucG9sbElkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hdXRoV2luZG93ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnBvbGxJZCA9IG51bGw7XHJcbiAgICAgICAgUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gbnVsbDtcclxuICAgIH1cclxuICAgIHBvbGxVc2VyQ2FuY2VsbGF0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHBvbGwgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBfYSwgX2I7XHJcbiAgICAgICAgICAgIGlmICgoX2IgPSAoX2EgPSB0aGlzLmF1dGhXaW5kb3cpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS53aW5kb3cpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbG9zZWQpIHtcclxuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZXJlIGlzIHN1ZmZpY2llbnQgdGltZSBmb3Igd2hhdGV2ZXIgYWN0aW9uIHRvXHJcbiAgICAgICAgICAgICAgICAvLyBjb21wbGV0ZS4gVGhlIHdpbmRvdyBjb3VsZCBoYXZlIGNsb3NlZCBidXQgdGhlIHNpZ24gaW4gbmV0d29ya1xyXG4gICAgICAgICAgICAgICAgLy8gY2FsbCBjb3VsZCBzdGlsbCBiZSBpbiBmbGlnaHQuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvbGxJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvbGxJZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgXCJwb3B1cC1jbG9zZWQtYnktdXNlclwiIC8qIEF1dGhFcnJvckNvZGUuUE9QVVBfQ0xPU0VEX0JZX1VTRVIgKi8pKTtcclxuICAgICAgICAgICAgICAgIH0sIDIwMDAgLyogX1RpbWVvdXQuQVVUSF9FVkVOVCAqLyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5wb2xsSWQgPSB3aW5kb3cuc2V0VGltZW91dChwb2xsLCBfUE9MTF9XSU5ET1dfQ0xPU0VfVElNRU9VVC5nZXQoKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBwb2xsKCk7XHJcbiAgICB9XHJcbn1cclxuLy8gT25seSBvbmUgcG9wdXAgaXMgZXZlciBzaG93biBhdCBvbmNlLiBUaGUgbGlmZWN5Y2xlIG9mIHRoZSBjdXJyZW50IHBvcHVwXHJcbi8vIGNhbiBiZSBtYW5hZ2VkIC8gY2FuY2VsbGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci5cclxuUG9wdXBPcGVyYXRpb24uY3VycmVudFBvcHVwQWN0aW9uID0gbnVsbDtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUEVORElOR19SRURJUkVDVF9LRVkgPSAncGVuZGluZ1JlZGlyZWN0JztcclxuLy8gV2Ugb25seSBnZXQgb25lIHJlZGlyZWN0IG91dGNvbWUgZm9yIGFueSBvbmUgYXV0aCwgc28ganVzdCBzdG9yZSBpdFxyXG4vLyBpbiBoZXJlLlxyXG5jb25zdCByZWRpcmVjdE91dGNvbWVNYXAgPSBuZXcgTWFwKCk7XHJcbmNsYXNzIFJlZGlyZWN0QWN0aW9uIGV4dGVuZHMgQWJzdHJhY3RQb3B1cFJlZGlyZWN0T3BlcmF0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKGF1dGgsIHJlc29sdmVyLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkge1xyXG4gICAgICAgIHN1cGVyKGF1dGgsIFtcclxuICAgICAgICAgICAgXCJzaWduSW5WaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi8sXHJcbiAgICAgICAgICAgIFwibGlua1ZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLyxcclxuICAgICAgICAgICAgXCJyZWF1dGhWaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9SRURJUkVDVCAqLyxcclxuICAgICAgICAgICAgXCJ1bmtub3duXCIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovXHJcbiAgICAgICAgXSwgcmVzb2x2ZXIsIHVuZGVmaW5lZCwgYnlwYXNzQXV0aFN0YXRlKTtcclxuICAgICAgICB0aGlzLmV2ZW50SWQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBPdmVycmlkZSB0aGUgZXhlY3V0ZSBmdW5jdGlvbjsgaWYgd2UgYWxyZWFkeSBoYXZlIGEgcmVkaXJlY3QgcmVzdWx0LCB0aGVuXHJcbiAgICAgKiBqdXN0IHJldHVybiBpdC5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgZXhlY3V0ZSgpIHtcclxuICAgICAgICBsZXQgcmVhZHlPdXRjb21lID0gcmVkaXJlY3RPdXRjb21lTWFwLmdldCh0aGlzLmF1dGguX2tleSgpKTtcclxuICAgICAgICBpZiAoIXJlYWR5T3V0Y29tZSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzUGVuZGluZ1JlZGlyZWN0ID0gYXdhaXQgX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzKHRoaXMucmVzb2x2ZXIsIHRoaXMuYXV0aCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBoYXNQZW5kaW5nUmVkaXJlY3QgPyBhd2FpdCBzdXBlci5leGVjdXRlKCkgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgcmVhZHlPdXRjb21lID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHJlYWR5T3V0Y29tZSA9ICgpID0+IFByb21pc2UucmVqZWN0KGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQodGhpcy5hdXRoLl9rZXkoKSwgcmVhZHlPdXRjb21lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgd2UncmUgbm90IGJ5cGFzc2luZyBhdXRoIHN0YXRlLCB0aGUgcmVhZHkgb3V0Y29tZSBzaG91bGQgYmUgc2V0IHRvXHJcbiAgICAgICAgLy8gbnVsbC5cclxuICAgICAgICBpZiAoIXRoaXMuYnlwYXNzQXV0aFN0YXRlKSB7XHJcbiAgICAgICAgICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQodGhpcy5hdXRoLl9rZXkoKSwgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG51bGwpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlYWR5T3V0Y29tZSgpO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgb25BdXRoRXZlbnQoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gXCJzaWduSW5WaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuU0lHTl9JTl9WSUFfUkVESVJFQ1QgKi8pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm9uQXV0aEV2ZW50KGV2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PT0gXCJ1bmtub3duXCIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovKSB7XHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBzZW50aW5lbCB2YWx1ZSBpbmRpY2F0aW5nIHRoZXJlJ3Mgbm8gcGVuZGluZyByZWRpcmVjdFxyXG4gICAgICAgICAgICB0aGlzLnJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV2ZW50LmV2ZW50SWQpIHtcclxuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXV0aC5fcmVkaXJlY3RVc2VyRm9ySWQoZXZlbnQuZXZlbnRJZCk7XHJcbiAgICAgICAgICAgIGlmICh1c2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLm9uQXV0aEV2ZW50KGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZShudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIG9uRXhlY3V0aW9uKCkgeyB9XHJcbiAgICBjbGVhblVwKCkgeyB9XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzKHJlc29sdmVyLCBhdXRoKSB7XHJcbiAgICBjb25zdCBrZXkgPSBwZW5kaW5nUmVkaXJlY3RLZXkoYXV0aCk7XHJcbiAgICBjb25zdCBwZXJzaXN0ZW5jZSA9IHJlc29sdmVyUGVyc2lzdGVuY2UocmVzb2x2ZXIpO1xyXG4gICAgaWYgKCEoYXdhaXQgcGVyc2lzdGVuY2UuX2lzQXZhaWxhYmxlKCkpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgaGFzUGVuZGluZ1JlZGlyZWN0ID0gKGF3YWl0IHBlcnNpc3RlbmNlLl9nZXQoa2V5KSkgPT09ICd0cnVlJztcclxuICAgIGF3YWl0IHBlcnNpc3RlbmNlLl9yZW1vdmUoa2V5KTtcclxuICAgIHJldHVybiBoYXNQZW5kaW5nUmVkaXJlY3Q7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3NldFBlbmRpbmdSZWRpcmVjdFN0YXR1cyhyZXNvbHZlciwgYXV0aCkge1xyXG4gICAgcmV0dXJuIHJlc29sdmVyUGVyc2lzdGVuY2UocmVzb2x2ZXIpLl9zZXQocGVuZGluZ1JlZGlyZWN0S2V5KGF1dGgpLCAndHJ1ZScpO1xyXG59XHJcbmZ1bmN0aW9uIF9jbGVhclJlZGlyZWN0T3V0Y29tZXMoKSB7XHJcbiAgICByZWRpcmVjdE91dGNvbWVNYXAuY2xlYXIoKTtcclxufVxyXG5mdW5jdGlvbiBfb3ZlcnJpZGVSZWRpcmVjdFJlc3VsdChhdXRoLCByZXN1bHQpIHtcclxuICAgIHJlZGlyZWN0T3V0Y29tZU1hcC5zZXQoYXV0aC5fa2V5KCksIHJlc3VsdCk7XHJcbn1cclxuZnVuY3Rpb24gcmVzb2x2ZXJQZXJzaXN0ZW5jZShyZXNvbHZlcikge1xyXG4gICAgcmV0dXJuIF9nZXRJbnN0YW5jZShyZXNvbHZlci5fcmVkaXJlY3RQZXJzaXN0ZW5jZSk7XHJcbn1cclxuZnVuY3Rpb24gcGVuZGluZ1JlZGlyZWN0S2V5KGF1dGgpIHtcclxuICAgIHJldHVybiBfcGVyc2lzdGVuY2VLZXlOYW1lKFBFTkRJTkdfUkVESVJFQ1RfS0VZLCBhdXRoLmNvbmZpZy5hcGlLZXksIGF1dGgubmFtZSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEF1dGhlbnRpY2F0ZXMgYSBGaXJlYmFzZSBjbGllbnQgdXNpbmcgYSBmdWxsLXBhZ2UgcmVkaXJlY3QgZmxvdy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogVG8gaGFuZGxlIHRoZSByZXN1bHRzIGFuZCBlcnJvcnMgZm9yIHRoaXMgb3BlcmF0aW9uLCByZWZlciB0byB7QGxpbmsgZ2V0UmVkaXJlY3RSZXN1bHR9LlxyXG4gKiBGb2xsb3cgdGhlIFtiZXN0IHByYWN0aWNlc10oaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvYXV0aC93ZWIvcmVkaXJlY3QtYmVzdC1wcmFjdGljZXMpIHdoZW4gdXNpbmcge0BsaW5rIHNpZ25JbldpdGhSZWRpcmVjdH0uXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYGphdmFzY3JpcHRcclxuICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0LlxyXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpO1xyXG4gKiAvLyBZb3UgY2FuIGFkZCBhZGRpdGlvbmFsIHNjb3BlcyB0byB0aGUgcHJvdmlkZXI6XHJcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCd1c2VyX2JpcnRoZGF5Jyk7XHJcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cclxuICogYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIGlmIChyZXN1bHQpIHtcclxuICogICAvLyBUaGlzIGlzIHRoZSBzaWduZWQtaW4gdXNlclxyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcclxuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi5cclxuICogICBjb25zdCBjcmVkZW50aWFsID0gcHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQoYXV0aCwgcmVzdWx0KTtcclxuICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XHJcbiAqIH1cclxuICogLy8gQXMgdGhpcyBBUEkgY2FuIGJlIHVzZWQgZm9yIHNpZ24taW4sIGxpbmtpbmcgYW5kIHJlYXV0aGVudGljYXRpb24sXHJcbiAqIC8vIGNoZWNrIHRoZSBvcGVyYXRpb25UeXBlIHRvIGRldGVybWluZSB3aGF0IHRyaWdnZXJlZCB0aGlzIHJlZGlyZWN0XHJcbiAqIC8vIG9wZXJhdGlvbi5cclxuICogY29uc3Qgb3BlcmF0aW9uVHlwZSA9IHJlc3VsdC5vcGVyYXRpb25UeXBlO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gcHJvdmlkZXIgLSBUaGUgcHJvdmlkZXIgdG8gYXV0aGVudGljYXRlLiBUaGUgcHJvdmlkZXIgaGFzIHRvIGJlIGFuIHtAbGluayBPQXV0aFByb3ZpZGVyfS5cclxuICogTm9uLU9BdXRoIHByb3ZpZGVycyBsaWtlIHtAbGluayBFbWFpbEF1dGhQcm92aWRlcn0gd2lsbCB0aHJvdyBhbiBlcnJvci5cclxuICogQHBhcmFtIHJlc29sdmVyIC0gQW4gaW5zdGFuY2Ugb2Yge0BsaW5rIFBvcHVwUmVkaXJlY3RSZXNvbHZlcn0sIG9wdGlvbmFsXHJcbiAqIGlmIGFscmVhZHkgc3VwcGxpZWQgdG8ge0BsaW5rIGluaXRpYWxpemVBdXRofSBvciBwcm92aWRlZCBieSB7QGxpbmsgZ2V0QXV0aH0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlciwgcmVzb2x2ZXIpIHtcclxuICAgIHJldHVybiBfc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyLCByZXNvbHZlcik7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX3NpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlciwgcmVzb2x2ZXIpIHtcclxuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcclxuICAgIF9hc3NlcnRJbnN0YW5jZU9mKGF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgLy8gV2FpdCBmb3IgYXV0aCBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSwgdGhpcyB3aWxsIHByb2Nlc3MgcGVuZGluZyByZWRpcmVjdHMgYW5kIGNsZWFyIHRoZVxyXG4gICAgLy8gUEVORElOR19SRURJUkVDVF9LRVkgaW4gcGVyc2lzdGVuY2UuIFRoaXMgc2hvdWxkIGJlIGNvbXBsZXRlZCBiZWZvcmUgc3RhcnRpbmcgYSBuZXdcclxuICAgIC8vIHJlZGlyZWN0IGFuZCBjcmVhdGluZyBhIFBFTkRJTkdfUkVESVJFQ1RfS0VZIGVudHJ5LlxyXG4gICAgYXdhaXQgYXV0aEludGVybmFsLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIoYXV0aEludGVybmFsLCByZXNvbHZlcik7XHJcbiAgICBhd2FpdCBfc2V0UGVuZGluZ1JlZGlyZWN0U3RhdHVzKHJlc29sdmVySW50ZXJuYWwsIGF1dGhJbnRlcm5hbCk7XHJcbiAgICByZXR1cm4gcmVzb2x2ZXJJbnRlcm5hbC5fb3BlblJlZGlyZWN0KGF1dGhJbnRlcm5hbCwgcHJvdmlkZXIsIFwic2lnbkluVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovKTtcclxufVxyXG4vKipcclxuICogUmVhdXRoZW50aWNhdGVzIHRoZSBjdXJyZW50IHVzZXIgd2l0aCB0aGUgc3BlY2lmaWVkIHtAbGluayBPQXV0aFByb3ZpZGVyfSB1c2luZyBhIGZ1bGwtcGFnZSByZWRpcmVjdCBmbG93LlxyXG4gKiBAcmVtYXJrc1xyXG4gKiBUbyBoYW5kbGUgdGhlIHJlc3VsdHMgYW5kIGVycm9ycyBmb3IgdGhpcyBvcGVyYXRpb24sIHJlZmVyIHRvIHtAbGluayBnZXRSZWRpcmVjdFJlc3VsdH0uXHJcbiAqIEZvbGxvdyB0aGUgW2Jlc3QgcHJhY3RpY2VzXShodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9hdXRoL3dlYi9yZWRpcmVjdC1iZXN0LXByYWN0aWNlcykgd2hlbiB1c2luZyB7QGxpbmsgcmVhdXRoZW50aWNhdGVXaXRoUmVkaXJlY3R9LlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBqYXZhc2NyaXB0XHJcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTtcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aFJlZGlyZWN0KGF1dGgsIHByb3ZpZGVyKTtcclxuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXHJcbiAqXHJcbiAqIC8vIEFmdGVyIHJldHVybmluZyBmcm9tIHRoZSByZWRpcmVjdCB3aGVuIHlvdXIgYXBwIGluaXRpYWxpemVzIHlvdSBjYW4gb2J0YWluIHRoZSByZXN1bHRcclxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XHJcbiAqIC8vIFJlYXV0aGVudGljYXRlIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGF3YWl0IHJlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0KHJlc3VsdC51c2VyLCBwcm92aWRlcik7XHJcbiAqIC8vIFRoaXMgd2lsbCBhZ2FpbiB0cmlnZ2VyIGEgZnVsbCBwYWdlIHJlZGlyZWN0IGF3YXkgZnJvbSB5b3VyIGFwcFxyXG4gKlxyXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFJlZGlyZWN0UmVzdWx0KGF1dGgpO1xyXG4gKiBgYGBcclxuICpcclxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cclxuICogQHBhcmFtIHByb3ZpZGVyIC0gVGhlIHByb3ZpZGVyIHRvIGF1dGhlbnRpY2F0ZS4gVGhlIHByb3ZpZGVyIGhhcyB0byBiZSBhbiB7QGxpbmsgT0F1dGhQcm92aWRlcn0uXHJcbiAqIE5vbi1PQXV0aCBwcm92aWRlcnMgbGlrZSB7QGxpbmsgRW1haWxBdXRoUHJvdmlkZXJ9IHdpbGwgdGhyb3cgYW4gZXJyb3IuXHJcbiAqIEBwYXJhbSByZXNvbHZlciAtIEFuIGluc3RhbmNlIG9mIHtAbGluayBQb3B1cFJlZGlyZWN0UmVzb2x2ZXJ9LCBvcHRpb25hbFxyXG4gKiBpZiBhbHJlYWR5IHN1cHBsaWVkIHRvIHtAbGluayBpbml0aWFsaXplQXV0aH0gb3IgcHJvdmlkZWQgYnkge0BsaW5rIGdldEF1dGh9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiByZWF1dGhlbnRpY2F0ZVdpdGhSZWRpcmVjdCh1c2VyLCBwcm92aWRlciwgcmVzb2x2ZXIpIHtcclxuICAgIHJldHVybiBfcmVhdXRoZW50aWNhdGVXaXRoUmVkaXJlY3QodXNlciwgcHJvdmlkZXIsIHJlc29sdmVyKTtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfcmVhdXRoZW50aWNhdGVXaXRoUmVkaXJlY3QodXNlciwgcHJvdmlkZXIsIHJlc29sdmVyKSB7XHJcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XHJcbiAgICBfYXNzZXJ0SW5zdGFuY2VPZih1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIEZlZGVyYXRlZEF1dGhQcm92aWRlcik7XHJcbiAgICAvLyBXYWl0IGZvciBhdXRoIGluaXRpYWxpemF0aW9uIHRvIGNvbXBsZXRlLCB0aGlzIHdpbGwgcHJvY2VzcyBwZW5kaW5nIHJlZGlyZWN0cyBhbmQgY2xlYXIgdGhlXHJcbiAgICAvLyBQRU5ESU5HX1JFRElSRUNUX0tFWSBpbiBwZXJzaXN0ZW5jZS4gVGhpcyBzaG91bGQgYmUgY29tcGxldGVkIGJlZm9yZSBzdGFydGluZyBhIG5ld1xyXG4gICAgLy8gcmVkaXJlY3QgYW5kIGNyZWF0aW5nIGEgUEVORElOR19SRURJUkVDVF9LRVkgZW50cnkuXHJcbiAgICBhd2FpdCB1c2VySW50ZXJuYWwuYXV0aC5faW5pdGlhbGl6YXRpb25Qcm9taXNlO1xyXG4gICAgLy8gQWxsb3cgdGhlIHJlc29sdmVyIHRvIGVycm9yIGJlZm9yZSBwZXJzaXN0aW5nIHRoZSByZWRpcmVjdCB1c2VyXHJcbiAgICBjb25zdCByZXNvbHZlckludGVybmFsID0gX3dpdGhEZWZhdWx0UmVzb2x2ZXIodXNlckludGVybmFsLmF1dGgsIHJlc29sdmVyKTtcclxuICAgIGF3YWl0IF9zZXRQZW5kaW5nUmVkaXJlY3RTdGF0dXMocmVzb2x2ZXJJbnRlcm5hbCwgdXNlckludGVybmFsLmF1dGgpO1xyXG4gICAgY29uc3QgZXZlbnRJZCA9IGF3YWl0IHByZXBhcmVVc2VyRm9yUmVkaXJlY3QodXNlckludGVybmFsKTtcclxuICAgIHJldHVybiByZXNvbHZlckludGVybmFsLl9vcGVuUmVkaXJlY3QodXNlckludGVybmFsLmF1dGgsIHByb3ZpZGVyLCBcInJlYXV0aFZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5SRUFVVEhfVklBX1JFRElSRUNUICovLCBldmVudElkKTtcclxufVxyXG4vKipcclxuICogTGlua3MgdGhlIHtAbGluayBPQXV0aFByb3ZpZGVyfSB0byB0aGUgdXNlciBhY2NvdW50IHVzaW5nIGEgZnVsbC1wYWdlIHJlZGlyZWN0IGZsb3cuXHJcbiAqIEByZW1hcmtzXHJcbiAqIFRvIGhhbmRsZSB0aGUgcmVzdWx0cyBhbmQgZXJyb3JzIGZvciB0aGlzIG9wZXJhdGlvbiwgcmVmZXIgdG8ge0BsaW5rIGdldFJlZGlyZWN0UmVzdWx0fS5cclxuICogRm9sbG93IHRoZSBbYmVzdCBwcmFjdGljZXNdKGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2F1dGgvd2ViL3JlZGlyZWN0LWJlc3QtcHJhY3RpY2VzKSB3aGVuIHVzaW5nIHtAbGluayBsaW5rV2l0aFJlZGlyZWN0fS5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIHNvbWUgb3RoZXIgcHJvdmlkZXIuXHJcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCk7XHJcbiAqIC8vIExpbmsgdXNpbmcgYSByZWRpcmVjdC5cclxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgRmFjZWJvb2tBdXRoUHJvdmlkZXIoKTtcclxuICogYXdhaXQgbGlua1dpdGhSZWRpcmVjdChyZXN1bHQudXNlciwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogYGBgXHJcbiAqXHJcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXHJcbiAqIEBwYXJhbSBwcm92aWRlciAtIFRoZSBwcm92aWRlciB0byBhdXRoZW50aWNhdGUuIFRoZSBwcm92aWRlciBoYXMgdG8gYmUgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9LlxyXG4gKiBOb24tT0F1dGggcHJvdmlkZXJzIGxpa2Uge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSB3aWxsIHRocm93IGFuIGVycm9yLlxyXG4gKiBAcGFyYW0gcmVzb2x2ZXIgLSBBbiBpbnN0YW5jZSBvZiB7QGxpbmsgUG9wdXBSZWRpcmVjdFJlc29sdmVyfSwgb3B0aW9uYWxcclxuICogaWYgYWxyZWFkeSBzdXBwbGllZCB0byB7QGxpbmsgaW5pdGlhbGl6ZUF1dGh9IG9yIHByb3ZpZGVkIGJ5IHtAbGluayBnZXRBdXRofS5cclxuICpcclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gbGlua1dpdGhSZWRpcmVjdCh1c2VyLCBwcm92aWRlciwgcmVzb2x2ZXIpIHtcclxuICAgIHJldHVybiBfbGlua1dpdGhSZWRpcmVjdCh1c2VyLCBwcm92aWRlciwgcmVzb2x2ZXIpO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIF9saW5rV2l0aFJlZGlyZWN0KHVzZXIsIHByb3ZpZGVyLCByZXNvbHZlcikge1xyXG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xyXG4gICAgX2Fzc2VydEluc3RhbmNlT2YodXNlckludGVybmFsLmF1dGgsIHByb3ZpZGVyLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIpO1xyXG4gICAgLy8gV2FpdCBmb3IgYXV0aCBpbml0aWFsaXphdGlvbiB0byBjb21wbGV0ZSwgdGhpcyB3aWxsIHByb2Nlc3MgcGVuZGluZyByZWRpcmVjdHMgYW5kIGNsZWFyIHRoZVxyXG4gICAgLy8gUEVORElOR19SRURJUkVDVF9LRVkgaW4gcGVyc2lzdGVuY2UuIFRoaXMgc2hvdWxkIGJlIGNvbXBsZXRlZCBiZWZvcmUgc3RhcnRpbmcgYSBuZXdcclxuICAgIC8vIHJlZGlyZWN0IGFuZCBjcmVhdGluZyBhIFBFTkRJTkdfUkVESVJFQ1RfS0VZIGVudHJ5LlxyXG4gICAgYXdhaXQgdXNlckludGVybmFsLmF1dGguX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcclxuICAgIC8vIEFsbG93IHRoZSByZXNvbHZlciB0byBlcnJvciBiZWZvcmUgcGVyc2lzdGluZyB0aGUgcmVkaXJlY3QgdXNlclxyXG4gICAgY29uc3QgcmVzb2x2ZXJJbnRlcm5hbCA9IF93aXRoRGVmYXVsdFJlc29sdmVyKHVzZXJJbnRlcm5hbC5hdXRoLCByZXNvbHZlcik7XHJcbiAgICBhd2FpdCBfYXNzZXJ0TGlua2VkU3RhdHVzKGZhbHNlLCB1c2VySW50ZXJuYWwsIHByb3ZpZGVyLnByb3ZpZGVySWQpO1xyXG4gICAgYXdhaXQgX3NldFBlbmRpbmdSZWRpcmVjdFN0YXR1cyhyZXNvbHZlckludGVybmFsLCB1c2VySW50ZXJuYWwuYXV0aCk7XHJcbiAgICBjb25zdCBldmVudElkID0gYXdhaXQgcHJlcGFyZVVzZXJGb3JSZWRpcmVjdCh1c2VySW50ZXJuYWwpO1xyXG4gICAgcmV0dXJuIHJlc29sdmVySW50ZXJuYWwuX29wZW5SZWRpcmVjdCh1c2VySW50ZXJuYWwuYXV0aCwgcHJvdmlkZXIsIFwibGlua1ZpYVJlZGlyZWN0XCIgLyogQXV0aEV2ZW50VHlwZS5MSU5LX1ZJQV9SRURJUkVDVCAqLywgZXZlbnRJZCk7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9IGZyb20gdGhlIHJlZGlyZWN0LWJhc2VkIHNpZ24taW4gZmxvdy5cclxuICpcclxuICogQHJlbWFya3NcclxuICogSWYgc2lnbi1pbiBzdWNjZWVkZWQsIHJldHVybnMgdGhlIHNpZ25lZCBpbiB1c2VyLiBJZiBzaWduLWluIHdhcyB1bnN1Y2Nlc3NmdWwsIGZhaWxzIHdpdGggYW5cclxuICogZXJyb3IuIElmIG5vIHJlZGlyZWN0IG9wZXJhdGlvbiB3YXMgY2FsbGVkLCByZXR1cm5zIGBudWxsYC5cclxuICpcclxuICogQGV4YW1wbGVcclxuICogYGBgamF2YXNjcmlwdFxyXG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXHJcbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IEZhY2Vib29rQXV0aFByb3ZpZGVyKCk7XHJcbiAqIC8vIFlvdSBjYW4gYWRkIGFkZGl0aW9uYWwgc2NvcGVzIHRvIHRoZSBwcm92aWRlcjpcclxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTtcclxuICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLlxyXG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xyXG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcclxuICpcclxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxyXG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcclxuICogaWYgKHJlc3VsdCkge1xyXG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXHJcbiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xyXG4gKiAgIC8vIFRoaXMgZ2l2ZXMgeW91IGEgRmFjZWJvb2sgQWNjZXNzIFRva2VuLlxyXG4gKiAgIGNvbnN0IGNyZWRlbnRpYWwgPSBwcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChhdXRoLCByZXN1bHQpO1xyXG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcclxuICogfVxyXG4gKiAvLyBBcyB0aGlzIEFQSSBjYW4gYmUgdXNlZCBmb3Igc2lnbi1pbiwgbGlua2luZyBhbmQgcmVhdXRoZW50aWNhdGlvbixcclxuICogLy8gY2hlY2sgdGhlIG9wZXJhdGlvblR5cGUgdG8gZGV0ZXJtaW5lIHdoYXQgdHJpZ2dlcmVkIHRoaXMgcmVkaXJlY3RcclxuICogLy8gb3BlcmF0aW9uLlxyXG4gKiBjb25zdCBvcGVyYXRpb25UeXBlID0gcmVzdWx0Lm9wZXJhdGlvblR5cGU7XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXHJcbiAqIEBwYXJhbSByZXNvbHZlciAtIEFuIGluc3RhbmNlIG9mIHtAbGluayBQb3B1cFJlZGlyZWN0UmVzb2x2ZXJ9LCBvcHRpb25hbFxyXG4gKiBpZiBhbHJlYWR5IHN1cHBsaWVkIHRvIHtAbGluayBpbml0aWFsaXplQXV0aH0gb3IgcHJvdmlkZWQgYnkge0BsaW5rIGdldEF1dGh9LlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRSZWRpcmVjdFJlc3VsdChhdXRoLCByZXNvbHZlcikge1xyXG4gICAgYXdhaXQgX2Nhc3RBdXRoKGF1dGgpLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICByZXR1cm4gX2dldFJlZGlyZWN0UmVzdWx0KGF1dGgsIHJlc29sdmVyLCBmYWxzZSk7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gX2dldFJlZGlyZWN0UmVzdWx0KGF1dGgsIHJlc29sdmVyRXh0ZXJuLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkge1xyXG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xyXG4gICAgY29uc3QgcmVzb2x2ZXIgPSBfd2l0aERlZmF1bHRSZXNvbHZlcihhdXRoSW50ZXJuYWwsIHJlc29sdmVyRXh0ZXJuKTtcclxuICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBSZWRpcmVjdEFjdGlvbihhdXRoSW50ZXJuYWwsIHJlc29sdmVyLCBieXBhc3NBdXRoU3RhdGUpO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWN0aW9uLmV4ZWN1dGUoKTtcclxuICAgIGlmIChyZXN1bHQgJiYgIWJ5cGFzc0F1dGhTdGF0ZSkge1xyXG4gICAgICAgIGRlbGV0ZSByZXN1bHQudXNlci5fcmVkaXJlY3RFdmVudElkO1xyXG4gICAgICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fcGVyc2lzdFVzZXJJZkN1cnJlbnQocmVzdWx0LnVzZXIpO1xyXG4gICAgICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fc2V0UmVkaXJlY3RVc2VyKG51bGwsIHJlc29sdmVyRXh0ZXJuKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gcHJlcGFyZVVzZXJGb3JSZWRpcmVjdCh1c2VyKSB7XHJcbiAgICBjb25zdCBldmVudElkID0gX2dlbmVyYXRlRXZlbnRJZChgJHt1c2VyLnVpZH06OjpgKTtcclxuICAgIHVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9IGV2ZW50SWQ7XHJcbiAgICBhd2FpdCB1c2VyLmF1dGguX3NldFJlZGlyZWN0VXNlcih1c2VyKTtcclxuICAgIGF3YWl0IHVzZXIuYXV0aC5fcGVyc2lzdFVzZXJJZkN1cnJlbnQodXNlcik7XHJcbiAgICByZXR1cm4gZXZlbnRJZDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vLyBUaGUgYW1vdW50IG9mIHRpbWUgdG8gc3RvcmUgdGhlIFVJRHMgb2Ygc2VlbiBldmVudHM7IHRoaXMgaXNcclxuLy8gc2V0IHRvIDEwIG1pbiBieSBkZWZhdWx0XHJcbmNvbnN0IEVWRU5UX0RVUExJQ0FUSU9OX0NBQ0hFX0RVUkFUSU9OX01TID0gMTAgKiA2MCAqIDEwMDA7XHJcbmNsYXNzIEF1dGhFdmVudE1hbmFnZXIge1xyXG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xyXG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XHJcbiAgICAgICAgdGhpcy5jYWNoZWRFdmVudFVpZHMgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5jb25zdW1lcnMgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgdGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmhhc0hhbmRsZWRQb3RlbnRpYWxSZWRpcmVjdCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubGFzdFByb2Nlc3NlZEV2ZW50VGltZSA9IERhdGUubm93KCk7XHJcbiAgICB9XHJcbiAgICByZWdpc3RlckNvbnN1bWVyKGF1dGhFdmVudENvbnN1bWVyKSB7XHJcbiAgICAgICAgdGhpcy5jb25zdW1lcnMuYWRkKGF1dGhFdmVudENvbnN1bWVyKTtcclxuICAgICAgICBpZiAodGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50ICYmXHJcbiAgICAgICAgICAgIHRoaXMuaXNFdmVudEZvckNvbnN1bWVyKHRoaXMucXVldWVkUmVkaXJlY3RFdmVudCwgYXV0aEV2ZW50Q29uc3VtZXIpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VuZFRvQ29uc3VtZXIodGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50LCBhdXRoRXZlbnRDb25zdW1lcik7XHJcbiAgICAgICAgICAgIHRoaXMuc2F2ZUV2ZW50VG9DYWNoZSh0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQpO1xyXG4gICAgICAgICAgICB0aGlzLnF1ZXVlZFJlZGlyZWN0RXZlbnQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHVucmVnaXN0ZXJDb25zdW1lcihhdXRoRXZlbnRDb25zdW1lcikge1xyXG4gICAgICAgIHRoaXMuY29uc3VtZXJzLmRlbGV0ZShhdXRoRXZlbnRDb25zdW1lcik7XHJcbiAgICB9XHJcbiAgICBvbkV2ZW50KGV2ZW50KSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGV2ZW50IGhhcyBhbHJlYWR5IGJlZW4gaGFuZGxlZFxyXG4gICAgICAgIGlmICh0aGlzLmhhc0V2ZW50QmVlbkhhbmRsZWQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGhhbmRsZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbnN1bWVycy5mb3JFYWNoKGNvbnN1bWVyID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNFdmVudEZvckNvbnN1bWVyKGV2ZW50LCBjb25zdW1lcikpIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kVG9Db25zdW1lcihldmVudCwgY29uc3VtZXIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlRXZlbnRUb0NhY2hlKGV2ZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh0aGlzLmhhc0hhbmRsZWRQb3RlbnRpYWxSZWRpcmVjdCB8fCAhaXNSZWRpcmVjdEV2ZW50KGV2ZW50KSkge1xyXG4gICAgICAgICAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHNlZW4gYSByZWRpcmVjdCBiZWZvcmUsIG9yIHRoaXMgaXMgYSBwb3B1cCBldmVudCxcclxuICAgICAgICAgICAgLy8gYmFpbCBub3dcclxuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaGFzSGFuZGxlZFBvdGVudGlhbFJlZGlyZWN0ID0gdHJ1ZTtcclxuICAgICAgICAvLyBJZiB0aGUgcmVkaXJlY3Qgd2Fzbid0IGhhbmRsZWQsIGhhbmcgb24gdG8gaXRcclxuICAgICAgICBpZiAoIWhhbmRsZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5xdWV1ZWRSZWRpcmVjdEV2ZW50ID0gZXZlbnQ7XHJcbiAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGFuZGxlZDtcclxuICAgIH1cclxuICAgIHNlbmRUb0NvbnN1bWVyKGV2ZW50LCBjb25zdW1lcikge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBpZiAoZXZlbnQuZXJyb3IgJiYgIWlzTnVsbFJlZGlyZWN0RXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvZGUgPSAoKF9hID0gZXZlbnQuZXJyb3IuY29kZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnNwbGl0KCdhdXRoLycpWzFdKSB8fFxyXG4gICAgICAgICAgICAgICAgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi87XHJcbiAgICAgICAgICAgIGNvbnN1bWVyLm9uRXJyb3IoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgY29kZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3VtZXIub25BdXRoRXZlbnQoZXZlbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlzRXZlbnRGb3JDb25zdW1lcihldmVudCwgY29uc3VtZXIpIHtcclxuICAgICAgICBjb25zdCBldmVudElkTWF0Y2hlcyA9IGNvbnN1bWVyLmV2ZW50SWQgPT09IG51bGwgfHxcclxuICAgICAgICAgICAgKCEhZXZlbnQuZXZlbnRJZCAmJiBldmVudC5ldmVudElkID09PSBjb25zdW1lci5ldmVudElkKTtcclxuICAgICAgICByZXR1cm4gY29uc3VtZXIuZmlsdGVyLmluY2x1ZGVzKGV2ZW50LnR5cGUpICYmIGV2ZW50SWRNYXRjaGVzO1xyXG4gICAgfVxyXG4gICAgaGFzRXZlbnRCZWVuSGFuZGxlZChldmVudCkge1xyXG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhpcy5sYXN0UHJvY2Vzc2VkRXZlbnRUaW1lID49XHJcbiAgICAgICAgICAgIEVWRU5UX0RVUExJQ0FUSU9OX0NBQ0hFX0RVUkFUSU9OX01TKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVkRXZlbnRVaWRzLmNsZWFyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlZEV2ZW50VWlkcy5oYXMoZXZlbnRVaWQoZXZlbnQpKTtcclxuICAgIH1cclxuICAgIHNhdmVFdmVudFRvQ2FjaGUoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLmNhY2hlZEV2ZW50VWlkcy5hZGQoZXZlbnRVaWQoZXZlbnQpKTtcclxuICAgICAgICB0aGlzLmxhc3RQcm9jZXNzZWRFdmVudFRpbWUgPSBEYXRlLm5vdygpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGV2ZW50VWlkKGUpIHtcclxuICAgIHJldHVybiBbZS50eXBlLCBlLmV2ZW50SWQsIGUuc2Vzc2lvbklkLCBlLnRlbmFudElkXS5maWx0ZXIodiA9PiB2KS5qb2luKCctJyk7XHJcbn1cclxuZnVuY3Rpb24gaXNOdWxsUmVkaXJlY3RFdmVudCh7IHR5cGUsIGVycm9yIH0pIHtcclxuICAgIHJldHVybiAodHlwZSA9PT0gXCJ1bmtub3duXCIgLyogQXV0aEV2ZW50VHlwZS5VTktOT1dOICovICYmXHJcbiAgICAgICAgKGVycm9yID09PSBudWxsIHx8IGVycm9yID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSA9PT0gYGF1dGgvJHtcIm5vLWF1dGgtZXZlbnRcIiAvKiBBdXRoRXJyb3JDb2RlLk5PX0FVVEhfRVZFTlQgKi99YCk7XHJcbn1cclxuZnVuY3Rpb24gaXNSZWRpcmVjdEV2ZW50KGV2ZW50KSB7XHJcbiAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcclxuICAgICAgICBjYXNlIFwic2lnbkluVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLlNJR05fSU5fVklBX1JFRElSRUNUICovOlxyXG4gICAgICAgIGNhc2UgXCJsaW5rVmlhUmVkaXJlY3RcIiAvKiBBdXRoRXZlbnRUeXBlLkxJTktfVklBX1JFRElSRUNUICovOlxyXG4gICAgICAgIGNhc2UgXCJyZWF1dGhWaWFSZWRpcmVjdFwiIC8qIEF1dGhFdmVudFR5cGUuUkVBVVRIX1ZJQV9SRURJUkVDVCAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgY2FzZSBcInVua25vd25cIiAvKiBBdXRoRXZlbnRUeXBlLlVOS05PV04gKi86XHJcbiAgICAgICAgICAgIHJldHVybiBpc051bGxSZWRpcmVjdEV2ZW50KGV2ZW50KTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gX2dldFByb2plY3RDb25maWcoYXV0aCwgcmVxdWVzdCA9IHt9KSB7XHJcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiR0VUXCIgLyogSHR0cE1ldGhvZC5HRVQgKi8sIFwiL3YxL3Byb2plY3RzXCIgLyogRW5kcG9pbnQuR0VUX1BST0pFQ1RfQ09ORklHICovLCByZXF1ZXN0KTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBJUF9BRERSRVNTX1JFR0VYID0gL15cXGR7MSwzfVxcLlxcZHsxLDN9XFwuXFxkezEsM31cXC5cXGR7MSwzfSQvO1xyXG5jb25zdCBIVFRQX1JFR0VYID0gL15odHRwcz8vO1xyXG5hc3luYyBmdW5jdGlvbiBfdmFsaWRhdGVPcmlnaW4oYXV0aCkge1xyXG4gICAgLy8gU2tpcCBvcmlnaW4gdmFsaWRhdGlvbiBpZiB3ZSBhcmUgaW4gYW4gZW11bGF0ZWQgZW52aXJvbm1lbnRcclxuICAgIGlmIChhdXRoLmNvbmZpZy5lbXVsYXRvcikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgYXV0aG9yaXplZERvbWFpbnMgfSA9IGF3YWl0IF9nZXRQcm9qZWN0Q29uZmlnKGF1dGgpO1xyXG4gICAgZm9yIChjb25zdCBkb21haW4gb2YgYXV0aG9yaXplZERvbWFpbnMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBpZiAobWF0Y2hEb21haW4oZG9tYWluKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHRoZXJlJ3MgYSBVUkwgZXJyb3I7IGp1c3QgY29udGludWUgc2VhcmNoaW5nXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gSW4gdGhlIG9sZCBTREssIHRoaXMgZXJyb3IgYWxzbyBwcm92aWRlcyBoZWxwZnVsIG1lc3NhZ2VzLlxyXG4gICAgX2ZhaWwoYXV0aCwgXCJ1bmF1dGhvcml6ZWQtZG9tYWluXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX09SSUdJTiAqLyk7XHJcbn1cclxuZnVuY3Rpb24gbWF0Y2hEb21haW4oZXhwZWN0ZWQpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRVcmwgPSBfZ2V0Q3VycmVudFVybCgpO1xyXG4gICAgY29uc3QgeyBwcm90b2NvbCwgaG9zdG5hbWUgfSA9IG5ldyBVUkwoY3VycmVudFVybCk7XHJcbiAgICBpZiAoZXhwZWN0ZWQuc3RhcnRzV2l0aCgnY2hyb21lLWV4dGVuc2lvbjovLycpKSB7XHJcbiAgICAgICAgY29uc3QgY2VVcmwgPSBuZXcgVVJMKGV4cGVjdGVkKTtcclxuICAgICAgICBpZiAoY2VVcmwuaG9zdG5hbWUgPT09ICcnICYmIGhvc3RuYW1lID09PSAnJykge1xyXG4gICAgICAgICAgICAvLyBGb3Igc29tZSByZWFzb24gd2UncmUgbm90IHBhcnNpbmcgY2hyb21lIFVSTHMgcHJvcGVybHlcclxuICAgICAgICAgICAgcmV0dXJuIChwcm90b2NvbCA9PT0gJ2Nocm9tZS1leHRlbnNpb246JyAmJlxyXG4gICAgICAgICAgICAgICAgZXhwZWN0ZWQucmVwbGFjZSgnY2hyb21lLWV4dGVuc2lvbjovLycsICcnKSA9PT1cclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXJsLnJlcGxhY2UoJ2Nocm9tZS1leHRlbnNpb246Ly8nLCAnJykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcHJvdG9jb2wgPT09ICdjaHJvbWUtZXh0ZW5zaW9uOicgJiYgY2VVcmwuaG9zdG5hbWUgPT09IGhvc3RuYW1lO1xyXG4gICAgfVxyXG4gICAgaWYgKCFIVFRQX1JFR0VYLnRlc3QocHJvdG9jb2wpKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaWYgKElQX0FERFJFU1NfUkVHRVgudGVzdChleHBlY3RlZCkpIHtcclxuICAgICAgICAvLyBUaGUgZG9tYWluIGhhcyB0byBiZSBleGFjdGx5IGVxdWFsIHRvIHRoZSBwYXR0ZXJuLCBhcyBhbiBJUCBkb21haW4gd2lsbFxyXG4gICAgICAgIC8vIG9ubHkgY29udGFpbiB0aGUgSVAsIG5vIGV4dHJhIGNoYXJhY3Rlci5cclxuICAgICAgICByZXR1cm4gaG9zdG5hbWUgPT09IGV4cGVjdGVkO1xyXG4gICAgfVxyXG4gICAgLy8gRG90cyBpbiBwYXR0ZXJuIHNob3VsZCBiZSBlc2NhcGVkLlxyXG4gICAgY29uc3QgZXNjYXBlZERvbWFpblBhdHRlcm4gPSBleHBlY3RlZC5yZXBsYWNlKC9cXC4vZywgJ1xcXFwuJyk7XHJcbiAgICAvLyBOb24gaXAgYWRkcmVzcyBkb21haW5zLlxyXG4gICAgLy8gZG9tYWluLmNvbSA9ICouZG9tYWluLmNvbSBPUiBkb21haW4uY29tXHJcbiAgICBjb25zdCByZSA9IG5ldyBSZWdFeHAoJ14oLitcXFxcLicgKyBlc2NhcGVkRG9tYWluUGF0dGVybiArICd8JyArIGVzY2FwZWREb21haW5QYXR0ZXJuICsgJykkJywgJ2knKTtcclxuICAgIHJldHVybiByZS50ZXN0KGhvc3RuYW1lKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQy5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgTkVUV09SS19USU1FT1VUID0gbmV3IERlbGF5KDMwMDAwLCA2MDAwMCk7XHJcbi8qKlxyXG4gKiBSZXNldCB1bmxhb2RlZCBHQXBpIG1vZHVsZXMuIElmIGdhcGkubG9hZCBmYWlscyBkdWUgdG8gYSBuZXR3b3JrIGVycm9yLFxyXG4gKiBpdCB3aWxsIHN0b3Agd29ya2luZyBhZnRlciBhIHJldHJpYWwuIFRoaXMgaXMgYSBoYWNrIHRvIGZpeCB0aGlzIGlzc3VlLlxyXG4gKi9cclxuZnVuY3Rpb24gcmVzZXRVbmxvYWRlZEdhcGlNb2R1bGVzKCkge1xyXG4gICAgLy8gQ2xlYXIgbGFzdCBmYWlsZWQgZ2FwaS5sb2FkIHN0YXRlIHRvIGZvcmNlIG5leHQgZ2FwaS5sb2FkIHRvIGZpcnN0XHJcbiAgICAvLyBsb2FkIHRoZSBmYWlsZWQgZ2FwaS5pZnJhbWVzIG1vZHVsZS5cclxuICAgIC8vIEdldCBnYXBpeC5iZWFjb24gY29udGV4dC5cclxuICAgIGNvbnN0IGJlYWNvbiA9IF93aW5kb3coKS5fX19qc2w7XHJcbiAgICAvLyBHZXQgY3VycmVudCBoaW50LlxyXG4gICAgaWYgKGJlYWNvbiA9PT0gbnVsbCB8fCBiZWFjb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGJlYWNvbi5IKSB7XHJcbiAgICAgICAgLy8gR2V0IGdhcGkgaGludC5cclxuICAgICAgICBmb3IgKGNvbnN0IGhpbnQgb2YgT2JqZWN0LmtleXMoYmVhY29uLkgpKSB7XHJcbiAgICAgICAgICAgIC8vIFJlcXVlc3RlZCBtb2R1bGVzLlxyXG4gICAgICAgICAgICBiZWFjb24uSFtoaW50XS5yID0gYmVhY29uLkhbaGludF0uciB8fCBbXTtcclxuICAgICAgICAgICAgLy8gTG9hZGVkIG1vZHVsZXMuXHJcbiAgICAgICAgICAgIGJlYWNvbi5IW2hpbnRdLkwgPSBiZWFjb24uSFtoaW50XS5MIHx8IFtdO1xyXG4gICAgICAgICAgICAvLyBTZXQgcmVxdWVzdGVkIG1vZHVsZXMgdG8gYSBjb3B5IG9mIHRoZSBsb2FkZWQgbW9kdWxlcy5cclxuICAgICAgICAgICAgYmVhY29uLkhbaGludF0uciA9IFsuLi5iZWFjb24uSFtoaW50XS5MXTtcclxuICAgICAgICAgICAgLy8gQ2xlYXIgcGVuZGluZyBjYWxsYmFja3MuXHJcbiAgICAgICAgICAgIGlmIChiZWFjb24uQ1ApIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmVhY29uLkNQLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGFsbCBmYWlsZWQgcGVuZGluZyBjYWxsYmFja3MuXHJcbiAgICAgICAgICAgICAgICAgICAgYmVhY29uLkNQW2ldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBsb2FkR2FwaShhdXRoKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIHZhciBfYSwgX2IsIF9jO1xyXG4gICAgICAgIC8vIEZ1bmN0aW9uIHRvIHJ1biB3aGVuIGdhcGkubG9hZCBpcyByZWFkeS5cclxuICAgICAgICBmdW5jdGlvbiBsb2FkR2FwaUlmcmFtZSgpIHtcclxuICAgICAgICAgICAgLy8gVGhlIGRldmVsb3BlciBtYXkgaGF2ZSB0cmllZCB0byBwcmV2aW91c2x5IHJ1biBnYXBpLmxvYWQgYW5kIGZhaWxlZC5cclxuICAgICAgICAgICAgLy8gUnVuIHRoaXMgdG8gZml4IHRoYXQuXHJcbiAgICAgICAgICAgIHJlc2V0VW5sb2FkZWRHYXBpTW9kdWxlcygpO1xyXG4gICAgICAgICAgICBnYXBpLmxvYWQoJ2dhcGkuaWZyYW1lcycsIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShnYXBpLmlmcmFtZXMuZ2V0Q29udGV4dCgpKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBvbnRpbWVvdXQ6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYWJvdmUgcmVzZXQgbWF5IGJlIHN1ZmZpY2llbnQsIGJ1dCBoYXZpbmcgdGhpcyByZXNldCBhZnRlclxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGZhaWx1cmUgZW5zdXJlcyB0aGF0IGlmIHRoZSBkZXZlbG9wZXIgY2FsbHMgZ2FwaS5sb2FkIGFmdGVyIHRoZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbm5lY3Rpb24gaXMgcmUtZXN0YWJsaXNoZWQgYW5kIGJlZm9yZSBhbm90aGVyIGF0dGVtcHQgdG8gZW1iZWRcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaWZyYW1lLCBpdCB3b3VsZCB3b3JrIGFuZCB3b3VsZCBub3QgYmUgYnJva2VuIGJlY2F1c2Ugb2Ygb3VyXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZmFpbGVkIGF0dGVtcHQuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGltZW91dCB3aGVuIGdhcGkuaWZyYW1lcy5JZnJhbWUgbm90IGxvYWRlZC5cclxuICAgICAgICAgICAgICAgICAgICByZXNldFVubG9hZGVkR2FwaU1vZHVsZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoX2NyZWF0ZUVycm9yKGF1dGgsIFwibmV0d29yay1yZXF1ZXN0LWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuTkVUV09SS19SRVFVRVNUX0ZBSUxFRCAqLykpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRpbWVvdXQ6IE5FVFdPUktfVElNRU9VVC5nZXQoKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChfYiA9IChfYSA9IF93aW5kb3coKS5nYXBpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaWZyYW1lcykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLklmcmFtZSkge1xyXG4gICAgICAgICAgICAvLyBJZiBnYXBpLmlmcmFtZXMuSWZyYW1lIGF2YWlsYWJsZSwgcmVzb2x2ZS5cclxuICAgICAgICAgICAgcmVzb2x2ZShnYXBpLmlmcmFtZXMuZ2V0Q29udGV4dCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoISEoKF9jID0gX3dpbmRvdygpLmdhcGkpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5sb2FkKSkge1xyXG4gICAgICAgICAgICAvLyBHYXBpIGxvYWRlciByZWFkeSwgbG9hZCBnYXBpLmlmcmFtZXMuXHJcbiAgICAgICAgICAgIGxvYWRHYXBpSWZyYW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBuZXcgaWZyYW1lIGNhbGxiYWNrIHdoZW4gdGhpcyBpcyBjYWxsZWQgc28gYXMgbm90IHRvIG92ZXJ3cml0ZVxyXG4gICAgICAgICAgICAvLyBhbnkgcHJldmlvdXMgZGVmaW5lZCBjYWxsYmFjay4gVGhpcyBoYXBwZW5zIGlmIHRoaXMgbWV0aG9kIGlzIGNhbGxlZFxyXG4gICAgICAgICAgICAvLyBtdWx0aXBsZSB0aW1lcyBpbiBwYXJhbGxlbCBhbmQgY291bGQgcmVzdWx0IGluIHRoZSBsYXRlciBjYWxsYmFja1xyXG4gICAgICAgICAgICAvLyBvdmVyd3JpdGluZyB0aGUgcHJldmlvdXMgb25lLiBUaGlzIHdvdWxkIGVuZCB1cCB3aXRoIGEgaWZyYW1lXHJcbiAgICAgICAgICAgIC8vIHRpbWVvdXQuXHJcbiAgICAgICAgICAgIGNvbnN0IGNiTmFtZSA9IF9nZW5lcmF0ZUNhbGxiYWNrTmFtZSgnaWZyYW1lZmNiJyk7XHJcbiAgICAgICAgICAgIC8vIEdBcGkgbG9hZGVyIG5vdCBhdmFpbGFibGUsIGR5bmFtaWNhbGx5IGxvYWQgcGxhdGZvcm0uanMuXHJcbiAgICAgICAgICAgIF93aW5kb3coKVtjYk5hbWVdID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gR0FwaSBsb2FkZXIgc2hvdWxkIGJlIHJlYWR5LlxyXG4gICAgICAgICAgICAgICAgaWYgKCEhZ2FwaS5sb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZEdhcGlJZnJhbWUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEdhcGkgbG9hZGVyIGZhaWxlZCwgdGhyb3cgZXJyb3IuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KF9jcmVhdGVFcnJvcihhdXRoLCBcIm5ldHdvcmstcmVxdWVzdC1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi8pKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy8gTG9hZCBHQXBpIGxvYWRlci5cclxuICAgICAgICAgICAgcmV0dXJuIF9sb2FkSlMoYGh0dHBzOi8vYXBpcy5nb29nbGUuY29tL2pzL2FwaS5qcz9vbmxvYWQ9JHtjYk5hbWV9YClcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlID0+IHJlamVjdChlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIC8vIFJlc2V0IGNhY2hlZCBwcm9taXNlIHRvIGFsbG93IGZvciByZXRyaWFsLlxyXG4gICAgICAgIGNhY2hlZEdBcGlMb2FkZXIgPSBudWxsO1xyXG4gICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfSk7XHJcbn1cclxubGV0IGNhY2hlZEdBcGlMb2FkZXIgPSBudWxsO1xyXG5mdW5jdGlvbiBfbG9hZEdhcGkoYXV0aCkge1xyXG4gICAgY2FjaGVkR0FwaUxvYWRlciA9IGNhY2hlZEdBcGlMb2FkZXIgfHwgbG9hZEdhcGkoYXV0aCk7XHJcbiAgICByZXR1cm4gY2FjaGVkR0FwaUxvYWRlcjtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQy5cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUElOR19USU1FT1VUID0gbmV3IERlbGF5KDUwMDAsIDE1MDAwKTtcclxuY29uc3QgSUZSQU1FX1BBVEggPSAnX18vYXV0aC9pZnJhbWUnO1xyXG5jb25zdCBFTVVMQVRFRF9JRlJBTUVfUEFUSCA9ICdlbXVsYXRvci9hdXRoL2lmcmFtZSc7XHJcbmNvbnN0IElGUkFNRV9BVFRSSUJVVEVTID0ge1xyXG4gICAgc3R5bGU6IHtcclxuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgICAgICB0b3A6ICctMTAwcHgnLFxyXG4gICAgICAgIHdpZHRoOiAnMXB4JyxcclxuICAgICAgICBoZWlnaHQ6ICcxcHgnXHJcbiAgICB9LFxyXG4gICAgJ2FyaWEtaGlkZGVuJzogJ3RydWUnLFxyXG4gICAgdGFiaW5kZXg6ICctMSdcclxufTtcclxuLy8gTWFwIGZyb20gYXBpSG9zdCB0byBlbmRwb2ludCBJRCBmb3IgcGFzc2luZyBpbnRvIGlmcmFtZS4gSW4gY3VycmVudCBTREssIGFwaUhvc3QgY2FuIGJlIHNldCB0b1xyXG4vLyBhbnl0aGluZyAobm90IGZyb20gYSBsaXN0IG9mIGVuZHBvaW50cyB3aXRoIElEcyBhcyBpbiBsZWdhY3kpLCBzbyB0aGlzIGlzIHRoZSBjbG9zZXN0IHdlIGNhbiBnZXQuXHJcbmNvbnN0IEVJRF9GUk9NX0FQSUhPU1QgPSBuZXcgTWFwKFtcclxuICAgIFtcImlkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwiIC8qIERlZmF1bHRDb25maWcuQVBJX0hPU1QgKi8sICdwJ10sXHJcbiAgICBbJ3N0YWdpbmctaWRlbnRpdHl0b29sa2l0LnNhbmRib3guZ29vZ2xlYXBpcy5jb20nLCAncyddLFxyXG4gICAgWyd0ZXN0LWlkZW50aXR5dG9vbGtpdC5zYW5kYm94Lmdvb2dsZWFwaXMuY29tJywgJ3QnXSAvLyB0ZXN0XHJcbl0pO1xyXG5mdW5jdGlvbiBnZXRJZnJhbWVVcmwoYXV0aCkge1xyXG4gICAgY29uc3QgY29uZmlnID0gYXV0aC5jb25maWc7XHJcbiAgICBfYXNzZXJ0KGNvbmZpZy5hdXRoRG9tYWluLCBhdXRoLCBcImF1dGgtZG9tYWluLWNvbmZpZy1yZXF1aXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BVVRIX0RPTUFJTiAqLyk7XHJcbiAgICBjb25zdCB1cmwgPSBjb25maWcuZW11bGF0b3JcclxuICAgICAgICA/IF9lbXVsYXRvclVybChjb25maWcsIEVNVUxBVEVEX0lGUkFNRV9QQVRIKVxyXG4gICAgICAgIDogYGh0dHBzOi8vJHthdXRoLmNvbmZpZy5hdXRoRG9tYWlufS8ke0lGUkFNRV9QQVRIfWA7XHJcbiAgICBjb25zdCBwYXJhbXMgPSB7XHJcbiAgICAgICAgYXBpS2V5OiBjb25maWcuYXBpS2V5LFxyXG4gICAgICAgIGFwcE5hbWU6IGF1dGgubmFtZSxcclxuICAgICAgICB2OiBTREtfVkVSU0lPTlxyXG4gICAgfTtcclxuICAgIGNvbnN0IGVpZCA9IEVJRF9GUk9NX0FQSUhPU1QuZ2V0KGF1dGguY29uZmlnLmFwaUhvc3QpO1xyXG4gICAgaWYgKGVpZCkge1xyXG4gICAgICAgIHBhcmFtcy5laWQgPSBlaWQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBmcmFtZXdvcmtzID0gYXV0aC5fZ2V0RnJhbWV3b3JrcygpO1xyXG4gICAgaWYgKGZyYW1ld29ya3MubGVuZ3RoKSB7XHJcbiAgICAgICAgcGFyYW1zLmZ3ID0gZnJhbWV3b3Jrcy5qb2luKCcsJyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7dXJsfT8ke3F1ZXJ5c3RyaW5nKHBhcmFtcykuc2xpY2UoMSl9YDtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBfb3BlbklmcmFtZShhdXRoKSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgX2xvYWRHYXBpKGF1dGgpO1xyXG4gICAgY29uc3QgZ2FwaSA9IF93aW5kb3coKS5nYXBpO1xyXG4gICAgX2Fzc2VydChnYXBpLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XHJcbiAgICByZXR1cm4gY29udGV4dC5vcGVuKHtcclxuICAgICAgICB3aGVyZTogZG9jdW1lbnQuYm9keSxcclxuICAgICAgICB1cmw6IGdldElmcmFtZVVybChhdXRoKSxcclxuICAgICAgICBtZXNzYWdlSGFuZGxlcnNGaWx0ZXI6IGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIsXHJcbiAgICAgICAgYXR0cmlidXRlczogSUZSQU1FX0FUVFJJQlVURVMsXHJcbiAgICAgICAgZG9udGNsZWFyOiB0cnVlXHJcbiAgICB9LCAoaWZyYW1lKSA9PiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgYXdhaXQgaWZyYW1lLnJlc3R5bGUoe1xyXG4gICAgICAgICAgICAvLyBQcmV2ZW50IGlmcmFtZSBmcm9tIGNsb3Npbmcgb24gbW91c2Ugb3V0LlxyXG4gICAgICAgICAgICBzZXRIaWRlT25MZWF2ZTogZmFsc2VcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBuZXR3b3JrRXJyb3IgPSBfY3JlYXRlRXJyb3IoYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKTtcclxuICAgICAgICAvLyBDb25maXJtIGlmcmFtZSBpcyBjb3JyZWN0bHkgbG9hZGVkLlxyXG4gICAgICAgIC8vIFRvIGZhbGxiYWNrIG9uIGZhaWx1cmUsIHNldCBhIHRpbWVvdXQuXHJcbiAgICAgICAgY29uc3QgbmV0d29ya0Vycm9yVGltZXIgPSBfd2luZG93KCkuc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChuZXR3b3JrRXJyb3IpO1xyXG4gICAgICAgIH0sIFBJTkdfVElNRU9VVC5nZXQoKSk7XHJcbiAgICAgICAgLy8gQ2xlYXIgdGltZXIgYW5kIHJlc29sdmUgcGVuZGluZyBpZnJhbWUgcmVhZHkgcHJvbWlzZS5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhclRpbWVyQW5kUmVzb2x2ZSgpIHtcclxuICAgICAgICAgICAgX3dpbmRvdygpLmNsZWFyVGltZW91dChuZXR3b3JrRXJyb3JUaW1lcik7XHJcbiAgICAgICAgICAgIHJlc29sdmUoaWZyYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVGhpcyByZXR1cm5zIGFuIElUaGVuYWJsZS4gSG93ZXZlciB0aGUgcmVqZWN0IHBhcnQgZG9lcyBub3QgY2FsbFxyXG4gICAgICAgIC8vIHdoZW4gdGhlIGlmcmFtZSBpcyBub3QgbG9hZGVkLlxyXG4gICAgICAgIGlmcmFtZS5waW5nKGNsZWFyVGltZXJBbmRSZXNvbHZlKS50aGVuKGNsZWFyVGltZXJBbmRSZXNvbHZlLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChuZXR3b3JrRXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDLlxyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBCQVNFX1BPUFVQX09QVElPTlMgPSB7XHJcbiAgICBsb2NhdGlvbjogJ3llcycsXHJcbiAgICByZXNpemFibGU6ICd5ZXMnLFxyXG4gICAgc3RhdHVzYmFyOiAneWVzJyxcclxuICAgIHRvb2xiYXI6ICdubydcclxufTtcclxuY29uc3QgREVGQVVMVF9XSURUSCA9IDUwMDtcclxuY29uc3QgREVGQVVMVF9IRUlHSFQgPSA2MDA7XHJcbmNvbnN0IFRBUkdFVF9CTEFOSyA9ICdfYmxhbmsnO1xyXG5jb25zdCBGSVJFRk9YX0VNUFRZX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0JztcclxuY2xhc3MgQXV0aFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKHdpbmRvdykge1xyXG4gICAgICAgIHRoaXMud2luZG93ID0gd2luZG93O1xyXG4gICAgICAgIHRoaXMuYXNzb2NpYXRlZEV2ZW50ID0gbnVsbDtcclxuICAgIH1cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLndpbmRvdykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy53aW5kb3cuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkgeyB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIF9vcGVuKGF1dGgsIHVybCwgbmFtZSwgd2lkdGggPSBERUZBVUxUX1dJRFRILCBoZWlnaHQgPSBERUZBVUxUX0hFSUdIVCkge1xyXG4gICAgY29uc3QgdG9wID0gTWF0aC5tYXgoKHdpbmRvdy5zY3JlZW4uYXZhaWxIZWlnaHQgLSBoZWlnaHQpIC8gMiwgMCkudG9TdHJpbmcoKTtcclxuICAgIGNvbnN0IGxlZnQgPSBNYXRoLm1heCgod2luZG93LnNjcmVlbi5hdmFpbFdpZHRoIC0gd2lkdGgpIC8gMiwgMCkudG9TdHJpbmcoKTtcclxuICAgIGxldCB0YXJnZXQgPSAnJztcclxuICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIEJBU0VfUE9QVVBfT1BUSU9OUyksIHsgd2lkdGg6IHdpZHRoLnRvU3RyaW5nKCksIGhlaWdodDogaGVpZ2h0LnRvU3RyaW5nKCksIHRvcCxcclxuICAgICAgICBsZWZ0IH0pO1xyXG4gICAgLy8gQ2hyb21lIGlPUyA3IGFuZCA4IGlzIHJldHVybmluZyBhbiB1bmRlZmluZWQgcG9wdXAgd2luIHdoZW4gdGFyZ2V0IGlzXHJcbiAgICAvLyBzcGVjaWZpZWQsIGV2ZW4gdGhvdWdoIHRoZSBwb3B1cCBpcyBub3QgbmVjZXNzYXJpbHkgYmxvY2tlZC5cclxuICAgIGNvbnN0IHVhID0gZ2V0VUEoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKG5hbWUpIHtcclxuICAgICAgICB0YXJnZXQgPSBfaXNDaHJvbWVJT1ModWEpID8gVEFSR0VUX0JMQU5LIDogbmFtZTtcclxuICAgIH1cclxuICAgIGlmIChfaXNGaXJlZm94KHVhKSkge1xyXG4gICAgICAgIC8vIEZpcmVmb3ggY29tcGxhaW5zIHdoZW4gaW52YWxpZCBVUkxzIGFyZSBwb3BwZWQgb3V0LiBIYWNreSB3YXkgdG8gYnlwYXNzLlxyXG4gICAgICAgIHVybCA9IHVybCB8fCBGSVJFRk9YX0VNUFRZX1VSTDtcclxuICAgICAgICAvLyBGaXJlZm94IGRpc2FibGVzIGJ5IGRlZmF1bHQgc2Nyb2xsaW5nIG9uIHBvcHVwIHdpbmRvd3MsIHdoaWNoIGNhbiBjcmVhdGVcclxuICAgICAgICAvLyBpc3N1ZXMgd2hlbiB0aGUgdXNlciBoYXMgbWFueSBHb29nbGUgYWNjb3VudHMsIGZvciBpbnN0YW5jZS5cclxuICAgICAgICBvcHRpb25zLnNjcm9sbGJhcnMgPSAneWVzJztcclxuICAgIH1cclxuICAgIGNvbnN0IG9wdGlvbnNTdHJpbmcgPSBPYmplY3QuZW50cmllcyhvcHRpb25zKS5yZWR1Y2UoKGFjY3VtLCBba2V5LCB2YWx1ZV0pID0+IGAke2FjY3VtfSR7a2V5fT0ke3ZhbHVlfSxgLCAnJyk7XHJcbiAgICBpZiAoX2lzSU9TU3RhbmRhbG9uZSh1YSkgJiYgdGFyZ2V0ICE9PSAnX3NlbGYnKSB7XHJcbiAgICAgICAgb3BlbkFzTmV3V2luZG93SU9TKHVybCB8fCAnJywgdGFyZ2V0KTtcclxuICAgICAgICByZXR1cm4gbmV3IEF1dGhQb3B1cChudWxsKTtcclxuICAgIH1cclxuICAgIC8vIGFib3V0OmJsYW5rIGdldHRpbmcgc2FuaXRpemVkIGNhdXNpbmcgYnJvd3NlcnMgbGlrZSBJRS9FZGdlIHRvIGRpc3BsYXlcclxuICAgIC8vIGJyaWVmIGVycm9yIG1lc3NhZ2UgYmVmb3JlIHJlZGlyZWN0aW5nIHRvIGhhbmRsZXIuXHJcbiAgICBjb25zdCBuZXdXaW4gPSB3aW5kb3cub3Blbih1cmwgfHwgJycsIHRhcmdldCwgb3B0aW9uc1N0cmluZyk7XHJcbiAgICBfYXNzZXJ0KG5ld1dpbiwgYXV0aCwgXCJwb3B1cC1ibG9ja2VkXCIgLyogQXV0aEVycm9yQ29kZS5QT1BVUF9CTE9DS0VEICovKTtcclxuICAgIC8vIEZsYWt5IG9uIElFIGVkZ2UsIGVuY2Fwc3VsYXRlIHdpdGggYSB0cnkgYW5kIGNhdGNoLlxyXG4gICAgdHJ5IHtcclxuICAgICAgICBuZXdXaW4uZm9jdXMoKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7IH1cclxuICAgIHJldHVybiBuZXcgQXV0aFBvcHVwKG5ld1dpbik7XHJcbn1cclxuZnVuY3Rpb24gb3BlbkFzTmV3V2luZG93SU9TKHVybCwgdGFyZ2V0KSB7XHJcbiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICAgIGVsLmhyZWYgPSB1cmw7XHJcbiAgICBlbC50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICBjb25zdCBjbGljayA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdNb3VzZUV2ZW50Jyk7XHJcbiAgICBjbGljay5pbml0TW91c2VFdmVudCgnY2xpY2snLCB0cnVlLCB0cnVlLCB3aW5kb3csIDEsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAxLCBudWxsKTtcclxuICAgIGVsLmRpc3BhdGNoRXZlbnQoY2xpY2spO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBVUkwgZm9yIEF1dGhlbnRpY2F0aW9uIHdpZGdldCB3aGljaCB3aWxsIGluaXRpYXRlIHRoZSBPQXV0aCBoYW5kc2hha2VcclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jb25zdCBXSURHRVRfUEFUSCA9ICdfXy9hdXRoL2hhbmRsZXInO1xyXG4vKipcclxuICogVVJMIGZvciBlbXVsYXRlZCBlbnZpcm9ubWVudFxyXG4gKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IEVNVUxBVE9SX1dJREdFVF9QQVRIID0gJ2VtdWxhdG9yL2F1dGgvaGFuZGxlcic7XHJcbmZ1bmN0aW9uIF9nZXRSZWRpcmVjdFVybChhdXRoLCBwcm92aWRlciwgYXV0aFR5cGUsIHJlZGlyZWN0VXJsLCBldmVudElkLCBhZGRpdGlvbmFsUGFyYW1zKSB7XHJcbiAgICBfYXNzZXJ0KGF1dGguY29uZmlnLmF1dGhEb21haW4sIGF1dGgsIFwiYXV0aC1kb21haW4tY29uZmlnLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FVVEhfRE9NQUlOICovKTtcclxuICAgIF9hc3NlcnQoYXV0aC5jb25maWcuYXBpS2V5LCBhdXRoLCBcImludmFsaWQtYXBpLWtleVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUElfS0VZICovKTtcclxuICAgIGNvbnN0IHBhcmFtcyA9IHtcclxuICAgICAgICBhcGlLZXk6IGF1dGguY29uZmlnLmFwaUtleSxcclxuICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWUsXHJcbiAgICAgICAgYXV0aFR5cGUsXHJcbiAgICAgICAgcmVkaXJlY3RVcmwsXHJcbiAgICAgICAgdjogU0RLX1ZFUlNJT04sXHJcbiAgICAgICAgZXZlbnRJZFxyXG4gICAgfTtcclxuICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIEZlZGVyYXRlZEF1dGhQcm92aWRlcikge1xyXG4gICAgICAgIHByb3ZpZGVyLnNldERlZmF1bHRMYW5ndWFnZShhdXRoLmxhbmd1YWdlQ29kZSk7XHJcbiAgICAgICAgcGFyYW1zLnByb3ZpZGVySWQgPSBwcm92aWRlci5wcm92aWRlcklkIHx8ICcnO1xyXG4gICAgICAgIGlmICghaXNFbXB0eShwcm92aWRlci5nZXRDdXN0b21QYXJhbWV0ZXJzKCkpKSB7XHJcbiAgICAgICAgICAgIHBhcmFtcy5jdXN0b21QYXJhbWV0ZXJzID0gSlNPTi5zdHJpbmdpZnkocHJvdmlkZXIuZ2V0Q3VzdG9tUGFyYW1ldGVycygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVE9ETyBzZXQgYWRkaXRpb25hbFBhcmFtcyBmcm9tIHRoZSBwcm92aWRlciBhcyB3ZWxsP1xyXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGFkZGl0aW9uYWxQYXJhbXMgfHwge30pKSB7XHJcbiAgICAgICAgICAgIHBhcmFtc1trZXldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHByb3ZpZGVyIGluc3RhbmNlb2YgQmFzZU9BdXRoUHJvdmlkZXIpIHtcclxuICAgICAgICBjb25zdCBzY29wZXMgPSBwcm92aWRlci5nZXRTY29wZXMoKS5maWx0ZXIoc2NvcGUgPT4gc2NvcGUgIT09ICcnKTtcclxuICAgICAgICBpZiAoc2NvcGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcGFyYW1zLnNjb3BlcyA9IHNjb3Blcy5qb2luKCcsJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGF1dGgudGVuYW50SWQpIHtcclxuICAgICAgICBwYXJhbXMudGlkID0gYXV0aC50ZW5hbnRJZDtcclxuICAgIH1cclxuICAgIC8vIFRPRE86IG1heWJlIHNldCBlaWQgYXMgZW5kaXBvaW50SWRcclxuICAgIC8vIFRPRE86IG1heWJlIHNldCBmdyBhcyBGcmFtZXdvcmtzLmpvaW4oXCIsXCIpXHJcbiAgICBjb25zdCBwYXJhbXNEaWN0ID0gcGFyYW1zO1xyXG4gICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMocGFyYW1zRGljdCkpIHtcclxuICAgICAgICBpZiAocGFyYW1zRGljdFtrZXldID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgZGVsZXRlIHBhcmFtc0RpY3Rba2V5XTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7Z2V0SGFuZGxlckJhc2UoYXV0aCl9PyR7cXVlcnlzdHJpbmcocGFyYW1zRGljdCkuc2xpY2UoMSl9YDtcclxufVxyXG5mdW5jdGlvbiBnZXRIYW5kbGVyQmFzZSh7IGNvbmZpZyB9KSB7XHJcbiAgICBpZiAoIWNvbmZpZy5lbXVsYXRvcikge1xyXG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly8ke2NvbmZpZy5hdXRoRG9tYWlufS8ke1dJREdFVF9QQVRIfWA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX2VtdWxhdG9yVXJsKGNvbmZpZywgRU1VTEFUT1JfV0lER0VUX1BBVEgpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaGUgc3BlY2lhbCB3ZWIgc3RvcmFnZSBldmVudFxyXG4gKlxyXG4gKi9cclxuY29uc3QgV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVkgPSAnd2ViU3RvcmFnZVN1cHBvcnQnO1xyXG5jbGFzcyBCcm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VycyA9IHt9O1xyXG4gICAgICAgIHRoaXMuaWZyYW1lcyA9IHt9O1xyXG4gICAgICAgIHRoaXMub3JpZ2luVmFsaWRhdGlvblByb21pc2VzID0ge307XHJcbiAgICAgICAgdGhpcy5fcmVkaXJlY3RQZXJzaXN0ZW5jZSA9IGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2U7XHJcbiAgICAgICAgdGhpcy5fY29tcGxldGVSZWRpcmVjdEZuID0gX2dldFJlZGlyZWN0UmVzdWx0O1xyXG4gICAgICAgIHRoaXMuX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQgPSBfb3ZlcnJpZGVSZWRpcmVjdFJlc3VsdDtcclxuICAgIH1cclxuICAgIC8vIFdyYXBwaW5nIGluIGFzeW5jIGV2ZW4gdGhvdWdoIHdlIGRvbid0IGF3YWl0IGFueXdoZXJlIGluIG9yZGVyXHJcbiAgICAvLyB0byBtYWtlIHN1cmUgZXJyb3JzIGFyZSByYWlzZWQgYXMgcHJvbWlzZSByZWplY3Rpb25zXHJcbiAgICBhc3luYyBfb3BlblBvcHVwKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgZXZlbnRJZCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICBkZWJ1Z0Fzc2VydCgoX2EgPSB0aGlzLmV2ZW50TWFuYWdlcnNbYXV0aC5fa2V5KCldKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWFuYWdlciwgJ19pbml0aWFsaXplKCkgbm90IGNhbGxlZCBiZWZvcmUgX29wZW5Qb3B1cCgpJyk7XHJcbiAgICAgICAgY29uc3QgdXJsID0gX2dldFJlZGlyZWN0VXJsKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgX2dldEN1cnJlbnRVcmwoKSwgZXZlbnRJZCk7XHJcbiAgICAgICAgcmV0dXJuIF9vcGVuKGF1dGgsIHVybCwgX2dlbmVyYXRlRXZlbnRJZCgpKTtcclxuICAgIH1cclxuICAgIGFzeW5jIF9vcGVuUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIsIGF1dGhUeXBlLCBldmVudElkKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5fb3JpZ2luVmFsaWRhdGlvbihhdXRoKTtcclxuICAgICAgICBfc2V0V2luZG93TG9jYXRpb24oX2dldFJlZGlyZWN0VXJsKGF1dGgsIHByb3ZpZGVyLCBhdXRoVHlwZSwgX2dldEN1cnJlbnRVcmwoKSwgZXZlbnRJZCkpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgoKSA9PiB7IH0pO1xyXG4gICAgfVxyXG4gICAgX2luaXRpYWxpemUoYXV0aCkge1xyXG4gICAgICAgIGNvbnN0IGtleSA9IGF1dGguX2tleSgpO1xyXG4gICAgICAgIGlmICh0aGlzLmV2ZW50TWFuYWdlcnNba2V5XSkge1xyXG4gICAgICAgICAgICBjb25zdCB7IG1hbmFnZXIsIHByb21pc2UgfSA9IHRoaXMuZXZlbnRNYW5hZ2Vyc1trZXldO1xyXG4gICAgICAgICAgICBpZiAobWFuYWdlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtYW5hZ2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRlYnVnQXNzZXJ0KHByb21pc2UsICdJZiBtYW5hZ2VyIGlzIG5vdCBzZXQsIHByb21pc2Ugc2hvdWxkIGJlJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBwcm9taXNlID0gdGhpcy5pbml0QW5kR2V0TWFuYWdlcihhdXRoKTtcclxuICAgICAgICB0aGlzLmV2ZW50TWFuYWdlcnNba2V5XSA9IHsgcHJvbWlzZSB9O1xyXG4gICAgICAgIC8vIElmIHRoZSBwcm9taXNlIGlzIHJlamVjdGVkLCB0aGUga2V5IHNob3VsZCBiZSByZW1vdmVkIHNvIHRoYXQgdGhlXHJcbiAgICAgICAgLy8gb3BlcmF0aW9uIGNhbiBiZSByZXRyaWVkIGxhdGVyLlxyXG4gICAgICAgIHByb21pc2UuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5ldmVudE1hbmFnZXJzW2tleV07XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICB9XHJcbiAgICBhc3luYyBpbml0QW5kR2V0TWFuYWdlcihhdXRoKSB7XHJcbiAgICAgICAgY29uc3QgaWZyYW1lID0gYXdhaXQgX29wZW5JZnJhbWUoYXV0aCk7XHJcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IG5ldyBBdXRoRXZlbnRNYW5hZ2VyKGF1dGgpO1xyXG4gICAgICAgIGlmcmFtZS5yZWdpc3RlcignYXV0aEV2ZW50JywgKGlmcmFtZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIF9hc3NlcnQoaWZyYW1lRXZlbnQgPT09IG51bGwgfHwgaWZyYW1lRXZlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlmcmFtZUV2ZW50LmF1dGhFdmVudCwgYXV0aCwgXCJpbnZhbGlkLWF1dGgtZXZlbnRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSF9FVkVOVCAqLyk7XHJcbiAgICAgICAgICAgIC8vIFRPRE86IENvbnNpZGVyIHNwbGl0dGluZyByZWRpcmVjdCBhbmQgcG9wdXAgZXZlbnRzIGVhcmxpZXIgb25cclxuICAgICAgICAgICAgY29uc3QgaGFuZGxlZCA9IG1hbmFnZXIub25FdmVudChpZnJhbWVFdmVudC5hdXRoRXZlbnQpO1xyXG4gICAgICAgICAgICByZXR1cm4geyBzdGF0dXM6IGhhbmRsZWQgPyBcIkFDS1wiIC8qIEdhcGlPdXRjb21lLkFDSyAqLyA6IFwiRVJST1JcIiAvKiBHYXBpT3V0Y29tZS5FUlJPUiAqLyB9O1xyXG4gICAgICAgIH0sIGdhcGkuaWZyYW1lcy5DUk9TU19PUklHSU5fSUZSQU1FU19GSUxURVIpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2Vyc1thdXRoLl9rZXkoKV0gPSB7IG1hbmFnZXIgfTtcclxuICAgICAgICB0aGlzLmlmcmFtZXNbYXV0aC5fa2V5KCldID0gaWZyYW1lO1xyXG4gICAgICAgIHJldHVybiBtYW5hZ2VyO1xyXG4gICAgfVxyXG4gICAgX2lzSWZyYW1lV2ViU3RvcmFnZVN1cHBvcnRlZChhdXRoLCBjYikge1xyXG4gICAgICAgIGNvbnN0IGlmcmFtZSA9IHRoaXMuaWZyYW1lc1thdXRoLl9rZXkoKV07XHJcbiAgICAgICAgaWZyYW1lLnNlbmQoV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVksIHsgdHlwZTogV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVkgfSwgcmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgICAgICBjb25zdCBpc1N1cHBvcnRlZCA9IChfYSA9IHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdFswXSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW1dFQl9TVE9SQUdFX1NVUFBPUlRfS0VZXTtcclxuICAgICAgICAgICAgaWYgKGlzU3VwcG9ydGVkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNiKCEhaXNTdXBwb3J0ZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcclxuICAgICAgICB9LCBnYXBpLmlmcmFtZXMuQ1JPU1NfT1JJR0lOX0lGUkFNRVNfRklMVEVSKTtcclxuICAgIH1cclxuICAgIF9vcmlnaW5WYWxpZGF0aW9uKGF1dGgpIHtcclxuICAgICAgICBjb25zdCBrZXkgPSBhdXRoLl9rZXkoKTtcclxuICAgICAgICBpZiAoIXRoaXMub3JpZ2luVmFsaWRhdGlvblByb21pc2VzW2tleV0pIHtcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5WYWxpZGF0aW9uUHJvbWlzZXNba2V5XSA9IF92YWxpZGF0ZU9yaWdpbihhdXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3JpZ2luVmFsaWRhdGlvblByb21pc2VzW2tleV07XHJcbiAgICB9XHJcbiAgICBnZXQgX3Nob3VsZEluaXRQcm9hY3RpdmVseSgpIHtcclxuICAgICAgICAvLyBNb2JpbGUgYnJvd3NlcnMgYW5kIFNhZmFyaSBuZWVkIHRvIG9wdGltaXN0aWNhbGx5IGluaXRpYWxpemVcclxuICAgICAgICByZXR1cm4gX2lzTW9iaWxlQnJvd3NlcigpIHx8IF9pc1NhZmFyaSgpIHx8IF9pc0lPUygpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUG9wdXBSZWRpcmVjdFJlc29sdmVyfSBzdWl0YWJsZSBmb3IgYnJvd3NlclxyXG4gKiBiYXNlZCBhcHBsaWNhdGlvbnMuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IGJyb3dzZXJQb3B1cFJlZGlyZWN0UmVzb2x2ZXIgPSBCcm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyO1xuXG5jbGFzcyBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwge1xyXG4gICAgY29uc3RydWN0b3IoZmFjdG9ySWQpIHtcclxuICAgICAgICB0aGlzLmZhY3RvcklkID0gZmFjdG9ySWQ7XHJcbiAgICB9XHJcbiAgICBfcHJvY2VzcyhhdXRoLCBzZXNzaW9uLCBkaXNwbGF5TmFtZSkge1xyXG4gICAgICAgIHN3aXRjaCAoc2Vzc2lvbi50eXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJlbnJvbGxcIiAvKiBNdWx0aUZhY3RvclNlc3Npb25UeXBlLkVOUk9MTCAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5hbGl6ZUVucm9sbChhdXRoLCBzZXNzaW9uLmNyZWRlbnRpYWwsIGRpc3BsYXlOYW1lKTtcclxuICAgICAgICAgICAgY2FzZSBcInNpZ25pblwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuU0lHTl9JTiAqLzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5hbGl6ZVNpZ25JbihhdXRoLCBzZXNzaW9uLmNyZWRlbnRpYWwpO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgndW5leHBlY3RlZCBNdWx0aUZhY3RvclNlc3Npb25UeXBlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiB7QGluaGVyaXRkb2MgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn1cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbkltcGwgZXh0ZW5kcyBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwge1xyXG4gICAgY29uc3RydWN0b3IoY3JlZGVudGlhbCkge1xyXG4gICAgICAgIHN1cGVyKFwicGhvbmVcIiAvKiBGYWN0b3JJZC5QSE9ORSAqLyk7XHJcbiAgICAgICAgdGhpcy5jcmVkZW50aWFsID0gY3JlZGVudGlhbDtcclxuICAgIH1cclxuICAgIC8qKiBAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBfZnJvbUNyZWRlbnRpYWwoY3JlZGVudGlhbCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbkltcGwoY3JlZGVudGlhbCk7XHJcbiAgICB9XHJcbiAgICAvKiogQGludGVybmFsICovXHJcbiAgICBfZmluYWxpemVFbnJvbGwoYXV0aCwgaWRUb2tlbiwgZGlzcGxheU5hbWUpIHtcclxuICAgICAgICByZXR1cm4gZmluYWxpemVFbnJvbGxQaG9uZU1mYShhdXRoLCB7XHJcbiAgICAgICAgICAgIGlkVG9rZW4sXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lLFxyXG4gICAgICAgICAgICBwaG9uZVZlcmlmaWNhdGlvbkluZm86IHRoaXMuY3JlZGVudGlhbC5fbWFrZVZlcmlmaWNhdGlvblJlcXVlc3QoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xyXG4gICAgX2ZpbmFsaXplU2lnbkluKGF1dGgsIG1mYVBlbmRpbmdDcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIGZpbmFsaXplU2lnbkluUGhvbmVNZmEoYXV0aCwge1xyXG4gICAgICAgICAgICBtZmFQZW5kaW5nQ3JlZGVudGlhbCxcclxuICAgICAgICAgICAgcGhvbmVWZXJpZmljYXRpb25JbmZvOiB0aGlzLmNyZWRlbnRpYWwuX21ha2VWZXJpZmljYXRpb25SZXF1ZXN0KClcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYSB7QGxpbmsgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn0uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNsYXNzIFBob25lTXVsdGlGYWN0b3JHZW5lcmF0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoKSB7IH1cclxuICAgIC8qKlxyXG4gICAgICogUHJvdmlkZXMgYSB7QGxpbmsgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn0gdG8gY29uZmlybSBvd25lcnNoaXAgb2YgdGhlIHBob25lIHNlY29uZCBmYWN0b3IuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHBob25lQXV0aENyZWRlbnRpYWwgLSBBIGNyZWRlbnRpYWwgcHJvdmlkZWQgYnkge0BsaW5rIFBob25lQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWx9LlxyXG4gICAgICogQHJldHVybnMgQSB7QGxpbmsgUGhvbmVNdWx0aUZhY3RvckFzc2VydGlvbn0gd2hpY2ggY2FuIGJlIHVzZWQgd2l0aFxyXG4gICAgICoge0BsaW5rIE11bHRpRmFjdG9yUmVzb2x2ZXIucmVzb2x2ZVNpZ25Jbn1cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGFzc2VydGlvbihjcmVkZW50aWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIFBob25lTXVsdGlGYWN0b3JBc3NlcnRpb25JbXBsLl9mcm9tQ3JlZGVudGlhbChjcmVkZW50aWFsKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogVGhlIGlkZW50aWZpZXIgb2YgdGhlIHBob25lIHNlY29uZCBmYWN0b3I6IGBwaG9uZWAuXHJcbiAqL1xyXG5QaG9uZU11bHRpRmFjdG9yR2VuZXJhdG9yLkZBQ1RPUl9JRCA9ICdwaG9uZSc7XG5cbnZhciBuYW1lID0gXCJAZmlyZWJhc2UvYXV0aFwiO1xudmFyIHZlcnNpb24gPSBcIjAuMjEuMVwiO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBBdXRoSW50ZXJvcCB7XHJcbiAgICBjb25zdHJ1Y3RvcihhdXRoKSB7XHJcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcclxuICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzID0gbmV3IE1hcCgpO1xyXG4gICAgfVxyXG4gICAgZ2V0VWlkKCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGguY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpIHx8IG51bGw7XHJcbiAgICB9XHJcbiAgICBhc3luYyBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5hdXRoLl9pbml0aWFsaXphdGlvblByb21pc2U7XHJcbiAgICAgICAgaWYgKCF0aGlzLmF1dGguY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgdGhpcy5hdXRoLmN1cnJlbnRVc2VyLmdldElkVG9rZW4oZm9yY2VSZWZyZXNoKTtcclxuICAgICAgICByZXR1cm4geyBhY2Nlc3NUb2tlbiB9O1xyXG4gICAgfVxyXG4gICAgYWRkQXV0aFRva2VuTGlzdGVuZXIobGlzdGVuZXIpIHtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuaGFzKGxpc3RlbmVyKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gdGhpcy5hdXRoLm9uSWRUb2tlbkNoYW5nZWQodXNlciA9PiB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyKCh1c2VyID09PSBudWxsIHx8IHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHVzZXIuc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuKSB8fCBudWxsKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzLnNldChsaXN0ZW5lciwgdW5zdWJzY3JpYmUpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgfVxyXG4gICAgcmVtb3ZlQXV0aFRva2VuTGlzdGVuZXIobGlzdGVuZXIpIHtcclxuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XHJcbiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSB0aGlzLmludGVybmFsTGlzdGVuZXJzLmdldChsaXN0ZW5lcik7XHJcbiAgICAgICAgaWYgKCF1bnN1YnNjcmliZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxMaXN0ZW5lcnMuZGVsZXRlKGxpc3RlbmVyKTtcclxuICAgICAgICB1bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgfVxyXG4gICAgYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKSB7XHJcbiAgICAgICAgX2Fzc2VydCh0aGlzLmF1dGguX2luaXRpYWxpemF0aW9uUHJvbWlzZSwgXCJkZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoXCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi8pO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpIHtcclxuICAgICAgICBpZiAodGhpcy5pbnRlcm5hbExpc3RlbmVycy5zaXplID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmF1dGguX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hdXRoLl9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRWZXJzaW9uRm9yUGxhdGZvcm0oY2xpZW50UGxhdGZvcm0pIHtcclxuICAgIHN3aXRjaCAoY2xpZW50UGxhdGZvcm0pIHtcclxuICAgICAgICBjYXNlIFwiTm9kZVwiIC8qIENsaWVudFBsYXRmb3JtLk5PREUgKi86XHJcbiAgICAgICAgICAgIHJldHVybiAnbm9kZSc7XHJcbiAgICAgICAgY2FzZSBcIlJlYWN0TmF0aXZlXCIgLyogQ2xpZW50UGxhdGZvcm0uUkVBQ1RfTkFUSVZFICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ3JuJztcclxuICAgICAgICBjYXNlIFwiV29ya2VyXCIgLyogQ2xpZW50UGxhdGZvcm0uV09SS0VSICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ3dlYndvcmtlcic7XHJcbiAgICAgICAgY2FzZSBcIkNvcmRvdmFcIiAvKiBDbGllbnRQbGF0Zm9ybS5DT1JET1ZBICovOlxyXG4gICAgICAgICAgICByZXR1cm4gJ2NvcmRvdmEnO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbn1cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5mdW5jdGlvbiByZWdpc3RlckF1dGgoY2xpZW50UGxhdGZvcm0pIHtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KFwiYXV0aFwiIC8qIF9Db21wb25lbnROYW1lLkFVVEggKi8sIChjb250YWluZXIsIHsgb3B0aW9uczogZGVwcyB9KSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTtcclxuICAgICAgICBjb25zdCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2hlYXJ0YmVhdCcpO1xyXG4gICAgICAgIGNvbnN0IHsgYXBpS2V5LCBhdXRoRG9tYWluIH0gPSBhcHAub3B0aW9ucztcclxuICAgICAgICByZXR1cm4gKChhcHAsIGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlcikgPT4ge1xyXG4gICAgICAgICAgICBfYXNzZXJ0KGFwaUtleSAmJiAhYXBpS2V5LmluY2x1ZGVzKCc6JyksIFwiaW52YWxpZC1hcGkta2V5XCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FQSV9LRVkgKi8sIHsgYXBwTmFtZTogYXBwLm5hbWUgfSk7XHJcbiAgICAgICAgICAgIC8vIEF1dGggZG9tYWluIGlzIG9wdGlvbmFsIGlmIElkUCBzaWduIGluIGlzbid0IGJlaW5nIHVzZWRcclxuICAgICAgICAgICAgX2Fzc2VydCghKGF1dGhEb21haW4gPT09IG51bGwgfHwgYXV0aERvbWFpbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXV0aERvbWFpbi5pbmNsdWRlcygnOicpKSwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8sIHtcclxuICAgICAgICAgICAgICAgIGFwcE5hbWU6IGFwcC5uYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBjb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICBhcGlLZXksXHJcbiAgICAgICAgICAgICAgICBhdXRoRG9tYWluLFxyXG4gICAgICAgICAgICAgICAgY2xpZW50UGxhdGZvcm0sXHJcbiAgICAgICAgICAgICAgICBhcGlIb3N0OiBcImlkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwiIC8qIERlZmF1bHRDb25maWcuQVBJX0hPU1QgKi8sXHJcbiAgICAgICAgICAgICAgICB0b2tlbkFwaUhvc3Q6IFwic2VjdXJldG9rZW4uZ29vZ2xlYXBpcy5jb21cIiAvKiBEZWZhdWx0Q29uZmlnLlRPS0VOX0FQSV9IT1NUICovLFxyXG4gICAgICAgICAgICAgICAgYXBpU2NoZW1lOiBcImh0dHBzXCIgLyogRGVmYXVsdENvbmZpZy5BUElfU0NIRU1FICovLFxyXG4gICAgICAgICAgICAgICAgc2RrQ2xpZW50VmVyc2lvbjogX2dldENsaWVudFZlcnNpb24oY2xpZW50UGxhdGZvcm0pXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNvbnN0IGF1dGhJbnN0YW5jZSA9IG5ldyBBdXRoSW1wbChhcHAsIGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlciwgY29uZmlnKTtcclxuICAgICAgICAgICAgX2luaXRpYWxpemVBdXRoSW5zdGFuY2UoYXV0aEluc3RhbmNlLCBkZXBzKTtcclxuICAgICAgICAgICAgcmV0dXJuIGF1dGhJbnN0YW5jZTtcclxuICAgICAgICB9KShhcHAsIGhlYXJ0YmVhdFNlcnZpY2VQcm92aWRlcik7XHJcbiAgICB9LCBcIlBVQkxJQ1wiIC8qIENvbXBvbmVudFR5cGUuUFVCTElDICovKVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEF1dGggY2FuIG9ubHkgYmUgaW5pdGlhbGl6ZWQgYnkgZXhwbGljaXRseSBjYWxsaW5nIGdldEF1dGgoKSBvciBpbml0aWFsaXplQXV0aCgpXHJcbiAgICAgICAgICogRm9yIHdoeSB3ZSBkbyB0aGlzLCBTZWUgZ28vZmlyZWJhc2UtbmV4dC1hdXRoLWluaXRcclxuICAgICAgICAgKi9cclxuICAgICAgICAuc2V0SW5zdGFudGlhdGlvbk1vZGUoXCJFWFBMSUNJVFwiIC8qIEluc3RhbnRpYXRpb25Nb2RlLkVYUExJQ0lUICovKVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEJlY2F1c2UgYWxsIGZpcmViYXNlIHByb2R1Y3RzIHRoYXQgZGVwZW5kIG9uIGF1dGggZGVwZW5kIG9uIGF1dGgtaW50ZXJuYWwgZGlyZWN0bHksXHJcbiAgICAgICAgICogd2UgbmVlZCB0byBpbml0aWFsaXplIGF1dGgtaW50ZXJuYWwgYWZ0ZXIgYXV0aCBpcyBpbml0aWFsaXplZCB0byBtYWtlIGl0IGF2YWlsYWJsZSB0byBvdGhlciBmaXJlYmFzZSBwcm9kdWN0cy5cclxuICAgICAgICAgKi9cclxuICAgICAgICAuc2V0SW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2soKGNvbnRhaW5lciwgX2luc3RhbmNlSWRlbnRpZmllciwgX2luc3RhbmNlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYXV0aEludGVybmFsUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoXCJhdXRoLWludGVybmFsXCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSF9JTlRFUk5BTCAqLyk7XHJcbiAgICAgICAgYXV0aEludGVybmFsUHJvdmlkZXIuaW5pdGlhbGl6ZSgpO1xyXG4gICAgfSkpO1xyXG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJhdXRoLWludGVybmFsXCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSF9JTlRFUk5BTCAqLywgY29udGFpbmVyID0+IHtcclxuICAgICAgICBjb25zdCBhdXRoID0gX2Nhc3RBdXRoKGNvbnRhaW5lci5nZXRQcm92aWRlcihcImF1dGhcIiAvKiBfQ29tcG9uZW50TmFtZS5BVVRIICovKS5nZXRJbW1lZGlhdGUoKSk7XHJcbiAgICAgICAgcmV0dXJuIChhdXRoID0+IG5ldyBBdXRoSW50ZXJvcChhdXRoKSkoYXV0aCk7XHJcbiAgICB9LCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pLnNldEluc3RhbnRpYXRpb25Nb2RlKFwiRVhQTElDSVRcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLykpO1xyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24sIGdldFZlcnNpb25Gb3JQbGF0Zm9ybShjbGllbnRQbGF0Zm9ybSkpO1xyXG4gICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtNSwgZXNtMjAxNywgY2pzNSwgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cclxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCAnZXNtMjAxNycpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfSURfVE9LRU5fTUFYX0FHRSA9IDUgKiA2MDtcclxuY29uc3QgYXV0aElkVG9rZW5NYXhBZ2UgPSBnZXRFeHBlcmltZW50YWxTZXR0aW5nKCdhdXRoSWRUb2tlbk1heEFnZScpIHx8IERFRkFVTFRfSURfVE9LRU5fTUFYX0FHRTtcclxubGV0IGxhc3RQb3N0ZWRJZFRva2VuID0gbnVsbDtcclxuY29uc3QgbWludENvb2tpZUZhY3RvcnkgPSAodXJsKSA9PiBhc3luYyAodXNlcikgPT4ge1xyXG4gICAgY29uc3QgaWRUb2tlblJlc3VsdCA9IHVzZXIgJiYgKGF3YWl0IHVzZXIuZ2V0SWRUb2tlblJlc3VsdCgpKTtcclxuICAgIGNvbnN0IGlkVG9rZW5BZ2UgPSBpZFRva2VuUmVzdWx0ICYmXHJcbiAgICAgICAgKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gRGF0ZS5wYXJzZShpZFRva2VuUmVzdWx0Lmlzc3VlZEF0VGltZSkpIC8gMTAwMDtcclxuICAgIGlmIChpZFRva2VuQWdlICYmIGlkVG9rZW5BZ2UgPiBhdXRoSWRUb2tlbk1heEFnZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIFNwZWNpZmljYWxseSB0cmlwIG51bGwgPT4gdW5kZWZpbmVkIHdoZW4gbG9nZ2VkIG91dCwgdG8gZGVsZXRlIGFueSBleGlzdGluZyBjb29raWVcclxuICAgIGNvbnN0IGlkVG9rZW4gPSBpZFRva2VuUmVzdWx0ID09PSBudWxsIHx8IGlkVG9rZW5SZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlkVG9rZW5SZXN1bHQudG9rZW47XHJcbiAgICBpZiAobGFzdFBvc3RlZElkVG9rZW4gPT09IGlkVG9rZW4pIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsYXN0UG9zdGVkSWRUb2tlbiA9IGlkVG9rZW47XHJcbiAgICBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6IGlkVG9rZW4gPyAnUE9TVCcgOiAnREVMRVRFJyxcclxuICAgICAgICBoZWFkZXJzOiBpZFRva2VuXHJcbiAgICAgICAgICAgID8ge1xyXG4gICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aWRUb2tlbn1gXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgOiB7fVxyXG4gICAgfSk7XHJcbn07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSBBdXRoIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJvdmlkZWQge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9LlxyXG4gKiBJZiBubyBpbnN0YW5jZSBleGlzdHMsIGluaXRpYWxpemVzIGFuIEF1dGggaW5zdGFuY2Ugd2l0aCBwbGF0Zm9ybS1zcGVjaWZpYyBkZWZhdWx0IGRlcGVuZGVuY2llcy5cclxuICpcclxuICogQHBhcmFtIGFwcCAtIFRoZSBGaXJlYmFzZSBBcHAuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEF1dGgoYXBwID0gZ2V0QXBwKCkpIHtcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ2F1dGgnKTtcclxuICAgIGlmIChwcm92aWRlci5pc0luaXRpYWxpemVkKCkpIHtcclxuICAgICAgICByZXR1cm4gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoID0gaW5pdGlhbGl6ZUF1dGgoYXBwLCB7XHJcbiAgICAgICAgcG9wdXBSZWRpcmVjdFJlc29sdmVyOiBicm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyLFxyXG4gICAgICAgIHBlcnNpc3RlbmNlOiBbXHJcbiAgICAgICAgICAgIGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UsXHJcbiAgICAgICAgICAgIGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlLFxyXG4gICAgICAgICAgICBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlXHJcbiAgICAgICAgXVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBhdXRoVG9rZW5TeW5jVXJsID0gZ2V0RXhwZXJpbWVudGFsU2V0dGluZygnYXV0aFRva2VuU3luY1VSTCcpO1xyXG4gICAgaWYgKGF1dGhUb2tlblN5bmNVcmwpIHtcclxuICAgICAgICBjb25zdCBtaW50Q29va2llID0gbWludENvb2tpZUZhY3RvcnkoYXV0aFRva2VuU3luY1VybCk7XHJcbiAgICAgICAgYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBtaW50Q29va2llLCAoKSA9PiBtaW50Q29va2llKGF1dGguY3VycmVudFVzZXIpKTtcclxuICAgICAgICBvbklkVG9rZW5DaGFuZ2VkKGF1dGgsIHVzZXIgPT4gbWludENvb2tpZSh1c2VyKSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhdXRoRW11bGF0b3JIb3N0ID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCgnYXV0aCcpO1xyXG4gICAgaWYgKGF1dGhFbXVsYXRvckhvc3QpIHtcclxuICAgICAgICBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsIGBodHRwOi8vJHthdXRoRW11bGF0b3JIb3N0fWApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGF1dGg7XHJcbn1cclxucmVnaXN0ZXJBdXRoKFwiQnJvd3NlclwiIC8qIENsaWVudFBsYXRmb3JtLkJST1dTRVIgKi8pO1xuXG5leHBvcnQgeyBzaWduSW5XaXRoQ3VzdG9tVG9rZW4gYXMgJCwgQWN0aW9uQ29kZU9wZXJhdGlvbiBhcyBBLCBkZWJ1Z0Vycm9yTWFwIGFzIEIsIHByb2RFcnJvck1hcCBhcyBDLCBBVVRIX0VSUk9SX0NPREVTX01BUF9ET19OT1RfVVNFX0lOVEVSTkFMTFkgYXMgRCwgaW5pdGlhbGl6ZUF1dGggYXMgRSwgRmFjdG9ySWQgYXMgRiwgY29ubmVjdEF1dGhFbXVsYXRvciBhcyBHLCBBdXRoQ3JlZGVudGlhbCBhcyBILCBFbWFpbEF1dGhDcmVkZW50aWFsIGFzIEksIE9BdXRoQ3JlZGVudGlhbCBhcyBKLCBQaG9uZUF1dGhDcmVkZW50aWFsIGFzIEssIGluTWVtb3J5UGVyc2lzdGVuY2UgYXMgTCwgRW1haWxBdXRoUHJvdmlkZXIgYXMgTSwgRmFjZWJvb2tBdXRoUHJvdmlkZXIgYXMgTiwgT3BlcmF0aW9uVHlwZSBhcyBPLCBQaG9uZUF1dGhQcm92aWRlciBhcyBQLCBHb29nbGVBdXRoUHJvdmlkZXIgYXMgUSwgUmVjYXB0Y2hhVmVyaWZpZXIgYXMgUiwgU2lnbkluTWV0aG9kIGFzIFMsIEdpdGh1YkF1dGhQcm92aWRlciBhcyBULCBPQXV0aFByb3ZpZGVyIGFzIFUsIFNBTUxBdXRoUHJvdmlkZXIgYXMgViwgVHdpdHRlckF1dGhQcm92aWRlciBhcyBXLCBzaWduSW5Bbm9ueW1vdXNseSBhcyBYLCBzaWduSW5XaXRoQ3JlZGVudGlhbCBhcyBZLCBsaW5rV2l0aENyZWRlbnRpYWwgYXMgWiwgcmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbCBhcyBfLCBicm93c2VyU2Vzc2lvblBlcnNpc3RlbmNlIGFzIGEsIHNlbmRQYXNzd29yZFJlc2V0RW1haWwgYXMgYTAsIGNvbmZpcm1QYXNzd29yZFJlc2V0IGFzIGExLCBhcHBseUFjdGlvbkNvZGUgYXMgYTIsIGNoZWNrQWN0aW9uQ29kZSBhcyBhMywgdmVyaWZ5UGFzc3dvcmRSZXNldENvZGUgYXMgYTQsIGNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZCBhcyBhNSwgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQgYXMgYTYsIHNlbmRTaWduSW5MaW5rVG9FbWFpbCBhcyBhNywgaXNTaWduSW5XaXRoRW1haWxMaW5rIGFzIGE4LCBzaWduSW5XaXRoRW1haWxMaW5rIGFzIGE5LCBfcGVyc2lzdGVuY2VLZXlOYW1lIGFzIGFBLCBfZ2V0UmVkaXJlY3RSZXN1bHQgYXMgYUIsIF9vdmVycmlkZVJlZGlyZWN0UmVzdWx0IGFzIGFDLCBfY2xlYXJSZWRpcmVjdE91dGNvbWVzIGFzIGFELCBfY2FzdEF1dGggYXMgYUUsIFVzZXJJbXBsIGFzIGFGLCBBdXRoSW1wbCBhcyBhRywgX2dldENsaWVudFZlcnNpb24gYXMgYUgsIF9nZW5lcmF0ZUV2ZW50SWQgYXMgYUksIEF1dGhQb3B1cCBhcyBhSiwgRmV0Y2hQcm92aWRlciBhcyBhSywgU0FNTEF1dGhDcmVkZW50aWFsIGFzIGFMLCBmZXRjaFNpZ25Jbk1ldGhvZHNGb3JFbWFpbCBhcyBhYSwgc2VuZEVtYWlsVmVyaWZpY2F0aW9uIGFzIGFiLCB2ZXJpZnlCZWZvcmVVcGRhdGVFbWFpbCBhcyBhYywgQWN0aW9uQ29kZVVSTCBhcyBhZCwgcGFyc2VBY3Rpb25Db2RlVVJMIGFzIGFlLCB1cGRhdGVQcm9maWxlIGFzIGFmLCB1cGRhdGVFbWFpbCBhcyBhZywgdXBkYXRlUGFzc3dvcmQgYXMgYWgsIGdldElkVG9rZW4gYXMgYWksIGdldElkVG9rZW5SZXN1bHQgYXMgYWosIHVubGluayBhcyBhaywgZ2V0QWRkaXRpb25hbFVzZXJJbmZvIGFzIGFsLCByZWxvYWQgYXMgYW0sIGdldE11bHRpRmFjdG9yUmVzb2x2ZXIgYXMgYW4sIG11bHRpRmFjdG9yIGFzIGFvLCBkZWJ1Z0Fzc2VydCBhcyBhcCwgX2lzSU9TIGFzIGFxLCBfaXNBbmRyb2lkIGFzIGFyLCBfZmFpbCBhcyBhcywgX2dldFJlZGlyZWN0VXJsIGFzIGF0LCBfZ2V0UHJvamVjdENvbmZpZyBhcyBhdSwgX2lzSU9TN09yOCBhcyBhdiwgX2NyZWF0ZUVycm9yIGFzIGF3LCBfYXNzZXJ0IGFzIGF4LCBBdXRoRXZlbnRNYW5hZ2VyIGFzIGF5LCBfZ2V0SW5zdGFuY2UgYXMgYXosIGJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlIGFzIGIsIHNpZ25JbldpdGhQb3B1cCBhcyBjLCBsaW5rV2l0aFBvcHVwIGFzIGQsIHJlYXV0aGVudGljYXRlV2l0aFBvcHVwIGFzIGUsIHNpZ25JbldpdGhSZWRpcmVjdCBhcyBmLCBsaW5rV2l0aFJlZGlyZWN0IGFzIGcsIHJlYXV0aGVudGljYXRlV2l0aFJlZGlyZWN0IGFzIGgsIGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UgYXMgaSwgZ2V0UmVkaXJlY3RSZXN1bHQgYXMgaiwgYnJvd3NlclBvcHVwUmVkaXJlY3RSZXNvbHZlciBhcyBrLCBsaW5rV2l0aFBob25lTnVtYmVyIGFzIGwsIFBob25lTXVsdGlGYWN0b3JHZW5lcmF0b3IgYXMgbSwgZ2V0QXV0aCBhcyBuLCBQcm92aWRlcklkIGFzIG8sIHNldFBlcnNpc3RlbmNlIGFzIHAsIG9uSWRUb2tlbkNoYW5nZWQgYXMgcSwgcmVhdXRoZW50aWNhdGVXaXRoUGhvbmVOdW1iZXIgYXMgciwgc2lnbkluV2l0aFBob25lTnVtYmVyIGFzIHMsIGJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQgYXMgdCwgdXBkYXRlUGhvbmVOdW1iZXIgYXMgdSwgb25BdXRoU3RhdGVDaGFuZ2VkIGFzIHYsIHVzZURldmljZUxhbmd1YWdlIGFzIHcsIHVwZGF0ZUN1cnJlbnRVc2VyIGFzIHgsIHNpZ25PdXQgYXMgeSwgZGVsZXRlVXNlciBhcyB6IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC1lNWIzY2M4MS5qcy5tYXBcbiIsInZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9O1xuXG52YXIgZXNtID0ge307XG5cbi8qXG5cbiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4qL1xuXG52YXIgayxnb29nPWdvb2d8fHt9LGw9Y29tbW9uanNHbG9iYWx8fHNlbGY7ZnVuY3Rpb24gYWEoKXt9ZnVuY3Rpb24gYmEoYSl7dmFyIGI9dHlwZW9mIGE7Yj1cIm9iamVjdFwiIT1iP2I6YT9BcnJheS5pc0FycmF5KGEpP1wiYXJyYXlcIjpiOlwibnVsbFwiO3JldHVybiBcImFycmF5XCI9PWJ8fFwib2JqZWN0XCI9PWImJlwibnVtYmVyXCI9PXR5cGVvZiBhLmxlbmd0aH1mdW5jdGlvbiBwKGEpe3ZhciBiPXR5cGVvZiBhO3JldHVybiBcIm9iamVjdFwiPT1iJiZudWxsIT1hfHxcImZ1bmN0aW9uXCI9PWJ9ZnVuY3Rpb24gY2EoYSl7cmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhLGRhKSYmYVtkYV18fChhW2RhXT0rK2VhKX12YXIgZGE9XCJjbG9zdXJlX3VpZF9cIisoMUU5Kk1hdGgucmFuZG9tKCk+Pj4wKSxlYT0wO2Z1bmN0aW9uIGZhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfVxuZnVuY3Rpb24gaGEoYSxiLGMpe2lmKCFhKXRocm93IEVycm9yKCk7aWYoMjxhcmd1bWVudHMubGVuZ3RoKXt2YXIgZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtBcnJheS5wcm90b3R5cGUudW5zaGlmdC5hcHBseShlLGQpO3JldHVybiBhLmFwcGx5KGIsZSl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsYXJndW1lbnRzKX19ZnVuY3Rpb24gcShhLGIsYyl7RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQmJi0xIT1GdW5jdGlvbi5wcm90b3R5cGUuYmluZC50b1N0cmluZygpLmluZGV4T2YoXCJuYXRpdmUgY29kZVwiKT9xPWZhOnE9aGE7cmV0dXJuIHEuYXBwbHkobnVsbCxhcmd1bWVudHMpfVxuZnVuY3Rpb24gaWEoYSxiKXt2YXIgYz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGQ9Yy5zbGljZSgpO2QucHVzaC5hcHBseShkLGFyZ3VtZW50cyk7cmV0dXJuIGEuYXBwbHkodGhpcyxkKX19ZnVuY3Rpb24gdChhLGIpe2Z1bmN0aW9uIGMoKXt9Yy5wcm90b3R5cGU9Yi5wcm90b3R5cGU7YS5YPWIucHJvdG90eXBlO2EucHJvdG90eXBlPW5ldyBjO2EucHJvdG90eXBlLmNvbnN0cnVjdG9yPWE7YS5XYj1mdW5jdGlvbihkLGUsZil7Zm9yKHZhciBoPUFycmF5KGFyZ3VtZW50cy5sZW5ndGgtMiksbj0yO248YXJndW1lbnRzLmxlbmd0aDtuKyspaFtuLTJdPWFyZ3VtZW50c1tuXTtyZXR1cm4gYi5wcm90b3R5cGVbZV0uYXBwbHkoZCxoKX07fWZ1bmN0aW9uIHYoKXt0aGlzLnM9dGhpcy5zO3RoaXMubz10aGlzLm87fXZhciBqYT0wO3YucHJvdG90eXBlLnM9ITE7di5wcm90b3R5cGUubmE9ZnVuY3Rpb24oKXtpZighdGhpcy5zJiYodGhpcy5zPSEwLHRoaXMuTSgpLDAhPWphKSl7Y2EodGhpcyk7fX07di5wcm90b3R5cGUuTT1mdW5jdGlvbigpe2lmKHRoaXMubylmb3IoO3RoaXMuby5sZW5ndGg7KXRoaXMuby5zaGlmdCgpKCk7fTtjb25zdCBsYT1BcnJheS5wcm90b3R5cGUuaW5kZXhPZj9mdW5jdGlvbihhLGIpe3JldHVybiBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGEsYix2b2lkIDApfTpmdW5jdGlvbihhLGIpe2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlyZXR1cm4gXCJzdHJpbmdcIiE9PXR5cGVvZiBifHwxIT1iLmxlbmd0aD8tMTphLmluZGV4T2YoYiwwKTtmb3IobGV0IGM9MDtjPGEubGVuZ3RoO2MrKylpZihjIGluIGEmJmFbY109PT1iKXJldHVybiBjO3JldHVybiAtMX07ZnVuY3Rpb24gbWEoYSl7Y29uc3QgYj1hLmxlbmd0aDtpZigwPGIpe2NvbnN0IGM9QXJyYXkoYik7Zm9yKGxldCBkPTA7ZDxiO2QrKyljW2RdPWFbZF07cmV0dXJuIGN9cmV0dXJuIFtdfVxuZnVuY3Rpb24gbmEoYSxiKXtmb3IobGV0IGM9MTtjPGFyZ3VtZW50cy5sZW5ndGg7YysrKXtjb25zdCBkPWFyZ3VtZW50c1tjXTtpZihiYShkKSl7Y29uc3QgZT1hLmxlbmd0aHx8MCxmPWQubGVuZ3RofHwwO2EubGVuZ3RoPWUrZjtmb3IobGV0IGg9MDtoPGY7aCsrKWFbZStoXT1kW2hdO31lbHNlIGEucHVzaChkKTt9fWZ1bmN0aW9uIHcoYSxiKXt0aGlzLnR5cGU9YTt0aGlzLmc9dGhpcy50YXJnZXQ9Yjt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITE7fXcucHJvdG90eXBlLmg9ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITA7fTt2YXIgb2E9ZnVuY3Rpb24oKXtpZighbC5hZGRFdmVudExpc3RlbmVyfHwhT2JqZWN0LmRlZmluZVByb3BlcnR5KXJldHVybiAhMTt2YXIgYT0hMSxiPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSxcInBhc3NpdmVcIix7Z2V0OmZ1bmN0aW9uKCl7YT0hMDt9fSk7dHJ5e2wuYWRkRXZlbnRMaXN0ZW5lcihcInRlc3RcIixhYSxiKSxsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0ZXN0XCIsYWEsYik7fWNhdGNoKGMpe31yZXR1cm4gYX0oKTtmdW5jdGlvbiBwYShhKXtyZXR1cm4gL15bXFxzXFx4YTBdKiQvLnRlc3QoYSl9dmFyIHFhPVN0cmluZy5wcm90b3R5cGUudHJpbT9mdW5jdGlvbihhKXtyZXR1cm4gYS50cmltKCl9OmZ1bmN0aW9uKGEpe3JldHVybiAvXltcXHNcXHhhMF0qKFtcXHNcXFNdKj8pW1xcc1xceGEwXSokLy5leGVjKGEpWzFdfTtmdW5jdGlvbiByYShhLGIpe3JldHVybiBhPGI/LTE6YT5iPzE6MH1mdW5jdGlvbiBzYSgpe3ZhciBhPWwubmF2aWdhdG9yO3JldHVybiBhJiYoYT1hLnVzZXJBZ2VudCk/YTpcIlwifWZ1bmN0aW9uIHgoYSl7cmV0dXJuIC0xIT1zYSgpLmluZGV4T2YoYSl9ZnVuY3Rpb24gdGEoYSl7dGFbXCIgXCJdKGEpO3JldHVybiBhfXRhW1wiIFwiXT1hYTtmdW5jdGlvbiB1YShhKXt2YXIgYj12YTtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsOSk/Yls5XTpiWzldPWEoOSl9dmFyIHdhPXgoXCJPcGVyYVwiKSx5PXgoXCJUcmlkZW50XCIpfHx4KFwiTVNJRVwiKSx4YT14KFwiRWRnZVwiKSx5YT14YXx8eSx6YT14KFwiR2Vja29cIikmJiEoLTEhPXNhKCkudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwid2Via2l0XCIpJiYheChcIkVkZ2VcIikpJiYhKHgoXCJUcmlkZW50XCIpfHx4KFwiTVNJRVwiKSkmJiF4KFwiRWRnZVwiKSxBYT0tMSE9c2EoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJ3ZWJraXRcIikmJiF4KFwiRWRnZVwiKTtmdW5jdGlvbiBCYSgpe3ZhciBhPWwuZG9jdW1lbnQ7cmV0dXJuIGE/YS5kb2N1bWVudE1vZGU6dm9pZCAwfXZhciBFYTtcbmE6e3ZhciBGYT1cIlwiLEdhPWZ1bmN0aW9uKCl7dmFyIGE9c2EoKTtpZih6YSlyZXR1cm4gL3J2OihbXlxcKTtdKykoXFwpfDspLy5leGVjKGEpO2lmKHhhKXJldHVybiAvRWRnZVxcLyhbXFxkXFwuXSspLy5leGVjKGEpO2lmKHkpcmV0dXJuIC9cXGIoPzpNU0lFfHJ2KVs6IF0oW15cXCk7XSspKFxcKXw7KS8uZXhlYyhhKTtpZihBYSlyZXR1cm4gL1dlYktpdFxcLyhcXFMrKS8uZXhlYyhhKTtpZih3YSlyZXR1cm4gLyg/OlZlcnNpb24pWyBcXC9dPyhcXFMrKS8uZXhlYyhhKX0oKTtHYSYmKEZhPUdhP0dhWzFdOlwiXCIpO2lmKHkpe3ZhciBIYT1CYSgpO2lmKG51bGwhPUhhJiZIYT5wYXJzZUZsb2F0KEZhKSl7RWE9U3RyaW5nKEhhKTticmVhayBhfX1FYT1GYTt9dmFyIHZhPXt9O1xuZnVuY3Rpb24gSWEoKXtyZXR1cm4gdWEoZnVuY3Rpb24oKXtsZXQgYT0wO2NvbnN0IGI9cWEoU3RyaW5nKEVhKSkuc3BsaXQoXCIuXCIpLGM9cWEoXCI5XCIpLnNwbGl0KFwiLlwiKSxkPU1hdGgubWF4KGIubGVuZ3RoLGMubGVuZ3RoKTtmb3IobGV0IGg9MDswPT1hJiZoPGQ7aCsrKXt2YXIgZT1iW2hdfHxcIlwiLGY9Y1toXXx8XCJcIjtkb3tlPS8oXFxkKikoXFxEKikoLiopLy5leGVjKGUpfHxbXCJcIixcIlwiLFwiXCIsXCJcIl07Zj0vKFxcZCopKFxcRCopKC4qKS8uZXhlYyhmKXx8W1wiXCIsXCJcIixcIlwiLFwiXCJdO2lmKDA9PWVbMF0ubGVuZ3RoJiYwPT1mWzBdLmxlbmd0aClicmVhazthPXJhKDA9PWVbMV0ubGVuZ3RoPzA6cGFyc2VJbnQoZVsxXSwxMCksMD09ZlsxXS5sZW5ndGg/MDpwYXJzZUludChmWzFdLDEwKSl8fHJhKDA9PWVbMl0ubGVuZ3RoLDA9PWZbMl0ubGVuZ3RoKXx8cmEoZVsyXSxmWzJdKTtlPWVbM107Zj1mWzNdO313aGlsZSgwPT1hKX1yZXR1cm4gMDw9YX0pfXZhciBKYTtcbmlmKGwuZG9jdW1lbnQmJnkpe3ZhciBLYT1CYSgpO0phPUthP0thOnBhcnNlSW50KEVhLDEwKXx8dm9pZCAwO31lbHNlIEphPXZvaWQgMDt2YXIgTGE9SmE7ZnVuY3Rpb24geihhLGIpe3cuY2FsbCh0aGlzLGE/YS50eXBlOlwiXCIpO3RoaXMucmVsYXRlZFRhcmdldD10aGlzLmc9dGhpcy50YXJnZXQ9bnVsbDt0aGlzLmJ1dHRvbj10aGlzLnNjcmVlblk9dGhpcy5zY3JlZW5YPXRoaXMuY2xpZW50WT10aGlzLmNsaWVudFg9MDt0aGlzLmtleT1cIlwiO3RoaXMubWV0YUtleT10aGlzLnNoaWZ0S2V5PXRoaXMuYWx0S2V5PXRoaXMuY3RybEtleT0hMTt0aGlzLnN0YXRlPW51bGw7dGhpcy5wb2ludGVySWQ9MDt0aGlzLnBvaW50ZXJUeXBlPVwiXCI7dGhpcy5pPW51bGw7aWYoYSl7dmFyIGM9dGhpcy50eXBlPWEudHlwZSxkPWEuY2hhbmdlZFRvdWNoZXMmJmEuY2hhbmdlZFRvdWNoZXMubGVuZ3RoP2EuY2hhbmdlZFRvdWNoZXNbMF06bnVsbDt0aGlzLnRhcmdldD1hLnRhcmdldHx8YS5zcmNFbGVtZW50O3RoaXMuZz1iO2lmKGI9YS5yZWxhdGVkVGFyZ2V0KXtpZih6YSl7YTp7dHJ5e3RhKGIubm9kZU5hbWUpO3ZhciBlPSEwO2JyZWFrIGF9Y2F0Y2goZil7fWU9XG4hMTt9ZXx8KGI9bnVsbCk7fX1lbHNlIFwibW91c2VvdmVyXCI9PWM/Yj1hLmZyb21FbGVtZW50OlwibW91c2VvdXRcIj09YyYmKGI9YS50b0VsZW1lbnQpO3RoaXMucmVsYXRlZFRhcmdldD1iO2Q/KHRoaXMuY2xpZW50WD12b2lkIDAhPT1kLmNsaWVudFg/ZC5jbGllbnRYOmQucGFnZVgsdGhpcy5jbGllbnRZPXZvaWQgMCE9PWQuY2xpZW50WT9kLmNsaWVudFk6ZC5wYWdlWSx0aGlzLnNjcmVlblg9ZC5zY3JlZW5YfHwwLHRoaXMuc2NyZWVuWT1kLnNjcmVlbll8fDApOih0aGlzLmNsaWVudFg9dm9pZCAwIT09YS5jbGllbnRYP2EuY2xpZW50WDphLnBhZ2VYLHRoaXMuY2xpZW50WT12b2lkIDAhPT1hLmNsaWVudFk/YS5jbGllbnRZOmEucGFnZVksdGhpcy5zY3JlZW5YPWEuc2NyZWVuWHx8MCx0aGlzLnNjcmVlblk9YS5zY3JlZW5ZfHwwKTt0aGlzLmJ1dHRvbj1hLmJ1dHRvbjt0aGlzLmtleT1hLmtleXx8XCJcIjt0aGlzLmN0cmxLZXk9YS5jdHJsS2V5O3RoaXMuYWx0S2V5PWEuYWx0S2V5O3RoaXMuc2hpZnRLZXk9XG5hLnNoaWZ0S2V5O3RoaXMubWV0YUtleT1hLm1ldGFLZXk7dGhpcy5wb2ludGVySWQ9YS5wb2ludGVySWR8fDA7dGhpcy5wb2ludGVyVHlwZT1cInN0cmluZ1wiPT09dHlwZW9mIGEucG9pbnRlclR5cGU/YS5wb2ludGVyVHlwZTpNYVthLnBvaW50ZXJUeXBlXXx8XCJcIjt0aGlzLnN0YXRlPWEuc3RhdGU7dGhpcy5pPWE7YS5kZWZhdWx0UHJldmVudGVkJiZ6LlguaC5jYWxsKHRoaXMpO319dCh6LHcpO3ZhciBNYT17MjpcInRvdWNoXCIsMzpcInBlblwiLDQ6XCJtb3VzZVwifTt6LnByb3RvdHlwZS5oPWZ1bmN0aW9uKCl7ei5YLmguY2FsbCh0aGlzKTt2YXIgYT10aGlzLmk7YS5wcmV2ZW50RGVmYXVsdD9hLnByZXZlbnREZWZhdWx0KCk6YS5yZXR1cm5WYWx1ZT0hMTt9O3ZhciBBPVwiY2xvc3VyZV9saXN0ZW5hYmxlX1wiKygxRTYqTWF0aC5yYW5kb20oKXwwKTt2YXIgTmE9MDtmdW5jdGlvbiBPYShhLGIsYyxkLGUpe3RoaXMubGlzdGVuZXI9YTt0aGlzLnByb3h5PW51bGw7dGhpcy5zcmM9Yjt0aGlzLnR5cGU9Yzt0aGlzLmNhcHR1cmU9ISFkO3RoaXMuaGE9ZTt0aGlzLmtleT0rK05hO3RoaXMuYmE9dGhpcy5lYT0hMTt9ZnVuY3Rpb24gUGEoYSl7YS5iYT0hMDthLmxpc3RlbmVyPW51bGw7YS5wcm94eT1udWxsO2Euc3JjPW51bGw7YS5oYT1udWxsO31mdW5jdGlvbiBRYShhLGIsYyl7Zm9yKGNvbnN0IGQgaW4gYSliLmNhbGwoYyxhW2RdLGQsYSk7fWZ1bmN0aW9uIFJhKGEpe2NvbnN0IGI9e307Zm9yKGNvbnN0IGMgaW4gYSliW2NdPWFbY107cmV0dXJuIGJ9Y29uc3QgU2E9XCJjb25zdHJ1Y3RvciBoYXNPd25Qcm9wZXJ0eSBpc1Byb3RvdHlwZU9mIHByb3BlcnR5SXNFbnVtZXJhYmxlIHRvTG9jYWxlU3RyaW5nIHRvU3RyaW5nIHZhbHVlT2ZcIi5zcGxpdChcIiBcIik7ZnVuY3Rpb24gVGEoYSxiKXtsZXQgYyxkO2ZvcihsZXQgZT0xO2U8YXJndW1lbnRzLmxlbmd0aDtlKyspe2Q9YXJndW1lbnRzW2VdO2ZvcihjIGluIGQpYVtjXT1kW2NdO2ZvcihsZXQgZj0wO2Y8U2EubGVuZ3RoO2YrKyljPVNhW2ZdLE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkLGMpJiYoYVtjXT1kW2NdKTt9fWZ1bmN0aW9uIFVhKGEpe3RoaXMuc3JjPWE7dGhpcy5nPXt9O3RoaXMuaD0wO31VYS5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9YS50b1N0cmluZygpO2E9dGhpcy5nW2ZdO2F8fChhPXRoaXMuZ1tmXT1bXSx0aGlzLmgrKyk7dmFyIGg9VmEoYSxiLGQsZSk7LTE8aD8oYj1hW2hdLGN8fChiLmVhPSExKSk6KGI9bmV3IE9hKGIsdGhpcy5zcmMsZiwhIWQsZSksYi5lYT1jLGEucHVzaChiKSk7cmV0dXJuIGJ9O2Z1bmN0aW9uIFdhKGEsYil7dmFyIGM9Yi50eXBlO2lmKGMgaW4gYS5nKXt2YXIgZD1hLmdbY10sZT1sYShkLGIpLGY7KGY9MDw9ZSkmJkFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbChkLGUsMSk7ZiYmKFBhKGIpLDA9PWEuZ1tjXS5sZW5ndGgmJihkZWxldGUgYS5nW2NdLGEuaC0tKSk7fX1cbmZ1bmN0aW9uIFZhKGEsYixjLGQpe2Zvcih2YXIgZT0wO2U8YS5sZW5ndGg7KytlKXt2YXIgZj1hW2VdO2lmKCFmLmJhJiZmLmxpc3RlbmVyPT1iJiZmLmNhcHR1cmU9PSEhYyYmZi5oYT09ZClyZXR1cm4gZX1yZXR1cm4gLTF9dmFyIFhhPVwiY2xvc3VyZV9sbV9cIisoMUU2Kk1hdGgucmFuZG9tKCl8MCksWWE9e307ZnVuY3Rpb24gJGEoYSxiLGMsZCxlKXtpZihkJiZkLm9uY2UpcmV0dXJuIGFiKGEsYixjLGQsZSk7aWYoQXJyYXkuaXNBcnJheShiKSl7Zm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspJGEoYSxiW2ZdLGMsZCxlKTtyZXR1cm4gbnVsbH1jPWJiKGMpO3JldHVybiBhJiZhW0FdP2EuTihiLGMscChkKT8hIWQuY2FwdHVyZTohIWQsZSk6Y2IoYSxiLGMsITEsZCxlKX1cbmZ1bmN0aW9uIGNiKGEsYixjLGQsZSxmKXtpZighYil0aHJvdyBFcnJvcihcIkludmFsaWQgZXZlbnQgdHlwZVwiKTt2YXIgaD1wKGUpPyEhZS5jYXB0dXJlOiEhZSxuPWRiKGEpO258fChhW1hhXT1uPW5ldyBVYShhKSk7Yz1uLmFkZChiLGMsZCxoLGYpO2lmKGMucHJveHkpcmV0dXJuIGM7ZD1lYigpO2MucHJveHk9ZDtkLnNyYz1hO2QubGlzdGVuZXI9YztpZihhLmFkZEV2ZW50TGlzdGVuZXIpb2F8fChlPWgpLHZvaWQgMD09PWUmJihlPSExKSxhLmFkZEV2ZW50TGlzdGVuZXIoYi50b1N0cmluZygpLGQsZSk7ZWxzZSBpZihhLmF0dGFjaEV2ZW50KWEuYXR0YWNoRXZlbnQoZmIoYi50b1N0cmluZygpKSxkKTtlbHNlIGlmKGEuYWRkTGlzdGVuZXImJmEucmVtb3ZlTGlzdGVuZXIpYS5hZGRMaXN0ZW5lcihkKTtlbHNlIHRocm93IEVycm9yKFwiYWRkRXZlbnRMaXN0ZW5lciBhbmQgYXR0YWNoRXZlbnQgYXJlIHVuYXZhaWxhYmxlLlwiKTtyZXR1cm4gY31cbmZ1bmN0aW9uIGViKCl7ZnVuY3Rpb24gYShjKXtyZXR1cm4gYi5jYWxsKGEuc3JjLGEubGlzdGVuZXIsYyl9Y29uc3QgYj1nYjtyZXR1cm4gYX1mdW5jdGlvbiBhYihhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpe2Zvcih2YXIgZj0wO2Y8Yi5sZW5ndGg7ZisrKWFiKGEsYltmXSxjLGQsZSk7cmV0dXJuIG51bGx9Yz1iYihjKTtyZXR1cm4gYSYmYVtBXT9hLk8oYixjLHAoZCk/ISFkLmNhcHR1cmU6ISFkLGUpOmNiKGEsYixjLCEwLGQsZSl9XG5mdW5jdGlvbiBoYihhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpZm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspaGIoYSxiW2ZdLGMsZCxlKTtlbHNlIChkPXAoZCk/ISFkLmNhcHR1cmU6ISFkLGM9YmIoYyksYSYmYVtBXSk/KGE9YS5pLGI9U3RyaW5nKGIpLnRvU3RyaW5nKCksYiBpbiBhLmcmJihmPWEuZ1tiXSxjPVZhKGYsYyxkLGUpLC0xPGMmJihQYShmW2NdKSxBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoZixjLDEpLDA9PWYubGVuZ3RoJiYoZGVsZXRlIGEuZ1tiXSxhLmgtLSkpKSk6YSYmKGE9ZGIoYSkpJiYoYj1hLmdbYi50b1N0cmluZygpXSxhPS0xLGImJihhPVZhKGIsYyxkLGUpKSwoYz0tMTxhP2JbYV06bnVsbCkmJmliKGMpKTt9XG5mdW5jdGlvbiBpYihhKXtpZihcIm51bWJlclwiIT09dHlwZW9mIGEmJmEmJiFhLmJhKXt2YXIgYj1hLnNyYztpZihiJiZiW0FdKVdhKGIuaSxhKTtlbHNlIHt2YXIgYz1hLnR5cGUsZD1hLnByb3h5O2IucmVtb3ZlRXZlbnRMaXN0ZW5lcj9iLnJlbW92ZUV2ZW50TGlzdGVuZXIoYyxkLGEuY2FwdHVyZSk6Yi5kZXRhY2hFdmVudD9iLmRldGFjaEV2ZW50KGZiKGMpLGQpOmIuYWRkTGlzdGVuZXImJmIucmVtb3ZlTGlzdGVuZXImJmIucmVtb3ZlTGlzdGVuZXIoZCk7KGM9ZGIoYikpPyhXYShjLGEpLDA9PWMuaCYmKGMuc3JjPW51bGwsYltYYV09bnVsbCkpOlBhKGEpO319fWZ1bmN0aW9uIGZiKGEpe3JldHVybiBhIGluIFlhP1lhW2FdOllhW2FdPVwib25cIithfWZ1bmN0aW9uIGdiKGEsYil7aWYoYS5iYSlhPSEwO2Vsc2Uge2I9bmV3IHooYix0aGlzKTt2YXIgYz1hLmxpc3RlbmVyLGQ9YS5oYXx8YS5zcmM7YS5lYSYmaWIoYSk7YT1jLmNhbGwoZCxiKTt9cmV0dXJuIGF9XG5mdW5jdGlvbiBkYihhKXthPWFbWGFdO3JldHVybiBhIGluc3RhbmNlb2YgVWE/YTpudWxsfXZhciBqYj1cIl9fY2xvc3VyZV9ldmVudHNfZm5fXCIrKDFFOSpNYXRoLnJhbmRvbSgpPj4+MCk7ZnVuY3Rpb24gYmIoYSl7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGEpcmV0dXJuIGE7YVtqYl18fChhW2piXT1mdW5jdGlvbihiKXtyZXR1cm4gYS5oYW5kbGVFdmVudChiKX0pO3JldHVybiBhW2piXX1mdW5jdGlvbiBCKCl7di5jYWxsKHRoaXMpO3RoaXMuaT1uZXcgVWEodGhpcyk7dGhpcy5QPXRoaXM7dGhpcy5JPW51bGw7fXQoQix2KTtCLnByb3RvdHlwZVtBXT0hMDtCLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYixjLGQpe2hiKHRoaXMsYSxiLGMsZCk7fTtcbmZ1bmN0aW9uIEMoYSxiKXt2YXIgYyxkPWEuSTtpZihkKWZvcihjPVtdO2Q7ZD1kLkkpYy5wdXNoKGQpO2E9YS5QO2Q9Yi50eXBlfHxiO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYiliPW5ldyB3KGIsYSk7ZWxzZSBpZihiIGluc3RhbmNlb2YgdyliLnRhcmdldD1iLnRhcmdldHx8YTtlbHNlIHt2YXIgZT1iO2I9bmV3IHcoZCxhKTtUYShiLGUpO31lPSEwO2lmKGMpZm9yKHZhciBmPWMubGVuZ3RoLTE7MDw9ZjtmLS0pe3ZhciBoPWIuZz1jW2ZdO2U9a2IoaCxkLCEwLGIpJiZlO31oPWIuZz1hO2U9a2IoaCxkLCEwLGIpJiZlO2U9a2IoaCxkLCExLGIpJiZlO2lmKGMpZm9yKGY9MDtmPGMubGVuZ3RoO2YrKyloPWIuZz1jW2ZdLGU9a2IoaCxkLCExLGIpJiZlO31cbkIucHJvdG90eXBlLk09ZnVuY3Rpb24oKXtCLlguTS5jYWxsKHRoaXMpO2lmKHRoaXMuaSl7dmFyIGE9dGhpcy5pLGM7Zm9yKGMgaW4gYS5nKXtmb3IodmFyIGQ9YS5nW2NdLGU9MDtlPGQubGVuZ3RoO2UrKylQYShkW2VdKTtkZWxldGUgYS5nW2NdO2EuaC0tO319dGhpcy5JPW51bGw7fTtCLnByb3RvdHlwZS5OPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmkuYWRkKFN0cmluZyhhKSxiLCExLGMsZCl9O0IucHJvdG90eXBlLk89ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMuaS5hZGQoU3RyaW5nKGEpLGIsITAsYyxkKX07XG5mdW5jdGlvbiBrYihhLGIsYyxkKXtiPWEuaS5nW1N0cmluZyhiKV07aWYoIWIpcmV0dXJuICEwO2I9Yi5jb25jYXQoKTtmb3IodmFyIGU9ITAsZj0wO2Y8Yi5sZW5ndGg7KytmKXt2YXIgaD1iW2ZdO2lmKGgmJiFoLmJhJiZoLmNhcHR1cmU9PWMpe3ZhciBuPWgubGlzdGVuZXIsdT1oLmhhfHxoLnNyYztoLmVhJiZXYShhLmksaCk7ZT0hMSE9PW4uY2FsbCh1LGQpJiZlO319cmV0dXJuIGUmJiFkLmRlZmF1bHRQcmV2ZW50ZWR9dmFyIGxiPWwuSlNPTi5zdHJpbmdpZnk7ZnVuY3Rpb24gbWIoKXt2YXIgYT1uYjtsZXQgYj1udWxsO2EuZyYmKGI9YS5nLGEuZz1hLmcubmV4dCxhLmd8fChhLmg9bnVsbCksYi5uZXh0PW51bGwpO3JldHVybiBifWNsYXNzIG9ie2NvbnN0cnVjdG9yKCl7dGhpcy5oPXRoaXMuZz1udWxsO31hZGQoYSxiKXtjb25zdCBjPXBiLmdldCgpO2Muc2V0KGEsYik7dGhpcy5oP3RoaXMuaC5uZXh0PWM6dGhpcy5nPWM7dGhpcy5oPWM7fX12YXIgcGI9bmV3IGNsYXNze2NvbnN0cnVjdG9yKGEsYil7dGhpcy5pPWE7dGhpcy5qPWI7dGhpcy5oPTA7dGhpcy5nPW51bGw7fWdldCgpe2xldCBhOzA8dGhpcy5oPyh0aGlzLmgtLSxhPXRoaXMuZyx0aGlzLmc9YS5uZXh0LGEubmV4dD1udWxsKTphPXRoaXMuaSgpO3JldHVybiBhfX0oKCk9Pm5ldyBxYixhPT5hLnJlc2V0KCkpO1xuY2xhc3MgcWJ7Y29uc3RydWN0b3IoKXt0aGlzLm5leHQ9dGhpcy5nPXRoaXMuaD1udWxsO31zZXQoYSxiKXt0aGlzLmg9YTt0aGlzLmc9Yjt0aGlzLm5leHQ9bnVsbDt9cmVzZXQoKXt0aGlzLm5leHQ9dGhpcy5nPXRoaXMuaD1udWxsO319ZnVuY3Rpb24gcmIoYSl7bC5zZXRUaW1lb3V0KCgpPT57dGhyb3cgYTt9LDApO31mdW5jdGlvbiBzYihhLGIpe3VifHx2YigpO3difHwodWIoKSx3Yj0hMCk7bmIuYWRkKGEsYik7fXZhciB1YjtmdW5jdGlvbiB2Yigpe3ZhciBhPWwuUHJvbWlzZS5yZXNvbHZlKHZvaWQgMCk7dWI9ZnVuY3Rpb24oKXthLnRoZW4oeGIpO307fXZhciB3Yj0hMSxuYj1uZXcgb2I7ZnVuY3Rpb24geGIoKXtmb3IodmFyIGE7YT1tYigpOyl7dHJ5e2EuaC5jYWxsKGEuZyk7fWNhdGNoKGMpe3JiKGMpO312YXIgYj1wYjtiLmooYSk7MTAwPmIuaCYmKGIuaCsrLGEubmV4dD1iLmcsYi5nPWEpO313Yj0hMTt9ZnVuY3Rpb24geWIoYSxiKXtCLmNhbGwodGhpcyk7dGhpcy5oPWF8fDE7dGhpcy5nPWJ8fGw7dGhpcy5qPXEodGhpcy5sYix0aGlzKTt0aGlzLmw9RGF0ZS5ub3coKTt9dCh5YixCKTtrPXliLnByb3RvdHlwZTtrLmNhPSExO2suUj1udWxsO2subGI9ZnVuY3Rpb24oKXtpZih0aGlzLmNhKXt2YXIgYT1EYXRlLm5vdygpLXRoaXMubDswPGEmJmE8LjgqdGhpcy5oP3RoaXMuUj10aGlzLmcuc2V0VGltZW91dCh0aGlzLmosdGhpcy5oLWEpOih0aGlzLlImJih0aGlzLmcuY2xlYXJUaW1lb3V0KHRoaXMuUiksdGhpcy5SPW51bGwpLEModGhpcyxcInRpY2tcIiksdGhpcy5jYSYmKHpiKHRoaXMpLHRoaXMuc3RhcnQoKSkpO319O2suc3RhcnQ9ZnVuY3Rpb24oKXt0aGlzLmNhPSEwO3RoaXMuUnx8KHRoaXMuUj10aGlzLmcuc2V0VGltZW91dCh0aGlzLmosdGhpcy5oKSx0aGlzLmw9RGF0ZS5ub3coKSk7fTtcbmZ1bmN0aW9uIHpiKGEpe2EuY2E9ITE7YS5SJiYoYS5nLmNsZWFyVGltZW91dChhLlIpLGEuUj1udWxsKTt9ay5NPWZ1bmN0aW9uKCl7eWIuWC5NLmNhbGwodGhpcyk7emIodGhpcyk7ZGVsZXRlIHRoaXMuZzt9O2Z1bmN0aW9uIEFiKGEsYixjKXtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2YgYSljJiYoYT1xKGEsYykpO2Vsc2UgaWYoYSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYS5oYW5kbGVFdmVudClhPXEoYS5oYW5kbGVFdmVudCxhKTtlbHNlIHRocm93IEVycm9yKFwiSW52YWxpZCBsaXN0ZW5lciBhcmd1bWVudFwiKTtyZXR1cm4gMjE0NzQ4MzY0NzxOdW1iZXIoYik/LTE6bC5zZXRUaW1lb3V0KGEsYnx8MCl9ZnVuY3Rpb24gQmIoYSl7YS5nPUFiKCgpPT57YS5nPW51bGw7YS5pJiYoYS5pPSExLEJiKGEpKTt9LGEuaik7Y29uc3QgYj1hLmg7YS5oPW51bGw7YS5tLmFwcGx5KG51bGwsYik7fWNsYXNzIENiIGV4dGVuZHMgdntjb25zdHJ1Y3RvcihhLGIpe3N1cGVyKCk7dGhpcy5tPWE7dGhpcy5qPWI7dGhpcy5oPW51bGw7dGhpcy5pPSExO3RoaXMuZz1udWxsO31sKGEpe3RoaXMuaD1hcmd1bWVudHM7dGhpcy5nP3RoaXMuaT0hMDpCYih0aGlzKTt9TSgpe3N1cGVyLk0oKTt0aGlzLmcmJihsLmNsZWFyVGltZW91dCh0aGlzLmcpLHRoaXMuZz1udWxsLHRoaXMuaT0hMSx0aGlzLmg9bnVsbCk7fX1mdW5jdGlvbiBEKGEpe3YuY2FsbCh0aGlzKTt0aGlzLmg9YTt0aGlzLmc9e307fXQoRCx2KTt2YXIgRGI9W107ZnVuY3Rpb24gRWIoYSxiLGMsZCl7QXJyYXkuaXNBcnJheShjKXx8KGMmJihEYlswXT1jLnRvU3RyaW5nKCkpLGM9RGIpO2Zvcih2YXIgZT0wO2U8Yy5sZW5ndGg7ZSsrKXt2YXIgZj0kYShiLGNbZV0sZHx8YS5oYW5kbGVFdmVudCwhMSxhLmh8fGEpO2lmKCFmKWJyZWFrO2EuZ1tmLmtleV09Zjt9fWZ1bmN0aW9uIEZiKGEpe1FhKGEuZyxmdW5jdGlvbihiLGMpe3RoaXMuZy5oYXNPd25Qcm9wZXJ0eShjKSYmaWIoYik7fSxhKTthLmc9e307fUQucHJvdG90eXBlLk09ZnVuY3Rpb24oKXtELlguTS5jYWxsKHRoaXMpO0ZiKHRoaXMpO307RC5wcm90b3R5cGUuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oKXt0aHJvdyBFcnJvcihcIkV2ZW50SGFuZGxlci5oYW5kbGVFdmVudCBub3QgaW1wbGVtZW50ZWRcIik7fTtmdW5jdGlvbiBHYigpe3RoaXMuZz0hMDt9R2IucHJvdG90eXBlLkFhPWZ1bmN0aW9uKCl7dGhpcy5nPSExO307ZnVuY3Rpb24gSGIoYSxiLGMsZCxlLGYpe2EuaW5mbyhmdW5jdGlvbigpe2lmKGEuZylpZihmKXt2YXIgaD1cIlwiO2Zvcih2YXIgbj1mLnNwbGl0KFwiJlwiKSx1PTA7dTxuLmxlbmd0aDt1Kyspe3ZhciBtPW5bdV0uc3BsaXQoXCI9XCIpO2lmKDE8bS5sZW5ndGgpe3ZhciByPW1bMF07bT1tWzFdO3ZhciBGPXIuc3BsaXQoXCJfXCIpO2g9Mjw9Ri5sZW5ndGgmJlwidHlwZVwiPT1GWzFdP2grKHIrXCI9XCIrbStcIiZcIik6aCsocitcIj1yZWRhY3RlZCZcIik7fX19ZWxzZSBoPW51bGw7ZWxzZSBoPWY7cmV0dXJuIFwiWE1MSFRUUCBSRVEgKFwiK2QrXCIpIFthdHRlbXB0IFwiK2UrXCJdOiBcIitiK1wiXFxuXCIrYytcIlxcblwiK2h9KTt9XG5mdW5jdGlvbiBJYihhLGIsYyxkLGUsZixoKXthLmluZm8oZnVuY3Rpb24oKXtyZXR1cm4gXCJYTUxIVFRQIFJFU1AgKFwiK2QrXCIpIFsgYXR0ZW1wdCBcIitlK1wiXTogXCIrYitcIlxcblwiK2MrXCJcXG5cIitmK1wiIFwiK2h9KTt9ZnVuY3Rpb24gRShhLGIsYyxkKXthLmluZm8oZnVuY3Rpb24oKXtyZXR1cm4gXCJYTUxIVFRQIFRFWFQgKFwiK2IrXCIpOiBcIitKYihhLGMpKyhkP1wiIFwiK2Q6XCJcIil9KTt9ZnVuY3Rpb24gS2IoYSxiKXthLmluZm8oZnVuY3Rpb24oKXtyZXR1cm4gXCJUSU1FT1VUOiBcIitifSk7fUdiLnByb3RvdHlwZS5pbmZvPWZ1bmN0aW9uKCl7fTtcbmZ1bmN0aW9uIEpiKGEsYil7aWYoIWEuZylyZXR1cm4gYjtpZighYilyZXR1cm4gbnVsbDt0cnl7dmFyIGM9SlNPTi5wYXJzZShiKTtpZihjKWZvcihhPTA7YTxjLmxlbmd0aDthKyspaWYoQXJyYXkuaXNBcnJheShjW2FdKSl7dmFyIGQ9Y1thXTtpZighKDI+ZC5sZW5ndGgpKXt2YXIgZT1kWzFdO2lmKEFycmF5LmlzQXJyYXkoZSkmJiEoMT5lLmxlbmd0aCkpe3ZhciBmPWVbMF07aWYoXCJub29wXCIhPWYmJlwic3RvcFwiIT1mJiZcImNsb3NlXCIhPWYpZm9yKHZhciBoPTE7aDxlLmxlbmd0aDtoKyspZVtoXT1cIlwiO319fXJldHVybiBsYihjKX1jYXRjaChuKXtyZXR1cm4gYn19dmFyIEc9e30sTGI9bnVsbDtmdW5jdGlvbiBNYigpe3JldHVybiBMYj1MYnx8bmV3IEJ9Ry5QYT1cInNlcnZlcnJlYWNoYWJpbGl0eVwiO2Z1bmN0aW9uIE5iKGEpe3cuY2FsbCh0aGlzLEcuUGEsYSk7fXQoTmIsdyk7ZnVuY3Rpb24gSChhKXtjb25zdCBiPU1iKCk7QyhiLG5ldyBOYihiKSk7fUcuU1RBVF9FVkVOVD1cInN0YXRldmVudFwiO2Z1bmN0aW9uIE9iKGEsYil7dy5jYWxsKHRoaXMsRy5TVEFUX0VWRU5ULGEpO3RoaXMuc3RhdD1iO310KE9iLHcpO2Z1bmN0aW9uIEkoYSl7Y29uc3QgYj1NYigpO0MoYixuZXcgT2IoYixhKSk7fUcuUWE9XCJ0aW1pbmdldmVudFwiO2Z1bmN0aW9uIFBiKGEsYil7dy5jYWxsKHRoaXMsRy5RYSxhKTt0aGlzLnNpemU9Yjt9dChQYix3KTtcbmZ1bmN0aW9uIEooYSxiKXtpZihcImZ1bmN0aW9uXCIhPT10eXBlb2YgYSl0aHJvdyBFcnJvcihcIkZuIG11c3Qgbm90IGJlIG51bGwgYW5kIG11c3QgYmUgYSBmdW5jdGlvblwiKTtyZXR1cm4gbC5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YSgpO30sYil9dmFyIFFiPXtOT19FUlJPUjowLG1iOjEsemI6Mix5YjozLHRiOjQseGI6NSxBYjo2LE1hOjcsVElNRU9VVDo4LERiOjl9O3ZhciBSYj17cmI6XCJjb21wbGV0ZVwiLE5iOlwic3VjY2Vzc1wiLE5hOlwiZXJyb3JcIixNYTpcImFib3J0XCIsRmI6XCJyZWFkeVwiLEdiOlwicmVhZHlzdGF0ZWNoYW5nZVwiLFRJTUVPVVQ6XCJ0aW1lb3V0XCIsQmI6XCJpbmNyZW1lbnRhbGRhdGFcIixFYjpcInByb2dyZXNzXCIsdWI6XCJkb3dubG9hZHByb2dyZXNzXCIsVmI6XCJ1cGxvYWRwcm9ncmVzc1wifTtmdW5jdGlvbiBTYigpe31TYi5wcm90b3R5cGUuaD1udWxsO2Z1bmN0aW9uIFRiKGEpe3JldHVybiBhLmh8fChhLmg9YS5pKCkpfWZ1bmN0aW9uIFViKCl7fXZhciBLPXtPUEVOOlwiYVwiLHFiOlwiYlwiLE5hOlwiY1wiLENiOlwiZFwifTtmdW5jdGlvbiBWYigpe3cuY2FsbCh0aGlzLFwiZFwiKTt9dChWYix3KTtmdW5jdGlvbiBXYigpe3cuY2FsbCh0aGlzLFwiY1wiKTt9dChXYix3KTt2YXIgWGI7ZnVuY3Rpb24gWWIoKXt9dChZYixTYik7WWIucHJvdG90eXBlLmc9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0fTtZYi5wcm90b3R5cGUuaT1mdW5jdGlvbigpe3JldHVybiB7fX07WGI9bmV3IFliO2Z1bmN0aW9uIEwoYSxiLGMsZCl7dGhpcy5sPWE7dGhpcy5qPWI7dGhpcy5tPWM7dGhpcy5VPWR8fDE7dGhpcy5TPW5ldyBEKHRoaXMpO3RoaXMuTz1aYjthPXlhPzEyNTp2b2lkIDA7dGhpcy5UPW5ldyB5YihhKTt0aGlzLkg9bnVsbDt0aGlzLmk9ITE7dGhpcy5zPXRoaXMuQT10aGlzLnY9dGhpcy5LPXRoaXMuRj10aGlzLlY9dGhpcy5CPW51bGw7dGhpcy5EPVtdO3RoaXMuZz1udWxsO3RoaXMuQz0wO3RoaXMubz10aGlzLnU9bnVsbDt0aGlzLlk9LTE7dGhpcy5JPSExO3RoaXMuTj0wO3RoaXMuTD1udWxsO3RoaXMuJD10aGlzLko9dGhpcy5aPXRoaXMuUD0hMTt0aGlzLmg9bmV3ICRiO31mdW5jdGlvbiAkYigpe3RoaXMuaT1udWxsO3RoaXMuZz1cIlwiO3RoaXMuaD0hMTt9dmFyIFpiPTQ1RTMsYWM9e30sYmM9e307az1MLnByb3RvdHlwZTtrLnNldFRpbWVvdXQ9ZnVuY3Rpb24oYSl7dGhpcy5PPWE7fTtcbmZ1bmN0aW9uIGNjKGEsYixjKXthLks9MTthLnY9ZGMoTShiKSk7YS5zPWM7YS5QPSEwO2VjKGEsbnVsbCk7fWZ1bmN0aW9uIGVjKGEsYil7YS5GPURhdGUubm93KCk7TihhKTthLkE9TShhLnYpO3ZhciBjPWEuQSxkPWEuVTtBcnJheS5pc0FycmF5KGQpfHwoZD1bU3RyaW5nKGQpXSk7ZmMoYy5pLFwidFwiLGQpO2EuQz0wO2M9YS5sLkg7YS5oPW5ldyAkYjthLmc9Z2MoYS5sLGM/YjpudWxsLCFhLnMpOzA8YS5OJiYoYS5MPW5ldyBDYihxKGEuTGEsYSxhLmcpLGEuTikpO0ViKGEuUyxhLmcsXCJyZWFkeXN0YXRlY2hhbmdlXCIsYS5pYik7Yj1hLkg/UmEoYS5IKTp7fTthLnM/KGEudXx8KGEudT1cIlBPU1RcIiksYltcIkNvbnRlbnQtVHlwZVwiXT1cImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLGEuZy5kYShhLkEsYS51LGEucyxiKSk6KGEudT1cIkdFVFwiLGEuZy5kYShhLkEsYS51LG51bGwsYikpO0goKTtIYihhLmosYS51LGEuQSxhLm0sYS5VLGEucyk7fVxuay5pYj1mdW5jdGlvbihhKXthPWEudGFyZ2V0O2NvbnN0IGI9dGhpcy5MO2ImJjM9PU8oYSk/Yi5sKCk6dGhpcy5MYShhKTt9O1xuay5MYT1mdW5jdGlvbihhKXt0cnl7aWYoYT09dGhpcy5nKWE6e2NvbnN0IHI9Tyh0aGlzLmcpO3ZhciBiPXRoaXMuZy5FYSgpO2NvbnN0IEY9dGhpcy5nLmFhKCk7aWYoISgzPnIpJiYoMyE9cnx8eWF8fHRoaXMuZyYmKHRoaXMuaC5ofHx0aGlzLmcuZmEoKXx8aGModGhpcy5nKSkpKXt0aGlzLkl8fDQhPXJ8fDc9PWJ8fCg4PT1ifHwwPj1GP0goMyk6SCgyKSk7aWModGhpcyk7dmFyIGM9dGhpcy5nLmFhKCk7dGhpcy5ZPWM7YjppZihqYyh0aGlzKSl7dmFyIGQ9aGModGhpcy5nKTthPVwiXCI7dmFyIGU9ZC5sZW5ndGgsZj00PT1PKHRoaXMuZyk7aWYoIXRoaXMuaC5pKXtpZihcInVuZGVmaW5lZFwiPT09dHlwZW9mIFRleHREZWNvZGVyKXtQKHRoaXMpO1EodGhpcyk7dmFyIGg9XCJcIjticmVhayBifXRoaXMuaC5pPW5ldyBsLlRleHREZWNvZGVyO31mb3IoYj0wO2I8ZTtiKyspdGhpcy5oLmg9ITAsYSs9dGhpcy5oLmkuZGVjb2RlKGRbYl0se3N0cmVhbTpmJiZiPT1lLTF9KTtkLnNwbGljZSgwLFxuZSk7dGhpcy5oLmcrPWE7dGhpcy5DPTA7aD10aGlzLmguZzt9ZWxzZSBoPXRoaXMuZy5mYSgpO3RoaXMuaT0yMDA9PWM7SWIodGhpcy5qLHRoaXMudSx0aGlzLkEsdGhpcy5tLHRoaXMuVSxyLGMpO2lmKHRoaXMuaSl7aWYodGhpcy5aJiYhdGhpcy5KKXtiOntpZih0aGlzLmcpe3ZhciBuLHU9dGhpcy5nO2lmKChuPXUuZz91LmcuZ2V0UmVzcG9uc2VIZWFkZXIoXCJYLUhUVFAtSW5pdGlhbC1SZXNwb25zZVwiKTpudWxsKSYmIXBhKG4pKXt2YXIgbT1uO2JyZWFrIGJ9fW09bnVsbDt9aWYoYz1tKUUodGhpcy5qLHRoaXMubSxjLFwiSW5pdGlhbCBoYW5kc2hha2UgcmVzcG9uc2UgdmlhIFgtSFRUUC1Jbml0aWFsLVJlc3BvbnNlXCIpLHRoaXMuSj0hMCxrYyh0aGlzLGMpO2Vsc2Uge3RoaXMuaT0hMTt0aGlzLm89MztJKDEyKTtQKHRoaXMpO1EodGhpcyk7YnJlYWsgYX19dGhpcy5QPyhsYyh0aGlzLHIsaCkseWEmJnRoaXMuaSYmMz09ciYmKEViKHRoaXMuUyx0aGlzLlQsXCJ0aWNrXCIsdGhpcy5oYiksXG50aGlzLlQuc3RhcnQoKSkpOihFKHRoaXMuaix0aGlzLm0saCxudWxsKSxrYyh0aGlzLGgpKTs0PT1yJiZQKHRoaXMpO3RoaXMuaSYmIXRoaXMuSSYmKDQ9PXI/bWModGhpcy5sLHRoaXMpOih0aGlzLmk9ITEsTih0aGlzKSkpO31lbHNlIDQwMD09YyYmMDxoLmluZGV4T2YoXCJVbmtub3duIFNJRFwiKT8odGhpcy5vPTMsSSgxMikpOih0aGlzLm89MCxJKDEzKSksUCh0aGlzKSxRKHRoaXMpO319fWNhdGNoKHIpe31maW5hbGx5e319O2Z1bmN0aW9uIGpjKGEpe3JldHVybiBhLmc/XCJHRVRcIj09YS51JiYyIT1hLksmJmEubC5EYTohMX1cbmZ1bmN0aW9uIGxjKGEsYixjKXtsZXQgZD0hMCxlO2Zvcig7IWEuSSYmYS5DPGMubGVuZ3RoOylpZihlPW5jKGEsYyksZT09YmMpezQ9PWImJihhLm89NCxJKDE0KSxkPSExKTtFKGEuaixhLm0sbnVsbCxcIltJbmNvbXBsZXRlIFJlc3BvbnNlXVwiKTticmVha31lbHNlIGlmKGU9PWFjKXthLm89NDtJKDE1KTtFKGEuaixhLm0sYyxcIltJbnZhbGlkIENodW5rXVwiKTtkPSExO2JyZWFrfWVsc2UgRShhLmosYS5tLGUsbnVsbCksa2MoYSxlKTtqYyhhKSYmZSE9YmMmJmUhPWFjJiYoYS5oLmc9XCJcIixhLkM9MCk7NCE9Ynx8MCE9Yy5sZW5ndGh8fGEuaC5ofHwoYS5vPTEsSSgxNiksZD0hMSk7YS5pPWEuaSYmZDtkPzA8Yy5sZW5ndGgmJiFhLiQmJihhLiQ9ITAsYj1hLmwsYi5nPT1hJiZiLiQmJiFiLksmJihiLmouaW5mbyhcIkdyZWF0LCBubyBidWZmZXJpbmcgcHJveHkgZGV0ZWN0ZWQuIEJ5dGVzIHJlY2VpdmVkOiBcIitjLmxlbmd0aCksb2MoYiksYi5LPSEwLEkoMTEpKSk6KEUoYS5qLGEubSxjLFxuXCJbSW52YWxpZCBDaHVua2VkIFJlc3BvbnNlXVwiKSxQKGEpLFEoYSkpO31rLmhiPWZ1bmN0aW9uKCl7aWYodGhpcy5nKXt2YXIgYT1PKHRoaXMuZyksYj10aGlzLmcuZmEoKTt0aGlzLkM8Yi5sZW5ndGgmJihpYyh0aGlzKSxsYyh0aGlzLGEsYiksdGhpcy5pJiY0IT1hJiZOKHRoaXMpKTt9fTtmdW5jdGlvbiBuYyhhLGIpe3ZhciBjPWEuQyxkPWIuaW5kZXhPZihcIlxcblwiLGMpO2lmKC0xPT1kKXJldHVybiBiYztjPU51bWJlcihiLnN1YnN0cmluZyhjLGQpKTtpZihpc05hTihjKSlyZXR1cm4gYWM7ZCs9MTtpZihkK2M+Yi5sZW5ndGgpcmV0dXJuIGJjO2I9Yi5zdWJzdHIoZCxjKTthLkM9ZCtjO3JldHVybiBifWsuY2FuY2VsPWZ1bmN0aW9uKCl7dGhpcy5JPSEwO1AodGhpcyk7fTtmdW5jdGlvbiBOKGEpe2EuVj1EYXRlLm5vdygpK2EuTztwYyhhLGEuTyk7fVxuZnVuY3Rpb24gcGMoYSxiKXtpZihudWxsIT1hLkIpdGhyb3cgRXJyb3IoXCJXYXRjaERvZyB0aW1lciBub3QgbnVsbFwiKTthLkI9SihxKGEuZ2IsYSksYik7fWZ1bmN0aW9uIGljKGEpe2EuQiYmKGwuY2xlYXJUaW1lb3V0KGEuQiksYS5CPW51bGwpO31rLmdiPWZ1bmN0aW9uKCl7dGhpcy5CPW51bGw7Y29uc3QgYT1EYXRlLm5vdygpOzA8PWEtdGhpcy5WPyhLYih0aGlzLmosdGhpcy5BKSwyIT10aGlzLksmJihIKCksSSgxNykpLFAodGhpcyksdGhpcy5vPTIsUSh0aGlzKSk6cGModGhpcyx0aGlzLlYtYSk7fTtmdW5jdGlvbiBRKGEpezA9PWEubC5HfHxhLkl8fG1jKGEubCxhKTt9ZnVuY3Rpb24gUChhKXtpYyhhKTt2YXIgYj1hLkw7YiYmXCJmdW5jdGlvblwiPT10eXBlb2YgYi5uYSYmYi5uYSgpO2EuTD1udWxsO3piKGEuVCk7RmIoYS5TKTthLmcmJihiPWEuZyxhLmc9bnVsbCxiLmFib3J0KCksYi5uYSgpKTt9XG5mdW5jdGlvbiBrYyhhLGIpe3RyeXt2YXIgYz1hLmw7aWYoMCE9Yy5HJiYoYy5nPT1hfHxxYyhjLmgsYSkpKWlmKCFhLkomJnFjKGMuaCxhKSYmMz09Yy5HKXt0cnl7dmFyIGQ9Yy5GYS5nLnBhcnNlKGIpO31jYXRjaChtKXtkPW51bGw7fWlmKEFycmF5LmlzQXJyYXkoZCkmJjM9PWQubGVuZ3RoKXt2YXIgZT1kO2lmKDA9PWVbMF0pYTp7aWYoIWMudSl7aWYoYy5nKWlmKGMuZy5GKzNFMzxhLkYpcmMoYyksc2MoYyk7ZWxzZSBicmVhayBhO3RjKGMpO0koMTgpO319ZWxzZSBjLkJhPWVbMV0sMDxjLkJhLWMuVCYmMzc1MDA+ZVsyXSYmYy5MJiYwPT1jLkEmJiFjLnYmJihjLnY9SihxKGMuY2IsYyksNkUzKSk7aWYoMT49dWMoYy5oKSYmYy5qYSl7dHJ5e2MuamEoKTt9Y2F0Y2gobSl7fWMuamE9dm9pZCAwO319ZWxzZSBSKGMsMTEpO31lbHNlIGlmKChhLkp8fGMuZz09YSkmJnJjKGMpLCFwYShiKSlmb3IoZT1jLkZhLmcucGFyc2UoYiksYj0wO2I8ZS5sZW5ndGg7YisrKXtsZXQgbT1lW2JdO2MuVD1cbm1bMF07bT1tWzFdO2lmKDI9PWMuRylpZihcImNcIj09bVswXSl7Yy5JPW1bMV07Yy5rYT1tWzJdO2NvbnN0IHI9bVszXTtudWxsIT1yJiYoYy5tYT1yLGMuai5pbmZvKFwiVkVSPVwiK2MubWEpKTtjb25zdCBGPW1bNF07bnVsbCE9RiYmKGMuQ2E9RixjLmouaW5mbyhcIlNWRVI9XCIrYy5DYSkpO2NvbnN0IENhPW1bNV07bnVsbCE9Q2EmJlwibnVtYmVyXCI9PT10eXBlb2YgQ2EmJjA8Q2EmJihkPTEuNSpDYSxjLko9ZCxjLmouaW5mbyhcImJhY2tDaGFubmVsUmVxdWVzdFRpbWVvdXRNc189XCIrZCkpO2Q9Yztjb25zdCBaPWEuZztpZihaKXtjb25zdCBEYT1aLmc/Wi5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1DbGllbnQtV2lyZS1Qcm90b2NvbFwiKTpudWxsO2lmKERhKXt2YXIgZj1kLmg7Zi5nfHwtMT09RGEuaW5kZXhPZihcInNwZHlcIikmJi0xPT1EYS5pbmRleE9mKFwicXVpY1wiKSYmLTE9PURhLmluZGV4T2YoXCJoMlwiKXx8KGYuaj1mLmwsZi5nPW5ldyBTZXQsZi5oJiYodmMoZixmLmgpLGYuaD1udWxsKSk7fWlmKGQuRCl7Y29uc3QgdGI9XG5aLmc/Wi5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1IVFRQLVNlc3Npb24tSWRcIik6bnVsbDt0YiYmKGQuemE9dGIsUyhkLkYsZC5ELHRiKSk7fX1jLkc9MztjLmwmJmMubC54YSgpO2MuJCYmKGMuUD1EYXRlLm5vdygpLWEuRixjLmouaW5mbyhcIkhhbmRzaGFrZSBSVFQ6IFwiK2MuUCtcIm1zXCIpKTtkPWM7dmFyIGg9YTtkLnNhPXdjKGQsZC5IP2Qua2E6bnVsbCxkLlYpO2lmKGguSil7eGMoZC5oLGgpO3ZhciBuPWgsdT1kLko7dSYmbi5zZXRUaW1lb3V0KHUpO24uQiYmKGljKG4pLE4obikpO2QuZz1oO31lbHNlIHljKGQpOzA8Yy5pLmxlbmd0aCYmemMoYyk7fWVsc2UgXCJzdG9wXCIhPW1bMF0mJlwiY2xvc2VcIiE9bVswXXx8UihjLDcpO2Vsc2UgMz09Yy5HJiYoXCJzdG9wXCI9PW1bMF18fFwiY2xvc2VcIj09bVswXT9cInN0b3BcIj09bVswXT9SKGMsNyk6QWMoYyk6XCJub29wXCIhPW1bMF0mJmMubCYmYy5sLndhKG0pLGMuQT0wKTt9SCg0KTt9Y2F0Y2gobSl7fX1mdW5jdGlvbiBCYyhhKXtpZihhLlcmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuVylyZXR1cm4gYS5XKCk7aWYoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBNYXAmJmEgaW5zdGFuY2VvZiBNYXB8fFwidW5kZWZpbmVkXCIhPT10eXBlb2YgU2V0JiZhIGluc3RhbmNlb2YgU2V0KXJldHVybiBBcnJheS5mcm9tKGEudmFsdWVzKCkpO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlyZXR1cm4gYS5zcGxpdChcIlwiKTtpZihiYShhKSl7Zm9yKHZhciBiPVtdLGM9YS5sZW5ndGgsZD0wO2Q8YztkKyspYi5wdXNoKGFbZF0pO3JldHVybiBifWI9W107Yz0wO2ZvcihkIGluIGEpYltjKytdPWFbZF07cmV0dXJuIGJ9XG5mdW5jdGlvbiBDYyhhKXtpZihhLm9hJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhLm9hKXJldHVybiBhLm9hKCk7aWYoIWEuV3x8XCJmdW5jdGlvblwiIT10eXBlb2YgYS5XKXtpZihcInVuZGVmaW5lZFwiIT09dHlwZW9mIE1hcCYmYSBpbnN0YW5jZW9mIE1hcClyZXR1cm4gQXJyYXkuZnJvbShhLmtleXMoKSk7aWYoIShcInVuZGVmaW5lZFwiIT09dHlwZW9mIFNldCYmYSBpbnN0YW5jZW9mIFNldCkpe2lmKGJhKGEpfHxcInN0cmluZ1wiPT09dHlwZW9mIGEpe3ZhciBiPVtdO2E9YS5sZW5ndGg7Zm9yKHZhciBjPTA7YzxhO2MrKyliLnB1c2goYyk7cmV0dXJuIGJ9Yj1bXTtjPTA7Zm9yKGNvbnN0IGQgaW4gYSliW2MrK109ZDtyZXR1cm4gYn19fVxuZnVuY3Rpb24gRGMoYSxiKXtpZihhLmZvckVhY2gmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuZm9yRWFjaClhLmZvckVhY2goYix2b2lkIDApO2Vsc2UgaWYoYmEoYSl8fFwic3RyaW5nXCI9PT10eXBlb2YgYSlBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGEsYix2b2lkIDApO2Vsc2UgZm9yKHZhciBjPUNjKGEpLGQ9QmMoYSksZT1kLmxlbmd0aCxmPTA7ZjxlO2YrKyliLmNhbGwodm9pZCAwLGRbZl0sYyYmY1tmXSxhKTt9dmFyIEVjPVJlZ0V4cChcIl4oPzooW146Lz8jLl0rKTopPyg/Oi8vKD86KFteXFxcXFxcXFwvPyNdKilAKT8oW15cXFxcXFxcXC8/I10qPykoPzo6KFswLTldKykpPyg/PVtcXFxcXFxcXC8/I118JCkpPyhbXj8jXSspPyg/OlxcXFw/KFteI10qKSk/KD86IyhbXFxcXHNcXFxcU10qKSk/JFwiKTtmdW5jdGlvbiBGYyhhLGIpe2lmKGEpe2E9YS5zcGxpdChcIiZcIik7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspe3ZhciBkPWFbY10uaW5kZXhPZihcIj1cIiksZT1udWxsO2lmKDA8PWQpe3ZhciBmPWFbY10uc3Vic3RyaW5nKDAsZCk7ZT1hW2NdLnN1YnN0cmluZyhkKzEpO31lbHNlIGY9YVtjXTtiKGYsZT9kZWNvZGVVUklDb21wb25lbnQoZS5yZXBsYWNlKC9cXCsvZyxcIiBcIikpOlwiXCIpO319fWZ1bmN0aW9uIFQoYSxiKXt0aGlzLmc9dGhpcy5zPXRoaXMuaj1cIlwiO3RoaXMubT1udWxsO3RoaXMubz10aGlzLmw9XCJcIjt0aGlzLmg9ITE7aWYoYSBpbnN0YW5jZW9mIFQpe3RoaXMuaD12b2lkIDAhPT1iP2I6YS5oO0djKHRoaXMsYS5qKTt0aGlzLnM9YS5zO3RoaXMuZz1hLmc7SGModGhpcyxhLm0pO3RoaXMubD1hLmw7Yj1hLmk7dmFyIGM9bmV3IEljO2MuaT1iLmk7Yi5nJiYoYy5nPW5ldyBNYXAoYi5nKSxjLmg9Yi5oKTtKYyh0aGlzLGMpO3RoaXMubz1hLm87fWVsc2UgYSYmKGM9U3RyaW5nKGEpLm1hdGNoKEVjKSk/KHRoaXMuaD0hIWIsR2ModGhpcyxjWzFdfHxcIlwiLCEwKSx0aGlzLnM9S2MoY1syXXx8XCJcIiksdGhpcy5nPUtjKGNbM118fFwiXCIsITApLEhjKHRoaXMsY1s0XSksdGhpcy5sPUtjKGNbNV18fFwiXCIsITApLEpjKHRoaXMsY1s2XXx8XCJcIiwhMCksdGhpcy5vPUtjKGNbN118fFwiXCIpKToodGhpcy5oPSEhYix0aGlzLmk9bmV3IEljKG51bGwsdGhpcy5oKSk7fVxuVC5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXt2YXIgYT1bXSxiPXRoaXMuajtiJiZhLnB1c2goTGMoYixNYywhMCksXCI6XCIpO3ZhciBjPXRoaXMuZztpZihjfHxcImZpbGVcIj09YilhLnB1c2goXCIvL1wiKSwoYj10aGlzLnMpJiZhLnB1c2goTGMoYixNYywhMCksXCJAXCIpLGEucHVzaChlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGMpKS5yZXBsYWNlKC8lMjUoWzAtOWEtZkEtRl17Mn0pL2csXCIlJDFcIikpLGM9dGhpcy5tLG51bGwhPWMmJmEucHVzaChcIjpcIixTdHJpbmcoYykpO2lmKGM9dGhpcy5sKXRoaXMuZyYmXCIvXCIhPWMuY2hhckF0KDApJiZhLnB1c2goXCIvXCIpLGEucHVzaChMYyhjLFwiL1wiPT1jLmNoYXJBdCgwKT9OYzpPYywhMCkpOyhjPXRoaXMuaS50b1N0cmluZygpKSYmYS5wdXNoKFwiP1wiLGMpOyhjPXRoaXMubykmJmEucHVzaChcIiNcIixMYyhjLFBjKSk7cmV0dXJuIGEuam9pbihcIlwiKX07ZnVuY3Rpb24gTShhKXtyZXR1cm4gbmV3IFQoYSl9XG5mdW5jdGlvbiBHYyhhLGIsYyl7YS5qPWM/S2MoYiwhMCk6YjthLmomJihhLmo9YS5qLnJlcGxhY2UoLzokLyxcIlwiKSk7fWZ1bmN0aW9uIEhjKGEsYil7aWYoYil7Yj1OdW1iZXIoYik7aWYoaXNOYU4oYil8fDA+Yil0aHJvdyBFcnJvcihcIkJhZCBwb3J0IG51bWJlciBcIitiKTthLm09Yjt9ZWxzZSBhLm09bnVsbDt9ZnVuY3Rpb24gSmMoYSxiLGMpe2IgaW5zdGFuY2VvZiBJYz8oYS5pPWIsUWMoYS5pLGEuaCkpOihjfHwoYj1MYyhiLFJjKSksYS5pPW5ldyBJYyhiLGEuaCkpO31mdW5jdGlvbiBTKGEsYixjKXthLmkuc2V0KGIsYyk7fWZ1bmN0aW9uIGRjKGEpe1MoYSxcInp4XCIsTWF0aC5mbG9vcigyMTQ3NDgzNjQ4Kk1hdGgucmFuZG9tKCkpLnRvU3RyaW5nKDM2KStNYXRoLmFicyhNYXRoLmZsb29yKDIxNDc0ODM2NDgqTWF0aC5yYW5kb20oKSleRGF0ZS5ub3coKSkudG9TdHJpbmcoMzYpKTtyZXR1cm4gYX1cbmZ1bmN0aW9uIEtjKGEsYil7cmV0dXJuIGE/Yj9kZWNvZGVVUkkoYS5yZXBsYWNlKC8lMjUvZyxcIiUyNTI1XCIpKTpkZWNvZGVVUklDb21wb25lbnQoYSk6XCJcIn1mdW5jdGlvbiBMYyhhLGIsYyl7cmV0dXJuIFwic3RyaW5nXCI9PT10eXBlb2YgYT8oYT1lbmNvZGVVUkkoYSkucmVwbGFjZShiLFNjKSxjJiYoYT1hLnJlcGxhY2UoLyUyNShbMC05YS1mQS1GXXsyfSkvZyxcIiUkMVwiKSksYSk6bnVsbH1mdW5jdGlvbiBTYyhhKXthPWEuY2hhckNvZGVBdCgwKTtyZXR1cm4gXCIlXCIrKGE+PjQmMTUpLnRvU3RyaW5nKDE2KSsoYSYxNSkudG9TdHJpbmcoMTYpfXZhciBNYz0vWyNcXC9cXD9AXS9nLE9jPS9bI1xcPzpdL2csTmM9L1sjXFw/XS9nLFJjPS9bI1xcP0BdL2csUGM9LyMvZztmdW5jdGlvbiBJYyhhLGIpe3RoaXMuaD10aGlzLmc9bnVsbDt0aGlzLmk9YXx8bnVsbDt0aGlzLmo9ISFiO31cbmZ1bmN0aW9uIFUoYSl7YS5nfHwoYS5nPW5ldyBNYXAsYS5oPTAsYS5pJiZGYyhhLmksZnVuY3Rpb24oYixjKXthLmFkZChkZWNvZGVVUklDb21wb25lbnQoYi5yZXBsYWNlKC9cXCsvZyxcIiBcIikpLGMpO30pKTt9az1JYy5wcm90b3R5cGU7ay5hZGQ9ZnVuY3Rpb24oYSxiKXtVKHRoaXMpO3RoaXMuaT1udWxsO2E9Vih0aGlzLGEpO3ZhciBjPXRoaXMuZy5nZXQoYSk7Y3x8dGhpcy5nLnNldChhLGM9W10pO2MucHVzaChiKTt0aGlzLmgrPTE7cmV0dXJuIHRoaXN9O2Z1bmN0aW9uIFRjKGEsYil7VShhKTtiPVYoYSxiKTthLmcuaGFzKGIpJiYoYS5pPW51bGwsYS5oLT1hLmcuZ2V0KGIpLmxlbmd0aCxhLmcuZGVsZXRlKGIpKTt9ZnVuY3Rpb24gVWMoYSxiKXtVKGEpO2I9VihhLGIpO3JldHVybiBhLmcuaGFzKGIpfVxuay5mb3JFYWNoPWZ1bmN0aW9uKGEsYil7VSh0aGlzKTt0aGlzLmcuZm9yRWFjaChmdW5jdGlvbihjLGQpe2MuZm9yRWFjaChmdW5jdGlvbihlKXthLmNhbGwoYixlLGQsdGhpcyk7fSx0aGlzKTt9LHRoaXMpO307ay5vYT1mdW5jdGlvbigpe1UodGhpcyk7Y29uc3QgYT1BcnJheS5mcm9tKHRoaXMuZy52YWx1ZXMoKSksYj1BcnJheS5mcm9tKHRoaXMuZy5rZXlzKCkpLGM9W107Zm9yKGxldCBkPTA7ZDxiLmxlbmd0aDtkKyspe2NvbnN0IGU9YVtkXTtmb3IobGV0IGY9MDtmPGUubGVuZ3RoO2YrKyljLnB1c2goYltkXSk7fXJldHVybiBjfTtrLlc9ZnVuY3Rpb24oYSl7VSh0aGlzKTtsZXQgYj1bXTtpZihcInN0cmluZ1wiPT09dHlwZW9mIGEpVWModGhpcyxhKSYmKGI9Yi5jb25jYXQodGhpcy5nLmdldChWKHRoaXMsYSkpKSk7ZWxzZSB7YT1BcnJheS5mcm9tKHRoaXMuZy52YWx1ZXMoKSk7Zm9yKGxldCBjPTA7YzxhLmxlbmd0aDtjKyspYj1iLmNvbmNhdChhW2NdKTt9cmV0dXJuIGJ9O1xuay5zZXQ9ZnVuY3Rpb24oYSxiKXtVKHRoaXMpO3RoaXMuaT1udWxsO2E9Vih0aGlzLGEpO1VjKHRoaXMsYSkmJih0aGlzLmgtPXRoaXMuZy5nZXQoYSkubGVuZ3RoKTt0aGlzLmcuc2V0KGEsW2JdKTt0aGlzLmgrPTE7cmV0dXJuIHRoaXN9O2suZ2V0PWZ1bmN0aW9uKGEsYil7aWYoIWEpcmV0dXJuIGI7YT10aGlzLlcoYSk7cmV0dXJuIDA8YS5sZW5ndGg/U3RyaW5nKGFbMF0pOmJ9O2Z1bmN0aW9uIGZjKGEsYixjKXtUYyhhLGIpOzA8Yy5sZW5ndGgmJihhLmk9bnVsbCxhLmcuc2V0KFYoYSxiKSxtYShjKSksYS5oKz1jLmxlbmd0aCk7fVxuay50b1N0cmluZz1mdW5jdGlvbigpe2lmKHRoaXMuaSlyZXR1cm4gdGhpcy5pO2lmKCF0aGlzLmcpcmV0dXJuIFwiXCI7Y29uc3QgYT1bXSxiPUFycmF5LmZyb20odGhpcy5nLmtleXMoKSk7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspe3ZhciBkPWJbY107Y29uc3QgZj1lbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGQpKSxoPXRoaXMuVyhkKTtmb3IoZD0wO2Q8aC5sZW5ndGg7ZCsrKXt2YXIgZT1mO1wiXCIhPT1oW2RdJiYoZSs9XCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhoW2RdKSkpO2EucHVzaChlKTt9fXJldHVybiB0aGlzLmk9YS5qb2luKFwiJlwiKX07ZnVuY3Rpb24gVihhLGIpe2I9U3RyaW5nKGIpO2EuaiYmKGI9Yi50b0xvd2VyQ2FzZSgpKTtyZXR1cm4gYn1cbmZ1bmN0aW9uIFFjKGEsYil7YiYmIWEuaiYmKFUoYSksYS5pPW51bGwsYS5nLmZvckVhY2goZnVuY3Rpb24oYyxkKXt2YXIgZT1kLnRvTG93ZXJDYXNlKCk7ZCE9ZSYmKFRjKHRoaXMsZCksZmModGhpcyxlLGMpKTt9LGEpKTthLmo9Yjt9dmFyIFZjPWNsYXNze2NvbnN0cnVjdG9yKGEsYil7dGhpcy5oPWE7dGhpcy5nPWI7fX07ZnVuY3Rpb24gV2MoYSl7dGhpcy5sPWF8fFhjO2wuUGVyZm9ybWFuY2VOYXZpZ2F0aW9uVGltaW5nPyhhPWwucGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5VHlwZShcIm5hdmlnYXRpb25cIiksYT0wPGEubGVuZ3RoJiYoXCJocVwiPT1hWzBdLm5leHRIb3BQcm90b2NvbHx8XCJoMlwiPT1hWzBdLm5leHRIb3BQcm90b2NvbCkpOmE9ISEobC5nJiZsLmcuR2EmJmwuZy5HYSgpJiZsLmcuR2EoKS4kYik7dGhpcy5qPWE/dGhpcy5sOjE7dGhpcy5nPW51bGw7MTx0aGlzLmomJih0aGlzLmc9bmV3IFNldCk7dGhpcy5oPW51bGw7dGhpcy5pPVtdO312YXIgWGM9MTA7ZnVuY3Rpb24gWWMoYSl7cmV0dXJuIGEuaD8hMDphLmc/YS5nLnNpemU+PWEuajohMX1mdW5jdGlvbiB1YyhhKXtyZXR1cm4gYS5oPzE6YS5nP2EuZy5zaXplOjB9ZnVuY3Rpb24gcWMoYSxiKXtyZXR1cm4gYS5oP2EuaD09YjphLmc/YS5nLmhhcyhiKTohMX1mdW5jdGlvbiB2YyhhLGIpe2EuZz9hLmcuYWRkKGIpOmEuaD1iO31cbmZ1bmN0aW9uIHhjKGEsYil7YS5oJiZhLmg9PWI/YS5oPW51bGw6YS5nJiZhLmcuaGFzKGIpJiZhLmcuZGVsZXRlKGIpO31XYy5wcm90b3R5cGUuY2FuY2VsPWZ1bmN0aW9uKCl7dGhpcy5pPVpjKHRoaXMpO2lmKHRoaXMuaCl0aGlzLmguY2FuY2VsKCksdGhpcy5oPW51bGw7ZWxzZSBpZih0aGlzLmcmJjAhPT10aGlzLmcuc2l6ZSl7Zm9yKGNvbnN0IGEgb2YgdGhpcy5nLnZhbHVlcygpKWEuY2FuY2VsKCk7dGhpcy5nLmNsZWFyKCk7fX07ZnVuY3Rpb24gWmMoYSl7aWYobnVsbCE9YS5oKXJldHVybiBhLmkuY29uY2F0KGEuaC5EKTtpZihudWxsIT1hLmcmJjAhPT1hLmcuc2l6ZSl7bGV0IGI9YS5pO2Zvcihjb25zdCBjIG9mIGEuZy52YWx1ZXMoKSliPWIuY29uY2F0KGMuRCk7cmV0dXJuIGJ9cmV0dXJuIG1hKGEuaSl9ZnVuY3Rpb24gJGMoKXt9JGMucHJvdG90eXBlLnN0cmluZ2lmeT1mdW5jdGlvbihhKXtyZXR1cm4gbC5KU09OLnN0cmluZ2lmeShhLHZvaWQgMCl9OyRjLnByb3RvdHlwZS5wYXJzZT1mdW5jdGlvbihhKXtyZXR1cm4gbC5KU09OLnBhcnNlKGEsdm9pZCAwKX07ZnVuY3Rpb24gYWQoKXt0aGlzLmc9bmV3ICRjO31mdW5jdGlvbiBiZChhLGIsYyl7Y29uc3QgZD1jfHxcIlwiO3RyeXtEYyhhLGZ1bmN0aW9uKGUsZil7bGV0IGg9ZTtwKGUpJiYoaD1sYihlKSk7Yi5wdXNoKGQrZitcIj1cIitlbmNvZGVVUklDb21wb25lbnQoaCkpO30pO31jYXRjaChlKXt0aHJvdyBiLnB1c2goZCtcInR5cGU9XCIrZW5jb2RlVVJJQ29tcG9uZW50KFwiX2JhZG1hcFwiKSksZTt9fWZ1bmN0aW9uIGNkKGEsYil7Y29uc3QgYz1uZXcgR2I7aWYobC5JbWFnZSl7Y29uc3QgZD1uZXcgSW1hZ2U7ZC5vbmxvYWQ9aWEoZGQsYyxkLFwiVGVzdExvYWRJbWFnZTogbG9hZGVkXCIsITAsYik7ZC5vbmVycm9yPWlhKGRkLGMsZCxcIlRlc3RMb2FkSW1hZ2U6IGVycm9yXCIsITEsYik7ZC5vbmFib3J0PWlhKGRkLGMsZCxcIlRlc3RMb2FkSW1hZ2U6IGFib3J0XCIsITEsYik7ZC5vbnRpbWVvdXQ9aWEoZGQsYyxkLFwiVGVzdExvYWRJbWFnZTogdGltZW91dFwiLCExLGIpO2wuc2V0VGltZW91dChmdW5jdGlvbigpe2lmKGQub250aW1lb3V0KWQub250aW1lb3V0KCk7fSwxRTQpO2Quc3JjPWE7fWVsc2UgYighMSk7fWZ1bmN0aW9uIGRkKGEsYixjLGQsZSl7dHJ5e2Iub25sb2FkPW51bGwsYi5vbmVycm9yPW51bGwsYi5vbmFib3J0PW51bGwsYi5vbnRpbWVvdXQ9bnVsbCxlKGQpO31jYXRjaChmKXt9fWZ1bmN0aW9uIGVkKGEpe3RoaXMubD1hLmFjfHxudWxsO3RoaXMuaj1hLmpifHwhMTt9dChlZCxTYik7ZWQucHJvdG90eXBlLmc9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IGZkKHRoaXMubCx0aGlzLmopfTtlZC5wcm90b3R5cGUuaT1mdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYX19KHt9KTtmdW5jdGlvbiBmZChhLGIpe0IuY2FsbCh0aGlzKTt0aGlzLkQ9YTt0aGlzLnU9Yjt0aGlzLm09dm9pZCAwO3RoaXMucmVhZHlTdGF0ZT1nZDt0aGlzLnN0YXR1cz0wO3RoaXMucmVzcG9uc2VUeXBlPXRoaXMucmVzcG9uc2VUZXh0PXRoaXMucmVzcG9uc2U9dGhpcy5zdGF0dXNUZXh0PVwiXCI7dGhpcy5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbDt0aGlzLnY9bmV3IEhlYWRlcnM7dGhpcy5oPW51bGw7dGhpcy5DPVwiR0VUXCI7dGhpcy5CPVwiXCI7dGhpcy5nPSExO3RoaXMuQT10aGlzLmo9dGhpcy5sPW51bGw7fXQoZmQsQik7dmFyIGdkPTA7az1mZC5wcm90b3R5cGU7XG5rLm9wZW49ZnVuY3Rpb24oYSxiKXtpZih0aGlzLnJlYWR5U3RhdGUhPWdkKXRocm93IHRoaXMuYWJvcnQoKSxFcnJvcihcIkVycm9yIHJlb3BlbmluZyBhIGNvbm5lY3Rpb25cIik7dGhpcy5DPWE7dGhpcy5CPWI7dGhpcy5yZWFkeVN0YXRlPTE7aGQodGhpcyk7fTtrLnNlbmQ9ZnVuY3Rpb24oYSl7aWYoMSE9dGhpcy5yZWFkeVN0YXRlKXRocm93IHRoaXMuYWJvcnQoKSxFcnJvcihcIm5lZWQgdG8gY2FsbCBvcGVuKCkgZmlyc3QuIFwiKTt0aGlzLmc9ITA7Y29uc3QgYj17aGVhZGVyczp0aGlzLnYsbWV0aG9kOnRoaXMuQyxjcmVkZW50aWFsczp0aGlzLm0sY2FjaGU6dm9pZCAwfTthJiYoYi5ib2R5PWEpOyh0aGlzLkR8fGwpLmZldGNoKG5ldyBSZXF1ZXN0KHRoaXMuQixiKSkudGhlbih0aGlzLldhLmJpbmQodGhpcyksdGhpcy5nYS5iaW5kKHRoaXMpKTt9O1xuay5hYm9ydD1mdW5jdGlvbigpe3RoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQ9XCJcIjt0aGlzLnY9bmV3IEhlYWRlcnM7dGhpcy5zdGF0dXM9MDt0aGlzLmomJnRoaXMuai5jYW5jZWwoXCJSZXF1ZXN0IHdhcyBhYm9ydGVkLlwiKS5jYXRjaCgoKT0+e30pOzE8PXRoaXMucmVhZHlTdGF0ZSYmdGhpcy5nJiY0IT10aGlzLnJlYWR5U3RhdGUmJih0aGlzLmc9ITEsaWQodGhpcykpO3RoaXMucmVhZHlTdGF0ZT1nZDt9O1xuay5XYT1mdW5jdGlvbihhKXtpZih0aGlzLmcmJih0aGlzLmw9YSx0aGlzLmh8fCh0aGlzLnN0YXR1cz10aGlzLmwuc3RhdHVzLHRoaXMuc3RhdHVzVGV4dD10aGlzLmwuc3RhdHVzVGV4dCx0aGlzLmg9YS5oZWFkZXJzLHRoaXMucmVhZHlTdGF0ZT0yLGhkKHRoaXMpKSx0aGlzLmcmJih0aGlzLnJlYWR5U3RhdGU9MyxoZCh0aGlzKSx0aGlzLmcpKSlpZihcImFycmF5YnVmZmVyXCI9PT10aGlzLnJlc3BvbnNlVHlwZSlhLmFycmF5QnVmZmVyKCkudGhlbih0aGlzLlVhLmJpbmQodGhpcyksdGhpcy5nYS5iaW5kKHRoaXMpKTtlbHNlIGlmKFwidW5kZWZpbmVkXCIhPT10eXBlb2YgbC5SZWFkYWJsZVN0cmVhbSYmXCJib2R5XCJpbiBhKXt0aGlzLmo9YS5ib2R5LmdldFJlYWRlcigpO2lmKHRoaXMudSl7aWYodGhpcy5yZXNwb25zZVR5cGUpdGhyb3cgRXJyb3IoJ3Jlc3BvbnNlVHlwZSBtdXN0IGJlIGVtcHR5IGZvciBcInN0cmVhbUJpbmFyeUNodW5rc1wiIG1vZGUgcmVzcG9uc2VzLicpO3RoaXMucmVzcG9uc2U9XG5bXTt9ZWxzZSB0aGlzLnJlc3BvbnNlPXRoaXMucmVzcG9uc2VUZXh0PVwiXCIsdGhpcy5BPW5ldyBUZXh0RGVjb2RlcjtqZCh0aGlzKTt9ZWxzZSBhLnRleHQoKS50aGVuKHRoaXMuVmEuYmluZCh0aGlzKSx0aGlzLmdhLmJpbmQodGhpcykpO307ZnVuY3Rpb24gamQoYSl7YS5qLnJlYWQoKS50aGVuKGEuVGEuYmluZChhKSkuY2F0Y2goYS5nYS5iaW5kKGEpKTt9ay5UYT1mdW5jdGlvbihhKXtpZih0aGlzLmcpe2lmKHRoaXMudSYmYS52YWx1ZSl0aGlzLnJlc3BvbnNlLnB1c2goYS52YWx1ZSk7ZWxzZSBpZighdGhpcy51KXt2YXIgYj1hLnZhbHVlP2EudmFsdWU6bmV3IFVpbnQ4QXJyYXkoMCk7aWYoYj10aGlzLkEuZGVjb2RlKGIse3N0cmVhbTohYS5kb25lfSkpdGhpcy5yZXNwb25zZT10aGlzLnJlc3BvbnNlVGV4dCs9Yjt9YS5kb25lP2lkKHRoaXMpOmhkKHRoaXMpOzM9PXRoaXMucmVhZHlTdGF0ZSYmamQodGhpcyk7fX07XG5rLlZhPWZ1bmN0aW9uKGEpe3RoaXMuZyYmKHRoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQ9YSxpZCh0aGlzKSk7fTtrLlVhPWZ1bmN0aW9uKGEpe3RoaXMuZyYmKHRoaXMucmVzcG9uc2U9YSxpZCh0aGlzKSk7fTtrLmdhPWZ1bmN0aW9uKCl7dGhpcy5nJiZpZCh0aGlzKTt9O2Z1bmN0aW9uIGlkKGEpe2EucmVhZHlTdGF0ZT00O2EubD1udWxsO2Euaj1udWxsO2EuQT1udWxsO2hkKGEpO31rLnNldFJlcXVlc3RIZWFkZXI9ZnVuY3Rpb24oYSxiKXt0aGlzLnYuYXBwZW5kKGEsYik7fTtrLmdldFJlc3BvbnNlSGVhZGVyPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmg/dGhpcy5oLmdldChhLnRvTG93ZXJDYXNlKCkpfHxcIlwiOlwiXCJ9O1xuay5nZXRBbGxSZXNwb25zZUhlYWRlcnM9ZnVuY3Rpb24oKXtpZighdGhpcy5oKXJldHVybiBcIlwiO2NvbnN0IGE9W10sYj10aGlzLmguZW50cmllcygpO2Zvcih2YXIgYz1iLm5leHQoKTshYy5kb25lOyljPWMudmFsdWUsYS5wdXNoKGNbMF0rXCI6IFwiK2NbMV0pLGM9Yi5uZXh0KCk7cmV0dXJuIGEuam9pbihcIlxcclxcblwiKX07ZnVuY3Rpb24gaGQoYSl7YS5vbnJlYWR5c3RhdGVjaGFuZ2UmJmEub25yZWFkeXN0YXRlY2hhbmdlLmNhbGwoYSk7fU9iamVjdC5kZWZpbmVQcm9wZXJ0eShmZC5wcm90b3R5cGUsXCJ3aXRoQ3JlZGVudGlhbHNcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIFwiaW5jbHVkZVwiPT09dGhpcy5tfSxzZXQ6ZnVuY3Rpb24oYSl7dGhpcy5tPWE/XCJpbmNsdWRlXCI6XCJzYW1lLW9yaWdpblwiO319KTt2YXIga2Q9bC5KU09OLnBhcnNlO2Z1bmN0aW9uIFcoYSl7Qi5jYWxsKHRoaXMpO3RoaXMuaGVhZGVycz1uZXcgTWFwO3RoaXMudT1hfHxudWxsO3RoaXMuaD0hMTt0aGlzLkM9dGhpcy5nPW51bGw7dGhpcy5IPVwiXCI7dGhpcy5tPTA7dGhpcy5qPVwiXCI7dGhpcy5sPXRoaXMuRj10aGlzLnY9dGhpcy5EPSExO3RoaXMuQj0wO3RoaXMuQT1udWxsO3RoaXMuSj1sZDt0aGlzLks9dGhpcy5MPSExO310KFcsQik7dmFyIGxkPVwiXCIsbWQ9L15odHRwcz8kL2ksbmQ9W1wiUE9TVFwiLFwiUFVUXCJdO2s9Vy5wcm90b3R5cGU7ay5LYT1mdW5jdGlvbihhKXt0aGlzLkw9YTt9O1xuay5kYT1mdW5jdGlvbihhLGIsYyxkKXtpZih0aGlzLmcpdGhyb3cgRXJyb3IoXCJbZ29vZy5uZXQuWGhySW9dIE9iamVjdCBpcyBhY3RpdmUgd2l0aCBhbm90aGVyIHJlcXVlc3Q9XCIrdGhpcy5IK1wiOyBuZXdVcmk9XCIrYSk7Yj1iP2IudG9VcHBlckNhc2UoKTpcIkdFVFwiO3RoaXMuSD1hO3RoaXMuaj1cIlwiO3RoaXMubT0wO3RoaXMuRD0hMTt0aGlzLmg9ITA7dGhpcy5nPXRoaXMudT90aGlzLnUuZygpOlhiLmcoKTt0aGlzLkM9dGhpcy51P1RiKHRoaXMudSk6VGIoWGIpO3RoaXMuZy5vbnJlYWR5c3RhdGVjaGFuZ2U9cSh0aGlzLkhhLHRoaXMpO3RyeXt0aGlzLkY9ITAsdGhpcy5nLm9wZW4oYixTdHJpbmcoYSksITApLHRoaXMuRj0hMTt9Y2F0Y2goZil7b2QodGhpcyxmKTtyZXR1cm59YT1jfHxcIlwiO2M9bmV3IE1hcCh0aGlzLmhlYWRlcnMpO2lmKGQpaWYoT2JqZWN0LmdldFByb3RvdHlwZU9mKGQpPT09T2JqZWN0LnByb3RvdHlwZSlmb3IodmFyIGUgaW4gZCljLnNldChlLGRbZV0pO2Vsc2UgaWYoXCJmdW5jdGlvblwiPT09XG50eXBlb2YgZC5rZXlzJiZcImZ1bmN0aW9uXCI9PT10eXBlb2YgZC5nZXQpZm9yKGNvbnN0IGYgb2YgZC5rZXlzKCkpYy5zZXQoZixkLmdldChmKSk7ZWxzZSB0aHJvdyBFcnJvcihcIlVua25vd24gaW5wdXQgdHlwZSBmb3Igb3B0X2hlYWRlcnM6IFwiK1N0cmluZyhkKSk7ZD1BcnJheS5mcm9tKGMua2V5cygpKS5maW5kKGY9PlwiY29udGVudC10eXBlXCI9PWYudG9Mb3dlckNhc2UoKSk7ZT1sLkZvcm1EYXRhJiZhIGluc3RhbmNlb2YgbC5Gb3JtRGF0YTshKDA8PWxhKG5kLGIpKXx8ZHx8ZXx8Yy5zZXQoXCJDb250ZW50LVR5cGVcIixcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDtjaGFyc2V0PXV0Zi04XCIpO2Zvcihjb25zdCBbZixoXW9mIGMpdGhpcy5nLnNldFJlcXVlc3RIZWFkZXIoZixoKTt0aGlzLkomJih0aGlzLmcucmVzcG9uc2VUeXBlPXRoaXMuSik7XCJ3aXRoQ3JlZGVudGlhbHNcImluIHRoaXMuZyYmdGhpcy5nLndpdGhDcmVkZW50aWFscyE9PXRoaXMuTCYmKHRoaXMuZy53aXRoQ3JlZGVudGlhbHM9XG50aGlzLkwpO3RyeXtwZCh0aGlzKSwwPHRoaXMuQiYmKCh0aGlzLks9cWQodGhpcy5nKSk/KHRoaXMuZy50aW1lb3V0PXRoaXMuQix0aGlzLmcub250aW1lb3V0PXEodGhpcy5xYSx0aGlzKSk6dGhpcy5BPUFiKHRoaXMucWEsdGhpcy5CLHRoaXMpKSx0aGlzLnY9ITAsdGhpcy5nLnNlbmQoYSksdGhpcy52PSExO31jYXRjaChmKXtvZCh0aGlzLGYpO319O2Z1bmN0aW9uIHFkKGEpe3JldHVybiB5JiZJYSgpJiZcIm51bWJlclwiPT09dHlwZW9mIGEudGltZW91dCYmdm9pZCAwIT09YS5vbnRpbWVvdXR9ay5xYT1mdW5jdGlvbigpe1widW5kZWZpbmVkXCIhPXR5cGVvZiBnb29nJiZ0aGlzLmcmJih0aGlzLmo9XCJUaW1lZCBvdXQgYWZ0ZXIgXCIrdGhpcy5CK1wibXMsIGFib3J0aW5nXCIsdGhpcy5tPTgsQyh0aGlzLFwidGltZW91dFwiKSx0aGlzLmFib3J0KDgpKTt9O1xuZnVuY3Rpb24gb2QoYSxiKXthLmg9ITE7YS5nJiYoYS5sPSEwLGEuZy5hYm9ydCgpLGEubD0hMSk7YS5qPWI7YS5tPTU7cmQoYSk7c2QoYSk7fWZ1bmN0aW9uIHJkKGEpe2EuRHx8KGEuRD0hMCxDKGEsXCJjb21wbGV0ZVwiKSxDKGEsXCJlcnJvclwiKSk7fWsuYWJvcnQ9ZnVuY3Rpb24oYSl7dGhpcy5nJiZ0aGlzLmgmJih0aGlzLmg9ITEsdGhpcy5sPSEwLHRoaXMuZy5hYm9ydCgpLHRoaXMubD0hMSx0aGlzLm09YXx8NyxDKHRoaXMsXCJjb21wbGV0ZVwiKSxDKHRoaXMsXCJhYm9ydFwiKSxzZCh0aGlzKSk7fTtrLk09ZnVuY3Rpb24oKXt0aGlzLmcmJih0aGlzLmgmJih0aGlzLmg9ITEsdGhpcy5sPSEwLHRoaXMuZy5hYm9ydCgpLHRoaXMubD0hMSksc2QodGhpcywhMCkpO1cuWC5NLmNhbGwodGhpcyk7fTtrLkhhPWZ1bmN0aW9uKCl7dGhpcy5zfHwodGhpcy5GfHx0aGlzLnZ8fHRoaXMubD90ZCh0aGlzKTp0aGlzLmZiKCkpO307ay5mYj1mdW5jdGlvbigpe3RkKHRoaXMpO307XG5mdW5jdGlvbiB0ZChhKXtpZihhLmgmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiBnb29nJiYoIWEuQ1sxXXx8NCE9TyhhKXx8MiE9YS5hYSgpKSlpZihhLnYmJjQ9PU8oYSkpQWIoYS5IYSwwLGEpO2Vsc2UgaWYoQyhhLFwicmVhZHlzdGF0ZWNoYW5nZVwiKSw0PT1PKGEpKXthLmg9ITE7dHJ5e2NvbnN0IG49YS5hYSgpO2E6c3dpdGNoKG4pe2Nhc2UgMjAwOmNhc2UgMjAxOmNhc2UgMjAyOmNhc2UgMjA0OmNhc2UgMjA2OmNhc2UgMzA0OmNhc2UgMTIyMzp2YXIgYj0hMDticmVhayBhO2RlZmF1bHQ6Yj0hMTt9dmFyIGM7aWYoIShjPWIpKXt2YXIgZDtpZihkPTA9PT1uKXt2YXIgZT1TdHJpbmcoYS5IKS5tYXRjaChFYylbMV18fG51bGw7aWYoIWUmJmwuc2VsZiYmbC5zZWxmLmxvY2F0aW9uKXt2YXIgZj1sLnNlbGYubG9jYXRpb24ucHJvdG9jb2w7ZT1mLnN1YnN0cigwLGYubGVuZ3RoLTEpO31kPSFtZC50ZXN0KGU/ZS50b0xvd2VyQ2FzZSgpOlwiXCIpO31jPWQ7fWlmKGMpQyhhLFwiY29tcGxldGVcIiksQyhhLFxuXCJzdWNjZXNzXCIpO2Vsc2Uge2EubT02O3RyeXt2YXIgaD0yPE8oYSk/YS5nLnN0YXR1c1RleHQ6XCJcIjt9Y2F0Y2godSl7aD1cIlwiO31hLmo9aCtcIiBbXCIrYS5hYSgpK1wiXVwiO3JkKGEpO319ZmluYWxseXtzZChhKTt9fX1mdW5jdGlvbiBzZChhLGIpe2lmKGEuZyl7cGQoYSk7Y29uc3QgYz1hLmcsZD1hLkNbMF0/YWE6bnVsbDthLmc9bnVsbDthLkM9bnVsbDtifHxDKGEsXCJyZWFkeVwiKTt0cnl7Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZDt9Y2F0Y2goZSl7fX19ZnVuY3Rpb24gcGQoYSl7YS5nJiZhLksmJihhLmcub250aW1lb3V0PW51bGwpO2EuQSYmKGwuY2xlYXJUaW1lb3V0KGEuQSksYS5BPW51bGwpO31mdW5jdGlvbiBPKGEpe3JldHVybiBhLmc/YS5nLnJlYWR5U3RhdGU6MH1rLmFhPWZ1bmN0aW9uKCl7dHJ5e3JldHVybiAyPE8odGhpcyk/dGhpcy5nLnN0YXR1czotMX1jYXRjaChhKXtyZXR1cm4gLTF9fTtcbmsuZmE9ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIHRoaXMuZz90aGlzLmcucmVzcG9uc2VUZXh0OlwiXCJ9Y2F0Y2goYSl7cmV0dXJuIFwiXCJ9fTtrLlNhPWZ1bmN0aW9uKGEpe2lmKHRoaXMuZyl7dmFyIGI9dGhpcy5nLnJlc3BvbnNlVGV4dDthJiYwPT1iLmluZGV4T2YoYSkmJihiPWIuc3Vic3RyaW5nKGEubGVuZ3RoKSk7cmV0dXJuIGtkKGIpfX07ZnVuY3Rpb24gaGMoYSl7dHJ5e2lmKCFhLmcpcmV0dXJuIG51bGw7aWYoXCJyZXNwb25zZVwiaW4gYS5nKXJldHVybiBhLmcucmVzcG9uc2U7c3dpdGNoKGEuSil7Y2FzZSBsZDpjYXNlIFwidGV4dFwiOnJldHVybiBhLmcucmVzcG9uc2VUZXh0O2Nhc2UgXCJhcnJheWJ1ZmZlclwiOmlmKFwibW96UmVzcG9uc2VBcnJheUJ1ZmZlclwiaW4gYS5nKXJldHVybiBhLmcubW96UmVzcG9uc2VBcnJheUJ1ZmZlcn1yZXR1cm4gbnVsbH1jYXRjaChiKXtyZXR1cm4gbnVsbH19ay5FYT1mdW5jdGlvbigpe3JldHVybiB0aGlzLm19O1xuay5PYT1mdW5jdGlvbigpe3JldHVybiBcInN0cmluZ1wiPT09dHlwZW9mIHRoaXMuaj90aGlzLmo6U3RyaW5nKHRoaXMuail9O2Z1bmN0aW9uIHVkKGEpe2xldCBiPVwiXCI7UWEoYSxmdW5jdGlvbihjLGQpe2IrPWQ7Yis9XCI6XCI7Yis9YztiKz1cIlxcclxcblwiO30pO3JldHVybiBifWZ1bmN0aW9uIHZkKGEsYixjKXthOntmb3IoZCBpbiBjKXt2YXIgZD0hMTticmVhayBhfWQ9ITA7fWR8fChjPXVkKGMpLFwic3RyaW5nXCI9PT10eXBlb2YgYT8obnVsbCE9YyYmZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhjKSkpOlMoYSxiLGMpKTt9ZnVuY3Rpb24gd2QoYSxiLGMpe3JldHVybiBjJiZjLmludGVybmFsQ2hhbm5lbFBhcmFtcz9jLmludGVybmFsQ2hhbm5lbFBhcmFtc1thXXx8YjpifVxuZnVuY3Rpb24geGQoYSl7dGhpcy5DYT0wO3RoaXMuaT1bXTt0aGlzLmo9bmV3IEdiO3RoaXMua2E9dGhpcy5zYT10aGlzLkY9dGhpcy5WPXRoaXMuZz10aGlzLnphPXRoaXMuRD10aGlzLmlhPXRoaXMubz10aGlzLlM9dGhpcy5zPW51bGw7dGhpcy5hYj10aGlzLlU9MDt0aGlzLlphPXdkKFwiZmFpbEZhc3RcIiwhMSxhKTt0aGlzLkw9dGhpcy52PXRoaXMudT10aGlzLm09dGhpcy5sPW51bGw7dGhpcy5ZPSEwO3RoaXMucGE9dGhpcy5CYT10aGlzLlQ9LTE7dGhpcy5aPXRoaXMuQT10aGlzLkM9MDt0aGlzLlhhPXdkKFwiYmFzZVJldHJ5RGVsYXlNc1wiLDVFMyxhKTt0aGlzLmJiPXdkKFwicmV0cnlEZWxheVNlZWRNc1wiLDFFNCxhKTt0aGlzLiRhPXdkKFwiZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzXCIsMixhKTt0aGlzLnRhPXdkKFwiZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zXCIsMkU0LGEpO3RoaXMucmE9YSYmYS54bWxIdHRwRmFjdG9yeXx8dm9pZCAwO3RoaXMuRGE9YSYmYS5aYnx8ITE7XG50aGlzLko9dm9pZCAwO3RoaXMuSD1hJiZhLnN1cHBvcnRzQ3Jvc3NEb21haW5YaHJ8fCExO3RoaXMuST1cIlwiO3RoaXMuaD1uZXcgV2MoYSYmYS5jb25jdXJyZW50UmVxdWVzdExpbWl0KTt0aGlzLkZhPW5ldyBhZDt0aGlzLk89YSYmYS5mYXN0SGFuZHNoYWtlfHwhMTt0aGlzLk49YSYmYS5lbmNvZGVJbml0TWVzc2FnZUhlYWRlcnN8fCExO3RoaXMuTyYmdGhpcy5OJiYodGhpcy5OPSExKTt0aGlzLllhPWEmJmEuWGJ8fCExO2EmJmEuQWEmJnRoaXMuai5BYSgpO2EmJmEuZm9yY2VMb25nUG9sbGluZyYmKHRoaXMuWT0hMSk7dGhpcy4kPSF0aGlzLk8mJnRoaXMuWSYmYSYmYS5kZXRlY3RCdWZmZXJpbmdQcm94eXx8ITE7dGhpcy5qYT12b2lkIDA7dGhpcy5QPTA7dGhpcy5LPSExO3RoaXMubGE9dGhpcy5CPW51bGw7fWs9eGQucHJvdG90eXBlO2subWE9ODtrLkc9MTtcbmZ1bmN0aW9uIEFjKGEpe3lkKGEpO2lmKDM9PWEuRyl7dmFyIGI9YS5VKyssYz1NKGEuRik7UyhjLFwiU0lEXCIsYS5JKTtTKGMsXCJSSURcIixiKTtTKGMsXCJUWVBFXCIsXCJ0ZXJtaW5hdGVcIik7emQoYSxjKTtiPW5ldyBMKGEsYS5qLGIsdm9pZCAwKTtiLks9MjtiLnY9ZGMoTShjKSk7Yz0hMTtsLm5hdmlnYXRvciYmbC5uYXZpZ2F0b3Iuc2VuZEJlYWNvbiYmKGM9bC5uYXZpZ2F0b3Iuc2VuZEJlYWNvbihiLnYudG9TdHJpbmcoKSxcIlwiKSk7IWMmJmwuSW1hZ2UmJigobmV3IEltYWdlKS5zcmM9Yi52LGM9ITApO2N8fChiLmc9Z2MoYi5sLG51bGwpLGIuZy5kYShiLnYpKTtiLkY9RGF0ZS5ub3coKTtOKGIpO31BZChhKTt9ZnVuY3Rpb24gc2MoYSl7YS5nJiYob2MoYSksYS5nLmNhbmNlbCgpLGEuZz1udWxsKTt9XG5mdW5jdGlvbiB5ZChhKXtzYyhhKTthLnUmJihsLmNsZWFyVGltZW91dChhLnUpLGEudT1udWxsKTtyYyhhKTthLmguY2FuY2VsKCk7YS5tJiYoXCJudW1iZXJcIj09PXR5cGVvZiBhLm0mJmwuY2xlYXJUaW1lb3V0KGEubSksYS5tPW51bGwpO31mdW5jdGlvbiB6YyhhKXtZYyhhLmgpfHxhLm18fChhLm09ITAsc2IoYS5KYSxhKSxhLkM9MCk7fWZ1bmN0aW9uIEJkKGEsYil7aWYodWMoYS5oKT49YS5oLmotKGEubT8xOjApKXJldHVybiAhMTtpZihhLm0pcmV0dXJuIGEuaT1iLkQuY29uY2F0KGEuaSksITA7aWYoMT09YS5HfHwyPT1hLkd8fGEuQz49KGEuWmE/MDphLiRhKSlyZXR1cm4gITE7YS5tPUoocShhLkphLGEsYiksQ2QoYSxhLkMpKTthLkMrKztyZXR1cm4gITB9XG5rLkphPWZ1bmN0aW9uKGEpe2lmKHRoaXMubSlpZih0aGlzLm09bnVsbCwxPT10aGlzLkcpe2lmKCFhKXt0aGlzLlU9TWF0aC5mbG9vcigxRTUqTWF0aC5yYW5kb20oKSk7YT10aGlzLlUrKztjb25zdCBlPW5ldyBMKHRoaXMsdGhpcy5qLGEsdm9pZCAwKTtsZXQgZj10aGlzLnM7dGhpcy5TJiYoZj8oZj1SYShmKSxUYShmLHRoaXMuUykpOmY9dGhpcy5TKTtudWxsIT09dGhpcy5vfHx0aGlzLk58fChlLkg9ZixmPW51bGwpO2lmKHRoaXMuTylhOnt2YXIgYj0wO2Zvcih2YXIgYz0wO2M8dGhpcy5pLmxlbmd0aDtjKyspe2I6e3ZhciBkPXRoaXMuaVtjXTtpZihcIl9fZGF0YV9fXCJpbiBkLmcmJihkPWQuZy5fX2RhdGFfXyxcInN0cmluZ1wiPT09dHlwZW9mIGQpKXtkPWQubGVuZ3RoO2JyZWFrIGJ9ZD12b2lkIDA7fWlmKHZvaWQgMD09PWQpYnJlYWs7Yis9ZDtpZig0MDk2PGIpe2I9YzticmVhayBhfWlmKDQwOTY9PT1ifHxjPT09dGhpcy5pLmxlbmd0aC0xKXtiPWMrMTticmVhayBhfX1iPTFFMzt9ZWxzZSBiPVxuMUUzO2I9RGQodGhpcyxlLGIpO2M9TSh0aGlzLkYpO1MoYyxcIlJJRFwiLGEpO1MoYyxcIkNWRVJcIiwyMik7dGhpcy5EJiZTKGMsXCJYLUhUVFAtU2Vzc2lvbi1JZFwiLHRoaXMuRCk7emQodGhpcyxjKTtmJiYodGhpcy5OP2I9XCJoZWFkZXJzPVwiK2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodWQoZikpKStcIiZcIitiOnRoaXMubyYmdmQoYyx0aGlzLm8sZikpO3ZjKHRoaXMuaCxlKTt0aGlzLllhJiZTKGMsXCJUWVBFXCIsXCJpbml0XCIpO3RoaXMuTz8oUyhjLFwiJHJlcVwiLGIpLFMoYyxcIlNJRFwiLFwibnVsbFwiKSxlLlo9ITAsY2MoZSxjLG51bGwpKTpjYyhlLGMsYik7dGhpcy5HPTI7fX1lbHNlIDM9PXRoaXMuRyYmKGE/RWQodGhpcyxhKTowPT10aGlzLmkubGVuZ3RofHxZYyh0aGlzLmgpfHxFZCh0aGlzKSk7fTtcbmZ1bmN0aW9uIEVkKGEsYil7dmFyIGM7Yj9jPWIubTpjPWEuVSsrO2NvbnN0IGQ9TShhLkYpO1MoZCxcIlNJRFwiLGEuSSk7UyhkLFwiUklEXCIsYyk7UyhkLFwiQUlEXCIsYS5UKTt6ZChhLGQpO2EubyYmYS5zJiZ2ZChkLGEubyxhLnMpO2M9bmV3IEwoYSxhLmosYyxhLkMrMSk7bnVsbD09PWEubyYmKGMuSD1hLnMpO2ImJihhLmk9Yi5ELmNvbmNhdChhLmkpKTtiPURkKGEsYywxRTMpO2Muc2V0VGltZW91dChNYXRoLnJvdW5kKC41KmEudGEpK01hdGgucm91bmQoLjUqYS50YSpNYXRoLnJhbmRvbSgpKSk7dmMoYS5oLGMpO2NjKGMsZCxiKTt9ZnVuY3Rpb24gemQoYSxiKXthLmlhJiZRYShhLmlhLGZ1bmN0aW9uKGMsZCl7UyhiLGQsYyk7fSk7YS5sJiZEYyh7fSxmdW5jdGlvbihjLGQpe1MoYixkLGMpO30pO31cbmZ1bmN0aW9uIERkKGEsYixjKXtjPU1hdGgubWluKGEuaS5sZW5ndGgsYyk7dmFyIGQ9YS5sP3EoYS5sLlJhLGEubCxhKTpudWxsO2E6e3ZhciBlPWEuaTtsZXQgZj0tMTtmb3IoOzspe2NvbnN0IGg9W1wiY291bnQ9XCIrY107LTE9PWY/MDxjPyhmPWVbMF0uaCxoLnB1c2goXCJvZnM9XCIrZikpOmY9MDpoLnB1c2goXCJvZnM9XCIrZik7bGV0IG49ITA7Zm9yKGxldCB1PTA7dTxjO3UrKyl7bGV0IG09ZVt1XS5oO2NvbnN0IHI9ZVt1XS5nO20tPWY7aWYoMD5tKWY9TWF0aC5tYXgoMCxlW3VdLmgtMTAwKSxuPSExO2Vsc2UgdHJ5e2JkKHIsaCxcInJlcVwiK20rXCJfXCIpO31jYXRjaChGKXtkJiZkKHIpO319aWYobil7ZD1oLmpvaW4oXCImXCIpO2JyZWFrIGF9fX1hPWEuaS5zcGxpY2UoMCxjKTtiLkQ9YTtyZXR1cm4gZH1mdW5jdGlvbiB5YyhhKXthLmd8fGEudXx8KGEuWj0xLHNiKGEuSWEsYSksYS5BPTApO31cbmZ1bmN0aW9uIHRjKGEpe2lmKGEuZ3x8YS51fHwzPD1hLkEpcmV0dXJuICExO2EuWisrO2EudT1KKHEoYS5JYSxhKSxDZChhLGEuQSkpO2EuQSsrO3JldHVybiAhMH1rLklhPWZ1bmN0aW9uKCl7dGhpcy51PW51bGw7RmQodGhpcyk7aWYodGhpcy4kJiYhKHRoaXMuS3x8bnVsbD09dGhpcy5nfHwwPj10aGlzLlApKXt2YXIgYT0yKnRoaXMuUDt0aGlzLmouaW5mbyhcIkJQIGRldGVjdGlvbiB0aW1lciBlbmFibGVkOiBcIithKTt0aGlzLkI9SihxKHRoaXMuZWIsdGhpcyksYSk7fX07ay5lYj1mdW5jdGlvbigpe3RoaXMuQiYmKHRoaXMuQj1udWxsLHRoaXMuai5pbmZvKFwiQlAgZGV0ZWN0aW9uIHRpbWVvdXQgcmVhY2hlZC5cIiksdGhpcy5qLmluZm8oXCJCdWZmZXJpbmcgcHJveHkgZGV0ZWN0ZWQgYW5kIHN3aXRjaCB0byBsb25nLXBvbGxpbmchXCIpLHRoaXMuTD0hMSx0aGlzLks9ITAsSSgxMCksc2ModGhpcyksRmQodGhpcykpO307XG5mdW5jdGlvbiBvYyhhKXtudWxsIT1hLkImJihsLmNsZWFyVGltZW91dChhLkIpLGEuQj1udWxsKTt9ZnVuY3Rpb24gRmQoYSl7YS5nPW5ldyBMKGEsYS5qLFwicnBjXCIsYS5aKTtudWxsPT09YS5vJiYoYS5nLkg9YS5zKTthLmcuTj0wO3ZhciBiPU0oYS5zYSk7UyhiLFwiUklEXCIsXCJycGNcIik7UyhiLFwiU0lEXCIsYS5JKTtTKGIsXCJDSVwiLGEuTD9cIjBcIjpcIjFcIik7UyhiLFwiQUlEXCIsYS5UKTtTKGIsXCJUWVBFXCIsXCJ4bWxodHRwXCIpO3pkKGEsYik7YS5vJiZhLnMmJnZkKGIsYS5vLGEucyk7YS5KJiZhLmcuc2V0VGltZW91dChhLkopO3ZhciBjPWEuZzthPWEua2E7Yy5LPTE7Yy52PWRjKE0oYikpO2Mucz1udWxsO2MuUD0hMDtlYyhjLGEpO31rLmNiPWZ1bmN0aW9uKCl7bnVsbCE9dGhpcy52JiYodGhpcy52PW51bGwsc2ModGhpcyksdGModGhpcyksSSgxOSkpO307ZnVuY3Rpb24gcmMoYSl7bnVsbCE9YS52JiYobC5jbGVhclRpbWVvdXQoYS52KSxhLnY9bnVsbCk7fVxuZnVuY3Rpb24gbWMoYSxiKXt2YXIgYz1udWxsO2lmKGEuZz09Yil7cmMoYSk7b2MoYSk7YS5nPW51bGw7dmFyIGQ9Mjt9ZWxzZSBpZihxYyhhLmgsYikpYz1iLkQseGMoYS5oLGIpLGQ9MTtlbHNlIHJldHVybjtpZigwIT1hLkcpaWYoYS5wYT1iLlksYi5pKWlmKDE9PWQpe2M9Yi5zP2Iucy5sZW5ndGg6MDtiPURhdGUubm93KCktYi5GO3ZhciBlPWEuQztkPU1iKCk7QyhkLG5ldyBQYihkLGMpKTt6YyhhKTt9ZWxzZSB5YyhhKTtlbHNlIGlmKGU9Yi5vLDM9PWV8fDA9PWUmJjA8YS5wYXx8ISgxPT1kJiZCZChhLGIpfHwyPT1kJiZ0YyhhKSkpc3dpdGNoKGMmJjA8Yy5sZW5ndGgmJihiPWEuaCxiLmk9Yi5pLmNvbmNhdChjKSksZSl7Y2FzZSAxOlIoYSw1KTticmVhaztjYXNlIDQ6UihhLDEwKTticmVhaztjYXNlIDM6UihhLDYpO2JyZWFrO2RlZmF1bHQ6UihhLDIpO319XG5mdW5jdGlvbiBDZChhLGIpe2xldCBjPWEuWGErTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmEuYmIpO2EubHx8KGMqPTIpO3JldHVybiBjKmJ9ZnVuY3Rpb24gUihhLGIpe2Euai5pbmZvKFwiRXJyb3IgY29kZSBcIitiKTtpZigyPT1iKXt2YXIgYz1udWxsO2EubCYmKGM9bnVsbCk7dmFyIGQ9cShhLmtiLGEpO2N8fChjPW5ldyBUKFwiLy93d3cuZ29vZ2xlLmNvbS9pbWFnZXMvY2xlYXJkb3QuZ2lmXCIpLGwubG9jYXRpb24mJlwiaHR0cFwiPT1sLmxvY2F0aW9uLnByb3RvY29sfHxHYyhjLFwiaHR0cHNcIiksZGMoYykpO2NkKGMudG9TdHJpbmcoKSxkKTt9ZWxzZSBJKDIpO2EuRz0wO2EubCYmYS5sLnZhKGIpO0FkKGEpO3lkKGEpO31rLmtiPWZ1bmN0aW9uKGEpe2E/KHRoaXMuai5pbmZvKFwiU3VjY2Vzc2Z1bGx5IHBpbmdlZCBnb29nbGUuY29tXCIpLEkoMikpOih0aGlzLmouaW5mbyhcIkZhaWxlZCB0byBwaW5nIGdvb2dsZS5jb21cIiksSSgxKSk7fTtcbmZ1bmN0aW9uIEFkKGEpe2EuRz0wO2EubGE9W107aWYoYS5sKXtjb25zdCBiPVpjKGEuaCk7aWYoMCE9Yi5sZW5ndGh8fDAhPWEuaS5sZW5ndGgpbmEoYS5sYSxiKSxuYShhLmxhLGEuaSksYS5oLmkubGVuZ3RoPTAsbWEoYS5pKSxhLmkubGVuZ3RoPTA7YS5sLnVhKCk7fX1mdW5jdGlvbiB3YyhhLGIsYyl7dmFyIGQ9YyBpbnN0YW5jZW9mIFQ/TShjKTpuZXcgVChjLHZvaWQgMCk7aWYoXCJcIiE9ZC5nKWImJihkLmc9YitcIi5cIitkLmcpLEhjKGQsZC5tKTtlbHNlIHt2YXIgZT1sLmxvY2F0aW9uO2Q9ZS5wcm90b2NvbDtiPWI/YitcIi5cIitlLmhvc3RuYW1lOmUuaG9zdG5hbWU7ZT0rZS5wb3J0O3ZhciBmPW5ldyBUKG51bGwsdm9pZCAwKTtkJiZHYyhmLGQpO2ImJihmLmc9Yik7ZSYmSGMoZixlKTtjJiYoZi5sPWMpO2Q9Zjt9Yz1hLkQ7Yj1hLnphO2MmJmImJlMoZCxjLGIpO1MoZCxcIlZFUlwiLGEubWEpO3pkKGEsZCk7cmV0dXJuIGR9XG5mdW5jdGlvbiBnYyhhLGIsYyl7aWYoYiYmIWEuSCl0aHJvdyBFcnJvcihcIkNhbid0IGNyZWF0ZSBzZWNvbmRhcnkgZG9tYWluIGNhcGFibGUgWGhySW8gb2JqZWN0LlwiKTtiPWMmJmEuRGEmJiFhLnJhP25ldyBXKG5ldyBlZCh7amI6ITB9KSk6bmV3IFcoYS5yYSk7Yi5LYShhLkgpO3JldHVybiBifWZ1bmN0aW9uIEdkKCl7fWs9R2QucHJvdG90eXBlO2sueGE9ZnVuY3Rpb24oKXt9O2sud2E9ZnVuY3Rpb24oKXt9O2sudmE9ZnVuY3Rpb24oKXt9O2sudWE9ZnVuY3Rpb24oKXt9O2suUmE9ZnVuY3Rpb24oKXt9O2Z1bmN0aW9uIEhkKCl7aWYoeSYmISgxMDw9TnVtYmVyKExhKSkpdGhyb3cgRXJyb3IoXCJFbnZpcm9ubWVudGFsIGVycm9yOiBubyBhdmFpbGFibGUgdHJhbnNwb3J0LlwiKTt9SGQucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IFgoYSxiKX07XG5mdW5jdGlvbiBYKGEsYil7Qi5jYWxsKHRoaXMpO3RoaXMuZz1uZXcgeGQoYik7dGhpcy5sPWE7dGhpcy5oPWImJmIubWVzc2FnZVVybFBhcmFtc3x8bnVsbDthPWImJmIubWVzc2FnZUhlYWRlcnN8fG51bGw7YiYmYi5jbGllbnRQcm90b2NvbEhlYWRlclJlcXVpcmVkJiYoYT9hW1wiWC1DbGllbnQtUHJvdG9jb2xcIl09XCJ3ZWJjaGFubmVsXCI6YT17XCJYLUNsaWVudC1Qcm90b2NvbFwiOlwid2ViY2hhbm5lbFwifSk7dGhpcy5nLnM9YTthPWImJmIuaW5pdE1lc3NhZ2VIZWFkZXJzfHxudWxsO2ImJmIubWVzc2FnZUNvbnRlbnRUeXBlJiYoYT9hW1wiWC1XZWJDaGFubmVsLUNvbnRlbnQtVHlwZVwiXT1iLm1lc3NhZ2VDb250ZW50VHlwZTphPXtcIlgtV2ViQ2hhbm5lbC1Db250ZW50LVR5cGVcIjpiLm1lc3NhZ2VDb250ZW50VHlwZX0pO2ImJmIueWEmJihhP2FbXCJYLVdlYkNoYW5uZWwtQ2xpZW50LVByb2ZpbGVcIl09Yi55YTphPXtcIlgtV2ViQ2hhbm5lbC1DbGllbnQtUHJvZmlsZVwiOmIueWF9KTt0aGlzLmcuUz1cbmE7KGE9YiYmYi5ZYikmJiFwYShhKSYmKHRoaXMuZy5vPWEpO3RoaXMuQT1iJiZiLnN1cHBvcnRzQ3Jvc3NEb21haW5YaHJ8fCExO3RoaXMudj1iJiZiLnNlbmRSYXdKc29ufHwhMTsoYj1iJiZiLmh0dHBTZXNzaW9uSWRQYXJhbSkmJiFwYShiKSYmKHRoaXMuZy5EPWIsYT10aGlzLmgsbnVsbCE9PWEmJmIgaW4gYSYmKGE9dGhpcy5oLGIgaW4gYSYmZGVsZXRlIGFbYl0pKTt0aGlzLmo9bmV3IFkodGhpcyk7fXQoWCxCKTtYLnByb3RvdHlwZS5tPWZ1bmN0aW9uKCl7dGhpcy5nLmw9dGhpcy5qO3RoaXMuQSYmKHRoaXMuZy5IPSEwKTt2YXIgYT10aGlzLmcsYj10aGlzLmwsYz10aGlzLmh8fHZvaWQgMDtJKDApO2EuVj1iO2EuaWE9Y3x8e307YS5MPWEuWTthLkY9d2MoYSxudWxsLGEuVik7emMoYSk7fTtYLnByb3RvdHlwZS5jbG9zZT1mdW5jdGlvbigpe0FjKHRoaXMuZyk7fTtcblgucHJvdG90eXBlLnU9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5nO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSl7dmFyIGM9e307Yy5fX2RhdGFfXz1hO2E9Yzt9ZWxzZSB0aGlzLnYmJihjPXt9LGMuX19kYXRhX189bGIoYSksYT1jKTtiLmkucHVzaChuZXcgVmMoYi5hYisrLGEpKTszPT1iLkcmJnpjKGIpO307WC5wcm90b3R5cGUuTT1mdW5jdGlvbigpe3RoaXMuZy5sPW51bGw7ZGVsZXRlIHRoaXMuajtBYyh0aGlzLmcpO2RlbGV0ZSB0aGlzLmc7WC5YLk0uY2FsbCh0aGlzKTt9O2Z1bmN0aW9uIElkKGEpe1ZiLmNhbGwodGhpcyk7dmFyIGI9YS5fX3NtX187aWYoYil7YTp7Zm9yKGNvbnN0IGMgaW4gYil7YT1jO2JyZWFrIGF9YT12b2lkIDA7fWlmKHRoaXMuaT1hKWE9dGhpcy5pLGI9bnVsbCE9PWImJmEgaW4gYj9iW2FdOnZvaWQgMDt0aGlzLmRhdGE9Yjt9ZWxzZSB0aGlzLmRhdGE9YTt9dChJZCxWYik7ZnVuY3Rpb24gSmQoKXtXYi5jYWxsKHRoaXMpO3RoaXMuc3RhdHVzPTE7fXQoSmQsV2IpO1xuZnVuY3Rpb24gWShhKXt0aGlzLmc9YTt9dChZLEdkKTtZLnByb3RvdHlwZS54YT1mdW5jdGlvbigpe0ModGhpcy5nLFwiYVwiKTt9O1kucHJvdG90eXBlLndhPWZ1bmN0aW9uKGEpe0ModGhpcy5nLG5ldyBJZChhKSk7fTtZLnByb3RvdHlwZS52YT1mdW5jdGlvbihhKXtDKHRoaXMuZyxuZXcgSmQoKSk7fTtZLnByb3RvdHlwZS51YT1mdW5jdGlvbigpe0ModGhpcy5nLFwiYlwiKTt9Oy8qXG5cbiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG5cbiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cbiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5IZC5wcm90b3R5cGUuY3JlYXRlV2ViQ2hhbm5lbD1IZC5wcm90b3R5cGUuZztYLnByb3RvdHlwZS5zZW5kPVgucHJvdG90eXBlLnU7WC5wcm90b3R5cGUub3Blbj1YLnByb3RvdHlwZS5tO1gucHJvdG90eXBlLmNsb3NlPVgucHJvdG90eXBlLmNsb3NlO1FiLk5PX0VSUk9SPTA7UWIuVElNRU9VVD04O1FiLkhUVFBfRVJST1I9NjtSYi5DT01QTEVURT1cImNvbXBsZXRlXCI7VWIuRXZlbnRUeXBlPUs7Sy5PUEVOPVwiYVwiO0suQ0xPU0U9XCJiXCI7Sy5FUlJPUj1cImNcIjtLLk1FU1NBR0U9XCJkXCI7Qi5wcm90b3R5cGUubGlzdGVuPUIucHJvdG90eXBlLk47Vy5wcm90b3R5cGUubGlzdGVuT25jZT1XLnByb3RvdHlwZS5PO1cucHJvdG90eXBlLmdldExhc3RFcnJvcj1XLnByb3RvdHlwZS5PYTtXLnByb3RvdHlwZS5nZXRMYXN0RXJyb3JDb2RlPVcucHJvdG90eXBlLkVhO1cucHJvdG90eXBlLmdldFN0YXR1cz1XLnByb3RvdHlwZS5hYTtXLnByb3RvdHlwZS5nZXRSZXNwb25zZUpzb249Vy5wcm90b3R5cGUuU2E7XG5XLnByb3RvdHlwZS5nZXRSZXNwb25zZVRleHQ9Vy5wcm90b3R5cGUuZmE7Vy5wcm90b3R5cGUuc2VuZD1XLnByb3RvdHlwZS5kYTtXLnByb3RvdHlwZS5zZXRXaXRoQ3JlZGVudGlhbHM9Vy5wcm90b3R5cGUuS2E7dmFyIGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQgPSBlc20uY3JlYXRlV2ViQ2hhbm5lbFRyYW5zcG9ydD1mdW5jdGlvbigpe3JldHVybiBuZXcgSGR9O3ZhciBnZXRTdGF0RXZlbnRUYXJnZXQgPSBlc20uZ2V0U3RhdEV2ZW50VGFyZ2V0PWZ1bmN0aW9uKCl7cmV0dXJuIE1iKCl9O3ZhciBFcnJvckNvZGUgPSBlc20uRXJyb3JDb2RlPVFiO3ZhciBFdmVudFR5cGUgPSBlc20uRXZlbnRUeXBlPVJiO3ZhciBFdmVudCA9IGVzbS5FdmVudD1HO3ZhciBTdGF0ID0gZXNtLlN0YXQ9e3NiOjAsdmI6MSx3YjoyLFBiOjMsVWI6NCxSYjo1LFNiOjYsUWI6NyxPYjo4LFRiOjksUFJPWFk6MTAsTk9QUk9YWToxMSxNYjoxMixJYjoxMyxKYjoxNCxIYjoxNSxLYjoxNixMYjoxNyxvYjoxOCxuYjoxOSxwYjoyMH07XG52YXIgRmV0Y2hYbWxIdHRwRmFjdG9yeSA9IGVzbS5GZXRjaFhtbEh0dHBGYWN0b3J5PWVkO3ZhciBXZWJDaGFubmVsID0gZXNtLldlYkNoYW5uZWw9VWI7dmFyIFhocklvID0gZXNtLlhocklvPVc7XG5cbmV4cG9ydCB7IEVycm9yQ29kZSwgRXZlbnQsIEV2ZW50VHlwZSwgRmV0Y2hYbWxIdHRwRmFjdG9yeSwgU3RhdCwgV2ViQ2hhbm5lbCwgWGhySW8sIGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQsIGVzbSBhcyBkZWZhdWx0LCBnZXRTdGF0RXZlbnRUYXJnZXQgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCJpbXBvcnQgeyBfcmVnaXN0ZXJDb21wb25lbnQsIHJlZ2lzdGVyVmVyc2lvbiwgX2dldFByb3ZpZGVyLCBnZXRBcHAsIF9yZW1vdmVTZXJ2aWNlSW5zdGFuY2UsIFNES19WRVJTSU9OIH0gZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IExvZ2dlciwgTG9nTGV2ZWwgfSBmcm9tICdAZmlyZWJhc2UvbG9nZ2VyJztcbmltcG9ydCB7IEZpcmViYXNlRXJyb3IsIGNyZWF0ZU1vY2tVc2VyVG9rZW4sIGdldE1vZHVsYXJJbnN0YW5jZSwgZGVlcEVxdWFsLCBnZXREZWZhdWx0RW11bGF0b3JIb3N0bmFtZUFuZFBvcnQsIGdldFVBLCBpc0luZGV4ZWREQkF2YWlsYWJsZSwgaXNTYWZhcmkgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBYaHJJbywgRXZlbnRUeXBlLCBFcnJvckNvZGUsIGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQsIGdldFN0YXRFdmVudFRhcmdldCwgRmV0Y2hYbWxIdHRwRmFjdG9yeSwgV2ViQ2hhbm5lbCwgRXZlbnQsIFN0YXQgfSBmcm9tICdAZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyJztcblxuY29uc3QgYiA9IFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTaW1wbGUgd3JhcHBlciBhcm91bmQgYSBudWxsYWJsZSBVSUQuIE1vc3RseSBleGlzdHMgdG8gbWFrZSBjb2RlIG1vcmVcbiAqIHJlYWRhYmxlLlxuICovXG5jbGFzcyBQIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMudWlkID0gdDtcbiAgICB9XG4gICAgaXNBdXRoZW50aWNhdGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPSB0aGlzLnVpZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGtleSByZXByZXNlbnRpbmcgdGhpcyB1c2VyLCBzdWl0YWJsZSBmb3IgaW5jbHVzaW9uIGluIGFcbiAgICAgKiBkaWN0aW9uYXJ5LlxuICAgICAqLyAgICB0b0tleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNBdXRoZW50aWNhdGVkKCkgPyBcInVpZDpcIiArIHRoaXMudWlkIDogXCJhbm9ueW1vdXMtdXNlclwiO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHQudWlkID09PSB0aGlzLnVpZDtcbiAgICB9XG59XG5cbi8qKiBBIHVzZXIgd2l0aCBhIG51bGwgVUlELiAqLyBQLlVOQVVUSEVOVElDQVRFRCA9IG5ldyBQKG51bGwpLCBcbi8vIFRPRE8obWlrZWxlaGVuKTogTG9vayBpbnRvIGdldHRpbmcgYSBwcm9wZXIgdWlkLWVxdWl2YWxlbnQgZm9yXG4vLyBub24tRmlyZWJhc2VBdXRoIHByb3ZpZGVycy5cblAuR09PR0xFX0NSRURFTlRJQUxTID0gbmV3IFAoXCJnb29nbGUtY3JlZGVudGlhbHMtdWlkXCIpLCBQLkZJUlNUX1BBUlRZID0gbmV3IFAoXCJmaXJzdC1wYXJ0eS11aWRcIiksIFxuUC5NT0NLX1VTRVIgPSBuZXcgUChcIm1vY2stdXNlclwiKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCB2ID0gXCI5LjE2LjBcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IFYgPSBuZXcgTG9nZ2VyKFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiKTtcblxuLy8gSGVscGVyIG1ldGhvZHMgYXJlIG5lZWRlZCBiZWNhdXNlIHZhcmlhYmxlcyBjYW4ndCBiZSBleHBvcnRlZCBhcyByZWFkL3dyaXRlXG5mdW5jdGlvbiBTKCkge1xuICAgIHJldHVybiBWLmxvZ0xldmVsO1xufVxuXG4vKipcbiAqIFNldHMgdGhlIHZlcmJvc2l0eSBvZiBDbG91ZCBGaXJlc3RvcmUgbG9ncyAoZGVidWcsIGVycm9yLCBvciBzaWxlbnQpLlxuICpcbiAqIEBwYXJhbSBsb2dMZXZlbCAtIFRoZSB2ZXJib3NpdHkgeW91IHNldCBmb3IgYWN0aXZpdHkgYW5kIGVycm9yIGxvZ2dpbmcuIENhblxuICogICBiZSBhbnkgb2YgdGhlIGZvbGxvd2luZyB2YWx1ZXM6XG4gKlxuICogICA8dWw+XG4gKiAgICAgPGxpPmBkZWJ1Z2AgZm9yIHRoZSBtb3N0IHZlcmJvc2UgbG9nZ2luZyBsZXZlbCwgcHJpbWFyaWx5IGZvclxuICogICAgIGRlYnVnZ2luZy48L2xpPlxuICogICAgIDxsaT5gZXJyb3JgIHRvIGxvZyBlcnJvcnMgb25seS48L2xpPlxuICogICAgIDxsaT48Y29kZT5gc2lsZW50YCB0byB0dXJuIG9mZiBsb2dnaW5nLjwvbGk+XG4gKiAgIDwvdWw+XG4gKi8gZnVuY3Rpb24gRCh0KSB7XG4gICAgVi5zZXRMb2dMZXZlbCh0KTtcbn1cblxuZnVuY3Rpb24gQyh0LCAuLi5lKSB7XG4gICAgaWYgKFYubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuREVCVUcpIHtcbiAgICAgICAgY29uc3QgbiA9IGUubWFwKGspO1xuICAgICAgICBWLmRlYnVnKGBGaXJlc3RvcmUgKCR7dn0pOiAke3R9YCwgLi4ubik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB4KHQsIC4uLmUpIHtcbiAgICBpZiAoVi5sb2dMZXZlbCA8PSBMb2dMZXZlbC5FUlJPUikge1xuICAgICAgICBjb25zdCBuID0gZS5tYXAoayk7XG4gICAgICAgIFYuZXJyb3IoYEZpcmVzdG9yZSAoJHt2fSk6ICR7dH1gLCAuLi5uKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gTih0LCAuLi5lKSB7XG4gICAgaWYgKFYubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuV0FSTikge1xuICAgICAgICBjb25zdCBuID0gZS5tYXAoayk7XG4gICAgICAgIFYud2FybihgRmlyZXN0b3JlICgke3Z9KTogJHt0fWAsIC4uLm4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhbiBhZGRpdGlvbmFsIGxvZyBwYXJhbWV0ZXIgdG8gYSBzdHJpbmcgcmVwcmVzZW50YXRpb24uXG4gKi8gZnVuY3Rpb24gayh0KSB7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpIHJldHVybiB0O1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBlID0gdCwgSlNPTi5zdHJpbmdpZnkoZSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBDb252ZXJ0aW5nIHRvIEpTT04gZmFpbGVkLCBqdXN0IGxvZyB0aGUgb2JqZWN0IGRpcmVjdGx5XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKiBGb3JtYXRzIGFuIG9iamVjdCBhcyBhIEpTT04gc3RyaW5nLCBzdWl0YWJsZSBmb3IgbG9nZ2luZy4gKi9cbiAgICB2YXIgZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVW5jb25kaXRpb25hbGx5IGZhaWxzLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZSBnaXZlbiBtZXNzYWdlLlxuICogTWVzc2FnZXMgYXJlIHN0cmlwcGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzLlxuICpcbiAqIFJldHVybnMgYG5ldmVyYCBhbmQgY2FuIGJlIHVzZWQgaW4gZXhwcmVzc2lvbnM6XG4gKiBAZXhhbXBsZVxuICogbGV0IGZ1dHVyZVZhciA9IGZhaWwoJ25vdCBpbXBsZW1lbnRlZCB5ZXQnKTtcbiAqLyBmdW5jdGlvbiBPKHQgPSBcIlVuZXhwZWN0ZWQgc3RhdGVcIikge1xuICAgIC8vIExvZyB0aGUgZmFpbHVyZSBpbiBhZGRpdGlvbiB0byB0aHJvdyBhbiBleGNlcHRpb24sIGp1c3QgaW4gY2FzZSB0aGVcbiAgICAvLyBleGNlcHRpb24gaXMgc3dhbGxvd2VkLlxuICAgIGNvbnN0IGUgPSBgRklSRVNUT1JFICgke3Z9KSBJTlRFUk5BTCBBU1NFUlRJT04gRkFJTEVEOiBgICsgdDtcbiAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgRmlyZXN0b3JlRXJyb3IgaGVyZSBiZWNhdXNlIHRoZXNlIGFyZSBpbnRlcm5hbCBmYWlsdXJlc1xuICAgIC8vIHRoYXQgY2Fubm90IGJlIGhhbmRsZWQgYnkgdGhlIHVzZXIuIChBbHNvIGl0IHdvdWxkIGNyZWF0ZSBhIGNpcmN1bGFyXG4gICAgLy8gZGVwZW5kZW5jeSBiZXR3ZWVuIHRoZSBlcnJvciBhbmQgYXNzZXJ0IG1vZHVsZXMgd2hpY2ggZG9lc24ndCB3b3JrLilcbiAgICB0aHJvdyB4KGUpLCBuZXcgRXJyb3IoZSk7XG59XG5cbi8qKlxuICogRmFpbHMgaWYgdGhlIGdpdmVuIGFzc2VydGlvbiBjb25kaXRpb24gaXMgZmFsc2UsIHRocm93aW5nIGFuIEVycm9yIHdpdGggdGhlXG4gKiBnaXZlbiBtZXNzYWdlIGlmIGl0IGRpZC5cbiAqXG4gKiBNZXNzYWdlcyBhcmUgc3RyaXBwZWQgaW4gcHJvZHVjdGlvbiBidWlsZHMuXG4gKi8gZnVuY3Rpb24gTSh0LCBlKSB7XG4gICAgdCB8fCBPKCk7XG59XG5cbi8qKlxuICogRmFpbHMgaWYgdGhlIGdpdmVuIGFzc2VydGlvbiBjb25kaXRpb24gaXMgZmFsc2UsIHRocm93aW5nIGFuIEVycm9yIHdpdGggdGhlXG4gKiBnaXZlbiBtZXNzYWdlIGlmIGl0IGRpZC5cbiAqXG4gKiBUaGUgY29kZSBvZiBjYWxsc2l0ZXMgaW52b2tpbmcgdGhpcyBmdW5jdGlvbiBhcmUgc3RyaXBwZWQgb3V0IGluIHByb2R1Y3Rpb25cbiAqIGJ1aWxkcy4gQW55IHNpZGUtZWZmZWN0cyBvZiBjb2RlIHdpdGhpbiB0aGUgZGVidWdBc3NlcnQoKSBpbnZvY2F0aW9uIHdpbGwgbm90XG4gKiBoYXBwZW4gaW4gdGhpcyBjYXNlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIEYodCwgZSkge1xuICAgIHQgfHwgTygpO1xufVxuXG4vKipcbiAqIENhc3RzIGBvYmpgIHRvIGBUYC4gSW4gbm9uLXByb2R1Y3Rpb24gYnVpbGRzLCB2ZXJpZmllcyB0aGF0IGBvYmpgIGlzIGFuXG4gKiBpbnN0YW5jZSBvZiBgVGAgYmVmb3JlIGNhc3RpbmcuXG4gKi8gZnVuY3Rpb24gJCh0LCBcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5lKSB7XG4gICAgcmV0dXJuIHQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IEIgPSB7XG4gICAgLy8gQ2F1c2VzIGFyZSBjb3BpZWQgZnJvbTpcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZ3JwYy9ncnBjL2Jsb2IvYmNlZWM5NGVhNGZjNWYwMDg1ZDgxMjM1ZDhlMWMwNjc5OGRjMzQxYS9pbmNsdWRlL2dycGMlMkIlMkIvaW1wbC9jb2RlZ2VuL3N0YXR1c19jb2RlX2VudW0uaFxuICAgIC8qKiBOb3QgYW4gZXJyb3I7IHJldHVybmVkIG9uIHN1Y2Nlc3MuICovXG4gICAgT0s6IFwib2tcIixcbiAgICAvKiogVGhlIG9wZXJhdGlvbiB3YXMgY2FuY2VsbGVkICh0eXBpY2FsbHkgYnkgdGhlIGNhbGxlcikuICovXG4gICAgQ0FOQ0VMTEVEOiBcImNhbmNlbGxlZFwiLFxuICAgIC8qKiBVbmtub3duIGVycm9yIG9yIGFuIGVycm9yIGZyb20gYSBkaWZmZXJlbnQgZXJyb3IgZG9tYWluLiAqL1xuICAgIFVOS05PV046IFwidW5rbm93blwiLFxuICAgIC8qKlxuICAgICAqIENsaWVudCBzcGVjaWZpZWQgYW4gaW52YWxpZCBhcmd1bWVudC4gTm90ZSB0aGF0IHRoaXMgZGlmZmVycyBmcm9tXG4gICAgICogRkFJTEVEX1BSRUNPTkRJVElPTi4gSU5WQUxJRF9BUkdVTUVOVCBpbmRpY2F0ZXMgYXJndW1lbnRzIHRoYXQgYXJlXG4gICAgICogcHJvYmxlbWF0aWMgcmVnYXJkbGVzcyBvZiB0aGUgc3RhdGUgb2YgdGhlIHN5c3RlbSAoZS5nLiwgYSBtYWxmb3JtZWQgZmlsZVxuICAgICAqIG5hbWUpLlxuICAgICAqL1xuICAgIElOVkFMSURfQVJHVU1FTlQ6IFwiaW52YWxpZC1hcmd1bWVudFwiLFxuICAgIC8qKlxuICAgICAqIERlYWRsaW5lIGV4cGlyZWQgYmVmb3JlIG9wZXJhdGlvbiBjb3VsZCBjb21wbGV0ZS4gRm9yIG9wZXJhdGlvbnMgdGhhdFxuICAgICAqIGNoYW5nZSB0aGUgc3RhdGUgb2YgdGhlIHN5c3RlbSwgdGhpcyBlcnJvciBtYXkgYmUgcmV0dXJuZWQgZXZlbiBpZiB0aGVcbiAgICAgKiBvcGVyYXRpb24gaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuIEZvciBleGFtcGxlLCBhIHN1Y2Nlc3NmdWwgcmVzcG9uc2VcbiAgICAgKiBmcm9tIGEgc2VydmVyIGNvdWxkIGhhdmUgYmVlbiBkZWxheWVkIGxvbmcgZW5vdWdoIGZvciB0aGUgZGVhZGxpbmUgdG9cbiAgICAgKiBleHBpcmUuXG4gICAgICovXG4gICAgREVBRExJTkVfRVhDRUVERUQ6IFwiZGVhZGxpbmUtZXhjZWVkZWRcIixcbiAgICAvKiogU29tZSByZXF1ZXN0ZWQgZW50aXR5IChlLmcuLCBmaWxlIG9yIGRpcmVjdG9yeSkgd2FzIG5vdCBmb3VuZC4gKi9cbiAgICBOT1RfRk9VTkQ6IFwibm90LWZvdW5kXCIsXG4gICAgLyoqXG4gICAgICogU29tZSBlbnRpdHkgdGhhdCB3ZSBhdHRlbXB0ZWQgdG8gY3JlYXRlIChlLmcuLCBmaWxlIG9yIGRpcmVjdG9yeSkgYWxyZWFkeVxuICAgICAqIGV4aXN0cy5cbiAgICAgKi9cbiAgICBBTFJFQURZX0VYSVNUUzogXCJhbHJlYWR5LWV4aXN0c1wiLFxuICAgIC8qKlxuICAgICAqIFRoZSBjYWxsZXIgZG9lcyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGV4ZWN1dGUgdGhlIHNwZWNpZmllZCBvcGVyYXRpb24uXG4gICAgICogUEVSTUlTU0lPTl9ERU5JRUQgbXVzdCBub3QgYmUgdXNlZCBmb3IgcmVqZWN0aW9ucyBjYXVzZWQgYnkgZXhoYXVzdGluZ1xuICAgICAqIHNvbWUgcmVzb3VyY2UgKHVzZSBSRVNPVVJDRV9FWEhBVVNURUQgaW5zdGVhZCBmb3IgdGhvc2UgZXJyb3JzKS5cbiAgICAgKiBQRVJNSVNTSU9OX0RFTklFRCBtdXN0IG5vdCBiZSB1c2VkIGlmIHRoZSBjYWxsZXIgY2FuIG5vdCBiZSBpZGVudGlmaWVkXG4gICAgICogKHVzZSBVTkFVVEhFTlRJQ0FURUQgaW5zdGVhZCBmb3IgdGhvc2UgZXJyb3JzKS5cbiAgICAgKi9cbiAgICBQRVJNSVNTSU9OX0RFTklFRDogXCJwZXJtaXNzaW9uLWRlbmllZFwiLFxuICAgIC8qKlxuICAgICAqIFRoZSByZXF1ZXN0IGRvZXMgbm90IGhhdmUgdmFsaWQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgZm9yIHRoZVxuICAgICAqIG9wZXJhdGlvbi5cbiAgICAgKi9cbiAgICBVTkFVVEhFTlRJQ0FURUQ6IFwidW5hdXRoZW50aWNhdGVkXCIsXG4gICAgLyoqXG4gICAgICogU29tZSByZXNvdXJjZSBoYXMgYmVlbiBleGhhdXN0ZWQsIHBlcmhhcHMgYSBwZXItdXNlciBxdW90YSwgb3IgcGVyaGFwcyB0aGVcbiAgICAgKiBlbnRpcmUgZmlsZSBzeXN0ZW0gaXMgb3V0IG9mIHNwYWNlLlxuICAgICAqL1xuICAgIFJFU09VUkNFX0VYSEFVU1RFRDogXCJyZXNvdXJjZS1leGhhdXN0ZWRcIixcbiAgICAvKipcbiAgICAgKiBPcGVyYXRpb24gd2FzIHJlamVjdGVkIGJlY2F1c2UgdGhlIHN5c3RlbSBpcyBub3QgaW4gYSBzdGF0ZSByZXF1aXJlZCBmb3JcbiAgICAgKiB0aGUgb3BlcmF0aW9uJ3MgZXhlY3V0aW9uLiBGb3IgZXhhbXBsZSwgZGlyZWN0b3J5IHRvIGJlIGRlbGV0ZWQgbWF5IGJlXG4gICAgICogbm9uLWVtcHR5LCBhbiBybWRpciBvcGVyYXRpb24gaXMgYXBwbGllZCB0byBhIG5vbi1kaXJlY3RvcnksIGV0Yy5cbiAgICAgKlxuICAgICAqIEEgbGl0bXVzIHRlc3QgdGhhdCBtYXkgaGVscCBhIHNlcnZpY2UgaW1wbGVtZW50b3IgaW4gZGVjaWRpbmdcbiAgICAgKiBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04sIEFCT1JURUQsIGFuZCBVTkFWQUlMQUJMRTpcbiAgICAgKiAgKGEpIFVzZSBVTkFWQUlMQUJMRSBpZiB0aGUgY2xpZW50IGNhbiByZXRyeSBqdXN0IHRoZSBmYWlsaW5nIGNhbGwuXG4gICAgICogIChiKSBVc2UgQUJPUlRFRCBpZiB0aGUgY2xpZW50IHNob3VsZCByZXRyeSBhdCBhIGhpZ2hlci1sZXZlbFxuICAgICAqICAgICAgKGUuZy4sIHJlc3RhcnRpbmcgYSByZWFkLW1vZGlmeS13cml0ZSBzZXF1ZW5jZSkuXG4gICAgICogIChjKSBVc2UgRkFJTEVEX1BSRUNPTkRJVElPTiBpZiB0aGUgY2xpZW50IHNob3VsZCBub3QgcmV0cnkgdW50aWxcbiAgICAgKiAgICAgIHRoZSBzeXN0ZW0gc3RhdGUgaGFzIGJlZW4gZXhwbGljaXRseSBmaXhlZC4gRS5nLiwgaWYgYW4gXCJybWRpclwiXG4gICAgICogICAgICBmYWlscyBiZWNhdXNlIHRoZSBkaXJlY3RvcnkgaXMgbm9uLWVtcHR5LCBGQUlMRURfUFJFQ09ORElUSU9OXG4gICAgICogICAgICBzaG91bGQgYmUgcmV0dXJuZWQgc2luY2UgdGhlIGNsaWVudCBzaG91bGQgbm90IHJldHJ5IHVubGVzc1xuICAgICAqICAgICAgdGhleSBoYXZlIGZpcnN0IGZpeGVkIHVwIHRoZSBkaXJlY3RvcnkgYnkgZGVsZXRpbmcgZmlsZXMgZnJvbSBpdC5cbiAgICAgKiAgKGQpIFVzZSBGQUlMRURfUFJFQ09ORElUSU9OIGlmIHRoZSBjbGllbnQgcGVyZm9ybXMgY29uZGl0aW9uYWxcbiAgICAgKiAgICAgIFJFU1QgR2V0L1VwZGF0ZS9EZWxldGUgb24gYSByZXNvdXJjZSBhbmQgdGhlIHJlc291cmNlIG9uIHRoZVxuICAgICAqICAgICAgc2VydmVyIGRvZXMgbm90IG1hdGNoIHRoZSBjb25kaXRpb24uIEUuZy4sIGNvbmZsaWN0aW5nXG4gICAgICogICAgICByZWFkLW1vZGlmeS13cml0ZSBvbiB0aGUgc2FtZSByZXNvdXJjZS5cbiAgICAgKi9cbiAgICBGQUlMRURfUFJFQ09ORElUSU9OOiBcImZhaWxlZC1wcmVjb25kaXRpb25cIixcbiAgICAvKipcbiAgICAgKiBUaGUgb3BlcmF0aW9uIHdhcyBhYm9ydGVkLCB0eXBpY2FsbHkgZHVlIHRvIGEgY29uY3VycmVuY3kgaXNzdWUgbGlrZVxuICAgICAqIHNlcXVlbmNlciBjaGVjayBmYWlsdXJlcywgdHJhbnNhY3Rpb24gYWJvcnRzLCBldGMuXG4gICAgICpcbiAgICAgKiBTZWUgbGl0bXVzIHRlc3QgYWJvdmUgZm9yIGRlY2lkaW5nIGJldHdlZW4gRkFJTEVEX1BSRUNPTkRJVElPTiwgQUJPUlRFRCxcbiAgICAgKiBhbmQgVU5BVkFJTEFCTEUuXG4gICAgICovXG4gICAgQUJPUlRFRDogXCJhYm9ydGVkXCIsXG4gICAgLyoqXG4gICAgICogT3BlcmF0aW9uIHdhcyBhdHRlbXB0ZWQgcGFzdCB0aGUgdmFsaWQgcmFuZ2UuIEUuZy4sIHNlZWtpbmcgb3IgcmVhZGluZ1xuICAgICAqIHBhc3QgZW5kIG9mIGZpbGUuXG4gICAgICpcbiAgICAgKiBVbmxpa2UgSU5WQUxJRF9BUkdVTUVOVCwgdGhpcyBlcnJvciBpbmRpY2F0ZXMgYSBwcm9ibGVtIHRoYXQgbWF5IGJlIGZpeGVkXG4gICAgICogaWYgdGhlIHN5c3RlbSBzdGF0ZSBjaGFuZ2VzLiBGb3IgZXhhbXBsZSwgYSAzMi1iaXQgZmlsZSBzeXN0ZW0gd2lsbFxuICAgICAqIGdlbmVyYXRlIElOVkFMSURfQVJHVU1FTlQgaWYgYXNrZWQgdG8gcmVhZCBhdCBhbiBvZmZzZXQgdGhhdCBpcyBub3QgaW4gdGhlXG4gICAgICogcmFuZ2UgWzAsMl4zMi0xXSwgYnV0IGl0IHdpbGwgZ2VuZXJhdGUgT1VUX09GX1JBTkdFIGlmIGFza2VkIHRvIHJlYWQgZnJvbVxuICAgICAqIGFuIG9mZnNldCBwYXN0IHRoZSBjdXJyZW50IGZpbGUgc2l6ZS5cbiAgICAgKlxuICAgICAqIFRoZXJlIGlzIGEgZmFpciBiaXQgb2Ygb3ZlcmxhcCBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04gYW5kXG4gICAgICogT1VUX09GX1JBTkdFLiBXZSByZWNvbW1lbmQgdXNpbmcgT1VUX09GX1JBTkdFICh0aGUgbW9yZSBzcGVjaWZpYyBlcnJvcilcbiAgICAgKiB3aGVuIGl0IGFwcGxpZXMgc28gdGhhdCBjYWxsZXJzIHdobyBhcmUgaXRlcmF0aW5nIHRocm91Z2ggYSBzcGFjZSBjYW5cbiAgICAgKiBlYXNpbHkgbG9vayBmb3IgYW4gT1VUX09GX1JBTkdFIGVycm9yIHRvIGRldGVjdCB3aGVuIHRoZXkgYXJlIGRvbmUuXG4gICAgICovXG4gICAgT1VUX09GX1JBTkdFOiBcIm91dC1vZi1yYW5nZVwiLFxuICAgIC8qKiBPcGVyYXRpb24gaXMgbm90IGltcGxlbWVudGVkIG9yIG5vdCBzdXBwb3J0ZWQvZW5hYmxlZCBpbiB0aGlzIHNlcnZpY2UuICovXG4gICAgVU5JTVBMRU1FTlRFRDogXCJ1bmltcGxlbWVudGVkXCIsXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgZXJyb3JzLiBNZWFucyBzb21lIGludmFyaWFudHMgZXhwZWN0ZWQgYnkgdW5kZXJseWluZyBTeXN0ZW0gaGFzXG4gICAgICogYmVlbiBicm9rZW4uIElmIHlvdSBzZWUgb25lIG9mIHRoZXNlIGVycm9ycywgU29tZXRoaW5nIGlzIHZlcnkgYnJva2VuLlxuICAgICAqL1xuICAgIElOVEVSTkFMOiBcImludGVybmFsXCIsXG4gICAgLyoqXG4gICAgICogVGhlIHNlcnZpY2UgaXMgY3VycmVudGx5IHVuYXZhaWxhYmxlLiBUaGlzIGlzIGEgbW9zdCBsaWtlbHkgYSB0cmFuc2llbnRcbiAgICAgKiBjb25kaXRpb24gYW5kIG1heSBiZSBjb3JyZWN0ZWQgYnkgcmV0cnlpbmcgd2l0aCBhIGJhY2tvZmYuXG4gICAgICpcbiAgICAgKiBTZWUgbGl0bXVzIHRlc3QgYWJvdmUgZm9yIGRlY2lkaW5nIGJldHdlZW4gRkFJTEVEX1BSRUNPTkRJVElPTiwgQUJPUlRFRCxcbiAgICAgKiBhbmQgVU5BVkFJTEFCTEUuXG4gICAgICovXG4gICAgVU5BVkFJTEFCTEU6IFwidW5hdmFpbGFibGVcIixcbiAgICAvKiogVW5yZWNvdmVyYWJsZSBkYXRhIGxvc3Mgb3IgY29ycnVwdGlvbi4gKi9cbiAgICBEQVRBX0xPU1M6IFwiZGF0YS1sb3NzXCJcbn07XG5cbi8qKiBBbiBlcnJvciByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBvcGVyYXRpb24uICovIGNsYXNzIEwgZXh0ZW5kcyBGaXJlYmFzZUVycm9yIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBiYWNrZW5kIGVycm9yIGNvZGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZXJyb3IuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogQSBjdXN0b20gZXJyb3IgZGVzY3JpcHRpb24uXG4gICAgICovXG4gICAgZSkge1xuICAgICAgICBzdXBlcih0LCBlKSwgdGhpcy5jb2RlID0gdCwgdGhpcy5tZXNzYWdlID0gZSwgXG4gICAgICAgIC8vIEhBQ0s6IFdlIHdyaXRlIGEgdG9TdHJpbmcgcHJvcGVydHkgZGlyZWN0bHkgYmVjYXVzZSBFcnJvciBpcyBub3QgYSByZWFsXG4gICAgICAgIC8vIGNsYXNzIGFuZCBzbyBpbmhlcml0YW5jZSBkb2VzIG5vdCB3b3JrIGNvcnJlY3RseS4gV2UgY291bGQgYWx0ZXJuYXRpdmVseVxuICAgICAgICAvLyBkbyB0aGUgc2FtZSBcImJhY2stZG9vciBpbmhlcml0YW5jZVwiIHRyaWNrIHRoYXQgRmlyZWJhc2VFcnJvciBkb2VzLlxuICAgICAgICB0aGlzLnRvU3RyaW5nID0gKCkgPT4gYCR7dGhpcy5uYW1lfTogW2NvZGU9JHt0aGlzLmNvZGV9XTogJHt0aGlzLm1lc3NhZ2V9YDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIHEge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZSA9IHQsIHRoaXMucmVqZWN0ID0gZTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgVSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLnVzZXIgPSBlLCB0aGlzLnR5cGUgPSBcIk9BdXRoXCIsIHRoaXMuaGVhZGVycyA9IG5ldyBNYXAsIHRoaXMuaGVhZGVycy5zZXQoXCJBdXRob3JpemF0aW9uXCIsIGBCZWFyZXIgJHt0fWApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIENyZWRlbnRpYWxzUHJvdmlkZXIgdGhhdCBhbHdheXMgeWllbGRzIGFuIGVtcHR5IHRva2VuLlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgSyB7XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG4gICAgc3RhcnQodCwgZSkge1xuICAgICAgICAvLyBGaXJlIHdpdGggaW5pdGlhbCB1c2VyLlxuICAgICAgICB0LmVucXVldWVSZXRyeWFibGUoKCgpID0+IGUoUC5VTkFVVEhFTlRJQ0FURUQpKSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge31cbn1cblxuLyoqXG4gKiBBIENyZWRlbnRpYWxzUHJvdmlkZXIgdGhhdCBhbHdheXMgcmV0dXJucyBhIGNvbnN0YW50IHRva2VuLiBVc2VkIGZvclxuICogZW11bGF0b3IgdG9rZW4gbW9ja2luZy5cbiAqLyBjbGFzcyBHIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMudG9rZW4gPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyB0aGUgbGlzdGVuZXIgcmVnaXN0ZXJlZCB3aXRoIHNldENoYW5nZUxpc3RlbmVyKClcbiAgICAgICAgICogVGhpcyBpc24ndCBhY3R1YWxseSBuZWNlc3Nhcnkgc2luY2UgdGhlIFVJRCBuZXZlciBjaGFuZ2VzLCBidXQgd2UgdXNlIHRoaXNcbiAgICAgICAgICogdG8gdmVyaWZ5IHRoZSBsaXN0ZW4gY29udHJhY3QgaXMgYWRoZXJlZCB0byBpbiB0ZXN0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSBudWxsO1xuICAgIH1cbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLnRva2VuKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbiAgICBzdGFydCh0LCBlKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSBlLCBcbiAgICAgICAgLy8gRmlyZSB3aXRoIGluaXRpYWwgdXNlci5cbiAgICAgICAgdC5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiBlKHRoaXMudG9rZW4udXNlcikpKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXIgPSBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgUSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnQgPSB0LCBcbiAgICAgICAgLyoqIFRyYWNrcyB0aGUgY3VycmVudCBVc2VyLiAqL1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gUC5VTkFVVEhFTlRJQ0FURUQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQ291bnRlciB1c2VkIHRvIGRldGVjdCBpZiB0aGUgdG9rZW4gY2hhbmdlZCB3aGlsZSBhIGdldFRva2VuIHJlcXVlc3Qgd2FzXG4gICAgICAgICAqIG91dHN0YW5kaW5nLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pID0gMCwgdGhpcy5mb3JjZVJlZnJlc2ggPSAhMSwgdGhpcy5hdXRoID0gbnVsbDtcbiAgICB9XG4gICAgc3RhcnQodCwgZSkge1xuICAgICAgICBsZXQgbiA9IHRoaXMuaTtcbiAgICAgICAgLy8gQSBjaGFuZ2UgbGlzdGVuZXIgdGhhdCBwcmV2ZW50cyBkb3VibGUtZmlyaW5nIGZvciB0aGUgc2FtZSB0b2tlbiBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IHQgPT4gdGhpcy5pICE9PSBuID8gKG4gPSB0aGlzLmksIGUodCkpIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIC8vIEEgcHJvbWlzZSB0aGF0IGNhbiBiZSB3YWl0ZWQgb24gdG8gYmxvY2sgb24gdGhlIG5leHQgdG9rZW4gY2hhbmdlLlxuICAgICAgICAvLyBUaGlzIHByb21pc2UgaXMgcmUtY3JlYXRlZCBhZnRlciBlYWNoIGNoYW5nZS5cbiAgICAgICAgICAgICAgICBsZXQgaSA9IG5ldyBxO1xuICAgICAgICB0aGlzLm8gPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmkrKywgdGhpcy5jdXJyZW50VXNlciA9IHRoaXMudSgpLCBpLnJlc29sdmUoKSwgaSA9IG5ldyBxLCB0LmVucXVldWVSZXRyeWFibGUoKCgpID0+IHModGhpcy5jdXJyZW50VXNlcikpKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgciA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBpO1xuICAgICAgICAgICAgdC5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgZS5wcm9taXNlLCBhd2FpdCBzKHRoaXMuY3VycmVudFVzZXIpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9LCBvID0gdCA9PiB7XG4gICAgICAgICAgICBDKFwiRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlclwiLCBcIkF1dGggZGV0ZWN0ZWRcIiksIHRoaXMuYXV0aCA9IHQsIHRoaXMuYXV0aC5hZGRBdXRoVG9rZW5MaXN0ZW5lcih0aGlzLm8pLCBcbiAgICAgICAgICAgIHIoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy50Lm9uSW5pdCgodCA9PiBvKHQpKSksIFxuICAgICAgICAvLyBPdXIgdXNlcnMgY2FuIGluaXRpYWxpemUgQXV0aCByaWdodCBhZnRlciBGaXJlc3RvcmUsIHNvIHdlIGdpdmUgaXRcbiAgICAgICAgLy8gYSBjaGFuY2UgdG8gcmVnaXN0ZXIgaXRzZWxmIHdpdGggdGhlIGNvbXBvbmVudCBmcmFtZXdvcmsgYmVmb3JlIHdlXG4gICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIHRvIHN0YXJ0IHVwIGluIHVuYXV0aGVudGljYXRlZCBtb2RlLlxuICAgICAgICBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXV0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLnQuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWw6ICEwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdCA/IG8odCkgOiAoXG4gICAgICAgICAgICAgICAgLy8gSWYgYXV0aCBpcyBzdGlsbCBub3QgYXZhaWxhYmxlLCBwcm9jZWVkIHdpdGggYG51bGxgIHVzZXJcbiAgICAgICAgICAgICAgICBDKFwiRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlclwiLCBcIkF1dGggbm90IHlldCBkZXRlY3RlZFwiKSwgaS5yZXNvbHZlKCksIGkgPSBuZXcgcSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCAwKSwgcigpO1xuICAgIH1cbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgLy8gVGFrZSBub3RlIG9mIHRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSB0b2tlbkNvdW50ZXIgc28gdGhhdCB0aGlzIG1ldGhvZFxuICAgICAgICAvLyBjYW4gZmFpbCAod2l0aCBhbiBBQk9SVEVEIGVycm9yKSBpZiB0aGVyZSBpcyBhIHRva2VuIGNoYW5nZSB3aGlsZSB0aGVcbiAgICAgICAgLy8gcmVxdWVzdCBpcyBvdXRzdGFuZGluZy5cbiAgICAgICAgY29uc3QgdCA9IHRoaXMuaSwgZSA9IHRoaXMuZm9yY2VSZWZyZXNoO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JjZVJlZnJlc2ggPSAhMSwgdGhpcy5hdXRoID8gdGhpcy5hdXRoLmdldFRva2VuKGUpLnRoZW4oKGUgPT4gXG4gICAgICAgIC8vIENhbmNlbCB0aGUgcmVxdWVzdCBzaW5jZSB0aGUgdG9rZW4gY2hhbmdlZCB3aGlsZSB0aGUgcmVxdWVzdCB3YXNcbiAgICAgICAgLy8gb3V0c3RhbmRpbmcgc28gdGhlIHJlc3BvbnNlIGlzIHBvdGVudGlhbGx5IGZvciBhIHByZXZpb3VzIHVzZXIgKHdoaWNoXG4gICAgICAgIC8vIHVzZXIsIHdlIGNhbid0IGJlIHN1cmUpLlxuICAgICAgICB0aGlzLmkgIT09IHQgPyAoQyhcIkZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXJcIiwgXCJnZXRUb2tlbiBhYm9ydGVkIGR1ZSB0byB0b2tlbiBjaGFuZ2UuXCIpLCBcbiAgICAgICAgdGhpcy5nZXRUb2tlbigpKSA6IGUgPyAoTShcInN0cmluZ1wiID09IHR5cGVvZiBlLmFjY2Vzc1Rva2VuKSwgbmV3IFUoZS5hY2Nlc3NUb2tlbiwgdGhpcy5jdXJyZW50VXNlcikpIDogbnVsbCkpIDogUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7XG4gICAgICAgIHRoaXMuZm9yY2VSZWZyZXNoID0gITA7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB0aGlzLmF1dGggJiYgdGhpcy5hdXRoLnJlbW92ZUF1dGhUb2tlbkxpc3RlbmVyKHRoaXMubyk7XG4gICAgfVxuICAgIC8vIEF1dGguZ2V0VWlkKCkgY2FuIHJldHVybiBudWxsIGV2ZW4gd2l0aCBhIHVzZXIgbG9nZ2VkIGluLiBJdCBpcyBiZWNhdXNlXG4gICAgLy8gZ2V0VWlkKCkgaXMgc3luY2hyb25vdXMsIGJ1dCB0aGUgYXV0aCBjb2RlIHBvcHVsYXRpbmcgVWlkIGlzIGFzeW5jaHJvbm91cy5cbiAgICAvLyBUaGlzIG1ldGhvZCBzaG91bGQgb25seSBiZSBjYWxsZWQgaW4gdGhlIEF1dGhUb2tlbkxpc3RlbmVyIGNhbGxiYWNrXG4gICAgLy8gdG8gZ3VhcmFudGVlIHRvIGdldCB0aGUgYWN0dWFsIHVzZXIuXG4gICAgdSgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuYXV0aCAmJiB0aGlzLmF1dGguZ2V0VWlkKCk7XG4gICAgICAgIHJldHVybiBNKG51bGwgPT09IHQgfHwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCksIG5ldyBQKHQpO1xuICAgIH1cbn1cblxuLypcbiAqIEZpcnN0UGFydHlUb2tlbiBwcm92aWRlcyBhIGZyZXNoIHRva2VuIGVhY2ggdGltZSBpdHMgdmFsdWVcbiAqIGlzIHJlcXVlc3RlZCwgYmVjYXVzZSBpZiB0aGUgdG9rZW4gaXMgdG9vIG9sZCwgcmVxdWVzdHMgd2lsbCBiZSByZWplY3RlZC5cbiAqIFRlY2huaWNhbGx5IHRoaXMgbWF5IG5vIGxvbmdlciBiZSBuZWNlc3Nhcnkgc2luY2UgdGhlIFNESyBzaG91bGQgZ3JhY2VmdWxseVxuICogcmVjb3ZlciBmcm9tIHVuYXV0aGVudGljYXRlZCBlcnJvcnMgKHNlZSBiLzMzMTQ3ODE4IGZvciBjb250ZXh0KSwgYnV0IGl0J3NcbiAqIHNhZmVyIHRvIGtlZXAgdGhlIGltcGxlbWVudGF0aW9uIGFzLWlzLlxuICovIGNsYXNzIGoge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgdGhpcy5oID0gdCwgdGhpcy5sID0gZSwgdGhpcy5tID0gbiwgdGhpcy5nID0gcywgdGhpcy50eXBlID0gXCJGaXJzdFBhcnR5XCIsIHRoaXMudXNlciA9IFAuRklSU1RfUEFSVFksIFxuICAgICAgICB0aGlzLnAgPSBuZXcgTWFwO1xuICAgIH1cbiAgICAvKiogR2V0cyBhbiBhdXRob3JpemF0aW9uIHRva2VuLCB1c2luZyBhIHByb3ZpZGVkIGZhY3RvcnkgZnVuY3Rpb24sIG9yIGZhbGxpbmcgYmFjayB0byBGaXJzdCBQYXJ0eSBHQVBJLiAqLyAgICBJKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nID8gdGhpcy5nKCkgOiAoXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB0aGlzIHJlYWxseSBpcyBhIEdhcGkgY2xpZW50LlxuICAgICAgICBNKCEoXCJvYmplY3RcIiAhPSB0eXBlb2YgdGhpcy5oIHx8IG51bGwgPT09IHRoaXMuaCB8fCAhdGhpcy5oLmF1dGggfHwgIXRoaXMuaC5hdXRoLmdldEF1dGhIZWFkZXJWYWx1ZUZvckZpcnN0UGFydHkpKSwgXG4gICAgICAgIHRoaXMuaC5hdXRoLmdldEF1dGhIZWFkZXJWYWx1ZUZvckZpcnN0UGFydHkoW10pKTtcbiAgICB9XG4gICAgZ2V0IGhlYWRlcnMoKSB7XG4gICAgICAgIHRoaXMucC5zZXQoXCJYLUdvb2ctQXV0aFVzZXJcIiwgdGhpcy5sKTtcbiAgICAgICAgLy8gVXNlIGFycmF5IG5vdGF0aW9uIHRvIHByZXZlbnQgbWluaWZpY2F0aW9uXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLkkoKTtcbiAgICAgICAgcmV0dXJuIHQgJiYgdGhpcy5wLnNldChcIkF1dGhvcml6YXRpb25cIiwgdCksIHRoaXMubSAmJiB0aGlzLnAuc2V0KFwiWC1Hb29nLUlhbS1BdXRob3JpemF0aW9uLVRva2VuXCIsIHRoaXMubSksIFxuICAgICAgICB0aGlzLnA7XG4gICAgfVxufVxuXG4vKlxuICogUHJvdmlkZXMgdXNlciBjcmVkZW50aWFscyByZXF1aXJlZCBmb3IgdGhlIEZpcmVzdG9yZSBKYXZhU2NyaXB0IFNES1xuICogdG8gYXV0aGVudGljYXRlIHRoZSB1c2VyLCB1c2luZyB0ZWNobmlxdWUgdGhhdCBpcyBvbmx5IGF2YWlsYWJsZVxuICogdG8gYXBwbGljYXRpb25zIGhvc3RlZCBieSBHb29nbGUuXG4gKi8gY2xhc3MgVyB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLmggPSB0LCB0aGlzLmwgPSBlLCB0aGlzLm0gPSBuLCB0aGlzLmcgPSBzO1xuICAgIH1cbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgaih0aGlzLmgsIHRoaXMubCwgdGhpcy5tLCB0aGlzLmcpKTtcbiAgICB9XG4gICAgc3RhcnQodCwgZSkge1xuICAgICAgICAvLyBGaXJlIHdpdGggaW5pdGlhbCB1aWQuXG4gICAgICAgIHQuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gZShQLkZJUlNUX1BBUlRZKSkpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHt9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbn1cblxuY2xhc3MgeiB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdCwgdGhpcy50eXBlID0gXCJBcHBDaGVja1wiLCB0aGlzLmhlYWRlcnMgPSBuZXcgTWFwLCB0ICYmIHQubGVuZ3RoID4gMCAmJiB0aGlzLmhlYWRlcnMuc2V0KFwieC1maXJlYmFzZS1hcHBjaGVja1wiLCB0aGlzLnZhbHVlKTtcbiAgICB9XG59XG5cbmNsYXNzIEgge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5UID0gdCwgdGhpcy5mb3JjZVJlZnJlc2ggPSAhMSwgdGhpcy5hcHBDaGVjayA9IG51bGwsIHRoaXMuQSA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHQgPT4ge1xuICAgICAgICAgICAgbnVsbCAhPSB0LmVycm9yICYmIEMoXCJGaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlclwiLCBgRXJyb3IgZ2V0dGluZyBBcHAgQ2hlY2sgdG9rZW47IHVzaW5nIHBsYWNlaG9sZGVyIHRva2VuIGluc3RlYWQuIEVycm9yOiAke3QuZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LnRva2VuICE9PSB0aGlzLkE7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5BID0gdC50b2tlbiwgQyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIGBSZWNlaXZlZCAke24gPyBcIm5ld1wiIDogXCJleGlzdGluZ1wifSB0b2tlbi5gKSwgXG4gICAgICAgICAgICBuID8gZSh0LnRva2VuKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm8gPSBlID0+IHtcbiAgICAgICAgICAgIHQuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gbihlKSkpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzID0gdCA9PiB7XG4gICAgICAgICAgICBDKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgXCJBcHBDaGVjayBkZXRlY3RlZFwiKSwgdGhpcy5hcHBDaGVjayA9IHQsIHRoaXMuYXBwQ2hlY2suYWRkVG9rZW5MaXN0ZW5lcih0aGlzLm8pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLlQub25Jbml0KCh0ID0+IHModCkpKSwgXG4gICAgICAgIC8vIE91ciB1c2VycyBjYW4gaW5pdGlhbGl6ZSBBcHBDaGVjayBhZnRlciBGaXJlc3RvcmUsIHNvIHdlIGdpdmUgaXRcbiAgICAgICAgLy8gYSBjaGFuY2UgdG8gcmVnaXN0ZXIgaXRzZWxmIHdpdGggdGhlIGNvbXBvbmVudCBmcmFtZXdvcmsuXG4gICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5hcHBDaGVjaykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLlQuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWw6ICEwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdCA/IHModCkgOiBcbiAgICAgICAgICAgICAgICAvLyBJZiBBcHBDaGVjayBpcyBzdGlsbCBub3QgYXZhaWxhYmxlLCBwcm9jZWVkIHdpdGhvdXQgaXQuXG4gICAgICAgICAgICAgICAgQyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIFwiQXBwQ2hlY2sgbm90IHlldCBkZXRlY3RlZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSksIDApO1xuICAgIH1cbiAgICBnZXRUb2tlbigpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZm9yY2VSZWZyZXNoO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JjZVJlZnJlc2ggPSAhMSwgdGhpcy5hcHBDaGVjayA/IHRoaXMuYXBwQ2hlY2suZ2V0VG9rZW4odCkudGhlbigodCA9PiB0ID8gKE0oXCJzdHJpbmdcIiA9PSB0eXBlb2YgdC50b2tlbiksIFxuICAgICAgICB0aGlzLkEgPSB0LnRva2VuLCBuZXcgeih0LnRva2VuKSkgOiBudWxsKSkgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHtcbiAgICAgICAgdGhpcy5mb3JjZVJlZnJlc2ggPSAhMDtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuYXBwQ2hlY2sgJiYgdGhpcy5hcHBDaGVjay5yZW1vdmVUb2tlbkxpc3RlbmVyKHRoaXMubyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFuIEFwcENoZWNrIHRva2VuIHByb3ZpZGVyIHRoYXQgYWx3YXlzIHlpZWxkcyBhbiBlbXB0eSB0b2tlbi5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIEoge1xuICAgIGdldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyB6KFwiXCIpKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbiAgICBzdGFydCh0LCBlKSB7fVxuICAgIHNodXRkb3duKCkge31cbn1cblxuLyoqXG4gKiBCdWlsZHMgYSBDcmVkZW50aWFsc1Byb3ZpZGVyIGRlcGVuZGluZyBvbiB0aGUgdHlwZSBvZlxuICogdGhlIGNyZWRlbnRpYWxzIHBhc3NlZCBpbi5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogR2VuZXJhdGVzIGBuQnl0ZXNgIG9mIHJhbmRvbSBieXRlcy5cbiAqXG4gKiBJZiBgbkJ5dGVzIDwgMGAgLCBhbiBlcnJvciB3aWxsIGJlIHRocm93bi5cbiAqL1xuZnVuY3Rpb24gWSh0KSB7XG4gICAgLy8gUG9seWZpbGxzIGZvciBJRSBhbmQgV2ViV29ya2VyIGJ5IHVzaW5nIGBzZWxmYCBhbmQgYG1zQ3J5cHRvYCB3aGVuIGBjcnlwdG9gIGlzIG5vdCBhdmFpbGFibGUuXG4gICAgY29uc3QgZSA9IFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygc2VsZiAmJiAoc2VsZi5jcnlwdG8gfHwgc2VsZi5tc0NyeXB0byksIG4gPSBuZXcgVWludDhBcnJheSh0KTtcbiAgICBpZiAoZSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUuZ2V0UmFuZG9tVmFsdWVzKSBlLmdldFJhbmRvbVZhbHVlcyhuKTsgZWxzZSBcbiAgICAvLyBGYWxscyBiYWNrIHRvIE1hdGgucmFuZG9tXG4gICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0OyBlKyspIG5bZV0gPSBNYXRoLmZsb29yKDI1NiAqIE1hdGgucmFuZG9tKCkpO1xuICAgIHJldHVybiBuO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBYIHtcbiAgICBzdGF0aWMgUigpIHtcbiAgICAgICAgLy8gQWxwaGFudW1lcmljIGNoYXJhY3RlcnNcbiAgICAgICAgY29uc3QgdCA9IFwiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODlcIiwgZSA9IE1hdGguZmxvb3IoMjU2IC8gdC5sZW5ndGgpICogdC5sZW5ndGg7XG4gICAgICAgIC8vIFRoZSBsYXJnZXN0IGJ5dGUgdmFsdWUgdGhhdCBpcyBhIG11bHRpcGxlIG9mIGBjaGFyLmxlbmd0aGAuXG4gICAgICAgICAgICAgICAgbGV0IG4gPSBcIlwiO1xuICAgICAgICBmb3IgKDtuLmxlbmd0aCA8IDIwOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBZKDQwKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcy5sZW5ndGg7ICsraSkgXG4gICAgICAgICAgICAvLyBPbmx5IGFjY2VwdCB2YWx1ZXMgdGhhdCBhcmUgWzAsIG1heE11bHRpcGxlKSwgdGhpcyBlbnN1cmVzIHRoZXkgY2FuXG4gICAgICAgICAgICAvLyBiZSBldmVubHkgbWFwcGVkIHRvIGluZGljZXMgb2YgYGNoYXJzYCB2aWEgYSBtb2R1bG8gb3BlcmF0aW9uLlxuICAgICAgICAgICAgbi5sZW5ndGggPCAyMCAmJiBzW2ldIDwgZSAmJiAobiArPSB0LmNoYXJBdChzW2ldICUgdC5sZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbjtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIFoodCwgZSkge1xuICAgIHJldHVybiB0IDwgZSA/IC0xIDogdCA+IGUgPyAxIDogMDtcbn1cblxuLyoqIEhlbHBlciB0byBjb21wYXJlIGFycmF5cyB1c2luZyBpc0VxdWFsKCkuICovIGZ1bmN0aW9uIHR0KHQsIGUsIG4pIHtcbiAgICByZXR1cm4gdC5sZW5ndGggPT09IGUubGVuZ3RoICYmIHQuZXZlcnkoKCh0LCBzKSA9PiBuKHQsIGVbc10pKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgaW1tZWRpYXRlIGxleGljb2dyYXBoaWNhbGx5LWZvbGxvd2luZyBzdHJpbmcuIFRoaXMgaXMgdXNlZnVsIHRvXG4gKiBjb25zdHJ1Y3QgYW4gaW5jbHVzaXZlIHJhbmdlIGZvciBpbmRleGVkZGIgaXRlcmF0b3JzLlxuICovIGZ1bmN0aW9uIGV0KHQpIHtcbiAgICAvLyBSZXR1cm4gdGhlIGlucHV0IHN0cmluZywgd2l0aCBhbiBhZGRpdGlvbmFsIE5VTCBieXRlIGFwcGVuZGVkLlxuICAgIHJldHVybiB0ICsgXCJcXDBcIjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRoZSBlYXJsaWVzdCBkYXRlIHN1cHBvcnRlZCBieSBGaXJlc3RvcmUgdGltZXN0YW1wcyAoMDAwMS0wMS0wMVQwMDowMDowMFopLlxuLyoqXG4gKiBBIGBUaW1lc3RhbXBgIHJlcHJlc2VudHMgYSBwb2ludCBpbiB0aW1lIGluZGVwZW5kZW50IG9mIGFueSB0aW1lIHpvbmUgb3JcbiAqIGNhbGVuZGFyLCByZXByZXNlbnRlZCBhcyBzZWNvbmRzIGFuZCBmcmFjdGlvbnMgb2Ygc2Vjb25kcyBhdCBuYW5vc2Vjb25kXG4gKiByZXNvbHV0aW9uIGluIFVUQyBFcG9jaCB0aW1lLlxuICpcbiAqIEl0IGlzIGVuY29kZWQgdXNpbmcgdGhlIFByb2xlcHRpYyBHcmVnb3JpYW4gQ2FsZW5kYXIgd2hpY2ggZXh0ZW5kcyB0aGVcbiAqIEdyZWdvcmlhbiBjYWxlbmRhciBiYWNrd2FyZHMgdG8geWVhciBvbmUuIEl0IGlzIGVuY29kZWQgYXNzdW1pbmcgYWxsIG1pbnV0ZXNcbiAqIGFyZSA2MCBzZWNvbmRzIGxvbmcsIGkuZS4gbGVhcCBzZWNvbmRzIGFyZSBcInNtZWFyZWRcIiBzbyB0aGF0IG5vIGxlYXAgc2Vjb25kXG4gKiB0YWJsZSBpcyBuZWVkZWQgZm9yIGludGVycHJldGF0aW9uLiBSYW5nZSBpcyBmcm9tIDAwMDEtMDEtMDFUMDA6MDA6MDBaIHRvXG4gKiA5OTk5LTEyLTMxVDIzOjU5OjU5Ljk5OTk5OTk5OVouXG4gKlxuICogRm9yIGV4YW1wbGVzIGFuZCBmdXJ0aGVyIHNwZWNpZmljYXRpb25zLCByZWZlciB0byB0aGVcbiAqIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL3Byb3RvYnVmL2Jsb2IvbWFzdGVyL3NyYy9nb29nbGUvcHJvdG9idWYvdGltZXN0YW1wLnByb3RvIHwgVGltZXN0YW1wIGRlZmluaXRpb259LlxuICovXG5jbGFzcyBudCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2Vjb25kcyAtIFRoZSBudW1iZXIgb2Ygc2Vjb25kcyBvZiBVVEMgdGltZSBzaW5jZSBVbml4IGVwb2NoXG4gICAgICogICAgIDE5NzAtMDEtMDFUMDA6MDA6MDBaLiBNdXN0IGJlIGZyb20gMDAwMS0wMS0wMVQwMDowMDowMFogdG9cbiAgICAgKiAgICAgOTk5OS0xMi0zMVQyMzo1OTo1OVogaW5jbHVzaXZlLlxuICAgICAqIEBwYXJhbSBuYW5vc2Vjb25kcyAtIFRoZSBub24tbmVnYXRpdmUgZnJhY3Rpb25zIG9mIGEgc2Vjb25kIGF0IG5hbm9zZWNvbmRcbiAgICAgKiAgICAgcmVzb2x1dGlvbi4gTmVnYXRpdmUgc2Vjb25kIHZhbHVlcyB3aXRoIGZyYWN0aW9ucyBtdXN0IHN0aWxsIGhhdmVcbiAgICAgKiAgICAgbm9uLW5lZ2F0aXZlIG5hbm9zZWNvbmRzIHZhbHVlcyB0aGF0IGNvdW50IGZvcndhcmQgaW4gdGltZS4gTXVzdCBiZVxuICAgICAqICAgICBmcm9tIDAgdG8gOTk5LDk5OSw5OTkgaW5jbHVzaXZlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBudW1iZXIgb2Ygc2Vjb25kcyBvZiBVVEMgdGltZSBzaW5jZSBVbml4IGVwb2NoIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBmcmFjdGlvbnMgb2YgYSBzZWNvbmQgYXQgbmFub3NlY29uZCByZXNvbHV0aW9uLipcbiAgICAgKi9cbiAgICBlKSB7XG4gICAgICAgIGlmICh0aGlzLnNlY29uZHMgPSB0LCB0aGlzLm5hbm9zZWNvbmRzID0gZSwgZSA8IDApIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgbmFub3NlY29uZHMgb3V0IG9mIHJhbmdlOiBcIiArIGUpO1xuICAgICAgICBpZiAoZSA+PSAxZTkpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgbmFub3NlY29uZHMgb3V0IG9mIHJhbmdlOiBcIiArIGUpO1xuICAgICAgICBpZiAodCA8IC02MjEzNTU5NjgwMCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBzZWNvbmRzIG91dCBvZiByYW5nZTogXCIgKyB0KTtcbiAgICAgICAgLy8gVGhpcyB3aWxsIGJyZWFrIGluIHRoZSB5ZWFyIDEwLDAwMC5cbiAgICAgICAgICAgICAgICBpZiAodCA+PSAyNTM0MDIzMDA4MDApIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wIHdpdGggdGhlIGN1cnJlbnQgZGF0ZSwgd2l0aCBtaWxsaXNlY29uZCBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBhIG5ldyB0aW1lc3RhbXAgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IGRhdGUuXG4gICAgICovICAgIHN0YXRpYyBub3coKSB7XG4gICAgICAgIHJldHVybiBudC5mcm9tTWlsbGlzKERhdGUubm93KCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRpbWVzdGFtcCBmcm9tIHRoZSBnaXZlbiBkYXRlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGUgLSBUaGUgZGF0ZSB0byBpbml0aWFsaXplIHRoZSBgVGltZXN0YW1wYCBmcm9tLlxuICAgICAqIEByZXR1cm5zIEEgbmV3IGBUaW1lc3RhbXBgIHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzIHRoZSBnaXZlblxuICAgICAqICAgICBkYXRlLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbURhdGUodCkge1xuICAgICAgICByZXR1cm4gbnQuZnJvbU1pbGxpcyh0LmdldFRpbWUoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wIGZyb20gdGhlIGdpdmVuIG51bWJlciBvZiBtaWxsaXNlY29uZHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWlsbGlzZWNvbmRzIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoXG4gICAgICogICAgIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqIEByZXR1cm5zIEEgbmV3IGBUaW1lc3RhbXBgIHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzIHRoZSBnaXZlblxuICAgICAqICAgICBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbU1pbGxpcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBNYXRoLmZsb29yKHQgLyAxZTMpLCBuID0gTWF0aC5mbG9vcigxZTYgKiAodCAtIDFlMyAqIGUpKTtcbiAgICAgICAgcmV0dXJuIG5ldyBudChlLCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBgVGltZXN0YW1wYCB0byBhIEphdmFTY3JpcHQgYERhdGVgIG9iamVjdC4gVGhpcyBjb252ZXJzaW9uXG4gICAgICogY2F1c2VzIGEgbG9zcyBvZiBwcmVjaXNpb24gc2luY2UgYERhdGVgIG9iamVjdHMgb25seSBzdXBwb3J0IG1pbGxpc2Vjb25kXG4gICAgICogcHJlY2lzaW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMgSmF2YVNjcmlwdCBgRGF0ZWAgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzXG4gICAgICogICAgIHRoaXMgYFRpbWVzdGFtcGAsIHdpdGggbWlsbGlzZWNvbmQgcHJlY2lzaW9uLlxuICAgICAqLyAgICB0b0RhdGUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLnRvTWlsbGlzKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhIGBUaW1lc3RhbXBgIHRvIGEgbnVtZXJpYyB0aW1lc3RhbXAgKGluIG1pbGxpc2Vjb25kcyBzaW5jZVxuICAgICAqIGVwb2NoKS4gVGhpcyBvcGVyYXRpb24gY2F1c2VzIGEgbG9zcyBvZiBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgcG9pbnQgaW4gdGltZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgdGltZXN0YW1wLCByZXByZXNlbnRlZCBhc1xuICAgICAqICAgICB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqLyAgICB0b01pbGxpcygpIHtcbiAgICAgICAgcmV0dXJuIDFlMyAqIHRoaXMuc2Vjb25kcyArIHRoaXMubmFub3NlY29uZHMgLyAxZTY7XG4gICAgfVxuICAgIF9jb21wYXJlVG8odCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWNvbmRzID09PSB0LnNlY29uZHMgPyBaKHRoaXMubmFub3NlY29uZHMsIHQubmFub3NlY29uZHMpIDogWih0aGlzLnNlY29uZHMsIHQuc2Vjb25kcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBUaW1lc3RhbXBgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYFRpbWVzdGFtcGAgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgVGltZXN0YW1wYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHQuc2Vjb25kcyA9PT0gdGhpcy5zZWNvbmRzICYmIHQubmFub3NlY29uZHMgPT09IHRoaXMubmFub3NlY29uZHM7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgdGV4dHVhbCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGBUaW1lc3RhbXBgLiAqLyAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIFwiVGltZXN0YW1wKHNlY29uZHM9XCIgKyB0aGlzLnNlY29uZHMgKyBcIiwgbmFub3NlY29uZHM9XCIgKyB0aGlzLm5hbm9zZWNvbmRzICsgXCIpXCI7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBgVGltZXN0YW1wYC4gKi8gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2Vjb25kczogdGhpcy5zZWNvbmRzLFxuICAgICAgICAgICAgbmFub3NlY29uZHM6IHRoaXMubmFub3NlY29uZHNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBvYmplY3QgdG8gYSBwcmltaXRpdmUgc3RyaW5nLCB3aGljaCBhbGxvd3MgYFRpbWVzdGFtcGAgb2JqZWN0c1xuICAgICAqIHRvIGJlIGNvbXBhcmVkIHVzaW5nIHRoZSBgPmAsIGA8PWAsIGA+PWAgYW5kIGA+YCBvcGVyYXRvcnMuXG4gICAgICovICAgIHZhbHVlT2YoKSB7XG4gICAgICAgIC8vIFRoaXMgbWV0aG9kIHJldHVybnMgYSBzdHJpbmcgb2YgdGhlIGZvcm0gPHNlY29uZHM+LjxuYW5vc2Vjb25kcz4gd2hlcmVcbiAgICAgICAgLy8gPHNlY29uZHM+IGlzIHRyYW5zbGF0ZWQgdG8gaGF2ZSBhIG5vbi1uZWdhdGl2ZSB2YWx1ZSBhbmQgYm90aCA8c2Vjb25kcz5cbiAgICAgICAgLy8gYW5kIDxuYW5vc2Vjb25kcz4gYXJlIGxlZnQtcGFkZGVkIHdpdGggemVyb2VzIHRvIGJlIGEgY29uc2lzdGVudCBsZW5ndGguXG4gICAgICAgIC8vIFN0cmluZ3Mgd2l0aCB0aGlzIGZvcm1hdCB0aGVuIGhhdmUgYSBsZXhpb2dyYXBoaWNhbCBvcmRlcmluZyB0aGF0IG1hdGNoZXNcbiAgICAgICAgLy8gdGhlIGV4cGVjdGVkIG9yZGVyaW5nLiBUaGUgPHNlY29uZHM+IHRyYW5zbGF0aW9uIGlzIGRvbmUgdG8gYXZvaWQgaGF2aW5nXG4gICAgICAgIC8vIGEgbGVhZGluZyBuZWdhdGl2ZSBzaWduIChpLmUuIGEgbGVhZGluZyAnLScgY2hhcmFjdGVyKSBpbiBpdHMgc3RyaW5nXG4gICAgICAgIC8vIHJlcHJlc2VudGF0aW9uLCB3aGljaCB3b3VsZCBhZmZlY3QgaXRzIGxleGlvZ3JhcGhpY2FsIG9yZGVyaW5nLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5zZWNvbmRzIC0gLTYyMTM1NTk2ODAwO1xuICAgICAgICAvLyBOb3RlOiBVcCB0byAxMiBkZWNpbWFsIGRpZ2l0cyBhcmUgcmVxdWlyZWQgdG8gcmVwcmVzZW50IGFsbCB2YWxpZFxuICAgICAgICAvLyAnc2Vjb25kcycgdmFsdWVzLlxuICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcodCkucGFkU3RhcnQoMTIsIFwiMFwiKSArIFwiLlwiICsgU3RyaW5nKHRoaXMubmFub3NlY29uZHMpLnBhZFN0YXJ0KDksIFwiMFwiKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgdmVyc2lvbiBvZiBhIGRvY3VtZW50IGluIEZpcmVzdG9yZS4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgdmVyc2lvblxuICogdGltZXN0YW1wLCBzdWNoIGFzIHVwZGF0ZV90aW1lIG9yIHJlYWRfdGltZS5cbiAqLyBjbGFzcyBzdCB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnRpbWVzdGFtcCA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tVGltZXN0YW1wKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBzdCh0KTtcbiAgICB9XG4gICAgc3RhdGljIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBzdChuZXcgbnQoMCwgMCkpO1xuICAgIH1cbiAgICBzdGF0aWMgbWF4KCkge1xuICAgICAgICByZXR1cm4gbmV3IHN0KG5ldyBudCgyNTM0MDIzMDA3OTksIDk5OTk5OTk5OSkpO1xuICAgIH1cbiAgICBjb21wYXJlVG8odCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lc3RhbXAuX2NvbXBhcmVUbyh0LnRpbWVzdGFtcCk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lc3RhbXAuaXNFcXVhbCh0LnRpbWVzdGFtcCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgbnVtYmVyIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2ZXJzaW9uIGZvciB1c2UgaW4gc3BlYyB0ZXN0cy4gKi8gICAgdG9NaWNyb3NlY29uZHMoKSB7XG4gICAgICAgIC8vIENvbnZlcnQgdG8gbWljcm9zZWNvbmRzLlxuICAgICAgICByZXR1cm4gMWU2ICogdGhpcy50aW1lc3RhbXAuc2Vjb25kcyArIHRoaXMudGltZXN0YW1wLm5hbm9zZWNvbmRzIC8gMWUzO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIFwiU25hcHNob3RWZXJzaW9uKFwiICsgdGhpcy50aW1lc3RhbXAudG9TdHJpbmcoKSArIFwiKVwiO1xuICAgIH1cbiAgICB0b1RpbWVzdGFtcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUGF0aCByZXByZXNlbnRzIGFuIG9yZGVyZWQgc2VxdWVuY2Ugb2Ygc3RyaW5nIHNlZ21lbnRzLlxuICovXG5jbGFzcyBpdCB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICB2b2lkIDAgPT09IGUgPyBlID0gMCA6IGUgPiB0Lmxlbmd0aCAmJiBPKCksIHZvaWQgMCA9PT0gbiA/IG4gPSB0Lmxlbmd0aCAtIGUgOiBuID4gdC5sZW5ndGggLSBlICYmIE8oKSwgXG4gICAgICAgIHRoaXMuc2VnbWVudHMgPSB0LCB0aGlzLm9mZnNldCA9IGUsIHRoaXMubGVuID0gbjtcbiAgICB9XG4gICAgZ2V0IGxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVuO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIDAgPT09IGl0LmNvbXBhcmF0b3IodGhpcywgdCk7XG4gICAgfVxuICAgIGNoaWxkKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuc2VnbWVudHMuc2xpY2UodGhpcy5vZmZzZXQsIHRoaXMubGltaXQoKSk7XG4gICAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgaXQgPyB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgZS5wdXNoKHQpO1xuICAgICAgICB9KSkgOiBlLnB1c2godCksIHRoaXMuY29uc3RydWN0KGUpO1xuICAgIH1cbiAgICAvKiogVGhlIGluZGV4IG9mIG9uZSBwYXN0IHRoZSBsYXN0IHNlZ21lbnQgb2YgdGhlIHBhdGguICovICAgIGxpbWl0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vZmZzZXQgKyB0aGlzLmxlbmd0aDtcbiAgICB9XG4gICAgcG9wRmlyc3QodCkge1xuICAgICAgICByZXR1cm4gdCA9IHZvaWQgMCA9PT0gdCA/IDEgOiB0LCB0aGlzLmNvbnN0cnVjdCh0aGlzLnNlZ21lbnRzLCB0aGlzLm9mZnNldCArIHQsIHRoaXMubGVuZ3RoIC0gdCk7XG4gICAgfVxuICAgIHBvcExhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdCh0aGlzLnNlZ21lbnRzLCB0aGlzLm9mZnNldCwgdGhpcy5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgZmlyc3RTZWdtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWdtZW50c1t0aGlzLm9mZnNldF07XG4gICAgfVxuICAgIGxhc3RTZWdtZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQodGhpcy5sZW5ndGggLSAxKTtcbiAgICB9XG4gICAgZ2V0KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VnbWVudHNbdGhpcy5vZmZzZXQgKyB0XTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIDAgPT09IHRoaXMubGVuZ3RoO1xuICAgIH1cbiAgICBpc1ByZWZpeE9mKHQpIHtcbiAgICAgICAgaWYgKHQubGVuZ3RoIDwgdGhpcy5sZW5ndGgpIHJldHVybiAhMTtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLmxlbmd0aDsgZSsrKSBpZiAodGhpcy5nZXQoZSkgIT09IHQuZ2V0KGUpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgaXNJbW1lZGlhdGVQYXJlbnRPZih0KSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCArIDEgIT09IHQubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgdGhpcy5sZW5ndGg7IGUrKykgaWYgKHRoaXMuZ2V0KGUpICE9PSB0LmdldChlKSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGZvckVhY2godCkge1xuICAgICAgICBmb3IgKGxldCBlID0gdGhpcy5vZmZzZXQsIG4gPSB0aGlzLmxpbWl0KCk7IGUgPCBuOyBlKyspIHQodGhpcy5zZWdtZW50c1tlXSk7XG4gICAgfVxuICAgIHRvQXJyYXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlZ21lbnRzLnNsaWNlKHRoaXMub2Zmc2V0LCB0aGlzLmxpbWl0KCkpO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcGFyYXRvcih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBNYXRoLm1pbih0Lmxlbmd0aCwgZS5sZW5ndGgpO1xuICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IG47IHMrKykge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQuZ2V0KHMpLCBpID0gZS5nZXQocyk7XG4gICAgICAgICAgICBpZiAobiA8IGkpIHJldHVybiAtMTtcbiAgICAgICAgICAgIGlmIChuID4gaSkgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQubGVuZ3RoIDwgZS5sZW5ndGggPyAtMSA6IHQubGVuZ3RoID4gZS5sZW5ndGggPyAxIDogMDtcbiAgICB9XG59XG5cbi8qKlxuICogQSBzbGFzaC1zZXBhcmF0ZWQgcGF0aCBmb3IgbmF2aWdhdGluZyByZXNvdXJjZXMgKGRvY3VtZW50cyBhbmQgY29sbGVjdGlvbnMpXG4gKiB3aXRoaW4gRmlyZXN0b3JlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIHJ0IGV4dGVuZHMgaXQge1xuICAgIGNvbnN0cnVjdCh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgcnQodCwgZSwgbik7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgLy8gTk9URTogVGhlIGNsaWVudCBpcyBpZ25vcmFudCBvZiBhbnkgcGF0aCBzZWdtZW50cyBjb250YWluaW5nIGVzY2FwZVxuICAgICAgICAvLyBzZXF1ZW5jZXMgKGUuZy4gX19pZDEyM19fKSBhbmQganVzdCBwYXNzZXMgdGhlbSB0aHJvdWdoIHJhdyAodGhleSBleGlzdFxuICAgICAgICAvLyBmb3IgbGVnYWN5IHJlYXNvbnMgYW5kIHNob3VsZCBub3QgYmUgdXNlZCBmcmVxdWVudGx5KS5cbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLmpvaW4oXCIvXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSByZXNvdXJjZSBwYXRoIGZyb20gdGhlIGdpdmVuIHNsYXNoLWRlbGltaXRlZCBzdHJpbmcuIElmIG11bHRpcGxlXG4gICAgICogYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgYWxsIGNvbXBvbmVudHMgYXJlIGNvbWJpbmVkLiBMZWFkaW5nIGFuZCB0cmFpbGluZ1xuICAgICAqIHNsYXNoZXMgZnJvbSBhbGwgY29tcG9uZW50cyBhcmUgaWdub3JlZC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21TdHJpbmcoLi4udCkge1xuICAgICAgICAvLyBOT1RFOiBUaGUgY2xpZW50IGlzIGlnbm9yYW50IG9mIGFueSBwYXRoIHNlZ21lbnRzIGNvbnRhaW5pbmcgZXNjYXBlXG4gICAgICAgIC8vIHNlcXVlbmNlcyAoZS5nLiBfX2lkMTIzX18pIGFuZCBqdXN0IHBhc3NlcyB0aGVtIHRocm91Z2ggcmF3ICh0aGV5IGV4aXN0XG4gICAgICAgIC8vIGZvciBsZWdhY3kgcmVhc29ucyBhbmQgc2hvdWxkIG5vdCBiZSB1c2VkIGZyZXF1ZW50bHkpLlxuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0KSB7XG4gICAgICAgICAgICBpZiAobi5pbmRleE9mKFwiLy9cIikgPj0gMCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBzZWdtZW50ICgke259KS4gUGF0aHMgbXVzdCBub3QgY29udGFpbiAvLyBpbiB0aGVtLmApO1xuICAgICAgICAgICAgLy8gU3RyaXAgbGVhZGluZyBhbmQgdHJhbGluZyBzbGFzaGVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wdXNoKC4uLm4uc3BsaXQoXCIvXCIpLmZpbHRlcigodCA9PiB0Lmxlbmd0aCA+IDApKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBydChlKTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBydChbXSk7XG4gICAgfVxufVxuXG5jb25zdCBvdCA9IC9eW19hLXpBLVpdW19hLXpBLVowLTldKiQvO1xuXG4vKipcbiAqIEEgZG90LXNlcGFyYXRlZCBwYXRoIGZvciBuYXZpZ2F0aW5nIHN1Yi1vYmplY3RzIHdpdGhpbiBhIGRvY3VtZW50LlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgdXQgZXh0ZW5kcyBpdCB7XG4gICAgY29uc3RydWN0KHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyB1dCh0LCBlLCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzdHJpbmcgY291bGQgYmUgdXNlZCBhcyBhIHNlZ21lbnQgaW4gYSBmaWVsZCBwYXRoXG4gICAgICogd2l0aG91dCBlc2NhcGluZy5cbiAgICAgKi8gICAgc3RhdGljIGlzVmFsaWRJZGVudGlmaWVyKHQpIHtcbiAgICAgICAgcmV0dXJuIG90LnRlc3QodCk7XG4gICAgfVxuICAgIGNhbm9uaWNhbFN0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9BcnJheSgpLm1hcCgodCA9PiAodCA9IHQucmVwbGFjZSgvXFxcXC9nLCBcIlxcXFxcXFxcXCIpLnJlcGxhY2UoL2AvZywgXCJcXFxcYFwiKSwgXG4gICAgICAgIHV0LmlzVmFsaWRJZGVudGlmaWVyKHQpIHx8ICh0ID0gXCJgXCIgKyB0ICsgXCJgXCIpLCB0KSkpLmpvaW4oXCIuXCIpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpZWxkIHJlZmVyZW5jZXMgdGhlIGtleSBvZiBhIGRvY3VtZW50LlxuICAgICAqLyAgICBpc0tleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gMSA9PT0gdGhpcy5sZW5ndGggJiYgXCJfX25hbWVfX1wiID09PSB0aGlzLmdldCgwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGZpZWxkIGRlc2lnbmF0aW5nIHRoZSBrZXkgb2YgYSBkb2N1bWVudC5cbiAgICAgKi8gICAgc3RhdGljIGtleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gbmV3IHV0KFsgXCJfX25hbWVfX1wiIF0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBmaWVsZCBzdHJpbmcgZnJvbSB0aGUgZ2l2ZW4gc2VydmVyLWZvcm1hdHRlZCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiAtIFNwbGl0dGluZyB0aGUgZW1wdHkgc3RyaW5nIGlzIG5vdCBhbGxvd2VkIChmb3Igbm93IGF0IGxlYXN0KS5cbiAgICAgKiAtIEVtcHR5IHNlZ21lbnRzIHdpdGhpbiB0aGUgc3RyaW5nIChlLmcuIGlmIHRoZXJlIGFyZSB0d28gY29uc2VjdXRpdmVcbiAgICAgKiAgIHNlcGFyYXRvcnMpIGFyZSBub3QgYWxsb3dlZC5cbiAgICAgKlxuICAgICAqIFRPRE8oYi8zNzI0NDE1Nyk6IHdlIHNob3VsZCBtYWtlIHRoaXMgbW9yZSBzdHJpY3QuIFJpZ2h0IG5vdywgaXQgYWxsb3dzXG4gICAgICogbm9uLWlkZW50aWZpZXIgcGF0aCBjb21wb25lbnRzLCBldmVuIGlmIHRoZXkgYXJlbid0IGVzY2FwZWQuXG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VydmVyRm9ybWF0KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICBsZXQgbiA9IFwiXCIsIHMgPSAwO1xuICAgICAgICBjb25zdCBpID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKDAgPT09IG4ubGVuZ3RoKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7dH0pLiBQYXRocyBtdXN0IG5vdCBiZSBlbXB0eSwgYmVnaW4gd2l0aCAnLicsIGVuZCB3aXRoICcuJywgb3IgY29udGFpbiAnLi4nYCk7XG4gICAgICAgICAgICBlLnB1c2gobiksIG4gPSBcIlwiO1xuICAgICAgICB9O1xuICAgICAgICBsZXQgciA9ICExO1xuICAgICAgICBmb3IgKDtzIDwgdC5sZW5ndGg7ICkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRbc107XG4gICAgICAgICAgICBpZiAoXCJcXFxcXCIgPT09IGUpIHtcbiAgICAgICAgICAgICAgICBpZiAocyArIDEgPT09IHQubGVuZ3RoKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiUGF0aCBoYXMgdHJhaWxpbmcgZXNjYXBlIGNoYXJhY3RlcjogXCIgKyB0KTtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdFtzICsgMV07XG4gICAgICAgICAgICAgICAgaWYgKFwiXFxcXFwiICE9PSBlICYmIFwiLlwiICE9PSBlICYmIFwiYFwiICE9PSBlKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiUGF0aCBoYXMgaW52YWxpZCBlc2NhcGUgc2VxdWVuY2U6IFwiICsgdCk7XG4gICAgICAgICAgICAgICAgbiArPSBlLCBzICs9IDI7XG4gICAgICAgICAgICB9IGVsc2UgXCJgXCIgPT09IGUgPyAociA9ICFyLCBzKyspIDogXCIuXCIgIT09IGUgfHwgciA/IChuICs9IGUsIHMrKykgOiAoaSgpLCBzKyspO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpKCksIHIpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJVbnRlcm1pbmF0ZWQgYCBpbiBwYXRoOiBcIiArIHQpO1xuICAgICAgICByZXR1cm4gbmV3IHV0KGUpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHlQYXRoKCkge1xuICAgICAgICByZXR1cm4gbmV3IHV0KFtdKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIGN0IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMucGF0aCA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tUGF0aCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgY3QocnQuZnJvbVN0cmluZyh0KSk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tTmFtZSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgY3QocnQuZnJvbVN0cmluZyh0KS5wb3BGaXJzdCg1KSk7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBjdChydC5lbXB0eVBhdGgoKSk7XG4gICAgfVxuICAgIGdldCBjb2xsZWN0aW9uR3JvdXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGgucG9wTGFzdCgpLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGluIHRoZSBzcGVjaWZpZWQgY29sbGVjdGlvbklkLiAqLyAgICBoYXNDb2xsZWN0aW9uSWQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmxlbmd0aCA+PSAyICYmIHRoaXMucGF0aC5nZXQodGhpcy5wYXRoLmxlbmd0aCAtIDIpID09PSB0O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgY29sbGVjdGlvbiBncm91cCAoaS5lLiB0aGUgbmFtZSBvZiB0aGUgcGFyZW50IGNvbGxlY3Rpb24pIGZvciB0aGlzIGtleS4gKi8gICAgZ2V0Q29sbGVjdGlvbkdyb3VwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmdldCh0aGlzLnBhdGgubGVuZ3RoIC0gMik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBmdWxseSBxdWFsaWZpZWQgcGF0aCB0byB0aGUgcGFyZW50IGNvbGxlY3Rpb24uICovICAgIGdldENvbGxlY3Rpb25QYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnBvcExhc3QoKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0ICYmIDAgPT09IHJ0LmNvbXBhcmF0b3IodGhpcy5wYXRoLCB0LnBhdGgpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC50b1N0cmluZygpO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcGFyYXRvcih0LCBlKSB7XG4gICAgICAgIHJldHVybiBydC5jb21wYXJhdG9yKHQucGF0aCwgZS5wYXRoKTtcbiAgICB9XG4gICAgc3RhdGljIGlzRG9jdW1lbnRLZXkodCkge1xuICAgICAgICByZXR1cm4gdC5sZW5ndGggJSAyID09IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgZG9jdW1lbnQga2V5IHdpdGggdGhlIGdpdmVuIHNlZ21lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlZ21lbnRzIC0gVGhlIHNlZ21lbnRzIG9mIHRoZSBwYXRoIHRvIHRoZSBkb2N1bWVudFxuICAgICAqIEByZXR1cm5zIEEgbmV3IGluc3RhbmNlIG9mIERvY3VtZW50S2V5XG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VnbWVudHModCkge1xuICAgICAgICByZXR1cm4gbmV3IGN0KG5ldyBydCh0LnNsaWNlKCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBpbml0aWFsIG11dGF0aW9uIGJhdGNoIGlkIGZvciBlYWNoIGluZGV4LiBHZXRzIHVwZGF0ZWQgZHVyaW5nIGluZGV4XG4gKiBiYWNrZmlsbC5cbiAqL1xuLyoqXG4gKiBBbiBpbmRleCBkZWZpbml0aW9uIGZvciBmaWVsZCBpbmRleGVzIGluIEZpcmVzdG9yZS5cbiAqXG4gKiBFdmVyeSBpbmRleCBpcyBhc3NvY2lhdGVkIHdpdGggYSBjb2xsZWN0aW9uLiBUaGUgZGVmaW5pdGlvbiBjb250YWlucyBhIGxpc3RcbiAqIG9mIGZpZWxkcyBhbmQgdGhlaXIgaW5kZXgga2luZCAod2hpY2ggY2FuIGJlIGBBU0NFTkRJTkdgLCBgREVTQ0VORElOR2Agb3JcbiAqIGBDT05UQUlOU2AgZm9yIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBxdWVyaWVzKS5cbiAqXG4gKiBVbmxpa2UgdGhlIGJhY2tlbmQsIHRoZSBTREsgZG9lcyBub3QgZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGNvbGxlY3Rpb24gb3JcbiAqIGNvbGxlY3Rpb24gZ3JvdXAtc2NvcGVkIGluZGljZXMuIEV2ZXJ5IGluZGV4IGNhbiBiZSB1c2VkIGZvciBib3RoIHNpbmdsZVxuICogY29sbGVjdGlvbiBhbmQgY29sbGVjdGlvbiBncm91cCBxdWVyaWVzLlxuICovXG5jbGFzcyBhdCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGluZGV4IElELiBSZXR1cm5zIC0xIGlmIHRoZSBpbmRleCBJRCBpcyBub3QgYXZhaWxhYmxlIChlLmcuIHRoZSBpbmRleFxuICAgICAqIGhhcyBub3QgeWV0IGJlZW4gcGVyc2lzdGVkKS5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIGNvbGxlY3Rpb24gSUQgdGhpcyBpbmRleCBhcHBsaWVzIHRvLiAqL1xuICAgIGUsIFxuICAgIC8qKiBUaGUgZmllbGQgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovXG4gICAgbiwgXG4gICAgLyoqIFNob3dzIGhvdyB1cC10by1kYXRlIHRoZSBpbmRleCBpcyBmb3IgdGhlIGN1cnJlbnQgdXNlci4gKi9cbiAgICBzKSB7XG4gICAgICAgIHRoaXMuaW5kZXhJZCA9IHQsIHRoaXMuY29sbGVjdGlvbkdyb3VwID0gZSwgdGhpcy5maWVsZHMgPSBuLCB0aGlzLmluZGV4U3RhdGUgPSBzO1xuICAgIH1cbn1cblxuLyoqIEFuIElEIGZvciBhbiBpbmRleCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gYWRkZWQgdG8gcGVyc2lzdGVuY2UuICAqL1xuLyoqIFJldHVybnMgdGhlIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBzZWdtZW50IGZvciB0aGlzIGluZGV4LiAqL1xuZnVuY3Rpb24gaHQodCkge1xuICAgIHJldHVybiB0LmZpZWxkcy5maW5kKCh0ID0+IDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovID09PSB0LmtpbmQpKTtcbn1cblxuLyoqIFJldHVybnMgYWxsIGRpcmVjdGlvbmFsIChhc2NlbmRpbmcvZGVzY2VuZGluZykgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovIGZ1bmN0aW9uIGx0KHQpIHtcbiAgICByZXR1cm4gdC5maWVsZHMuZmlsdGVyKCh0ID0+IDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovICE9PSB0LmtpbmQpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBvcmRlciBvZiB0aGUgZG9jdW1lbnQga2V5IGNvbXBvbmVudCBmb3IgdGhlIGdpdmVuIGluZGV4LlxuICpcbiAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgaW4gdGhlIFdlYiBJbmRleGVkRGIgaW1wbGVtZW50YXRpb24uXG4gKi9cbi8qKlxuICogQ29tcGFyZXMgaW5kZXhlcyBieSBjb2xsZWN0aW9uIGdyb3VwIGFuZCBzZWdtZW50cy4gSWdub3JlcyB1cGRhdGUgdGltZSBhbmRcbiAqIGluZGV4IElELlxuICovXG5mdW5jdGlvbiBmdCh0LCBlKSB7XG4gICAgbGV0IG4gPSBaKHQuY29sbGVjdGlvbkdyb3VwLCBlLmNvbGxlY3Rpb25Hcm91cCk7XG4gICAgaWYgKDAgIT09IG4pIHJldHVybiBuO1xuICAgIGZvciAobGV0IHMgPSAwOyBzIDwgTWF0aC5taW4odC5maWVsZHMubGVuZ3RoLCBlLmZpZWxkcy5sZW5ndGgpOyArK3MpIGlmIChuID0gX3QodC5maWVsZHNbc10sIGUuZmllbGRzW3NdKSwgXG4gICAgMCAhPT0gbikgcmV0dXJuIG47XG4gICAgcmV0dXJuIFoodC5maWVsZHMubGVuZ3RoLCBlLmZpZWxkcy5sZW5ndGgpO1xufVxuXG4vKiogUmV0dXJucyBhIGRlYnVnIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBmaWVsZCBpbmRleCAqLyBhdC5VTktOT1dOX0lEID0gLTE7XG5cbi8qKiBBbiBpbmRleCBjb21wb25lbnQgY29uc2lzdGluZyBvZiBmaWVsZCBwYXRoIGFuZCBpbmRleCB0eXBlLiAgKi9cbmNsYXNzIGR0IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIGZpZWxkIHBhdGggb2YgdGhlIGNvbXBvbmVudC4gKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIGZpZWxkcyBzb3J0aW5nIG9yZGVyLiAqL1xuICAgIGUpIHtcbiAgICAgICAgdGhpcy5maWVsZFBhdGggPSB0LCB0aGlzLmtpbmQgPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX3QodCwgZSkge1xuICAgIGNvbnN0IG4gPSB1dC5jb21wYXJhdG9yKHQuZmllbGRQYXRoLCBlLmZpZWxkUGF0aCk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogWih0LmtpbmQsIGUua2luZCk7XG59XG5cbi8qKlxuICogU3RvcmVzIHRoZSBcImhpZ2ggd2F0ZXIgbWFya1wiIHRoYXQgaW5kaWNhdGVzIGhvdyB1cGRhdGVkIHRoZSBJbmRleCBpcyBmb3IgdGhlXG4gKiBjdXJyZW50IHVzZXIuXG4gKi8gY2xhc3Mgd3Qge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEluZGljYXRlcyB3aGVuIHRoZSBpbmRleCB3YXMgbGFzdCB1cGRhdGVkIChyZWxhdGl2ZSB0byBvdGhlciBpbmRleGVzKS5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIHRoZSBsYXRlc3QgaW5kZXhlZCByZWFkIHRpbWUsIGRvY3VtZW50IGFuZCBiYXRjaCBpZC4gKi9cbiAgICBlKSB7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VOdW1iZXIgPSB0LCB0aGlzLm9mZnNldCA9IGU7XG4gICAgfVxuICAgIC8qKiBUaGUgc3RhdGUgb2YgYW4gaW5kZXggdGhhdCBoYXMgbm90IHlldCBiZWVuIGJhY2tmaWxsZWQuICovICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3dCgwLCB5dC5taW4oKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gb2Zmc2V0IHRoYXQgbWF0Y2hlcyBhbGwgZG9jdW1lbnRzIHdpdGggYSByZWFkIHRpbWUgaGlnaGVyIHRoYW5cbiAqIGByZWFkVGltZWAuXG4gKi8gZnVuY3Rpb24gbXQodCwgZSkge1xuICAgIC8vIFdlIHdhbnQgdG8gY3JlYXRlIGFuIG9mZnNldCB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50cyB3aXRoIGEgcmVhZCB0aW1lXG4gICAgLy8gZ3JlYXRlciB0aGFuIHRoZSBwcm92aWRlZCByZWFkIHRpbWUuIFRvIGRvIHNvLCB3ZSB0ZWNobmljYWxseSBuZWVkIHRvXG4gICAgLy8gY3JlYXRlIGFuIG9mZnNldCBmb3IgYChyZWFkVGltZSwgTUFYX0RPQ1VNRU5UX0tFWSlgLiBXaGlsZSB3ZSBjb3VsZCB1c2VcbiAgICAvLyBVbmljb2RlIGNvZGVwb2ludHMgdG8gZ2VuZXJhdGUgTUFYX0RPQ1VNRU5UX0tFWSwgaXQgaXMgbXVjaCBlYXNpZXIgdG8gdXNlXG4gICAgLy8gYChyZWFkVGltZSArIDEsIERvY3VtZW50S2V5LmVtcHR5KCkpYCBzaW5jZSBgPiBEb2N1bWVudEtleS5lbXB0eSgpYCBtYXRjaGVzXG4gICAgLy8gYWxsIHZhbGlkIGRvY3VtZW50IElEcy5cbiAgICBjb25zdCBuID0gdC50b1RpbWVzdGFtcCgpLnNlY29uZHMsIHMgPSB0LnRvVGltZXN0YW1wKCkubmFub3NlY29uZHMgKyAxLCBpID0gc3QuZnJvbVRpbWVzdGFtcCgxZTkgPT09IHMgPyBuZXcgbnQobiArIDEsIDApIDogbmV3IG50KG4sIHMpKTtcbiAgICByZXR1cm4gbmV3IHl0KGksIGN0LmVtcHR5KCksIGUpO1xufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBvZmZzZXQgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGRvY3VtZW50LiAqLyBmdW5jdGlvbiBndCh0KSB7XG4gICAgcmV0dXJuIG5ldyB5dCh0LnJlYWRUaW1lLCB0LmtleSwgLTEpO1xufVxuXG4vKipcbiAqIFN0b3JlcyB0aGUgbGF0ZXN0IHJlYWQgdGltZSwgZG9jdW1lbnQgYW5kIGJhdGNoIElEIHRoYXQgd2VyZSBwcm9jZXNzZWQgZm9yIGFuXG4gKiBpbmRleC5cbiAqLyBjbGFzcyB5dCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGxhdGVzdCByZWFkIHRpbWUgdmVyc2lvbiB0aGF0IGhhcyBiZWVuIGluZGV4ZWQgYnkgRmlyZXN0b3JlIGZvciB0aGlzXG4gICAgICogZmllbGQgaW5kZXguXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogVGhlIGtleSBvZiB0aGUgbGFzdCBkb2N1bWVudCB0aGF0IHdhcyBpbmRleGVkIGZvciB0aGlzIHF1ZXJ5LiBVc2VcbiAgICAgKiBgRG9jdW1lbnRLZXkuZW1wdHkoKWAgaWYgbm8gZG9jdW1lbnQgaGFzIGJlZW4gaW5kZXhlZC5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKlxuICAgICAqIFRoZSBsYXJnZXN0IG11dGF0aW9uIGJhdGNoIGlkIHRoYXQncyBiZWVuIHByb2Nlc3NlZCBieSBGaXJlc3RvcmUuXG4gICAgICovXG4gICAgbikge1xuICAgICAgICB0aGlzLnJlYWRUaW1lID0gdCwgdGhpcy5kb2N1bWVudEtleSA9IGUsIHRoaXMubGFyZ2VzdEJhdGNoSWQgPSBuO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbiBvZmZzZXQgdGhhdCBzb3J0cyBiZWZvcmUgYWxsIHJlZ3VsYXIgb2Zmc2V0cy4gKi8gICAgc3RhdGljIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB5dChzdC5taW4oKSwgY3QuZW1wdHkoKSwgLTEpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbiBvZmZzZXQgdGhhdCBzb3J0cyBhZnRlciBhbGwgcmVndWxhciBvZmZzZXRzLiAqLyAgICBzdGF0aWMgbWF4KCkge1xuICAgICAgICByZXR1cm4gbmV3IHl0KHN0Lm1heCgpLCBjdC5lbXB0eSgpLCAtMSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBwdCh0LCBlKSB7XG4gICAgbGV0IG4gPSB0LnJlYWRUaW1lLmNvbXBhcmVUbyhlLnJlYWRUaW1lKTtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiAobiA9IGN0LmNvbXBhcmF0b3IodC5kb2N1bWVudEtleSwgZS5kb2N1bWVudEtleSksIDAgIT09IG4gPyBuIDogWih0Lmxhcmdlc3RCYXRjaElkLCBlLmxhcmdlc3RCYXRjaElkKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IEl0ID0gXCJUaGUgY3VycmVudCB0YWIgaXMgbm90IGluIHRoZSByZXF1aXJlZCBzdGF0ZSB0byBwZXJmb3JtIHRoaXMgb3BlcmF0aW9uLiBJdCBtaWdodCBiZSBuZWNlc3NhcnkgdG8gcmVmcmVzaCB0aGUgYnJvd3NlciB0YWIuXCI7XG5cbi8qKlxuICogQSBiYXNlIGNsYXNzIHJlcHJlc2VudGluZyBhIHBlcnNpc3RlbmNlIHRyYW5zYWN0aW9uLCBlbmNhcHN1bGF0aW5nIGJvdGggdGhlXG4gKiB0cmFuc2FjdGlvbidzIHNlcXVlbmNlIG51bWJlcnMgYXMgd2VsbCBhcyBhIGxpc3Qgb2Ygb25Db21taXR0ZWQgbGlzdGVuZXJzLlxuICpcbiAqIFdoZW4geW91IGNhbGwgUGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oKSwgaXQgd2lsbCBjcmVhdGUgYSB0cmFuc2FjdGlvbiBhbmRcbiAqIHBhc3MgaXQgdG8geW91ciBjYWxsYmFjay4gWW91IHRoZW4gcGFzcyBpdCB0byBhbnkgbWV0aG9kIHRoYXQgb3BlcmF0ZXNcbiAqIG9uIHBlcnNpc3RlbmNlLlxuICovIGNsYXNzIFR0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5vbkNvbW1pdHRlZExpc3RlbmVycyA9IFtdO1xuICAgIH1cbiAgICBhZGRPbkNvbW1pdHRlZExpc3RlbmVyKHQpIHtcbiAgICAgICAgdGhpcy5vbkNvbW1pdHRlZExpc3RlbmVycy5wdXNoKHQpO1xuICAgIH1cbiAgICByYWlzZU9uQ29tbWl0dGVkRXZlbnQoKSB7XG4gICAgICAgIHRoaXMub25Db21taXR0ZWRMaXN0ZW5lcnMuZm9yRWFjaCgodCA9PiB0KCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFZlcmlmaWVzIHRoZSBlcnJvciB0aHJvd24gYnkgYSBMb2NhbFN0b3JlIG9wZXJhdGlvbi4gSWYgYSBMb2NhbFN0b3JlXG4gKiBvcGVyYXRpb24gZmFpbHMgYmVjYXVzZSB0aGUgcHJpbWFyeSBsZWFzZSBoYXMgYmVlbiB0YWtlbiBieSBhbm90aGVyIGNsaWVudCxcbiAqIHdlIGlnbm9yZSB0aGUgZXJyb3IgKHRoZSBwZXJzaXN0ZW5jZSBsYXllciB3aWxsIGltbWVkaWF0ZWx5IGNhbGxcbiAqIGBhcHBseVByaW1hcnlMZWFzZWAgdG8gcHJvcGFnYXRlIHRoZSBwcmltYXJ5IHN0YXRlIGNoYW5nZSkuIEFsbCBvdGhlciBlcnJvcnNcbiAqIGFyZSByZS10aHJvd24uXG4gKlxuICogQHBhcmFtIGVyciAtIEFuIGVycm9yIHJldHVybmVkIGJ5IGEgTG9jYWxTdG9yZSBvcGVyYXRpb24uXG4gKiBAcmV0dXJucyBBIFByb21pc2UgdGhhdCByZXNvbHZlcyBhZnRlciB3ZSByZWNvdmVyZWQsIG9yIHRoZSBvcmlnaW5hbCBlcnJvci5cbiAqLyBhc3luYyBmdW5jdGlvbiBFdCh0KSB7XG4gICAgaWYgKHQuY29kZSAhPT0gQi5GQUlMRURfUFJFQ09ORElUSU9OIHx8IHQubWVzc2FnZSAhPT0gSXQpIHRocm93IHQ7XG4gICAgQyhcIkxvY2FsU3RvcmVcIiwgXCJVbmV4cGVjdGVkbHkgbG9zdCBwcmltYXJ5IGxlYXNlXCIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQZXJzaXN0ZW5jZVByb21pc2UgaXMgZXNzZW50aWFsbHkgYSByZS1pbXBsZW1lbnRhdGlvbiBvZiBQcm9taXNlIGV4Y2VwdFxuICogaXQgaGFzIGEgLm5leHQoKSBtZXRob2QgaW5zdGVhZCBvZiAudGhlbigpIGFuZCAubmV4dCgpIGFuZCAuY2F0Y2goKSBjYWxsYmFja3NcbiAqIGFyZSBleGVjdXRlZCBzeW5jaHJvbm91c2x5IHdoZW4gYSBQZXJzaXN0ZW5jZVByb21pc2UgcmVzb2x2ZXMgcmF0aGVyIHRoYW5cbiAqIGFzeW5jaHJvbm91c2x5IChQcm9taXNlIGltcGxlbWVudGF0aW9ucyB1c2Ugc2V0SW1tZWRpYXRlKCkgb3Igc2ltaWxhcikuXG4gKlxuICogVGhpcyBpcyBuZWNlc3NhcnkgdG8gaW50ZXJvcGVyYXRlIHdpdGggSW5kZXhlZERCIHdoaWNoIHdpbGwgYXV0b21hdGljYWxseVxuICogY29tbWl0IHRyYW5zYWN0aW9ucyBpZiBjb250cm9sIGlzIHJldHVybmVkIHRvIHRoZSBldmVudCBsb29wIHdpdGhvdXRcbiAqIHN5bmNocm9ub3VzbHkgaW5pdGlhdGluZyBhbm90aGVyIG9wZXJhdGlvbiBvbiB0aGUgdHJhbnNhY3Rpb24uXG4gKlxuICogTk9URTogLnRoZW4oKSBhbmQgLmNhdGNoKCkgb25seSBhbGxvdyBhIHNpbmdsZSBjb25zdW1lciwgdW5saWtlIG5vcm1hbFxuICogUHJvbWlzZXMuXG4gKi8gY2xhc3MgQXQge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgLy8gTk9URTogbmV4dC9jYXRjaENhbGxiYWNrIHdpbGwgYWx3YXlzIHBvaW50IHRvIG91ciBvd24gd3JhcHBlciBmdW5jdGlvbnMsXG4gICAgICAgIC8vIG5vdCB0aGUgdXNlcidzIHJhdyBuZXh0KCkgb3IgY2F0Y2goKSBjYWxsYmFja3MuXG4gICAgICAgIHRoaXMubmV4dENhbGxiYWNrID0gbnVsbCwgdGhpcy5jYXRjaENhbGxiYWNrID0gbnVsbCwgXG4gICAgICAgIC8vIFdoZW4gdGhlIG9wZXJhdGlvbiByZXNvbHZlcywgd2UnbGwgc2V0IHJlc3VsdCBvciBlcnJvciBhbmQgbWFyayBpc0RvbmUuXG4gICAgICAgIHRoaXMucmVzdWx0ID0gdm9pZCAwLCB0aGlzLmVycm9yID0gdm9pZCAwLCB0aGlzLmlzRG9uZSA9ICExLCBcbiAgICAgICAgLy8gU2V0IHRvIHRydWUgd2hlbiAudGhlbigpIG9yIC5jYXRjaCgpIGFyZSBjYWxsZWQgYW5kIHByZXZlbnRzIGFkZGl0aW9uYWxcbiAgICAgICAgLy8gY2hhaW5pbmcuXG4gICAgICAgIHRoaXMuY2FsbGJhY2tBdHRhY2hlZCA9ICExLCB0KCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNEb25lID0gITAsIHRoaXMucmVzdWx0ID0gdCwgdGhpcy5uZXh0Q2FsbGJhY2sgJiYgXG4gICAgICAgICAgICAvLyB2YWx1ZSBzaG91bGQgYmUgZGVmaW5lZCB1bmxlc3MgVCBpcyBWb2lkLCBidXQgd2UgY2FuJ3QgZXhwcmVzc1xuICAgICAgICAgICAgLy8gdGhhdCBpbiB0aGUgdHlwZSBzeXN0ZW0uXG4gICAgICAgICAgICB0aGlzLm5leHRDYWxsYmFjayh0KTtcbiAgICAgICAgfSksICh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNEb25lID0gITAsIHRoaXMuZXJyb3IgPSB0LCB0aGlzLmNhdGNoQ2FsbGJhY2sgJiYgdGhpcy5jYXRjaENhbGxiYWNrKHQpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGNhdGNoKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmV4dCh2b2lkIDAsIHQpO1xuICAgIH1cbiAgICBuZXh0KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FsbGJhY2tBdHRhY2hlZCAmJiBPKCksIHRoaXMuY2FsbGJhY2tBdHRhY2hlZCA9ICEwLCB0aGlzLmlzRG9uZSA/IHRoaXMuZXJyb3IgPyB0aGlzLndyYXBGYWlsdXJlKGUsIHRoaXMuZXJyb3IpIDogdGhpcy53cmFwU3VjY2Vzcyh0LCB0aGlzLnJlc3VsdCkgOiBuZXcgQXQoKChuLCBzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHRDYWxsYmFjayA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcFN1Y2Nlc3ModCwgZSkubmV4dChuLCBzKTtcbiAgICAgICAgICAgIH0sIHRoaXMuY2F0Y2hDYWxsYmFjayA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcEZhaWx1cmUoZSwgdCkubmV4dChuLCBzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgdG9Qcm9taXNlKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHQodCwgZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgd3JhcFVzZXJGdW5jdGlvbih0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBBdCA/IGUgOiBBdC5yZXNvbHZlKGUpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICByZXR1cm4gQXQucmVqZWN0KHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdyYXBTdWNjZXNzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHQgPyB0aGlzLndyYXBVc2VyRnVuY3Rpb24oKCgpID0+IHQoZSkpKSA6IEF0LnJlc29sdmUoZSk7XG4gICAgfVxuICAgIHdyYXBGYWlsdXJlKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHQgPyB0aGlzLndyYXBVc2VyRnVuY3Rpb24oKCgpID0+IHQoZSkpKSA6IEF0LnJlamVjdChlKTtcbiAgICB9XG4gICAgc3RhdGljIHJlc29sdmUodCkge1xuICAgICAgICByZXR1cm4gbmV3IEF0KCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgZSh0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzdGF0aWMgcmVqZWN0KHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIG4odCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc3RhdGljIHdhaXRGb3IoXG4gICAgLy8gQWNjZXB0IGFsbCBQcm9taXNlIHR5cGVzIGluIHdhaXRGb3IoKS5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIGxldCBzID0gMCwgaSA9IDAsIHIgPSAhMTtcbiAgICAgICAgICAgIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICAgICAgKytzLCB0Lm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgKytpLCByICYmIGkgPT09IHMgJiYgZSgpO1xuICAgICAgICAgICAgICAgIH0pLCAodCA9PiBuKHQpKSk7XG4gICAgICAgICAgICB9KSksIHIgPSAhMCwgaSA9PT0gcyAmJiBlKCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2l2ZW4gYW4gYXJyYXkgb2YgcHJlZGljYXRlIGZ1bmN0aW9ucyB0aGF0IGFzeW5jaHJvbm91c2x5IGV2YWx1YXRlIHRvIGFcbiAgICAgKiBib29sZWFuLCBpbXBsZW1lbnRzIGEgc2hvcnQtY2lyY3VpdGluZyBgb3JgIGJldHdlZW4gdGhlIHJlc3VsdHMuIFByZWRpY2F0ZXNcbiAgICAgKiB3aWxsIGJlIGV2YWx1YXRlZCB1bnRpbCBvbmUgb2YgdGhlbSByZXR1cm5zIGB0cnVlYCwgdGhlbiBzdG9wLiBUaGUgZmluYWxcbiAgICAgKiByZXN1bHQgd2lsbCBiZSB3aGV0aGVyIGFueSBvZiB0aGVtIHJldHVybmVkIGB0cnVlYC5cbiAgICAgKi8gICAgc3RhdGljIG9yKHQpIHtcbiAgICAgICAgbGV0IGUgPSBBdC5yZXNvbHZlKCExKTtcbiAgICAgICAgZm9yIChjb25zdCBuIG9mIHQpIGUgPSBlLm5leHQoKHQgPT4gdCA/IEF0LnJlc29sdmUodCkgOiBuKCkpKTtcbiAgICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIHN0YXRpYyBmb3JFYWNoKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCgodCwgcykgPT4ge1xuICAgICAgICAgICAgbi5wdXNoKGUuY2FsbCh0aGlzLCB0LCBzKSk7XG4gICAgICAgIH0pKSwgdGhpcy53YWl0Rm9yKG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25jdXJyZW50bHkgbWFwIGFsbCBhcnJheSBlbGVtZW50cyB0aHJvdWdoIGFzeW5jaHJvbm91cyBmdW5jdGlvbi5cbiAgICAgKi8gICAgc3RhdGljIG1hcEFycmF5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSB0Lmxlbmd0aCwgciA9IG5ldyBBcnJheShpKTtcbiAgICAgICAgICAgIGxldCBvID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IHUgPSAwOyB1IDwgaTsgdSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYyA9IHU7XG4gICAgICAgICAgICAgICAgZSh0W2NdKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcltjXSA9IHQsICsrbywgbyA9PT0gaSAmJiBuKHIpO1xuICAgICAgICAgICAgICAgIH0pLCAodCA9PiBzKHQpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQW4gYWx0ZXJuYXRpdmUgdG8gcmVjdXJzaXZlIFBlcnNpc3RlbmNlUHJvbWlzZSBjYWxscywgdGhhdCBhdm9pZHNcbiAgICAgKiBwb3RlbnRpYWwgbWVtb3J5IHByb2JsZW1zIGZyb20gdW5ib3VuZGVkIGNoYWlucyBvZiBwcm9taXNlcy5cbiAgICAgKlxuICAgICAqIFRoZSBgYWN0aW9uYCB3aWxsIGJlIGNhbGxlZCByZXBlYXRlZGx5IHdoaWxlIGBjb25kaXRpb25gIGlzIHRydWUuXG4gICAgICovICAgIHN0YXRpYyBkb1doaWxlKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBBdCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgITAgPT09IHQoKSA/IGUoKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGkoKTtcbiAgICAgICAgICAgICAgICB9KSwgcykgOiBuKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUmVmZXJlbmNlcyB0byBgd2luZG93YCBhcmUgZ3VhcmRlZCBieSBTaW1wbGVEYi5pc0F2YWlsYWJsZSgpXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbi8qKlxuICogV3JhcHMgYW4gSURCVHJhbnNhY3Rpb24gYW5kIGV4cG9zZXMgYSBzdG9yZSgpIG1ldGhvZCB0byBnZXQgYSBoYW5kbGUgdG8gYVxuICogc3BlY2lmaWMgb2JqZWN0IHN0b3JlLlxuICovXG5jbGFzcyBSdCB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmFjdGlvbiA9IHQsIHRoaXMudHJhbnNhY3Rpb24gPSBlLCB0aGlzLmFib3J0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIHdpdGggdGhlIHJlc3VsdCBvZiB0aGUgSW5kZXhlZERiIHRyYW5zYWN0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5QID0gbmV3IHEsIHRoaXMudHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuUC5yZXNvbHZlKCk7XG4gICAgICAgIH0sIHRoaXMudHJhbnNhY3Rpb24ub25hYm9ydCA9ICgpID0+IHtcbiAgICAgICAgICAgIGUuZXJyb3IgPyB0aGlzLlAucmVqZWN0KG5ldyB2dCh0LCBlLmVycm9yKSkgOiB0aGlzLlAucmVzb2x2ZSgpO1xuICAgICAgICB9LCB0aGlzLnRyYW5zYWN0aW9uLm9uZXJyb3IgPSBlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB4dChlLnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICB0aGlzLlAucmVqZWN0KG5ldyB2dCh0LCBuKSk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXRpYyBvcGVuKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUnQoZSwgdC50cmFuc2FjdGlvbihzLCBuKSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyB2dChlLCB0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgdigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUC5wcm9taXNlO1xuICAgIH1cbiAgICBhYm9ydCh0KSB7XG4gICAgICAgIHQgJiYgdGhpcy5QLnJlamVjdCh0KSwgdGhpcy5hYm9ydGVkIHx8IChDKFwiU2ltcGxlRGJcIiwgXCJBYm9ydGluZyB0cmFuc2FjdGlvbjpcIiwgdCA/IHQubWVzc2FnZSA6IFwiQ2xpZW50LWluaXRpYXRlZCBhYm9ydFwiKSwgXG4gICAgICAgIHRoaXMuYWJvcnRlZCA9ICEwLCB0aGlzLnRyYW5zYWN0aW9uLmFib3J0KCkpO1xuICAgIH1cbiAgICBWKCkge1xuICAgICAgICAvLyBJZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBWMyBJbmRleGVkREIsIHdlIGludm9rZSBjb21taXQoKSBleHBsaWNpdGx5IHRvXG4gICAgICAgIC8vIHNwZWVkIHVwIGluZGV4IERCIHByb2Nlc3NpbmcgaWYgdGhlIGV2ZW50IGxvb3AgcmVtYWlucyBibG9ja3MuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnRyYW5zYWN0aW9uO1xuICAgICAgICB0aGlzLmFib3J0ZWQgfHwgXCJmdW5jdGlvblwiICE9IHR5cGVvZiB0LmNvbW1pdCB8fCB0LmNvbW1pdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgU2ltcGxlRGJTdG9yZTxLZXlUeXBlLCBWYWx1ZVR5cGU+IGZvciB0aGUgc3BlY2lmaWVkIHN0b3JlLiBBbGxcbiAgICAgKiBvcGVyYXRpb25zIHBlcmZvcm1lZCBvbiB0aGUgU2ltcGxlRGJTdG9yZSBoYXBwZW4gd2l0aGluIHRoZSBjb250ZXh0IG9mIHRoaXNcbiAgICAgKiB0cmFuc2FjdGlvbiBhbmQgaXQgY2Fubm90IGJlIHVzZWQgYW55bW9yZSBvbmNlIHRoZSB0cmFuc2FjdGlvbiBpc1xuICAgICAqIGNvbXBsZXRlZC5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB3ZSBjYW4ndCBhY3R1YWxseSBlbmZvcmNlIHRoYXQgdGhlIEtleVR5cGUgYW5kIFZhbHVlVHlwZSBhcmVcbiAgICAgKiBjb3JyZWN0LCBidXQgdGhleSBhbGxvdyB0eXBlIHNhZmV0eSB0aHJvdWdoIHRoZSByZXN0IG9mIHRoZSBjb25zdW1pbmcgY29kZS5cbiAgICAgKi8gICAgc3RvcmUodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy50cmFuc2FjdGlvbi5vYmplY3RTdG9yZSh0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBTdChlKTtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSB3cmFwcGVyIGFyb3VuZCBJbmRleGVkRGIgd2l0aCBhIHNpbXBsaWZpZWQgaW50ZXJmYWNlIHRoYXQgdXNlc1xuICogUHJvbWlzZS1saWtlIHJldHVybiB2YWx1ZXMgdG8gY2hhaW4gb3BlcmF0aW9ucy4gUmVhbCBwcm9taXNlcyBjYW5ub3QgYmUgdXNlZFxuICogc2luY2UgLnRoZW4oKSBjb250aW51YXRpb25zIGFyZSBleGVjdXRlZCBhc3luY2hyb25vdXNseSAoZS5nLiB2aWFcbiAqIC5zZXRJbW1lZGlhdGUpLCB3aGljaCB3b3VsZCBjYXVzZSBJbmRleGVkREIgdG8gZW5kIHRoZSB0cmFuc2FjdGlvbi5cbiAqIFNlZSBQZXJzaXN0ZW5jZVByb21pc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqLyBjbGFzcyBidCB7XG4gICAgLypcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNpbXBsZURiIHdyYXBwZXIgZm9yIEluZGV4ZWREYiBkYXRhYmFzZSBgbmFtZWAuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgYHZlcnNpb25gIG11c3Qgbm90IGJlIGEgZG93bmdyYWRlLiBJbmRleGVkREIgZG9lcyBub3Qgc3VwcG9ydFxuICAgICAqIGRvd25ncmFkaW5nIHRoZSBzY2hlbWEgdmVyc2lvbi4gV2UgY3VycmVudGx5IGRvIG5vdCBzdXBwb3J0IGFueSB3YXkgdG8gZG9cbiAgICAgKiB2ZXJzaW9uaW5nIG91dHNpZGUgb2YgSW5kZXhlZERCJ3MgdmVyc2lvbmluZyBtZWNoYW5pc20sIGFzIG9ubHlcbiAgICAgKiB2ZXJzaW9uLXVwZ3JhZGUgdHJhbnNhY3Rpb25zIGFyZSBhbGxvd2VkIHRvIGRvIHRoaW5ncyBsaWtlIGNyZWF0ZVxuICAgICAqIG9iamVjdHN0b3Jlcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IHQsIHRoaXMudmVyc2lvbiA9IGUsIHRoaXMuUyA9IG47XG4gICAgICAgIC8vIE5PVEU6IEFjY29yZGluZyB0byBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTk3MDUwLCB0aGVcbiAgICAgICAgLy8gYnVnIHdlJ3JlIGNoZWNraW5nIGZvciBzaG91bGQgZXhpc3QgaW4gaU9TID49IDEyLjIgYW5kIDwgMTMsIGJ1dCBmb3JcbiAgICAgICAgLy8gd2hhdGV2ZXIgcmVhc29uIGl0J3MgbXVjaCBoYXJkZXIgdG8gaGl0IGFmdGVyIDEyLjIgc28gd2Ugb25seSBwcm9hY3RpdmVseVxuICAgICAgICAvLyBsb2cgb24gMTIuMi5cbiAgICAgICAgMTIuMiA9PT0gYnQuRChnZXRVQSgpKSAmJiB4KFwiRmlyZXN0b3JlIHBlcnNpc3RlbmNlIHN1ZmZlcnMgZnJvbSBhIGJ1ZyBpbiBpT1MgMTIuMiBTYWZhcmkgdGhhdCBtYXkgY2F1c2UgeW91ciBhcHAgdG8gc3RvcCB3b3JraW5nLiBTZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xLzU2NDk2Mjk2LzExMDkxNSBmb3IgZGV0YWlscyBhbmQgYSBwb3RlbnRpYWwgd29ya2Fyb3VuZC5cIik7XG4gICAgfVxuICAgIC8qKiBEZWxldGVzIHRoZSBzcGVjaWZpZWQgZGF0YWJhc2UuICovICAgIHN0YXRpYyBkZWxldGUodCkge1xuICAgICAgICByZXR1cm4gQyhcIlNpbXBsZURiXCIsIFwiUmVtb3ZpbmcgZGF0YWJhc2U6XCIsIHQpLCBEdCh3aW5kb3cuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKHQpKS50b1Byb21pc2UoKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdHJ1ZSBpZiBJbmRleGVkREIgaXMgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50LiAqLyAgICBzdGF0aWMgQygpIHtcbiAgICAgICAgaWYgKCFpc0luZGV4ZWREQkF2YWlsYWJsZSgpKSByZXR1cm4gITE7XG4gICAgICAgIGlmIChidC5OKCkpIHJldHVybiAhMDtcbiAgICAgICAgLy8gV2UgZXh0ZW5zaXZlbHkgdXNlIGluZGV4ZWQgYXJyYXkgdmFsdWVzIGFuZCBjb21wb3VuZCBrZXlzLFxuICAgICAgICAvLyB3aGljaCBJRSBhbmQgRWRnZSBkbyBub3Qgc3VwcG9ydC4gSG93ZXZlciwgdGhleSBzdGlsbCBoYXZlIGluZGV4ZWREQlxuICAgICAgICAvLyBkZWZpbmVkIG9uIHRoZSB3aW5kb3csIHNvIHdlIG5lZWQgdG8gY2hlY2sgZm9yIHRoZW0gaGVyZSBhbmQgbWFrZSBzdXJlXG4gICAgICAgIC8vIHRvIHJldHVybiB0aGF0IHBlcnNpc3RlbmNlIGlzIG5vdCBlbmFibGVkIGZvciB0aG9zZSBicm93c2Vycy5cbiAgICAgICAgLy8gRm9yIHRyYWNraW5nIHN1cHBvcnQgb2YgdGhpcyBmZWF0dXJlLCBzZWUgaGVyZTpcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubWljcm9zb2Z0LmNvbS9lbi11cy9taWNyb3NvZnQtZWRnZS9wbGF0Zm9ybS9zdGF0dXMvaW5kZXhlZGRiYXJyYXlzYW5kbXVsdGllbnRyeXN1cHBvcnQvXG4gICAgICAgIC8vIENoZWNrIHRoZSBVQSBzdHJpbmcgdG8gZmluZCBvdXQgdGhlIGJyb3dzZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGdldFVBKCksIGUgPSBidC5EKHQpLCBuID0gMCA8IGUgJiYgZSA8IDEwLCBzID0gYnQuayh0KSwgaSA9IDAgPCBzICYmIHMgPCA0LjU7XG4gICAgICAgIC8vIElFIDEwXG4gICAgICAgIC8vIHVhID0gJ01vemlsbGEvNS4wIChjb21wYXRpYmxlOyBNU0lFIDEwLjA7IFdpbmRvd3MgTlQgNi4yOyBUcmlkZW50LzYuMCknO1xuICAgICAgICAvLyBJRSAxMVxuICAgICAgICAvLyB1YSA9ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjM7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJztcbiAgICAgICAgLy8gRWRnZVxuICAgICAgICAvLyB1YSA9ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCxcbiAgICAgICAgLy8gbGlrZSBHZWNrbykgQ2hyb21lLzM5LjAuMjE3MS43MSBTYWZhcmkvNTM3LjM2IEVkZ2UvMTIuMCc7XG4gICAgICAgIC8vIGlPUyBTYWZhcmk6IERpc2FibGUgZm9yIHVzZXJzIHJ1bm5pbmcgaU9TIHZlcnNpb24gPCAxMC5cbiAgICAgICAgICAgICAgICByZXR1cm4gISh0LmluZGV4T2YoXCJNU0lFIFwiKSA+IDAgfHwgdC5pbmRleE9mKFwiVHJpZGVudC9cIikgPiAwIHx8IHQuaW5kZXhPZihcIkVkZ2UvXCIpID4gMCB8fCBuIHx8IGkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGJhY2tpbmcgSW5kZXhlZERCIHN0b3JlIGlzIHRoZSBOb2RlIEluZGV4ZWREQlNoaW1cbiAgICAgKiAoc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9heGVtY2xpb24vSW5kZXhlZERCU2hpbSkuXG4gICAgICovICAgIHN0YXRpYyBOKCkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHByb2Nlc3MgJiYgXCJZRVNcIiA9PT0gKG51bGwgPT09ICh0ID0gcHJvY2Vzcy5lbnYpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuTyk7XG4gICAgfVxuICAgIC8qKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmcm9tIGEgdHJhbnNhY3Rpb24uICovICAgIHN0YXRpYyBNKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHQuc3RvcmUoZSk7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAvKiogUGFyc2UgVXNlciBBZ2VudCB0byBkZXRlcm1pbmUgaU9TIHZlcnNpb24uIFJldHVybnMgLTEgaWYgbm90IGZvdW5kLiAqL1xuICAgIHN0YXRpYyBEKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQubWF0Y2goL2koPzpwaG9uZXxwYWR8cG9kKSBvcyAoW1xcZF9dKykvaSksIG4gPSBlID8gZVsxXS5zcGxpdChcIl9cIikuc2xpY2UoMCwgMikuam9pbihcIi5cIikgOiBcIi0xXCI7XG4gICAgICAgIHJldHVybiBOdW1iZXIobik7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAvKiogUGFyc2UgVXNlciBBZ2VudCB0byBkZXRlcm1pbmUgQW5kcm9pZCB2ZXJzaW9uLiBSZXR1cm5zIC0xIGlmIG5vdCBmb3VuZC4gKi9cbiAgICBzdGF0aWMgayh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0Lm1hdGNoKC9BbmRyb2lkIChbXFxkLl0rKS9pKSwgbiA9IGUgPyBlWzFdLnNwbGl0KFwiLlwiKS5zbGljZSgwLCAyKS5qb2luKFwiLlwiKSA6IFwiLTFcIjtcbiAgICAgICAgcmV0dXJuIE51bWJlcihuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT3BlbnMgdGhlIHNwZWNpZmllZCBkYXRhYmFzZSwgY3JlYXRpbmcgb3IgdXBncmFkaW5nIGl0IGlmIG5lY2Vzc2FyeS5cbiAgICAgKi8gICAgYXN5bmMgRih0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiIHx8IChDKFwiU2ltcGxlRGJcIiwgXCJPcGVuaW5nIGRhdGFiYXNlOlwiLCB0aGlzLm5hbWUpLCB0aGlzLmRiID0gYXdhaXQgbmV3IFByb21pc2UoKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPKG1pa2VsZWhlbik6IEludmVzdGlnYXRlIGJyb3dzZXIgY29tcGF0aWJpbGl0eS5cbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9JbmRleGVkREJfQVBJL1VzaW5nX0luZGV4ZWREQlxuICAgICAgICAgICAgLy8gc3VnZ2VzdHMgSUU5IGFuZCBvbGRlciBXZWJLaXQgYnJvd3NlcnMgaGFuZGxlIHVwZ3JhZGVcbiAgICAgICAgICAgIC8vIGRpZmZlcmVudGx5LiBUaGV5IGV4cGVjdCBzZXRWZXJzaW9uLCBhcyBkZXNjcmliZWQgaGVyZTpcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9JREJWZXJzaW9uQ2hhbmdlUmVxdWVzdC9zZXRWZXJzaW9uXG4gICAgICAgICAgICBjb25zdCBzID0gaW5kZXhlZERCLm9wZW4odGhpcy5uYW1lLCB0aGlzLnZlcnNpb24pO1xuICAgICAgICAgICAgcy5vbnN1Y2Nlc3MgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gdC50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIGUobik7XG4gICAgICAgICAgICB9LCBzLm9uYmxvY2tlZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBuKG5ldyB2dCh0LCBcIkNhbm5vdCB1cGdyYWRlIEluZGV4ZWREQiBzY2hlbWEgd2hpbGUgYW5vdGhlciB0YWIgaXMgb3Blbi4gQ2xvc2UgYWxsIHRhYnMgdGhhdCBhY2Nlc3MgRmlyZXN0b3JlIGFuZCByZWxvYWQgdGhpcyBwYWdlIHRvIHByb2NlZWQuXCIpKTtcbiAgICAgICAgICAgIH0sIHMub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBlLnRhcmdldC5lcnJvcjtcbiAgICAgICAgICAgICAgICBcIlZlcnNpb25FcnJvclwiID09PSBzLm5hbWUgPyBuKG5ldyBMKEIuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJBIG5ld2VyIHZlcnNpb24gb2YgdGhlIEZpcmVzdG9yZSBTREsgd2FzIHByZXZpb3VzbHkgdXNlZCBhbmQgc28gdGhlIHBlcnNpc3RlZCBkYXRhIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggdGhlIHZlcnNpb24gb2YgdGhlIFNESyB5b3UgYXJlIG5vdyB1c2luZy4gVGhlIFNESyB3aWxsIG9wZXJhdGUgd2l0aCBwZXJzaXN0ZW5jZSBkaXNhYmxlZC4gSWYgeW91IG5lZWQgcGVyc2lzdGVuY2UsIHBsZWFzZSByZS11cGdyYWRlIHRvIGEgbmV3ZXIgdmVyc2lvbiBvZiB0aGUgU0RLIG9yIGVsc2UgY2xlYXIgdGhlIHBlcnNpc3RlZCBJbmRleGVkREIgZGF0YSBmb3IgeW91ciBhcHAgdG8gc3RhcnQgZnJlc2guXCIpKSA6IFwiSW52YWxpZFN0YXRlRXJyb3JcIiA9PT0gcy5uYW1lID8gbihuZXcgTChCLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVW5hYmxlIHRvIG9wZW4gYW4gSW5kZXhlZERCIGNvbm5lY3Rpb24uIFRoaXMgY291bGQgYmUgZHVlIHRvIHJ1bm5pbmcgaW4gYSBwcml2YXRlIGJyb3dzaW5nIHNlc3Npb24gb24gYSBicm93c2VyIHdob3NlIHByaXZhdGUgYnJvd3Npbmcgc2Vzc2lvbnMgZG8gbm90IHN1cHBvcnQgSW5kZXhlZERCOiBcIiArIHMpKSA6IG4obmV3IHZ0KHQsIHMpKTtcbiAgICAgICAgICAgIH0sIHMub251cGdyYWRlbmVlZGVkID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgQyhcIlNpbXBsZURiXCIsICdEYXRhYmFzZSBcIicgKyB0aGlzLm5hbWUgKyAnXCIgcmVxdWlyZXMgdXBncmFkZSBmcm9tIHZlcnNpb246JywgdC5vbGRWZXJzaW9uKTtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdC50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIHRoaXMuUy4kKGUsIHMudHJhbnNhY3Rpb24sIHQub2xkVmVyc2lvbiwgdGhpcy52ZXJzaW9uKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIEMoXCJTaW1wbGVEYlwiLCBcIkRhdGFiYXNlIHVwZ3JhZGUgdG8gdmVyc2lvbiBcIiArIHRoaXMudmVyc2lvbiArIFwiIGNvbXBsZXRlXCIpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKSksIHRoaXMuQiAmJiAodGhpcy5kYi5vbnZlcnNpb25jaGFuZ2UgPSB0ID0+IHRoaXMuQih0KSksIHRoaXMuZGI7XG4gICAgfVxuICAgIEwodCkge1xuICAgICAgICB0aGlzLkIgPSB0LCB0aGlzLmRiICYmICh0aGlzLmRiLm9udmVyc2lvbmNoYW5nZSA9IGUgPT4gdChlKSk7XG4gICAgfVxuICAgIGFzeW5jIHJ1blRyYW5zYWN0aW9uKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgY29uc3QgaSA9IFwicmVhZG9ubHlcIiA9PT0gZTtcbiAgICAgICAgbGV0IHIgPSAwO1xuICAgICAgICBmb3IgKDs7KSB7XG4gICAgICAgICAgICArK3I7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGIgPSBhd2FpdCB0aGlzLkYodCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IFJ0Lm9wZW4odGhpcy5kYiwgdCwgaSA/IFwicmVhZG9ubHlcIiA6IFwicmVhZHdyaXRlXCIsIG4pLCByID0gcyhlKS5uZXh0KCh0ID0+IChlLlYoKSwgXG4gICAgICAgICAgICAgICAgdCkpKS5jYXRjaCgodCA9PiAoXG4gICAgICAgICAgICAgICAgLy8gQWJvcnQgdGhlIHRyYW5zYWN0aW9uIGlmIHRoZXJlIHdhcyBhbiBlcnJvci5cbiAgICAgICAgICAgICAgICBlLmFib3J0KHQpLCBBdC5yZWplY3QodCkpKSkudG9Qcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgLy8gQXMgbm90ZWQgYWJvdmUsIGVycm9ycyBhcmUgcHJvcGFnYXRlZCBieSBhYm9ydGluZyB0aGUgdHJhbnNhY3Rpb24uIFNvXG4gICAgICAgICAgICAgICAgLy8gd2Ugc3dhbGxvdyBhbnkgZXJyb3IgaGVyZSB0byBhdm9pZCB0aGUgYnJvd3NlciBsb2dnaW5nIGl0IGFzIHVuaGFuZGxlZC5cbiAgICAgICAgICAgICAgICByZXR1cm4gci5jYXRjaCgoKCkgPT4ge30pKSwgXG4gICAgICAgICAgICAgICAgLy8gV2FpdCBmb3IgdGhlIHRyYW5zYWN0aW9uIHRvIGNvbXBsZXRlIChpLmUuIEluZGV4ZWREYidzIG9uc3VjY2VzcyBldmVudCB0b1xuICAgICAgICAgICAgICAgIC8vIGZpcmUpLCBidXQgc3RpbGwgcmV0dXJuIHRoZSBvcmlnaW5hbCB0cmFuc2FjdGlvbkZuUmVzdWx0IGJhY2sgdG8gdGhlXG4gICAgICAgICAgICAgICAgLy8gY2FsbGVyLlxuICAgICAgICAgICAgICAgIGF3YWl0IGUudiwgcjtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdCwgbiA9IFwiRmlyZWJhc2VFcnJvclwiICE9PSBlLm5hbWUgJiYgciA8IDM7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhzY2htaWR0LXNlYmFzdGlhbik6IFdlIGNvdWxkIHByb2JhYmx5IGJlIHNtYXJ0ZXIgYWJvdXQgdGhpcyBhbmRcbiAgICAgICAgICAgICAgICAvLyBub3QgcmV0cnkgZXhjZXB0aW9ucyB0aGF0IGFyZSBsaWtlbHkgdW5yZWNvdmVyYWJsZSAoc3VjaCBhcyBxdW90YVxuICAgICAgICAgICAgICAgIC8vIGV4Y2VlZGVkIGVycm9ycykuXG4gICAgICAgICAgICAgICAgLy8gTm90ZTogV2UgY2Fubm90IHVzZSBhbiBpbnN0YW5jZW9mIGNoZWNrIGZvciBGaXJlc3RvcmVFeGNlcHRpb24sIHNpbmNlIHRoZVxuICAgICAgICAgICAgICAgIC8vIGV4Y2VwdGlvbiBpcyB3cmFwcGVkIGluIGEgZ2VuZXJpYyBlcnJvciBieSBvdXIgYXN5bmMvYXdhaXQgaGFuZGxpbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChDKFwiU2ltcGxlRGJcIiwgXCJUcmFuc2FjdGlvbiBmYWlsZWQgd2l0aCBlcnJvcjpcIiwgZS5tZXNzYWdlLCBcIlJldHJ5aW5nOlwiLCBuKSwgXG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpLCAhbikgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLmRiICYmIHRoaXMuZGIuY2xvc2UoKSwgdGhpcy5kYiA9IHZvaWQgMDtcbiAgICB9XG59XG5cbi8qKlxuICogQSBjb250cm9sbGVyIGZvciBpdGVyYXRpbmcgb3ZlciBhIGtleSByYW5nZSBvciBpbmRleC4gSXQgYWxsb3dzIGFuIGl0ZXJhdGVcbiAqIGNhbGxiYWNrIHRvIGRlbGV0ZSB0aGUgY3VycmVudGx5LXJlZmVyZW5jZWQgb2JqZWN0LCBvciBqdW1wIHRvIGEgbmV3IGtleVxuICogd2l0aGluIHRoZSBrZXkgcmFuZ2Ugb3IgaW5kZXguXG4gKi8gY2xhc3MgUHQge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5xID0gdCwgdGhpcy5VID0gITEsIHRoaXMuSyA9IG51bGw7XG4gICAgfVxuICAgIGdldCBpc0RvbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlU7XG4gICAgfVxuICAgIGdldCBHKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5LO1xuICAgIH1cbiAgICBzZXQgY3Vyc29yKHQpIHtcbiAgICAgICAgdGhpcy5xID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHRvIHN0b3AgaXRlcmF0aW9uIGF0IGFueSBwb2ludC5cbiAgICAgKi8gICAgZG9uZSgpIHtcbiAgICAgICAgdGhpcy5VID0gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCB0byBza2lwIHRvIHRoYXQgbmV4dCBrZXksIHdoaWNoIGNvdWxkIGJlXG4gICAgICogYW4gaW5kZXggb3IgYSBwcmltYXJ5IGtleS5cbiAgICAgKi8gICAgaih0KSB7XG4gICAgICAgIHRoaXMuSyA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZSB0aGUgY3VycmVudCBjdXJzb3IgdmFsdWUgZnJvbSB0aGUgb2JqZWN0IHN0b3JlLlxuICAgICAqXG4gICAgICogTk9URTogWW91IENBTk5PVCBkbyB0aGlzIHdpdGggYSBrZXlzT25seSBxdWVyeS5cbiAgICAgKi8gICAgZGVsZXRlKCkge1xuICAgICAgICByZXR1cm4gRHQodGhpcy5xLmRlbGV0ZSgpKTtcbiAgICB9XG59XG5cbi8qKiBBbiBlcnJvciB0aGF0IHdyYXBzIGV4Y2VwdGlvbnMgdGhhdCB0aHJvd24gZHVyaW5nIEluZGV4ZWREQiBleGVjdXRpb24uICovIGNsYXNzIHZ0IGV4dGVuZHMgTCB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcihCLlVOQVZBSUxBQkxFLCBgSW5kZXhlZERCIHRyYW5zYWN0aW9uICcke3R9JyBmYWlsZWQ6ICR7ZX1gKSwgdGhpcy5uYW1lID0gXCJJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yXCI7XG4gICAgfVxufVxuXG4vKiogVmVyaWZpZXMgd2hldGhlciBgZWAgaXMgYW4gSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvci4gKi8gZnVuY3Rpb24gVnQodCkge1xuICAgIC8vIFVzZSBuYW1lIGVxdWFsaXR5LCBhcyBpbnN0YW5jZW9mIGNoZWNrcyBvbiBlcnJvcnMgZG9uJ3Qgd29yayB3aXRoIGVycm9yc1xuICAgIC8vIHRoYXQgd3JhcCBvdGhlciBlcnJvcnMuXG4gICAgcmV0dXJuIFwiSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvclwiID09PSB0Lm5hbWU7XG59XG5cbi8qKlxuICogQSB3cmFwcGVyIGFyb3VuZCBhbiBJREJPYmplY3RTdG9yZSBwcm92aWRpbmcgYW4gQVBJIHRoYXQ6XG4gKlxuICogMSkgSGFzIGdlbmVyaWMgS2V5VHlwZSAvIFZhbHVlVHlwZSBwYXJhbWV0ZXJzIHRvIHByb3ZpZGUgc3Ryb25nbHktdHlwZWRcbiAqIG1ldGhvZHMgZm9yIGFjdGluZyBhZ2FpbnN0IHRoZSBvYmplY3Qgc3RvcmUuXG4gKiAyKSBEZWFscyB3aXRoIEluZGV4ZWREQidzIG9uc3VjY2VzcyAvIG9uZXJyb3IgZXZlbnQgY2FsbGJhY2tzLCBtYWtpbmcgZXZlcnlcbiAqIG1ldGhvZCByZXR1cm4gYSBQZXJzaXN0ZW5jZVByb21pc2UgaW5zdGVhZC5cbiAqIDMpIFByb3ZpZGVzIGEgaGlnaGVyLWxldmVsIEFQSSB0byBhdm9pZCBuZWVkaW5nIHRvIGRvIGV4Y2Vzc2l2ZSB3cmFwcGluZyBvZlxuICogaW50ZXJtZWRpYXRlIEluZGV4ZWREQiB0eXBlcyAoSURCQ3Vyc29yV2l0aFZhbHVlLCBldGMuKVxuICovIGNsYXNzIFN0IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuc3RvcmUgPSB0O1xuICAgIH1cbiAgICBwdXQodCwgZSkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZSA/IChDKFwiU2ltcGxlRGJcIiwgXCJQVVRcIiwgdGhpcy5zdG9yZS5uYW1lLCB0LCBlKSwgbiA9IHRoaXMuc3RvcmUucHV0KGUsIHQpKSA6IChDKFwiU2ltcGxlRGJcIiwgXCJQVVRcIiwgdGhpcy5zdG9yZS5uYW1lLCBcIjxhdXRvLWtleT5cIiwgdCksIFxuICAgICAgICBuID0gdGhpcy5zdG9yZS5wdXQodCkpLCBEdChuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyB2YWx1ZSBpbnRvIGFuIE9iamVjdCBTdG9yZSBhbmQgcmV0dXJucyB0aGUgbmV3IGtleS4gU2ltaWxhciB0b1xuICAgICAqIEluZGV4ZWREYidzIGBhZGQoKWAsIHRoaXMgbWV0aG9kIHdpbGwgZmFpbCBvbiBwcmltYXJ5IGtleSBjb2xsaXNpb25zLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIG9iamVjdCB0byB3cml0ZS5cbiAgICAgKiBAcmV0dXJucyBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBhZGQuXG4gICAgICovICAgIGFkZCh0KSB7XG4gICAgICAgIEMoXCJTaW1wbGVEYlwiLCBcIkFERFwiLCB0aGlzLnN0b3JlLm5hbWUsIHQsIHQpO1xuICAgICAgICByZXR1cm4gRHQodGhpcy5zdG9yZS5hZGQodCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBvYmplY3Qgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBmcm9tIHRoZSBzcGVjaWZpZWQgc3RvcmUsIG9yIG51bGxcbiAgICAgKiBpZiBubyBvYmplY3QgZXhpc3RzIHdpdGggdGhlIHNwZWNpZmllZCBrZXkuXG4gICAgICpcbiAgICAgKiBAa2V5IFRoZSBrZXkgb2YgdGhlIG9iamVjdCB0byBnZXQuXG4gICAgICogQHJldHVybnMgVGhlIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IG9yIG51bGwgaWYgbm8gb2JqZWN0IGV4aXN0cy5cbiAgICAgKi8gICAgZ2V0KHQpIHtcbiAgICAgICAgLy8gV2UncmUgZG9pbmcgYW4gdW5zYWZlIGNhc3QgdG8gVmFsdWVUeXBlLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4gRHQodGhpcy5zdG9yZS5nZXQodCkpLm5leHQoKGUgPT4gKFxuICAgICAgICAvLyBOb3JtYWxpemUgbm9uZXhpc3RlbmNlIHRvIG51bGwuXG4gICAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IG51bGwpLCBDKFwiU2ltcGxlRGJcIiwgXCJHRVRcIiwgdGhpcy5zdG9yZS5uYW1lLCB0LCBlKSwgZSkpKTtcbiAgICB9XG4gICAgZGVsZXRlKHQpIHtcbiAgICAgICAgQyhcIlNpbXBsZURiXCIsIFwiREVMRVRFXCIsIHRoaXMuc3RvcmUubmFtZSwgdCk7XG4gICAgICAgIHJldHVybiBEdCh0aGlzLnN0b3JlLmRlbGV0ZSh0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIElmIHdlIGV2ZXIgbmVlZCBtb3JlIG9mIHRoZSBjb3VudCB2YXJpYW50cywgd2UgY2FuIGFkZCBvdmVybG9hZHMuIEZvciBub3csXG4gICAgICogYWxsIHdlIG5lZWQgaXMgdG8gY291bnQgZXZlcnl0aGluZyBpbiBhIHN0b3JlLlxuICAgICAqXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHN0b3JlLlxuICAgICAqLyAgICBjb3VudCgpIHtcbiAgICAgICAgQyhcIlNpbXBsZURiXCIsIFwiQ09VTlRcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgcmV0dXJuIER0KHRoaXMuc3RvcmUuY291bnQoKSk7XG4gICAgfVxuICAgIFcodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5vcHRpb25zKHQsIGUpO1xuICAgICAgICAvLyBVc2UgYGdldEFsbCgpYCBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBJbmRleGVkREIgdjMsIGFzIGl0IGlzIHJvdWdobHlcbiAgICAgICAgLy8gMjAlIGZhc3Rlci4gVW5mb3J0dW5hdGVseSwgZ2V0QWxsKCkgZG9lcyBub3Qgc3VwcG9ydCBjdXN0b20gaW5kaWNlcy5cbiAgICAgICAgICAgICAgICBpZiAobi5pbmRleCB8fCBcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHRoaXMuc3RvcmUuZ2V0QWxsKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5jdXJzb3IobiksIGUgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLkgodCwgKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgZS5wdXNoKG4pO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IGUpKTtcbiAgICAgICAgfVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5zdG9yZS5nZXRBbGwobi5yYW5nZSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEF0KCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgICAgIHQub25lcnJvciA9IHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBuKHQudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgICAgICB9LCB0Lm9uc3VjY2VzcyA9IHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlKHQudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb2FkcyB0aGUgZmlyc3QgYGNvdW50YCBlbGVtZW50cyBmcm9tIHRoZSBwcm92aWRlZCBpbmRleCByYW5nZS4gTG9hZHMgYWxsXG4gICAgICogZWxlbWVudHMgaWYgbm8gbGltaXQgaXMgcHJvdmlkZWQuXG4gICAgICovICAgIEoodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5zdG9yZS5nZXRBbGwodCwgbnVsbCA9PT0gZSA/IHZvaWQgMCA6IGUpO1xuICAgICAgICByZXR1cm4gbmV3IEF0KCgodCwgZSkgPT4ge1xuICAgICAgICAgICAgbi5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgZSh0LnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICB9LCBuLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHQoZS50YXJnZXQucmVzdWx0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgWSh0LCBlKSB7XG4gICAgICAgIEMoXCJTaW1wbGVEYlwiLCBcIkRFTEVURSBBTExcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3B0aW9ucyh0LCBlKTtcbiAgICAgICAgbi5YID0gITE7XG4gICAgICAgIGNvbnN0IHMgPSB0aGlzLmN1cnNvcihuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuSChzLCAoKHQsIGUsIG4pID0+IG4uZGVsZXRlKCkpKTtcbiAgICB9XG4gICAgWih0LCBlKSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICBlID8gbiA9IHQgOiAobiA9IHt9LCBlID0gdCk7XG4gICAgICAgIGNvbnN0IHMgPSB0aGlzLmN1cnNvcihuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuSChzLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhIHN0b3JlLCBidXQgd2FpdHMgZm9yIHRoZSBnaXZlbiBjYWxsYmFjayB0byBjb21wbGV0ZSBmb3JcbiAgICAgKiBlYWNoIGVudHJ5IGJlZm9yZSBpdGVyYXRpbmcgdGhlIG5leHQgZW50cnkuIFRoaXMgYWxsb3dzIHRoZSBjYWxsYmFjayB0byBkb1xuICAgICAqIGFzeW5jaHJvbm91cyB3b3JrIHRvIGRldGVybWluZSBpZiB0aGlzIGl0ZXJhdGlvbiBzaG91bGQgY29udGludWUuXG4gICAgICpcbiAgICAgKiBUaGUgcHJvdmlkZWQgY2FsbGJhY2sgc2hvdWxkIHJldHVybiBgdHJ1ZWAgdG8gY29udGludWUgaXRlcmF0aW9uLCBhbmRcbiAgICAgKiBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi8gICAgdHQodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5jdXJzb3Ioe30pO1xuICAgICAgICByZXR1cm4gbmV3IEF0KCgobiwgcykgPT4ge1xuICAgICAgICAgICAgZS5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHh0KHQudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgICAgICBzKGUpO1xuICAgICAgICAgICAgfSwgZS5vbnN1Y2Nlc3MgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgIHMgPyB0KHMucHJpbWFyeUtleSwgcy52YWx1ZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHQgPyBzLmNvbnRpbnVlKCkgOiBuKCk7XG4gICAgICAgICAgICAgICAgfSkpIDogbigpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBIKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICByZXR1cm4gbmV3IEF0KCgocywgaSkgPT4ge1xuICAgICAgICAgICAgdC5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgaSh0LnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICB9LCB0Lm9uc3VjY2VzcyA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSB0LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKCFpKSByZXR1cm4gdm9pZCBzKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBQdChpKSwgbyA9IGUoaS5wcmltYXJ5S2V5LCBpLnZhbHVlLCByKTtcbiAgICAgICAgICAgICAgICBpZiAobyBpbnN0YW5jZW9mIEF0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBvLmNhdGNoKCh0ID0+IChyLmRvbmUoKSwgQXQucmVqZWN0KHQpKSkpO1xuICAgICAgICAgICAgICAgICAgICBuLnB1c2godCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHIuaXNEb25lID8gcygpIDogbnVsbCA9PT0gci5HID8gaS5jb250aW51ZSgpIDogaS5jb250aW51ZShyLkcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IEF0LndhaXRGb3IobikpKTtcbiAgICB9XG4gICAgb3B0aW9ucyh0LCBlKSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0ICYmIChcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gbiA9IHQgOiBlID0gdCksIHtcbiAgICAgICAgICAgIGluZGV4OiBuLFxuICAgICAgICAgICAgcmFuZ2U6IGVcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY3Vyc29yKHQpIHtcbiAgICAgICAgbGV0IGUgPSBcIm5leHRcIjtcbiAgICAgICAgaWYgKHQucmV2ZXJzZSAmJiAoZSA9IFwicHJldlwiKSwgdC5pbmRleCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuc3RvcmUuaW5kZXgodC5pbmRleCk7XG4gICAgICAgICAgICByZXR1cm4gdC5YID8gbi5vcGVuS2V5Q3Vyc29yKHQucmFuZ2UsIGUpIDogbi5vcGVuQ3Vyc29yKHQucmFuZ2UsIGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnN0b3JlLm9wZW5DdXJzb3IodC5yYW5nZSwgZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFdyYXBzIGFuIElEQlJlcXVlc3QgaW4gYSBQZXJzaXN0ZW5jZVByb21pc2UsIHVzaW5nIHRoZSBvbnN1Y2Nlc3MgLyBvbmVycm9yXG4gKiBoYW5kbGVycyB0byByZXNvbHZlIC8gcmVqZWN0IHRoZSBQZXJzaXN0ZW5jZVByb21pc2UgYXMgYXBwcm9wcmlhdGUuXG4gKi8gZnVuY3Rpb24gRHQodCkge1xuICAgIHJldHVybiBuZXcgQXQoKChlLCBuKSA9PiB7XG4gICAgICAgIHQub25zdWNjZXNzID0gdCA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgZShuKTtcbiAgICAgICAgfSwgdC5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICBjb25zdCBlID0geHQodC50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgbihlKTtcbiAgICAgICAgfTtcbiAgICB9KSk7XG59XG5cbi8vIEd1YXJkIHNvIHdlIG9ubHkgcmVwb3J0IHRoZSBlcnJvciBvbmNlLlxubGV0IEN0ID0gITE7XG5cbmZ1bmN0aW9uIHh0KHQpIHtcbiAgICBjb25zdCBlID0gYnQuRChnZXRVQSgpKTtcbiAgICBpZiAoZSA+PSAxMi4yICYmIGUgPCAxMykge1xuICAgICAgICBjb25zdCBlID0gXCJBbiBpbnRlcm5hbCBlcnJvciB3YXMgZW5jb3VudGVyZWQgaW4gdGhlIEluZGV4ZWQgRGF0YWJhc2Ugc2VydmVyXCI7XG4gICAgICAgIGlmICh0Lm1lc3NhZ2UuaW5kZXhPZihlKSA+PSAwKSB7XG4gICAgICAgICAgICAvLyBXcmFwIGVycm9yIGluIGEgbW9yZSBkZXNjcmlwdGl2ZSBvbmUuXG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IEwoXCJpbnRlcm5hbFwiLCBgSU9TX0lOREVYRUREQl9CVUcxOiBJbmRleGVkRGIgaGFzIHRocm93biAnJHtlfScuIFRoaXMgaXMgbGlrZWx5IGR1ZSB0byBhbiB1bmF2b2lkYWJsZSBidWcgaW4gaU9TLiBTZWUgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xLzU2NDk2Mjk2LzExMDkxNSBmb3IgZGV0YWlscyBhbmQgYSBwb3RlbnRpYWwgd29ya2Fyb3VuZC5gKTtcbiAgICAgICAgICAgIHJldHVybiBDdCB8fCAoQ3QgPSAhMCwgXG4gICAgICAgICAgICAvLyBUaHJvdyBhIGdsb2JhbCBleGNlcHRpb24gb3V0c2lkZSBvZiB0aGlzIHByb21pc2UgY2hhaW4sIGZvciB0aGUgdXNlciB0b1xuICAgICAgICAgICAgLy8gcG90ZW50aWFsbHkgY2F0Y2guXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdDtcbiAgICAgICAgICAgIH0pLCAwKSksIHQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHQ7XG59XG5cbi8qKiBUaGlzIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciB0aGUgc2NoZWR1bGluZyBvZiBJbmRleCBCYWNrZmlsbGVyLiAqL1xuY2xhc3MgTnQge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gdCwgdGhpcy5ldCA9IGUsIHRoaXMudGFzayA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLm50KDE1ZTMpO1xuICAgIH1cbiAgICBzdG9wKCkge1xuICAgICAgICB0aGlzLnRhc2sgJiYgKHRoaXMudGFzay5jYW5jZWwoKSwgdGhpcy50YXNrID0gbnVsbCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy50YXNrO1xuICAgIH1cbiAgICBudCh0KSB7XG4gICAgICAgIEMoXCJJbmRleEJhY2tpbGxlclwiLCBgU2NoZWR1bGVkIGluICR7dH1tc2ApLCB0aGlzLnRhc2sgPSB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFmdGVyRGVsYXkoXCJpbmRleF9iYWNrZmlsbFwiIC8qIFRpbWVySWQuSW5kZXhCYWNrZmlsbCAqLyAsIHQsIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRhc2sgPSBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBDKFwiSW5kZXhCYWNraWxsZXJcIiwgYERvY3VtZW50cyB3cml0dGVuOiAke2F3YWl0IHRoaXMuZXQuc3QoKX1gKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICBWdCh0KSA/IEMoXCJJbmRleEJhY2tpbGxlclwiLCBcIklnbm9yaW5nIEluZGV4ZWREQiBlcnJvciBkdXJpbmcgaW5kZXggYmFja2ZpbGw6IFwiLCB0KSA6IGF3YWl0IEV0KHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5udCg2ZTQpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKiogSW1wbGVtZW50cyB0aGUgc3RlcHMgZm9yIGJhY2tmaWxsaW5nIGluZGV4ZXMuICovIGNsYXNzIGt0IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBMb2NhbFN0b3JlIHByb3ZpZGVzIGFjY2VzcyB0byBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRWaWV3LlxuICAgICAqIFRoZXNlIHByb3BlcnRpZXMgd2lsbCB1cGRhdGUgd2hlbiB0aGUgdXNlciBjaGFuZ2VzLiBDb25zZXF1ZW50bHksXG4gICAgICogbWFraW5nIGEgbG9jYWwgY29weSBvZiBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRWaWV3IHdpbGwgcmVxdWlyZVxuICAgICAqIHVwZGF0ZXMgb3ZlciB0aW1lLiBUaGUgc2ltcGxlciBzb2x1dGlvbiBpcyB0byByZWx5IG9uIExvY2FsU3RvcmUgdG8gaGF2ZVxuICAgICAqIGFuIHVwLXRvLWRhdGUgcmVmZXJlbmNlcyB0byBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRTdG9yZS5cbiAgICAgKi9cbiAgICB0LCBlKSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IHQsIHRoaXMucGVyc2lzdGVuY2UgPSBlO1xuICAgIH1cbiAgICBhc3luYyBzdCh0ID0gNTApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJCYWNrZmlsbCBJbmRleGVzXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4gdGhpcy5pdChlLCB0KSkpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGluZGV4IGVudHJpZXMgdW50aWwgdGhlIGNhcCBpcyByZWFjaGVkLiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHByb2Nlc3NlZC4gKi8gICAgaXQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IFNldDtcbiAgICAgICAgbGV0IHMgPSBlLCBpID0gITA7XG4gICAgICAgIHJldHVybiBBdC5kb1doaWxlKCgoKSA9PiAhMCA9PT0gaSAmJiBzID4gMCksICgoKSA9PiB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLmdldE5leHRDb2xsZWN0aW9uR3JvdXBUb1VwZGF0ZSh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSBlICYmICFuLmhhcyhlKSkgcmV0dXJuIEMoXCJJbmRleEJhY2tpbGxlclwiLCBgUHJvY2Vzc2luZyBjb2xsZWN0aW9uOiAke2V9YCksIFxuICAgICAgICAgICAgdGhpcy5ydCh0LCBlLCBzKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICBzIC09IHQsIG4uYWRkKGUpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaSA9ICExO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBlIC0gcykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZXMgZW50cmllcyBmb3IgdGhlIHByb3ZpZGVkIGNvbGxlY3Rpb24gZ3JvdXAuIFJldHVybnMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcHJvY2Vzc2VkLlxuICAgICAqLyAgICBydCh0LCBlLCBuKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgZWFybGllc3Qgb2Zmc2V0IG9mIGFsbCBmaWVsZCBpbmRleGVzIHRvIHF1ZXJ5IHRoZSBsb2NhbCBjYWNoZS5cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxTdG9yZS5pbmRleE1hbmFnZXIuZ2V0TWluT2Zmc2V0RnJvbUNvbGxlY3Rpb25Hcm91cCh0LCBlKS5uZXh0KChzID0+IHRoaXMubG9jYWxTdG9yZS5sb2NhbERvY3VtZW50cy5nZXROZXh0RG9jdW1lbnRzKHQsIGUsIHMsIG4pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uY2hhbmdlcztcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLnVwZGF0ZUluZGV4RW50cmllcyh0LCBpKS5uZXh0KCgoKSA9PiB0aGlzLm90KHMsIG4pKSkubmV4dCgobiA9PiAoQyhcIkluZGV4QmFja2lsbGVyXCIsIGBVcGRhdGluZyBvZmZzZXQ6ICR7bn1gKSwgXG4gICAgICAgICAgICB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLnVwZGF0ZUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuKSkpKS5uZXh0KCgoKSA9PiBpLnNpemUpKTtcbiAgICAgICAgfSkpKSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRoZSBuZXh0IG9mZnNldCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgZG9jdW1lbnRzLiAqLyAgICBvdCh0LCBlKSB7XG4gICAgICAgIGxldCBuID0gdDtcbiAgICAgICAgcmV0dXJuIGUuY2hhbmdlcy5mb3JFYWNoKCgodCwgZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IGd0KGUpO1xuICAgICAgICAgICAgcHQocywgbikgPiAwICYmIChuID0gcyk7XG4gICAgICAgIH0pKSwgbmV3IHl0KG4ucmVhZFRpbWUsIG4uZG9jdW1lbnRLZXksIE1hdGgubWF4KGUuYmF0Y2hJZCwgdC5sYXJnZXN0QmF0Y2hJZCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogYExpc3RlblNlcXVlbmNlYCBpcyBhIG1vbm90b25pYyBzZXF1ZW5jZS4gSXQgaXMgaW5pdGlhbGl6ZWQgd2l0aCBhIG1pbmltdW0gdmFsdWUgdG9cbiAqIGV4Y2VlZC4gQWxsIHN1YnNlcXVlbnQgY2FsbHMgdG8gbmV4dCB3aWxsIHJldHVybiBpbmNyZWFzaW5nIHZhbHVlcy4gSWYgcHJvdmlkZWQgd2l0aCBhXG4gKiBgU2VxdWVuY2VOdW1iZXJTeW5jZXJgLCBpdCB3aWxsIGFkZGl0aW9uYWxseSBidW1wIGl0cyBuZXh0IHZhbHVlIHdoZW4gdG9sZCBvZiBhIG5ldyB2YWx1ZSwgYXNcbiAqIHdlbGwgYXMgd3JpdGUgb3V0IHNlcXVlbmNlIG51bWJlcnMgdGhhdCBpdCBwcm9kdWNlcyB2aWEgYG5leHQoKWAuXG4gKi8gY2xhc3MgT3Qge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5wcmV2aW91c1ZhbHVlID0gdCwgZSAmJiAoZS5zZXF1ZW5jZU51bWJlckhhbmRsZXIgPSB0ID0+IHRoaXMudXQodCksIHRoaXMuY3QgPSB0ID0+IGUud3JpdGVTZXF1ZW5jZU51bWJlcih0KSk7XG4gICAgfVxuICAgIHV0KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJldmlvdXNWYWx1ZSA9IE1hdGgubWF4KHQsIHRoaXMucHJldmlvdXNWYWx1ZSksIHRoaXMucHJldmlvdXNWYWx1ZTtcbiAgICB9XG4gICAgbmV4dCgpIHtcbiAgICAgICAgY29uc3QgdCA9ICsrdGhpcy5wcmV2aW91c1ZhbHVlO1xuICAgICAgICByZXR1cm4gdGhpcy5jdCAmJiB0aGlzLmN0KHQpLCB0O1xuICAgIH1cbn1cblxuT3QuYXQgPSAtMTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIE10IHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIGEgRGF0YWJhc2VJbmZvIHVzaW5nIHRoZSBwcm92aWRlZCBob3N0LCBkYXRhYmFzZUlkIGFuZFxuICAgICAqIHBlcnNpc3RlbmNlS2V5LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgZGF0YWJhc2UgdG8gdXNlLlxuICAgICAqIEBwYXJhbSBhcHBJZCAtIFRoZSBGaXJlYmFzZSBBcHAgSWQuXG4gICAgICogQHBhcmFtIHBlcnNpc3RlbmNlS2V5IC0gQSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhpcyBGaXJlc3RvcmUncyBsb2NhbFxuICAgICAqIHN0b3JhZ2UgKHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCB0aGUgZGF0YWJhc2VJZCkuXG4gICAgICogQHBhcmFtIGhvc3QgLSBUaGUgRmlyZXN0b3JlIGJhY2tlbmQgaG9zdCB0byBjb25uZWN0IHRvLlxuICAgICAqIEBwYXJhbSBzc2wgLSBXaGV0aGVyIHRvIHVzZSBTU0wgd2hlbiBjb25uZWN0aW5nLlxuICAgICAqIEBwYXJhbSBmb3JjZUxvbmdQb2xsaW5nIC0gV2hldGhlciB0byB1c2UgdGhlIGZvcmNlTG9uZ1BvbGxpbmcgb3B0aW9uXG4gICAgICogd2hlbiB1c2luZyBXZWJDaGFubmVsIGFzIHRoZSBuZXR3b3JrIHRyYW5zcG9ydC5cbiAgICAgKiBAcGFyYW0gYXV0b0RldGVjdExvbmdQb2xsaW5nIC0gV2hldGhlciB0byB1c2UgdGhlIGRldGVjdEJ1ZmZlcmluZ1Byb3h5XG4gICAgICogb3B0aW9uIHdoZW4gdXNpbmcgV2ViQ2hhbm5lbCBhcyB0aGUgbmV0d29yayB0cmFuc3BvcnQuXG4gICAgICogQHBhcmFtIHVzZUZldGNoU3RyZWFtcyBXaGV0aGVyIHRvIHVzZSB0aGUgRmV0Y2ggQVBJIGluc3RlYWQgb2ZcbiAgICAgKiBYTUxIVFRQUmVxdWVzdFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMsIGksIHIsIG8sIHUpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gdCwgdGhpcy5hcHBJZCA9IGUsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBuLCB0aGlzLmhvc3QgPSBzLCB0aGlzLnNzbCA9IGksIFxuICAgICAgICB0aGlzLmZvcmNlTG9uZ1BvbGxpbmcgPSByLCB0aGlzLmF1dG9EZXRlY3RMb25nUG9sbGluZyA9IG8sIHRoaXMudXNlRmV0Y2hTdHJlYW1zID0gdTtcbiAgICB9XG59XG5cbi8qKiBUaGUgZGVmYXVsdCBkYXRhYmFzZSBuYW1lIGZvciBhIHByb2plY3QuICovXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGRhdGFiYXNlIElEIGEgRmlyZXN0b3JlIGNsaWVudCBpcyBhc3NvY2lhdGVkIHdpdGguXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgRnQge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5wcm9qZWN0SWQgPSB0LCB0aGlzLmRhdGFiYXNlID0gZSB8fCBcIihkZWZhdWx0KVwiO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRnQoXCJcIiwgXCJcIik7XG4gICAgfVxuICAgIGdldCBpc0RlZmF1bHREYXRhYmFzZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiKGRlZmF1bHQpXCIgPT09IHRoaXMuZGF0YWJhc2U7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIEZ0ICYmIHQucHJvamVjdElkID09PSB0aGlzLnByb2plY3RJZCAmJiB0LmRhdGFiYXNlID09PSB0aGlzLmRhdGFiYXNlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uICR0KHQpIHtcbiAgICBsZXQgZSA9IDA7XG4gICAgZm9yIChjb25zdCBuIGluIHQpIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBuKSAmJiBlKys7XG4gICAgcmV0dXJuIGU7XG59XG5cbmZ1bmN0aW9uIEJ0KHQsIGUpIHtcbiAgICBmb3IgKGNvbnN0IG4gaW4gdCkgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIG4pICYmIGUobiwgdFtuXSk7XG59XG5cbmZ1bmN0aW9uIEx0KHQpIHtcbiAgICBmb3IgKGNvbnN0IGUgaW4gdCkgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCBlKSkgcmV0dXJuICExO1xuICAgIHJldHVybiAhMDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBTZW50aW5lbCB2YWx1ZSB0aGF0IHNvcnRzIGJlZm9yZSBhbnkgTXV0YXRpb24gQmF0Y2ggSUQuICovXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBhIHZhcmlhYmxlIGlzIGVpdGhlciB1bmRlZmluZWQgb3IgbnVsbC5cbiAqL1xuZnVuY3Rpb24gcXQodCkge1xuICAgIHJldHVybiBudWxsID09IHQ7XG59XG5cbi8qKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHZhbHVlIHJlcHJlc2VudHMgLTAuICovIGZ1bmN0aW9uIFV0KHQpIHtcbiAgICAvLyBEZXRlY3QgaWYgdGhlIHZhbHVlIGlzIC0wLjAuIEJhc2VkIG9uIHBvbHlmaWxsIGZyb21cbiAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvaXNcbiAgICByZXR1cm4gMCA9PT0gdCAmJiAxIC8gdCA9PSAtMSAvIDA7XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIGEgdmFsdWUgaXMgYW4gaW50ZWdlciBhbmQgaW4gdGhlIHNhZmUgaW50ZWdlciByYW5nZVxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIHRlc3QgZm9yIGJlaW5nIGFuIGludGVnZXIgYW5kIGluIHRoZSBzYWZlIHJhbmdlXG4gKi8gZnVuY3Rpb24gS3QodCkge1xuICAgIHJldHVybiBcIm51bWJlclwiID09IHR5cGVvZiB0ICYmIE51bWJlci5pc0ludGVnZXIodCkgJiYgIVV0KHQpICYmIHQgPD0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgJiYgdCA+PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBDb252ZXJ0cyBhIEJhc2U2NCBlbmNvZGVkIHN0cmluZyB0byBhIGJpbmFyeSBzdHJpbmcuICovXG4vKiogVHJ1ZSBpZiBhbmQgb25seSBpZiB0aGUgQmFzZTY0IGNvbnZlcnNpb24gZnVuY3Rpb25zIGFyZSBhdmFpbGFibGUuICovXG5mdW5jdGlvbiBHdCgpIHtcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgYXRvYjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1tdXRhYmxlIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIFwicHJvdG9cIiBieXRlIHN0cmluZy5cbiAqXG4gKiBQcm90byBieXRlIHN0cmluZ3MgY2FuIGVpdGhlciBiZSBCYXNlNjQtZW5jb2RlZCBzdHJpbmdzIG9yIFVpbnQ4QXJyYXlzIHdoZW5cbiAqIHNlbnQgb24gdGhlIHdpcmUuIFRoaXMgY2xhc3MgYWJzdHJhY3RzIGF3YXkgdGhpcyBkaWZmZXJlbnRpYXRpb24gYnkgaG9sZGluZ1xuICogdGhlIHByb3RvIGJ5dGUgc3RyaW5nIGluIGEgY29tbW9uIGNsYXNzIHRoYXQgbXVzdCBiZSBjb252ZXJ0ZWQgaW50byBhIHN0cmluZ1xuICogYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBwcm90by5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIFF0IHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuYmluYXJ5U3RyaW5nID0gdDtcbiAgICB9XG4gICAgc3RhdGljIGZyb21CYXNlNjRTdHJpbmcodCkge1xuICAgICAgICBjb25zdCBlID0gYXRvYih0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBRdChlKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21VaW50OEFycmF5KHQpIHtcbiAgICAgICAgLy8gVE9ETyhpbmRleGluZyk7IFJlbW92ZSB0aGUgY29weSBvZiB0aGUgYnl0ZSBzdHJpbmcgaGVyZSBhcyB0aGlzIG1ldGhvZFxuICAgICAgICAvLyBpcyBmcmVxdWVudGx5IGNhbGxlZCBkdXJpbmcgaW5kZXhpbmcuXG4gICAgICAgIGNvbnN0IGUgPSBcbiAgICAgICAgLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBhbiBVaW50OGFycmF5IHRvIGEgYmluYXJ5IHN0cmluZy5cbiAqL1xuICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBsZXQgZSA9IFwiXCI7XG4gICAgICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IHQubGVuZ3RoOyArK24pIGUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh0W25dKTtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgYSBiaW5hcnkgc3RyaW5nIHRvIGFuIFVpbnQ4QXJyYXkuXG4gKi8gKHQpO1xuICAgICAgICByZXR1cm4gbmV3IFF0KGUpO1xuICAgIH1cbiAgICBbU3ltYm9sLml0ZXJhdG9yXSgpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmV4dDogKCkgPT4gdCA8IHRoaXMuYmluYXJ5U3RyaW5nLmxlbmd0aCA/IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5iaW5hcnlTdHJpbmcuY2hhckNvZGVBdCh0KyspLFxuICAgICAgICAgICAgICAgIGRvbmU6ICExXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2b2lkIDAsXG4gICAgICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgdG9CYXNlNjQoKSB7XG4gICAgICAgIHJldHVybiB0ID0gdGhpcy5iaW5hcnlTdHJpbmcsIGJ0b2EodCk7XG4gICAgICAgIC8qKiBDb252ZXJ0cyBhIGJpbmFyeSBzdHJpbmcgdG8gYSBCYXNlNjQgZW5jb2RlZCBzdHJpbmcuICovXG4gICAgICAgIHZhciB0O1xuICAgIH1cbiAgICB0b1VpbnQ4QXJyYXkoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgbisrKSBlW25dID0gdC5jaGFyQ29kZUF0KG4pO1xuICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgLy8gQSBSZWdFeHAgbWF0Y2hpbmcgSVNPIDg2MDEgVVRDIHRpbWVzdGFtcHMgd2l0aCBvcHRpb25hbCBmcmFjdGlvbi5cbiAgICAgICAgKHRoaXMuYmluYXJ5U3RyaW5nKTtcbiAgICB9XG4gICAgYXBwcm94aW1hdGVCeXRlU2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIDIgKiB0aGlzLmJpbmFyeVN0cmluZy5sZW5ndGg7XG4gICAgfVxuICAgIGNvbXBhcmVUbyh0KSB7XG4gICAgICAgIHJldHVybiBaKHRoaXMuYmluYXJ5U3RyaW5nLCB0LmJpbmFyeVN0cmluZyk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5iaW5hcnlTdHJpbmcgPT09IHQuYmluYXJ5U3RyaW5nO1xuICAgIH1cbn1cblxuUXQuRU1QVFlfQllURV9TVFJJTkcgPSBuZXcgUXQoXCJcIik7XG5cbmNvbnN0IGp0ID0gbmV3IFJlZ0V4cCgvXlxcZHs0fS1cXGRcXGQtXFxkXFxkVFxcZFxcZDpcXGRcXGQ6XFxkXFxkKD86XFwuKFxcZCspKT9aJC8pO1xuXG4vKipcbiAqIENvbnZlcnRzIHRoZSBwb3NzaWJsZSBQcm90byB2YWx1ZXMgZm9yIGEgdGltZXN0YW1wIHZhbHVlIGludG8gYSBcInNlY29uZHMgYW5kXG4gKiBuYW5vc1wiIHJlcHJlc2VudGF0aW9uLlxuICovIGZ1bmN0aW9uIFd0KHQpIHtcbiAgICAvLyBUaGUganNvbiBpbnRlcmZhY2UgKGZvciB0aGUgYnJvd3Nlcikgd2lsbCByZXR1cm4gYW4gaXNvIHRpbWVzdGFtcCBzdHJpbmcsXG4gICAgLy8gd2hpbGUgdGhlIHByb3RvIGpzIGxpYnJhcnkgKGZvciBub2RlKSB3aWxsIHJldHVybiBhXG4gICAgLy8gZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCBpbnN0YW5jZS5cbiAgICBpZiAoTSghIXQpLCBcInN0cmluZ1wiID09IHR5cGVvZiB0KSB7XG4gICAgICAgIC8vIFRoZSBkYXRlIHN0cmluZyBjYW4gaGF2ZSBoaWdoZXIgcHJlY2lzaW9uIChuYW5vcykgdGhhbiB0aGUgRGF0ZSBjbGFzc1xuICAgICAgICAvLyAobWlsbGlzKSwgc28gd2UgZG8gc29tZSBjdXN0b20gcGFyc2luZyBoZXJlLlxuICAgICAgICAvLyBQYXJzZSB0aGUgbmFub3MgcmlnaHQgb3V0IG9mIHRoZSBzdHJpbmcuXG4gICAgICAgIGxldCBlID0gMDtcbiAgICAgICAgY29uc3QgbiA9IGp0LmV4ZWModCk7XG4gICAgICAgIGlmIChNKCEhbiksIG5bMV0pIHtcbiAgICAgICAgICAgIC8vIFBhZCB0aGUgZnJhY3Rpb24gb3V0IHRvIDkgZGlnaXRzIChuYW5vcykuXG4gICAgICAgICAgICBsZXQgdCA9IG5bMV07XG4gICAgICAgICAgICB0ID0gKHQgKyBcIjAwMDAwMDAwMFwiKS5zdWJzdHIoMCwgOSksIGUgPSBOdW1iZXIodCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFyc2UgdGhlIGRhdGUgdG8gZ2V0IHRoZSBzZWNvbmRzLlxuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgRGF0ZSh0KTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlY29uZHM6IE1hdGguZmxvb3Iocy5nZXRUaW1lKCkgLyAxZTMpLFxuICAgICAgICAgICAgbmFub3M6IGVcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2Vjb25kczogenQodC5zZWNvbmRzKSxcbiAgICAgICAgbmFub3M6IHp0KHQubmFub3MpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGUgcG9zc2libGUgUHJvdG8gdHlwZXMgZm9yIG51bWJlcnMgaW50byBhIEphdmFTY3JpcHQgbnVtYmVyLlxuICogUmV0dXJucyAwIGlmIHRoZSB2YWx1ZSBpcyBub3QgbnVtZXJpYy5cbiAqLyBmdW5jdGlvbiB6dCh0KSB7XG4gICAgLy8gVE9ETyhiam9ybmljayk6IEhhbmRsZSBpbnQ2NCBncmVhdGVyIHRoYW4gNTMgYml0cy5cbiAgICByZXR1cm4gXCJudW1iZXJcIiA9PSB0eXBlb2YgdCA/IHQgOiBcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gTnVtYmVyKHQpIDogMDtcbn1cblxuLyoqIENvbnZlcnRzIHRoZSBwb3NzaWJsZSBQcm90byB0eXBlcyBmb3IgQmxvYnMgaW50byBhIEJ5dGVTdHJpbmcuICovIGZ1bmN0aW9uIEh0KHQpIHtcbiAgICByZXR1cm4gXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCA/IFF0LmZyb21CYXNlNjRTdHJpbmcodCkgOiBRdC5mcm9tVWludDhBcnJheSh0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGxvY2FsbHktYXBwbGllZCBTZXJ2ZXJUaW1lc3RhbXAuXG4gKlxuICogU2VydmVyIFRpbWVzdGFtcHMgYXJlIGJhY2tlZCBieSBNYXBWYWx1ZXMgdGhhdCBjb250YWluIGFuIGludGVybmFsIGZpZWxkXG4gKiBgX190eXBlX19gIHdpdGggYSB2YWx1ZSBvZiBgc2VydmVyX3RpbWVzdGFtcGAuIFRoZSBwcmV2aW91cyB2YWx1ZSBhbmQgbG9jYWxcbiAqIHdyaXRlIHRpbWUgYXJlIHN0b3JlZCBpbiBpdHMgYF9fcHJldmlvdXNfdmFsdWVfX2AgYW5kIGBfX2xvY2FsX3dyaXRlX3RpbWVfX2BcbiAqIGZpZWxkcyByZXNwZWN0aXZlbHkuXG4gKlxuICogTm90ZXM6XG4gKiAtIFNlcnZlclRpbWVzdGFtcFZhbHVlIGluc3RhbmNlcyBhcmUgY3JlYXRlZCBhcyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGFcbiAqICAgdHJhbnNmb3JtLiBUaGV5IGNhbiBvbmx5IGV4aXN0IGluIHRoZSBsb2NhbCB2aWV3IG9mIGEgZG9jdW1lbnQuIFRoZXJlZm9yZVxuICogICB0aGV5IGRvIG5vdCBuZWVkIHRvIGJlIHBhcnNlZCBvciBzZXJpYWxpemVkLlxuICogLSBXaGVuIGV2YWx1YXRlZCBsb2NhbGx5IChlLmcuIGZvciBzbmFwc2hvdC5kYXRhKCkpLCB0aGV5IGJ5IGRlZmF1bHRcbiAqICAgZXZhbHVhdGUgdG8gYG51bGxgLiBUaGlzIGJlaGF2aW9yIGNhbiBiZSBjb25maWd1cmVkIGJ5IHBhc3NpbmcgY3VzdG9tXG4gKiAgIEZpZWxkVmFsdWVPcHRpb25zIHRvIHZhbHVlKCkuXG4gKiAtIFdpdGggcmVzcGVjdCB0byBvdGhlciBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZXMsIHRoZXkgc29ydCBieSB0aGVpclxuICogICBsb2NhbFdyaXRlVGltZS5cbiAqLyBmdW5jdGlvbiBKdCh0KSB7XG4gICAgdmFyIGUsIG47XG4gICAgcmV0dXJuIFwic2VydmVyX3RpbWVzdGFtcFwiID09PSAobnVsbCA9PT0gKG4gPSAoKG51bGwgPT09IChlID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5tYXBWYWx1ZSkgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5maWVsZHMpIHx8IHt9KS5fX3R5cGVfXykgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5zdHJpbmdWYWx1ZSk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBTZXJ2ZXJUaW1lc3RhbXAgcHJvdG8gdmFsdWUgKHVzaW5nIHRoZSBpbnRlcm5hbCBmb3JtYXQpLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBmaWVsZCBiZWZvcmUgdGhpcyBTZXJ2ZXJUaW1lc3RhbXAgd2FzIHNldC5cbiAqXG4gKiBQcmVzZXJ2aW5nIHRoZSBwcmV2aW91cyB2YWx1ZXMgYWxsb3dzIHRoZSB1c2VyIHRvIGRpc3BsYXkgdGhlIGxhc3QgcmVzb2xlZFxuICogdmFsdWUgdW50aWwgdGhlIGJhY2tlbmQgcmVzcG9uZHMgd2l0aCB0aGUgdGltZXN0YW1wLlxuICovXG5mdW5jdGlvbiBZdCh0KSB7XG4gICAgY29uc3QgZSA9IHQubWFwVmFsdWUuZmllbGRzLl9fcHJldmlvdXNfdmFsdWVfXztcbiAgICByZXR1cm4gSnQoZSkgPyBZdChlKSA6IGU7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgbG9jYWwgdGltZSBhdCB3aGljaCB0aGlzIHRpbWVzdGFtcCB3YXMgZmlyc3Qgc2V0LlxuICovIGZ1bmN0aW9uIFh0KHQpIHtcbiAgICBjb25zdCBlID0gV3QodC5tYXBWYWx1ZS5maWVsZHMuX19sb2NhbF93cml0ZV90aW1lX18udGltZXN0YW1wVmFsdWUpO1xuICAgIHJldHVybiBuZXcgbnQoZS5zZWNvbmRzLCBlLm5hbm9zKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgWnQgPSB7XG4gICAgbWFwVmFsdWU6IHtcbiAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICBfX3R5cGVfXzoge1xuICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlOiBcIl9fbWF4X19cIlxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSwgdGUgPSB7XG4gICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxufTtcblxuLyoqIEV4dHJhY3RzIHRoZSBiYWNrZW5kJ3MgdHlwZSBvcmRlciBmb3IgdGhlIHByb3ZpZGVkIHZhbHVlLiAqL1xuZnVuY3Rpb24gZWUodCkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIHQgPyAwIC8qIFR5cGVPcmRlci5OdWxsVmFsdWUgKi8gOiBcImJvb2xlYW5WYWx1ZVwiIGluIHQgPyAxIC8qIFR5cGVPcmRlci5Cb29sZWFuVmFsdWUgKi8gOiBcImludGVnZXJWYWx1ZVwiIGluIHQgfHwgXCJkb3VibGVWYWx1ZVwiIGluIHQgPyAyIC8qIFR5cGVPcmRlci5OdW1iZXJWYWx1ZSAqLyA6IFwidGltZXN0YW1wVmFsdWVcIiBpbiB0ID8gMyAvKiBUeXBlT3JkZXIuVGltZXN0YW1wVmFsdWUgKi8gOiBcInN0cmluZ1ZhbHVlXCIgaW4gdCA/IDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDogXCJieXRlc1ZhbHVlXCIgaW4gdCA/IDYgLyogVHlwZU9yZGVyLkJsb2JWYWx1ZSAqLyA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiB0ID8gNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOiBcImdlb1BvaW50VmFsdWVcIiBpbiB0ID8gOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6IFwiYXJyYXlWYWx1ZVwiIGluIHQgPyA5IC8qIFR5cGVPcmRlci5BcnJheVZhbHVlICovIDogXCJtYXBWYWx1ZVwiIGluIHQgPyBKdCh0KSA/IDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDogd2UodCkgPyA5MDA3MTk5MjU0NzQwOTkxIC8qIFR5cGVPcmRlci5NYXhWYWx1ZSAqLyA6IDEwIC8qIFR5cGVPcmRlci5PYmplY3RWYWx1ZSAqLyA6IE8oKTtcbn1cblxuLyoqIFRlc3RzIGBsZWZ0YCBhbmQgYHJpZ2h0YCBmb3IgZXF1YWxpdHkgYmFzZWQgb24gdGhlIGJhY2tlbmQgc2VtYW50aWNzLiAqLyBmdW5jdGlvbiBuZSh0LCBlKSB7XG4gICAgaWYgKHQgPT09IGUpIHJldHVybiAhMDtcbiAgICBjb25zdCBuID0gZWUodCk7XG4gICAgaWYgKG4gIT09IGVlKGUpKSByZXR1cm4gITE7XG4gICAgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDkwMDcxOTkyNTQ3NDA5OTEgLyogVHlwZU9yZGVyLk1heFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuICEwO1xuXG4gICAgICBjYXNlIDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiB0LmJvb2xlYW5WYWx1ZSA9PT0gZS5ib29sZWFuVmFsdWU7XG5cbiAgICAgIGNhc2UgNCAvKiBUeXBlT3JkZXIuU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gWHQodCkuaXNFcXVhbChYdChlKSk7XG5cbiAgICAgIGNhc2UgMyAvKiBUeXBlT3JkZXIuVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHQudGltZXN0YW1wVmFsdWUgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS50aW1lc3RhbXBWYWx1ZSAmJiB0LnRpbWVzdGFtcFZhbHVlLmxlbmd0aCA9PT0gZS50aW1lc3RhbXBWYWx1ZS5sZW5ndGgpIFxuICAgICAgICAgICAgLy8gVXNlIHN0cmluZyBlcXVhbGl0eSBmb3IgSVNPIDg2MDEgdGltZXN0YW1wc1xuICAgICAgICAgICAgcmV0dXJuIHQudGltZXN0YW1wVmFsdWUgPT09IGUudGltZXN0YW1wVmFsdWU7XG4gICAgICAgICAgICBjb25zdCBuID0gV3QodC50aW1lc3RhbXBWYWx1ZSksIHMgPSBXdChlLnRpbWVzdGFtcFZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybiBuLnNlY29uZHMgPT09IHMuc2Vjb25kcyAmJiBuLm5hbm9zID09PSBzLm5hbm9zO1xuICAgICAgICB9KHQsIGUpO1xuXG4gICAgICBjYXNlIDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIHQuc3RyaW5nVmFsdWUgPT09IGUuc3RyaW5nVmFsdWU7XG5cbiAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBIdCh0LmJ5dGVzVmFsdWUpLmlzRXF1YWwoSHQoZS5ieXRlc1ZhbHVlKSk7XG4gICAgICAgIH0odCwgZSk7XG5cbiAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gdC5yZWZlcmVuY2VWYWx1ZSA9PT0gZS5yZWZlcmVuY2VWYWx1ZTtcblxuICAgICAgY2FzZSA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiB6dCh0Lmdlb1BvaW50VmFsdWUubGF0aXR1ZGUpID09PSB6dChlLmdlb1BvaW50VmFsdWUubGF0aXR1ZGUpICYmIHp0KHQuZ2VvUG9pbnRWYWx1ZS5sb25naXR1ZGUpID09PSB6dChlLmdlb1BvaW50VmFsdWUubG9uZ2l0dWRlKTtcbiAgICAgICAgfSh0LCBlKTtcblxuICAgICAgY2FzZSAyIC8qIFR5cGVPcmRlci5OdW1iZXJWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAoXCJpbnRlZ2VyVmFsdWVcIiBpbiB0ICYmIFwiaW50ZWdlclZhbHVlXCIgaW4gZSkgcmV0dXJuIHp0KHQuaW50ZWdlclZhbHVlKSA9PT0genQoZS5pbnRlZ2VyVmFsdWUpO1xuICAgICAgICAgICAgaWYgKFwiZG91YmxlVmFsdWVcIiBpbiB0ICYmIFwiZG91YmxlVmFsdWVcIiBpbiBlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHp0KHQuZG91YmxlVmFsdWUpLCBzID0genQoZS5kb3VibGVWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gPT09IHMgPyBVdChuKSA9PT0gVXQocykgOiBpc05hTihuKSAmJiBpc05hTihzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgfSh0LCBlKTtcblxuICAgICAgY2FzZSA5IC8qIFR5cGVPcmRlci5BcnJheVZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIHR0KHQuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10sIGUuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10sIG5lKTtcblxuICAgICAgY2FzZSAxMCAvKiBUeXBlT3JkZXIuT2JqZWN0VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQubWFwVmFsdWUuZmllbGRzIHx8IHt9LCBzID0gZS5tYXBWYWx1ZS5maWVsZHMgfHwge307XG4gICAgICAgICAgICBpZiAoJHQobikgIT09ICR0KHMpKSByZXR1cm4gITE7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgaW4gbikgaWYgKG4uaGFzT3duUHJvcGVydHkodCkgJiYgKHZvaWQgMCA9PT0gc1t0XSB8fCAhbmUoblt0XSwgc1t0XSkpKSByZXR1cm4gITE7XG4gICAgICAgICAgICByZXR1cm4gITA7XG4gICAgICAgIH1cbiAgICAgICAgLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgQXJyYXlWYWx1ZSBjb250YWlucyB0aGUgc3BlY2lmaWVkIGVsZW1lbnQuICovICh0LCBlKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIE8oKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNlKHQsIGUpIHtcbiAgICByZXR1cm4gdm9pZCAwICE9PSAodC52YWx1ZXMgfHwgW10pLmZpbmQoKHQgPT4gbmUodCwgZSkpKTtcbn1cblxuZnVuY3Rpb24gaWUodCwgZSkge1xuICAgIGlmICh0ID09PSBlKSByZXR1cm4gMDtcbiAgICBjb25zdCBuID0gZWUodCksIHMgPSBlZShlKTtcbiAgICBpZiAobiAhPT0gcykgcmV0dXJuIFoobiwgcyk7XG4gICAgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDkwMDcxOTkyNTQ3NDA5OTEgLyogVHlwZU9yZGVyLk1heFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgIGNhc2UgMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIFoodC5ib29sZWFuVmFsdWUsIGUuYm9vbGVhblZhbHVlKTtcblxuICAgICAgY2FzZSAyIC8qIFR5cGVPcmRlci5OdW1iZXJWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0genQodC5pbnRlZ2VyVmFsdWUgfHwgdC5kb3VibGVWYWx1ZSksIHMgPSB6dChlLmludGVnZXJWYWx1ZSB8fCBlLmRvdWJsZVZhbHVlKTtcbiAgICAgICAgICAgIHJldHVybiBuIDwgcyA/IC0xIDogbiA+IHMgPyAxIDogbiA9PT0gcyA/IDAgOiBcbiAgICAgICAgICAgIC8vIG9uZSBvciBib3RoIGFyZSBOYU4uXG4gICAgICAgICAgICBpc05hTihuKSA/IGlzTmFOKHMpID8gMCA6IC0xIDogMTtcbiAgICAgICAgfSh0LCBlKTtcblxuICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiByZSh0LnRpbWVzdGFtcFZhbHVlLCBlLnRpbWVzdGFtcFZhbHVlKTtcblxuICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiByZShYdCh0KSwgWHQoZSkpO1xuXG4gICAgICBjYXNlIDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIFoodC5zdHJpbmdWYWx1ZSwgZS5zdHJpbmdWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBIdCh0KSwgcyA9IEh0KGUpO1xuICAgICAgICAgICAgcmV0dXJuIG4uY29tcGFyZVRvKHMpO1xuICAgICAgICB9KHQuYnl0ZXNWYWx1ZSwgZS5ieXRlc1ZhbHVlKTtcblxuICAgICAgY2FzZSA3IC8qIFR5cGVPcmRlci5SZWZWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5zcGxpdChcIi9cIiksIHMgPSBlLnNwbGl0KFwiL1wiKTtcbiAgICAgICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgbi5sZW5ndGggJiYgdCA8IHMubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gWihuW3RdLCBzW3RdKTtcbiAgICAgICAgICAgICAgICBpZiAoMCAhPT0gZSkgcmV0dXJuIGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gWihuLmxlbmd0aCwgcy5sZW5ndGgpO1xuICAgICAgICB9KHQucmVmZXJlbmNlVmFsdWUsIGUucmVmZXJlbmNlVmFsdWUpO1xuXG4gICAgICBjYXNlIDggLyogVHlwZU9yZGVyLkdlb1BvaW50VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IFooenQodC5sYXRpdHVkZSksIHp0KGUubGF0aXR1ZGUpKTtcbiAgICAgICAgICAgIGlmICgwICE9PSBuKSByZXR1cm4gbjtcbiAgICAgICAgICAgIHJldHVybiBaKHp0KHQubG9uZ2l0dWRlKSwgenQoZS5sb25naXR1ZGUpKTtcbiAgICAgICAgfSh0Lmdlb1BvaW50VmFsdWUsIGUuZ2VvUG9pbnRWYWx1ZSk7XG5cbiAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC52YWx1ZXMgfHwgW10sIHMgPSBlLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgbi5sZW5ndGggJiYgdCA8IHMubGVuZ3RoOyArK3QpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gaWUoblt0XSwgc1t0XSk7XG4gICAgICAgICAgICAgICAgaWYgKGUpIHJldHVybiBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFoobi5sZW5ndGgsIHMubGVuZ3RoKTtcbiAgICAgICAgfSh0LmFycmF5VmFsdWUsIGUuYXJyYXlWYWx1ZSk7XG5cbiAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGlmICh0ID09PSBadC5tYXBWYWx1ZSAmJiBlID09PSBadC5tYXBWYWx1ZSkgcmV0dXJuIDA7XG4gICAgICAgICAgICBpZiAodCA9PT0gWnQubWFwVmFsdWUpIHJldHVybiAxO1xuICAgICAgICAgICAgaWYgKGUgPT09IFp0Lm1hcFZhbHVlKSByZXR1cm4gLTE7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5maWVsZHMgfHwge30sIHMgPSBPYmplY3Qua2V5cyhuKSwgaSA9IGUuZmllbGRzIHx8IHt9LCByID0gT2JqZWN0LmtleXMoaSk7XG4gICAgICAgICAgICAvLyBFdmVuIHRob3VnaCBNYXBWYWx1ZXMgYXJlIGxpa2VseSBzb3J0ZWQgY29ycmVjdGx5IGJhc2VkIG9uIHRoZWlyIGluc2VydGlvblxuICAgICAgICAgICAgLy8gb3JkZXIgKGUuZy4gd2hlbiByZWNlaXZlZCBmcm9tIHRoZSBiYWNrZW5kKSwgbG9jYWwgbW9kaWZpY2F0aW9ucyBjYW4gYnJpbmdcbiAgICAgICAgICAgIC8vIGVsZW1lbnRzIG91dCBvZiBvcmRlci4gV2UgbmVlZCB0byByZS1zb3J0IHRoZSBlbGVtZW50cyB0byBlbnN1cmUgdGhhdFxuICAgICAgICAgICAgLy8gY2Fub25pY2FsIElEcyBhcmUgaW5kZXBlbmRlbnQgb2YgaW5zZXJ0aW9uIG9yZGVyLlxuICAgICAgICAgICAgcy5zb3J0KCksIHIuc29ydCgpO1xuICAgICAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBzLmxlbmd0aCAmJiB0IDwgci5sZW5ndGg7ICsrdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBaKHNbdF0sIHJbdF0pO1xuICAgICAgICAgICAgICAgIGlmICgwICE9PSBlKSByZXR1cm4gZTtcbiAgICAgICAgICAgICAgICBjb25zdCBvID0gaWUobltzW3RdXSwgaVtyW3RdXSk7XG4gICAgICAgICAgICAgICAgaWYgKDAgIT09IG8pIHJldHVybiBvO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFoocy5sZW5ndGgsIHIubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEdlbmVyYXRlcyB0aGUgY2Fub25pY2FsIElEIGZvciB0aGUgcHJvdmlkZWQgZmllbGQgdmFsdWUgKGFzIHVzZWQgaW4gVGFyZ2V0XG4gKiBzZXJpYWxpemF0aW9uKS5cbiAqLyAodC5tYXBWYWx1ZSwgZS5tYXBWYWx1ZSk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IE8oKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHJlKHQsIGUpIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCAmJiBcInN0cmluZ1wiID09IHR5cGVvZiBlICYmIHQubGVuZ3RoID09PSBlLmxlbmd0aCkgcmV0dXJuIFoodCwgZSk7XG4gICAgY29uc3QgbiA9IFd0KHQpLCBzID0gV3QoZSksIGkgPSBaKG4uc2Vjb25kcywgcy5zZWNvbmRzKTtcbiAgICByZXR1cm4gMCAhPT0gaSA/IGkgOiBaKG4ubmFub3MsIHMubmFub3MpO1xufVxuXG5mdW5jdGlvbiBvZSh0KSB7XG4gICAgcmV0dXJuIHVlKHQpO1xufVxuXG5mdW5jdGlvbiB1ZSh0KSB7XG4gICAgcmV0dXJuIFwibnVsbFZhbHVlXCIgaW4gdCA/IFwibnVsbFwiIDogXCJib29sZWFuVmFsdWVcIiBpbiB0ID8gXCJcIiArIHQuYm9vbGVhblZhbHVlIDogXCJpbnRlZ2VyVmFsdWVcIiBpbiB0ID8gXCJcIiArIHQuaW50ZWdlclZhbHVlIDogXCJkb3VibGVWYWx1ZVwiIGluIHQgPyBcIlwiICsgdC5kb3VibGVWYWx1ZSA6IFwidGltZXN0YW1wVmFsdWVcIiBpbiB0ID8gZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gV3QodCk7XG4gICAgICAgIHJldHVybiBgdGltZSgke2Uuc2Vjb25kc30sJHtlLm5hbm9zfSlgO1xuICAgIH0odC50aW1lc3RhbXBWYWx1ZSkgOiBcInN0cmluZ1ZhbHVlXCIgaW4gdCA/IHQuc3RyaW5nVmFsdWUgOiBcImJ5dGVzVmFsdWVcIiBpbiB0ID8gSHQodC5ieXRlc1ZhbHVlKS50b0Jhc2U2NCgpIDogXCJyZWZlcmVuY2VWYWx1ZVwiIGluIHQgPyAobiA9IHQucmVmZXJlbmNlVmFsdWUsIFxuICAgIGN0LmZyb21OYW1lKG4pLnRvU3RyaW5nKCkpIDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gdCA/IGBnZW8oJHsoZSA9IHQuZ2VvUG9pbnRWYWx1ZSkubGF0aXR1ZGV9LCR7ZS5sb25naXR1ZGV9KWAgOiBcImFycmF5VmFsdWVcIiBpbiB0ID8gZnVuY3Rpb24odCkge1xuICAgICAgICBsZXQgZSA9IFwiW1wiLCBuID0gITA7XG4gICAgICAgIGZvciAoY29uc3QgcyBvZiB0LnZhbHVlcyB8fCBbXSkgbiA/IG4gPSAhMSA6IGUgKz0gXCIsXCIsIGUgKz0gdWUocyk7XG4gICAgICAgIHJldHVybiBlICsgXCJdXCI7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHZhbHVlIGZvciB0aGUgcHJvdmlkZWQgZGF0YWJhc2UgYW5kIGtleS4gKi8gKHQuYXJyYXlWYWx1ZSkgOiBcIm1hcFZhbHVlXCIgaW4gdCA/IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgLy8gSXRlcmF0aW9uIG9yZGVyIGluIEphdmFTY3JpcHQgaXMgbm90IGd1YXJhbnRlZWQuIFRvIGVuc3VyZSB0aGF0IHdlIGdlbmVyYXRlXG4gICAgICAgIC8vIG1hdGNoaW5nIGNhbm9uaWNhbCBJRHMgZm9yIGlkZW50aWNhbCBtYXBzLCB3ZSBuZWVkIHRvIHNvcnQgdGhlIGtleXMuXG4gICAgICAgIGNvbnN0IGUgPSBPYmplY3Qua2V5cyh0LmZpZWxkcyB8fCB7fSkuc29ydCgpO1xuICAgICAgICBsZXQgbiA9IFwie1wiLCBzID0gITA7XG4gICAgICAgIGZvciAoY29uc3QgaSBvZiBlKSBzID8gcyA9ICExIDogbiArPSBcIixcIiwgbiArPSBgJHtpfToke3VlKHQuZmllbGRzW2ldKX1gO1xuICAgICAgICByZXR1cm4gbiArIFwifVwiO1xuICAgIH0odC5tYXBWYWx1ZSkgOiBPKCk7XG4gICAgdmFyIGUsIG47XG59XG5cbmZ1bmN0aW9uIGNlKHQsIGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZWZlcmVuY2VWYWx1ZTogYHByb2plY3RzLyR7dC5wcm9qZWN0SWR9L2RhdGFiYXNlcy8ke3QuZGF0YWJhc2V9L2RvY3VtZW50cy8ke2UucGF0aC5jYW5vbmljYWxTdHJpbmcoKX1gXG4gICAgfTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGFuIEludGVnZXJWYWx1ZSAuICovIGZ1bmN0aW9uIGFlKHQpIHtcbiAgICByZXR1cm4gISF0ICYmIFwiaW50ZWdlclZhbHVlXCIgaW4gdDtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGEgRG91YmxlVmFsdWUuICovXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYW4gQXJyYXlWYWx1ZS4gKi9cbmZ1bmN0aW9uIGhlKHQpIHtcbiAgICByZXR1cm4gISF0ICYmIFwiYXJyYXlWYWx1ZVwiIGluIHQ7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhIE51bGxWYWx1ZS4gKi8gZnVuY3Rpb24gbGUodCkge1xuICAgIHJldHVybiAhIXQgJiYgXCJudWxsVmFsdWVcIiBpbiB0O1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgTmFOLiAqLyBmdW5jdGlvbiBmZSh0KSB7XG4gICAgcmV0dXJuICEhdCAmJiBcImRvdWJsZVZhbHVlXCIgaW4gdCAmJiBpc05hTihOdW1iZXIodC5kb3VibGVWYWx1ZSkpO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYSBNYXBWYWx1ZS4gKi8gZnVuY3Rpb24gZGUodCkge1xuICAgIHJldHVybiAhIXQgJiYgXCJtYXBWYWx1ZVwiIGluIHQ7XG59XG5cbi8qKiBDcmVhdGVzIGEgZGVlcCBjb3B5IG9mIGBzb3VyY2VgLiAqLyBmdW5jdGlvbiBfZSh0KSB7XG4gICAgaWYgKHQuZ2VvUG9pbnRWYWx1ZSkgcmV0dXJuIHtcbiAgICAgICAgZ2VvUG9pbnRWYWx1ZTogT2JqZWN0LmFzc2lnbih7fSwgdC5nZW9Qb2ludFZhbHVlKVxuICAgIH07XG4gICAgaWYgKHQudGltZXN0YW1wVmFsdWUgJiYgXCJvYmplY3RcIiA9PSB0eXBlb2YgdC50aW1lc3RhbXBWYWx1ZSkgcmV0dXJuIHtcbiAgICAgICAgdGltZXN0YW1wVmFsdWU6IE9iamVjdC5hc3NpZ24oe30sIHQudGltZXN0YW1wVmFsdWUpXG4gICAgfTtcbiAgICBpZiAodC5tYXBWYWx1ZSkge1xuICAgICAgICBjb25zdCBlID0ge1xuICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHt9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBCdCh0Lm1hcFZhbHVlLmZpZWxkcywgKCh0LCBuKSA9PiBlLm1hcFZhbHVlLmZpZWxkc1t0XSA9IF9lKG4pKSksIGU7XG4gICAgfVxuICAgIGlmICh0LmFycmF5VmFsdWUpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IFtdXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgKHQuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10pLmxlbmd0aDsgKytuKSBlLmFycmF5VmFsdWUudmFsdWVzW25dID0gX2UodC5hcnJheVZhbHVlLnZhbHVlc1tuXSk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgdCk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIFZhbHVlIHJlcHJlc2VudHMgdGhlIGNhbm9uaWNhbCB7QGxpbmsgI01BWF9WQUxVRX0gLiAqLyBmdW5jdGlvbiB3ZSh0KSB7XG4gICAgcmV0dXJuIFwiX19tYXhfX1wiID09PSAoKCh0Lm1hcFZhbHVlIHx8IHt9KS5maWVsZHMgfHwge30pLl9fdHlwZV9fIHx8IHt9KS5zdHJpbmdWYWx1ZTtcbn1cblxuLyoqIFJldHVybnMgdGhlIGxvd2VzdCB2YWx1ZSBmb3IgdGhlIGdpdmVuIHZhbHVlIHR5cGUgKGluY2x1c2l2ZSkuICovIGZ1bmN0aW9uIG1lKHQpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiB0ID8gdGUgOiBcImJvb2xlYW5WYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIGJvb2xlYW5WYWx1ZTogITFcbiAgICB9IDogXCJpbnRlZ2VyVmFsdWVcIiBpbiB0IHx8IFwiZG91YmxlVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBkb3VibGVWYWx1ZTogTmFOXG4gICAgfSA6IFwidGltZXN0YW1wVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICB0aW1lc3RhbXBWYWx1ZToge1xuICAgICAgICAgICAgc2Vjb25kczogTnVtYmVyLk1JTl9TQUZFX0lOVEVHRVJcbiAgICAgICAgfVxuICAgIH0gOiBcInN0cmluZ1ZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgc3RyaW5nVmFsdWU6IFwiXCJcbiAgICB9IDogXCJieXRlc1ZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgYnl0ZXNWYWx1ZTogXCJcIlxuICAgIH0gOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gdCA/IGNlKEZ0LmVtcHR5KCksIGN0LmVtcHR5KCkpIDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgZ2VvUG9pbnRWYWx1ZToge1xuICAgICAgICAgICAgbGF0aXR1ZGU6IC05MCxcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTE4MFxuICAgICAgICB9XG4gICAgfSA6IFwiYXJyYXlWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIGFycmF5VmFsdWU6IHt9XG4gICAgfSA6IFwibWFwVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBtYXBWYWx1ZToge31cbiAgICB9IDogTygpO1xufVxuXG4vKiogUmV0dXJucyB0aGUgbGFyZ2VzdCB2YWx1ZSBmb3IgdGhlIGdpdmVuIHZhbHVlIHR5cGUgKGV4Y2x1c2l2ZSkuICovIGZ1bmN0aW9uIGdlKHQpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBib29sZWFuVmFsdWU6ICExXG4gICAgfSA6IFwiYm9vbGVhblZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgIH0gOiBcImludGVnZXJWYWx1ZVwiIGluIHQgfHwgXCJkb3VibGVWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICBzZWNvbmRzOiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUlxuICAgICAgICB9XG4gICAgfSA6IFwidGltZXN0YW1wVmFsdWVcIiBpbiB0ID8ge1xuICAgICAgICBzdHJpbmdWYWx1ZTogXCJcIlxuICAgIH0gOiBcInN0cmluZ1ZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgYnl0ZXNWYWx1ZTogXCJcIlxuICAgIH0gOiBcImJ5dGVzVmFsdWVcIiBpbiB0ID8gY2UoRnQuZW1wdHkoKSwgY3QuZW1wdHkoKSkgOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gdCA/IHtcbiAgICAgICAgZ2VvUG9pbnRWYWx1ZToge1xuICAgICAgICAgICAgbGF0aXR1ZGU6IC05MCxcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTE4MFxuICAgICAgICB9XG4gICAgfSA6IFwiZ2VvUG9pbnRWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIGFycmF5VmFsdWU6IHt9XG4gICAgfSA6IFwiYXJyYXlWYWx1ZVwiIGluIHQgPyB7XG4gICAgICAgIG1hcFZhbHVlOiB7fVxuICAgIH0gOiBcIm1hcFZhbHVlXCIgaW4gdCA/IFp0IDogTygpO1xufVxuXG5mdW5jdGlvbiB5ZSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IGllKHQudmFsdWUsIGUudmFsdWUpO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IHQuaW5jbHVzaXZlICYmICFlLmluY2x1c2l2ZSA/IC0xIDogIXQuaW5jbHVzaXZlICYmIGUuaW5jbHVzaXZlID8gMSA6IDA7XG59XG5cbmZ1bmN0aW9uIHBlKHQsIGUpIHtcbiAgICBjb25zdCBuID0gaWUodC52YWx1ZSwgZS52YWx1ZSk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogdC5pbmNsdXNpdmUgJiYgIWUuaW5jbHVzaXZlID8gMSA6ICF0LmluY2x1c2l2ZSAmJiBlLmluY2x1c2l2ZSA/IC0xIDogMDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGJvdW5kIG9mIGEgcXVlcnkuXG4gKlxuICogVGhlIGJvdW5kIGlzIHNwZWNpZmllZCB3aXRoIHRoZSBnaXZlbiBjb21wb25lbnRzIHJlcHJlc2VudGluZyBhIHBvc2l0aW9uIGFuZFxuICogd2hldGhlciBpdCdzIGp1c3QgYmVmb3JlIG9yIGp1c3QgYWZ0ZXIgdGhlIHBvc2l0aW9uIChyZWxhdGl2ZSB0byB3aGF0ZXZlciB0aGVcbiAqIHF1ZXJ5IG9yZGVyIGlzKS5cbiAqXG4gKiBUaGUgcG9zaXRpb24gcmVwcmVzZW50cyBhIGxvZ2ljYWwgaW5kZXggcG9zaXRpb24gZm9yIGEgcXVlcnkuIEl0J3MgYSBwcmVmaXhcbiAqIG9mIHZhbHVlcyBmb3IgdGhlIChwb3RlbnRpYWxseSBpbXBsaWNpdCkgb3JkZXIgYnkgY2xhdXNlcyBvZiBhIHF1ZXJ5LlxuICpcbiAqIEJvdW5kIHByb3ZpZGVzIGEgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBkb2N1bWVudCBjb21lcyBiZWZvcmUgb3JcbiAqIGFmdGVyIGEgYm91bmQuIFRoaXMgaXMgaW5mbHVlbmNlZCBieSB3aGV0aGVyIHRoZSBwb3NpdGlvbiBpcyBqdXN0IGJlZm9yZSBvclxuICoganVzdCBhZnRlciB0aGUgcHJvdmlkZWQgdmFsdWVzLlxuICovIGNsYXNzIEllIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSB0LCB0aGlzLmluY2x1c2l2ZSA9IGU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBUZSh0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdC5wb3NpdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByID0gZVtpXSwgbyA9IHQucG9zaXRpb25baV07XG4gICAgICAgIGlmIChyLmZpZWxkLmlzS2V5RmllbGQoKSkgcyA9IGN0LmNvbXBhcmF0b3IoY3QuZnJvbU5hbWUoby5yZWZlcmVuY2VWYWx1ZSksIG4ua2V5KTsgZWxzZSB7XG4gICAgICAgICAgICBzID0gaWUobywgbi5kYXRhLmZpZWxkKHIuZmllbGQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi8gPT09IHIuZGlyICYmIChzICo9IC0xKSwgMCAhPT0gcykgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBhIGRvY3VtZW50IHNvcnRzIGFmdGVyIGEgYm91bmQgdXNpbmcgdGhlIHByb3ZpZGVkIHNvcnRcbiAqIG9yZGVyLlxuICovIGZ1bmN0aW9uIEVlKHQsIGUpIHtcbiAgICBpZiAobnVsbCA9PT0gdCkgcmV0dXJuIG51bGwgPT09IGU7XG4gICAgaWYgKG51bGwgPT09IGUpIHJldHVybiAhMTtcbiAgICBpZiAodC5pbmNsdXNpdmUgIT09IGUuaW5jbHVzaXZlIHx8IHQucG9zaXRpb24ubGVuZ3RoICE9PSBlLnBvc2l0aW9uLmxlbmd0aCkgcmV0dXJuICExO1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgdC5wb3NpdGlvbi5sZW5ndGg7IG4rKykge1xuICAgICAgICBpZiAoIW5lKHQucG9zaXRpb25bbl0sIGUucG9zaXRpb25bbl0pKSByZXR1cm4gITE7XG4gICAgfVxuICAgIHJldHVybiAhMDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgQWUge31cblxuY2xhc3MgUmUgZXh0ZW5kcyBBZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpZWxkID0gdCwgdGhpcy5vcCA9IGUsIHRoaXMudmFsdWUgPSBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZmlsdGVyIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGUodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdC5pc0tleUZpZWxkKCkgPyBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IGUgfHwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gPT09IGUgPyB0aGlzLmNyZWF0ZUtleUZpZWxkSW5GaWx0ZXIodCwgZSwgbikgOiBuZXcga2UodCwgZSwgbikgOiBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IGUgPyBuZXcgJGUodCwgbikgOiBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IGUgPyBuZXcgQmUodCwgbikgOiBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA9PT0gZSA/IG5ldyBMZSh0LCBuKSA6IFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovID09PSBlID8gbmV3IHFlKHQsIG4pIDogbmV3IFJlKHQsIGUsIG4pO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlS2V5RmllbGRJbkZpbHRlcih0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IGUgPyBuZXcgT2UodCwgbikgOiBuZXcgTWUodCwgbik7XG4gICAgfVxuICAgIG1hdGNoZXModCkge1xuICAgICAgICBjb25zdCBlID0gdC5kYXRhLmZpZWxkKHRoaXMuZmllbGQpO1xuICAgICAgICAvLyBUeXBlcyBkbyBub3QgaGF2ZSB0byBtYXRjaCBpbiBOT1RfRVFVQUwgZmlsdGVycy5cbiAgICAgICAgICAgICAgICByZXR1cm4gXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA9PT0gdGhpcy5vcCA/IG51bGwgIT09IGUgJiYgdGhpcy5tYXRjaGVzQ29tcGFyaXNvbihpZShlLCB0aGlzLnZhbHVlKSkgOiBudWxsICE9PSBlICYmIGVlKHRoaXMudmFsdWUpID09PSBlZShlKSAmJiB0aGlzLm1hdGNoZXNDb21wYXJpc29uKGllKGUsIHRoaXMudmFsdWUpKTtcbiAgICAgICAgLy8gT25seSBjb21wYXJlIHR5cGVzIHdpdGggbWF0Y2hpbmcgYmFja2VuZCBvcmRlciAoc3VjaCBhcyBkb3VibGUgYW5kIGludCkuXG4gICAgICAgIH1cbiAgICBtYXRjaGVzQ29tcGFyaXNvbih0KSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5vcCkge1xuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICAgIHJldHVybiB0IDwgMDtcblxuICAgICAgICAgIGNhc2UgXCI8PVwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdCA8PSAwO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIDAgPT09IHQ7XG5cbiAgICAgICAgICBjYXNlIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIDAgIT09IHQ7XG5cbiAgICAgICAgICBjYXNlIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdCA+IDA7XG5cbiAgICAgICAgICBjYXNlIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHQgPj0gMDtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gTygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzSW5lcXVhbGl0eSgpIHtcbiAgICAgICAgcmV0dXJuIFsgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovICwgXCI8PVwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTl9PUl9FUVVBTCAqLyAsIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyAsIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gLCBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXS5pbmRleE9mKHRoaXMub3ApID49IDA7XG4gICAgfVxuICAgIGdldEZsYXR0ZW5lZEZpbHRlcnMoKSB7XG4gICAgICAgIHJldHVybiBbIHRoaXMgXTtcbiAgICB9XG4gICAgZ2V0RmlsdGVycygpIHtcbiAgICAgICAgcmV0dXJuIFsgdGhpcyBdO1xuICAgIH1cbiAgICBnZXRGaXJzdEluZXF1YWxpdHlGaWVsZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNJbmVxdWFsaXR5KCkgPyB0aGlzLmZpZWxkIDogbnVsbDtcbiAgICB9XG59XG5cbmNsYXNzIGJlIGV4dGVuZHMgQWUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maWx0ZXJzID0gdCwgdGhpcy5vcCA9IGUsIHRoaXMuaHQgPSBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZmlsdGVyIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGUodCwgZSkge1xuICAgICAgICByZXR1cm4gbmV3IGJlKHQsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgcmV0dXJuIFBlKHRoaXMpID8gdm9pZCAwID09PSB0aGlzLmZpbHRlcnMuZmluZCgoZSA9PiAhZS5tYXRjaGVzKHQpKSkgOiB2b2lkIDAgIT09IHRoaXMuZmlsdGVycy5maW5kKChlID0+IGUubWF0Y2hlcyh0KSkpO1xuICAgIH1cbiAgICBnZXRGbGF0dGVuZWRGaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5odCB8fCAodGhpcy5odCA9IHRoaXMuZmlsdGVycy5yZWR1Y2UoKCh0LCBlKSA9PiB0LmNvbmNhdChlLmdldEZsYXR0ZW5lZEZpbHRlcnMoKSkpLCBbXSkpLCBcbiAgICAgICAgdGhpcy5odDtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIG11dGFibGUgY29weSBvZiBgdGhpcy5maWx0ZXJzYFxuICAgIGdldEZpbHRlcnMoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKFtdLCB0aGlzLmZpbHRlcnMpO1xuICAgIH1cbiAgICBnZXRGaXJzdEluZXF1YWxpdHlGaWVsZCgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubHQoKHQgPT4gdC5pc0luZXF1YWxpdHkoKSkpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdCA/IHQuZmllbGQgOiBudWxsO1xuICAgIH1cbiAgICAvLyBQZXJmb3JtcyBhIGRlcHRoLWZpcnN0IHNlYXJjaCB0byBmaW5kIGFuZCByZXR1cm4gdGhlIGZpcnN0IEZpZWxkRmlsdGVyIGluIHRoZSBjb21wb3NpdGUgZmlsdGVyXG4gICAgLy8gdGhhdCBzYXRpc2ZpZXMgdGhlIHByZWRpY2F0ZS4gUmV0dXJucyBgbnVsbGAgaWYgbm9uZSBvZiB0aGUgRmllbGRGaWx0ZXJzIHNhdGlzZnkgdGhlXG4gICAgLy8gcHJlZGljYXRlLlxuICAgIGx0KHQpIHtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuZ2V0RmxhdHRlbmVkRmlsdGVycygpKSBpZiAodChlKSkgcmV0dXJuIGU7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gUGUodCkge1xuICAgIHJldHVybiBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyA9PT0gdC5vcDtcbn1cblxuZnVuY3Rpb24gdmUodCkge1xuICAgIHJldHVybiBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8gPT09IHQub3A7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgZmlsdGVyIGlzIGEgY29uanVuY3Rpb24gb2YgZmllbGQgZmlsdGVycyBvbmx5LiBSZXR1cm5zIGZhbHNlIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBWZSh0KSB7XG4gICAgcmV0dXJuIFNlKHQpICYmIFBlKHQpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpbHRlciBkb2VzIG5vdCBjb250YWluIGFueSBjb21wb3NpdGUgZmlsdGVycy4gUmV0dXJucyBmYWxzZSBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gU2UodCkge1xuICAgIGZvciAoY29uc3QgZSBvZiB0LmZpbHRlcnMpIGlmIChlIGluc3RhbmNlb2YgYmUpIHJldHVybiAhMTtcbiAgICByZXR1cm4gITA7XG59XG5cbmZ1bmN0aW9uIERlKHQpIHtcbiAgICBpZiAodCBpbnN0YW5jZW9mIFJlKSBcbiAgICAvLyBUT0RPKGIvMjkxODMxNjUpOiBUZWNobmljYWxseSwgdGhpcyB3b24ndCBiZSB1bmlxdWUgaWYgdHdvIHZhbHVlcyBoYXZlXG4gICAgLy8gdGhlIHNhbWUgZGVzY3JpcHRpb24sIHN1Y2ggYXMgdGhlIGludCAzIGFuZCB0aGUgc3RyaW5nIFwiM1wiLiBTbyB3ZSBzaG91bGRcbiAgICAvLyBhZGQgdGhlIHR5cGVzIGluIGhlcmUgc29tZWhvdywgdG9vLlxuICAgIHJldHVybiB0LmZpZWxkLmNhbm9uaWNhbFN0cmluZygpICsgdC5vcC50b1N0cmluZygpICsgb2UodC52YWx1ZSk7XG4gICAgaWYgKFZlKHQpKSBcbiAgICAvLyBPbGRlciBTREsgdmVyc2lvbnMgdXNlIGFuIGltcGxpY2l0IEFORCBvcGVyYXRpb24gYmV0d2VlbiB0aGVpciBmaWx0ZXJzLlxuICAgIC8vIEluIHRoZSBuZXcgU0RLIHZlcnNpb25zLCB0aGUgZGV2ZWxvcGVyIG1heSB1c2UgYW4gZXhwbGljaXQgQU5EIGZpbHRlci5cbiAgICAvLyBUbyBzdGF5IGNvbnNpc3RlbnQgd2l0aCB0aGUgb2xkIHVzYWdlcywgd2UgYWRkIGEgc3BlY2lhbCBjYXNlIHRvIGVuc3VyZVxuICAgIC8vIHRoZSBjYW5vbmljYWwgSUQgZm9yIHRoZXNlIHR3byBhcmUgdGhlIHNhbWUuIEZvciBleGFtcGxlOlxuICAgIC8vIGBjb2wud2hlcmVFcXVhbHMoXCJhXCIsIDEpLndoZXJlRXF1YWxzKFwiYlwiLCAyKWAgc2hvdWxkIGhhdmUgdGhlIHNhbWVcbiAgICAvLyBjYW5vbmljYWwgSUQgYXMgYGNvbC53aGVyZShhbmQoZXF1YWxzKFwiYVwiLDEpLCBlcXVhbHMoXCJiXCIsMikpKWAuXG4gICAgcmV0dXJuIHQuZmlsdGVycy5tYXAoKHQgPT4gRGUodCkpKS5qb2luKFwiLFwiKTtcbiAgICB7XG4gICAgICAgIC8vIGZpbHRlciBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlclxuICAgICAgICBjb25zdCBlID0gdC5maWx0ZXJzLm1hcCgodCA9PiBEZSh0KSkpLmpvaW4oXCIsXCIpO1xuICAgICAgICByZXR1cm4gYCR7dC5vcH0oJHtlfSlgO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gQ2UodCwgZSkge1xuICAgIHJldHVybiB0IGluc3RhbmNlb2YgUmUgPyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgUmUgJiYgdC5vcCA9PT0gZS5vcCAmJiB0LmZpZWxkLmlzRXF1YWwoZS5maWVsZCkgJiYgbmUodC52YWx1ZSwgZS52YWx1ZSk7XG4gICAgfSh0LCBlKSA6IHQgaW5zdGFuY2VvZiBiZSA/IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBiZSAmJiB0Lm9wID09PSBlLm9wICYmIHQuZmlsdGVycy5sZW5ndGggPT09IGUuZmlsdGVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiB0LmZpbHRlcnMucmVkdWNlKCgodCwgbiwgcykgPT4gdCAmJiBDZShuLCBlLmZpbHRlcnNbc10pKSwgITApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIGEgbmV3IGNvbXBvc2l0ZSBmaWx0ZXIgdGhhdCBjb250YWlucyBhbGwgZmlsdGVyIGZyb21cbiAqIGBjb21wb3NpdGVGaWx0ZXJgIHBsdXMgYWxsIHRoZSBnaXZlbiBmaWx0ZXJzIGluIGBvdGhlckZpbHRlcnNgLlxuICovICh0LCBlKSA6IHZvaWQgTygpO1xufVxuXG5mdW5jdGlvbiB4ZSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IHQuZmlsdGVycy5jb25jYXQoZSk7XG4gICAgcmV0dXJuIGJlLmNyZWF0ZShuLCB0Lm9wKTtcbn1cblxuLyoqIFJldHVybnMgYSBkZWJ1ZyBkZXNjcmlwdGlvbiBmb3IgYGZpbHRlcmAuICovIGZ1bmN0aW9uIE5lKHQpIHtcbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIFJlID8gZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gYCR7dC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKX0gJHt0Lm9wfSAke29lKHQudmFsdWUpfWA7XG4gICAgfVxuICAgIC8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgKGkuZS4gJ19fbmFtZV9fJykuICovICh0KSA6IHQgaW5zdGFuY2VvZiBiZSA/IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIHQub3AudG9TdHJpbmcoKSArIFwiIHtcIiArIHQuZ2V0RmlsdGVycygpLm1hcChOZSkuam9pbihcIiAsXCIpICsgXCJ9XCI7XG4gICAgfSh0KSA6IFwiRmlsdGVyXCI7XG59XG5cbmNsYXNzIGtlIGV4dGVuZHMgUmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIodCwgZSwgbiksIHRoaXMua2V5ID0gY3QuZnJvbU5hbWUobi5yZWZlcmVuY2VWYWx1ZSk7XG4gICAgfVxuICAgIG1hdGNoZXModCkge1xuICAgICAgICBjb25zdCBlID0gY3QuY29tcGFyYXRvcih0LmtleSwgdGhpcy5rZXkpO1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRjaGVzQ29tcGFyaXNvbihlKTtcbiAgICB9XG59XG5cbi8qKiBGaWx0ZXIgdGhhdCBtYXRjaGVzIG9uIGtleSBmaWVsZHMgd2l0aGluIGFuIGFycmF5LiAqLyBjbGFzcyBPZSBleHRlbmRzIFJlIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIGUpLCB0aGlzLmtleXMgPSBGZShcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCBlKTtcbiAgICB9XG4gICAgbWF0Y2hlcyh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtleXMuc29tZSgoZSA9PiBlLmlzRXF1YWwodC5rZXkpKSk7XG4gICAgfVxufVxuXG4vKiogRmlsdGVyIHRoYXQgbWF0Y2hlcyBvbiBrZXkgZmllbGRzIG5vdCBwcmVzZW50IHdpdGhpbiBhbiBhcnJheS4gKi8gY2xhc3MgTWUgZXh0ZW5kcyBSZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIGUpLCB0aGlzLmtleXMgPSBGZShcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLmtleXMuc29tZSgoZSA9PiBlLmlzRXF1YWwodC5rZXkpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBGZSh0LCBlKSB7XG4gICAgdmFyIG47XG4gICAgcmV0dXJuICgobnVsbCA9PT0gKG4gPSBlLmFycmF5VmFsdWUpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4udmFsdWVzKSB8fCBbXSkubWFwKCh0ID0+IGN0LmZyb21OYW1lKHQucmVmZXJlbmNlVmFsdWUpKSk7XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIGFycmF5LWNvbnRhaW5zIG9wZXJhdG9yLiAqLyBjbGFzcyAkZSBleHRlbmRzIFJlIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKHQsIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyAsIGUpO1xuICAgIH1cbiAgICBtYXRjaGVzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIGhlKGUpICYmIHNlKGUuYXJyYXlWYWx1ZSwgdGhpcy52YWx1ZSk7XG4gICAgfVxufVxuXG4vKiogQSBGaWx0ZXIgdGhhdCBpbXBsZW1lbnRzIHRoZSBJTiBvcGVyYXRvci4gKi8gY2xhc3MgQmUgZXh0ZW5kcyBSZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCBlKTtcbiAgICB9XG4gICAgbWF0Y2hlcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBlICYmIHNlKHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwgZSk7XG4gICAgfVxufVxuXG4vKiogQSBGaWx0ZXIgdGhhdCBpbXBsZW1lbnRzIHRoZSBub3QtaW4gb3BlcmF0b3IuICovIGNsYXNzIExlIGV4dGVuZHMgUmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gLCBlKTtcbiAgICB9XG4gICAgbWF0Y2hlcyh0KSB7XG4gICAgICAgIGlmIChzZSh0aGlzLnZhbHVlLmFycmF5VmFsdWUsIHtcbiAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgfSkpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZCh0aGlzLmZpZWxkKTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IGUgJiYgIXNlKHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwgZSk7XG4gICAgfVxufVxuXG4vKiogQSBGaWx0ZXIgdGhhdCBpbXBsZW1lbnRzIHRoZSBhcnJheS1jb250YWlucy1hbnkgb3BlcmF0b3IuICovIGNsYXNzIHFlIGV4dGVuZHMgUmUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gLCBlKTtcbiAgICB9XG4gICAgbWF0Y2hlcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiAhKCFoZShlKSB8fCAhZS5hcnJheVZhbHVlLnZhbHVlcykgJiYgZS5hcnJheVZhbHVlLnZhbHVlcy5zb21lKCh0ID0+IHNlKHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwgdCkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIG9yZGVyaW5nIG9uIGEgZmllbGQsIGluIHNvbWUgRGlyZWN0aW9uLiBEaXJlY3Rpb24gZGVmYXVsdHMgdG8gQVNDRU5ESU5HLlxuICovIGNsYXNzIFVlIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlID0gXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovKSB7XG4gICAgICAgIHRoaXMuZmllbGQgPSB0LCB0aGlzLmRpciA9IGU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBLZSh0LCBlKSB7XG4gICAgcmV0dXJuIHQuZGlyID09PSBlLmRpciAmJiB0LmZpZWxkLmlzRXF1YWwoZS5maWVsZCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBBbiBpbW11dGFibGUgc29ydGVkIG1hcCBpbXBsZW1lbnRhdGlvbiwgYmFzZWQgb24gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrXG4vLyB0cmVlLlxuY2xhc3MgR2Uge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5jb21wYXJhdG9yID0gdCwgdGhpcy5yb290ID0gZSB8fCBqZS5FTVBUWTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIG1hcCwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleS92YWx1ZSBhZGRlZCBvciByZXBsYWNlZC5cbiAgICBpbnNlcnQodCwgZSkge1xuICAgICAgICByZXR1cm4gbmV3IEdlKHRoaXMuY29tcGFyYXRvciwgdGhpcy5yb290Lmluc2VydCh0LCBlLCB0aGlzLmNvbXBhcmF0b3IpLmNvcHkobnVsbCwgbnVsbCwgamUuQkxBQ0ssIG51bGwsIG51bGwpKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIG1hcCwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLlxuICAgIHJlbW92ZSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgR2UodGhpcy5jb21wYXJhdG9yLCB0aGlzLnJvb3QucmVtb3ZlKHQsIHRoaXMuY29tcGFyYXRvcikuY29weShudWxsLCBudWxsLCBqZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbm9kZSB3aXRoIHRoZSBnaXZlbiBrZXksIG9yIG51bGwuXG4gICAgZ2V0KHQpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzLnJvb3Q7XG4gICAgICAgIGZvciAoOyFlLmlzRW1wdHkoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5jb21wYXJhdG9yKHQsIGUua2V5KTtcbiAgICAgICAgICAgIGlmICgwID09PSBuKSByZXR1cm4gZS52YWx1ZTtcbiAgICAgICAgICAgIG4gPCAwID8gZSA9IGUubGVmdCA6IG4gPiAwICYmIChlID0gZS5yaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IGluIHRoaXMgc29ydGVkIG1hcCwgb3IgLTEgaWYgaXQgZG9lc24ndFxuICAgIC8vIGV4aXN0LlxuICAgIGluZGV4T2YodCkge1xuICAgICAgICAvLyBOdW1iZXIgb2Ygbm9kZXMgdGhhdCB3ZXJlIHBydW5lZCB3aGVuIGRlc2NlbmRpbmcgcmlnaHRcbiAgICAgICAgbGV0IGUgPSAwLCBuID0gdGhpcy5yb290O1xuICAgICAgICBmb3IgKDshbi5pc0VtcHR5KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuY29tcGFyYXRvcih0LCBuLmtleSk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gcykgcmV0dXJuIGUgKyBuLmxlZnQuc2l6ZTtcbiAgICAgICAgICAgIHMgPCAwID8gbiA9IG4ubGVmdCA6IChcbiAgICAgICAgICAgIC8vIENvdW50IGFsbCBub2RlcyBsZWZ0IG9mIHRoZSBub2RlIHBsdXMgdGhlIG5vZGUgaXRzZWxmXG4gICAgICAgICAgICBlICs9IG4ubGVmdC5zaXplICsgMSwgbiA9IG4ucmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vZGUgbm90IGZvdW5kXG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSBtYXAuXG4gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3Quc2l6ZTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWluaW11bSBrZXkgaW4gdGhlIG1hcC5cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QubWluS2V5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1heGltdW0ga2V5IGluIHRoZSBtYXAuXG4gICAgbWF4S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Lm1heEtleSgpO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIG1hcCBpbiBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uXG4gICAgLy8gZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICBpbm9yZGVyVHJhdmVyc2FsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5pbm9yZGVyVHJhdmVyc2FsKHQpO1xuICAgIH1cbiAgICBmb3JFYWNoKHQpIHtcbiAgICAgICAgdGhpcy5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgbikgPT4gKHQoZSwgbiksICExKSkpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgbikgPT4gKHQucHVzaChgJHtlfToke259YCksICExKSkpLCBgeyR7dC5qb2luKFwiLCBcIil9fWA7XG4gICAgfVxuICAgIC8vIFRyYXZlcnNlcyB0aGUgbWFwIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvblxuICAgIC8vIGZ1bmN0aW9uIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLiBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXNcbiAgICAvLyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICByZXZlcnNlVHJhdmVyc2FsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5yZXZlcnNlVHJhdmVyc2FsKHQpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIFNvcnRlZE1hcC5cbiAgICBnZXRJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRZSh0aGlzLnJvb3QsIG51bGwsIHRoaXMuY29tcGFyYXRvciwgITEpO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvckZyb20odCkge1xuICAgICAgICByZXR1cm4gbmV3IFFlKHRoaXMucm9vdCwgdCwgdGhpcy5jb21wYXJhdG9yLCAhMSk7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRZSh0aGlzLnJvb3QsIG51bGwsIHRoaXMuY29tcGFyYXRvciwgITApO1xuICAgIH1cbiAgICBnZXRSZXZlcnNlSXRlcmF0b3JGcm9tKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRZSh0aGlzLnJvb3QsIHQsIHRoaXMuY29tcGFyYXRvciwgITApO1xuICAgIH1cbn1cblxuIC8vIGVuZCBTb3J0ZWRNYXBcbi8vIEFuIGl0ZXJhdG9yIG92ZXIgYW4gTExSQk5vZGUuXG5jbGFzcyBRZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLmlzUmV2ZXJzZSA9IHMsIHRoaXMubm9kZVN0YWNrID0gW107XG4gICAgICAgIGxldCBpID0gMTtcbiAgICAgICAgZm9yICg7IXQuaXNFbXB0eSgpOyApIGlmIChpID0gZSA/IG4odC5rZXksIGUpIDogMSwgXG4gICAgICAgIC8vIGZsaXAgdGhlIGNvbXBhcmlzb24gaWYgd2UncmUgZ29pbmcgaW4gcmV2ZXJzZVxuICAgICAgICBlICYmIHMgJiYgKGkgKj0gLTEpLCBpIDwgMCkgXG4gICAgICAgIC8vIFRoaXMgbm9kZSBpcyBsZXNzIHRoYW4gb3VyIHN0YXJ0IGtleS4gaWdub3JlIGl0XG4gICAgICAgIHQgPSB0aGlzLmlzUmV2ZXJzZSA/IHQubGVmdCA6IHQucmlnaHQ7IGVsc2Uge1xuICAgICAgICAgICAgaWYgKDAgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZXhhY3RseSBlcXVhbCB0byBvdXIgc3RhcnQga2V5LiBQdXNoIGl0IG9uIHRoZSBzdGFjayxcbiAgICAgICAgICAgICAgICAvLyBidXQgc3RvcCBpdGVyYXRpbmc7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlU3RhY2sucHVzaCh0KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoaXMgbm9kZSBpcyBncmVhdGVyIHRoYW4gb3VyIHN0YXJ0IGtleSwgYWRkIGl0IHRvIHRoZSBzdGFjayBhbmQgbW92ZVxuICAgICAgICAgICAgLy8gdG8gdGhlIG5leHQgb25lXG4gICAgICAgICAgICB0aGlzLm5vZGVTdGFjay5wdXNoKHQpLCB0ID0gdGhpcy5pc1JldmVyc2UgPyB0LnJpZ2h0IDogdC5sZWZ0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldE5leHQoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5ub2RlU3RhY2sucG9wKCk7XG4gICAgICAgIGNvbnN0IGUgPSB7XG4gICAgICAgICAgICBrZXk6IHQua2V5LFxuICAgICAgICAgICAgdmFsdWU6IHQudmFsdWVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuaXNSZXZlcnNlKSBmb3IgKHQgPSB0LmxlZnQ7ICF0LmlzRW1wdHkoKTsgKSB0aGlzLm5vZGVTdGFjay5wdXNoKHQpLCB0ID0gdC5yaWdodDsgZWxzZSBmb3IgKHQgPSB0LnJpZ2h0OyAhdC5pc0VtcHR5KCk7ICkgdGhpcy5ub2RlU3RhY2sucHVzaCh0KSwgXG4gICAgICAgIHQgPSB0LmxlZnQ7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICBoYXNOZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ub2RlU3RhY2subGVuZ3RoID4gMDtcbiAgICB9XG4gICAgcGVlaygpIHtcbiAgICAgICAgaWYgKDAgPT09IHRoaXMubm9kZVN0YWNrLmxlbmd0aCkgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLm5vZGVTdGFja1t0aGlzLm5vZGVTdGFjay5sZW5ndGggLSAxXTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtleTogdC5rZXksXG4gICAgICAgICAgICB2YWx1ZTogdC52YWx1ZVxuICAgICAgICB9O1xuICAgIH1cbn1cblxuIC8vIGVuZCBTb3J0ZWRNYXBJdGVyYXRvclxuLy8gUmVwcmVzZW50cyBhIG5vZGUgaW4gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrIHRyZWUuXG5jbGFzcyBqZSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLmtleSA9IHQsIHRoaXMudmFsdWUgPSBlLCB0aGlzLmNvbG9yID0gbnVsbCAhPSBuID8gbiA6IGplLlJFRCwgdGhpcy5sZWZ0ID0gbnVsbCAhPSBzID8gcyA6IGplLkVNUFRZLCBcbiAgICAgICAgdGhpcy5yaWdodCA9IG51bGwgIT0gaSA/IGkgOiBqZS5FTVBUWSwgdGhpcy5zaXplID0gdGhpcy5sZWZ0LnNpemUgKyAxICsgdGhpcy5yaWdodC5zaXplO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLCBvcHRpb25hbGx5IHJlcGxhY2luZyBwaWVjZXMgb2YgaXQuXG4gICAgY29weSh0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgIHJldHVybiBuZXcgamUobnVsbCAhPSB0ID8gdCA6IHRoaXMua2V5LCBudWxsICE9IGUgPyBlIDogdGhpcy52YWx1ZSwgbnVsbCAhPSBuID8gbiA6IHRoaXMuY29sb3IsIG51bGwgIT0gcyA/IHMgOiB0aGlzLmxlZnQsIG51bGwgIT0gaSA/IGkgOiB0aGlzLnJpZ2h0KTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIHRyZWUgaW4ga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvblxuICAgIC8vIGZvciBlYWNoIG5vZGUuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICBpbm9yZGVyVHJhdmVyc2FsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5pbm9yZGVyVHJhdmVyc2FsKHQpIHx8IHQodGhpcy5rZXksIHRoaXMudmFsdWUpIHx8IHRoaXMucmlnaHQuaW5vcmRlclRyYXZlcnNhbCh0KTtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRoZSB0cmVlIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvblxuICAgIC8vIGZ1bmN0aW9uIGZvciBlYWNoIG5vZGUuIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgIC8vIFJldHVybnMgdGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgIC8vIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvbi5cbiAgICByZXZlcnNlVHJhdmVyc2FsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQucmV2ZXJzZVRyYXZlcnNhbCh0KSB8fCB0KHRoaXMua2V5LCB0aGlzLnZhbHVlKSB8fCB0aGlzLmxlZnQucmV2ZXJzZVRyYXZlcnNhbCh0KTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWluaW11bSBub2RlIGluIHRoZSB0cmVlLlxuICAgIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5pc0VtcHR5KCkgPyB0aGlzIDogdGhpcy5sZWZ0Lm1pbigpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtYXhpbXVtIGtleSBpbiB0aGUgdHJlZS5cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1pbigpLmtleTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWF4aW11bSBrZXkgaW4gdGhlIHRyZWUuXG4gICAgbWF4S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5pc0VtcHR5KCkgPyB0aGlzLmtleSA6IHRoaXMucmlnaHQubWF4S2V5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUsIHdpdGggdGhlIGtleS92YWx1ZSBhZGRlZC5cbiAgICBpbnNlcnQodCwgZSwgbikge1xuICAgICAgICBsZXQgcyA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGkgPSBuKHQsIHMua2V5KTtcbiAgICAgICAgcmV0dXJuIHMgPSBpIDwgMCA/IHMuY29weShudWxsLCBudWxsLCBudWxsLCBzLmxlZnQuaW5zZXJ0KHQsIGUsIG4pLCBudWxsKSA6IDAgPT09IGkgPyBzLmNvcHkobnVsbCwgZSwgbnVsbCwgbnVsbCwgbnVsbCkgOiBzLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgcy5yaWdodC5pbnNlcnQodCwgZSwgbikpLCBcbiAgICAgICAgcy5maXhVcCgpO1xuICAgIH1cbiAgICByZW1vdmVNaW4oKSB7XG4gICAgICAgIGlmICh0aGlzLmxlZnQuaXNFbXB0eSgpKSByZXR1cm4gamUuRU1QVFk7XG4gICAgICAgIGxldCB0ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHQubGVmdC5pc1JlZCgpIHx8IHQubGVmdC5sZWZ0LmlzUmVkKCkgfHwgKHQgPSB0Lm1vdmVSZWRMZWZ0KCkpLCB0ID0gdC5jb3B5KG51bGwsIG51bGwsIG51bGwsIHQubGVmdC5yZW1vdmVNaW4oKSwgbnVsbCksIFxuICAgICAgICB0LmZpeFVwKCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBpdGVtIHJlbW92ZWQuXG4gICAgcmVtb3ZlKHQsIGUpIHtcbiAgICAgICAgbGV0IG4sIHMgPSB0aGlzO1xuICAgICAgICBpZiAoZSh0LCBzLmtleSkgPCAwKSBzLmxlZnQuaXNFbXB0eSgpIHx8IHMubGVmdC5pc1JlZCgpIHx8IHMubGVmdC5sZWZ0LmlzUmVkKCkgfHwgKHMgPSBzLm1vdmVSZWRMZWZ0KCkpLCBcbiAgICAgICAgcyA9IHMuY29weShudWxsLCBudWxsLCBudWxsLCBzLmxlZnQucmVtb3ZlKHQsIGUpLCBudWxsKTsgZWxzZSB7XG4gICAgICAgICAgICBpZiAocy5sZWZ0LmlzUmVkKCkgJiYgKHMgPSBzLnJvdGF0ZVJpZ2h0KCkpLCBzLnJpZ2h0LmlzRW1wdHkoKSB8fCBzLnJpZ2h0LmlzUmVkKCkgfHwgcy5yaWdodC5sZWZ0LmlzUmVkKCkgfHwgKHMgPSBzLm1vdmVSZWRSaWdodCgpKSwgXG4gICAgICAgICAgICAwID09PSBlKHQsIHMua2V5KSkge1xuICAgICAgICAgICAgICAgIGlmIChzLnJpZ2h0LmlzRW1wdHkoKSkgcmV0dXJuIGplLkVNUFRZO1xuICAgICAgICAgICAgICAgIG4gPSBzLnJpZ2h0Lm1pbigpLCBzID0gcy5jb3B5KG4ua2V5LCBuLnZhbHVlLCBudWxsLCBudWxsLCBzLnJpZ2h0LnJlbW92ZU1pbigpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHMgPSBzLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgcy5yaWdodC5yZW1vdmUodCwgZSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzLmZpeFVwKCk7XG4gICAgfVxuICAgIGlzUmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvcjtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBuZXcgdHJlZSBhZnRlciBwZXJmb3JtaW5nIGFueSBuZWVkZWQgcm90YXRpb25zLlxuICAgIGZpeFVwKCkge1xuICAgICAgICBsZXQgdCA9IHRoaXM7XG4gICAgICAgIHJldHVybiB0LnJpZ2h0LmlzUmVkKCkgJiYgIXQubGVmdC5pc1JlZCgpICYmICh0ID0gdC5yb3RhdGVMZWZ0KCkpLCB0LmxlZnQuaXNSZWQoKSAmJiB0LmxlZnQubGVmdC5pc1JlZCgpICYmICh0ID0gdC5yb3RhdGVSaWdodCgpKSwgXG4gICAgICAgIHQubGVmdC5pc1JlZCgpICYmIHQucmlnaHQuaXNSZWQoKSAmJiAodCA9IHQuY29sb3JGbGlwKCkpLCB0O1xuICAgIH1cbiAgICBtb3ZlUmVkTGVmdCgpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzLmNvbG9yRmxpcCgpO1xuICAgICAgICByZXR1cm4gdC5yaWdodC5sZWZ0LmlzUmVkKCkgJiYgKHQgPSB0LmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgdC5yaWdodC5yb3RhdGVSaWdodCgpKSwgXG4gICAgICAgIHQgPSB0LnJvdGF0ZUxlZnQoKSwgdCA9IHQuY29sb3JGbGlwKCkpLCB0O1xuICAgIH1cbiAgICBtb3ZlUmVkUmlnaHQoKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5jb2xvckZsaXAoKTtcbiAgICAgICAgcmV0dXJuIHQubGVmdC5sZWZ0LmlzUmVkKCkgJiYgKHQgPSB0LnJvdGF0ZVJpZ2h0KCksIHQgPSB0LmNvbG9yRmxpcCgpKSwgdDtcbiAgICB9XG4gICAgcm90YXRlTGVmdCgpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuY29weShudWxsLCBudWxsLCBqZS5SRUQsIG51bGwsIHRoaXMucmlnaHQubGVmdCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgdCwgbnVsbCk7XG4gICAgfVxuICAgIHJvdGF0ZVJpZ2h0KCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jb3B5KG51bGwsIG51bGwsIGplLlJFRCwgdGhpcy5sZWZ0LnJpZ2h0LCBudWxsKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5jb3B5KG51bGwsIG51bGwsIHRoaXMuY29sb3IsIG51bGwsIHQpO1xuICAgIH1cbiAgICBjb2xvckZsaXAoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCAhdGhpcy5sZWZ0LmNvbG9yLCBudWxsLCBudWxsKSwgZSA9IHRoaXMucmlnaHQuY29weShudWxsLCBudWxsLCAhdGhpcy5yaWdodC5jb2xvciwgbnVsbCwgbnVsbCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNvcHkobnVsbCwgbnVsbCwgIXRoaXMuY29sb3IsIHQsIGUpO1xuICAgIH1cbiAgICAvLyBGb3IgdGVzdGluZy5cbiAgICBjaGVja01heERlcHRoKCkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jaGVjaygpO1xuICAgICAgICByZXR1cm4gTWF0aC5wb3coMiwgdCkgPD0gdGhpcy5zaXplICsgMTtcbiAgICB9XG4gICAgLy8gSW4gYSBiYWxhbmNlZCBSQiB0cmVlLCB0aGUgYmxhY2stZGVwdGggKG51bWJlciBvZiBibGFjayBub2RlcykgZnJvbSByb290IHRvXG4gICAgLy8gbGVhdmVzIGlzIGVxdWFsIG9uIGJvdGggc2lkZXMuICBUaGlzIGZ1bmN0aW9uIHZlcmlmaWVzIHRoYXQgb3IgYXNzZXJ0cy5cbiAgICBjaGVjaygpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNSZWQoKSAmJiB0aGlzLmxlZnQuaXNSZWQoKSkgdGhyb3cgTygpO1xuICAgICAgICBpZiAodGhpcy5yaWdodC5pc1JlZCgpKSB0aHJvdyBPKCk7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmxlZnQuY2hlY2soKTtcbiAgICAgICAgaWYgKHQgIT09IHRoaXMucmlnaHQuY2hlY2soKSkgdGhyb3cgTygpO1xuICAgICAgICByZXR1cm4gdCArICh0aGlzLmlzUmVkKCkgPyAwIDogMSk7XG4gICAgfVxufVxuXG4gLy8gZW5kIExMUkJOb2RlXG4vLyBFbXB0eSBub2RlIGlzIHNoYXJlZCBiZXR3ZWVuIGFsbCBMTFJCIHRyZWVzLlxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmplLkVNUFRZID0gbnVsbCwgamUuUkVEID0gITAsIGplLkJMQUNLID0gITE7XG5cbi8vIGVuZCBMTFJCRW1wdHlOb2RlXG5qZS5FTVBUWSA9IG5ldyBcbi8vIFJlcHJlc2VudHMgYW4gZW1wdHkgbm9kZSAoYSBsZWFmIG5vZGUgaW4gdGhlIFJlZC1CbGFjayBUcmVlKS5cbmNsYXNzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5zaXplID0gMDtcbiAgICB9XG4gICAgZ2V0IGtleSgpIHtcbiAgICAgICAgdGhyb3cgTygpO1xuICAgIH1cbiAgICBnZXQgdmFsdWUoKSB7XG4gICAgICAgIHRocm93IE8oKTtcbiAgICB9XG4gICAgZ2V0IGNvbG9yKCkge1xuICAgICAgICB0aHJvdyBPKCk7XG4gICAgfVxuICAgIGdldCBsZWZ0KCkge1xuICAgICAgICB0aHJvdyBPKCk7XG4gICAgfVxuICAgIGdldCByaWdodCgpIHtcbiAgICAgICAgdGhyb3cgTygpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLlxuICAgIGNvcHkodCwgZSwgbiwgcywgaSkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQuXG4gICAgaW5zZXJ0KHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBqZSh0LCBlKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkgcmVtb3ZlZC5cbiAgICByZW1vdmUodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBpbm9yZGVyVHJhdmVyc2FsKHQpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICByZXZlcnNlVHJhdmVyc2FsKHQpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBtYXhLZXkoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpc1JlZCgpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvLyBGb3IgdGVzdGluZy5cbiAgICBjaGVja01heERlcHRoKCkge1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGNoZWNrKCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTb3J0ZWRTZXQgaXMgYW4gaW1tdXRhYmxlIChjb3B5LW9uLXdyaXRlKSBjb2xsZWN0aW9uIHRoYXQgaG9sZHMgZWxlbWVudHNcbiAqIGluIG9yZGVyIHNwZWNpZmllZCBieSB0aGUgcHJvdmlkZWQgY29tcGFyYXRvci5cbiAqXG4gKiBOT1RFOiBpZiBwcm92aWRlZCBjb21wYXJhdG9yIHJldHVybnMgMCBmb3IgdHdvIGVsZW1lbnRzLCB3ZSBjb25zaWRlciB0aGVtIHRvXG4gKiBiZSBlcXVhbCFcbiAqL1xuY2xhc3MgV2Uge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5jb21wYXJhdG9yID0gdCwgdGhpcy5kYXRhID0gbmV3IEdlKHRoaXMuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIGhhcyh0KSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLmRhdGEuZ2V0KHQpO1xuICAgIH1cbiAgICBmaXJzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5taW5LZXkoKTtcbiAgICB9XG4gICAgbGFzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5tYXhLZXkoKTtcbiAgICB9XG4gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuc2l6ZTtcbiAgICB9XG4gICAgaW5kZXhPZih0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRhdGEuaW5kZXhPZih0KTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIGVsZW1lbnRzIGluIG9yZGVyIGRlZmluZWQgYnkgXCJjb21wYXJhdG9yXCIgKi8gICAgZm9yRWFjaCh0KSB7XG4gICAgICAgIHRoaXMuZGF0YS5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgbikgPT4gKHQoZSksICExKSkpO1xuICAgIH1cbiAgICAvKiogSXRlcmF0ZXMgb3ZlciBgZWxlbWBzIHN1Y2ggdGhhdDogcmFuZ2VbMF0gJmx0Oz0gZWxlbSAmbHQ7IHJhbmdlWzFdLiAqLyAgICBmb3JFYWNoSW5SYW5nZSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmRhdGEuZ2V0SXRlcmF0b3JGcm9tKHRbMF0pO1xuICAgICAgICBmb3IgKDtuLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gbi5nZXROZXh0KCk7XG4gICAgICAgICAgICBpZiAodGhpcy5jb21wYXJhdG9yKHMua2V5LCB0WzFdKSA+PSAwKSByZXR1cm47XG4gICAgICAgICAgICBlKHMua2V5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBJdGVyYXRlcyBvdmVyIGBlbGVtYHMgc3VjaCB0aGF0OiBzdGFydCAmbHQ7PSBlbGVtIHVudGlsIGZhbHNlIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBmb3JFYWNoV2hpbGUodCwgZSkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgZm9yIChuID0gdm9pZCAwICE9PSBlID8gdGhpcy5kYXRhLmdldEl0ZXJhdG9yRnJvbShlKSA6IHRoaXMuZGF0YS5nZXRJdGVyYXRvcigpOyBuLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBpZiAoIXQobi5nZXROZXh0KCkua2V5KSkgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBGaW5kcyB0aGUgbGVhc3QgZWxlbWVudCBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gYGVsZW1gLiAqLyAgICBmaXJzdEFmdGVyT3JFcXVhbCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmRhdGEuZ2V0SXRlcmF0b3JGcm9tKHQpO1xuICAgICAgICByZXR1cm4gZS5oYXNOZXh0KCkgPyBlLmdldE5leHQoKS5rZXkgOiBudWxsO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB6ZSh0aGlzLmRhdGEuZ2V0SXRlcmF0b3IoKSk7XG4gICAgfVxuICAgIGdldEl0ZXJhdG9yRnJvbSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgemUodGhpcy5kYXRhLmdldEl0ZXJhdG9yRnJvbSh0KSk7XG4gICAgfVxuICAgIC8qKiBJbnNlcnRzIG9yIHVwZGF0ZXMgYW4gZWxlbWVudCAqLyAgICBhZGQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb3B5KHRoaXMuZGF0YS5yZW1vdmUodCkuaW5zZXJ0KHQsICEwKSk7XG4gICAgfVxuICAgIC8qKiBEZWxldGVzIGFuIGVsZW1lbnQgKi8gICAgZGVsZXRlKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzKHQpID8gdGhpcy5jb3B5KHRoaXMuZGF0YS5yZW1vdmUodCkpIDogdGhpcztcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5pc0VtcHR5KCk7XG4gICAgfVxuICAgIHVuaW9uV2l0aCh0KSB7XG4gICAgICAgIGxldCBlID0gdGhpcztcbiAgICAgICAgLy8gTWFrZSBzdXJlIGByZXN1bHRgIGFsd2F5cyByZWZlcnMgdG8gdGhlIGxhcmdlciBvbmUgb2YgdGhlIHR3byBzZXRzLlxuICAgICAgICAgICAgICAgIHJldHVybiBlLnNpemUgPCB0LnNpemUgJiYgKGUgPSB0LCB0ID0gdGhpcyksIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlID0gZS5hZGQodCk7XG4gICAgICAgIH0pKSwgZTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIGlmICghKHQgaW5zdGFuY2VvZiBXZSkpIHJldHVybiAhMTtcbiAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gdC5zaXplKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmRhdGEuZ2V0SXRlcmF0b3IoKSwgbiA9IHQuZGF0YS5nZXRJdGVyYXRvcigpO1xuICAgICAgICBmb3IgKDtlLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5nZXROZXh0KCkua2V5LCBzID0gbi5nZXROZXh0KCkua2V5O1xuICAgICAgICAgICAgaWYgKDAgIT09IHRoaXMuY29tcGFyYXRvcih0LCBzKSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgdG9BcnJheSgpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQucHVzaChlKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKChlID0+IHQucHVzaChlKSkpLCBcIlNvcnRlZFNldChcIiArIHQudG9TdHJpbmcoKSArIFwiKVwiO1xuICAgIH1cbiAgICBjb3B5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBXZSh0aGlzLmNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gZS5kYXRhID0gdCwgZTtcbiAgICB9XG59XG5cbmNsYXNzIHplIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuaXRlciA9IHQ7XG4gICAgfVxuICAgIGdldE5leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZXIuZ2V0TmV4dCgpLmtleTtcbiAgICB9XG4gICAgaGFzTmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlci5oYXNOZXh0KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbXBhcmVzIHR3byBzb3J0ZWQgc2V0cyBmb3IgZXF1YWxpdHkgdXNpbmcgdGhlaXIgbmF0dXJhbCBvcmRlcmluZy4gVGhlXG4gKiBtZXRob2QgY29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBhbmQgaW52b2tlcyBgb25BZGRgIGZvciBldmVyeSBlbGVtZW50IHRoYXRcbiAqIGlzIGluIGBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC4gYG9uUmVtb3ZlYCBpcyBpbnZva2VkIGZvciBldmVyeSBlbGVtZW50IGluXG4gKiBgYmVmb3JlYCBidXQgbWlzc2luZyBmcm9tIGBhZnRlcmAuXG4gKlxuICogVGhlIG1ldGhvZCBjcmVhdGVzIGEgY29weSBvZiBib3RoIGBiZWZvcmVgIGFuZCBgYWZ0ZXJgIGFuZCBydW5zIGluIE8obiBsb2dcbiAqIG4pLCB3aGVyZSBuIGlzIHRoZSBzaXplIG9mIHRoZSB0d28gbGlzdHMuXG4gKlxuICogQHBhcmFtIGJlZm9yZSAtIFRoZSBlbGVtZW50cyB0aGF0IGV4aXN0IGluIHRoZSBvcmlnaW5hbCBzZXQuXG4gKiBAcGFyYW0gYWZ0ZXIgLSBUaGUgZWxlbWVudHMgdG8gZGlmZiBhZ2FpbnN0IHRoZSBvcmlnaW5hbCBzZXQuXG4gKiBAcGFyYW0gY29tcGFyYXRvciAtIFRoZSBjb21wYXJhdG9yIGZvciB0aGUgZWxlbWVudHMgaW4gYmVmb3JlIGFuZCBhZnRlci5cbiAqIEBwYXJhbSBvbkFkZCAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZiBgXG4gKiBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC5cbiAqIEBwYXJhbSBvblJlbW92ZSAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZlxuICogYGJlZm9yZWAgYnV0IG5vdCBgYWZ0ZXJgLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIG5leHQgZWxlbWVudCBmcm9tIHRoZSBpdGVyYXRvciBvciBgdW5kZWZpbmVkYCBpZiBub25lIGF2YWlsYWJsZS5cbiAqL1xuZnVuY3Rpb24gSGUodCkge1xuICAgIHJldHVybiB0Lmhhc05leHQoKSA/IHQuZ2V0TmV4dCgpIDogdm9pZCAwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlcyBhIHNldCBvZiBmaWVsZHMgdGhhdCBjYW4gYmUgdXNlZCB0byBwYXJ0aWFsbHkgcGF0Y2ggYSBkb2N1bWVudC5cbiAqIEZpZWxkTWFzayBpcyB1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGggT2JqZWN0VmFsdWUuXG4gKiBFeGFtcGxlczpcbiAqICAgZm9vIC0gT3ZlcndyaXRlcyBmb28gZW50aXJlbHkgd2l0aCB0aGUgcHJvdmlkZWQgdmFsdWUuIElmIGZvbyBpcyBub3RcbiAqICAgICAgICAgcHJlc2VudCBpbiB0aGUgY29tcGFuaW9uIE9iamVjdFZhbHVlLCB0aGUgZmllbGQgaXMgZGVsZXRlZC5cbiAqICAgZm9vLmJhciAtIE92ZXJ3cml0ZXMgb25seSB0aGUgZmllbGQgYmFyIG9mIHRoZSBvYmplY3QgZm9vLlxuICogICAgICAgICAgICAgSWYgZm9vIGlzIG5vdCBhbiBvYmplY3QsIGZvbyBpcyByZXBsYWNlZCB3aXRoIGFuIG9iamVjdFxuICogICAgICAgICAgICAgY29udGFpbmluZyBmb29cbiAqLyBjbGFzcyBKZSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmZpZWxkcyA9IHQsIFxuICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IHZhbGlkYXRpb24gb2YgRmllbGRNYXNrXG4gICAgICAgIC8vIFNvcnQgdGhlIGZpZWxkIG1hc2sgdG8gc3VwcG9ydCBgRmllbGRNYXNrLmlzRXF1YWwoKWAgYW5kIGFzc2VydCBiZWxvdy5cbiAgICAgICAgdC5zb3J0KHV0LmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgSmUoW10pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgbmV3IEZpZWxkTWFzayBvYmplY3QgdGhhdCBpcyB0aGUgcmVzdWx0IG9mIGFkZGluZyBhbGwgdGhlIGdpdmVuXG4gICAgICogZmllbGRzIHBhdGhzIHRvIHRoaXMgZmllbGQgbWFzay5cbiAgICAgKi8gICAgdW5pb25XaXRoKHQpIHtcbiAgICAgICAgbGV0IGUgPSBuZXcgV2UodXQuY29tcGFyYXRvcik7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLmZpZWxkcykgZSA9IGUuYWRkKHQpO1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdCkgZSA9IGUuYWRkKG4pO1xuICAgICAgICByZXR1cm4gbmV3IEplKGUudG9BcnJheSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmVyaWZpZXMgdGhhdCBgZmllbGRQYXRoYCBpcyBpbmNsdWRlZCBieSBhdCBsZWFzdCBvbmUgZmllbGQgaW4gdGhpcyBmaWVsZFxuICAgICAqIG1hc2suXG4gICAgICpcbiAgICAgKiBUaGlzIGlzIGFuIE8obikgb3BlcmF0aW9uLCB3aGVyZSBgbmAgaXMgdGhlIHNpemUgb2YgdGhlIGZpZWxkIG1hc2suXG4gICAgICovICAgIGNvdmVycyh0KSB7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLmZpZWxkcykgaWYgKGUuaXNQcmVmaXhPZih0KSkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gdHQodGhpcy5maWVsZHMsIHQuZmllbGRzLCAoKHQsIGUpID0+IHQuaXNFcXVhbChlKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gT2JqZWN0VmFsdWUgcmVwcmVzZW50cyBhIE1hcFZhbHVlIGluIHRoZSBGaXJlc3RvcmUgUHJvdG8gYW5kIG9mZmVycyB0aGVcbiAqIGFiaWxpdHkgdG8gYWRkIGFuZCByZW1vdmUgZmllbGRzICh2aWEgdGhlIE9iamVjdFZhbHVlQnVpbGRlcikuXG4gKi8gY2xhc3MgWWUge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBZZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge31cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHZhbHVlIGF0IHRoZSBnaXZlbiBwYXRoIG9yIG51bGwuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCAtIHRoZSBwYXRoIHRvIHNlYXJjaFxuICAgICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBhdCB0aGUgcGF0aCBvciBudWxsIGlmIHRoZSBwYXRoIGlzIG5vdCBzZXQuXG4gICAgICovICAgIGZpZWxkKHQpIHtcbiAgICAgICAgaWYgKHQuaXNFbXB0eSgpKSByZXR1cm4gdGhpcy52YWx1ZTtcbiAgICAgICAge1xuICAgICAgICAgICAgbGV0IGUgPSB0aGlzLnZhbHVlO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lmxlbmd0aCAtIDE7ICsrbikgaWYgKGUgPSAoZS5tYXBWYWx1ZS5maWVsZHMgfHwge30pW3QuZ2V0KG4pXSwgXG4gICAgICAgICAgICAhZGUoZSkpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgcmV0dXJuIGUgPSAoZS5tYXBWYWx1ZS5maWVsZHMgfHwge30pW3QubGFzdFNlZ21lbnQoKV0sIGUgfHwgbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBmaWVsZCB0byB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCAtIFRoZSBmaWVsZCBwYXRoIHRvIHNldC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LlxuICAgICAqLyAgICBzZXQodCwgZSkge1xuICAgICAgICB0aGlzLmdldEZpZWxkc01hcCh0LnBvcExhc3QoKSlbdC5sYXN0U2VnbWVudCgpXSA9IF9lKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBwcm92aWRlZCBmaWVsZHMgdG8gdGhlIHByb3ZpZGVkIHZhbHVlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYXRhIC0gQSBtYXAgb2YgZmllbGRzIHRvIHZhbHVlcyAob3IgbnVsbCBmb3IgZGVsZXRlcykuXG4gICAgICovICAgIHNldEFsbCh0KSB7XG4gICAgICAgIGxldCBlID0gdXQuZW1wdHlQYXRoKCksIG4gPSB7fSwgcyA9IFtdO1xuICAgICAgICB0LmZvckVhY2goKCh0LCBpKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWUuaXNJbW1lZGlhdGVQYXJlbnRPZihpKSkge1xuICAgICAgICAgICAgICAgIC8vIEluc2VydCB0aGUgYWNjdW11bGF0ZWQgY2hhbmdlcyBhdCB0aGlzIHBhcmVudCBsb2NhdGlvblxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLmdldEZpZWxkc01hcChlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5Q2hhbmdlcyh0LCBuLCBzKSwgbiA9IHt9LCBzID0gW10sIGUgPSBpLnBvcExhc3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHQgPyBuW2kubGFzdFNlZ21lbnQoKV0gPSBfZSh0KSA6IHMucHVzaChpLmxhc3RTZWdtZW50KCkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLmdldEZpZWxkc01hcChlKTtcbiAgICAgICAgdGhpcy5hcHBseUNoYW5nZXMoaSwgbiwgcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIGZpZWxkIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4gSWYgdGhlcmUgaXMgbm8gZmllbGQgYXQgdGhlXG4gICAgICogc3BlY2lmaWVkIHBhdGgsIG5vdGhpbmcgaXMgY2hhbmdlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gVGhlIGZpZWxkIHBhdGggdG8gcmVtb3ZlLlxuICAgICAqLyAgICBkZWxldGUodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5maWVsZCh0LnBvcExhc3QoKSk7XG4gICAgICAgIGRlKGUpICYmIGUubWFwVmFsdWUuZmllbGRzICYmIGRlbGV0ZSBlLm1hcFZhbHVlLmZpZWxkc1t0Lmxhc3RTZWdtZW50KCldO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIG5lKHRoaXMudmFsdWUsIHQudmFsdWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBtYXAgdGhhdCBjb250YWlucyB0aGUgbGVhZiBlbGVtZW50IG9mIGBwYXRoYC4gSWYgdGhlIHBhcmVudFxuICAgICAqIGVudHJ5IGRvZXMgbm90IHlldCBleGlzdCwgb3IgaWYgaXQgaXMgbm90IGEgbWFwLCBhIG5ldyBtYXAgd2lsbCBiZSBjcmVhdGVkLlxuICAgICAqLyAgICBnZXRGaWVsZHNNYXAodCkge1xuICAgICAgICBsZXQgZSA9IHRoaXMudmFsdWU7XG4gICAgICAgIGUubWFwVmFsdWUuZmllbGRzIHx8IChlLm1hcFZhbHVlID0ge1xuICAgICAgICAgICAgZmllbGRzOiB7fVxuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgKytuKSB7XG4gICAgICAgICAgICBsZXQgcyA9IGUubWFwVmFsdWUuZmllbGRzW3QuZ2V0KG4pXTtcbiAgICAgICAgICAgIGRlKHMpICYmIHMubWFwVmFsdWUuZmllbGRzIHx8IChzID0ge1xuICAgICAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkczoge31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBlLm1hcFZhbHVlLmZpZWxkc1t0LmdldChuKV0gPSBzKSwgZSA9IHM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGUubWFwVmFsdWUuZmllbGRzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNb2RpZmllcyBgZmllbGRzTWFwYCBieSBhZGRpbmcsIHJlcGxhY2luZyBvciBkZWxldGluZyB0aGUgc3BlY2lmaWVkXG4gICAgICogZW50cmllcy5cbiAgICAgKi8gICAgYXBwbHlDaGFuZ2VzKHQsIGUsIG4pIHtcbiAgICAgICAgQnQoZSwgKChlLCBuKSA9PiB0W2VdID0gbikpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbikgZGVsZXRlIHRbZV07XG4gICAgfVxuICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IFllKF9lKHRoaXMudmFsdWUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIEZpZWxkTWFzayBidWlsdCBmcm9tIGFsbCBmaWVsZHMgaW4gYSBNYXBWYWx1ZS5cbiAqLyBmdW5jdGlvbiBYZSh0KSB7XG4gICAgY29uc3QgZSA9IFtdO1xuICAgIHJldHVybiBCdCh0LmZpZWxkcywgKCh0LCBuKSA9PiB7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgdXQoWyB0IF0pO1xuICAgICAgICBpZiAoZGUobikpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBYZShuLm1hcFZhbHVlKS5maWVsZHM7XG4gICAgICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIFxuICAgICAgICAgICAgLy8gUHJlc2VydmUgdGhlIGVtcHR5IG1hcCBieSBhZGRpbmcgaXQgdG8gdGhlIEZpZWxkTWFzay5cbiAgICAgICAgICAgIGUucHVzaChzKTsgZWxzZSBcbiAgICAgICAgICAgIC8vIEZvciBuZXN0ZWQgYW5kIG5vbi1lbXB0eSBPYmplY3RWYWx1ZXMsIGFkZCB0aGUgRmllbGRQYXRoIG9mIHRoZVxuICAgICAgICAgICAgLy8gbGVhZiBub2Rlcy5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB0KSBlLnB1c2gocy5jaGlsZChuKSk7XG4gICAgICAgIH0gZWxzZSBcbiAgICAgICAgLy8gRm9yIG5lc3RlZCBhbmQgbm9uLWVtcHR5IE9iamVjdFZhbHVlcywgYWRkIHRoZSBGaWVsZFBhdGggb2YgdGhlIGxlYWZcbiAgICAgICAgLy8gbm9kZXMuXG4gICAgICAgIGUucHVzaChzKTtcbiAgICB9KSksIG5ldyBKZShlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGRvY3VtZW50IGluIEZpcmVzdG9yZSB3aXRoIGEga2V5LCB2ZXJzaW9uLCBkYXRhIGFuZCB3aGV0aGVyIGl0XG4gKiBoYXMgbG9jYWwgbXV0YXRpb25zIGFwcGxpZWQgdG8gaXQuXG4gKlxuICogRG9jdW1lbnRzIGNhbiB0cmFuc2l0aW9uIGJldHdlZW4gc3RhdGVzIHZpYSBgY29udmVydFRvRm91bmREb2N1bWVudCgpYCxcbiAqIGBjb252ZXJ0VG9Ob0RvY3VtZW50KClgIGFuZCBgY29udmVydFRvVW5rbm93bkRvY3VtZW50KClgLiBJZiBhIGRvY3VtZW50IGRvZXNcbiAqIG5vdCB0cmFuc2l0aW9uIHRvIG9uZSBvZiB0aGVzZSBzdGF0ZXMgZXZlbiBhZnRlciBhbGwgbXV0YXRpb25zIGhhdmUgYmVlblxuICogYXBwbGllZCwgYGlzVmFsaWREb2N1bWVudCgpYCByZXR1cm5zIGZhbHNlIGFuZCB0aGUgZG9jdW1lbnQgc2hvdWxkIGJlIHJlbW92ZWRcbiAqIGZyb20gYWxsIHZpZXdzLlxuICovIGNsYXNzIFplIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByLCBvKSB7XG4gICAgICAgIHRoaXMua2V5ID0gdCwgdGhpcy5kb2N1bWVudFR5cGUgPSBlLCB0aGlzLnZlcnNpb24gPSBuLCB0aGlzLnJlYWRUaW1lID0gcywgdGhpcy5jcmVhdGVUaW1lID0gaSwgXG4gICAgICAgIHRoaXMuZGF0YSA9IHIsIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBkb2N1bWVudCB3aXRoIG5vIGtub3duIHZlcnNpb24gb3IgZGF0YSwgYnV0IHdoaWNoIGNhbiBzZXJ2ZSBhc1xuICAgICAqIGJhc2UgZG9jdW1lbnQgZm9yIG11dGF0aW9ucy5cbiAgICAgKi8gICAgc3RhdGljIG5ld0ludmFsaWREb2N1bWVudCh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgWmUodCwgMCAvKiBEb2N1bWVudFR5cGUuSU5WQUxJRCAqLyAsIFxuICAgICAgICAvKiB2ZXJzaW9uICovIHN0Lm1pbigpLCBcbiAgICAgICAgLyogcmVhZFRpbWUgKi8gc3QubWluKCksIFxuICAgICAgICAvKiBjcmVhdGVUaW1lICovIHN0Lm1pbigpLCBZZS5lbXB0eSgpLCAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBkb2N1bWVudCB0aGF0IGlzIGtub3duIHRvIGV4aXN0IHdpdGggdGhlIGdpdmVuIGRhdGEgYXQgdGhlXG4gICAgICogZ2l2ZW4gdmVyc2lvbi5cbiAgICAgKi8gICAgc3RhdGljIG5ld0ZvdW5kRG9jdW1lbnQodCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gbmV3IFplKHQsIDEgLyogRG9jdW1lbnRUeXBlLkZPVU5EX0RPQ1VNRU5UICovICwgXG4gICAgICAgIC8qIHZlcnNpb24gKi8gZSwgXG4gICAgICAgIC8qIHJlYWRUaW1lICovIHN0Lm1pbigpLCBcbiAgICAgICAgLyogY3JlYXRlVGltZSAqLyBuLCBzLCAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovKTtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgZG9jdW1lbnQgdGhhdCBpcyBrbm93biB0byBub3QgZXhpc3QgYXQgdGhlIGdpdmVuIHZlcnNpb24uICovICAgIHN0YXRpYyBuZXdOb0RvY3VtZW50KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBaZSh0LCAyIC8qIERvY3VtZW50VHlwZS5OT19ET0NVTUVOVCAqLyAsIFxuICAgICAgICAvKiB2ZXJzaW9uICovIGUsIFxuICAgICAgICAvKiByZWFkVGltZSAqLyBzdC5taW4oKSwgXG4gICAgICAgIC8qIGNyZWF0ZVRpbWUgKi8gc3QubWluKCksIFllLmVtcHR5KCksIDAgLyogRG9jdW1lbnRTdGF0ZS5TWU5DRUQgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGRvY3VtZW50IHRoYXQgaXMga25vd24gdG8gZXhpc3QgYXQgdGhlIGdpdmVuIHZlcnNpb24gYnV0XG4gICAgICogd2hvc2UgZGF0YSBpcyBub3Qga25vd24gKGUuZy4gYSBkb2N1bWVudCB0aGF0IHdhcyB1cGRhdGVkIHdpdGhvdXQgYSBrbm93blxuICAgICAqIGJhc2UgZG9jdW1lbnQpLlxuICAgICAqLyAgICBzdGF0aWMgbmV3VW5rbm93bkRvY3VtZW50KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBaZSh0LCAzIC8qIERvY3VtZW50VHlwZS5VTktOT1dOX0RPQ1VNRU5UICovICwgXG4gICAgICAgIC8qIHZlcnNpb24gKi8gZSwgXG4gICAgICAgIC8qIHJlYWRUaW1lICovIHN0Lm1pbigpLCBcbiAgICAgICAgLyogY3JlYXRlVGltZSAqLyBzdC5taW4oKSwgWWUuZW1wdHkoKSwgMiAvKiBEb2N1bWVudFN0YXRlLkhBU19DT01NSVRURURfTVVUQVRJT05TICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZG9jdW1lbnQgdHlwZSB0byBpbmRpY2F0ZSB0aGF0IGl0IGV4aXN0cyBhbmQgdGhhdCBpdHMgdmVyc2lvblxuICAgICAqIGFuZCBkYXRhIGFyZSBrbm93bi5cbiAgICAgKi8gICAgY29udmVydFRvRm91bmREb2N1bWVudCh0LCBlKSB7XG4gICAgICAgIC8vIElmIGEgZG9jdW1lbnQgaXMgc3dpdGNoaW5nIHN0YXRlIGZyb20gYmVpbmcgYW4gaW52YWxpZCBvciBkZWxldGVkXG4gICAgICAgIC8vIGRvY3VtZW50IHRvIGEgdmFsaWQgKEZPVU5EX0RPQ1VNRU5UKSBkb2N1bWVudCwgZWl0aGVyIGR1ZSB0byByZWNlaXZpbmcgYW5cbiAgICAgICAgLy8gdXBkYXRlIGZyb20gV2F0Y2ggb3IgZHVlIHRvIGFwcGx5aW5nIGEgbG9jYWwgc2V0IG11dGF0aW9uIG9uIHRvcFxuICAgICAgICAvLyBvZiBhIGRlbGV0ZWQgZG9jdW1lbnQsIG91ciBiZXN0IGd1ZXNzIGFib3V0IGl0cyBjcmVhdGVUaW1lIHdvdWxkIGJlIHRoZVxuICAgICAgICAvLyB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBkb2N1bWVudCB0cmFuc2l0aW9uZWQgdG8gYSBGT1VORF9ET0NVTUVOVC5cbiAgICAgICAgcmV0dXJuICF0aGlzLmNyZWF0ZVRpbWUuaXNFcXVhbChzdC5taW4oKSkgfHwgMiAvKiBEb2N1bWVudFR5cGUuTk9fRE9DVU1FTlQgKi8gIT09IHRoaXMuZG9jdW1lbnRUeXBlICYmIDAgLyogRG9jdW1lbnRUeXBlLklOVkFMSUQgKi8gIT09IHRoaXMuZG9jdW1lbnRUeXBlIHx8ICh0aGlzLmNyZWF0ZVRpbWUgPSB0KSwgXG4gICAgICAgIHRoaXMudmVyc2lvbiA9IHQsIHRoaXMuZG9jdW1lbnRUeXBlID0gMSAvKiBEb2N1bWVudFR5cGUuRk9VTkRfRE9DVU1FTlQgKi8gLCB0aGlzLmRhdGEgPSBlLCBcbiAgICAgICAgdGhpcy5kb2N1bWVudFN0YXRlID0gMCAvKiBEb2N1bWVudFN0YXRlLlNZTkNFRCAqLyAsIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGRvY3VtZW50IHR5cGUgdG8gaW5kaWNhdGUgdGhhdCBpdCBkb2Vzbid0IGV4aXN0IGF0IHRoZSBnaXZlblxuICAgICAqIHZlcnNpb24uXG4gICAgICovICAgIGNvbnZlcnRUb05vRG9jdW1lbnQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gdCwgdGhpcy5kb2N1bWVudFR5cGUgPSAyIC8qIERvY3VtZW50VHlwZS5OT19ET0NVTUVOVCAqLyAsIFxuICAgICAgICB0aGlzLmRhdGEgPSBZZS5lbXB0eSgpLCB0aGlzLmRvY3VtZW50U3RhdGUgPSAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovICwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgZG9jdW1lbnQgdHlwZSB0byBpbmRpY2F0ZSB0aGF0IGl0IGV4aXN0cyBhdCBhIGdpdmVuIHZlcnNpb24gYnV0XG4gICAgICogdGhhdCBpdHMgZGF0YSBpcyBub3Qga25vd24gKGUuZy4gYSBkb2N1bWVudCB0aGF0IHdhcyB1cGRhdGVkIHdpdGhvdXQgYSBrbm93blxuICAgICAqIGJhc2UgZG9jdW1lbnQpLlxuICAgICAqLyAgICBjb252ZXJ0VG9Vbmtub3duRG9jdW1lbnQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gdCwgdGhpcy5kb2N1bWVudFR5cGUgPSAzIC8qIERvY3VtZW50VHlwZS5VTktOT1dOX0RPQ1VNRU5UICovICwgXG4gICAgICAgIHRoaXMuZGF0YSA9IFllLmVtcHR5KCksIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDIgLyogRG9jdW1lbnRTdGF0ZS5IQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyAsIFxuICAgICAgICB0aGlzO1xuICAgIH1cbiAgICBzZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50U3RhdGUgPSAyIC8qIERvY3VtZW50U3RhdGUuSEFTX0NPTU1JVFRFRF9NVVRBVElPTlMgKi8gLCB0aGlzO1xuICAgIH1cbiAgICBzZXRIYXNMb2NhbE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnRTdGF0ZSA9IDEgLyogRG9jdW1lbnRTdGF0ZS5IQVNfTE9DQUxfTVVUQVRJT05TICovICwgdGhpcy52ZXJzaW9uID0gc3QubWluKCksIFxuICAgICAgICB0aGlzO1xuICAgIH1cbiAgICBzZXRSZWFkVGltZSh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlYWRUaW1lID0gdCwgdGhpcztcbiAgICB9XG4gICAgZ2V0IGhhc0xvY2FsTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gMSAvKiBEb2N1bWVudFN0YXRlLkhBU19MT0NBTF9NVVRBVElPTlMgKi8gPT09IHRoaXMuZG9jdW1lbnRTdGF0ZTtcbiAgICB9XG4gICAgZ2V0IGhhc0NvbW1pdHRlZE11dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIDIgLyogRG9jdW1lbnRTdGF0ZS5IQVNfQ09NTUlUVEVEX01VVEFUSU9OUyAqLyA9PT0gdGhpcy5kb2N1bWVudFN0YXRlO1xuICAgIH1cbiAgICBnZXQgaGFzUGVuZGluZ1dyaXRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzTG9jYWxNdXRhdGlvbnMgfHwgdGhpcy5oYXNDb21taXR0ZWRNdXRhdGlvbnM7XG4gICAgfVxuICAgIGlzVmFsaWREb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogRG9jdW1lbnRUeXBlLklOVkFMSUQgKi8gIT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc0ZvdW5kRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAxIC8qIERvY3VtZW50VHlwZS5GT1VORF9ET0NVTUVOVCAqLyA9PT0gdGhpcy5kb2N1bWVudFR5cGU7XG4gICAgfVxuICAgIGlzTm9Eb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDIgLyogRG9jdW1lbnRUeXBlLk5PX0RPQ1VNRU5UICovID09PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNVbmtub3duRG9jdW1lbnQoKSB7XG4gICAgICAgIHJldHVybiAzIC8qIERvY3VtZW50VHlwZS5VTktOT1dOX0RPQ1VNRU5UICovID09PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgWmUgJiYgdGhpcy5rZXkuaXNFcXVhbCh0LmtleSkgJiYgdGhpcy52ZXJzaW9uLmlzRXF1YWwodC52ZXJzaW9uKSAmJiB0aGlzLmRvY3VtZW50VHlwZSA9PT0gdC5kb2N1bWVudFR5cGUgJiYgdGhpcy5kb2N1bWVudFN0YXRlID09PSB0LmRvY3VtZW50U3RhdGUgJiYgdGhpcy5kYXRhLmlzRXF1YWwodC5kYXRhKTtcbiAgICB9XG4gICAgbXV0YWJsZUNvcHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgWmUodGhpcy5rZXksIHRoaXMuZG9jdW1lbnRUeXBlLCB0aGlzLnZlcnNpb24sIHRoaXMucmVhZFRpbWUsIHRoaXMuY3JlYXRlVGltZSwgdGhpcy5kYXRhLmNsb25lKCksIHRoaXMuZG9jdW1lbnRTdGF0ZSk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYERvY3VtZW50KCR7dGhpcy5rZXl9LCAke3RoaXMudmVyc2lvbn0sICR7SlNPTi5zdHJpbmdpZnkodGhpcy5kYXRhLnZhbHVlKX0sIHtjcmVhdGVUaW1lOiAke3RoaXMuY3JlYXRlVGltZX19KSwge2RvY3VtZW50VHlwZTogJHt0aGlzLmRvY3VtZW50VHlwZX19KSwge2RvY3VtZW50U3RhdGU6ICR7dGhpcy5kb2N1bWVudFN0YXRlfX0pYDtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdGhlIHZhbHVlIGZvciBmaWVsZCBgZmllbGRgIGluIHRoZSBwcm92aWRlZCBkb2N1bWVudHMuIFRocm93cyBpZlxuICogdGhlIGZpZWxkIGRvZXMgbm90IGV4aXN0IGluIGJvdGggZG9jdW1lbnRzLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgdG4ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUgPSBudWxsLCBuID0gW10sIHMgPSBbXSwgaSA9IG51bGwsIHIgPSBudWxsLCBvID0gbnVsbCkge1xuICAgICAgICB0aGlzLnBhdGggPSB0LCB0aGlzLmNvbGxlY3Rpb25Hcm91cCA9IGUsIHRoaXMub3JkZXJCeSA9IG4sIHRoaXMuZmlsdGVycyA9IHMsIHRoaXMubGltaXQgPSBpLCBcbiAgICAgICAgdGhpcy5zdGFydEF0ID0gciwgdGhpcy5lbmRBdCA9IG8sIHRoaXMuZnQgPSBudWxsO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhIFRhcmdldCB3aXRoIGEgcGF0aCBhbmQgb3B0aW9uYWwgYWRkaXRpb25hbCBxdWVyeSBjb25zdHJhaW50cy5cbiAqIFBhdGggbXVzdCBjdXJyZW50bHkgYmUgZW1wdHkgaWYgdGhpcyBpcyBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkuXG4gKlxuICogTk9URTogeW91IHNob3VsZCBhbHdheXMgY29uc3RydWN0IGBUYXJnZXRgIGZyb20gYFF1ZXJ5LnRvVGFyZ2V0YCBpbnN0ZWFkIG9mXG4gKiB1c2luZyB0aGlzIGZhY3RvcnkgbWV0aG9kLCBiZWNhdXNlIGBRdWVyeWAgcHJvdmlkZXMgYW4gaW1wbGljaXQgYG9yZGVyQnlgXG4gKiBwcm9wZXJ0eS5cbiAqLyBmdW5jdGlvbiBlbih0LCBlID0gbnVsbCwgbiA9IFtdLCBzID0gW10sIGkgPSBudWxsLCByID0gbnVsbCwgbyA9IG51bGwpIHtcbiAgICByZXR1cm4gbmV3IHRuKHQsIGUsIG4sIHMsIGksIHIsIG8pO1xufVxuXG5mdW5jdGlvbiBubih0KSB7XG4gICAgY29uc3QgZSA9ICQodCk7XG4gICAgaWYgKG51bGwgPT09IGUuZnQpIHtcbiAgICAgICAgbGV0IHQgPSBlLnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgIG51bGwgIT09IGUuY29sbGVjdGlvbkdyb3VwICYmICh0ICs9IFwifGNnOlwiICsgZS5jb2xsZWN0aW9uR3JvdXApLCB0ICs9IFwifGY6XCIsIHQgKz0gZS5maWx0ZXJzLm1hcCgodCA9PiBEZSh0KSkpLmpvaW4oXCIsXCIpLCBcbiAgICAgICAgdCArPSBcInxvYjpcIiwgdCArPSBlLm9yZGVyQnkubWFwKCh0ID0+IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIC8vIFRPRE8oYi8yOTE4MzE2NSk6IE1ha2UgdGhpcyBjb2xsaXNpb24gcm9idXN0LlxuICAgICAgICAgICAgcmV0dXJuIHQuZmllbGQuY2Fub25pY2FsU3RyaW5nKCkgKyB0LmRpcjtcbiAgICAgICAgfSh0KSkpLmpvaW4oXCIsXCIpLCBxdChlLmxpbWl0KSB8fCAodCArPSBcInxsOlwiLCB0ICs9IGUubGltaXQpLCBlLnN0YXJ0QXQgJiYgKHQgKz0gXCJ8bGI6XCIsIFxuICAgICAgICB0ICs9IGUuc3RhcnRBdC5pbmNsdXNpdmUgPyBcImI6XCIgOiBcImE6XCIsIHQgKz0gZS5zdGFydEF0LnBvc2l0aW9uLm1hcCgodCA9PiBvZSh0KSkpLmpvaW4oXCIsXCIpKSwgXG4gICAgICAgIGUuZW5kQXQgJiYgKHQgKz0gXCJ8dWI6XCIsIHQgKz0gZS5lbmRBdC5pbmNsdXNpdmUgPyBcImE6XCIgOiBcImI6XCIsIHQgKz0gZS5lbmRBdC5wb3NpdGlvbi5tYXAoKHQgPT4gb2UodCkpKS5qb2luKFwiLFwiKSksIFxuICAgICAgICBlLmZ0ID0gdDtcbiAgICB9XG4gICAgcmV0dXJuIGUuZnQ7XG59XG5cbmZ1bmN0aW9uIHNuKHQsIGUpIHtcbiAgICBpZiAodC5saW1pdCAhPT0gZS5saW1pdCkgcmV0dXJuICExO1xuICAgIGlmICh0Lm9yZGVyQnkubGVuZ3RoICE9PSBlLm9yZGVyQnkubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lm9yZGVyQnkubGVuZ3RoOyBuKyspIGlmICghS2UodC5vcmRlckJ5W25dLCBlLm9yZGVyQnlbbl0pKSByZXR1cm4gITE7XG4gICAgaWYgKHQuZmlsdGVycy5sZW5ndGggIT09IGUuZmlsdGVycy5sZW5ndGgpIHJldHVybiAhMTtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IHQuZmlsdGVycy5sZW5ndGg7IG4rKykgaWYgKCFDZSh0LmZpbHRlcnNbbl0sIGUuZmlsdGVyc1tuXSkpIHJldHVybiAhMTtcbiAgICByZXR1cm4gdC5jb2xsZWN0aW9uR3JvdXAgPT09IGUuY29sbGVjdGlvbkdyb3VwICYmICghIXQucGF0aC5pc0VxdWFsKGUucGF0aCkgJiYgKCEhRWUodC5zdGFydEF0LCBlLnN0YXJ0QXQpICYmIEVlKHQuZW5kQXQsIGUuZW5kQXQpKSk7XG59XG5cbmZ1bmN0aW9uIHJuKHQpIHtcbiAgICByZXR1cm4gY3QuaXNEb2N1bWVudEtleSh0LnBhdGgpICYmIG51bGwgPT09IHQuY29sbGVjdGlvbkdyb3VwICYmIDAgPT09IHQuZmlsdGVycy5sZW5ndGg7XG59XG5cbi8qKiBSZXR1cm5zIHRoZSBmaWVsZCBmaWx0ZXJzIHRoYXQgdGFyZ2V0IHRoZSBnaXZlbiBmaWVsZCBwYXRoLiAqLyBmdW5jdGlvbiBvbih0LCBlKSB7XG4gICAgcmV0dXJuIHQuZmlsdGVycy5maWx0ZXIoKHQgPT4gdCBpbnN0YW5jZW9mIFJlICYmIHQuZmllbGQuaXNFcXVhbChlKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlcyB0aGF0IGFyZSB1c2VkIGluIEFSUkFZX0NPTlRBSU5TIG9yIEFSUkFZX0NPTlRBSU5TX0FOWVxuICogZmlsdGVycy4gUmV0dXJucyBgbnVsbGAgaWYgdGhlcmUgYXJlIG5vIHN1Y2ggZmlsdGVycy5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSB0byB1c2UgYXMgdGhlIGxvd2VyIGJvdW5kIGZvciBhc2NlbmRpbmcgaW5kZXggc2VnbWVudCBhdFxuICogdGhlIHByb3ZpZGVkIGBmaWVsZFBhdGhgIChvciB0aGUgdXBwZXIgYm91bmQgZm9yIGFuIGRlc2NlbmRpbmcgc2VnbWVudCkuXG4gKi9cbmZ1bmN0aW9uIHVuKHQsIGUsIG4pIHtcbiAgICBsZXQgcyA9IHRlLCBpID0gITA7XG4gICAgLy8gUHJvY2VzcyBhbGwgZmlsdGVycyB0byBmaW5kIGEgdmFsdWUgZm9yIHRoZSBjdXJyZW50IGZpZWxkIHNlZ21lbnRcbiAgICBmb3IgKGNvbnN0IG4gb2Ygb24odCwgZSkpIHtcbiAgICAgICAgbGV0IHQgPSB0ZSwgZSA9ICEwO1xuICAgICAgICBzd2l0Y2ggKG4ub3ApIHtcbiAgICAgICAgICBjYXNlIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLyA6XG4gICAgICAgICAgY2FzZSBcIjw9XCIgLyogT3BlcmF0b3IuTEVTU19USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICAgIHQgPSBtZShuLnZhbHVlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICBjYXNlIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgdCA9IG4udmFsdWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCI+XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOICovIDpcbiAgICAgICAgICAgIHQgPSBuLnZhbHVlLCBlID0gITE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICB0ID0gdGU7XG4gLy8gUmVtYWluaW5nIGZpbHRlcnMgY2Fubm90IGJlIHVzZWQgYXMgbG93ZXIgYm91bmRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgeWUoe1xuICAgICAgICAgICAgdmFsdWU6IHMsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdmFsdWU6IHQsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IGVcbiAgICAgICAgfSkgPCAwICYmIChzID0gdCwgaSA9IGUpO1xuICAgIH1cbiAgICAvLyBJZiB0aGVyZSBpcyBhbiBhZGRpdGlvbmFsIGJvdW5kLCBjb21wYXJlIHRoZSB2YWx1ZXMgYWdhaW5zdCB0aGUgZXhpc3RpbmdcbiAgICAvLyByYW5nZSB0byBzZWUgaWYgd2UgY2FuIG5hcnJvdyB0aGUgc2NvcGUuXG4gICAgICAgIGlmIChudWxsICE9PSBuKSBmb3IgKGxldCByID0gMDsgciA8IHQub3JkZXJCeS5sZW5ndGg7ICsrcikge1xuICAgICAgICBpZiAodC5vcmRlckJ5W3JdLmZpZWxkLmlzRXF1YWwoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuLnBvc2l0aW9uW3JdO1xuICAgICAgICAgICAgeWUoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBzLFxuICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogaVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0LFxuICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogbi5pbmNsdXNpdmVcbiAgICAgICAgICAgIH0pIDwgMCAmJiAocyA9IHQsIGkgPSBuLmluY2x1c2l2ZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogcyxcbiAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSB0byB1c2UgYXMgdGhlIHVwcGVyIGJvdW5kIGZvciBhc2NlbmRpbmcgaW5kZXggc2VnbWVudCBhdFxuICogdGhlIHByb3ZpZGVkIGBmaWVsZFBhdGhgIChvciB0aGUgbG93ZXIgYm91bmQgZm9yIGEgZGVzY2VuZGluZyBzZWdtZW50KS5cbiAqLyBmdW5jdGlvbiBjbih0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSBadCwgaSA9ICEwO1xuICAgIC8vIFByb2Nlc3MgYWxsIGZpbHRlcnMgdG8gZmluZCBhIHZhbHVlIGZvciB0aGUgY3VycmVudCBmaWVsZCBzZWdtZW50XG4gICAgZm9yIChjb25zdCBuIG9mIG9uKHQsIGUpKSB7XG4gICAgICAgIGxldCB0ID0gWnQsIGUgPSAhMDtcbiAgICAgICAgc3dpdGNoIChuLm9wKSB7XG4gICAgICAgICAgY2FzZSBcIj49XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwiPlwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTiAqLyA6XG4gICAgICAgICAgICB0ID0gZ2Uobi52YWx1ZSksIGUgPSAhMTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICBjYXNlIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgdCA9IG4udmFsdWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovIDpcbiAgICAgICAgICAgIHQgPSBuLnZhbHVlLCBlID0gITE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICB0ID0gWnQ7XG4gLy8gUmVtYWluaW5nIGZpbHRlcnMgY2Fubm90IGJlIHVzZWQgYXMgdXBwZXIgYm91bmRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgcGUoe1xuICAgICAgICAgICAgdmFsdWU6IHMsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgdmFsdWU6IHQsXG4gICAgICAgICAgICBpbmNsdXNpdmU6IGVcbiAgICAgICAgfSkgPiAwICYmIChzID0gdCwgaSA9IGUpO1xuICAgIH1cbiAgICAvLyBJZiB0aGVyZSBpcyBhbiBhZGRpdGlvbmFsIGJvdW5kLCBjb21wYXJlIHRoZSB2YWx1ZXMgYWdhaW5zdCB0aGUgZXhpc3RpbmdcbiAgICAvLyByYW5nZSB0byBzZWUgaWYgd2UgY2FuIG5hcnJvdyB0aGUgc2NvcGUuXG4gICAgICAgIGlmIChudWxsICE9PSBuKSBmb3IgKGxldCByID0gMDsgciA8IHQub3JkZXJCeS5sZW5ndGg7ICsrcikge1xuICAgICAgICBpZiAodC5vcmRlckJ5W3JdLmZpZWxkLmlzRXF1YWwoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuLnBvc2l0aW9uW3JdO1xuICAgICAgICAgICAgcGUoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBzLFxuICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogaVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0LFxuICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogbi5pbmNsdXNpdmVcbiAgICAgICAgICAgIH0pID4gMCAmJiAocyA9IHQsIGkgPSBuLmluY2x1c2l2ZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogcyxcbiAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgfTtcbn1cblxuLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiBzZWdtZW50cyBvZiBhIHBlcmZlY3QgaW5kZXggZm9yIHRoaXMgdGFyZ2V0LiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUXVlcnkgZW5jYXBzdWxhdGVzIGFsbCB0aGUgcXVlcnkgYXR0cmlidXRlcyB3ZSBzdXBwb3J0IGluIHRoZSBTREsuIEl0IGNhblxuICogYmUgcnVuIGFnYWluc3QgdGhlIExvY2FsU3RvcmUsIGFzIHdlbGwgYXMgYmUgY29udmVydGVkIHRvIGEgYFRhcmdldGAgdG9cbiAqIHF1ZXJ5IHRoZSBSZW1vdGVTdG9yZSByZXN1bHRzLlxuICpcbiAqIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gKi9cbmNsYXNzIGFuIHtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBhIFF1ZXJ5IHdpdGggYSBwYXRoIGFuZCBvcHRpb25hbCBhZGRpdGlvbmFsIHF1ZXJ5IGNvbnN0cmFpbnRzLlxuICAgICAqIFBhdGggbXVzdCBjdXJyZW50bHkgYmUgZW1wdHkgaWYgdGhpcyBpcyBhIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcnkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSA9IG51bGwsIG4gPSBbXSwgcyA9IFtdLCBpID0gbnVsbCwgciA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyAsIG8gPSBudWxsLCB1ID0gbnVsbCkge1xuICAgICAgICB0aGlzLnBhdGggPSB0LCB0aGlzLmNvbGxlY3Rpb25Hcm91cCA9IGUsIHRoaXMuZXhwbGljaXRPcmRlckJ5ID0gbiwgdGhpcy5maWx0ZXJzID0gcywgXG4gICAgICAgIHRoaXMubGltaXQgPSBpLCB0aGlzLmxpbWl0VHlwZSA9IHIsIHRoaXMuc3RhcnRBdCA9IG8sIHRoaXMuZW5kQXQgPSB1LCB0aGlzLmR0ID0gbnVsbCwgXG4gICAgICAgIC8vIFRoZSBjb3JyZXNwb25kaW5nIGBUYXJnZXRgIG9mIHRoaXMgYFF1ZXJ5YCBpbnN0YW5jZS5cbiAgICAgICAgdGhpcy5fdCA9IG51bGwsIHRoaXMuc3RhcnRBdCwgdGhpcy5lbmRBdDtcbiAgICB9XG59XG5cbi8qKiBDcmVhdGVzIGEgbmV3IFF1ZXJ5IGluc3RhbmNlIHdpdGggdGhlIG9wdGlvbnMgcHJvdmlkZWQuICovIGZ1bmN0aW9uIGhuKHQsIGUsIG4sIHMsIGksIHIsIG8sIHUpIHtcbiAgICByZXR1cm4gbmV3IGFuKHQsIGUsIG4sIHMsIGksIHIsIG8sIHUpO1xufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBRdWVyeSBmb3IgYSBxdWVyeSB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50cyBhdCBgcGF0aGAgKi8gZnVuY3Rpb24gbG4odCkge1xuICAgIHJldHVybiBuZXcgYW4odCk7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGNvbnZlcnQgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5IGludG8gYSBjb2xsZWN0aW9uIHF1ZXJ5IGF0IGFcbiAqIHNwZWNpZmljIHBhdGguIFRoaXMgaXMgdXNlZCB3aGVuIGV4ZWN1dGluZyBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJpZXMsIHNpbmNlXG4gKiB3ZSBoYXZlIHRvIHNwbGl0IHRoZSBxdWVyeSBpbnRvIGEgc2V0IG9mIGNvbGxlY3Rpb24gcXVlcmllcyBhdCBtdWx0aXBsZVxuICogcGF0aHMuXG4gKi9cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgcXVlcnkgZG9lcyBub3Qgc3BlY2lmeSBhbnkgcXVlcnkgY29uc3RyYWludHMgdGhhdFxuICogY291bGQgcmVtb3ZlIHJlc3VsdHMuXG4gKi9cbmZ1bmN0aW9uIGZuKHQpIHtcbiAgICByZXR1cm4gMCA9PT0gdC5maWx0ZXJzLmxlbmd0aCAmJiBudWxsID09PSB0LmxpbWl0ICYmIG51bGwgPT0gdC5zdGFydEF0ICYmIG51bGwgPT0gdC5lbmRBdCAmJiAoMCA9PT0gdC5leHBsaWNpdE9yZGVyQnkubGVuZ3RoIHx8IDEgPT09IHQuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCAmJiB0LmV4cGxpY2l0T3JkZXJCeVswXS5maWVsZC5pc0tleUZpZWxkKCkpO1xufVxuXG5mdW5jdGlvbiBkbih0KSB7XG4gICAgcmV0dXJuIHQuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCA+IDAgPyB0LmV4cGxpY2l0T3JkZXJCeVswXS5maWVsZCA6IG51bGw7XG59XG5cbmZ1bmN0aW9uIF9uKHQpIHtcbiAgICBmb3IgKGNvbnN0IGUgb2YgdC5maWx0ZXJzKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmdldEZpcnN0SW5lcXVhbGl0eUZpZWxkKCk7XG4gICAgICAgIGlmIChudWxsICE9PSB0KSByZXR1cm4gdDtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBRdWVyeSBmb3IgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5IHRoYXQgbWF0Y2hlcyBhbGwgZG9jdW1lbnRzXG4gKiB3aXRoaW4gdGhlIHByb3ZpZGVkIGNvbGxlY3Rpb24gZ3JvdXAuXG4gKi9cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIHRoZSBxdWVyeSBtYXRjaGVzIGEgY29sbGVjdGlvbiBncm91cCByYXRoZXIgdGhhbiBhIHNwZWNpZmljXG4gKiBjb2xsZWN0aW9uLlxuICovXG5mdW5jdGlvbiB3bih0KSB7XG4gICAgcmV0dXJuIG51bGwgIT09IHQuY29sbGVjdGlvbkdyb3VwO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGltcGxpY2l0IG9yZGVyIGJ5IGNvbnN0cmFpbnQgdGhhdCBpcyB1c2VkIHRvIGV4ZWN1dGUgdGhlIFF1ZXJ5LFxuICogd2hpY2ggY2FuIGJlIGRpZmZlcmVudCBmcm9tIHRoZSBvcmRlciBieSBjb25zdHJhaW50cyB0aGUgdXNlciBwcm92aWRlZCAoZS5nLlxuICogdGhlIFNESyBhbmQgYmFja2VuZCBhbHdheXMgb3JkZXJzIGJ5IGBfX25hbWVfX2ApLlxuICovIGZ1bmN0aW9uIG1uKHQpIHtcbiAgICBjb25zdCBlID0gJCh0KTtcbiAgICBpZiAobnVsbCA9PT0gZS5kdCkge1xuICAgICAgICBlLmR0ID0gW107XG4gICAgICAgIGNvbnN0IHQgPSBfbihlKSwgbiA9IGRuKGUpO1xuICAgICAgICBpZiAobnVsbCAhPT0gdCAmJiBudWxsID09PSBuKSBcbiAgICAgICAgLy8gSW4gb3JkZXIgdG8gaW1wbGljaXRseSBhZGQga2V5IG9yZGVyaW5nLCB3ZSBtdXN0IGFsc28gYWRkIHRoZVxuICAgICAgICAvLyBpbmVxdWFsaXR5IGZpbHRlciBmaWVsZCBmb3IgaXQgdG8gYmUgYSB2YWxpZCBxdWVyeS5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBkZWZhdWx0IGluZXF1YWxpdHkgZmllbGQgYW5kIGtleSBvcmRlcmluZyBpcyBhc2NlbmRpbmcuXG4gICAgICAgIHQuaXNLZXlGaWVsZCgpIHx8IGUuZHQucHVzaChuZXcgVWUodCkpLCBlLmR0LnB1c2gobmV3IFVlKHV0LmtleUZpZWxkKCksIFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLykpOyBlbHNlIHtcbiAgICAgICAgICAgIGxldCB0ID0gITE7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZS5leHBsaWNpdE9yZGVyQnkpIGUuZHQucHVzaChuKSwgbi5maWVsZC5pc0tleUZpZWxkKCkgJiYgKHQgPSAhMCk7XG4gICAgICAgICAgICBpZiAoIXQpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgb3JkZXIgb2YgdGhlIGltcGxpY2l0IGtleSBvcmRlcmluZyBhbHdheXMgbWF0Y2hlcyB0aGUgbGFzdFxuICAgICAgICAgICAgICAgIC8vIGV4cGxpY2l0IG9yZGVyIGJ5XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUuZXhwbGljaXRPcmRlckJ5Lmxlbmd0aCA+IDAgPyBlLmV4cGxpY2l0T3JkZXJCeVtlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggLSAxXS5kaXIgOiBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi87XG4gICAgICAgICAgICAgICAgZS5kdC5wdXNoKG5ldyBVZSh1dC5rZXlGaWVsZCgpLCB0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGUuZHQ7XG59XG5cbi8qKlxuICogQ29udmVydHMgdGhpcyBgUXVlcnlgIGluc3RhbmNlIHRvIGl0J3MgY29ycmVzcG9uZGluZyBgVGFyZ2V0YCByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBnbih0KSB7XG4gICAgY29uc3QgZSA9ICQodCk7XG4gICAgaWYgKCFlLl90KSBpZiAoXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovID09PSBlLmxpbWl0VHlwZSkgZS5fdCA9IGVuKGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIG1uKGUpLCBlLmZpbHRlcnMsIGUubGltaXQsIGUuc3RhcnRBdCwgZS5lbmRBdCk7IGVsc2Uge1xuICAgICAgICAvLyBGbGlwIHRoZSBvcmRlckJ5IGRpcmVjdGlvbnMgc2luY2Ugd2Ugd2FudCB0aGUgbGFzdCByZXN1bHRzXG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBuIG9mIG1uKGUpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi8gPT09IG4uZGlyID8gXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovIDogXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi87XG4gICAgICAgICAgICB0LnB1c2gobmV3IFVlKG4uZmllbGQsIGUpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBuZWVkIHRvIHN3YXAgdGhlIGN1cnNvcnMgdG8gbWF0Y2ggdGhlIG5vdy1mbGlwcGVkIHF1ZXJ5IG9yZGVyaW5nLlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLmVuZEF0ID8gbmV3IEllKGUuZW5kQXQucG9zaXRpb24sIGUuZW5kQXQuaW5jbHVzaXZlKSA6IG51bGwsIHMgPSBlLnN0YXJ0QXQgPyBuZXcgSWUoZS5zdGFydEF0LnBvc2l0aW9uLCBlLnN0YXJ0QXQuaW5jbHVzaXZlKSA6IG51bGw7XG4gICAgICAgIC8vIE5vdyByZXR1cm4gYXMgYSBMaW1pdFR5cGUuRmlyc3QgcXVlcnkuXG4gICAgICAgIGUuX3QgPSBlbihlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCB0LCBlLmZpbHRlcnMsIGUubGltaXQsIG4sIHMpO1xuICAgIH1cbiAgICByZXR1cm4gZS5fdDtcbn1cblxuZnVuY3Rpb24geW4odCwgZSkge1xuICAgIGUuZ2V0Rmlyc3RJbmVxdWFsaXR5RmllbGQoKSwgX24odCk7XG4gICAgY29uc3QgbiA9IHQuZmlsdGVycy5jb25jYXQoWyBlIF0pO1xuICAgIHJldHVybiBuZXcgYW4odC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgbiwgdC5saW1pdCwgdC5saW1pdFR5cGUsIHQuc3RhcnRBdCwgdC5lbmRBdCk7XG59XG5cbmZ1bmN0aW9uIHBuKHQsIGUsIG4pIHtcbiAgICByZXR1cm4gbmV3IGFuKHQucGF0aCwgdC5jb2xsZWN0aW9uR3JvdXAsIHQuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIHQuZmlsdGVycy5zbGljZSgpLCBlLCBuLCB0LnN0YXJ0QXQsIHQuZW5kQXQpO1xufVxuXG5mdW5jdGlvbiBJbih0LCBlKSB7XG4gICAgcmV0dXJuIHNuKGduKHQpLCBnbihlKSkgJiYgdC5saW1pdFR5cGUgPT09IGUubGltaXRUeXBlO1xufVxuXG4vLyBUT0RPKGIvMjkxODMxNjUpOiBUaGlzIGlzIHVzZWQgdG8gZ2V0IGEgdW5pcXVlIHN0cmluZyBmcm9tIGEgcXVlcnkgdG8sIGZvclxuLy8gZXhhbXBsZSwgdXNlIGFzIGEgZGljdGlvbmFyeSBrZXksIGJ1dCB0aGUgaW1wbGVtZW50YXRpb24gaXMgc3ViamVjdCB0b1xuLy8gY29sbGlzaW9ucy4gTWFrZSBpdCBjb2xsaXNpb24tZnJlZS5cbmZ1bmN0aW9uIFRuKHQpIHtcbiAgICByZXR1cm4gYCR7bm4oZ24odCkpfXxsdDoke3QubGltaXRUeXBlfWA7XG59XG5cbmZ1bmN0aW9uIEVuKHQpIHtcbiAgICByZXR1cm4gYFF1ZXJ5KHRhcmdldD0ke2Z1bmN0aW9uKHQpIHtcbiAgICAgICAgbGV0IGUgPSB0LnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0LmNvbGxlY3Rpb25Hcm91cCAmJiAoZSArPSBcIiBjb2xsZWN0aW9uR3JvdXA9XCIgKyB0LmNvbGxlY3Rpb25Hcm91cCksIFxuICAgICAgICB0LmZpbHRlcnMubGVuZ3RoID4gMCAmJiAoZSArPSBgLCBmaWx0ZXJzOiBbJHt0LmZpbHRlcnMubWFwKCh0ID0+IE5lKHQpKSkuam9pbihcIiwgXCIpfV1gKSwgXG4gICAgICAgIHF0KHQubGltaXQpIHx8IChlICs9IFwiLCBsaW1pdDogXCIgKyB0LmxpbWl0KSwgdC5vcmRlckJ5Lmxlbmd0aCA+IDAgJiYgKGUgKz0gYCwgb3JkZXJCeTogWyR7dC5vcmRlckJ5Lm1hcCgodCA9PiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7dC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKX0gKCR7dC5kaXJ9KWA7XG4gICAgICAgIH0odCkpKS5qb2luKFwiLCBcIil9XWApLCB0LnN0YXJ0QXQgJiYgKGUgKz0gXCIsIHN0YXJ0QXQ6IFwiLCBlICs9IHQuc3RhcnRBdC5pbmNsdXNpdmUgPyBcImI6XCIgOiBcImE6XCIsIFxuICAgICAgICBlICs9IHQuc3RhcnRBdC5wb3NpdGlvbi5tYXAoKHQgPT4gb2UodCkpKS5qb2luKFwiLFwiKSksIHQuZW5kQXQgJiYgKGUgKz0gXCIsIGVuZEF0OiBcIiwgXG4gICAgICAgIGUgKz0gdC5lbmRBdC5pbmNsdXNpdmUgPyBcImE6XCIgOiBcImI6XCIsIGUgKz0gdC5lbmRBdC5wb3NpdGlvbi5tYXAoKHQgPT4gb2UodCkpKS5qb2luKFwiLFwiKSksIFxuICAgICAgICBgVGFyZ2V0KCR7ZX0pYDtcbiAgICB9KGduKHQpKX07IGxpbWl0VHlwZT0ke3QubGltaXRUeXBlfSlgO1xufVxuXG4vKiogUmV0dXJucyB3aGV0aGVyIGBkb2NgIG1hdGNoZXMgdGhlIGNvbnN0cmFpbnRzIG9mIGBxdWVyeWAuICovIGZ1bmN0aW9uIEFuKHQsIGUpIHtcbiAgICByZXR1cm4gZS5pc0ZvdW5kRG9jdW1lbnQoKSAmJiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLmtleS5wYXRoO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdC5jb2xsZWN0aW9uR3JvdXAgPyBlLmtleS5oYXNDb2xsZWN0aW9uSWQodC5jb2xsZWN0aW9uR3JvdXApICYmIHQucGF0aC5pc1ByZWZpeE9mKG4pIDogY3QuaXNEb2N1bWVudEtleSh0LnBhdGgpID8gdC5wYXRoLmlzRXF1YWwobikgOiB0LnBhdGguaXNJbW1lZGlhdGVQYXJlbnRPZihuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBBIGRvY3VtZW50IG11c3QgaGF2ZSBhIHZhbHVlIGZvciBldmVyeSBvcmRlcmluZyBjbGF1c2UgaW4gb3JkZXIgdG8gc2hvdyB1cFxuICogaW4gdGhlIHJlc3VsdHMuXG4gKi8gKHQsIGUpICYmIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgLy8gV2UgbXVzdCB1c2UgYHF1ZXJ5T3JkZXJCeSgpYCB0byBnZXQgdGhlIGxpc3Qgb2YgYWxsIG9yZGVyQnlzIChib3RoIGltcGxpY2l0IGFuZCBleHBsaWNpdCkuXG4gICAgICAgIC8vIE5vdGUgdGhhdCBmb3IgT1IgcXVlcmllcywgb3JkZXJCeSBhcHBsaWVzIHRvIGFsbCBkaXNqdW5jdGlvbiB0ZXJtcyBhbmQgaW1wbGljaXQgb3JkZXJCeXMgbXVzdFxuICAgICAgICAvLyBiZSB0YWtlbiBpbnRvIGFjY291bnQuIEZvciBleGFtcGxlLCB0aGUgcXVlcnkgXCJhID4gMSB8fCBiPT0xXCIgaGFzIGFuIGltcGxpY2l0IFwib3JkZXJCeSBhXCIgZHVlXG4gICAgICAgIC8vIHRvIHRoZSBpbmVxdWFsaXR5LCBhbmQgaXMgZXZhbHVhdGVkIGFzIFwiYSA+IDEgb3JkZXJCeSBhIHx8IGI9PTEgb3JkZXJCeSBhXCIuXG4gICAgICAgIC8vIEEgZG9jdW1lbnQgd2l0aCBjb250ZW50IG9mIHtiOjF9IG1hdGNoZXMgdGhlIGZpbHRlcnMsIGJ1dCBkb2VzIG5vdCBtYXRjaCB0aGUgb3JkZXJCeSBiZWNhdXNlXG4gICAgICAgIC8vIGl0J3MgbWlzc2luZyB0aGUgZmllbGQgJ2EnLlxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgbW4odCkpIFxuICAgICAgICAvLyBvcmRlciBieSBrZXkgYWx3YXlzIG1hdGNoZXNcbiAgICAgICAgaWYgKCFuLmZpZWxkLmlzS2V5RmllbGQoKSAmJiBudWxsID09PSBlLmRhdGEuZmllbGQobi5maWVsZCkpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH0odCwgZSkgJiYgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdC5maWx0ZXJzKSBpZiAoIW4ubWF0Y2hlcyhlKSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIC8qKiBNYWtlcyBzdXJlIGEgZG9jdW1lbnQgaXMgd2l0aGluIHRoZSBib3VuZHMsIGlmIHByb3ZpZGVkLiAqLyAodCwgZSkgJiYgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBpZiAodC5zdGFydEF0ICYmICFcbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgYSBkb2N1bWVudCBzb3J0cyBiZWZvcmUgYSBib3VuZCB1c2luZyB0aGUgcHJvdmlkZWQgc29ydFxuICogb3JkZXIuXG4gKi9cbiAgICAgICAgZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgY29uc3QgcyA9IFRlKHQsIGUsIG4pO1xuICAgICAgICAgICAgcmV0dXJuIHQuaW5jbHVzaXZlID8gcyA8PSAwIDogcyA8IDA7XG4gICAgICAgIH0odC5zdGFydEF0LCBtbih0KSwgZSkpIHJldHVybiAhMTtcbiAgICAgICAgaWYgKHQuZW5kQXQgJiYgIWZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBUZSh0LCBlLCBuKTtcbiAgICAgICAgICAgIHJldHVybiB0LmluY2x1c2l2ZSA/IHMgPj0gMCA6IHMgPiAwO1xuICAgICAgICB9KHQuZW5kQXQsIG1uKHQpLCBlKSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIC8qKlxuICogUmV0dXJucyB0aGUgY29sbGVjdGlvbiBncm91cCB0aGF0IHRoaXMgcXVlcnkgdGFyZ2V0cy5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGluIHRoZSBXZWIgU0RLIHRvIGZhY2lsaXRhdGUgbXVsdGktdGFiXG4gKiBzeW5jaHJvbml6YXRpb24gZm9yIHF1ZXJ5IHJlc3VsdHMuXG4gKi8gKHQsIGUpO1xufVxuXG5mdW5jdGlvbiBSbih0KSB7XG4gICAgcmV0dXJuIHQuY29sbGVjdGlvbkdyb3VwIHx8ICh0LnBhdGgubGVuZ3RoICUgMiA9PSAxID8gdC5wYXRoLmxhc3RTZWdtZW50KCkgOiB0LnBhdGguZ2V0KHQucGF0aC5sZW5ndGggLSAyKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIG5ldyBjb21wYXJhdG9yIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gY29tcGFyZSB0d28gZG9jdW1lbnRzXG4gKiBiYXNlZCBvbiB0aGUgUXVlcnkncyBvcmRlcmluZyBjb25zdHJhaW50LlxuICovIGZ1bmN0aW9uIGJuKHQpIHtcbiAgICByZXR1cm4gKGUsIG4pID0+IHtcbiAgICAgICAgbGV0IHMgPSAhMTtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIG1uKHQpKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gUG4oaSwgZSwgbik7XG4gICAgICAgICAgICBpZiAoMCAhPT0gdCkgcmV0dXJuIHQ7XG4gICAgICAgICAgICBzID0gcyB8fCBpLmZpZWxkLmlzS2V5RmllbGQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBQbih0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IHQuZmllbGQuaXNLZXlGaWVsZCgpID8gY3QuY29tcGFyYXRvcihlLmtleSwgbi5rZXkpIDogZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gZS5kYXRhLmZpZWxkKHQpLCBpID0gbi5kYXRhLmZpZWxkKHQpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gcyAmJiBudWxsICE9PSBpID8gaWUocywgaSkgOiBPKCk7XG4gICAgfSh0LmZpZWxkLCBlLCBuKTtcbiAgICBzd2l0Y2ggKHQuZGlyKSB7XG4gICAgICBjYXNlIFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLyA6XG4gICAgICAgIHJldHVybiBzO1xuXG4gICAgICBjYXNlIFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovIDpcbiAgICAgICAgcmV0dXJuIC0xICogcztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIE8oKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYW4gRG91YmxlVmFsdWUgZm9yIGB2YWx1ZWAgdGhhdCBpcyBlbmNvZGVkIGJhc2VkIHRoZSBzZXJpYWxpemVyJ3NcbiAqIGB1c2VQcm90bzNKc29uYCBzZXR0aW5nLlxuICovIGZ1bmN0aW9uIHZuKHQsIGUpIHtcbiAgICBpZiAodC53dCkge1xuICAgICAgICBpZiAoaXNOYU4oZSkpIHJldHVybiB7XG4gICAgICAgICAgICBkb3VibGVWYWx1ZTogXCJOYU5cIlxuICAgICAgICB9O1xuICAgICAgICBpZiAoZSA9PT0gMSAvIDApIHJldHVybiB7XG4gICAgICAgICAgICBkb3VibGVWYWx1ZTogXCJJbmZpbml0eVwiXG4gICAgICAgIH07XG4gICAgICAgIGlmIChlID09PSAtMSAvIDApIHJldHVybiB7XG4gICAgICAgICAgICBkb3VibGVWYWx1ZTogXCItSW5maW5pdHlcIlxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBkb3VibGVWYWx1ZTogVXQoZSkgPyBcIi0wXCIgOiBlXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIEludGVnZXJWYWx1ZSBmb3IgYHZhbHVlYC5cbiAqLyBmdW5jdGlvbiBWbih0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW50ZWdlclZhbHVlOiBcIlwiICsgdFxuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIG51bWJlciB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGludG8gYSBwcm90by5cbiAqIFRoZSByZXR1cm4gdmFsdWUgaXMgYW4gSW50ZWdlclZhbHVlIGlmIGl0IGNhbiBzYWZlbHkgcmVwcmVzZW50IHRoZSB2YWx1ZSxcbiAqIG90aGVyd2lzZSBhIERvdWJsZVZhbHVlIGlzIHJldHVybmVkLlxuICovIGZ1bmN0aW9uIFNuKHQsIGUpIHtcbiAgICByZXR1cm4gS3QoZSkgPyBWbihlKSA6IHZuKHQsIGUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFVzZWQgdG8gcmVwcmVzZW50IGEgZmllbGQgdHJhbnNmb3JtIG9uIGEgbXV0YXRpb24uICovIGNsYXNzIERuIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIHN0cnVjdHVyYWwgdHlwZSBvZiBgVHJhbnNmb3JtT3BlcmF0aW9uYCBpcyB1bmlxdWUuXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzU0NTFcbiAgICAgICAgdGhpcy5fID0gdm9pZCAwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb21wdXRlcyB0aGUgbG9jYWwgdHJhbnNmb3JtIHJlc3VsdCBhZ2FpbnN0IHRoZSBwcm92aWRlZCBgcHJldmlvdXNWYWx1ZWAsXG4gKiBvcHRpb25hbGx5IHVzaW5nIHRoZSBwcm92aWRlZCBsb2NhbFdyaXRlVGltZS5cbiAqLyBmdW5jdGlvbiBDbih0LCBlLCBuKSB7XG4gICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBrbiA/IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHtcbiAgICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgICAgIF9fdHlwZV9fOiB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlOiBcInNlcnZlcl90aW1lc3RhbXBcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgX19sb2NhbF93cml0ZV90aW1lX186IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IHQuc2Vjb25kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbm9zOiB0Lm5hbm9zZWNvbmRzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBlICYmIChuLmZpZWxkcy5fX3ByZXZpb3VzX3ZhbHVlX18gPSBlKSwge1xuICAgICAgICAgICAgbWFwVmFsdWU6IG5cbiAgICAgICAgfTtcbiAgICB9KG4sIGUpIDogdCBpbnN0YW5jZW9mIE9uID8gTW4odCwgZSkgOiB0IGluc3RhbmNlb2YgRm4gPyAkbih0LCBlKSA6IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBTaW5jZSBKYXZhU2NyaXB0J3MgaW50ZWdlciBhcml0aG1ldGljIGlzIGxpbWl0ZWQgdG8gNTMgYml0XG4gICAgICAgIC8vIHByZWNpc2lvbiBhbmQgcmVzb2x2ZXMgb3ZlcmZsb3dzIGJ5IHJlZHVjaW5nIHByZWNpc2lvbiwgd2UgZG8gbm90XG4gICAgICAgIC8vIG1hbnVhbGx5IGNhcCBvdmVyZmxvd3MgYXQgMl42My5cbiAgICAgICAgY29uc3QgbiA9IE5uKHQsIGUpLCBzID0gTG4obikgKyBMbih0Lmd0KTtcbiAgICAgICAgcmV0dXJuIGFlKG4pICYmIGFlKHQuZ3QpID8gVm4ocykgOiB2bih0Lnl0LCBzKTtcbiAgICB9KHQsIGUpO1xufVxuXG4vKipcbiAqIENvbXB1dGVzIGEgZmluYWwgdHJhbnNmb3JtIHJlc3VsdCBhZnRlciB0aGUgdHJhbnNmb3JtIGhhcyBiZWVuIGFja25vd2xlZGdlZFxuICogYnkgdGhlIHNlcnZlciwgcG90ZW50aWFsbHkgdXNpbmcgdGhlIHNlcnZlci1wcm92aWRlZCB0cmFuc2Zvcm1SZXN1bHQuXG4gKi8gZnVuY3Rpb24geG4odCwgZSwgbikge1xuICAgIC8vIFRoZSBzZXJ2ZXIganVzdCBzZW5kcyBudWxsIGFzIHRoZSB0cmFuc2Zvcm0gcmVzdWx0IGZvciBhcnJheSBvcGVyYXRpb25zLFxuICAgIC8vIHNvIHdlIGhhdmUgdG8gY2FsY3VsYXRlIGEgcmVzdWx0IHRoZSBzYW1lIGFzIHdlIGRvIGZvciBsb2NhbFxuICAgIC8vIGFwcGxpY2F0aW9ucy5cbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIE9uID8gTW4odCwgZSkgOiB0IGluc3RhbmNlb2YgRm4gPyAkbih0LCBlKSA6IG47XG59XG5cbi8qKlxuICogSWYgdGhpcyB0cmFuc2Zvcm0gb3BlcmF0aW9uIGlzIG5vdCBpZGVtcG90ZW50LCByZXR1cm5zIHRoZSBiYXNlIHZhbHVlIHRvXG4gKiBwZXJzaXN0IGZvciB0aGlzIHRyYW5zZm9ybS4gSWYgYSBiYXNlIHZhbHVlIGlzIHJldHVybmVkLCB0aGUgdHJhbnNmb3JtXG4gKiBvcGVyYXRpb24gaXMgYWx3YXlzIGFwcGxpZWQgdG8gdGhpcyBiYXNlIHZhbHVlLCBldmVuIGlmIGRvY3VtZW50IGhhc1xuICogYWxyZWFkeSBiZWVuIHVwZGF0ZWQuXG4gKlxuICogQmFzZSB2YWx1ZXMgcHJvdmlkZSBjb25zaXN0ZW50IGJlaGF2aW9yIGZvciBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1zIGFuZFxuICogYWxsb3cgdXMgdG8gcmV0dXJuIHRoZSBzYW1lIGxhdGVuY3ktY29tcGVuc2F0ZWQgdmFsdWUgZXZlbiBpZiB0aGUgYmFja2VuZFxuICogaGFzIGFscmVhZHkgYXBwbGllZCB0aGUgdHJhbnNmb3JtIG9wZXJhdGlvbi4gVGhlIGJhc2UgdmFsdWUgaXMgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgdHJhbnNmb3JtcywgYXMgdGhleSBjYW4gYmUgcmUtcGxheWVkIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzXG4gKiBhbHJlYWR5IGFwcGxpZWQgdGhlbS5cbiAqXG4gKiBAcmV0dXJucyBhIGJhc2UgdmFsdWUgdG8gc3RvcmUgYWxvbmcgd2l0aCB0aGUgbXV0YXRpb24sIG9yIG51bGwgZm9yXG4gKiBpZGVtcG90ZW50IHRyYW5zZm9ybXMuXG4gKi8gZnVuY3Rpb24gTm4odCwgZSkge1xuICAgIHJldHVybiB0IGluc3RhbmNlb2YgQm4gPyBhZShuID0gZSkgfHwgZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gISF0ICYmIFwiZG91YmxlVmFsdWVcIiBpbiB0O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgZWl0aGVyIGFuIEludGVnZXJWYWx1ZSBvciBhIERvdWJsZVZhbHVlLiAqLyAobikgPyBlIDoge1xuICAgICAgICBpbnRlZ2VyVmFsdWU6IDBcbiAgICB9IDogbnVsbDtcbiAgICB2YXIgbjtcbn1cblxuLyoqIFRyYW5zZm9ybXMgYSB2YWx1ZSBpbnRvIGEgc2VydmVyLWdlbmVyYXRlZCB0aW1lc3RhbXAuICovXG5jbGFzcyBrbiBleHRlbmRzIERuIHt9XG5cbi8qKiBUcmFuc2Zvcm1zIGFuIGFycmF5IHZhbHVlIHZpYSBhIHVuaW9uIG9wZXJhdGlvbi4gKi8gY2xhc3MgT24gZXh0ZW5kcyBEbiB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmVsZW1lbnRzID0gdDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIE1uKHQsIGUpIHtcbiAgICBjb25zdCBuID0gcW4oZSk7XG4gICAgZm9yIChjb25zdCBlIG9mIHQuZWxlbWVudHMpIG4uc29tZSgodCA9PiBuZSh0LCBlKSkpIHx8IG4ucHVzaChlKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKiBUcmFuc2Zvcm1zIGFuIGFycmF5IHZhbHVlIHZpYSBhIHJlbW92ZSBvcGVyYXRpb24uICovIGNsYXNzIEZuIGV4dGVuZHMgRG4ge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5lbGVtZW50cyA9IHQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiAkbih0LCBlKSB7XG4gICAgbGV0IG4gPSBxbihlKTtcbiAgICBmb3IgKGNvbnN0IGUgb2YgdC5lbGVtZW50cykgbiA9IG4uZmlsdGVyKCh0ID0+ICFuZSh0LCBlKSkpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgIHZhbHVlczogblxuICAgICAgICB9XG4gICAgfTtcbn1cblxuLyoqXG4gKiBJbXBsZW1lbnRzIHRoZSBiYWNrZW5kIHNlbWFudGljcyBmb3IgbG9jYWxseSBjb21wdXRlZCBOVU1FUklDX0FERCAoaW5jcmVtZW50KVxuICogdHJhbnNmb3Jtcy4gQ29udmVydHMgYWxsIGZpZWxkIHZhbHVlcyB0byBpbnRlZ2VycyBvciBkb3VibGVzLCBidXQgdW5saWtlIHRoZVxuICogYmFja2VuZCBkb2VzIG5vdCBjYXAgaW50ZWdlciB2YWx1ZXMgYXQgMl42My4gSW5zdGVhZCwgSmF2YVNjcmlwdCBudW1iZXJcbiAqIGFyaXRobWV0aWMgaXMgdXNlZCBhbmQgcHJlY2lzaW9uIGxvc3MgY2FuIG9jY3VyIGZvciB2YWx1ZXMgZ3JlYXRlciB0aGFuIDJeNTMuXG4gKi8gY2xhc3MgQm4gZXh0ZW5kcyBEbiB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnl0ID0gdCwgdGhpcy5ndCA9IGU7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBMbih0KSB7XG4gICAgcmV0dXJuIHp0KHQuaW50ZWdlclZhbHVlIHx8IHQuZG91YmxlVmFsdWUpO1xufVxuXG5mdW5jdGlvbiBxbih0KSB7XG4gICAgcmV0dXJuIGhlKHQpICYmIHQuYXJyYXlWYWx1ZS52YWx1ZXMgPyB0LmFycmF5VmFsdWUudmFsdWVzLnNsaWNlKCkgOiBbXTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBBIGZpZWxkIHBhdGggYW5kIHRoZSBUcmFuc2Zvcm1PcGVyYXRpb24gdG8gcGVyZm9ybSB1cG9uIGl0LiAqLyBjbGFzcyBVbiB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmZpZWxkID0gdCwgdGhpcy50cmFuc2Zvcm0gPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gS24odCwgZSkge1xuICAgIHJldHVybiB0LmZpZWxkLmlzRXF1YWwoZS5maWVsZCkgJiYgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICByZXR1cm4gdCBpbnN0YW5jZW9mIE9uICYmIGUgaW5zdGFuY2VvZiBPbiB8fCB0IGluc3RhbmNlb2YgRm4gJiYgZSBpbnN0YW5jZW9mIEZuID8gdHQodC5lbGVtZW50cywgZS5lbGVtZW50cywgbmUpIDogdCBpbnN0YW5jZW9mIEJuICYmIGUgaW5zdGFuY2VvZiBCbiA/IG5lKHQuZ3QsIGUuZ3QpIDogdCBpbnN0YW5jZW9mIGtuICYmIGUgaW5zdGFuY2VvZiBrbjtcbiAgICB9KHQudHJhbnNmb3JtLCBlLnRyYW5zZm9ybSk7XG59XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHN1Y2Nlc3NmdWxseSBhcHBseWluZyBhIG11dGF0aW9uIHRvIHRoZSBiYWNrZW5kLiAqL1xuY2xhc3MgR24ge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBtdXRhdGlvbiB3YXMgY29tbWl0dGVkOlxuICAgICAqXG4gICAgICogLSBGb3IgbW9zdCBvcGVyYXRpb25zLCB0aGlzIGlzIHRoZSB1cGRhdGVUaW1lIGluIHRoZSBXcml0ZVJlc3VsdC5cbiAgICAgKiAtIEZvciBkZWxldGVzLCB0aGUgY29tbWl0VGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSAoYmVjYXVzZSBkZWxldGVzIGFyZVxuICAgICAqICAgbm90IHN0b3JlZCBhbmQgaGF2ZSBubyB1cGRhdGVUaW1lKS5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB0aGVzZSB2ZXJzaW9ucyBjYW4gYmUgZGlmZmVyZW50OiBOby1vcCB3cml0ZXMgd2lsbCBub3QgY2hhbmdlXG4gICAgICogdGhlIHVwZGF0ZVRpbWUgZXZlbiB0aG91Z2ggdGhlIGNvbW1pdFRpbWUgYWR2YW5jZXMuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogVGhlIHJlc3VsdGluZyBmaWVsZHMgcmV0dXJuZWQgZnJvbSB0aGUgYmFja2VuZCBhZnRlciBhIG11dGF0aW9uXG4gICAgICogY29udGFpbmluZyBmaWVsZCB0cmFuc2Zvcm1zIGhhcyBiZWVuIGNvbW1pdHRlZC4gQ29udGFpbnMgb25lIEZpZWxkVmFsdWVcbiAgICAgKiBmb3IgZWFjaCBGaWVsZFRyYW5zZm9ybSB0aGF0IHdhcyBpbiB0aGUgbXV0YXRpb24uXG4gICAgICpcbiAgICAgKiBXaWxsIGJlIGVtcHR5IGlmIHRoZSBtdXRhdGlvbiBkaWQgbm90IGNvbnRhaW4gYW55IGZpZWxkIHRyYW5zZm9ybXMuXG4gICAgICovXG4gICAgZSkge1xuICAgICAgICB0aGlzLnZlcnNpb24gPSB0LCB0aGlzLnRyYW5zZm9ybVJlc3VsdHMgPSBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBFbmNvZGVzIGEgcHJlY29uZGl0aW9uIGZvciBhIG11dGF0aW9uLiBUaGlzIGZvbGxvd3MgdGhlIG1vZGVsIHRoYXQgdGhlXG4gKiBiYWNrZW5kIGFjY2VwdHMgd2l0aCB0aGUgc3BlY2lhbCBjYXNlIG9mIGFuIGV4cGxpY2l0IFwiZW1wdHlcIiBwcmVjb25kaXRpb25cbiAqIChtZWFuaW5nIG5vIHByZWNvbmRpdGlvbikuXG4gKi8gY2xhc3MgUW4ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy51cGRhdGVUaW1lID0gdCwgdGhpcy5leGlzdHMgPSBlO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBlbXB0eSBQcmVjb25kaXRpb24uICovICAgIHN0YXRpYyBub25lKCkge1xuICAgICAgICByZXR1cm4gbmV3IFFuO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBQcmVjb25kaXRpb24gd2l0aCBhbiBleGlzdHMgZmxhZy4gKi8gICAgc3RhdGljIGV4aXN0cyh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUW4odm9pZCAwLCB0KTtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgUHJlY29uZGl0aW9uIGJhc2VkIG9uIGEgdmVyc2lvbiBhIGRvY3VtZW50IGV4aXN0cyBhdC4gKi8gICAgc3RhdGljIHVwZGF0ZVRpbWUodCkge1xuICAgICAgICByZXR1cm4gbmV3IFFuKHQpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB3aGV0aGVyIHRoaXMgUHJlY29uZGl0aW9uIGlzIGVtcHR5LiAqLyAgICBnZXQgaXNOb25lKCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwID09PSB0aGlzLnVwZGF0ZVRpbWUgJiYgdm9pZCAwID09PSB0aGlzLmV4aXN0cztcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmV4aXN0cyA9PT0gdC5leGlzdHMgJiYgKHRoaXMudXBkYXRlVGltZSA/ICEhdC51cGRhdGVUaW1lICYmIHRoaXMudXBkYXRlVGltZS5pc0VxdWFsKHQudXBkYXRlVGltZSkgOiAhdC51cGRhdGVUaW1lKTtcbiAgICB9XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByZWNvbmRpdGlvbnMgaXMgdmFsaWQgZm9yIHRoZSBnaXZlbiBkb2N1bWVudC4gKi8gZnVuY3Rpb24gam4odCwgZSkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IHQudXBkYXRlVGltZSA/IGUuaXNGb3VuZERvY3VtZW50KCkgJiYgZS52ZXJzaW9uLmlzRXF1YWwodC51cGRhdGVUaW1lKSA6IHZvaWQgMCA9PT0gdC5leGlzdHMgfHwgdC5leGlzdHMgPT09IGUuaXNGb3VuZERvY3VtZW50KCk7XG59XG5cbi8qKlxuICogQSBtdXRhdGlvbiBkZXNjcmliZXMgYSBzZWxmLWNvbnRhaW5lZCBjaGFuZ2UgdG8gYSBkb2N1bWVudC4gTXV0YXRpb25zIGNhblxuICogY3JlYXRlLCByZXBsYWNlLCBkZWxldGUsIGFuZCB1cGRhdGUgc3Vic2V0cyBvZiBkb2N1bWVudHMuXG4gKlxuICogTXV0YXRpb25zIG5vdCBvbmx5IGFjdCBvbiB0aGUgdmFsdWUgb2YgdGhlIGRvY3VtZW50IGJ1dCBhbHNvIGl0cyB2ZXJzaW9uLlxuICpcbiAqIEZvciBsb2NhbCBtdXRhdGlvbnMgKG11dGF0aW9ucyB0aGF0IGhhdmVuJ3QgYmVlbiBjb21taXR0ZWQgeWV0KSwgd2UgcHJlc2VydmVcbiAqIHRoZSBleGlzdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gRm9yIERlbGV0ZSBtdXRhdGlvbnMsIHdlXG4gKiByZXNldCB0aGUgdmVyc2lvbiB0byAwLlxuICpcbiAqIEhlcmUncyB0aGUgZXhwZWN0ZWQgdHJhbnNpdGlvbiB0YWJsZS5cbiAqXG4gKiBNVVRBVElPTiAgICAgICAgICAgQVBQTElFRCBUTyAgICAgICAgICAgIFJFU1VMVFMgSU5cbiAqXG4gKiBTZXRNdXRhdGlvbiAgICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogU2V0TXV0YXRpb24gICAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBEb2N1bWVudCh2MClcbiAqIFNldE11dGF0aW9uICAgICAgICBJbnZhbGlkRG9jdW1lbnQodjApICAgRG9jdW1lbnQodjApXG4gKiBQYXRjaE11dGF0aW9uICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBOb0RvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIEludmFsaWREb2N1bWVudCh2MCkgICBVbmtub3duRG9jdW1lbnQodjMpXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgTm9Eb2N1bWVudCh2MykgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgSW52YWxpZERvY3VtZW50KHYwKSAgIE5vRG9jdW1lbnQodjApXG4gKlxuICogRm9yIGFja25vd2xlZGdlZCBtdXRhdGlvbnMsIHdlIHVzZSB0aGUgdXBkYXRlVGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSBhc1xuICogdGhlIHJlc3VsdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gQXMgZGVsZXRlcyBoYXZlIG5vXG4gKiBleHBsaWNpdCB1cGRhdGUgdGltZSwgd2UgdXNlIHRoZSBjb21taXRUaW1lIG9mIHRoZSBXcml0ZVJlc3BvbnNlIGZvclxuICogRGVsZXRlIG11dGF0aW9ucy5cbiAqXG4gKiBJZiBhIG11dGF0aW9uIGlzIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZCBidXQgZmFpbHMgdGhlIHByZWNvbmRpdGlvbiBjaGVja1xuICogbG9jYWxseSwgd2UgdHJhbnNpdGlvbiB0byBhbiBgVW5rbm93bkRvY3VtZW50YCBhbmQgcmVseSBvbiBXYXRjaCB0byBzZW5kIHVzXG4gKiB0aGUgdXBkYXRlZCB2ZXJzaW9uLlxuICpcbiAqIEZpZWxkIHRyYW5zZm9ybXMgYXJlIHVzZWQgb25seSB3aXRoIFBhdGNoIGFuZCBTZXQgTXV0YXRpb25zLiBXZSB1c2UgdGhlXG4gKiBgdXBkYXRlVHJhbnNmb3Jtc2AgbWVzc2FnZSB0byBzdG9yZSB0cmFuc2Zvcm1zLCByYXRoZXIgdGhhbiB0aGUgYHRyYW5zZm9ybXNgc1xuICogbWVzc2FnZXMuXG4gKlxuICogIyMgU3ViY2xhc3NpbmcgTm90ZXNcbiAqXG4gKiBFdmVyeSB0eXBlIG9mIG11dGF0aW9uIG5lZWRzIHRvIGltcGxlbWVudCBpdHMgb3duIGFwcGx5VG9SZW1vdGVEb2N1bWVudCgpIGFuZFxuICogYXBwbHlUb0xvY2FsVmlldygpIHRvIGltcGxlbWVudCB0aGUgYWN0dWFsIGJlaGF2aW9yIG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvblxuICogdG8gc29tZSBzb3VyY2UgZG9jdW1lbnQgKHNlZSBgc2V0TXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoKWAgZm9yIGFuXG4gKiBleGFtcGxlKS5cbiAqLyBjbGFzcyBXbiB7fVxuXG4vKipcbiAqIEEgdXRpbGl0eSBtZXRob2QgdG8gY2FsY3VsYXRlIGEgYE11dGF0aW9uYCByZXByZXNlbnRpbmcgdGhlIG92ZXJsYXkgZnJvbSB0aGVcbiAqIGZpbmFsIHN0YXRlIG9mIHRoZSBkb2N1bWVudCwgYW5kIGEgYEZpZWxkTWFza2AgcmVwcmVzZW50aW5nIHRoZSBmaWVsZHMgdGhhdFxuICogYXJlIG11dGF0ZWQgYnkgdGhlIGxvY2FsIG11dGF0aW9ucy5cbiAqLyBmdW5jdGlvbiB6bih0LCBlKSB7XG4gICAgaWYgKCF0Lmhhc0xvY2FsTXV0YXRpb25zIHx8IGUgJiYgMCA9PT0gZS5maWVsZHMubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICAvLyBtYXNrIGlzIG51bGwgd2hlbiBzZXRzIG9yIGRlbGV0ZXMgYXJlIGFwcGxpZWQgdG8gdGhlIGN1cnJlbnQgZG9jdW1lbnQuXG4gICAgICAgIGlmIChudWxsID09PSBlKSByZXR1cm4gdC5pc05vRG9jdW1lbnQoKSA/IG5ldyBpcyh0LmtleSwgUW4ubm9uZSgpKSA6IG5ldyBabih0LmtleSwgdC5kYXRhLCBRbi5ub25lKCkpO1xuICAgIHtcbiAgICAgICAgY29uc3QgbiA9IHQuZGF0YSwgcyA9IFllLmVtcHR5KCk7XG4gICAgICAgIGxldCBpID0gbmV3IFdlKHV0LmNvbXBhcmF0b3IpO1xuICAgICAgICBmb3IgKGxldCB0IG9mIGUuZmllbGRzKSBpZiAoIWkuaGFzKHQpKSB7XG4gICAgICAgICAgICBsZXQgZSA9IG4uZmllbGQodCk7XG4gICAgICAgICAgICAvLyBJZiB3ZSBhcmUgZGVsZXRpbmcgYSBuZXN0ZWQgZmllbGQsIHdlIHRha2UgdGhlIGltbWVkaWF0ZSBwYXJlbnQgYXNcbiAgICAgICAgICAgIC8vIHRoZSBtYXNrIHVzZWQgdG8gY29uc3RydWN0IHRoZSByZXN1bHRpbmcgbXV0YXRpb24uXG4gICAgICAgICAgICAvLyBKdXN0aWZpY2F0aW9uOiBOZXN0ZWQgZmllbGRzIGNhbiBjcmVhdGUgcGFyZW50IGZpZWxkcyBpbXBsaWNpdGx5LiBJZlxuICAgICAgICAgICAgLy8gb25seSBhIGxlYWYgZW50cnkgaXMgZGVsZXRlZCBpbiBsYXRlciBtdXRhdGlvbnMsIHRoZSBwYXJlbnQgZmllbGRcbiAgICAgICAgICAgIC8vIHNob3VsZCBzdGlsbCByZW1haW4sIGJ1dCB3ZSBtYXkgaGF2ZSBsb3N0IHRoaXMgaW5mb3JtYXRpb24uXG4gICAgICAgICAgICAvLyBDb25zaWRlciBtdXRhdGlvbiAoZm9vLmJhciAxKSwgdGhlbiBtdXRhdGlvbiAoZm9vLmJhciBkZWxldGUoKSkuXG4gICAgICAgICAgICAvLyBUaGlzIGxlYXZlcyB0aGUgZmluYWwgcmVzdWx0IChmb28sIHt9KS4gRGVzcGl0ZSB0aGUgZmFjdCB0aGF0IGBkb2NgXG4gICAgICAgICAgICAvLyBoYXMgdGhlIGNvcnJlY3QgcmVzdWx0LCBgZm9vYCBpcyBub3QgaW4gYG1hc2tgLCBhbmQgdGhlIHJlc3VsdGluZ1xuICAgICAgICAgICAgLy8gbXV0YXRpb24gd291bGQgbWlzcyBgZm9vYC5cbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgPT09IGUgJiYgdC5sZW5ndGggPiAxICYmICh0ID0gdC5wb3BMYXN0KCksIGUgPSBuLmZpZWxkKHQpKSwgbnVsbCA9PT0gZSA/IHMuZGVsZXRlKHQpIDogcy5zZXQodCwgZSksIFxuICAgICAgICAgICAgaSA9IGkuYWRkKHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgdHModC5rZXksIHMsIG5ldyBKZShpLnRvQXJyYXkoKSksIFFuLm5vbmUoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgdGhpcyBtdXRhdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21wdXRpbmcgYVxuICogbmV3IHJlbW90ZSBkb2N1bWVudC4gSWYgdGhlIGlucHV0IGRvY3VtZW50IGRvZXNuJ3QgbWF0Y2ggdGhlIGV4cGVjdGVkIHN0YXRlXG4gKiAoZS5nLiBpdCBpcyBpbnZhbGlkIG9yIG91dGRhdGVkKSwgdGhlIGRvY3VtZW50IHR5cGUgbWF5IHRyYW5zaXRpb24gdG9cbiAqIHVua25vd24uXG4gKlxuICogQHBhcmFtIG11dGF0aW9uIC0gVGhlIG11dGF0aW9uIHRvIGFwcGx5LlxuICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIG11dGF0ZS4gVGhlIGlucHV0IGRvY3VtZW50IGNhbiBiZSBhblxuICogICAgIGludmFsaWQgZG9jdW1lbnQgaWYgdGhlIGNsaWVudCBoYXMgbm8ga25vd2xlZGdlIG9mIHRoZSBwcmUtbXV0YXRpb24gc3RhdGVcbiAqICAgICBvZiB0aGUgZG9jdW1lbnQuXG4gKiBAcGFyYW0gbXV0YXRpb25SZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvbiBmcm9tIHRoZSBiYWNrZW5kLlxuICovIGZ1bmN0aW9uIEhuKHQsIGUsIG4pIHtcbiAgICB0IGluc3RhbmNlb2YgWm4gPyBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIC8vIFVubGlrZSBzZXRNdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcsIGlmIHdlJ3JlIGFwcGx5aW5nIGEgbXV0YXRpb24gdG8gYVxuICAgICAgICAvLyByZW1vdGUgZG9jdW1lbnQgdGhlIHNlcnZlciBoYXMgYWNjZXB0ZWQgdGhlIG11dGF0aW9uIHNvIHRoZSBwcmVjb25kaXRpb25cbiAgICAgICAgLy8gbXVzdCBoYXZlIGhlbGQuXG4gICAgICAgIGNvbnN0IHMgPSB0LnZhbHVlLmNsb25lKCksIGkgPSBucyh0LmZpZWxkVHJhbnNmb3JtcywgZSwgbi50cmFuc2Zvcm1SZXN1bHRzKTtcbiAgICAgICAgcy5zZXRBbGwoaSksIGUuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIHMpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0odCwgZSwgbikgOiB0IGluc3RhbmNlb2YgdHMgPyBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGlmICgham4odC5wcmVjb25kaXRpb24sIGUpKSBcbiAgICAgICAgLy8gU2luY2UgdGhlIG11dGF0aW9uIHdhcyBub3QgcmVqZWN0ZWQsIHdlIGtub3cgdGhhdCB0aGUgcHJlY29uZGl0aW9uXG4gICAgICAgIC8vIG1hdGNoZWQgb24gdGhlIGJhY2tlbmQuIFdlIHRoZXJlZm9yZSBtdXN0IG5vdCBoYXZlIHRoZSBleHBlY3RlZCB2ZXJzaW9uXG4gICAgICAgIC8vIG9mIHRoZSBkb2N1bWVudCBpbiBvdXIgY2FjaGUgYW5kIGNvbnZlcnQgdG8gYW4gVW5rbm93bkRvY3VtZW50IHdpdGggYVxuICAgICAgICAvLyBrbm93biB1cGRhdGVUaW1lLlxuICAgICAgICByZXR1cm4gdm9pZCBlLmNvbnZlcnRUb1Vua25vd25Eb2N1bWVudChuLnZlcnNpb24pO1xuICAgICAgICBjb25zdCBzID0gbnModC5maWVsZFRyYW5zZm9ybXMsIGUsIG4udHJhbnNmb3JtUmVzdWx0cyksIGkgPSBlLmRhdGE7XG4gICAgICAgIGkuc2V0QWxsKGVzKHQpKSwgaS5zZXRBbGwocyksIGUuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIGkpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0odCwgZSwgbikgOiBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIC8vIFVubGlrZSBhcHBseVRvTG9jYWxWaWV3LCBpZiB3ZSdyZSBhcHBseWluZyBhIG11dGF0aW9uIHRvIGEgcmVtb3RlXG4gICAgICAgIC8vIGRvY3VtZW50IHRoZSBzZXJ2ZXIgaGFzIGFjY2VwdGVkIHRoZSBtdXRhdGlvbiBzbyB0aGUgcHJlY29uZGl0aW9uIG11c3RcbiAgICAgICAgLy8gaGF2ZSBoZWxkLlxuICAgICAgICBlLmNvbnZlcnRUb05vRG9jdW1lbnQobi52ZXJzaW9uKS5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKTtcbiAgICB9KDAsIGUsIG4pO1xufVxuXG4vKipcbiAqIEFwcGxpZXMgdGhpcyBtdXRhdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21wdXRpbmdcbiAqIHRoZSBuZXcgbG9jYWwgdmlldyBvZiBhIGRvY3VtZW50LiBJZiB0aGUgaW5wdXQgZG9jdW1lbnQgZG9lc24ndCBtYXRjaCB0aGVcbiAqIGV4cGVjdGVkIHN0YXRlLCB0aGUgZG9jdW1lbnQgaXMgbm90IG1vZGlmaWVkLlxuICpcbiAqIEBwYXJhbSBtdXRhdGlvbiAtIFRoZSBtdXRhdGlvbiB0byBhcHBseS5cbiAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBtdXRhdGUuIFRoZSBpbnB1dCBkb2N1bWVudCBjYW4gYmUgYW5cbiAqICAgICBpbnZhbGlkIGRvY3VtZW50IGlmIHRoZSBjbGllbnQgaGFzIG5vIGtub3dsZWRnZSBvZiB0aGUgcHJlLW11dGF0aW9uIHN0YXRlXG4gKiAgICAgb2YgdGhlIGRvY3VtZW50LlxuICogQHBhcmFtIHByZXZpb3VzTWFzayAtIFRoZSBmaWVsZHMgdGhhdCBoYXZlIGJlZW4gdXBkYXRlZCBiZWZvcmUgYXBwbHlpbmcgdGhpcyBtdXRhdGlvbi5cbiAqIEBwYXJhbSBsb2NhbFdyaXRlVGltZSAtIEEgdGltZXN0YW1wIGluZGljYXRpbmcgdGhlIGxvY2FsIHdyaXRlIHRpbWUgb2YgdGhlXG4gKiAgICAgYmF0Y2ggdGhpcyBtdXRhdGlvbiBpcyBhIHBhcnQgb2YuXG4gKiBAcmV0dXJucyBBIGBGaWVsZE1hc2tgIHJlcHJlc2VudGluZyB0aGUgZmllbGRzIHRoYXQgYXJlIGNoYW5nZWQgYnkgYXBwbHlpbmcgdGhpcyBtdXRhdGlvbi5cbiAqLyBmdW5jdGlvbiBKbih0LCBlLCBuLCBzKSB7XG4gICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBabiA/IGZ1bmN0aW9uKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgaWYgKCFqbih0LnByZWNvbmRpdGlvbiwgZSkpIFxuICAgICAgICAvLyBUaGUgbXV0YXRpb24gZmFpbGVkIHRvIGFwcGx5IChlLmcuIGEgZG9jdW1lbnQgSUQgY3JlYXRlZCB3aXRoIGFkZCgpXG4gICAgICAgIC8vIGNhdXNlZCBhIG5hbWUgY29sbGlzaW9uKS5cbiAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIGNvbnN0IGkgPSB0LnZhbHVlLmNsb25lKCksIHIgPSBzcyh0LmZpZWxkVHJhbnNmb3JtcywgcywgZSk7XG4gICAgICAgIHJldHVybiBpLnNldEFsbChyKSwgZS5jb252ZXJ0VG9Gb3VuZERvY3VtZW50KGUudmVyc2lvbiwgaSkuc2V0SGFzTG9jYWxNdXRhdGlvbnMoKSwgXG4gICAgICAgIG51bGw7XG4gLy8gU2V0TXV0YXRpb24gb3ZlcndyaXRlcyBhbGwgZmllbGRzLlxuICAgICAgICB9XG4gICAgLyoqXG4gKiBBIG11dGF0aW9uIHRoYXQgbW9kaWZpZXMgZmllbGRzIG9mIHRoZSBkb2N1bWVudCBhdCB0aGUgZ2l2ZW4ga2V5IHdpdGggdGhlXG4gKiBnaXZlbiB2YWx1ZXMuIFRoZSB2YWx1ZXMgYXJlIGFwcGxpZWQgdGhyb3VnaCBhIGZpZWxkIG1hc2s6XG4gKlxuICogICogV2hlbiBhIGZpZWxkIGlzIGluIGJvdGggdGhlIG1hc2sgYW5kIHRoZSB2YWx1ZXMsIHRoZSBjb3JyZXNwb25kaW5nIGZpZWxkXG4gKiAgICBpcyB1cGRhdGVkLlxuICogICogV2hlbiBhIGZpZWxkIGlzIGluIG5laXRoZXIgdGhlIG1hc2sgbm9yIHRoZSB2YWx1ZXMsIHRoZSBjb3JyZXNwb25kaW5nXG4gKiAgICBmaWVsZCBpcyB1bm1vZGlmaWVkLlxuICogICogV2hlbiBhIGZpZWxkIGlzIGluIHRoZSBtYXNrIGJ1dCBub3QgaW4gdGhlIHZhbHVlcywgdGhlIGNvcnJlc3BvbmRpbmcgZmllbGRcbiAqICAgIGlzIGRlbGV0ZWQuXG4gKiAgKiBXaGVuIGEgZmllbGQgaXMgbm90IGluIHRoZSBtYXNrIGJ1dCBpcyBpbiB0aGUgdmFsdWVzLCB0aGUgdmFsdWVzIG1hcCBpc1xuICogICAgaWdub3JlZC5cbiAqLyAodCwgZSwgbiwgcykgOiB0IGluc3RhbmNlb2YgdHMgPyBmdW5jdGlvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgIGlmICgham4odC5wcmVjb25kaXRpb24sIGUpKSByZXR1cm4gbjtcbiAgICAgICAgY29uc3QgaSA9IHNzKHQuZmllbGRUcmFuc2Zvcm1zLCBzLCBlKSwgciA9IGUuZGF0YTtcbiAgICAgICAgaWYgKHIuc2V0QWxsKGVzKHQpKSwgci5zZXRBbGwoaSksIGUuY29udmVydFRvRm91bmREb2N1bWVudChlLnZlcnNpb24sIHIpLnNldEhhc0xvY2FsTXV0YXRpb25zKCksIFxuICAgICAgICBudWxsID09PSBuKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIG4udW5pb25XaXRoKHQuZmllbGRNYXNrLmZpZWxkcykudW5pb25XaXRoKHQuZmllbGRUcmFuc2Zvcm1zLm1hcCgodCA9PiB0LmZpZWxkKSkpO1xuICAgIH1cbiAgICAvKipcbiAqIFJldHVybnMgYSBGaWVsZFBhdGgvVmFsdWUgbWFwIHdpdGggdGhlIGNvbnRlbnQgb2YgdGhlIFBhdGNoTXV0YXRpb24uXG4gKi8gKHQsIGUsIG4sIHMpIDogZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBpZiAoam4odC5wcmVjb25kaXRpb24sIGUpKSByZXR1cm4gZS5jb252ZXJ0VG9Ob0RvY3VtZW50KGUudmVyc2lvbikuc2V0SGFzTG9jYWxNdXRhdGlvbnMoKSwgXG4gICAgICAgIG51bGw7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAqIEEgbXV0YXRpb24gdGhhdCB2ZXJpZmllcyB0aGUgZXhpc3RlbmNlIG9mIHRoZSBkb2N1bWVudCBhdCB0aGUgZ2l2ZW4ga2V5IHdpdGhcbiAqIHRoZSBwcm92aWRlZCBwcmVjb25kaXRpb24uXG4gKlxuICogVGhlIGB2ZXJpZnlgIG9wZXJhdGlvbiBpcyBvbmx5IHVzZWQgaW4gVHJhbnNhY3Rpb25zLCBhbmQgdGhpcyBjbGFzcyBzZXJ2ZXNcbiAqIHByaW1hcmlseSB0byBmYWNpbGl0YXRlIHNlcmlhbGl6YXRpb24gaW50byBwcm90b3MuXG4gKi8gKHQsIGUsIG4pO1xufVxuXG4vKipcbiAqIElmIHRoaXMgbXV0YXRpb24gaXMgbm90IGlkZW1wb3RlbnQsIHJldHVybnMgdGhlIGJhc2UgdmFsdWUgdG8gcGVyc2lzdCB3aXRoXG4gKiB0aGlzIG11dGF0aW9uLiBJZiBhIGJhc2UgdmFsdWUgaXMgcmV0dXJuZWQsIHRoZSBtdXRhdGlvbiBpcyBhbHdheXMgYXBwbGllZFxuICogdG8gdGhpcyBiYXNlIHZhbHVlLCBldmVuIGlmIGRvY3VtZW50IGhhcyBhbHJlYWR5IGJlZW4gdXBkYXRlZC5cbiAqXG4gKiBUaGUgYmFzZSB2YWx1ZSBpcyBhIHNwYXJzZSBvYmplY3QgdGhhdCBjb25zaXN0cyBvZiBvbmx5IHRoZSBkb2N1bWVudFxuICogZmllbGRzIGZvciB3aGljaCB0aGlzIG11dGF0aW9uIGNvbnRhaW5zIGEgbm9uLWlkZW1wb3RlbnQgdHJhbnNmb3JtYXRpb25cbiAqIChlLmcuIGEgbnVtZXJpYyBpbmNyZW1lbnQpLiBUaGUgcHJvdmlkZWQgdmFsdWUgZ3VhcmFudGVlcyBjb25zaXN0ZW50XG4gKiBiZWhhdmlvciBmb3Igbm9uLWlkZW1wb3RlbnQgdHJhbnNmb3JtcyBhbmQgYWxsb3cgdXMgdG8gcmV0dXJuIHRoZSBzYW1lXG4gKiBsYXRlbmN5LWNvbXBlbnNhdGVkIHZhbHVlIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzIGFscmVhZHkgYXBwbGllZCB0aGVcbiAqIG11dGF0aW9uLiBUaGUgYmFzZSB2YWx1ZSBpcyBudWxsIGZvciBpZGVtcG90ZW50IG11dGF0aW9ucywgYXMgdGhleSBjYW4gYmVcbiAqIHJlLXBsYXllZCBldmVuIGlmIHRoZSBiYWNrZW5kIGhhcyBhbHJlYWR5IGFwcGxpZWQgdGhlbS5cbiAqXG4gKiBAcmV0dXJucyBhIGJhc2UgdmFsdWUgdG8gc3RvcmUgYWxvbmcgd2l0aCB0aGUgbXV0YXRpb24sIG9yIG51bGwgZm9yXG4gKiBpZGVtcG90ZW50IG11dGF0aW9ucy5cbiAqLyBmdW5jdGlvbiBZbih0LCBlKSB7XG4gICAgbGV0IG4gPSBudWxsO1xuICAgIGZvciAoY29uc3QgcyBvZiB0LmZpZWxkVHJhbnNmb3Jtcykge1xuICAgICAgICBjb25zdCB0ID0gZS5kYXRhLmZpZWxkKHMuZmllbGQpLCBpID0gTm4ocy50cmFuc2Zvcm0sIHQgfHwgbnVsbCk7XG4gICAgICAgIG51bGwgIT0gaSAmJiAobnVsbCA9PT0gbiAmJiAobiA9IFllLmVtcHR5KCkpLCBuLnNldChzLmZpZWxkLCBpKSk7XG4gICAgfVxuICAgIHJldHVybiBuIHx8IG51bGw7XG59XG5cbmZ1bmN0aW9uIFhuKHQsIGUpIHtcbiAgICByZXR1cm4gdC50eXBlID09PSBlLnR5cGUgJiYgKCEhdC5rZXkuaXNFcXVhbChlLmtleSkgJiYgKCEhdC5wcmVjb25kaXRpb24uaXNFcXVhbChlLnByZWNvbmRpdGlvbikgJiYgKCEhZnVuY3Rpb24odCwgZSkge1xuICAgICAgICByZXR1cm4gdm9pZCAwID09PSB0ICYmIHZvaWQgMCA9PT0gZSB8fCAhKCF0IHx8ICFlKSAmJiB0dCh0LCBlLCAoKHQsIGUpID0+IEtuKHQsIGUpKSk7XG4gICAgfSh0LmZpZWxkVHJhbnNmb3JtcywgZS5maWVsZFRyYW5zZm9ybXMpICYmICgwIC8qIE11dGF0aW9uVHlwZS5TZXQgKi8gPT09IHQudHlwZSA/IHQudmFsdWUuaXNFcXVhbChlLnZhbHVlKSA6IDEgLyogTXV0YXRpb25UeXBlLlBhdGNoICovICE9PSB0LnR5cGUgfHwgdC5kYXRhLmlzRXF1YWwoZS5kYXRhKSAmJiB0LmZpZWxkTWFzay5pc0VxdWFsKGUuZmllbGRNYXNrKSkpKSk7XG59XG5cbi8qKlxuICogQSBtdXRhdGlvbiB0aGF0IGNyZWF0ZXMgb3IgcmVwbGFjZXMgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkgd2l0aCB0aGVcbiAqIG9iamVjdCB2YWx1ZSBjb250ZW50cy5cbiAqLyBjbGFzcyBabiBleHRlbmRzIFduIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSB0LCB0aGlzLnZhbHVlID0gZSwgdGhpcy5wcmVjb25kaXRpb24gPSBuLCB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IHMsIFxuICAgICAgICB0aGlzLnR5cGUgPSAwIC8qIE11dGF0aW9uVHlwZS5TZXQgKi87XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG5jbGFzcyB0cyBleHRlbmRzIFduIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSB0LCB0aGlzLmRhdGEgPSBlLCB0aGlzLmZpZWxkTWFzayA9IG4sIHRoaXMucHJlY29uZGl0aW9uID0gcywgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gaSwgdGhpcy50eXBlID0gMSAvKiBNdXRhdGlvblR5cGUuUGF0Y2ggKi87XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmllbGRNYXNrO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZXModCkge1xuICAgIGNvbnN0IGUgPSBuZXcgTWFwO1xuICAgIHJldHVybiB0LmZpZWxkTWFzay5maWVsZHMuZm9yRWFjaCgobiA9PiB7XG4gICAgICAgIGlmICghbi5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0LmRhdGEuZmllbGQobik7XG4gICAgICAgICAgICBlLnNldChuLCBzKTtcbiAgICAgICAgfVxuICAgIH0pKSwgZTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbGlzdCBvZiBcInRyYW5zZm9ybSByZXN1bHRzXCIgKGEgdHJhbnNmb3JtIHJlc3VsdCBpcyBhIGZpZWxkIHZhbHVlXG4gKiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdCBvZiBhcHBseWluZyBhIHRyYW5zZm9ybSkgZm9yIHVzZSBhZnRlciBhIG11dGF0aW9uXG4gKiBjb250YWluaW5nIHRyYW5zZm9ybXMgaGFzIGJlZW4gYWNrbm93bGVkZ2VkIGJ5IHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIGZpZWxkVHJhbnNmb3JtcyAtIFRoZSBmaWVsZCB0cmFuc2Zvcm1zIHRvIGFwcGx5IHRoZSByZXN1bHQgdG8uXG4gKiBAcGFyYW0gbXV0YWJsZURvY3VtZW50IC0gVGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGRvY3VtZW50IGFmdGVyIGFwcGx5aW5nIGFsbFxuICogcHJldmlvdXMgbXV0YXRpb25zLlxuICogQHBhcmFtIHNlcnZlclRyYW5zZm9ybVJlc3VsdHMgLSBUaGUgdHJhbnNmb3JtIHJlc3VsdHMgcmVjZWl2ZWQgYnkgdGhlIHNlcnZlci5cbiAqIEByZXR1cm5zIFRoZSB0cmFuc2Zvcm0gcmVzdWx0cyBsaXN0LlxuICovIGZ1bmN0aW9uIG5zKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gbmV3IE1hcDtcbiAgICBNKHQubGVuZ3RoID09PSBuLmxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHIgPSB0W2ldLCBvID0gci50cmFuc2Zvcm0sIHUgPSBlLmRhdGEuZmllbGQoci5maWVsZCk7XG4gICAgICAgIHMuc2V0KHIuZmllbGQsIHhuKG8sIHUsIG5baV0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHM7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGxpc3Qgb2YgXCJ0cmFuc2Zvcm0gcmVzdWx0c1wiIChhIHRyYW5zZm9ybSByZXN1bHQgaXMgYSBmaWVsZCB2YWx1ZVxuICogcmVwcmVzZW50aW5nIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYSB0cmFuc2Zvcm0pIGZvciB1c2Ugd2hlbiBhcHBseWluZyBhXG4gKiB0cmFuc2Zvcm0gbG9jYWxseS5cbiAqXG4gKiBAcGFyYW0gZmllbGRUcmFuc2Zvcm1zIC0gVGhlIGZpZWxkIHRyYW5zZm9ybXMgdG8gYXBwbHkgdGhlIHJlc3VsdCB0by5cbiAqIEBwYXJhbSBsb2NhbFdyaXRlVGltZSAtIFRoZSBsb2NhbCB0aW1lIG9mIHRoZSBtdXRhdGlvbiAodXNlZCB0b1xuICogICAgIGdlbmVyYXRlIFNlcnZlclRpbWVzdGFtcFZhbHVlcykuXG4gKiBAcGFyYW0gbXV0YWJsZURvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIGFwcGx5IHRyYW5zZm9ybXMgb24uXG4gKiBAcmV0dXJucyBUaGUgdHJhbnNmb3JtIHJlc3VsdHMgbGlzdC5cbiAqLyBmdW5jdGlvbiBzcyh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IG5ldyBNYXA7XG4gICAgZm9yIChjb25zdCBpIG9mIHQpIHtcbiAgICAgICAgY29uc3QgdCA9IGkudHJhbnNmb3JtLCByID0gbi5kYXRhLmZpZWxkKGkuZmllbGQpO1xuICAgICAgICBzLnNldChpLmZpZWxkLCBDbih0LCByLCBlKSk7XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG4vKiogQSBtdXRhdGlvbiB0aGF0IGRlbGV0ZXMgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkuICovIGNsYXNzIGlzIGV4dGVuZHMgV24ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSB0LCB0aGlzLnByZWNvbmRpdGlvbiA9IGUsIHRoaXMudHlwZSA9IDIgLyogTXV0YXRpb25UeXBlLkRlbGV0ZSAqLyAsIFxuICAgICAgICB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IFtdO1xuICAgIH1cbiAgICBnZXRGaWVsZE1hc2soKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cblxuY2xhc3MgcnMgZXh0ZW5kcyBXbiB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmtleSA9IHQsIHRoaXMucHJlY29uZGl0aW9uID0gZSwgdGhpcy50eXBlID0gMyAvKiBNdXRhdGlvblR5cGUuVmVyaWZ5ICovICwgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gW107XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBvcyB7XG4gICAgLy8gVE9ETyhiLzMzMDc4MTYzKToganVzdCB1c2Ugc2ltcGxlc3QgZm9ybSBvZiBleGlzdGVuY2UgZmlsdGVyIGZvciBub3dcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuY291bnQgPSB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRXJyb3IgQ29kZXMgZGVzY3JpYmluZyB0aGUgZGlmZmVyZW50IHdheXMgR1JQQyBjYW4gZmFpbC4gVGhlc2UgYXJlIGNvcGllZFxuICogZGlyZWN0bHkgZnJvbSBHUlBDJ3Mgc291cmNlcyBoZXJlOlxuICpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ncnBjL2dycGMvYmxvYi9iY2VlYzk0ZWE0ZmM1ZjAwODVkODEyMzVkOGUxYzA2Nzk4ZGMzNDFhL2luY2x1ZGUvZ3JwYyUyQiUyQi9pbXBsL2NvZGVnZW4vc3RhdHVzX2NvZGVfZW51bS5oXG4gKlxuICogSW1wb3J0YW50ISBUaGUgbmFtZXMgb2YgdGhlc2UgaWRlbnRpZmllcnMgbWF0dGVyIGJlY2F1c2UgdGhlIHN0cmluZyBmb3Jtc1xuICogYXJlIHVzZWQgZm9yIHJldmVyc2UgbG9va3VwcyBmcm9tIHRoZSB3ZWJjaGFubmVsIHN0cmVhbS4gRG8gTk9UIGNoYW5nZSB0aGVcbiAqIG5hbWVzIG9mIHRoZXNlIGlkZW50aWZpZXJzIG9yIGNoYW5nZSB0aGlzIGludG8gYSBjb25zdCBlbnVtLlxuICovIHZhciB1cywgY3M7XG5cbi8qKlxuICogRGV0ZXJtaW5lcyB3aGV0aGVyIGFuIGVycm9yIGNvZGUgcmVwcmVzZW50cyBhIHBlcm1hbmVudCBlcnJvciB3aGVuIHJlY2VpdmVkXG4gKiBpbiByZXNwb25zZSB0byBhIG5vbi13cml0ZSBvcGVyYXRpb24uXG4gKlxuICogU2VlIGlzUGVybWFuZW50V3JpdGVFcnJvciBmb3IgY2xhc3NpZnlpbmcgd3JpdGUgZXJyb3JzLlxuICovXG5mdW5jdGlvbiBhcyh0KSB7XG4gICAgc3dpdGNoICh0KSB7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gTygpO1xuXG4gICAgICBjYXNlIEIuQ0FOQ0VMTEVEOlxuICAgICAgY2FzZSBCLlVOS05PV046XG4gICAgICBjYXNlIEIuREVBRExJTkVfRVhDRUVERUQ6XG4gICAgICBjYXNlIEIuUkVTT1VSQ0VfRVhIQVVTVEVEOlxuICAgICAgY2FzZSBCLklOVEVSTkFMOlxuICAgICAgY2FzZSBCLlVOQVZBSUxBQkxFOlxuIC8vIFVuYXV0aGVudGljYXRlZCBtZWFucyBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIG91ciB0b2tlbiBhbmQgd2UgbmVlZFxuICAgICAgICAvLyB0byByZXRyeSB3aXRoIG5ldyBjcmVkZW50aWFscyB3aGljaCB3aWxsIGhhcHBlbiBhdXRvbWF0aWNhbGx5LlxuICAgICAgICAgICAgICBjYXNlIEIuVU5BVVRIRU5USUNBVEVEOlxuICAgICAgICByZXR1cm4gITE7XG5cbiAgICAgIGNhc2UgQi5JTlZBTElEX0FSR1VNRU5UOlxuICAgICAgY2FzZSBCLk5PVF9GT1VORDpcbiAgICAgIGNhc2UgQi5BTFJFQURZX0VYSVNUUzpcbiAgICAgIGNhc2UgQi5QRVJNSVNTSU9OX0RFTklFRDpcbiAgICAgIGNhc2UgQi5GQUlMRURfUFJFQ09ORElUSU9OOlxuIC8vIEFib3J0ZWQgbWlnaHQgYmUgcmV0cmllZCBpbiBzb21lIHNjZW5hcmlvcywgYnV0IHRoYXQgaXMgZGVwZW5kYW50IG9uXG4gICAgICAgIC8vIHRoZSBjb250ZXh0IGFuZCBzaG91bGQgaGFuZGxlZCBpbmRpdmlkdWFsbHkgYnkgdGhlIGNhbGxpbmcgY29kZS5cbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9hcGlzL2Rlc2lnbi9lcnJvcnMuXG4gICAgICAgICAgICAgIGNhc2UgQi5BQk9SVEVEOlxuICAgICAgY2FzZSBCLk9VVF9PRl9SQU5HRTpcbiAgICAgIGNhc2UgQi5VTklNUExFTUVOVEVEOlxuICAgICAgY2FzZSBCLkRBVEFfTE9TUzpcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gZXJyb3IgY29kZSByZXByZXNlbnRzIGEgcGVybWFuZW50IGVycm9yIHdoZW4gcmVjZWl2ZWRcbiAqIGluIHJlc3BvbnNlIHRvIGEgd3JpdGUgb3BlcmF0aW9uLlxuICpcbiAqIFdyaXRlIG9wZXJhdGlvbnMgbXVzdCBiZSBoYW5kbGVkIHNwZWNpYWxseSBiZWNhdXNlIGFzIG9mIGIvMTE5NDM3NzY0LCBBQk9SVEVEXG4gKiBlcnJvcnMgb24gdGhlIHdyaXRlIHN0cmVhbSBzaG91bGQgYmUgcmV0cmllZCB0b28gKGV2ZW4gdGhvdWdoIEFCT1JURUQgZXJyb3JzXG4gKiBhcmUgbm90IGdlbmVyYWxseSByZXRyeWFibGUpLlxuICpcbiAqIE5vdGUgdGhhdCBkdXJpbmcgdGhlIGluaXRpYWwgaGFuZHNoYWtlIG9uIHRoZSB3cml0ZSBzdHJlYW0gYW4gQUJPUlRFRCBlcnJvclxuICogc2lnbmFscyB0aGF0IHdlIHNob3VsZCBkaXNjYXJkIG91ciBzdHJlYW0gdG9rZW4gKGkuZS4gaXQgaXMgcGVybWFuZW50KS4gVGhpc1xuICogbWVhbnMgYSBoYW5kc2hha2UgZXJyb3Igc2hvdWxkIGJlIGNsYXNzaWZpZWQgd2l0aCBpc1Blcm1hbmVudEVycm9yLCBhYm92ZS5cbiAqL1xuLyoqXG4gKiBNYXBzIGFuIGVycm9yIENvZGUgZnJvbSBHUlBDIHN0YXR1cyBjb2RlIG51bWJlciwgbGlrZSAwLCAxLCBvciAxNC4gVGhlc2VcbiAqIGFyZSBub3QgdGhlIHNhbWUgYXMgSFRUUCBzdGF0dXMgY29kZXMuXG4gKlxuICogQHJldHVybnMgVGhlIENvZGUgZXF1aXZhbGVudCB0byB0aGUgZ2l2ZW4gR1JQQyBzdGF0dXMgY29kZS4gRmFpbHMgaWYgdGhlcmVcbiAqICAgICBpcyBubyBtYXRjaC5cbiAqL1xuZnVuY3Rpb24gaHModCkge1xuICAgIGlmICh2b2lkIDAgPT09IHQpIFxuICAgIC8vIFRoaXMgc2hvdWxkbid0IG5vcm1hbGx5IGhhcHBlbiwgYnV0IGluIGNlcnRhaW4gZXJyb3IgY2FzZXMgKGxpa2UgdHJ5aW5nXG4gICAgLy8gdG8gc2VuZCBpbnZhbGlkIHByb3RvIG1lc3NhZ2VzKSB3ZSBtYXkgZ2V0IGFuIGVycm9yIHdpdGggbm8gR1JQQyBjb2RlLlxuICAgIHJldHVybiB4KFwiR1JQQyBlcnJvciBoYXMgbm8gLmNvZGVcIiksIEIuVU5LTk9XTjtcbiAgICBzd2l0Y2ggKHQpIHtcbiAgICAgIGNhc2UgdXMuT0s6XG4gICAgICAgIHJldHVybiBCLk9LO1xuXG4gICAgICBjYXNlIHVzLkNBTkNFTExFRDpcbiAgICAgICAgcmV0dXJuIEIuQ0FOQ0VMTEVEO1xuXG4gICAgICBjYXNlIHVzLlVOS05PV046XG4gICAgICAgIHJldHVybiBCLlVOS05PV047XG5cbiAgICAgIGNhc2UgdXMuREVBRExJTkVfRVhDRUVERUQ6XG4gICAgICAgIHJldHVybiBCLkRFQURMSU5FX0VYQ0VFREVEO1xuXG4gICAgICBjYXNlIHVzLlJFU09VUkNFX0VYSEFVU1RFRDpcbiAgICAgICAgcmV0dXJuIEIuUkVTT1VSQ0VfRVhIQVVTVEVEO1xuXG4gICAgICBjYXNlIHVzLklOVEVSTkFMOlxuICAgICAgICByZXR1cm4gQi5JTlRFUk5BTDtcblxuICAgICAgY2FzZSB1cy5VTkFWQUlMQUJMRTpcbiAgICAgICAgcmV0dXJuIEIuVU5BVkFJTEFCTEU7XG5cbiAgICAgIGNhc2UgdXMuVU5BVVRIRU5USUNBVEVEOlxuICAgICAgICByZXR1cm4gQi5VTkFVVEhFTlRJQ0FURUQ7XG5cbiAgICAgIGNhc2UgdXMuSU5WQUxJRF9BUkdVTUVOVDpcbiAgICAgICAgcmV0dXJuIEIuSU5WQUxJRF9BUkdVTUVOVDtcblxuICAgICAgY2FzZSB1cy5OT1RfRk9VTkQ6XG4gICAgICAgIHJldHVybiBCLk5PVF9GT1VORDtcblxuICAgICAgY2FzZSB1cy5BTFJFQURZX0VYSVNUUzpcbiAgICAgICAgcmV0dXJuIEIuQUxSRUFEWV9FWElTVFM7XG5cbiAgICAgIGNhc2UgdXMuUEVSTUlTU0lPTl9ERU5JRUQ6XG4gICAgICAgIHJldHVybiBCLlBFUk1JU1NJT05fREVOSUVEO1xuXG4gICAgICBjYXNlIHVzLkZBSUxFRF9QUkVDT05ESVRJT046XG4gICAgICAgIHJldHVybiBCLkZBSUxFRF9QUkVDT05ESVRJT047XG5cbiAgICAgIGNhc2UgdXMuQUJPUlRFRDpcbiAgICAgICAgcmV0dXJuIEIuQUJPUlRFRDtcblxuICAgICAgY2FzZSB1cy5PVVRfT0ZfUkFOR0U6XG4gICAgICAgIHJldHVybiBCLk9VVF9PRl9SQU5HRTtcblxuICAgICAgY2FzZSB1cy5VTklNUExFTUVOVEVEOlxuICAgICAgICByZXR1cm4gQi5VTklNUExFTUVOVEVEO1xuXG4gICAgICBjYXNlIHVzLkRBVEFfTE9TUzpcbiAgICAgICAgcmV0dXJuIEIuREFUQV9MT1NTO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gTygpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhbiBIVFRQIHJlc3BvbnNlJ3MgZXJyb3Igc3RhdHVzIHRvIHRoZSBlcXVpdmFsZW50IGVycm9yIGNvZGUuXG4gKlxuICogQHBhcmFtIHN0YXR1cyAtIEFuIEhUVFAgZXJyb3IgcmVzcG9uc2Ugc3RhdHVzIChcIkZBSUxFRF9QUkVDT05ESVRJT05cIixcbiAqIFwiVU5LTk9XTlwiLCBldGMuKVxuICogQHJldHVybnMgVGhlIGVxdWl2YWxlbnQgQ29kZS4gTm9uLW1hdGNoaW5nIHJlc3BvbnNlcyBhcmUgbWFwcGVkIHRvXG4gKiAgICAgQ29kZS5VTktOT1dOLlxuICovIChjcyA9IHVzIHx8ICh1cyA9IHt9KSlbY3MuT0sgPSAwXSA9IFwiT0tcIiwgY3NbY3MuQ0FOQ0VMTEVEID0gMV0gPSBcIkNBTkNFTExFRFwiLCBcbmNzW2NzLlVOS05PV04gPSAyXSA9IFwiVU5LTk9XTlwiLCBjc1tjcy5JTlZBTElEX0FSR1VNRU5UID0gM10gPSBcIklOVkFMSURfQVJHVU1FTlRcIiwgXG5jc1tjcy5ERUFETElORV9FWENFRURFRCA9IDRdID0gXCJERUFETElORV9FWENFRURFRFwiLCBjc1tjcy5OT1RfRk9VTkQgPSA1XSA9IFwiTk9UX0ZPVU5EXCIsIFxuY3NbY3MuQUxSRUFEWV9FWElTVFMgPSA2XSA9IFwiQUxSRUFEWV9FWElTVFNcIiwgY3NbY3MuUEVSTUlTU0lPTl9ERU5JRUQgPSA3XSA9IFwiUEVSTUlTU0lPTl9ERU5JRURcIiwgXG5jc1tjcy5VTkFVVEhFTlRJQ0FURUQgPSAxNl0gPSBcIlVOQVVUSEVOVElDQVRFRFwiLCBjc1tjcy5SRVNPVVJDRV9FWEhBVVNURUQgPSA4XSA9IFwiUkVTT1VSQ0VfRVhIQVVTVEVEXCIsIFxuY3NbY3MuRkFJTEVEX1BSRUNPTkRJVElPTiA9IDldID0gXCJGQUlMRURfUFJFQ09ORElUSU9OXCIsIGNzW2NzLkFCT1JURUQgPSAxMF0gPSBcIkFCT1JURURcIiwgXG5jc1tjcy5PVVRfT0ZfUkFOR0UgPSAxMV0gPSBcIk9VVF9PRl9SQU5HRVwiLCBjc1tjcy5VTklNUExFTUVOVEVEID0gMTJdID0gXCJVTklNUExFTUVOVEVEXCIsIFxuY3NbY3MuSU5URVJOQUwgPSAxM10gPSBcIklOVEVSTkFMXCIsIGNzW2NzLlVOQVZBSUxBQkxFID0gMTRdID0gXCJVTkFWQUlMQUJMRVwiLCBjc1tjcy5EQVRBX0xPU1MgPSAxNV0gPSBcIkRBVEFfTE9TU1wiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIG1hcCBpbXBsZW1lbnRhdGlvbiB0aGF0IHVzZXMgb2JqZWN0cyBhcyBrZXlzLiBPYmplY3RzIG11c3QgaGF2ZSBhblxuICogYXNzb2NpYXRlZCBlcXVhbHMgZnVuY3Rpb24gYW5kIG11c3QgYmUgaW1tdXRhYmxlLiBFbnRyaWVzIGluIHRoZSBtYXAgYXJlXG4gKiBzdG9yZWQgdG9nZXRoZXIgd2l0aCB0aGUga2V5IGJlaW5nIHByb2R1Y2VkIGZyb20gdGhlIG1hcEtleUZuLiBUaGlzIG1hcFxuICogYXV0b21hdGljYWxseSBoYW5kbGVzIGNvbGxpc2lvbnMgb2Yga2V5cy5cbiAqL1xuY2xhc3MgbHMge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5tYXBLZXlGbiA9IHQsIHRoaXMuZXF1YWxzRm4gPSBlLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbm5lciBtYXAgZm9yIGEga2V5L3ZhbHVlIHBhaXIuIER1ZSB0byB0aGUgcG9zc2liaWxpdHkgb2YgY29sbGlzaW9ucyB3ZVxuICAgICAgICAgKiBrZWVwIGEgbGlzdCBvZiBlbnRyaWVzIHRoYXQgd2UgZG8gYSBsaW5lYXIgc2VhcmNoIHRocm91Z2ggdG8gZmluZCBhbiBhY3R1YWxcbiAgICAgICAgICogbWF0Y2guIE5vdGUgdGhhdCBjb2xsaXNpb25zIHNob3VsZCBiZSByYXJlLCBzbyB3ZSBzdGlsbCBleHBlY3QgbmVhclxuICAgICAgICAgKiBjb25zdGFudCB0aW1lIGxvb2t1cHMgaW4gcHJhY3RpY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlubmVyID0ge30sIFxuICAgICAgICAvKiogVGhlIG51bWJlciBvZiBlbnRyaWVzIHN0b3JlZCBpbiB0aGUgbWFwICovXG4gICAgICAgIHRoaXMuaW5uZXJTaXplID0gMDtcbiAgICB9XG4gICAgLyoqIEdldCBhIHZhbHVlIGZvciB0aGlzIGtleSwgb3IgdW5kZWZpbmVkIGlmIGl0IGRvZXMgbm90IGV4aXN0LiAqLyAgICBnZXQodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5tYXBLZXlGbih0KSwgbiA9IHRoaXMuaW5uZXJbZV07XG4gICAgICAgIGlmICh2b2lkIDAgIT09IG4pIGZvciAoY29uc3QgW2UsIHNdIG9mIG4pIGlmICh0aGlzLmVxdWFsc0ZuKGUsIHQpKSByZXR1cm4gcztcbiAgICB9XG4gICAgaGFzKHQpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5nZXQodCk7XG4gICAgfVxuICAgIC8qKiBQdXQgdGhpcyBrZXkgYW5kIHZhbHVlIGluIHRoZSBtYXAuICovICAgIHNldCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLm1hcEtleUZuKHQpLCBzID0gdGhpcy5pbm5lcltuXTtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gcykgcmV0dXJuIHRoaXMuaW5uZXJbbl0gPSBbIFsgdCwgZSBdIF0sIHZvaWQgdGhpcy5pbm5lclNpemUrKztcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBzLmxlbmd0aDsgbisrKSBpZiAodGhpcy5lcXVhbHNGbihzW25dWzBdLCB0KSkgXG4gICAgICAgIC8vIFRoaXMgaXMgdXBkYXRpbmcgYW4gZXhpc3RpbmcgZW50cnkgYW5kIGRvZXMgbm90IGluY3JlYXNlIGBpbm5lclNpemVgLlxuICAgICAgICByZXR1cm4gdm9pZCAoc1tuXSA9IFsgdCwgZSBdKTtcbiAgICAgICAgcy5wdXNoKFsgdCwgZSBdKSwgdGhpcy5pbm5lclNpemUrKztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHRoaXMga2V5IGZyb20gdGhlIG1hcC4gUmV0dXJucyBhIGJvb2xlYW4gaWYgYW55dGhpbmcgd2FzIGRlbGV0ZWQuXG4gICAgICovICAgIGRlbGV0ZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLm1hcEtleUZuKHQpLCBuID0gdGhpcy5pbm5lcltlXTtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbikgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IG4ubGVuZ3RoOyBzKyspIGlmICh0aGlzLmVxdWFsc0ZuKG5bc11bMF0sIHQpKSByZXR1cm4gMSA9PT0gbi5sZW5ndGggPyBkZWxldGUgdGhpcy5pbm5lcltlXSA6IG4uc3BsaWNlKHMsIDEpLCBcbiAgICAgICAgdGhpcy5pbm5lclNpemUtLSwgITA7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgZm9yRWFjaCh0KSB7XG4gICAgICAgIEJ0KHRoaXMuaW5uZXIsICgoZSwgbikgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbZSwgc10gb2YgbikgdChlLCBzKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gTHQodGhpcy5pbm5lcik7XG4gICAgfVxuICAgIHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlubmVyU2l6ZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IGZzID0gbmV3IEdlKGN0LmNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiBkcygpIHtcbiAgICByZXR1cm4gZnM7XG59XG5cbmNvbnN0IF9zID0gbmV3IEdlKGN0LmNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiB3cyguLi50KSB7XG4gICAgbGV0IGUgPSBfcztcbiAgICBmb3IgKGNvbnN0IG4gb2YgdCkgZSA9IGUuaW5zZXJ0KG4ua2V5LCBuKTtcbiAgICByZXR1cm4gZTtcbn1cblxuZnVuY3Rpb24gbXModCkge1xuICAgIGxldCBlID0gX3M7XG4gICAgcmV0dXJuIHQuZm9yRWFjaCgoKHQsIG4pID0+IGUgPSBlLmluc2VydCh0LCBuLm92ZXJsYXllZERvY3VtZW50KSkpLCBlO1xufVxuXG5mdW5jdGlvbiBncygpIHtcbiAgICByZXR1cm4gcHMoKTtcbn1cblxuZnVuY3Rpb24geXMoKSB7XG4gICAgcmV0dXJuIHBzKCk7XG59XG5cbmZ1bmN0aW9uIHBzKCkge1xuICAgIHJldHVybiBuZXcgbHMoKHQgPT4gdC50b1N0cmluZygpKSwgKCh0LCBlKSA9PiB0LmlzRXF1YWwoZSkpKTtcbn1cblxuY29uc3QgSXMgPSBuZXcgR2UoY3QuY29tcGFyYXRvcik7XG5cbmNvbnN0IFRzID0gbmV3IFdlKGN0LmNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiBFcyguLi50KSB7XG4gICAgbGV0IGUgPSBUcztcbiAgICBmb3IgKGNvbnN0IG4gb2YgdCkgZSA9IGUuYWRkKG4pO1xuICAgIHJldHVybiBlO1xufVxuXG5jb25zdCBBcyA9IG5ldyBXZShaKTtcblxuZnVuY3Rpb24gUnMoKSB7XG4gICAgcmV0dXJuIEFzO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBldmVudCBmcm9tIHRoZSBSZW1vdGVTdG9yZS4gSXQgaXMgc3BsaXQgaW50byB0YXJnZXRDaGFuZ2VzIChjaGFuZ2VzIHRvIHRoZVxuICogc3RhdGUgb3IgdGhlIHNldCBvZiBkb2N1bWVudHMgaW4gb3VyIHdhdGNoZWQgdGFyZ2V0cykgYW5kIGRvY3VtZW50VXBkYXRlc1xuICogKGNoYW5nZXMgdG8gdGhlIGFjdHVhbCBkb2N1bWVudHMpLlxuICovIGNsYXNzIGJzIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgc25hcHNob3QgdmVyc2lvbiB0aGlzIGV2ZW50IGJyaW5ncyB1cyB1cCB0bywgb3IgTUlOIGlmIG5vdCBzZXQuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogQSBtYXAgZnJvbSB0YXJnZXQgdG8gY2hhbmdlcyB0byB0aGUgdGFyZ2V0LiBTZWUgVGFyZ2V0Q2hhbmdlLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIEEgc2V0IG9mIHRhcmdldHMgdGhhdCBpcyBrbm93biB0byBiZSBpbmNvbnNpc3RlbnQuIExpc3RlbnMgZm9yIHRoZXNlXG4gICAgICogdGFyZ2V0cyBzaG91bGQgYmUgcmUtZXN0YWJsaXNoZWQgd2l0aG91dCByZXN1bWUgdG9rZW5zLlxuICAgICAqL1xuICAgIG4sIFxuICAgIC8qKlxuICAgICAqIEEgc2V0IG9mIHdoaWNoIGRvY3VtZW50cyBoYXZlIGNoYW5nZWQgb3IgYmVlbiBkZWxldGVkLCBhbG9uZyB3aXRoIHRoZVxuICAgICAqIGRvYydzIG5ldyB2YWx1ZXMgKGlmIG5vdCBkZWxldGVkKS5cbiAgICAgKi9cbiAgICBzLCBcbiAgICAvKipcbiAgICAgKiBBIHNldCBvZiB3aGljaCBkb2N1bWVudCB1cGRhdGVzIGFyZSBkdWUgb25seSB0byBsaW1ibyByZXNvbHV0aW9uIHRhcmdldHMuXG4gICAgICovXG4gICAgaSkge1xuICAgICAgICB0aGlzLnNuYXBzaG90VmVyc2lvbiA9IHQsIHRoaXMudGFyZ2V0Q2hhbmdlcyA9IGUsIHRoaXMudGFyZ2V0TWlzbWF0Y2hlcyA9IG4sIHRoaXMuZG9jdW1lbnRVcGRhdGVzID0gcywgXG4gICAgICAgIHRoaXMucmVzb2x2ZWRMaW1ib0RvY3VtZW50cyA9IGk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhBQ0s6IFZpZXdzIHJlcXVpcmUgUmVtb3RlRXZlbnRzIGluIG9yZGVyIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSB2aWV3IGlzXG4gICAgICogQ1VSUkVOVCwgYnV0IHNlY29uZGFyeSB0YWJzIGRvbid0IHJlY2VpdmUgcmVtb3RlIGV2ZW50cy4gU28gdGhpcyBtZXRob2QgaXNcbiAgICAgKiB1c2VkIHRvIGNyZWF0ZSBhIHN5bnRoZXNpemVkIFJlbW90ZUV2ZW50IHRoYXQgY2FuIGJlIHVzZWQgdG8gYXBwbHkgYVxuICAgICAqIENVUlJFTlQgc3RhdHVzIGNoYW5nZSB0byBhIFZpZXcsIGZvciBxdWVyaWVzIGV4ZWN1dGVkIGluIGEgZGlmZmVyZW50IHRhYi5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5XG4gICAgc3RhdGljIGNyZWF0ZVN5bnRoZXNpemVkUmVtb3RlRXZlbnRGb3JDdXJyZW50Q2hhbmdlKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBNYXA7XG4gICAgICAgIHJldHVybiBzLnNldCh0LCBQcy5jcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UodCwgZSwgbikpLCBuZXcgYnMoc3QubWluKCksIHMsIFJzKCksIGRzKCksIEVzKCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIFRhcmdldENoYW5nZSBzcGVjaWZpZXMgdGhlIHNldCBvZiBjaGFuZ2VzIGZvciBhIHNwZWNpZmljIHRhcmdldCBhcyBwYXJ0IG9mXG4gKiBhIFJlbW90ZUV2ZW50LiBUaGVzZSBjaGFuZ2VzIHRyYWNrIHdoaWNoIGRvY3VtZW50cyBhcmUgYWRkZWQsIG1vZGlmaWVkIG9yXG4gKiByZW1vdmVkLCBhcyB3ZWxsIGFzIHRoZSB0YXJnZXQncyByZXN1bWUgdG9rZW4gYW5kIHdoZXRoZXIgdGhlIHRhcmdldCBpc1xuICogbWFya2VkIENVUlJFTlQuXG4gKiBUaGUgYWN0dWFsIGNoYW5nZXMgKnRvKiBkb2N1bWVudHMgYXJlIG5vdCBwYXJ0IG9mIHRoZSBUYXJnZXRDaGFuZ2Ugc2luY2VcbiAqIGRvY3VtZW50cyBtYXkgYmUgcGFydCBvZiBtdWx0aXBsZSB0YXJnZXRzLlxuICovIGNsYXNzIFBzIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHF1ZXJ5IHRvIGJlIHJlc3VtZWRcbiAgICAgKiBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXQgbWF0Y2hlcyB0aGVcbiAgICAgKiBxdWVyeS4gVGhlIHJlc3VtZSB0b2tlbiBlc3NlbnRpYWxseSBpZGVudGlmaWVzIGEgcG9pbnQgaW4gdGltZSBmcm9tIHdoaWNoXG4gICAgICogdGhlIHNlcnZlciBzaG91bGQgcmVzdW1lIHNlbmRpbmcgcmVzdWx0cy5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBUaGUgXCJjdXJyZW50XCIgKHN5bmNlZCkgc3RhdHVzIG9mIHRoaXMgdGFyZ2V0LiBOb3RlIHRoYXQgXCJjdXJyZW50XCJcbiAgICAgKiBoYXMgc3BlY2lhbCBtZWFuaW5nIGluIHRoZSBSUEMgcHJvdG9jb2wgdGhhdCBpbXBsaWVzIHRoYXQgYSB0YXJnZXQgaXNcbiAgICAgKiBib3RoIHVwLXRvLWRhdGUgYW5kIGNvbnNpc3RlbnQgd2l0aCB0aGUgcmVzdCBvZiB0aGUgd2F0Y2ggc3RyZWFtLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgd2VyZSBuZXdseSBhc3NpZ25lZCB0byB0aGlzIHRhcmdldCBhcyBwYXJ0IG9mXG4gICAgICogdGhpcyByZW1vdGUgZXZlbnQuXG4gICAgICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiBkb2N1bWVudHMgdGhhdCB3ZXJlIGFscmVhZHkgYXNzaWduZWQgdG8gdGhpcyB0YXJnZXQgYnV0IHJlY2VpdmVkXG4gICAgICogYW4gdXBkYXRlIGR1cmluZyB0aGlzIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICBzLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2V0IG9mIGRvY3VtZW50cyB0aGF0IHdlcmUgcmVtb3ZlZCBmcm9tIHRoaXMgdGFyZ2V0IGFzIHBhcnQgb2YgdGhpc1xuICAgICAqIHJlbW90ZSBldmVudC5cbiAgICAgKi9cbiAgICBpKSB7XG4gICAgICAgIHRoaXMucmVzdW1lVG9rZW4gPSB0LCB0aGlzLmN1cnJlbnQgPSBlLCB0aGlzLmFkZGVkRG9jdW1lbnRzID0gbiwgdGhpcy5tb2RpZmllZERvY3VtZW50cyA9IHMsIFxuICAgICAgICB0aGlzLnJlbW92ZWREb2N1bWVudHMgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIGNyZWF0ZSBhIHN5bnRoZXNpemVkIFRhcmdldENoYW5nZXMgdGhhdCBjYW4gYmUgdXNlZCB0b1xuICAgICAqIGFwcGx5IGEgQ1VSUkVOVCBzdGF0dXMgY2hhbmdlIHRvIGEgVmlldyAoZm9yIHF1ZXJpZXMgZXhlY3V0ZWQgaW4gYSBkaWZmZXJlbnRcbiAgICAgKiB0YWIpIG9yIGZvciBuZXcgcXVlcmllcyAodG8gcmFpc2Ugc25hcHNob3RzIHdpdGggY29ycmVjdCBDVVJSRU5UIHN0YXR1cykuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFBzKG4sIGUsIEVzKCksIEVzKCksIEVzKCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGNoYW5nZWQgZG9jdW1lbnQgYW5kIGEgbGlzdCBvZiB0YXJnZXQgaWRzIHRvIHdoaWNoIHRoaXMgY2hhbmdlXG4gKiBhcHBsaWVzLlxuICpcbiAqIElmIGRvY3VtZW50IGhhcyBiZWVuIGRlbGV0ZWQgTm9Eb2N1bWVudCB3aWxsIGJlIHByb3ZpZGVkLlxuICovIGNsYXNzIHZzIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIG5ldyBkb2N1bWVudCBhcHBsaWVzIHRvIGFsbCBvZiB0aGVzZSB0YXJnZXRzLiAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUgbmV3IGRvY3VtZW50IGlzIHJlbW92ZWQgZnJvbSBhbGwgb2YgdGhlc2UgdGFyZ2V0cy4gKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGtleSBvZiB0aGUgZG9jdW1lbnQgZm9yIHRoaXMgY2hhbmdlLiAqL1xuICAgIG4sIFxuICAgIC8qKlxuICAgICAqIFRoZSBuZXcgZG9jdW1lbnQgb3IgTm9Eb2N1bWVudCBpZiBpdCB3YXMgZGVsZXRlZC4gSXMgbnVsbCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCB3ZW50IG91dCBvZiB2aWV3IHdpdGhvdXQgdGhlIHNlcnZlciBzZW5kaW5nIGEgbmV3IGRvY3VtZW50LlxuICAgICAqL1xuICAgIHMpIHtcbiAgICAgICAgdGhpcy5JdCA9IHQsIHRoaXMucmVtb3ZlZFRhcmdldElkcyA9IGUsIHRoaXMua2V5ID0gbiwgdGhpcy5UdCA9IHM7XG4gICAgfVxufVxuXG5jbGFzcyBWcyB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLnRhcmdldElkID0gdCwgdGhpcy5FdCA9IGU7XG4gICAgfVxufVxuXG5jbGFzcyBTcyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFdoYXQga2luZCBvZiBjaGFuZ2Ugb2NjdXJyZWQgdG8gdGhlIHdhdGNoIHRhcmdldC4gKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIHRhcmdldCBJRHMgdGhhdCB3ZXJlIGFkZGVkL3JlbW92ZWQvc2V0LiAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIEFuIG9wYXF1ZSwgc2VydmVyLWFzc2lnbmVkIHRva2VuIHRoYXQgYWxsb3dzIHdhdGNoaW5nIGEgdGFyZ2V0IHRvIGJlXG4gICAgICogcmVzdW1lZCBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXRcbiAgICAgKiBtYXRjaGVzIHRoZSB0YXJnZXQuIFRoZSByZXN1bWUgdG9rZW4gZXNzZW50aWFsbHkgaWRlbnRpZmllcyBhIHBvaW50IGluXG4gICAgICogdGltZSBmcm9tIHdoaWNoIHRoZSBzZXJ2ZXIgc2hvdWxkIHJlc3VtZSBzZW5kaW5nIHJlc3VsdHMuXG4gICAgICovXG4gICAgbiA9IFF0LkVNUFRZX0JZVEVfU1RSSU5HXG4gICAgLyoqIEFuIFJQQyBlcnJvciBpbmRpY2F0aW5nIHdoeSB0aGUgd2F0Y2ggZmFpbGVkLiAqLyAsIHMgPSBudWxsKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB0LCB0aGlzLnRhcmdldElkcyA9IGUsIHRoaXMucmVzdW1lVG9rZW4gPSBuLCB0aGlzLmNhdXNlID0gcztcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgdGhlIGludGVybmFsIHN0YXRlIG9mIGEgV2F0Y2ggdGFyZ2V0LiAqLyBjbGFzcyBEcyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIHBlbmRpbmcgcmVzcG9uc2VzIChhZGRzIG9yIHJlbW92ZXMpIHRoYXQgd2UgYXJlIHdhaXRpbmcgb24uXG4gICAgICAgICAqIFdlIG9ubHkgY29uc2lkZXIgdGFyZ2V0cyBhY3RpdmUgdGhhdCBoYXZlIG5vIHBlbmRpbmcgcmVzcG9uc2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5BdCA9IDAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogS2VlcHMgdHJhY2sgb2YgdGhlIGRvY3VtZW50IGNoYW5nZXMgc2luY2UgdGhlIGxhc3QgcmFpc2VkIHNuYXBzaG90LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGVzZSBjaGFuZ2VzIGFyZSBjb250aW51b3VzbHkgdXBkYXRlZCBhcyB3ZSByZWNlaXZlIGRvY3VtZW50IHVwZGF0ZXMgYW5kXG4gICAgICAgICAqIGFsd2F5cyByZWZsZWN0IHRoZSBjdXJyZW50IHNldCBvZiBjaGFuZ2VzIGFnYWluc3QgdGhlIGxhc3QgaXNzdWVkIHNuYXBzaG90LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5SdCA9IE5zKCksIFxuICAgICAgICAvKiogU2VlIHB1YmxpYyBnZXR0ZXJzIGZvciBleHBsYW5hdGlvbnMgb2YgdGhlc2UgZmllbGRzLiAqL1xuICAgICAgICB0aGlzLmJ0ID0gUXQuRU1QVFlfQllURV9TVFJJTkcsIHRoaXMuUHQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoaXMgdGFyZ2V0IHN0YXRlIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgbmV4dCBzbmFwc2hvdC4gV2VcbiAgICAgICAgICogaW5pdGlhbGl6ZSB0byB0cnVlIHNvIHRoYXQgbmV3bHktYWRkZWQgdGFyZ2V0cyBhcmUgaW5jbHVkZWQgaW4gdGhlIG5leHRcbiAgICAgICAgICogUmVtb3RlRXZlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZ0ID0gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhpcyB0YXJnZXQgaGFzIGJlZW4gbWFya2VkICdjdXJyZW50Jy5cbiAgICAgKlxuICAgICAqICdDdXJyZW50JyBoYXMgc3BlY2lhbCBtZWFuaW5nIGluIHRoZSBSUEMgcHJvdG9jb2w6IEl0IGltcGxpZXMgdGhhdCB0aGVcbiAgICAgKiBXYXRjaCBiYWNrZW5kIGhhcyBzZW50IHVzIGFsbCBjaGFuZ2VzIHVwIHRvIHRoZSBwb2ludCBhdCB3aGljaCB0aGUgdGFyZ2V0XG4gICAgICogd2FzIGFkZGVkIGFuZCB0aGF0IHRoZSB0YXJnZXQgaXMgY29uc2lzdGVudCB3aXRoIHRoZSByZXN0IG9mIHRoZSB3YXRjaFxuICAgICAqIHN0cmVhbS5cbiAgICAgKi8gICAgZ2V0IGN1cnJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlB0O1xuICAgIH1cbiAgICAvKiogVGhlIGxhc3QgcmVzdW1lIHRva2VuIHNlbnQgdG8gdXMgZm9yIHRoaXMgdGFyZ2V0LiAqLyAgICBnZXQgcmVzdW1lVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ0O1xuICAgIH1cbiAgICAvKiogV2hldGhlciB0aGlzIHRhcmdldCBoYXMgcGVuZGluZyB0YXJnZXQgYWRkcyBvciB0YXJnZXQgcmVtb3Zlcy4gKi8gICAgZ2V0IFZ0KCkge1xuICAgICAgICByZXR1cm4gMCAhPT0gdGhpcy5BdDtcbiAgICB9XG4gICAgLyoqIFdoZXRoZXIgd2UgaGF2ZSBtb2RpZmllZCBhbnkgc3RhdGUgdGhhdCBzaG91bGQgdHJpZ2dlciBhIHNuYXBzaG90LiAqLyAgICBnZXQgU3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZ0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIHRoZSByZXN1bWUgdG9rZW4gdG8gdGhlIFRhcmdldENoYW5nZSwgYnV0IG9ubHkgd2hlbiBpdCBoYXMgYSBuZXdcbiAgICAgKiB2YWx1ZS4gRW1wdHkgcmVzdW1lVG9rZW5zIGFyZSBkaXNjYXJkZWQuXG4gICAgICovICAgIER0KHQpIHtcbiAgICAgICAgdC5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwICYmICh0aGlzLnZ0ID0gITAsIHRoaXMuYnQgPSB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHRhcmdldCBjaGFuZ2UgZnJvbSB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy5cbiAgICAgKlxuICAgICAqIFRvIHJlc2V0IHRoZSBkb2N1bWVudCBjaGFuZ2VzIGFmdGVyIHJhaXNpbmcgdGhpcyBzbmFwc2hvdCwgY2FsbFxuICAgICAqIGBjbGVhclBlbmRpbmdDaGFuZ2VzKClgLlxuICAgICAqLyAgICBDdCgpIHtcbiAgICAgICAgbGV0IHQgPSBFcygpLCBlID0gRXMoKSwgbiA9IEVzKCk7XG4gICAgICAgIHJldHVybiB0aGlzLlJ0LmZvckVhY2goKChzLCBpKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGkpIHtcbiAgICAgICAgICAgICAgY2FzZSAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gOlxuICAgICAgICAgICAgICAgIHQgPSB0LmFkZChzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA6XG4gICAgICAgICAgICAgICAgZSA9IGUuYWRkKHMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgIG4gPSBuLmFkZChzKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIE8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBuZXcgUHModGhpcy5idCwgdGhpcy5QdCwgdCwgZSwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgZG9jdW1lbnQgY2hhbmdlcyBhbmQgc2V0cyBgaGFzUGVuZGluZ0NoYW5nZXNgIHRvIGZhbHNlLlxuICAgICAqLyAgICB4dCgpIHtcbiAgICAgICAgdGhpcy52dCA9ICExLCB0aGlzLlJ0ID0gTnMoKTtcbiAgICB9XG4gICAgTnQodCwgZSkge1xuICAgICAgICB0aGlzLnZ0ID0gITAsIHRoaXMuUnQgPSB0aGlzLlJ0Lmluc2VydCh0LCBlKTtcbiAgICB9XG4gICAga3QodCkge1xuICAgICAgICB0aGlzLnZ0ID0gITAsIHRoaXMuUnQgPSB0aGlzLlJ0LnJlbW92ZSh0KTtcbiAgICB9XG4gICAgT3QoKSB7XG4gICAgICAgIHRoaXMuQXQgKz0gMTtcbiAgICB9XG4gICAgTXQoKSB7XG4gICAgICAgIHRoaXMuQXQgLT0gMTtcbiAgICB9XG4gICAgRnQoKSB7XG4gICAgICAgIHRoaXMudnQgPSAhMCwgdGhpcy5QdCA9ICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGhlbHBlciBjbGFzcyB0byBhY2N1bXVsYXRlIHdhdGNoIGNoYW5nZXMgaW50byBhIFJlbW90ZUV2ZW50LlxuICovXG5jbGFzcyBDcyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLiR0ID0gdCwgXG4gICAgICAgIC8qKiBUaGUgaW50ZXJuYWwgc3RhdGUgb2YgYWxsIHRyYWNrZWQgdGFyZ2V0cy4gKi9cbiAgICAgICAgdGhpcy5CdCA9IG5ldyBNYXAsIFxuICAgICAgICAvKiogS2VlcHMgdHJhY2sgb2YgdGhlIGRvY3VtZW50cyB0byB1cGRhdGUgc2luY2UgdGhlIGxhc3QgcmFpc2VkIHNuYXBzaG90LiAqL1xuICAgICAgICB0aGlzLkx0ID0gZHMoKSwgXG4gICAgICAgIC8qKiBBIG1hcHBpbmcgb2YgZG9jdW1lbnQga2V5cyB0byB0aGVpciBzZXQgb2YgdGFyZ2V0IElEcy4gKi9cbiAgICAgICAgdGhpcy5xdCA9IHhzKCksIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBsaXN0IG9mIHRhcmdldHMgd2l0aCBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuIFRoZXNlIHRhcmdldHMgYXJlXG4gICAgICAgICAqIGtub3duIHRvIGJlIGluY29uc2lzdGVudCBhbmQgdGhlaXIgbGlzdGVucyBuZWVkcyB0byBiZSByZS1lc3RhYmxpc2hlZCBieVxuICAgICAgICAgKiBSZW1vdGVTdG9yZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVXQgPSBuZXcgV2UoWik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFByb2Nlc3NlcyBhbmQgYWRkcyB0aGUgRG9jdW1lbnRXYXRjaENoYW5nZSB0byB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy5cbiAgICAgKi8gICAgS3QodCkge1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5JdCkgdC5UdCAmJiB0LlR0LmlzRm91bmREb2N1bWVudCgpID8gdGhpcy5HdChlLCB0LlR0KSA6IHRoaXMuUXQoZSwgdC5rZXksIHQuVHQpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5yZW1vdmVkVGFyZ2V0SWRzKSB0aGlzLlF0KGUsIHQua2V5LCB0LlR0KTtcbiAgICB9XG4gICAgLyoqIFByb2Nlc3NlcyBhbmQgYWRkcyB0aGUgV2F0Y2hUYXJnZXRDaGFuZ2UgdG8gdGhlIGN1cnJlbnQgc2V0IG9mIGNoYW5nZXMuICovICAgIGp0KHQpIHtcbiAgICAgICAgdGhpcy5mb3JFYWNoVGFyZ2V0KHQsIChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLld0KGUpO1xuICAgICAgICAgICAgc3dpdGNoICh0LnN0YXRlKSB7XG4gICAgICAgICAgICAgIGNhc2UgMCAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLk5vQ2hhbmdlICovIDpcbiAgICAgICAgICAgICAgICB0aGlzLnp0KGUpICYmIG4uRHQodC5yZXN1bWVUb2tlbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAxIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQWRkZWQgKi8gOlxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZGVjcmVtZW50IHRoZSBudW1iZXIgb2YgcGVuZGluZyBhY2tzIG5lZWRlZCBmcm9tIHdhdGNoXG4gICAgICAgICAgICAgICAgLy8gZm9yIHRoaXMgdGFyZ2V0SWQuXG4gICAgICAgICAgICAgICAgbi5NdCgpLCBuLlZ0IHx8IFxuICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgYSBmcmVzaGx5IGFkZGVkIHRhcmdldCwgc28gd2UgbmVlZCB0byByZXNldCBhbnkgc3RhdGVcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHdlIGhhZCBwcmV2aW91c2x5LiBUaGlzIGNhbiBoYXBwZW4gZS5nLiB3aGVuIHJlbW92ZSBhbmQgYWRkXG4gICAgICAgICAgICAgICAgLy8gYmFjayBhIHRhcmdldCBmb3IgZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaGVzLlxuICAgICAgICAgICAgICAgIG4ueHQoKSwgbi5EdCh0LnJlc3VtZVRva2VuKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDIgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZW1vdmVkICovIDpcbiAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGtlZXAgdHJhY2sgb2YgcmVtb3ZlZCB0YXJnZXRzIHRvIHdlIGNhbiBwb3N0LWZpbHRlciBhbmRcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgYW55IHRhcmdldCBjaGFuZ2VzLlxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZGVjcmVtZW50IHRoZSBudW1iZXIgb2YgcGVuZGluZyBhY2tzIG5lZWRlZCBmcm9tIHdhdGNoXG4gICAgICAgICAgICAgICAgLy8gZm9yIHRoaXMgdGFyZ2V0SWQuXG4gICAgICAgICAgICAgICAgbi5NdCgpLCBuLlZ0IHx8IHRoaXMucmVtb3ZlVGFyZ2V0KGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMyAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLkN1cnJlbnQgKi8gOlxuICAgICAgICAgICAgICAgIHRoaXMuenQoZSkgJiYgKG4uRnQoKSwgbi5EdCh0LnJlc3VtZVRva2VuKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSA0IC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuUmVzZXQgKi8gOlxuICAgICAgICAgICAgICAgIHRoaXMuenQoZSkgJiYgKFxuICAgICAgICAgICAgICAgIC8vIFJlc2V0IHRoZSB0YXJnZXQgYW5kIHN5bnRoZXNpemVzIHJlbW92ZXMgZm9yIGFsbCBleGlzdGluZ1xuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50cy4gVGhlIGJhY2tlbmQgd2lsbCByZS1hZGQgYW55IGRvY3VtZW50cyB0aGF0IHN0aWxsXG4gICAgICAgICAgICAgICAgLy8gbWF0Y2ggdGhlIHRhcmdldCBiZWZvcmUgaXQgc2VuZHMgdGhlIG5leHQgZ2xvYmFsIHNuYXBzaG90LlxuICAgICAgICAgICAgICAgIHRoaXMuSHQoZSksIG4uRHQodC5yZXN1bWVUb2tlbikpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgTygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYWxsIHRhcmdldElkcyB0aGF0IHRoZSB3YXRjaCBjaGFuZ2UgYXBwbGllcyB0bzogZWl0aGVyIHRoZVxuICAgICAqIHRhcmdldElkcyBleHBsaWNpdGx5IGxpc3RlZCBpbiB0aGUgY2hhbmdlIG9yIHRoZSB0YXJnZXRJZHMgb2YgYWxsIGN1cnJlbnRseVxuICAgICAqIGFjdGl2ZSB0YXJnZXRzLlxuICAgICAqLyAgICBmb3JFYWNoVGFyZ2V0KHQsIGUpIHtcbiAgICAgICAgdC50YXJnZXRJZHMubGVuZ3RoID4gMCA/IHQudGFyZ2V0SWRzLmZvckVhY2goZSkgOiB0aGlzLkJ0LmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnp0KG4pICYmIGUobik7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBleGlzdGVuY2UgZmlsdGVycyBhbmQgc3ludGhlc2l6ZXMgZGVsZXRlcyBmb3IgZmlsdGVyIG1pc21hdGNoZXMuXG4gICAgICogVGFyZ2V0cyB0aGF0IGFyZSBpbnZhbGlkYXRlZCBieSBmaWx0ZXIgbWlzbWF0Y2hlcyBhcmUgYWRkZWQgdG9cbiAgICAgKiBgcGVuZGluZ1RhcmdldFJlc2V0c2AuXG4gICAgICovICAgIEp0KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQudGFyZ2V0SWQsIG4gPSB0LkV0LmNvdW50LCBzID0gdGhpcy5ZdChlKTtcbiAgICAgICAgaWYgKHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBzLnRhcmdldDtcbiAgICAgICAgICAgIGlmIChybih0KSkgaWYgKDAgPT09IG4pIHtcbiAgICAgICAgICAgICAgICAvLyBUaGUgZXhpc3RlbmNlIGZpbHRlciB0b2xkIHVzIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBleGlzdC4gV2UgZGVkdWNlXG4gICAgICAgICAgICAgICAgLy8gdGhhdCB0aGlzIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0IGFuZCBhcHBseSBhIGRlbGV0ZWQgZG9jdW1lbnQgdG9cbiAgICAgICAgICAgICAgICAvLyBvdXIgdXBkYXRlcy4gV2l0aG91dCBhcHBseWluZyB0aGlzIGRlbGV0ZWQgZG9jdW1lbnQgdGhlcmUgbWlnaHQgYmVcbiAgICAgICAgICAgICAgICAvLyBhbm90aGVyIHF1ZXJ5IHRoYXQgd2lsbCByYWlzZSB0aGlzIGRvY3VtZW50IGFzIHBhcnQgb2YgYSBzbmFwc2hvdFxuICAgICAgICAgICAgICAgIC8vIHVudGlsIGl0IGlzIHJlc29sdmVkLCBlc3NlbnRpYWxseSBleHBvc2luZyBpbmNvbnNpc3RlbmN5IGJldHdlZW5cbiAgICAgICAgICAgICAgICAvLyBxdWVyaWVzLlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgY3QodC5wYXRoKTtcbiAgICAgICAgICAgICAgICB0aGlzLlF0KGUsIG4sIFplLm5ld05vRG9jdW1lbnQobiwgc3QubWluKCkpKTtcbiAgICAgICAgICAgIH0gZWxzZSBNKDEgPT09IG4pOyBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLlh0KGUpICE9PSBuICYmIChcbiAgICAgICAgICAgICAgICAvLyBFeGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoOiBXZSByZXNldCB0aGUgbWFwcGluZyBhbmQgcmFpc2UgYSBuZXdcbiAgICAgICAgICAgICAgICAvLyBzbmFwc2hvdCB3aXRoIGBpc0Zyb21DYWNoZTp0cnVlYC5cbiAgICAgICAgICAgICAgICB0aGlzLkh0KGUpLCB0aGlzLlV0ID0gdGhpcy5VdC5hZGQoZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBjdXJyZW50bHkgYWNjdW11bGF0ZWQgc3RhdGUgaW50byBhIHJlbW90ZSBldmVudCBhdCB0aGVcbiAgICAgKiBwcm92aWRlZCBzbmFwc2hvdCB2ZXJzaW9uLiBSZXNldHMgdGhlIGFjY3VtdWxhdGVkIGNoYW5nZXMgYmVmb3JlIHJldHVybmluZy5cbiAgICAgKi8gICAgWnQodCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IE1hcDtcbiAgICAgICAgdGhpcy5CdC5mb3JFYWNoKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuWXQocyk7XG4gICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgIGlmIChuLmN1cnJlbnQgJiYgcm4oaS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50IHF1ZXJpZXMgZm9yIGRvY3VtZW50IHRoYXQgZG9uJ3QgZXhpc3QgY2FuIHByb2R1Y2UgYW4gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0IHNldC4gVG8gdXBkYXRlIG91ciBsb2NhbCBjYWNoZSwgd2Ugc3ludGhlc2l6ZSBhIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBpZiB3ZSBoYXZlIG5vdCBwcmV2aW91c2x5IHJlY2VpdmVkIHRoZSBkb2N1bWVudC4gVGhpc1xuICAgICAgICAgICAgICAgICAgICAvLyByZXNvbHZlcyB0aGUgbGltYm8gc3RhdGUgb2YgdGhlIGRvY3VtZW50LCByZW1vdmluZyBpdCBmcm9tXG4gICAgICAgICAgICAgICAgICAgIC8vIGxpbWJvRG9jdW1lbnRSZWZzLlxuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElkZWFsbHkgd2Ugd291bGQgaGF2ZSBhbiBleHBsaWNpdCBsb29rdXAgdGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgIC8vIGluc3RlYWQgcmVzdWx0aW5nIGluIGFuIGV4cGxpY2l0IGRlbGV0ZSBtZXNzYWdlIGFuZCB3ZSBjb3VsZFxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhpcyBzcGVjaWFsIGxvZ2ljLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IGN0KGkudGFyZ2V0LnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9PSB0aGlzLkx0LmdldChlKSB8fCB0aGlzLnRlKHMsIGUpIHx8IHRoaXMuUXQocywgZSwgWmUubmV3Tm9Eb2N1bWVudChlLCB0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG4uU3QgJiYgKGUuc2V0KHMsIG4uQ3QoKSksIG4ueHQoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgbGV0IG4gPSBFcygpO1xuICAgICAgICAvLyBXZSBleHRyYWN0IHRoZSBzZXQgb2YgbGltYm8tb25seSBkb2N1bWVudCB1cGRhdGVzIGFzIHRoZSBHQyBsb2dpY1xuICAgICAgICAvLyBzcGVjaWFsLWNhc2VzIGRvY3VtZW50cyB0aGF0IGRvIG5vdCBhcHBlYXIgaW4gdGhlIHRhcmdldCBjYWNoZS5cbiAgICAgICAgXG4gICAgICAgIC8vIFRPRE8oZ3NvbHRpcyk6IEV4cGFuZCBvbiB0aGlzIGNvbW1lbnQgb25jZSBHQyBpcyBhdmFpbGFibGUgaW4gdGhlIEpTXG4gICAgICAgIC8vIGNsaWVudC5cbiAgICAgICAgICAgICAgICB0aGlzLnF0LmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBsZXQgcyA9ICEwO1xuICAgICAgICAgICAgZS5mb3JFYWNoV2hpbGUoKHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLll0KHQpO1xuICAgICAgICAgICAgICAgIHJldHVybiAhZSB8fCAyIC8qIFRhcmdldFB1cnBvc2UuTGltYm9SZXNvbHV0aW9uICovID09PSBlLnB1cnBvc2UgfHwgKHMgPSAhMSwgITEpO1xuICAgICAgICAgICAgfSkpLCBzICYmIChuID0gbi5hZGQodCkpO1xuICAgICAgICB9KSksIHRoaXMuTHQuZm9yRWFjaCgoKGUsIG4pID0+IG4uc2V0UmVhZFRpbWUodCkpKTtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBicyh0LCBlLCB0aGlzLlV0LCB0aGlzLkx0LCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuTHQgPSBkcygpLCB0aGlzLnF0ID0geHMoKSwgdGhpcy5VdCA9IG5ldyBXZShaKSwgcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgdG8gdGhlIGludGVybmFsIGxpc3Qgb2YgZG9jdW1lbnQgdXBkYXRlcyBhbmRcbiAgICAgKiBpdHMgZG9jdW1lbnQga2V5IHRvIHRoZSBnaXZlbiB0YXJnZXQncyBtYXBwaW5nLlxuICAgICAqL1xuICAgIC8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gICAgR3QodCwgZSkge1xuICAgICAgICBpZiAoIXRoaXMuenQodCkpIHJldHVybjtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMudGUodCwgZS5rZXkpID8gMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDogMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovO1xuICAgICAgICB0aGlzLld0KHQpLk50KGUua2V5LCBuKSwgdGhpcy5MdCA9IHRoaXMuTHQuaW5zZXJ0KGUua2V5LCBlKSwgdGhpcy5xdCA9IHRoaXMucXQuaW5zZXJ0KGUua2V5LCB0aGlzLmVlKGUua2V5KS5hZGQodCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBwcm92aWRlZCBkb2N1bWVudCBmcm9tIHRoZSB0YXJnZXQgbWFwcGluZy4gSWYgdGhlXG4gICAgICogZG9jdW1lbnQgbm8gbG9uZ2VyIG1hdGNoZXMgdGhlIHRhcmdldCwgYnV0IHRoZSBkb2N1bWVudCdzIHN0YXRlIGlzIHN0aWxsXG4gICAgICoga25vd24gKGUuZy4gd2Uga25vdyB0aGF0IHRoZSBkb2N1bWVudCB3YXMgZGVsZXRlZCBvciB3ZSByZWNlaXZlZCB0aGUgY2hhbmdlXG4gICAgICogdGhhdCBjYXVzZWQgdGhlIGZpbHRlciBtaXNtYXRjaCksIHRoZSBuZXcgZG9jdW1lbnQgY2FuIGJlIHByb3ZpZGVkXG4gICAgICogdG8gdXBkYXRlIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUuXG4gICAgICovXG4gICAgLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAgICBRdCh0LCBlLCBuKSB7XG4gICAgICAgIGlmICghdGhpcy56dCh0KSkgcmV0dXJuO1xuICAgICAgICBjb25zdCBzID0gdGhpcy5XdCh0KTtcbiAgICAgICAgdGhpcy50ZSh0LCBlKSA/IHMuTnQoZSwgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8pIDogXG4gICAgICAgIC8vIFRoZSBkb2N1bWVudCBtYXkgaGF2ZSBlbnRlcmVkIGFuZCBsZWZ0IHRoZSB0YXJnZXQgYmVmb3JlIHdlIHJhaXNlZCBhXG4gICAgICAgIC8vIHNuYXBzaG90LCBzbyB3ZSBjYW4ganVzdCBpZ25vcmUgdGhlIGNoYW5nZS5cbiAgICAgICAgcy5rdChlKSwgdGhpcy5xdCA9IHRoaXMucXQuaW5zZXJ0KGUsIHRoaXMuZWUoZSkuZGVsZXRlKHQpKSwgbiAmJiAodGhpcy5MdCA9IHRoaXMuTHQuaW5zZXJ0KGUsIG4pKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KHQpIHtcbiAgICAgICAgdGhpcy5CdC5kZWxldGUodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgY291bnQgb2YgZG9jdW1lbnRzIGluIHRoZSB0YXJnZXQuIFRoaXMgaW5jbHVkZXMgYm90aFxuICAgICAqIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHRoYXQgdGhlIExvY2FsU3RvcmUgY29uc2lkZXJzIHRvIGJlIHBhcnQgb2YgdGhlXG4gICAgICogdGFyZ2V0IGFzIHdlbGwgYXMgYW55IGFjY3VtdWxhdGVkIGNoYW5nZXMuXG4gICAgICovICAgIFh0KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuV3QodCkuQ3QoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHQuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCh0KS5zaXplICsgZS5hZGRlZERvY3VtZW50cy5zaXplIC0gZS5yZW1vdmVkRG9jdW1lbnRzLnNpemU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluY3JlbWVudCB0aGUgbnVtYmVyIG9mIGFja3MgbmVlZGVkIGZyb20gd2F0Y2ggYmVmb3JlIHdlIGNhbiBjb25zaWRlciB0aGVcbiAgICAgKiBzZXJ2ZXIgdG8gYmUgJ2luLXN5bmMnIHdpdGggdGhlIGNsaWVudCdzIGFjdGl2ZSB0YXJnZXRzLlxuICAgICAqLyAgICBPdCh0KSB7XG4gICAgICAgIHRoaXMuV3QodCkuT3QoKTtcbiAgICB9XG4gICAgV3QodCkge1xuICAgICAgICBsZXQgZSA9IHRoaXMuQnQuZ2V0KHQpO1xuICAgICAgICByZXR1cm4gZSB8fCAoZSA9IG5ldyBEcywgdGhpcy5CdC5zZXQodCwgZSkpLCBlO1xuICAgIH1cbiAgICBlZSh0KSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5xdC5nZXQodCk7XG4gICAgICAgIHJldHVybiBlIHx8IChlID0gbmV3IFdlKFopLCB0aGlzLnF0ID0gdGhpcy5xdC5pbnNlcnQodCwgZSkpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWZXJpZmllcyB0aGF0IHRoZSB1c2VyIGlzIHN0aWxsIGludGVyZXN0ZWQgaW4gdGhpcyB0YXJnZXQgKGJ5IGNhbGxpbmdcbiAgICAgKiBgZ2V0VGFyZ2V0RGF0YUZvclRhcmdldCgpYCkgYW5kIHRoYXQgd2UgYXJlIG5vdCB3YWl0aW5nIGZvciBwZW5kaW5nIEFERHNcbiAgICAgKiBmcm9tIHdhdGNoLlxuICAgICAqLyAgICB6dCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBudWxsICE9PSB0aGlzLll0KHQpO1xuICAgICAgICByZXR1cm4gZSB8fCBDKFwiV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yXCIsIFwiRGV0ZWN0ZWQgaW5hY3RpdmUgdGFyZ2V0XCIsIHQpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBUYXJnZXREYXRhIGZvciBhbiBhY3RpdmUgdGFyZ2V0IChpLmUuIGEgdGFyZ2V0IHRoYXQgdGhlIHVzZXJcbiAgICAgKiBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoYXQgaGFzIG5vIG91dHN0YW5kaW5nIHRhcmdldCBjaGFuZ2UgcmVxdWVzdHMpLlxuICAgICAqLyAgICBZdCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLkJ0LmdldCh0KTtcbiAgICAgICAgcmV0dXJuIGUgJiYgZS5WdCA/IG51bGwgOiB0aGlzLiR0Lm5lKHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIHN0YXRlIG9mIGEgV2F0Y2ggdGFyZ2V0IHRvIGl0cyBpbml0aWFsIHN0YXRlIChlLmcuIHNldHNcbiAgICAgKiAnY3VycmVudCcgdG8gZmFsc2UsIGNsZWFycyB0aGUgcmVzdW1lIHRva2VuIGFuZCByZW1vdmVzIGl0cyB0YXJnZXQgbWFwcGluZ1xuICAgICAqIGZyb20gYWxsIGRvY3VtZW50cykuXG4gICAgICovICAgIEh0KHQpIHtcbiAgICAgICAgdGhpcy5CdC5zZXQodCwgbmV3IERzKTtcbiAgICAgICAgdGhpcy4kdC5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KHQpLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5RdCh0LCBlLCAvKnVwZGF0ZWREb2N1bWVudD0qLyBudWxsKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIExvY2FsU3RvcmUgY29uc2lkZXJzIHRoZSBkb2N1bWVudCB0byBiZSBwYXJ0IG9mIHRoZVxuICAgICAqIHNwZWNpZmllZCB0YXJnZXQuXG4gICAgICovICAgIHRlKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJHQuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCh0KS5oYXMoZSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB4cygpIHtcbiAgICByZXR1cm4gbmV3IEdlKGN0LmNvbXBhcmF0b3IpO1xufVxuXG5mdW5jdGlvbiBOcygpIHtcbiAgICByZXR1cm4gbmV3IEdlKGN0LmNvbXBhcmF0b3IpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBrcyA9ICgoKSA9PiB7XG4gICAgY29uc3QgdCA9IHtcbiAgICAgICAgYXNjOiBcIkFTQ0VORElOR1wiLFxuICAgICAgICBkZXNjOiBcIkRFU0NFTkRJTkdcIlxuICAgIH07XG4gICAgcmV0dXJuIHQ7XG59KSgpLCBPcyA9ICgoKSA9PiB7XG4gICAgY29uc3QgdCA9IHtcbiAgICAgICAgXCI8XCI6IFwiTEVTU19USEFOXCIsXG4gICAgICAgIFwiPD1cIjogXCJMRVNTX1RIQU5fT1JfRVFVQUxcIixcbiAgICAgICAgXCI+XCI6IFwiR1JFQVRFUl9USEFOXCIsXG4gICAgICAgIFwiPj1cIjogXCJHUkVBVEVSX1RIQU5fT1JfRVFVQUxcIixcbiAgICAgICAgXCI9PVwiOiBcIkVRVUFMXCIsXG4gICAgICAgIFwiIT1cIjogXCJOT1RfRVFVQUxcIixcbiAgICAgICAgXCJhcnJheS1jb250YWluc1wiOiBcIkFSUkFZX0NPTlRBSU5TXCIsXG4gICAgICAgIGluOiBcIklOXCIsXG4gICAgICAgIFwibm90LWluXCI6IFwiTk9UX0lOXCIsXG4gICAgICAgIFwiYXJyYXktY29udGFpbnMtYW55XCI6IFwiQVJSQVlfQ09OVEFJTlNfQU5ZXCJcbiAgICB9O1xuICAgIHJldHVybiB0O1xufSkoKSwgTXMgPSAoKCkgPT4ge1xuICAgIGNvbnN0IHQgPSB7XG4gICAgICAgIGFuZDogXCJBTkRcIixcbiAgICAgICAgb3I6IFwiT1JcIlxuICAgIH07XG4gICAgcmV0dXJuIHQ7XG59KSgpO1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgZ2VuZXJhdGVzIEpzb25PYmplY3QgdmFsdWVzIGZvciB0aGUgRGF0YXN0b3JlIEFQSSBzdWl0YWJsZSBmb3JcbiAqIHNlbmRpbmcgdG8gZWl0aGVyIEdSUEMgc3R1YiBtZXRob2RzIG9yIHZpYSB0aGUgSlNPTi9IVFRQIFJFU1QgQVBJLlxuICpcbiAqIFRoZSBzZXJpYWxpemVyIHN1cHBvcnRzIGJvdGggUHJvdG9idWYuanMgYW5kIFByb3RvMyBKU09OIGZvcm1hdHMuIEJ5XG4gKiBzZXR0aW5nIGB1c2VQcm90bzNKc29uYCB0byB0cnVlLCB0aGUgc2VyaWFsaXplciB3aWxsIHVzZSB0aGUgUHJvdG8zIEpTT05cbiAqIGZvcm1hdC5cbiAqXG4gKiBGb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGUgUHJvdG8zIEpTT04gZm9ybWF0IGNoZWNrXG4gKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9wcm90b2NvbC1idWZmZXJzL2RvY3MvcHJvdG8zI2pzb25cbiAqXG4gKiBUT0RPKGtsaW10KTogV2UgY2FuIHJlbW92ZSB0aGUgZGF0YWJhc2VJZCBhcmd1bWVudCBpZiB3ZSBrZWVwIHRoZSBmdWxsXG4gKiByZXNvdXJjZSBuYW1lIGluIGRvY3VtZW50cy5cbiAqL1xuY2xhc3MgRnMge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gdCwgdGhpcy53dCA9IGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSB2YWx1ZSBmb3IgYSBEYXRlIHRoYXQncyBhcHByb3ByaWF0ZSB0byBwdXQgaW50byBhIHByb3RvLlxuICovXG5mdW5jdGlvbiAkcyh0LCBlKSB7XG4gICAgaWYgKHQud3QpIHtcbiAgICAgICAgcmV0dXJuIGAke25ldyBEYXRlKDFlMyAqIGUuc2Vjb25kcykudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9cXC5cXGQqLywgXCJcIikucmVwbGFjZShcIlpcIiwgXCJcIil9LiR7KFwiMDAwMDAwMDAwXCIgKyBlLm5hbm9zZWNvbmRzKS5zbGljZSgtOSl9WmA7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHNlY29uZHM6IFwiXCIgKyBlLnNlY29uZHMsXG4gICAgICAgIG5hbm9zOiBlLm5hbm9zZWNvbmRzXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgdmFsdWUgZm9yIGJ5dGVzIHRoYXQncyBhcHByb3ByaWF0ZSB0byBwdXQgaW4gYSBwcm90by5cbiAqXG4gKiBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICovXG5mdW5jdGlvbiBCcyh0LCBlKSB7XG4gICAgcmV0dXJuIHQud3QgPyBlLnRvQmFzZTY0KCkgOiBlLnRvVWludDhBcnJheSgpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBCeXRlU3RyaW5nIGJhc2VkIG9uIHRoZSBwcm90byBzdHJpbmcgdmFsdWUuXG4gKi8gZnVuY3Rpb24gTHModCwgZSkge1xuICAgIHJldHVybiAkcyh0LCBlLnRvVGltZXN0YW1wKCkpO1xufVxuXG5mdW5jdGlvbiBxcyh0KSB7XG4gICAgcmV0dXJuIE0oISF0KSwgc3QuZnJvbVRpbWVzdGFtcChmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBXdCh0KTtcbiAgICAgICAgcmV0dXJuIG5ldyBudChlLnNlY29uZHMsIGUubmFub3MpO1xuICAgIH0odCkpO1xufVxuXG5mdW5jdGlvbiBVcyh0LCBlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBydChbIFwicHJvamVjdHNcIiwgdC5wcm9qZWN0SWQsIFwiZGF0YWJhc2VzXCIsIHQuZGF0YWJhc2UgXSk7XG4gICAgfSh0KS5jaGlsZChcImRvY3VtZW50c1wiKS5jaGlsZChlKS5jYW5vbmljYWxTdHJpbmcoKTtcbn1cblxuZnVuY3Rpb24gS3ModCkge1xuICAgIGNvbnN0IGUgPSBydC5mcm9tU3RyaW5nKHQpO1xuICAgIHJldHVybiBNKHdpKGUpKSwgZTtcbn1cblxuZnVuY3Rpb24gR3ModCwgZSkge1xuICAgIHJldHVybiBVcyh0LmRhdGFiYXNlSWQsIGUucGF0aCk7XG59XG5cbmZ1bmN0aW9uIFFzKHQsIGUpIHtcbiAgICBjb25zdCBuID0gS3MoZSk7XG4gICAgaWYgKG4uZ2V0KDEpICE9PSB0LmRhdGFiYXNlSWQucHJvamVjdElkKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiVHJpZWQgdG8gZGVzZXJpYWxpemUga2V5IGZyb20gZGlmZmVyZW50IHByb2plY3Q6IFwiICsgbi5nZXQoMSkgKyBcIiB2cyBcIiArIHQuZGF0YWJhc2VJZC5wcm9qZWN0SWQpO1xuICAgIGlmIChuLmdldCgzKSAhPT0gdC5kYXRhYmFzZUlkLmRhdGFiYXNlKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiVHJpZWQgdG8gZGVzZXJpYWxpemUga2V5IGZyb20gZGlmZmVyZW50IGRhdGFiYXNlOiBcIiArIG4uZ2V0KDMpICsgXCIgdnMgXCIgKyB0LmRhdGFiYXNlSWQuZGF0YWJhc2UpO1xuICAgIHJldHVybiBuZXcgY3QoSHMobikpO1xufVxuXG5mdW5jdGlvbiBqcyh0LCBlKSB7XG4gICAgcmV0dXJuIFVzKHQuZGF0YWJhc2VJZCwgZSk7XG59XG5cbmZ1bmN0aW9uIFdzKHQpIHtcbiAgICBjb25zdCBlID0gS3ModCk7XG4gICAgLy8gSW4gdjFiZXRhMSBxdWVyaWVzIGZvciBjb2xsZWN0aW9ucyBhdCB0aGUgcm9vdCBkaWQgbm90IGhhdmUgYSB0cmFpbGluZ1xuICAgIC8vIFwiL2RvY3VtZW50c1wiLiBJbiB2MSBhbGwgcmVzb3VyY2UgcGF0aHMgY29udGFpbiBcIi9kb2N1bWVudHNcIi4gUHJlc2VydmUgdGhlXG4gICAgLy8gYWJpbGl0eSB0byByZWFkIHRoZSB2MWJldGExIGZvcm0gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBxdWVyaWVzIHBlcnNpc3RlZFxuICAgIC8vIGluIHRoZSBsb2NhbCB0YXJnZXQgY2FjaGUuXG4gICAgICAgIHJldHVybiA0ID09PSBlLmxlbmd0aCA/IHJ0LmVtcHR5UGF0aCgpIDogSHMoZSk7XG59XG5cbmZ1bmN0aW9uIHpzKHQpIHtcbiAgICByZXR1cm4gbmV3IHJ0KFsgXCJwcm9qZWN0c1wiLCB0LmRhdGFiYXNlSWQucHJvamVjdElkLCBcImRhdGFiYXNlc1wiLCB0LmRhdGFiYXNlSWQuZGF0YWJhc2UgXSkuY2Fub25pY2FsU3RyaW5nKCk7XG59XG5cbmZ1bmN0aW9uIEhzKHQpIHtcbiAgICByZXR1cm4gTSh0Lmxlbmd0aCA+IDQgJiYgXCJkb2N1bWVudHNcIiA9PT0gdC5nZXQoNCkpLCB0LnBvcEZpcnN0KDUpO1xufVxuXG4vKiogQ3JlYXRlcyBhIERvY3VtZW50IHByb3RvIGZyb20ga2V5IGFuZCBmaWVsZHMgKGJ1dCBubyBjcmVhdGUvdXBkYXRlIHRpbWUpICovIGZ1bmN0aW9uIEpzKHQsIGUsIG4pIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiBHcyh0LCBlKSxcbiAgICAgICAgZmllbGRzOiBuLnZhbHVlLm1hcFZhbHVlLmZpZWxkc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIFlzKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gUXModCwgZS5uYW1lKSwgaSA9IHFzKGUudXBkYXRlVGltZSksIHIgPSBlLmNyZWF0ZVRpbWUgPyBxcyhlLmNyZWF0ZVRpbWUpIDogc3QubWluKCksIG8gPSBuZXcgWWUoe1xuICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgZmllbGRzOiBlLmZpZWxkc1xuICAgICAgICB9XG4gICAgfSksIHUgPSBaZS5uZXdGb3VuZERvY3VtZW50KHMsIGksIHIsIG8pO1xuICAgIHJldHVybiBuICYmIHUuc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCksIG4gPyB1LnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpIDogdTtcbn1cblxuZnVuY3Rpb24gWHModCwgZSkge1xuICAgIHJldHVybiBcImZvdW5kXCIgaW4gZSA/IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgTSghIWUuZm91bmQpLCBlLmZvdW5kLm5hbWUsIGUuZm91bmQudXBkYXRlVGltZTtcbiAgICAgICAgY29uc3QgbiA9IFFzKHQsIGUuZm91bmQubmFtZSksIHMgPSBxcyhlLmZvdW5kLnVwZGF0ZVRpbWUpLCBpID0gZS5mb3VuZC5jcmVhdGVUaW1lID8gcXMoZS5mb3VuZC5jcmVhdGVUaW1lKSA6IHN0Lm1pbigpLCByID0gbmV3IFllKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiBlLmZvdW5kLmZpZWxkc1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFplLm5ld0ZvdW5kRG9jdW1lbnQobiwgcywgaSwgcik7XG4gICAgfSh0LCBlKSA6IFwibWlzc2luZ1wiIGluIGUgPyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIE0oISFlLm1pc3NpbmcpLCBNKCEhZS5yZWFkVGltZSk7XG4gICAgICAgIGNvbnN0IG4gPSBRcyh0LCBlLm1pc3NpbmcpLCBzID0gcXMoZS5yZWFkVGltZSk7XG4gICAgICAgIHJldHVybiBaZS5uZXdOb0RvY3VtZW50KG4sIHMpO1xuICAgIH0odCwgZSkgOiBPKCk7XG59XG5cbmZ1bmN0aW9uIFpzKHQsIGUpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAoXCJ0YXJnZXRDaGFuZ2VcIiBpbiBlKSB7XG4gICAgICAgIGUudGFyZ2V0Q2hhbmdlO1xuICAgICAgICAvLyBwcm90bzMgZGVmYXVsdCB2YWx1ZSBpcyB1bnNldCBpbiBKU09OICh1bmRlZmluZWQpLCBzbyB1c2UgJ05PX0NIQU5HRSdcbiAgICAgICAgLy8gaWYgdW5zZXRcbiAgICAgICAgY29uc3QgcyA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBcIk5PX0NIQU5HRVwiID09PSB0ID8gMCAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLk5vQ2hhbmdlICovIDogXCJBRERcIiA9PT0gdCA/IDEgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5BZGRlZCAqLyA6IFwiUkVNT1ZFXCIgPT09IHQgPyAyIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuUmVtb3ZlZCAqLyA6IFwiQ1VSUkVOVFwiID09PSB0ID8gMyAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLkN1cnJlbnQgKi8gOiBcIlJFU0VUXCIgPT09IHQgPyA0IC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuUmVzZXQgKi8gOiBPKCk7XG4gICAgICAgIH0oZS50YXJnZXRDaGFuZ2UudGFyZ2V0Q2hhbmdlVHlwZSB8fCBcIk5PX0NIQU5HRVwiKSwgaSA9IGUudGFyZ2V0Q2hhbmdlLnRhcmdldElkcyB8fCBbXSwgciA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0Lnd0ID8gKE0odm9pZCAwID09PSBlIHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpLCBRdC5mcm9tQmFzZTY0U3RyaW5nKGUgfHwgXCJcIikpIDogKE0odm9pZCAwID09PSBlIHx8IGUgaW5zdGFuY2VvZiBVaW50OEFycmF5KSwgXG4gICAgICAgICAgICBRdC5mcm9tVWludDhBcnJheShlIHx8IG5ldyBVaW50OEFycmF5KSk7XG4gICAgICAgIH0odCwgZS50YXJnZXRDaGFuZ2UucmVzdW1lVG9rZW4pLCBvID0gZS50YXJnZXRDaGFuZ2UuY2F1c2UsIHUgPSBvICYmIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB2b2lkIDAgPT09IHQuY29kZSA/IEIuVU5LTk9XTiA6IGhzKHQuY29kZSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEwoZSwgdC5tZXNzYWdlIHx8IFwiXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIG51bWJlciAob3IgbnVsbCkgdGhhdCdzIGFwcHJvcHJpYXRlIHRvIHB1dCBpbnRvXG4gKiBhIGdvb2dsZS5wcm90b2J1Zi5JbnQzMlZhbHVlIHByb3RvLlxuICogRE8gTk9UIFVTRSBUSElTIEZPUiBBTllUSElORyBFTFNFLlxuICogVGhpcyBtZXRob2QgY2hlYXRzLiBJdCdzIHR5cGVkIGFzIHJldHVybmluZyBcIm51bWJlclwiIGJlY2F1c2UgdGhhdCdzIHdoYXRcbiAqIG91ciBnZW5lcmF0ZWQgcHJvdG8gaW50ZXJmYWNlcyBzYXkgSW50MzJWYWx1ZSBtdXN0IGJlLiBCdXQgR1JQQyBhY3R1YWxseVxuICogZXhwZWN0cyBhIHsgdmFsdWU6IDxudW1iZXI+IH0gc3RydWN0LlxuICovIChvKTtcbiAgICAgICAgbiA9IG5ldyBTcyhzLCBpLCByLCB1IHx8IG51bGwpO1xuICAgIH0gZWxzZSBpZiAoXCJkb2N1bWVudENoYW5nZVwiIGluIGUpIHtcbiAgICAgICAgZS5kb2N1bWVudENoYW5nZTtcbiAgICAgICAgY29uc3QgcyA9IGUuZG9jdW1lbnRDaGFuZ2U7XG4gICAgICAgIHMuZG9jdW1lbnQsIHMuZG9jdW1lbnQubmFtZSwgcy5kb2N1bWVudC51cGRhdGVUaW1lO1xuICAgICAgICBjb25zdCBpID0gUXModCwgcy5kb2N1bWVudC5uYW1lKSwgciA9IHFzKHMuZG9jdW1lbnQudXBkYXRlVGltZSksIG8gPSBzLmRvY3VtZW50LmNyZWF0ZVRpbWUgPyBxcyhzLmRvY3VtZW50LmNyZWF0ZVRpbWUpIDogc3QubWluKCksIHUgPSBuZXcgWWUoe1xuICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHMuZG9jdW1lbnQuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCBjID0gWmUubmV3Rm91bmREb2N1bWVudChpLCByLCBvLCB1KSwgYSA9IHMudGFyZ2V0SWRzIHx8IFtdLCBoID0gcy5yZW1vdmVkVGFyZ2V0SWRzIHx8IFtdO1xuICAgICAgICBuID0gbmV3IHZzKGEsIGgsIGMua2V5LCBjKTtcbiAgICB9IGVsc2UgaWYgKFwiZG9jdW1lbnREZWxldGVcIiBpbiBlKSB7XG4gICAgICAgIGUuZG9jdW1lbnREZWxldGU7XG4gICAgICAgIGNvbnN0IHMgPSBlLmRvY3VtZW50RGVsZXRlO1xuICAgICAgICBzLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBpID0gUXModCwgcy5kb2N1bWVudCksIHIgPSBzLnJlYWRUaW1lID8gcXMocy5yZWFkVGltZSkgOiBzdC5taW4oKSwgbyA9IFplLm5ld05vRG9jdW1lbnQoaSwgciksIHUgPSBzLnJlbW92ZWRUYXJnZXRJZHMgfHwgW107XG4gICAgICAgIG4gPSBuZXcgdnMoW10sIHUsIG8ua2V5LCBvKTtcbiAgICB9IGVsc2UgaWYgKFwiZG9jdW1lbnRSZW1vdmVcIiBpbiBlKSB7XG4gICAgICAgIGUuZG9jdW1lbnRSZW1vdmU7XG4gICAgICAgIGNvbnN0IHMgPSBlLmRvY3VtZW50UmVtb3ZlO1xuICAgICAgICBzLmRvY3VtZW50O1xuICAgICAgICBjb25zdCBpID0gUXModCwgcy5kb2N1bWVudCksIHIgPSBzLnJlbW92ZWRUYXJnZXRJZHMgfHwgW107XG4gICAgICAgIG4gPSBuZXcgdnMoW10sIHIsIGksIG51bGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICghKFwiZmlsdGVyXCIgaW4gZSkpIHJldHVybiBPKCk7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGUuZmlsdGVyO1xuICAgICAgICAgICAgY29uc3QgdCA9IGUuZmlsdGVyO1xuICAgICAgICAgICAgdC50YXJnZXRJZDtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0LmNvdW50IHx8IDAsIGkgPSBuZXcgb3MocyksIHIgPSB0LnRhcmdldElkO1xuICAgICAgICAgICAgbiA9IG5ldyBWcyhyLCBpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbjtcbn1cblxuZnVuY3Rpb24gdGkodCwgZSkge1xuICAgIGxldCBuO1xuICAgIGlmIChlIGluc3RhbmNlb2YgWm4pIG4gPSB7XG4gICAgICAgIHVwZGF0ZTogSnModCwgZS5rZXksIGUudmFsdWUpXG4gICAgfTsgZWxzZSBpZiAoZSBpbnN0YW5jZW9mIGlzKSBuID0ge1xuICAgICAgICBkZWxldGU6IEdzKHQsIGUua2V5KVxuICAgIH07IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiB0cykgbiA9IHtcbiAgICAgICAgdXBkYXRlOiBKcyh0LCBlLmtleSwgZS5kYXRhKSxcbiAgICAgICAgdXBkYXRlTWFzazogX2koZS5maWVsZE1hc2spXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBycykpIHJldHVybiBPKCk7XG4gICAgICAgIG4gPSB7XG4gICAgICAgICAgICB2ZXJpZnk6IEdzKHQsIGUua2V5KVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZS5maWVsZFRyYW5zZm9ybXMubGVuZ3RoID4gMCAmJiAobi51cGRhdGVUcmFuc2Zvcm1zID0gZS5maWVsZFRyYW5zZm9ybXMubWFwKCh0ID0+IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUudHJhbnNmb3JtO1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIGtuKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiBlLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgc2V0VG9TZXJ2ZXJWYWx1ZTogXCJSRVFVRVNUX1RJTUVcIlxuICAgICAgICB9O1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIE9uKSByZXR1cm4ge1xuICAgICAgICAgICAgZmllbGRQYXRoOiBlLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpLFxuICAgICAgICAgICAgYXBwZW5kTWlzc2luZ0VsZW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBuLmVsZW1lbnRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgRm4pIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZFBhdGg6IGUuZmllbGQuY2Fub25pY2FsU3RyaW5nKCksXG4gICAgICAgICAgICByZW1vdmVBbGxGcm9tQXJyYXk6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IG4uZWxlbWVudHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBCbikgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIGluY3JlbWVudDogbi5ndFxuICAgICAgICB9O1xuICAgICAgICB0aHJvdyBPKCk7XG4gICAgfSgwLCB0KSkpKSwgZS5wcmVjb25kaXRpb24uaXNOb25lIHx8IChuLmN1cnJlbnREb2N1bWVudCA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZS51cGRhdGVUaW1lID8ge1xuICAgICAgICAgICAgdXBkYXRlVGltZTogTHModCwgZS51cGRhdGVUaW1lKVxuICAgICAgICB9IDogdm9pZCAwICE9PSBlLmV4aXN0cyA/IHtcbiAgICAgICAgICAgIGV4aXN0czogZS5leGlzdHNcbiAgICAgICAgfSA6IE8oKTtcbiAgICB9KHQsIGUucHJlY29uZGl0aW9uKSksIG47XG59XG5cbmZ1bmN0aW9uIGVpKHQsIGUpIHtcbiAgICBjb25zdCBuID0gZS5jdXJyZW50RG9jdW1lbnQgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHQudXBkYXRlVGltZSA/IFFuLnVwZGF0ZVRpbWUocXModC51cGRhdGVUaW1lKSkgOiB2b2lkIDAgIT09IHQuZXhpc3RzID8gUW4uZXhpc3RzKHQuZXhpc3RzKSA6IFFuLm5vbmUoKTtcbiAgICB9KGUuY3VycmVudERvY3VtZW50KSA6IFFuLm5vbmUoKSwgcyA9IGUudXBkYXRlVHJhbnNmb3JtcyA/IGUudXBkYXRlVHJhbnNmb3Jtcy5tYXAoKGUgPT4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBsZXQgbiA9IG51bGw7XG4gICAgICAgIGlmIChcInNldFRvU2VydmVyVmFsdWVcIiBpbiBlKSBNKFwiUkVRVUVTVF9USU1FXCIgPT09IGUuc2V0VG9TZXJ2ZXJWYWx1ZSksIG4gPSBuZXcga247IGVsc2UgaWYgKFwiYXBwZW5kTWlzc2luZ0VsZW1lbnRzXCIgaW4gZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IGUuYXBwZW5kTWlzc2luZ0VsZW1lbnRzLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIG4gPSBuZXcgT24odCk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJyZW1vdmVBbGxGcm9tQXJyYXlcIiBpbiBlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5yZW1vdmVBbGxGcm9tQXJyYXkudmFsdWVzIHx8IFtdO1xuICAgICAgICAgICAgbiA9IG5ldyBGbih0KTtcbiAgICAgICAgfSBlbHNlIFwiaW5jcmVtZW50XCIgaW4gZSA/IG4gPSBuZXcgQm4odCwgZS5pbmNyZW1lbnQpIDogTygpO1xuICAgICAgICBjb25zdCBzID0gdXQuZnJvbVNlcnZlckZvcm1hdChlLmZpZWxkUGF0aCk7XG4gICAgICAgIHJldHVybiBuZXcgVW4ocywgbik7XG4gICAgfSh0LCBlKSkpIDogW107XG4gICAgaWYgKGUudXBkYXRlKSB7XG4gICAgICAgIGUudXBkYXRlLm5hbWU7XG4gICAgICAgIGNvbnN0IGkgPSBRcyh0LCBlLnVwZGF0ZS5uYW1lKSwgciA9IG5ldyBZZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczogZS51cGRhdGUuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZS51cGRhdGVNYXNrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmZpZWxkUGF0aHMgfHwgW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBKZShlLm1hcCgodCA9PiB1dC5mcm9tU2VydmVyRm9ybWF0KHQpKSkpO1xuICAgICAgICAgICAgfShlLnVwZGF0ZU1hc2spO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyB0cyhpLCByLCB0LCBuLCBzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFpuKGksIHIsIG4sIHMpO1xuICAgIH1cbiAgICBpZiAoZS5kZWxldGUpIHtcbiAgICAgICAgY29uc3QgcyA9IFFzKHQsIGUuZGVsZXRlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBpcyhzLCBuKTtcbiAgICB9XG4gICAgaWYgKGUudmVyaWZ5KSB7XG4gICAgICAgIGNvbnN0IHMgPSBRcyh0LCBlLnZlcmlmeSk7XG4gICAgICAgIHJldHVybiBuZXcgcnMocywgbik7XG4gICAgfVxuICAgIHJldHVybiBPKCk7XG59XG5cbmZ1bmN0aW9uIG5pKHQsIGUpIHtcbiAgICByZXR1cm4gdCAmJiB0Lmxlbmd0aCA+IDAgPyAoTSh2b2lkIDAgIT09IGUpLCB0Lm1hcCgodCA9PiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIC8vIE5PVEU6IERlbGV0ZXMgZG9uJ3QgaGF2ZSBhbiB1cGRhdGVUaW1lLlxuICAgICAgICBsZXQgbiA9IHQudXBkYXRlVGltZSA/IHFzKHQudXBkYXRlVGltZSkgOiBxcyhlKTtcbiAgICAgICAgcmV0dXJuIG4uaXNFcXVhbChzdC5taW4oKSkgJiYgKFxuICAgICAgICAvLyBUaGUgRmlyZXN0b3JlIEVtdWxhdG9yIGN1cnJlbnRseSByZXR1cm5zIGFuIHVwZGF0ZSB0aW1lIG9mIDAgZm9yXG4gICAgICAgIC8vIGRlbGV0ZXMgb2Ygbm9uLWV4aXN0aW5nIGRvY3VtZW50cyAocmF0aGVyIHRoYW4gbnVsbCkuIFRoaXMgYnJlYWtzIHRoZVxuICAgICAgICAvLyB0ZXN0IFwiZ2V0IGRlbGV0ZWQgZG9jIHdoaWxlIG9mZmxpbmUgd2l0aCBzb3VyY2U9Y2FjaGVcIiBhcyBOb0RvY3VtZW50c1xuICAgICAgICAvLyB3aXRoIHZlcnNpb24gMCBhcmUgZmlsdGVyZWQgYnkgSW5kZXhlZERiJ3MgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAgICAgICAgLy8gVE9ETygjMjE0OSk6IFJlbW92ZSB0aGlzIHdoZW4gRW11bGF0b3IgaXMgZml4ZWRcbiAgICAgICAgbiA9IHFzKGUpKSwgbmV3IEduKG4sIHQudHJhbnNmb3JtUmVzdWx0cyB8fCBbXSk7XG4gICAgfSh0LCBlKSkpKSA6IFtdO1xufVxuXG5mdW5jdGlvbiBzaSh0LCBlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZG9jdW1lbnRzOiBbIGpzKHQsIGUucGF0aCkgXVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGlpKHQsIGUpIHtcbiAgICAvLyBEaXNzZWN0IHRoZSBwYXRoIGludG8gcGFyZW50LCBjb2xsZWN0aW9uSWQsIGFuZCBvcHRpb25hbCBrZXkgZmlsdGVyLlxuICAgIGNvbnN0IG4gPSB7XG4gICAgICAgIHN0cnVjdHVyZWRRdWVyeToge31cbiAgICB9LCBzID0gZS5wYXRoO1xuICAgIG51bGwgIT09IGUuY29sbGVjdGlvbkdyb3VwID8gKG4ucGFyZW50ID0ganModCwgcyksIG4uc3RydWN0dXJlZFF1ZXJ5LmZyb20gPSBbIHtcbiAgICAgICAgY29sbGVjdGlvbklkOiBlLmNvbGxlY3Rpb25Hcm91cCxcbiAgICAgICAgYWxsRGVzY2VuZGFudHM6ICEwXG4gICAgfSBdKSA6IChuLnBhcmVudCA9IGpzKHQsIHMucG9wTGFzdCgpKSwgbi5zdHJ1Y3R1cmVkUXVlcnkuZnJvbSA9IFsge1xuICAgICAgICBjb2xsZWN0aW9uSWQ6IHMubGFzdFNlZ21lbnQoKVxuICAgIH0gXSk7XG4gICAgY29uc3QgaSA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYgKDAgPT09IHQubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIHJldHVybiBkaShiZS5jcmVhdGUodCwgXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8pKTtcbiAgICB9KGUuZmlsdGVycyk7XG4gICAgaSAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkud2hlcmUgPSBpKTtcbiAgICBjb25zdCByID0gZnVuY3Rpb24odCkge1xuICAgICAgICBpZiAoMCA9PT0gdC5sZW5ndGgpIHJldHVybjtcbiAgICAgICAgcmV0dXJuIHQubWFwKCh0ID0+IFxuICAgICAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IGxpKHQuZmllbGQpLFxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogY2kodC5kaXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHQpKSk7XG4gICAgfShlLm9yZGVyQnkpO1xuICAgIHIgJiYgKG4uc3RydWN0dXJlZFF1ZXJ5Lm9yZGVyQnkgPSByKTtcbiAgICBjb25zdCBvID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICByZXR1cm4gdC53dCB8fCBxdChlKSA/IGUgOiB7XG4gICAgICAgICAgICB2YWx1ZTogZVxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAqIFJldHVybnMgYSBudW1iZXIgKG9yIG51bGwpIGZyb20gYSBnb29nbGUucHJvdG9idWYuSW50MzJWYWx1ZSBwcm90by5cbiAqLyAodCwgZS5saW1pdCk7XG4gICAgdmFyIHU7XG4gICAgcmV0dXJuIG51bGwgIT09IG8gJiYgKG4uc3RydWN0dXJlZFF1ZXJ5LmxpbWl0ID0gbyksIGUuc3RhcnRBdCAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkuc3RhcnRBdCA9IHtcbiAgICAgICAgYmVmb3JlOiAodSA9IGUuc3RhcnRBdCkuaW5jbHVzaXZlLFxuICAgICAgICB2YWx1ZXM6IHUucG9zaXRpb25cbiAgICB9KSwgZS5lbmRBdCAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkuZW5kQXQgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBiZWZvcmU6ICF0LmluY2x1c2l2ZSxcbiAgICAgICAgICAgIHZhbHVlczogdC5wb3NpdGlvblxuICAgICAgICB9O1xuICAgIH0oZS5lbmRBdCkpLCBuO1xufVxuXG5mdW5jdGlvbiByaSh0KSB7XG4gICAgbGV0IGUgPSBXcyh0LnBhcmVudCk7XG4gICAgY29uc3QgbiA9IHQuc3RydWN0dXJlZFF1ZXJ5LCBzID0gbi5mcm9tID8gbi5mcm9tLmxlbmd0aCA6IDA7XG4gICAgbGV0IGkgPSBudWxsO1xuICAgIGlmIChzID4gMCkge1xuICAgICAgICBNKDEgPT09IHMpO1xuICAgICAgICBjb25zdCB0ID0gbi5mcm9tWzBdO1xuICAgICAgICB0LmFsbERlc2NlbmRhbnRzID8gaSA9IHQuY29sbGVjdGlvbklkIDogZSA9IGUuY2hpbGQodC5jb2xsZWN0aW9uSWQpO1xuICAgIH1cbiAgICBsZXQgciA9IFtdO1xuICAgIG4ud2hlcmUgJiYgKHIgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB1aSh0KTtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBiZSAmJiBWZShlKSkgcmV0dXJuIGUuZ2V0RmlsdGVycygpO1xuICAgICAgICByZXR1cm4gWyBlIF07XG4gICAgfShuLndoZXJlKSk7XG4gICAgbGV0IG8gPSBbXTtcbiAgICBuLm9yZGVyQnkgJiYgKG8gPSBuLm9yZGVyQnkubWFwKCh0ID0+IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBVZShmaSh0LmZpZWxkKSwgXG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJBU0NFTkRJTkdcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJERVNDRU5ESU5HXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgKHQuZGlyZWN0aW9uKSk7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAodCkpKSk7XG4gICAgbGV0IHUgPSBudWxsO1xuICAgIG4ubGltaXQgJiYgKHUgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgIGxldCBlO1xuICAgICAgICByZXR1cm4gZSA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIHQgPyB0LnZhbHVlIDogdCwgcXQoZSkgPyBudWxsIDogZTtcbiAgICB9KG4ubGltaXQpKTtcbiAgICBsZXQgYyA9IG51bGw7XG4gICAgbi5zdGFydEF0ICYmIChjID0gZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gISF0LmJlZm9yZSwgbiA9IHQudmFsdWVzIHx8IFtdO1xuICAgICAgICByZXR1cm4gbmV3IEllKG4sIGUpO1xuICAgIH0obi5zdGFydEF0KSk7XG4gICAgbGV0IGEgPSBudWxsO1xuICAgIHJldHVybiBuLmVuZEF0ICYmIChhID0gZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gIXQuYmVmb3JlLCBuID0gdC52YWx1ZXMgfHwgW107XG4gICAgICAgIHJldHVybiBuZXcgSWUobiwgZSk7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAobi5lbmRBdCkpLCBobihlLCBpLCBvLCByLCB1LCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gLCBjLCBhKTtcbn1cblxuZnVuY3Rpb24gb2kodCwgZSkge1xuICAgIGNvbnN0IG4gPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHN3aXRjaCAoZSkge1xuICAgICAgICAgIGNhc2UgMCAvKiBUYXJnZXRQdXJwb3NlLkxpc3RlbiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICAgIGNhc2UgMSAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoICovIDpcbiAgICAgICAgICAgIHJldHVybiBcImV4aXN0ZW5jZS1maWx0ZXItbWlzbWF0Y2hcIjtcblxuICAgICAgICAgIGNhc2UgMiAvKiBUYXJnZXRQdXJwb3NlLkxpbWJvUmVzb2x1dGlvbiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gXCJsaW1iby1kb2N1bWVudFwiO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBPKCk7XG4gICAgICAgIH1cbiAgICB9KDAsIGUucHVycG9zZSk7XG4gICAgcmV0dXJuIG51bGwgPT0gbiA/IG51bGwgOiB7XG4gICAgICAgIFwiZ29vZy1saXN0ZW4tdGFnc1wiOiBuXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gdWkodCkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IHQudW5hcnlGaWx0ZXIgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIHN3aXRjaCAodC51bmFyeUZpbHRlci5vcCkge1xuICAgICAgICAgIGNhc2UgXCJJU19OQU5cIjpcbiAgICAgICAgICAgIGNvbnN0IGUgPSBmaSh0LnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgICAgIHJldHVybiBSZS5jcmVhdGUoZSwgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovICwge1xuICAgICAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY2FzZSBcIklTX05VTExcIjpcbiAgICAgICAgICAgIGNvbnN0IG4gPSBmaSh0LnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgICAgIHJldHVybiBSZS5jcmVhdGUobiwgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovICwge1xuICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY2FzZSBcIklTX05PVF9OQU5cIjpcbiAgICAgICAgICAgIGNvbnN0IHMgPSBmaSh0LnVuYXJ5RmlsdGVyLmZpZWxkKTtcbiAgICAgICAgICAgIHJldHVybiBSZS5jcmVhdGUocywgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyAsIHtcbiAgICAgICAgICAgICAgICBkb3VibGVWYWx1ZTogTmFOXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNhc2UgXCJJU19OT1RfTlVMTFwiOlxuICAgICAgICAgICAgY29uc3QgaSA9IGZpKHQudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIFJlLmNyZWF0ZShpLCBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwge1xuICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBPKCk7XG4gICAgICAgIH1cbiAgICB9KHQpIDogdm9pZCAwICE9PSB0LmZpZWxkRmlsdGVyID8gZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gUmUuY3JlYXRlKGZpKHQuZmllbGRGaWx0ZXIuZmllbGQpLCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIkVRVUFMXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiTk9UX0VRVUFMXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkdSRUFURVJfVEhBTlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIj5cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU4gKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkdSRUFURVJfVEhBTl9PUl9FUVVBTFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIj49XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOX09SX0VRVUFMICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJMRVNTX1RIQU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI8XCIgLyogT3BlcmF0b3IuTEVTU19USEFOICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJMRVNTX1RIQU5fT1JfRVFVQUxcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI8PVwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTl9PUl9FUVVBTCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiQVJSQVlfQ09OVEFJTlNcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJJTlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImluXCIgLyogT3BlcmF0b3IuSU4gKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIk5PVF9JTlwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiQVJSQVlfQ09OVEFJTlNfQU5ZXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIE8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSh0LmZpZWxkRmlsdGVyLm9wKSwgdC5maWVsZEZpbHRlci52YWx1ZSk7XG4gICAgfSh0KSA6IHZvaWQgMCAhPT0gdC5jb21wb3NpdGVGaWx0ZXIgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIHJldHVybiBiZS5jcmVhdGUodC5jb21wb3NpdGVGaWx0ZXIuZmlsdGVycy5tYXAoKHQgPT4gdWkodCkpKSwgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJBTkRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIk9SXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwib3JcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5PUiAqLztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBPKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0odC5jb21wb3NpdGVGaWx0ZXIub3ApKTtcbiAgICB9KHQpIDogTygpO1xufVxuXG5mdW5jdGlvbiBjaSh0KSB7XG4gICAgcmV0dXJuIGtzW3RdO1xufVxuXG5mdW5jdGlvbiBhaSh0KSB7XG4gICAgcmV0dXJuIE9zW3RdO1xufVxuXG5mdW5jdGlvbiBoaSh0KSB7XG4gICAgcmV0dXJuIE1zW3RdO1xufVxuXG5mdW5jdGlvbiBsaSh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZmllbGRQYXRoOiB0LmNhbm9uaWNhbFN0cmluZygpXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gZmkodCkge1xuICAgIHJldHVybiB1dC5mcm9tU2VydmVyRm9ybWF0KHQuZmllbGRQYXRoKTtcbn1cblxuZnVuY3Rpb24gZGkodCkge1xuICAgIHJldHVybiB0IGluc3RhbmNlb2YgUmUgPyBmdW5jdGlvbih0KSB7XG4gICAgICAgIGlmIChcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gPT09IHQub3ApIHtcbiAgICAgICAgICAgIGlmIChmZSh0LnZhbHVlKSkgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogbGkodC5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05BTlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChsZSh0LnZhbHVlKSkgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogbGkodC5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05VTExcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSBpZiAoXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA9PT0gdC5vcCkge1xuICAgICAgICAgICAgaWYgKGZlKHQudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVuYXJ5RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBsaSh0LmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTk9UX05BTlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChsZSh0LnZhbHVlKSkgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1bmFyeUZpbHRlcjoge1xuICAgICAgICAgICAgICAgICAgICBmaWVsZDogbGkodC5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05PVF9OVUxMXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZEZpbHRlcjoge1xuICAgICAgICAgICAgICAgIGZpZWxkOiBsaSh0LmZpZWxkKSxcbiAgICAgICAgICAgICAgICBvcDogYWkodC5vcCksXG4gICAgICAgICAgICAgICAgdmFsdWU6IHQudmFsdWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KHQpIDogdCBpbnN0YW5jZW9mIGJlID8gZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gdC5nZXRGaWx0ZXJzKCkubWFwKCh0ID0+IGRpKHQpKSk7XG4gICAgICAgIGlmICgxID09PSBlLmxlbmd0aCkgcmV0dXJuIGVbMF07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb21wb3NpdGVGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICBvcDogaGkodC5vcCksXG4gICAgICAgICAgICAgICAgZmlsdGVyczogZVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0odCkgOiBPKCk7XG59XG5cbmZ1bmN0aW9uIF9pKHQpIHtcbiAgICBjb25zdCBlID0gW107XG4gICAgcmV0dXJuIHQuZmllbGRzLmZvckVhY2goKHQgPT4gZS5wdXNoKHQuY2Fub25pY2FsU3RyaW5nKCkpKSksIHtcbiAgICAgICAgZmllbGRQYXRoczogZVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIHdpKHQpIHtcbiAgICAvLyBSZXNvdXJjZSBuYW1lcyBoYXZlIGF0IGxlYXN0IDQgY29tcG9uZW50cyAocHJvamVjdCBJRCwgZGF0YWJhc2UgSUQpXG4gICAgcmV0dXJuIHQubGVuZ3RoID49IDQgJiYgXCJwcm9qZWN0c1wiID09PSB0LmdldCgwKSAmJiBcImRhdGFiYXNlc1wiID09PSB0LmdldCgyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRW5jb2RlcyBhIHJlc291cmNlIHBhdGggaW50byBhIEluZGV4ZWREYi1jb21wYXRpYmxlIHN0cmluZyBmb3JtLlxuICovXG5mdW5jdGlvbiBtaSh0KSB7XG4gICAgbGV0IGUgPSBcIlwiO1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgdC5sZW5ndGg7IG4rKykgZS5sZW5ndGggPiAwICYmIChlID0geWkoZSkpLCBlID0gZ2kodC5nZXQobiksIGUpO1xuICAgIHJldHVybiB5aShlKTtcbn1cblxuLyoqIEVuY29kZXMgYSBzaW5nbGUgc2VnbWVudCBvZiBhIHJlc291cmNlIHBhdGggaW50byB0aGUgZ2l2ZW4gcmVzdWx0ICovIGZ1bmN0aW9uIGdpKHQsIGUpIHtcbiAgICBsZXQgbiA9IGU7XG4gICAgY29uc3QgcyA9IHQubGVuZ3RoO1xuICAgIGZvciAobGV0IGUgPSAwOyBlIDwgczsgZSsrKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0LmNoYXJBdChlKTtcbiAgICAgICAgc3dpdGNoIChzKSB7XG4gICAgICAgICAgY2FzZSBcIlxcMFwiOlxuICAgICAgICAgICAgbiArPSBcIlx1MDAwMVx1MDAxMFwiO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiXHUwMDAxXCI6XG4gICAgICAgICAgICBuICs9IFwiXHUwMDAxXHUwMDExXCI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBuICs9IHM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG47XG59XG5cbi8qKiBFbmNvZGVzIGEgcGF0aCBzZXBhcmF0b3IgaW50byB0aGUgZ2l2ZW4gcmVzdWx0ICovIGZ1bmN0aW9uIHlpKHQpIHtcbiAgICByZXR1cm4gdCArIFwiXHUwMDAxXHUwMDAxXCI7XG59XG5cbi8qKlxuICogRGVjb2RlcyB0aGUgZ2l2ZW4gSW5kZXhlZERiLWNvbXBhdGlibGUgc3RyaW5nIGZvcm0gb2YgYSByZXNvdXJjZSBwYXRoIGludG9cbiAqIGEgUmVzb3VyY2VQYXRoIGluc3RhbmNlLiBOb3RlIHRoYXQgdGhpcyBtZXRob2QgaXMgbm90IHN1aXRhYmxlIGZvciB1c2Ugd2l0aFxuICogZGVjb2RpbmcgcmVzb3VyY2UgbmFtZXMgZnJvbSB0aGUgc2VydmVyOyB0aG9zZSBhcmUgT25lIFBsYXRmb3JtIGZvcm1hdFxuICogc3RyaW5ncy5cbiAqLyBmdW5jdGlvbiBwaSh0KSB7XG4gICAgLy8gRXZlbnQgdGhlIGVtcHR5IHBhdGggbXVzdCBlbmNvZGUgYXMgYSBwYXRoIG9mIGF0IGxlYXN0IGxlbmd0aCAyLiBBIHBhdGhcbiAgICAvLyB3aXRoIGV4YWN0bHkgMiBtdXN0IGJlIHRoZSBlbXB0eSBwYXRoLlxuICAgIGNvbnN0IGUgPSB0Lmxlbmd0aDtcbiAgICBpZiAoTShlID49IDIpLCAyID09PSBlKSByZXR1cm4gTShcIlx1MDAwMVwiID09PSB0LmNoYXJBdCgwKSAmJiBcIlx1MDAwMVwiID09PSB0LmNoYXJBdCgxKSksIHJ0LmVtcHR5UGF0aCgpO1xuICAgIC8vIEVzY2FwZSBjaGFyYWN0ZXJzIGNhbm5vdCBleGlzdCBwYXN0IHRoZSBzZWNvbmQtdG8tbGFzdCBwb3NpdGlvbiBpbiB0aGVcbiAgICAvLyBzb3VyY2UgdmFsdWUuXG4gICAgICAgIGNvbnN0IG4gPSBlIC0gMiwgcyA9IFtdO1xuICAgIGxldCBpID0gXCJcIjtcbiAgICBmb3IgKGxldCByID0gMDsgciA8IGU7ICkge1xuICAgICAgICAvLyBUaGUgbGFzdCB0d28gY2hhcmFjdGVycyBvZiBhIHZhbGlkIGVuY29kZWQgcGF0aCBtdXN0IGJlIGEgc2VwYXJhdG9yLCBzb1xuICAgICAgICAvLyB0aGVyZSBtdXN0IGJlIGFuIGVuZCB0byB0aGlzIHNlZ21lbnQuXG4gICAgICAgIGNvbnN0IGUgPSB0LmluZGV4T2YoXCJcdTAwMDFcIiwgcik7XG4gICAgICAgIChlIDwgMCB8fCBlID4gbikgJiYgTygpO1xuICAgICAgICBzd2l0Y2ggKHQuY2hhckF0KGUgKyAxKSkge1xuICAgICAgICAgIGNhc2UgXCJcdTAwMDFcIjpcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LnN1YnN0cmluZyhyLCBlKTtcbiAgICAgICAgICAgIGxldCBvO1xuICAgICAgICAgICAgMCA9PT0gaS5sZW5ndGggPyBcbiAgICAgICAgICAgIC8vIEF2b2lkIGNvcHlpbmcgZm9yIHRoZSBjb21tb24gY2FzZSBvZiBhIHNlZ21lbnQgdGhhdCBleGNsdWRlcyBcXDBcbiAgICAgICAgICAgIC8vIGFuZCBcXDAwMVxuICAgICAgICAgICAgbyA9IG4gOiAoaSArPSBuLCBvID0gaSwgaSA9IFwiXCIpLCBzLnB1c2gobyk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJcdTAwMTBcIjpcbiAgICAgICAgICAgIGkgKz0gdC5zdWJzdHJpbmcociwgZSksIGkgKz0gXCJcXDBcIjtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIlx1MDAxMVwiOlxuICAgICAgICAgICAgLy8gVGhlIGVzY2FwZSBjaGFyYWN0ZXIgY2FuIGJlIHVzZWQgaW4gdGhlIG91dHB1dCB0byBlbmNvZGUgaXRzZWxmLlxuICAgICAgICAgICAgaSArPSB0LnN1YnN0cmluZyhyLCBlICsgMSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBPKCk7XG4gICAgICAgIH1cbiAgICAgICAgciA9IGUgKyAyO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IHJ0KHMpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBJaSA9IFsgXCJ1c2VySWRcIiwgXCJiYXRjaElkXCIgXTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogTmFtZSBvZiB0aGUgSW5kZXhlZERiIG9iamVjdCBzdG9yZS5cbiAqXG4gKiBOb3RlIHRoYXQgdGhlIG5hbWUgJ293bmVyJyBpcyBjaG9zZW4gdG8gZW5zdXJlIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHdpdGhcbiAqIG9sZGVyIGNsaWVudHMgdGhhdCBvbmx5IHN1cHBvcnRlZCBzaW5nbGUgbG9ja2VkIGFjY2VzcyB0byB0aGUgcGVyc2lzdGVuY2VcbiAqIGxheWVyLlxuICovXG4vKipcbiAqIENyZWF0ZXMgYSBbdXNlcklkLCBlbmNvZGVkUGF0aF0ga2V5IGZvciB1c2UgaW4gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnNcbiAqIGluZGV4IHRvIGl0ZXJhdGUgb3ZlciBhbGwgYXQgZG9jdW1lbnQgbXV0YXRpb25zIGZvciBhIGdpdmVuIHBhdGggb3IgbG93ZXIuXG4gKi9cbmZ1bmN0aW9uIFRpKHQsIGUpIHtcbiAgICByZXR1cm4gWyB0LCBtaShlKSBdO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdWxsIGluZGV4IGtleSBvZiBbdXNlcklkLCBlbmNvZGVkUGF0aCwgYmF0Y2hJZF0gZm9yIGluc2VydGluZ1xuICogYW5kIGRlbGV0aW5nIGludG8gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnMgaW5kZXguXG4gKi8gZnVuY3Rpb24gRWkodCwgZSwgbikge1xuICAgIHJldHVybiBbIHQsIG1pKGUpLCBuIF07XG59XG5cbi8qKlxuICogQmVjYXVzZSB3ZSBzdG9yZSBhbGwgdGhlIHVzZWZ1bCBpbmZvcm1hdGlvbiBmb3IgdGhpcyBzdG9yZSBpbiB0aGUga2V5LFxuICogdGhlcmUgaXMgbm8gdXNlZnVsIGluZm9ybWF0aW9uIHRvIHN0b3JlIGFzIHRoZSB2YWx1ZS4gVGhlIHJhdyAodW5lbmNvZGVkKVxuICogcGF0aCBjYW5ub3QgYmUgc3RvcmVkIGJlY2F1c2UgSW5kZXhlZERiIGRvZXNuJ3Qgc3RvcmUgcHJvdG90eXBlXG4gKiBpbmZvcm1hdGlvbi5cbiAqLyBjb25zdCBBaSA9IHt9LCBSaSA9IFsgXCJwcmVmaXhQYXRoXCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwicmVhZFRpbWVcIiwgXCJkb2N1bWVudElkXCIgXSwgYmkgPSBbIFwicHJlZml4UGF0aFwiLCBcImNvbGxlY3Rpb25Hcm91cFwiLCBcImRvY3VtZW50SWRcIiBdLCBQaSA9IFsgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJyZWFkVGltZVwiLCBcInByZWZpeFBhdGhcIiwgXCJkb2N1bWVudElkXCIgXSwgdmkgPSBbIFwiY2Fub25pY2FsSWRcIiwgXCJ0YXJnZXRJZFwiIF0sIFZpID0gWyBcInRhcmdldElkXCIsIFwicGF0aFwiIF0sIFNpID0gWyBcInBhdGhcIiwgXCJ0YXJnZXRJZFwiIF0sIERpID0gWyBcImNvbGxlY3Rpb25JZFwiLCBcInBhcmVudFwiIF0sIENpID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiBdLCB4aSA9IFsgXCJ1aWRcIiwgXCJzZXF1ZW5jZU51bWJlclwiIF0sIE5pID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiwgXCJhcnJheVZhbHVlXCIsIFwiZGlyZWN0aW9uYWxWYWx1ZVwiLCBcIm9yZGVyZWREb2N1bWVudEtleVwiLCBcImRvY3VtZW50S2V5XCIgXSwga2kgPSBbIFwiaW5kZXhJZFwiLCBcInVpZFwiLCBcIm9yZGVyZWREb2N1bWVudEtleVwiIF0sIE9pID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwiZG9jdW1lbnRJZFwiIF0sIE1pID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwibGFyZ2VzdEJhdGNoSWRcIiBdLCBGaSA9IFsgXCJ1c2VySWRcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJsYXJnZXN0QmF0Y2hJZFwiIF0sICRpID0gWyAuLi5bIC4uLlsgLi4uWyAuLi5bIFwibXV0YXRpb25RdWV1ZXNcIiwgXCJtdXRhdGlvbnNcIiwgXCJkb2N1bWVudE11dGF0aW9uc1wiLCBcInJlbW90ZURvY3VtZW50c1wiLCBcInRhcmdldHNcIiwgXCJvd25lclwiLCBcInRhcmdldEdsb2JhbFwiLCBcInRhcmdldERvY3VtZW50c1wiIF0sIFwiY2xpZW50TWV0YWRhdGFcIiBdLCBcInJlbW90ZURvY3VtZW50R2xvYmFsXCIgXSwgXCJjb2xsZWN0aW9uUGFyZW50c1wiIF0sIFwiYnVuZGxlc1wiLCBcIm5hbWVkUXVlcmllc1wiIF0sIEJpID0gWyAuLi4kaSwgXCJkb2N1bWVudE92ZXJsYXlzXCIgXSwgTGkgPSBbIFwibXV0YXRpb25RdWV1ZXNcIiwgXCJtdXRhdGlvbnNcIiwgXCJkb2N1bWVudE11dGF0aW9uc1wiLCBcInJlbW90ZURvY3VtZW50c1YxNFwiLCBcInRhcmdldHNcIiwgXCJvd25lclwiLCBcInRhcmdldEdsb2JhbFwiLCBcInRhcmdldERvY3VtZW50c1wiLCBcImNsaWVudE1ldGFkYXRhXCIsIFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIiwgXCJjb2xsZWN0aW9uUGFyZW50c1wiLCBcImJ1bmRsZXNcIiwgXCJuYW1lZFF1ZXJpZXNcIiwgXCJkb2N1bWVudE92ZXJsYXlzXCIgXSwgcWkgPSBMaSwgVWkgPSBbIC4uLnFpLCBcImluZGV4Q29uZmlndXJhdGlvblwiLCBcImluZGV4U3RhdGVcIiwgXCJpbmRleEVudHJpZXNcIiBdO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgS2kgZXh0ZW5kcyBUdCB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnNlID0gdCwgdGhpcy5jdXJyZW50U2VxdWVuY2VOdW1iZXIgPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gR2kodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgIHJldHVybiBidC5NKG4uc2UsIGUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGJhdGNoIG9mIG11dGF0aW9ucyB0aGF0IHdpbGwgYmUgc2VudCBhcyBvbmUgdW5pdCB0byB0aGUgYmFja2VuZC5cbiAqLyBjbGFzcyBRaSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGJhdGNoSWQgLSBUaGUgdW5pcXVlIElEIG9mIHRoaXMgbXV0YXRpb24gYmF0Y2guXG4gICAgICogQHBhcmFtIGxvY2FsV3JpdGVUaW1lIC0gVGhlIG9yaWdpbmFsIHdyaXRlIHRpbWUgb2YgdGhpcyBtdXRhdGlvbi5cbiAgICAgKiBAcGFyYW0gYmFzZU11dGF0aW9ucyAtIE11dGF0aW9ucyB0aGF0IGFyZSB1c2VkIHRvIHBvcHVsYXRlIHRoZSBiYXNlXG4gICAgICogdmFsdWVzIHdoZW4gdGhpcyBtdXRhdGlvbiBpcyBhcHBsaWVkIGxvY2FsbHkuIFRoaXMgY2FuIGJlIHVzZWQgdG8gbG9jYWxseVxuICAgICAqIG92ZXJ3cml0ZSB2YWx1ZXMgdGhhdCBhcmUgcGVyc2lzdGVkIGluIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUuIEJhc2VcbiAgICAgKiBtdXRhdGlvbnMgYXJlIG5ldmVyIHNlbnQgdG8gdGhlIGJhY2tlbmQuXG4gICAgICogQHBhcmFtIG11dGF0aW9ucyAtIFRoZSB1c2VyLXByb3ZpZGVkIG11dGF0aW9ucyBpbiB0aGlzIG11dGF0aW9uIGJhdGNoLlxuICAgICAqIFVzZXItcHJvdmlkZWQgbXV0YXRpb25zIGFyZSBhcHBsaWVkIGJvdGggbG9jYWxseSBhbmQgcmVtb3RlbHkgb24gdGhlXG4gICAgICogYmFja2VuZC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMuYmF0Y2hJZCA9IHQsIHRoaXMubG9jYWxXcml0ZVRpbWUgPSBlLCB0aGlzLmJhc2VNdXRhdGlvbnMgPSBuLCB0aGlzLm11dGF0aW9ucyA9IHM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYWxsIHRoZSBtdXRhdGlvbnMgaW4gdGhpcyBNdXRhdGlvbkJhdGNoIHRvIHRoZSBzcGVjaWZpZWQgZG9jdW1lbnRcbiAgICAgKiB0byBjb21wdXRlIHRoZSBzdGF0ZSBvZiB0aGUgcmVtb3RlIGRvY3VtZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnQgLSBUaGUgZG9jdW1lbnQgdG8gYXBwbHkgbXV0YXRpb25zIHRvLlxuICAgICAqIEBwYXJhbSBiYXRjaFJlc3VsdCAtIFRoZSByZXN1bHQgb2YgYXBwbHlpbmcgdGhlIE11dGF0aW9uQmF0Y2ggdG8gdGhlXG4gICAgICogYmFja2VuZC5cbiAgICAgKi8gICAgYXBwbHlUb1JlbW90ZURvY3VtZW50KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUubXV0YXRpb25SZXN1bHRzO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHRoaXMubXV0YXRpb25zLmxlbmd0aDsgZSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gdGhpcy5tdXRhdGlvbnNbZV07XG4gICAgICAgICAgICBpZiAocy5rZXkuaXNFcXVhbCh0LmtleSkpIHtcbiAgICAgICAgICAgICAgICBIbihzLCB0LCBuW2VdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBvZiBhIGRvY3VtZW50IGdpdmVuIGFsbCB0aGUgbXV0YXRpb25zIGluIHRoaXNcbiAgICAgKiBiYXRjaC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBhcHBseSBtdXRhdGlvbnMgdG8uXG4gICAgICogQHBhcmFtIG11dGF0ZWRGaWVsZHMgLSBGaWVsZHMgdGhhdCBoYXZlIGJlZW4gdXBkYXRlZCBiZWZvcmUgYXBwbHlpbmcgdGhpcyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgKiBAcmV0dXJucyBBIGBGaWVsZE1hc2tgIHJlcHJlc2VudGluZyBhbGwgdGhlIGZpZWxkcyB0aGF0IGFyZSBtdXRhdGVkLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxWaWV3KHQsIGUpIHtcbiAgICAgICAgLy8gRmlyc3QsIGFwcGx5IHRoZSBiYXNlIHN0YXRlLiBUaGlzIGFsbG93cyB1cyB0byBhcHBseSBub24taWRlbXBvdGVudFxuICAgICAgICAvLyB0cmFuc2Zvcm0gYWdhaW5zdCBhIGNvbnNpc3RlbnQgc2V0IG9mIHZhbHVlcy5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIHRoaXMuYmFzZU11dGF0aW9ucykgbi5rZXkuaXNFcXVhbCh0LmtleSkgJiYgKGUgPSBKbihuLCB0LCBlLCB0aGlzLmxvY2FsV3JpdGVUaW1lKSk7XG4gICAgICAgIC8vIFNlY29uZCwgYXBwbHkgYWxsIHVzZXItcHJvdmlkZWQgbXV0YXRpb25zLlxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB0aGlzLm11dGF0aW9ucykgbi5rZXkuaXNFcXVhbCh0LmtleSkgJiYgKGUgPSBKbihuLCB0LCBlLCB0aGlzLmxvY2FsV3JpdGVUaW1lKSk7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBmb3IgYWxsIHByb3ZpZGVkIGRvY3VtZW50cyBnaXZlbiB0aGUgbXV0YXRpb25zIGluXG4gICAgICogdGhpcyBiYXRjaC4gUmV0dXJucyBhIGBEb2N1bWVudEtleWAgdG8gYE11dGF0aW9uYCBtYXAgd2hpY2ggY2FuIGJlIHVzZWQgdG9cbiAgICAgKiByZXBsYWNlIGFsbCB0aGUgbXV0YXRpb24gYXBwbGljYXRpb25zLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxEb2N1bWVudFNldCh0LCBlKSB7XG4gICAgICAgIC8vIFRPRE8obXJzY2htaWR0KTogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBPKG5eMikuIElmIHdlIGFwcGx5IHRoZSBtdXRhdGlvbnNcbiAgICAgICAgLy8gZGlyZWN0bHkgKGFzIGRvbmUgaW4gYGFwcGx5VG9Mb2NhbFZpZXcoKWApLCB3ZSBjYW4gcmVkdWNlIHRoZSBjb21wbGV4aXR5XG4gICAgICAgIC8vIHRvIE8obikuXG4gICAgICAgIGNvbnN0IG4gPSB5cygpO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvbnMuZm9yRWFjaCgocyA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gdC5nZXQocy5rZXkpLCByID0gaS5vdmVybGF5ZWREb2N1bWVudDtcbiAgICAgICAgICAgIC8vIFRPRE8obXV0YWJsZWRvY3VtZW50cyk6IFRoaXMgbWV0aG9kIHNob3VsZCB0YWtlIGEgTXV0YWJsZURvY3VtZW50TWFwXG4gICAgICAgICAgICAvLyBhbmQgd2Ugc2hvdWxkIHJlbW92ZSB0aGlzIGNhc3QuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbyA9IHRoaXMuYXBwbHlUb0xvY2FsVmlldyhyLCBpLm11dGF0ZWRGaWVsZHMpO1xuICAgICAgICAgICAgLy8gU2V0IG11dGF0ZWRGaWVsZHMgdG8gbnVsbCBpZiB0aGUgZG9jdW1lbnQgaXMgb25seSBmcm9tIGxvY2FsIG11dGF0aW9ucy5cbiAgICAgICAgICAgIC8vIFRoaXMgY3JlYXRlcyBhIFNldCBvciBEZWxldGUgbXV0YXRpb24sIGluc3RlYWQgb2YgdHJ5aW5nIHRvIGNyZWF0ZSBhXG4gICAgICAgICAgICAvLyBwYXRjaCBtdXRhdGlvbiBhcyB0aGUgb3ZlcmxheS5cbiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBlLmhhcyhzLmtleSkgPyBudWxsIDogbztcbiAgICAgICAgICAgIGNvbnN0IHUgPSB6bihyLCBvKTtcbiAgICAgICAgICAgIG51bGwgIT09IHUgJiYgbi5zZXQocy5rZXksIHUpLCByLmlzVmFsaWREb2N1bWVudCgpIHx8IHIuY29udmVydFRvTm9Eb2N1bWVudChzdC5taW4oKSk7XG4gICAgICAgIH0pKSwgbjtcbiAgICB9XG4gICAga2V5cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXV0YXRpb25zLnJlZHVjZSgoKHQsIGUpID0+IHQuYWRkKGUua2V5KSksIEVzKCkpO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmF0Y2hJZCA9PT0gdC5iYXRjaElkICYmIHR0KHRoaXMubXV0YXRpb25zLCB0Lm11dGF0aW9ucywgKCh0LCBlKSA9PiBYbih0LCBlKSkpICYmIHR0KHRoaXMuYmFzZU11dGF0aW9ucywgdC5iYXNlTXV0YXRpb25zLCAoKHQsIGUpID0+IFhuKHQsIGUpKSk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBhcHBseWluZyBhIG11dGF0aW9uIGJhdGNoIHRvIHRoZSBiYWNrZW5kLiAqLyBjbGFzcyBqaSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgXG4gICAgLyoqXG4gICAgICogQSBwcmUtY29tcHV0ZWQgbWFwcGluZyBmcm9tIGVhY2ggbXV0YXRlZCBkb2N1bWVudCB0byB0aGUgcmVzdWx0aW5nXG4gICAgICogdmVyc2lvbi5cbiAgICAgKi9cbiAgICBzKSB7XG4gICAgICAgIHRoaXMuYmF0Y2ggPSB0LCB0aGlzLmNvbW1pdFZlcnNpb24gPSBlLCB0aGlzLm11dGF0aW9uUmVzdWx0cyA9IG4sIHRoaXMuZG9jVmVyc2lvbnMgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE11dGF0aW9uQmF0Y2hSZXN1bHQgZm9yIHRoZSBnaXZlbiBiYXRjaCBhbmQgcmVzdWx0cy4gVGhlcmVcbiAgICAgKiBtdXN0IGJlIG9uZSByZXN1bHQgZm9yIGVhY2ggbXV0YXRpb24gaW4gdGhlIGJhdGNoLiBUaGlzIHN0YXRpYyBmYWN0b3J5XG4gICAgICogY2FjaGVzIGEgZG9jdW1lbnQ9Jmd0O3ZlcnNpb24gbWFwcGluZyAoZG9jVmVyc2lvbnMpLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbSh0LCBlLCBuKSB7XG4gICAgICAgIE0odC5tdXRhdGlvbnMubGVuZ3RoID09PSBuLmxlbmd0aCk7XG4gICAgICAgIGxldCBzID0gSXM7XG4gICAgICAgIGNvbnN0IGkgPSB0Lm11dGF0aW9ucztcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBpLmxlbmd0aDsgdCsrKSBzID0gcy5pbnNlcnQoaVt0XS5rZXksIG5bdF0udmVyc2lvbik7XG4gICAgICAgIHJldHVybiBuZXcgamkodCwgZSwgbiwgcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRhdGlvbiBvZiBhbiBvdmVybGF5IGNvbXB1dGVkIGJ5IEZpcmVzdG9yZS5cbiAqXG4gKiBIb2xkcyBpbmZvcm1hdGlvbiBhYm91dCBhIG11dGF0aW9uIGFuZCB0aGUgbGFyZ2VzdCBiYXRjaCBpZCBpbiBGaXJlc3RvcmUgd2hlblxuICogdGhlIG11dGF0aW9uIHdhcyBjcmVhdGVkLlxuICovIGNsYXNzIFdpIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMubGFyZ2VzdEJhdGNoSWQgPSB0LCB0aGlzLm11dGF0aW9uID0gZTtcbiAgICB9XG4gICAgZ2V0S2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvbi5rZXk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdCAmJiB0aGlzLm11dGF0aW9uID09PSB0Lm11dGF0aW9uO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBPdmVybGF5e1xcbiAgICAgIGxhcmdlc3RCYXRjaElkOiAke3RoaXMubGFyZ2VzdEJhdGNoSWR9LFxcbiAgICAgIG11dGF0aW9uOiAke3RoaXMubXV0YXRpb24udG9TdHJpbmcoKX1cXG4gICAgfWA7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbW11dGFibGUgc2V0IG9mIG1ldGFkYXRhIHRoYXQgdGhlIGxvY2FsIHN0b3JlIHRyYWNrcyBmb3IgZWFjaCB0YXJnZXQuXG4gKi8gY2xhc3Mgemkge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdGFyZ2V0IGJlaW5nIGxpc3RlbmVkIHRvLiAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSB0YXJnZXQgSUQgdG8gd2hpY2ggdGhlIHRhcmdldCBjb3JyZXNwb25kczsgQXNzaWduZWQgYnkgdGhlXG4gICAgICogTG9jYWxTdG9yZSBmb3IgdXNlciBsaXN0ZW5zIGFuZCBieSB0aGUgU3luY0VuZ2luZSBmb3IgbGltYm8gd2F0Y2hlcy5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIHB1cnBvc2Ugb2YgdGhlIHRhcmdldC4gKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2VxdWVuY2UgbnVtYmVyIG9mIHRoZSBsYXN0IHRyYW5zYWN0aW9uIGR1cmluZyB3aGljaCB0aGlzIHRhcmdldCBkYXRhXG4gICAgICogd2FzIG1vZGlmaWVkLlxuICAgICAqL1xuICAgIHMsIFxuICAgIC8qKiBUaGUgbGF0ZXN0IHNuYXBzaG90IHZlcnNpb24gc2VlbiBmb3IgdGhpcyB0YXJnZXQuICovXG4gICAgaSA9IHN0Lm1pbigpXG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gc25hcHNob3QgdmVyc2lvbiBhdCB3aGljaCB0aGUgYXNzb2NpYXRlZCB2aWV3XG4gICAgICogY29udGFpbmVkIG5vIGxpbWJvIGRvY3VtZW50cy5cbiAgICAgKi8gLCByID0gc3QubWluKClcbiAgICAvKipcbiAgICAgKiBBbiBvcGFxdWUsIHNlcnZlci1hc3NpZ25lZCB0b2tlbiB0aGF0IGFsbG93cyB3YXRjaGluZyBhIHRhcmdldCB0byBiZVxuICAgICAqIHJlc3VtZWQgYWZ0ZXIgZGlzY29ubmVjdGluZyB3aXRob3V0IHJldHJhbnNtaXR0aW5nIGFsbCB0aGUgZGF0YSB0aGF0XG4gICAgICogbWF0Y2hlcyB0aGUgdGFyZ2V0LiBUaGUgcmVzdW1lIHRva2VuIGVzc2VudGlhbGx5IGlkZW50aWZpZXMgYSBwb2ludCBpblxuICAgICAqIHRpbWUgZnJvbSB3aGljaCB0aGUgc2VydmVyIHNob3VsZCByZXN1bWUgc2VuZGluZyByZXN1bHRzLlxuICAgICAqLyAsIG8gPSBRdC5FTVBUWV9CWVRFX1NUUklORykge1xuICAgICAgICB0aGlzLnRhcmdldCA9IHQsIHRoaXMudGFyZ2V0SWQgPSBlLCB0aGlzLnB1cnBvc2UgPSBuLCB0aGlzLnNlcXVlbmNlTnVtYmVyID0gcywgdGhpcy5zbmFwc2hvdFZlcnNpb24gPSBpLCBcbiAgICAgICAgdGhpcy5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uID0gciwgdGhpcy5yZXN1bWVUb2tlbiA9IG87XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRhcmdldCBkYXRhIGluc3RhbmNlIHdpdGggYW4gdXBkYXRlZCBzZXF1ZW5jZSBudW1iZXIuICovICAgIHdpdGhTZXF1ZW5jZU51bWJlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgemkodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdCwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgdGhpcy5yZXN1bWVUb2tlbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIHJlc3VtZSB0b2tlbiBhbmRcbiAgICAgKiBzbmFwc2hvdCB2ZXJzaW9uLlxuICAgICAqLyAgICB3aXRoUmVzdW1lVG9rZW4odCwgZSkge1xuICAgICAgICByZXR1cm4gbmV3IHppKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldElkLCB0aGlzLnB1cnBvc2UsIHRoaXMuc2VxdWVuY2VOdW1iZXIsIGUsIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IGRhdGEgaW5zdGFuY2Ugd2l0aCBhbiB1cGRhdGVkIGxhc3QgbGltYm8gZnJlZVxuICAgICAqIHNuYXBzaG90IHZlcnNpb24gbnVtYmVyLlxuICAgICAqLyAgICB3aXRoTGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgemkodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdGhpcy5zZXF1ZW5jZU51bWJlciwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIHQsIHRoaXMucmVzdW1lVG9rZW4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBTZXJpYWxpemVyIGZvciB2YWx1ZXMgc3RvcmVkIGluIHRoZSBMb2NhbFN0b3JlLiAqLyBjbGFzcyBIaSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmllID0gdDtcbiAgICB9XG59XG5cbi8qKiBEZWNvZGVzIGEgcmVtb3RlIGRvY3VtZW50IGZyb20gc3RvcmFnZSBsb2NhbGx5IHRvIGEgRG9jdW1lbnQuICovIGZ1bmN0aW9uIEppKHQsIGUpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAoZS5kb2N1bWVudCkgbiA9IFlzKHQuaWUsIGUuZG9jdW1lbnQsICEhZS5oYXNDb21taXR0ZWRNdXRhdGlvbnMpOyBlbHNlIGlmIChlLm5vRG9jdW1lbnQpIHtcbiAgICAgICAgY29uc3QgdCA9IGN0LmZyb21TZWdtZW50cyhlLm5vRG9jdW1lbnQucGF0aCksIHMgPSB0cihlLm5vRG9jdW1lbnQucmVhZFRpbWUpO1xuICAgICAgICBuID0gWmUubmV3Tm9Eb2N1bWVudCh0LCBzKSwgZS5oYXNDb21taXR0ZWRNdXRhdGlvbnMgJiYgbi5zZXRIYXNDb21taXR0ZWRNdXRhdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIWUudW5rbm93bkRvY3VtZW50KSByZXR1cm4gTygpO1xuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCB0ID0gY3QuZnJvbVNlZ21lbnRzKGUudW5rbm93bkRvY3VtZW50LnBhdGgpLCBzID0gdHIoZS51bmtub3duRG9jdW1lbnQudmVyc2lvbik7XG4gICAgICAgICAgICBuID0gWmUubmV3VW5rbm93bkRvY3VtZW50KHQsIHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlLnJlYWRUaW1lICYmIG4uc2V0UmVhZFRpbWUoZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IG50KHRbMF0sIHRbMV0pO1xuICAgICAgICByZXR1cm4gc3QuZnJvbVRpbWVzdGFtcChlKTtcbiAgICB9KGUucmVhZFRpbWUpKSwgbjtcbn1cblxuLyoqIEVuY29kZXMgYSBkb2N1bWVudCBmb3Igc3RvcmFnZSBsb2NhbGx5LiAqLyBmdW5jdGlvbiBZaSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IGUua2V5LCBzID0ge1xuICAgICAgICBwcmVmaXhQYXRoOiBuLmdldENvbGxlY3Rpb25QYXRoKCkucG9wTGFzdCgpLnRvQXJyYXkoKSxcbiAgICAgICAgY29sbGVjdGlvbkdyb3VwOiBuLmNvbGxlY3Rpb25Hcm91cCxcbiAgICAgICAgZG9jdW1lbnRJZDogbi5wYXRoLmxhc3RTZWdtZW50KCksXG4gICAgICAgIHJlYWRUaW1lOiBYaShlLnJlYWRUaW1lKSxcbiAgICAgICAgaGFzQ29tbWl0dGVkTXV0YXRpb25zOiBlLmhhc0NvbW1pdHRlZE11dGF0aW9uc1xuICAgIH07XG4gICAgaWYgKGUuaXNGb3VuZERvY3VtZW50KCkpIHMuZG9jdW1lbnQgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBuYW1lOiBHcyh0LCBlLmtleSksXG4gICAgICAgICAgICBmaWVsZHM6IGUuZGF0YS52YWx1ZS5tYXBWYWx1ZS5maWVsZHMsXG4gICAgICAgICAgICB1cGRhdGVUaW1lOiAkcyh0LCBlLnZlcnNpb24udG9UaW1lc3RhbXAoKSksXG4gICAgICAgICAgICBjcmVhdGVUaW1lOiAkcyh0LCBlLmNyZWF0ZVRpbWUudG9UaW1lc3RhbXAoKSlcbiAgICAgICAgfTtcbiAgICB9KHQuaWUsIGUpOyBlbHNlIGlmIChlLmlzTm9Eb2N1bWVudCgpKSBzLm5vRG9jdW1lbnQgPSB7XG4gICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgIHJlYWRUaW1lOiBaaShlLnZlcnNpb24pXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGlmICghZS5pc1Vua25vd25Eb2N1bWVudCgpKSByZXR1cm4gTygpO1xuICAgICAgICBzLnVua25vd25Eb2N1bWVudCA9IHtcbiAgICAgICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgICAgICB2ZXJzaW9uOiBaaShlLnZlcnNpb24pXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBzO1xufVxuXG5mdW5jdGlvbiBYaSh0KSB7XG4gICAgY29uc3QgZSA9IHQudG9UaW1lc3RhbXAoKTtcbiAgICByZXR1cm4gWyBlLnNlY29uZHMsIGUubmFub3NlY29uZHMgXTtcbn1cblxuZnVuY3Rpb24gWmkodCkge1xuICAgIGNvbnN0IGUgPSB0LnRvVGltZXN0YW1wKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2Vjb25kczogZS5zZWNvbmRzLFxuICAgICAgICBuYW5vc2Vjb25kczogZS5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIHRyKHQpIHtcbiAgICBjb25zdCBlID0gbmV3IG50KHQuc2Vjb25kcywgdC5uYW5vc2Vjb25kcyk7XG4gICAgcmV0dXJuIHN0LmZyb21UaW1lc3RhbXAoZSk7XG59XG5cbi8qKiBFbmNvZGVzIGEgYmF0Y2ggb2YgbXV0YXRpb25zIGludG8gYSBEYk11dGF0aW9uQmF0Y2ggZm9yIGxvY2FsIHN0b3JhZ2UuICovXG4vKiogRGVjb2RlcyBhIERiTXV0YXRpb25CYXRjaCBpbnRvIGEgTXV0YXRpb25CYXRjaCAqL1xuZnVuY3Rpb24gZXIodCwgZSkge1xuICAgIGNvbnN0IG4gPSAoZS5iYXNlTXV0YXRpb25zIHx8IFtdKS5tYXAoKGUgPT4gZWkodC5pZSwgZSkpKTtcbiAgICAvLyBTcXVhc2ggb2xkIHRyYW5zZm9ybSBtdXRhdGlvbnMgaW50byBleGlzdGluZyBwYXRjaCBvciBzZXQgbXV0YXRpb25zLlxuICAgIC8vIFRoZSByZXBsYWNlbWVudCBvZiByZXByZXNlbnRpbmcgYHRyYW5zZm9ybXNgIHdpdGggYHVwZGF0ZV90cmFuc2Zvcm1zYFxuICAgIC8vIG9uIHRoZSBTREsgbWVhbnMgdGhhdCBvbGQgYHRyYW5zZm9ybWAgbXV0YXRpb25zIHN0b3JlZCBpbiBJbmRleGVkREIgbmVlZFxuICAgIC8vIHRvIGJlIHVwZGF0ZWQgdG8gYHVwZGF0ZV90cmFuc2Zvcm1zYC5cbiAgICAvLyBUT0RPKGIvMTc0NjA4Mzc0KTogUmVtb3ZlIHRoaXMgY29kZSBvbmNlIHdlIHBlcmZvcm0gYSBzY2hlbWEgbWlncmF0aW9uLlxuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IGUubXV0YXRpb25zLmxlbmd0aCAtIDE7ICsrdCkge1xuICAgICAgICBjb25zdCBuID0gZS5tdXRhdGlvbnNbdF07XG4gICAgICAgIGlmICh0ICsgMSA8IGUubXV0YXRpb25zLmxlbmd0aCAmJiB2b2lkIDAgIT09IGUubXV0YXRpb25zW3QgKyAxXS50cmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBlLm11dGF0aW9uc1t0ICsgMV07XG4gICAgICAgICAgICBuLnVwZGF0ZVRyYW5zZm9ybXMgPSBzLnRyYW5zZm9ybS5maWVsZFRyYW5zZm9ybXMsIGUubXV0YXRpb25zLnNwbGljZSh0ICsgMSwgMSksIFxuICAgICAgICAgICAgKyt0O1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHMgPSBlLm11dGF0aW9ucy5tYXAoKGUgPT4gZWkodC5pZSwgZSkpKSwgaSA9IG50LmZyb21NaWxsaXMoZS5sb2NhbFdyaXRlVGltZU1zKTtcbiAgICByZXR1cm4gbmV3IFFpKGUuYmF0Y2hJZCwgaSwgbiwgcyk7XG59XG5cbi8qKiBEZWNvZGVzIGEgRGJUYXJnZXQgaW50byBUYXJnZXREYXRhICovIGZ1bmN0aW9uIG5yKHQpIHtcbiAgICBjb25zdCBlID0gdHIodC5yZWFkVGltZSksIG4gPSB2b2lkIDAgIT09IHQubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiA/IHRyKHQubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbikgOiBzdC5taW4oKTtcbiAgICBsZXQgcztcbiAgICB2YXIgaTtcbiAgICByZXR1cm4gdm9pZCAwICE9PSB0LnF1ZXJ5LmRvY3VtZW50cyA/IChNKDEgPT09IChpID0gdC5xdWVyeSkuZG9jdW1lbnRzLmxlbmd0aCksIFxuICAgIHMgPSBnbihsbihXcyhpLmRvY3VtZW50c1swXSkpKSkgOiBzID0gZnVuY3Rpb24odCkge1xuICAgICAgICByZXR1cm4gZ24ocmkodCkpO1xuICAgIH0odC5xdWVyeSksIG5ldyB6aShzLCB0LnRhcmdldElkLCAwIC8qIFRhcmdldFB1cnBvc2UuTGlzdGVuICovICwgdC5sYXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIsIGUsIG4sIFF0LmZyb21CYXNlNjRTdHJpbmcodC5yZXN1bWVUb2tlbikpO1xufVxuXG4vKiogRW5jb2RlcyBUYXJnZXREYXRhIGludG8gYSBEYlRhcmdldCBmb3Igc3RvcmFnZSBsb2NhbGx5LiAqLyBmdW5jdGlvbiBzcih0LCBlKSB7XG4gICAgY29uc3QgbiA9IFppKGUuc25hcHNob3RWZXJzaW9uKSwgcyA9IFppKGUubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbik7XG4gICAgbGV0IGk7XG4gICAgaSA9IHJuKGUudGFyZ2V0KSA/IHNpKHQuaWUsIGUudGFyZ2V0KSA6IGlpKHQuaWUsIGUudGFyZ2V0KTtcbiAgICAvLyBXZSBjYW4ndCBzdG9yZSB0aGUgcmVzdW1lVG9rZW4gYXMgYSBCeXRlU3RyaW5nIGluIEluZGV4ZWREYiwgc28gd2VcbiAgICAvLyBjb252ZXJ0IGl0IHRvIGEgYmFzZTY0IHN0cmluZyBmb3Igc3RvcmFnZS5cbiAgICAgICAgY29uc3QgciA9IGUucmVzdW1lVG9rZW4udG9CYXNlNjQoKTtcbiAgICAvLyBsYXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgaXMgYWx3YXlzIDAgdW50aWwgd2UgZG8gcmVhbCBHQy5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGFyZ2V0SWQ6IGUudGFyZ2V0SWQsXG4gICAgICAgIGNhbm9uaWNhbElkOiBubihlLnRhcmdldCksXG4gICAgICAgIHJlYWRUaW1lOiBuLFxuICAgICAgICByZXN1bWVUb2tlbjogcixcbiAgICAgICAgbGFzdExpc3RlblNlcXVlbmNlTnVtYmVyOiBlLnNlcXVlbmNlTnVtYmVyLFxuICAgICAgICBsYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uOiBzLFxuICAgICAgICBxdWVyeTogaVxuICAgIH07XG59XG5cbi8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIGZpZ3VyaW5nIG91dCB3aGF0IGtpbmQgb2YgcXVlcnkgaGFzIGJlZW4gc3RvcmVkLlxuICovXG4vKipcbiAqIEVuY29kZXMgYSBgQnVuZGxlZFF1ZXJ5YCBmcm9tIGJ1bmRsZSBwcm90byB0byBhIFF1ZXJ5IG9iamVjdC5cbiAqXG4gKiBUaGlzIHJlY29uc3RydWN0cyB0aGUgb3JpZ2luYWwgcXVlcnkgdXNlZCB0byBidWlsZCB0aGUgYnVuZGxlIGJlaW5nIGxvYWRlZCxcbiAqIGluY2x1ZGluZyBmZWF0dXJlcyBleGlzdHMgb25seSBpbiBTREtzIChmb3IgZXhhbXBsZTogbGltaXQtdG8tbGFzdCkuXG4gKi9cbmZ1bmN0aW9uIGlyKHQpIHtcbiAgICBjb25zdCBlID0gcmkoe1xuICAgICAgICBwYXJlbnQ6IHQucGFyZW50LFxuICAgICAgICBzdHJ1Y3R1cmVkUXVlcnk6IHQuc3RydWN0dXJlZFF1ZXJ5XG4gICAgfSk7XG4gICAgcmV0dXJuIFwiTEFTVFwiID09PSB0LmxpbWl0VHlwZSA/IHBuKGUsIGUubGltaXQsIFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovKSA6IGU7XG59XG5cbi8qKiBFbmNvZGVzIGEgTmFtZWRRdWVyeSBwcm90byBvYmplY3QgdG8gYSBOYW1lZFF1ZXJ5IG1vZGVsIG9iamVjdC4gKi9cbi8qKiBFbmNvZGVzIGEgRGJEb2N1bWVudE92ZXJsYXkgb2JqZWN0IHRvIGFuIE92ZXJsYXkgbW9kZWwgb2JqZWN0LiAqL1xuZnVuY3Rpb24gcnIodCwgZSkge1xuICAgIHJldHVybiBuZXcgV2koZS5sYXJnZXN0QmF0Y2hJZCwgZWkodC5pZSwgZS5vdmVybGF5TXV0YXRpb24pKTtcbn1cblxuLyoqIERlY29kZXMgYW4gT3ZlcmxheSBtb2RlbCBvYmplY3QgaW50byBhIERiRG9jdW1lbnRPdmVybGF5IG9iamVjdC4gKi9cbi8qKlxuICogUmV0dXJucyB0aGUgRGJEb2N1bWVudE92ZXJsYXlLZXkgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gdXNlciBhbmRcbiAqIGRvY3VtZW50IGtleS5cbiAqL1xuZnVuY3Rpb24gb3IodCwgZSkge1xuICAgIGNvbnN0IG4gPSBlLnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICByZXR1cm4gWyB0LCBtaShlLnBhdGgucG9wTGFzdCgpKSwgbiBdO1xufVxuXG5mdW5jdGlvbiB1cih0LCBlLCBuLCBzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5kZXhJZDogdCxcbiAgICAgICAgdWlkOiBlLnVpZCB8fCBcIlwiLFxuICAgICAgICBzZXF1ZW5jZU51bWJlcjogbixcbiAgICAgICAgcmVhZFRpbWU6IFppKHMucmVhZFRpbWUpLFxuICAgICAgICBkb2N1bWVudEtleTogbWkocy5kb2N1bWVudEtleS5wYXRoKSxcbiAgICAgICAgbGFyZ2VzdEJhdGNoSWQ6IHMubGFyZ2VzdEJhdGNoSWRcbiAgICB9O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBjciB7XG4gICAgZ2V0QnVuZGxlTWV0YWRhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gYXIodCkuZ2V0KGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgaWYgKHQpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IChlID0gdCkuYnVuZGxlSWQsXG4gICAgICAgICAgICAgICAgY3JlYXRlVGltZTogdHIoZS5jcmVhdGVUaW1lKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBlLnZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvKiogRW5jb2RlcyBhIERiQnVuZGxlIHRvIGEgQnVuZGxlTWV0YWRhdGEgb2JqZWN0LiAqL1xuICAgICAgICAgICAgdmFyIGU7XG4gICAgICAgICAgICAvKiogRW5jb2RlcyBhIEJ1bmRsZU1ldGFkYXRhIHRvIGEgRGJCdW5kbGUuICovICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNhdmVCdW5kbGVNZXRhZGF0YSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBhcih0KS5wdXQoe1xuICAgICAgICAgICAgYnVuZGxlSWQ6IChuID0gZSkuaWQsXG4gICAgICAgICAgICBjcmVhdGVUaW1lOiBaaShxcyhuLmNyZWF0ZVRpbWUpKSxcbiAgICAgICAgICAgIHZlcnNpb246IG4udmVyc2lvblxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG47XG4gICAgICAgIC8qKiBFbmNvZGVzIGEgRGJOYW1lZFF1ZXJ5IHRvIGEgTmFtZWRRdWVyeS4gKi8gICAgfVxuICAgIGdldE5hbWVkUXVlcnkodCwgZSkge1xuICAgICAgICByZXR1cm4gaHIodCkuZ2V0KGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgaWYgKHQpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogKGUgPSB0KS5uYW1lLFxuICAgICAgICAgICAgICAgIHF1ZXJ5OiBpcihlLmJ1bmRsZWRRdWVyeSksXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IHRyKGUucmVhZFRpbWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIGU7XG4gICAgICAgICAgICAvKiogRW5jb2RlcyBhIE5hbWVkUXVlcnkgZnJvbSBhIGJ1bmRsZSBwcm90byB0byBhIERiTmFtZWRRdWVyeS4gKi8gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2F2ZU5hbWVkUXVlcnkodCwgZSkge1xuICAgICAgICByZXR1cm4gaHIodCkucHV0KGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgbmFtZTogdC5uYW1lLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBaaShxcyh0LnJlYWRUaW1lKSksXG4gICAgICAgICAgICAgICAgYnVuZGxlZFF1ZXJ5OiB0LmJ1bmRsZWRRdWVyeVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfShlKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgYnVuZGxlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gYXIodCkge1xuICAgIHJldHVybiBHaSh0LCBcImJ1bmRsZXNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBuYW1lZFF1ZXJpZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIGhyKHQpIHtcbiAgICByZXR1cm4gR2kodCwgXCJuYW1lZFF1ZXJpZXNcIik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIERvY3VtZW50T3ZlcmxheUNhY2hlIHVzaW5nIEluZGV4ZWREYi5cbiAqLyBjbGFzcyBsciB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHNlcmlhbGl6ZXIgLSBUaGUgZG9jdW1lbnQgc2VyaWFsaXplci5cbiAgICAgKiBAcGFyYW0gdXNlcklkIC0gVGhlIHVzZXJJZCBmb3Igd2hpY2ggd2UgYXJlIGFjY2Vzc2luZyBvdmVybGF5cy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMueXQgPSB0LCB0aGlzLnVzZXJJZCA9IGU7XG4gICAgfVxuICAgIHN0YXRpYyByZSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLnVpZCB8fCBcIlwiO1xuICAgICAgICByZXR1cm4gbmV3IGxyKHQsIG4pO1xuICAgIH1cbiAgICBnZXRPdmVybGF5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIGZyKHQpLmdldChvcih0aGlzLnVzZXJJZCwgZSkpLm5leHQoKHQgPT4gdCA/IHJyKHRoaXMueXQsIHQpIDogbnVsbCkpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5cyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBncygpO1xuICAgICAgICByZXR1cm4gQXQuZm9yRWFjaChlLCAoZSA9PiB0aGlzLmdldE92ZXJsYXkodCwgZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBudWxsICE9PSB0ICYmIG4uc2V0KGUsIHQpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIHNhdmVPdmVybGF5cyh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIGkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgV2koZSwgaSk7XG4gICAgICAgICAgICBzLnB1c2godGhpcy5vZSh0LCByKSk7XG4gICAgICAgIH0pKSwgQXQud2FpdEZvcihzKTtcbiAgICB9XG4gICAgcmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBTZXQ7XG4gICAgICAgIC8vIEdldCB0aGUgc2V0IG9mIHVuaXF1ZSBjb2xsZWN0aW9uIHBhdGhzLlxuICAgICAgICAgICAgICAgIGUuZm9yRWFjaCgodCA9PiBzLmFkZChtaSh0LmdldENvbGxlY3Rpb25QYXRoKCkpKSkpO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiBzLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIGUsIG4gXSwgWyB0aGlzLnVzZXJJZCwgZSwgbiArIDEgXSwgXG4gICAgICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgICAgICBpLnB1c2goZnIodCkuWShcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIHMpKTtcbiAgICAgICAgfSkpLCBBdC53YWl0Rm9yKGkpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gZ3MoKSwgaSA9IG1pKGUpLCByID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgaSwgbiBdLCBbIHRoaXMudXNlcklkLCBpLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIGZyKHQpLlcoXCJjb2xsZWN0aW9uUGF0aE92ZXJsYXlJbmRleFwiLCByKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHJyKHRoaXMueXQsIGUpO1xuICAgICAgICAgICAgICAgIHMuc2V0KHQuZ2V0S2V5KCksIHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHM7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAodCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gZ3MoKTtcbiAgICAgICAgbGV0IHI7XG4gICAgICAgIC8vIFdlIHdhbnQgYmF0Y2ggSURzIGxhcmdlciB0aGFuIGBzaW5jZUJhdGNoSWRgLCBhbmQgc28gdGhlIGxvd2VyIGJvdW5kXG4gICAgICAgIC8vIGlzIG5vdCBpbmNsdXNpdmUuXG4gICAgICAgICAgICAgICAgY29uc3QgbyA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIGUsIG4gXSwgWyB0aGlzLnVzZXJJZCwgZSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMCk7XG4gICAgICAgIHJldHVybiBmcih0KS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcImNvbGxlY3Rpb25Hcm91cE92ZXJsYXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IG9cbiAgICAgICAgfSwgKCh0LCBlLCBuKSA9PiB7XG4gICAgICAgICAgICAvLyBXZSBkbyBub3Qgd2FudCB0byByZXR1cm4gcGFydGlhbCBiYXRjaCBvdmVybGF5cywgZXZlbiBpZiB0aGUgc2l6ZVxuICAgICAgICAgICAgLy8gb2YgdGhlIHJlc3VsdCBzZXQgZXhjZWVkcyB0aGUgZ2l2ZW4gYGNvdW50YCBhcmd1bWVudC4gVGhlcmVmb3JlLCB3ZVxuICAgICAgICAgICAgLy8gY29udGludWUgdG8gYWdncmVnYXRlIHJlc3VsdHMgZXZlbiBhZnRlciB0aGUgcmVzdWx0IHNpemUgZXhjZWVkc1xuICAgICAgICAgICAgLy8gYGNvdW50YCBpZiB0aGVyZSBhcmUgbW9yZSBvdmVybGF5cyBmcm9tIHRoZSBgY3VycmVudEJhdGNoSWRgLlxuICAgICAgICAgICAgY29uc3QgbyA9IHJyKHRoaXMueXQsIGUpO1xuICAgICAgICAgICAgaS5zaXplKCkgPCBzIHx8IG8ubGFyZ2VzdEJhdGNoSWQgPT09IHIgPyAoaS5zZXQoby5nZXRLZXkoKSwgbyksIHIgPSBvLmxhcmdlc3RCYXRjaElkKSA6IG4uZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBvZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBmcih0KS5wdXQoZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgY29uc3QgW3MsIGksIHJdID0gb3IoZSwgbi5tdXRhdGlvbi5rZXkpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB1c2VySWQ6IGUsXG4gICAgICAgICAgICAgICAgY29sbGVjdGlvblBhdGg6IGksXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRJZDogcixcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IG4ubXV0YXRpb24ua2V5LmdldENvbGxlY3Rpb25Hcm91cCgpLFxuICAgICAgICAgICAgICAgIGxhcmdlc3RCYXRjaElkOiBuLmxhcmdlc3RCYXRjaElkLFxuICAgICAgICAgICAgICAgIG92ZXJsYXlNdXRhdGlvbjogdGkodC5pZSwgbi5tdXRhdGlvbilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0odGhpcy55dCwgdGhpcy51c2VySWQsIGUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBkb2N1bWVudCBvdmVybGF5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBmcih0KSB7XG4gICAgcmV0dXJuIEdpKHQsIFwiZG9jdW1lbnRPdmVybGF5c1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIE5vdGU6IFRoaXMgY29kZSBpcyBjb3BpZWQgZnJvbSB0aGUgYmFja2VuZC4gQ29kZSB0aGF0IGlzIG5vdCB1c2VkIGJ5XG4vLyBGaXJlc3RvcmUgd2FzIHJlbW92ZWQuXG4vKiogRmlyZXN0b3JlIGluZGV4IHZhbHVlIHdyaXRlci4gICovXG5jbGFzcyBkciB7XG4gICAgY29uc3RydWN0b3IoKSB7fVxuICAgIC8vIFRoZSB3cml0ZSBtZXRob2RzIGJlbG93IHNob3J0LWNpcmN1aXQgd3JpdGluZyB0ZXJtaW5hdG9ycyBmb3IgdmFsdWVzXG4gICAgLy8gY29udGFpbmluZyBhICh0ZXJtaW5hdGluZykgdHJ1bmNhdGVkIHZhbHVlLlxuICAgIC8vIEFzIGFuIGV4YW1wbGUsIGNvbnNpZGVyIHRoZSByZXN1bHRpbmcgZW5jb2RpbmcgZm9yOlxuICAgIC8vIFtcImJhclwiLCBbMiwgXCJmb29cIl1dIC0+IChTVFJJTkcsIFwiYmFyXCIsIFRFUk0sIEFSUkFZLCBOVU1CRVIsIDIsIFNUUklORywgXCJmb29cIiwgVEVSTSwgVEVSTSwgVEVSTSlcbiAgICAvLyBbXCJiYXJcIiwgWzIsIHRydW5jYXRlZChcImZvb1wiKV1dIC0+IChTVFJJTkcsIFwiYmFyXCIsIFRFUk0sIEFSUkFZLCBOVU1CRVIsIDIsIFNUUklORywgXCJmb29cIiwgVFJVTkMpXG4gICAgLy8gW1wiYmFyXCIsIHRydW5jYXRlZChbXCJmb29cIl0pXSAtPiAoU1RSSU5HLCBcImJhclwiLCBURVJNLCBBUlJBWS4gU1RSSU5HLCBcImZvb1wiLCBURVJNLCBUUlVOQylcbiAgICAvKiogV3JpdGVzIGFuIGluZGV4IHZhbHVlLiAgKi9cbiAgICB1ZSh0LCBlKSB7XG4gICAgICAgIHRoaXMuY2UodCwgZSksIFxuICAgICAgICAvLyBXcml0ZSBzZXBhcmF0b3IgdG8gc3BsaXQgaW5kZXggdmFsdWVzXG4gICAgICAgIC8vIChzZWUgZ28vZmlyZXN0b3JlLXN0b3JhZ2UtZm9ybWF0I2VuY29kaW5ncykuXG4gICAgICAgIGUuYWUoKTtcbiAgICB9XG4gICAgY2UodCwgZSkge1xuICAgICAgICBpZiAoXCJudWxsVmFsdWVcIiBpbiB0KSB0aGlzLmhlKGUsIDUpOyBlbHNlIGlmIChcImJvb2xlYW5WYWx1ZVwiIGluIHQpIHRoaXMuaGUoZSwgMTApLCBcbiAgICAgICAgZS5sZSh0LmJvb2xlYW5WYWx1ZSA/IDEgOiAwKTsgZWxzZSBpZiAoXCJpbnRlZ2VyVmFsdWVcIiBpbiB0KSB0aGlzLmhlKGUsIDE1KSwgZS5sZSh6dCh0LmludGVnZXJWYWx1ZSkpOyBlbHNlIGlmIChcImRvdWJsZVZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHp0KHQuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgaXNOYU4obikgPyB0aGlzLmhlKGUsIDEzKSA6ICh0aGlzLmhlKGUsIDE1KSwgVXQobikgPyBcbiAgICAgICAgICAgIC8vIC0wLjAsIDAgYW5kIDAuMCBhcmUgYWxsIGNvbnNpZGVyZWQgdGhlIHNhbWVcbiAgICAgICAgICAgIGUubGUoMCkgOiBlLmxlKG4pKTtcbiAgICAgICAgfSBlbHNlIGlmIChcInRpbWVzdGFtcFZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQudGltZXN0YW1wVmFsdWU7XG4gICAgICAgICAgICB0aGlzLmhlKGUsIDIwKSwgXCJzdHJpbmdcIiA9PSB0eXBlb2YgbiA/IGUuZmUobikgOiAoZS5mZShgJHtuLnNlY29uZHMgfHwgXCJcIn1gKSwgZS5sZShuLm5hbm9zIHx8IDApKTtcbiAgICAgICAgfSBlbHNlIGlmIChcInN0cmluZ1ZhbHVlXCIgaW4gdCkgdGhpcy5kZSh0LnN0cmluZ1ZhbHVlLCBlKSwgdGhpcy5fZShlKTsgZWxzZSBpZiAoXCJieXRlc1ZhbHVlXCIgaW4gdCkgdGhpcy5oZShlLCAzMCksIFxuICAgICAgICBlLndlKEh0KHQuYnl0ZXNWYWx1ZSkpLCB0aGlzLl9lKGUpOyBlbHNlIGlmIChcInJlZmVyZW5jZVZhbHVlXCIgaW4gdCkgdGhpcy5tZSh0LnJlZmVyZW5jZVZhbHVlLCBlKTsgZWxzZSBpZiAoXCJnZW9Qb2ludFZhbHVlXCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHQuZ2VvUG9pbnRWYWx1ZTtcbiAgICAgICAgICAgIHRoaXMuaGUoZSwgNDUpLCBlLmxlKG4ubGF0aXR1ZGUgfHwgMCksIGUubGUobi5sb25naXR1ZGUgfHwgMCk7XG4gICAgICAgIH0gZWxzZSBcIm1hcFZhbHVlXCIgaW4gdCA/IHdlKHQpID8gdGhpcy5oZShlLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgOiAodGhpcy5nZSh0Lm1hcFZhbHVlLCBlKSwgXG4gICAgICAgIHRoaXMuX2UoZSkpIDogXCJhcnJheVZhbHVlXCIgaW4gdCA/ICh0aGlzLnllKHQuYXJyYXlWYWx1ZSwgZSksIHRoaXMuX2UoZSkpIDogTygpO1xuICAgIH1cbiAgICBkZSh0LCBlKSB7XG4gICAgICAgIHRoaXMuaGUoZSwgMjUpLCB0aGlzLnBlKHQsIGUpO1xuICAgIH1cbiAgICBwZSh0LCBlKSB7XG4gICAgICAgIGUuZmUodCk7XG4gICAgfVxuICAgIGdlKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHQuZmllbGRzIHx8IHt9O1xuICAgICAgICB0aGlzLmhlKGUsIDU1KTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIE9iamVjdC5rZXlzKG4pKSB0aGlzLmRlKHQsIGUpLCB0aGlzLmNlKG5bdF0sIGUpO1xuICAgIH1cbiAgICB5ZSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnZhbHVlcyB8fCBbXTtcbiAgICAgICAgdGhpcy5oZShlLCA1MCk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBuKSB0aGlzLmNlKHQsIGUpO1xuICAgIH1cbiAgICBtZSh0LCBlKSB7XG4gICAgICAgIHRoaXMuaGUoZSwgMzcpO1xuICAgICAgICBjdC5mcm9tTmFtZSh0KS5wYXRoLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5oZShlLCA2MCksIHRoaXMucGUodCwgZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgaGUodCwgZSkge1xuICAgICAgICB0LmxlKGUpO1xuICAgIH1cbiAgICBfZSh0KSB7XG4gICAgICAgIC8vIFdoaWxlIHRoZSBTREsgZG9lcyBub3QgaW1wbGVtZW50IHRydW5jYXRpb24sIHRoZSB0cnVuY2F0aW9uIG1hcmtlciBpc1xuICAgICAgICAvLyB1c2VkIHRvIHRlcm1pbmF0ZSBhbGwgdmFyaWFibGUgbGVuZ3RoIHZhbHVlcyAod2hpY2ggYXJlIHN0cmluZ3MsIGJ5dGVzLFxuICAgICAgICAvLyByZWZlcmVuY2VzLCBhcnJheXMgYW5kIG1hcHMpLlxuICAgICAgICB0LmxlKDIpO1xuICAgIH1cbn1cblxuZHIuSWUgPSBuZXcgZHI7XG5cbi8qKlxuICogQ291bnRzIHRoZSBudW1iZXIgb2YgemVyb3MgaW4gYSBieXRlLlxuICpcbiAqIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gKi9cbmZ1bmN0aW9uIF9yKHQpIHtcbiAgICBpZiAoMCA9PT0gdCkgcmV0dXJuIDg7XG4gICAgbGV0IGUgPSAwO1xuICAgIHJldHVybiB0ID4+IDQgPT0gMCAmJiAoXG4gICAgLy8gVGVzdCBpZiB0aGUgZmlyc3QgZm91ciBiaXRzIGFyZSB6ZXJvLlxuICAgIGUgKz0gNCwgdCA8PD0gNCksIHQgPj4gNiA9PSAwICYmIChcbiAgICAvLyBUZXN0IGlmIHRoZSBmaXJzdCB0d28gKG9yIG5leHQgdHdvKSBiaXRzIGFyZSB6ZXJvLlxuICAgIGUgKz0gMiwgdCA8PD0gMiksIHQgPj4gNyA9PSAwICYmIChcbiAgICAvLyBUZXN0IGlmIHRoZSByZW1haW5pbmcgYml0IGlzIHplcm8uXG4gICAgZSArPSAxKSwgZTtcbn1cblxuLyoqIENvdW50cyB0aGUgbnVtYmVyIG9mIGxlYWRpbmcgemVyb3MgaW4gdGhlIGdpdmVuIGJ5dGUgYXJyYXkuICovXG4vKipcbiAqIFJldHVybnMgdGhlIG51bWJlciBvZiBieXRlcyByZXF1aXJlZCB0byBzdG9yZSBcInZhbHVlXCIuIExlYWRpbmcgemVybyBieXRlc1xuICogYXJlIHNraXBwZWQuXG4gKi9cbmZ1bmN0aW9uIHdyKHQpIHtcbiAgICAvLyBUaGlzIGlzIGp1c3QgdGhlIG51bWJlciBvZiBieXRlcyBmb3IgdGhlIHVuc2lnbmVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBudW1iZXIuXG4gICAgY29uc3QgZSA9IDY0IC0gZnVuY3Rpb24odCkge1xuICAgICAgICBsZXQgZSA9IDA7XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgODsgKytuKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gX3IoMjU1ICYgdFtuXSk7XG4gICAgICAgICAgICBpZiAoZSArPSBzLCA4ICE9PSBzKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9KHQpO1xuICAgIHJldHVybiBNYXRoLmNlaWwoZSAvIDgpO1xufVxuXG4vKipcbiAqIE9yZGVyZWRDb2RlV3JpdGVyIGlzIGEgbWluaW1hbC1hbGxvY2F0aW9uIGltcGxlbWVudGF0aW9uIG9mIHRoZSB3cml0aW5nXG4gKiBiZWhhdmlvciBkZWZpbmVkIGJ5IHRoZSBiYWNrZW5kLlxuICpcbiAqIFRoZSBjb2RlIGlzIHBvcnRlZCBmcm9tIGl0cyBKYXZhIGNvdW50ZXJwYXJ0LlxuICovIGNsYXNzIG1yIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxMDI0KSwgdGhpcy5wb3NpdGlvbiA9IDA7XG4gICAgfVxuICAgIFRlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICBsZXQgbiA9IGUubmV4dCgpO1xuICAgICAgICBmb3IgKDshbi5kb25lOyApIHRoaXMuRWUobi52YWx1ZSksIG4gPSBlLm5leHQoKTtcbiAgICAgICAgdGhpcy5BZSgpO1xuICAgIH1cbiAgICBSZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0W1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgbGV0IG4gPSBlLm5leHQoKTtcbiAgICAgICAgZm9yICg7IW4uZG9uZTsgKSB0aGlzLmJlKG4udmFsdWUpLCBuID0gZS5uZXh0KCk7XG4gICAgICAgIHRoaXMuUGUoKTtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyB1dGY4IGJ5dGVzIGludG8gdGhpcyBieXRlIHNlcXVlbmNlLCBhc2NlbmRpbmcuICovICAgIHZlKHQpIHtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICBpZiAodCA8IDEyOCkgdGhpcy5FZSh0KTsgZWxzZSBpZiAodCA8IDIwNDgpIHRoaXMuRWUoOTYwIHwgdCA+Pj4gNiksIHRoaXMuRWUoMTI4IHwgNjMgJiB0KTsgZWxzZSBpZiAoZSA8IFwiXFx1ZDgwMFwiIHx8IFwiXFx1ZGJmZlwiIDwgZSkgdGhpcy5FZSg0ODAgfCB0ID4+PiAxMiksIFxuICAgICAgICAgICAgdGhpcy5FZSgxMjggfCA2MyAmIHQgPj4+IDYpLCB0aGlzLkVlKDEyOCB8IDYzICYgdCk7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNvZGVQb2ludEF0KDApO1xuICAgICAgICAgICAgICAgIHRoaXMuRWUoMjQwIHwgdCA+Pj4gMTgpLCB0aGlzLkVlKDEyOCB8IDYzICYgdCA+Pj4gMTIpLCB0aGlzLkVlKDEyOCB8IDYzICYgdCA+Pj4gNiksIFxuICAgICAgICAgICAgICAgIHRoaXMuRWUoMTI4IHwgNjMgJiB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLkFlKCk7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgdXRmOCBieXRlcyBpbnRvIHRoaXMgYnl0ZSBzZXF1ZW5jZSwgZGVzY2VuZGluZyAqLyAgICBWZSh0KSB7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgaWYgKHQgPCAxMjgpIHRoaXMuYmUodCk7IGVsc2UgaWYgKHQgPCAyMDQ4KSB0aGlzLmJlKDk2MCB8IHQgPj4+IDYpLCB0aGlzLmJlKDEyOCB8IDYzICYgdCk7IGVsc2UgaWYgKGUgPCBcIlxcdWQ4MDBcIiB8fCBcIlxcdWRiZmZcIiA8IGUpIHRoaXMuYmUoNDgwIHwgdCA+Pj4gMTIpLCBcbiAgICAgICAgICAgIHRoaXMuYmUoMTI4IHwgNjMgJiB0ID4+PiA2KSwgdGhpcy5iZSgxMjggfCA2MyAmIHQpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5jb2RlUG9pbnRBdCgwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmJlKDI0MCB8IHQgPj4+IDE4KSwgdGhpcy5iZSgxMjggfCA2MyAmIHQgPj4+IDEyKSwgdGhpcy5iZSgxMjggfCA2MyAmIHQgPj4+IDYpLCBcbiAgICAgICAgICAgICAgICB0aGlzLmJlKDEyOCB8IDYzICYgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5QZSgpO1xuICAgIH1cbiAgICBTZSh0KSB7XG4gICAgICAgIC8vIFZhbHVlcyBhcmUgZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGJ5dGUgbGVuZ3RoIHByZWZpeCwgZm9sbG93ZWQgYnkgdGhlXG4gICAgICAgIC8vIGFjdHVhbCB2YWx1ZSBpbiBiaWctZW5kaWFuIGZvcm1hdCB3aXRoIGxlYWRpbmcgMCBieXRlcyBkcm9wcGVkLlxuICAgICAgICBjb25zdCBlID0gdGhpcy5EZSh0KSwgbiA9IHdyKGUpO1xuICAgICAgICB0aGlzLkNlKDEgKyBuKSwgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IDI1NSAmIG47XG4gICAgICAgIC8vIFdyaXRlIHRoZSBsZW5ndGhcbiAgICAgICAgZm9yIChsZXQgdCA9IGUubGVuZ3RoIC0gbjsgdCA8IGUubGVuZ3RoOyArK3QpIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSAyNTUgJiBlW3RdO1xuICAgIH1cbiAgICB4ZSh0KSB7XG4gICAgICAgIC8vIFZhbHVlcyBhcmUgZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGJ5dGUgbGVuZ3RoIHByZWZpeCwgZm9sbG93ZWQgYnkgdGhlXG4gICAgICAgIC8vIGludmVydGVkIHZhbHVlIGluIGJpZy1lbmRpYW4gZm9ybWF0IHdpdGggbGVhZGluZyAwIGJ5dGVzIGRyb3BwZWQuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLkRlKHQpLCBuID0gd3IoZSk7XG4gICAgICAgIHRoaXMuQ2UoMSArIG4pLCB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gfigyNTUgJiBuKTtcbiAgICAgICAgLy8gV3JpdGUgdGhlIGxlbmd0aFxuICAgICAgICBmb3IgKGxldCB0ID0gZS5sZW5ndGggLSBuOyB0IDwgZS5sZW5ndGg7ICsrdCkgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IH4oMjU1ICYgZVt0XSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyB0aGUgXCJpbmZpbml0eVwiIGJ5dGUgc2VxdWVuY2UgdGhhdCBzb3J0cyBhZnRlciBhbGwgb3RoZXIgYnl0ZVxuICAgICAqIHNlcXVlbmNlcyB3cml0dGVuIGluIGFzY2VuZGluZyBvcmRlci5cbiAgICAgKi8gICAgTmUoKSB7XG4gICAgICAgIHRoaXMua2UoMjU1KSwgdGhpcy5rZSgyNTUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBXcml0ZXMgdGhlIFwiaW5maW5pdHlcIiBieXRlIHNlcXVlbmNlIHRoYXQgc29ydHMgYmVmb3JlIGFsbCBvdGhlciBieXRlXG4gICAgICogc2VxdWVuY2VzIHdyaXR0ZW4gaW4gZGVzY2VuZGluZyBvcmRlci5cbiAgICAgKi8gICAgT2UoKSB7XG4gICAgICAgIHRoaXMuTWUoMjU1KSwgdGhpcy5NZSgyNTUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJ1ZmZlciBzdWNoIHRoYXQgaXQgaXMgdGhlIHNhbWUgYXMgd2hlbiBpdCB3YXMgbmV3bHlcbiAgICAgKiBjb25zdHJ1Y3RlZC5cbiAgICAgKi8gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSAwO1xuICAgIH1cbiAgICBzZWVkKHQpIHtcbiAgICAgICAgdGhpcy5DZSh0Lmxlbmd0aCksIHRoaXMuYnVmZmVyLnNldCh0LCB0aGlzLnBvc2l0aW9uKSwgdGhpcy5wb3NpdGlvbiArPSB0Lmxlbmd0aDtcbiAgICB9XG4gICAgLyoqIE1ha2VzIGEgY29weSBvZiB0aGUgZW5jb2RlZCBieXRlcyBpbiB0aGlzIGJ1ZmZlci4gICovICAgIEZlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIuc2xpY2UoMCwgdGhpcy5wb3NpdGlvbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuY29kZXMgYHZhbGAgaW50byBhbiBlbmNvZGluZyBzbyB0aGF0IHRoZSBvcmRlciBtYXRjaGVzIHRoZSBJRUVFIDc1NFxuICAgICAqIGZsb2F0aW5nLXBvaW50IGNvbXBhcmlzb24gcmVzdWx0cyB3aXRoIHRoZSBmb2xsb3dpbmcgZXhjZXB0aW9uczpcbiAgICAgKiAgIC0wLjAgPCAwLjBcbiAgICAgKiAgIGFsbCBub24tTmFOIDwgTmFOXG4gICAgICogICBOYU4gPSBOYU5cbiAgICAgKi8gICAgRGUodCkge1xuICAgICAgICBjb25zdCBlID0gXG4gICAgICAgIC8qKiBDb252ZXJ0cyBhIEphdmFTY3JpcHQgbnVtYmVyIHRvIGEgYnl0ZSBhcnJheSAodXNpbmcgYmlnIGVuZGlhbiBlbmNvZGluZykuICovXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKDgpKTtcbiAgICAgICAgICAgIHJldHVybiBlLnNldEZsb2F0NjQoMCwgdCwgLyogbGl0dGxlRW5kaWFuPSAqLyAhMSksIG5ldyBVaW50OEFycmF5KGUuYnVmZmVyKTtcbiAgICAgICAgfSh0KSwgbiA9IDAgIT0gKDEyOCAmIGVbMF0pO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgZmlyc3QgYml0IGlzIHNldC4gV2UgdXNlIGEgYml0IG1hc2sgc2luY2UgdmFsdWVbMF0gaXNcbiAgICAgICAgLy8gZW5jb2RlZCBhcyBhIG51bWJlciBmcm9tIDAgdG8gMjU1LlxuICAgICAgICAgICAgICAgIC8vIFJldmVydCB0aGUgdHdvIGNvbXBsZW1lbnQgdG8gZ2V0IG5hdHVyYWwgb3JkZXJpbmdcbiAgICAgICAgZVswXSBePSBuID8gMjU1IDogMTI4O1xuICAgICAgICBmb3IgKGxldCB0ID0gMTsgdCA8IGUubGVuZ3RoOyArK3QpIGVbdF0gXj0gbiA/IDI1NSA6IDA7XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGEgc2luZ2xlIGJ5dGUgYXNjZW5kaW5nIHRvIHRoZSBidWZmZXIuICovICAgIEVlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IDI1NSAmIHQ7XG4gICAgICAgIDAgPT09IGUgPyAodGhpcy5rZSgwKSwgdGhpcy5rZSgyNTUpKSA6IDI1NSA9PT0gZSA/ICh0aGlzLmtlKDI1NSksIHRoaXMua2UoMCkpIDogdGhpcy5rZShlKTtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyBhIHNpbmdsZSBieXRlIGRlc2NlbmRpbmcgdG8gdGhlIGJ1ZmZlci4gICovICAgIGJlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IDI1NSAmIHQ7XG4gICAgICAgIDAgPT09IGUgPyAodGhpcy5NZSgwKSwgdGhpcy5NZSgyNTUpKSA6IDI1NSA9PT0gZSA/ICh0aGlzLk1lKDI1NSksIHRoaXMuTWUoMCkpIDogdGhpcy5NZSh0KTtcbiAgICB9XG4gICAgQWUoKSB7XG4gICAgICAgIHRoaXMua2UoMCksIHRoaXMua2UoMSk7XG4gICAgfVxuICAgIFBlKCkge1xuICAgICAgICB0aGlzLk1lKDApLCB0aGlzLk1lKDEpO1xuICAgIH1cbiAgICBrZSh0KSB7XG4gICAgICAgIHRoaXMuQ2UoMSksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB0O1xuICAgIH1cbiAgICBNZSh0KSB7XG4gICAgICAgIHRoaXMuQ2UoMSksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB+dDtcbiAgICB9XG4gICAgQ2UodCkge1xuICAgICAgICBjb25zdCBlID0gdCArIHRoaXMucG9zaXRpb247XG4gICAgICAgIGlmIChlIDw9IHRoaXMuYnVmZmVyLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgICAvLyBUcnkgZG91YmxpbmcuXG4gICAgICAgICAgICAgICAgbGV0IG4gPSAyICogdGhpcy5idWZmZXIubGVuZ3RoO1xuICAgICAgICAvLyBTdGlsbCBub3QgYmlnIGVub3VnaD8gSnVzdCBhbGxvY2F0ZSB0aGUgcmlnaHQgc2l6ZS5cbiAgICAgICAgICAgICAgICBuIDwgZSAmJiAobiA9IGUpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIG5ldyBidWZmZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KG4pO1xuICAgICAgICBzLnNldCh0aGlzLmJ1ZmZlciksIC8vIGNvcHkgb2xkIGRhdGFcbiAgICAgICAgdGhpcy5idWZmZXIgPSBzO1xuICAgIH1cbn1cblxuY2xhc3MgZ3Ige1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy4kZSA9IHQ7XG4gICAgfVxuICAgIHdlKHQpIHtcbiAgICAgICAgdGhpcy4kZS5UZSh0KTtcbiAgICB9XG4gICAgZmUodCkge1xuICAgICAgICB0aGlzLiRlLnZlKHQpO1xuICAgIH1cbiAgICBsZSh0KSB7XG4gICAgICAgIHRoaXMuJGUuU2UodCk7XG4gICAgfVxuICAgIGFlKCkge1xuICAgICAgICB0aGlzLiRlLk5lKCk7XG4gICAgfVxufVxuXG5jbGFzcyB5ciB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLiRlID0gdDtcbiAgICB9XG4gICAgd2UodCkge1xuICAgICAgICB0aGlzLiRlLlJlKHQpO1xuICAgIH1cbiAgICBmZSh0KSB7XG4gICAgICAgIHRoaXMuJGUuVmUodCk7XG4gICAgfVxuICAgIGxlKHQpIHtcbiAgICAgICAgdGhpcy4kZS54ZSh0KTtcbiAgICB9XG4gICAgYWUoKSB7XG4gICAgICAgIHRoaXMuJGUuT2UoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyBgRGlyZWN0aW9uYWxJbmRleEJ5dGVFbmNvZGVyYCB1c2luZyBgT3JkZXJlZENvZGVXcml0ZXJgIGZvciB0aGVcbiAqIGFjdHVhbCBlbmNvZGluZy5cbiAqLyBjbGFzcyBwciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuJGUgPSBuZXcgbXIsIHRoaXMuQmUgPSBuZXcgZ3IodGhpcy4kZSksIHRoaXMuTGUgPSBuZXcgeXIodGhpcy4kZSk7XG4gICAgfVxuICAgIHNlZWQodCkge1xuICAgICAgICB0aGlzLiRlLnNlZWQodCk7XG4gICAgfVxuICAgIHFlKHQpIHtcbiAgICAgICAgcmV0dXJuIDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gdCA/IHRoaXMuQmUgOiB0aGlzLkxlO1xuICAgIH1cbiAgICBGZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuJGUuRmUoKTtcbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuJGUucmVzZXQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogUmVwcmVzZW50cyBhbiBpbmRleCBlbnRyeSBzYXZlZCBieSB0aGUgU0RLIGluIHBlcnNpc3RlZCBzdG9yYWdlLiAqLyBjbGFzcyBJciB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLmluZGV4SWQgPSB0LCB0aGlzLmRvY3VtZW50S2V5ID0gZSwgdGhpcy5hcnJheVZhbHVlID0gbiwgdGhpcy5kaXJlY3Rpb25hbFZhbHVlID0gcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBJbmRleEVudHJ5IGVudHJ5IHRoYXQgc29ydHMgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlIGN1cnJlbnRcbiAgICAgKiBkaXJlY3Rpb25hbCB2YWx1ZS5cbiAgICAgKi8gICAgVWUoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRpcmVjdGlvbmFsVmFsdWUubGVuZ3RoLCBlID0gMCA9PT0gdCB8fCAyNTUgPT09IHRoaXMuZGlyZWN0aW9uYWxWYWx1ZVt0IC0gMV0gPyB0ICsgMSA6IHQsIG4gPSBuZXcgVWludDhBcnJheShlKTtcbiAgICAgICAgcmV0dXJuIG4uc2V0KHRoaXMuZGlyZWN0aW9uYWxWYWx1ZSwgMCksIGUgIT09IHQgPyBuLnNldChbIDAgXSwgdGhpcy5kaXJlY3Rpb25hbFZhbHVlLmxlbmd0aCkgOiArK25bbi5sZW5ndGggLSAxXSwgXG4gICAgICAgIG5ldyBJcih0aGlzLmluZGV4SWQsIHRoaXMuZG9jdW1lbnRLZXksIHRoaXMuYXJyYXlWYWx1ZSwgbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBUcih0LCBlKSB7XG4gICAgbGV0IG4gPSB0LmluZGV4SWQgLSBlLmluZGV4SWQ7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogKG4gPSBFcih0LmFycmF5VmFsdWUsIGUuYXJyYXlWYWx1ZSksIDAgIT09IG4gPyBuIDogKG4gPSBFcih0LmRpcmVjdGlvbmFsVmFsdWUsIGUuZGlyZWN0aW9uYWxWYWx1ZSksIFxuICAgIDAgIT09IG4gPyBuIDogY3QuY29tcGFyYXRvcih0LmRvY3VtZW50S2V5LCBlLmRvY3VtZW50S2V5KSkpO1xufVxuXG5mdW5jdGlvbiBFcih0LCBlKSB7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lmxlbmd0aCAmJiBuIDwgZS5sZW5ndGg7ICsrbikge1xuICAgICAgICBjb25zdCBzID0gdFtuXSAtIGVbbl07XG4gICAgICAgIGlmICgwICE9PSBzKSByZXR1cm4gcztcbiAgICB9XG4gICAgcmV0dXJuIHQubGVuZ3RoIC0gZS5sZW5ndGg7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgbGlnaHQgcXVlcnkgcGxhbm5lciBmb3IgRmlyZXN0b3JlLlxuICpcbiAqIFRoaXMgY2xhc3MgbWF0Y2hlcyBhIGBGaWVsZEluZGV4YCBhZ2FpbnN0IGEgRmlyZXN0b3JlIFF1ZXJ5IGBUYXJnZXRgLiBJdFxuICogZGV0ZXJtaW5lcyB3aGV0aGVyIGEgZ2l2ZW4gaW5kZXggY2FuIGJlIHVzZWQgdG8gc2VydmUgdGhlIHNwZWNpZmllZCB0YXJnZXQuXG4gKlxuICogVGhlIGZvbGxvd2luZyB0YWJsZSBzaG93Y2FzZXMgc29tZSBwb3NzaWJsZSBpbmRleCBjb25maWd1cmF0aW9uczpcbiAqXG4gKiBRdWVyeSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBJbmRleFxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIHdoZXJlKCdhJywgJz09JywgJ2EnKS53aGVyZSgnYicsICc9PScsICdiJykgICAgICAgICB8IGEgQVNDLCBiIERFU0NcbiAqIHdoZXJlKCdhJywgJz09JywgJ2EnKS53aGVyZSgnYicsICc9PScsICdiJykgICAgICAgICB8IGEgQVNDXG4gKiB3aGVyZSgnYScsICc9PScsICdhJykud2hlcmUoJ2InLCAnPT0nLCAnYicpICAgICAgICAgfCBiIERFU0NcbiAqIHdoZXJlKCdhJywgJz49JywgJ2EnKS5vcmRlckJ5KCdhJykgICAgICAgICAgICAgICAgICB8IGEgQVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScsICdkZXNjJykgICAgICAgICAgfCBhIERFU0NcbiAqIHdoZXJlKCdhJywgJz49JywgJ2EnKS5vcmRlckJ5KCdhJykub3JkZXJCeSgnYicpICAgICB8IGEgQVNDLCBiIEFTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnKS5vcmRlckJ5KCdiJykgICAgIHwgYSBBU0NcbiAqIHdoZXJlKCdhJywgJ2FycmF5LWNvbnRhaW5zJywgJ2EnKS5vcmRlckJ5KCdiJykgICAgICB8IGEgQ09OVEFJTlMsIGIgQVNDRU5ESU5HXG4gKiB3aGVyZSgnYScsICdhcnJheS1jb250YWlucycsICdhJykub3JkZXJCeSgnYicpICAgICAgfCBhIENPTlRBSU5TXG4gKi8gY2xhc3MgQXIge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uSWQgPSBudWxsICE9IHQuY29sbGVjdGlvbkdyb3VwID8gdC5jb2xsZWN0aW9uR3JvdXAgOiB0LnBhdGgubGFzdFNlZ21lbnQoKSwgXG4gICAgICAgIHRoaXMuS2UgPSB0Lm9yZGVyQnksIHRoaXMuR2UgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQuZmlsdGVycykge1xuICAgICAgICAgICAgY29uc3QgdCA9IGU7XG4gICAgICAgICAgICB0LmlzSW5lcXVhbGl0eSgpID8gdGhpcy5RZSA9IHQgOiB0aGlzLkdlLnB1c2godCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBpbmRleCBjYW4gYmUgdXNlZCB0byBzZXJ2ZSB0aGUgVGFyZ2V0SW5kZXhNYXRjaGVyJ3NcbiAgICAgKiB0YXJnZXQuXG4gICAgICpcbiAgICAgKiBBbiBpbmRleCBpcyBjb25zaWRlcmVkIGNhcGFibGUgb2Ygc2VydmluZyB0aGUgdGFyZ2V0IHdoZW46XG4gICAgICogLSBUaGUgdGFyZ2V0IHVzZXMgYWxsIGluZGV4IHNlZ21lbnRzIGZvciBpdHMgZmlsdGVycyBhbmQgb3JkZXJCeSBjbGF1c2VzLlxuICAgICAqICAgVGhlIHRhcmdldCBjYW4gaGF2ZSBhZGRpdGlvbmFsIGZpbHRlciBhbmQgb3JkZXJCeSBjbGF1c2VzLCBidXQgbm90XG4gICAgICogICBmZXdlci5cbiAgICAgKiAtIElmIGFuIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueWZpbHRlciBpcyB1c2VkLCB0aGUgaW5kZXggbXVzdCBhbHNvXG4gICAgICogICBoYXZlIGEgY29ycmVzcG9uZGluZyBgQ09OVEFJTlNgIHNlZ21lbnQuXG4gICAgICogLSBBbGwgZGlyZWN0aW9uYWwgaW5kZXggc2VnbWVudHMgY2FuIGJlIG1hcHBlZCB0byB0aGUgdGFyZ2V0IGFzIGEgc2VyaWVzIG9mXG4gICAgICogICBlcXVhbGl0eSBmaWx0ZXJzLCBhIHNpbmdsZSBpbmVxdWFsaXR5IGZpbHRlciBhbmQgYSBzZXJpZXMgb2Ygb3JkZXJCeVxuICAgICAqICAgY2xhdXNlcy5cbiAgICAgKiAtIFRoZSBzZWdtZW50cyB0aGF0IHJlcHJlc2VudCB0aGUgZXF1YWxpdHkgZmlsdGVycyBtYXkgYXBwZWFyIG91dCBvZiBvcmRlci5cbiAgICAgKiAtIFRoZSBvcHRpb25hbCBzZWdtZW50IGZvciB0aGUgaW5lcXVhbGl0eSBmaWx0ZXIgbXVzdCBhcHBlYXIgYWZ0ZXIgYWxsXG4gICAgICogICBlcXVhbGl0eSBzZWdtZW50cy5cbiAgICAgKiAtIFRoZSBzZWdtZW50cyB0aGF0IHJlcHJlc2VudCB0aGF0IG9yZGVyQnkgY2xhdXNlIG9mIHRoZSB0YXJnZXQgbXVzdCBhcHBlYXJcbiAgICAgKiAgIGluIG9yZGVyIGFmdGVyIGFsbCBlcXVhbGl0eSBhbmQgaW5lcXVhbGl0eSBzZWdtZW50cy4gU2luZ2xlIG9yZGVyQnlcbiAgICAgKiAgIGNsYXVzZXMgY2Fubm90IGJlIHNraXBwZWQsIGJ1dCBhIGNvbnRpbnVvdXMgb3JkZXJCeSBzdWZmaXggbWF5IGJlXG4gICAgICogICBvbWl0dGVkLlxuICAgICAqLyAgICBqZSh0KSB7XG4gICAgICAgIE0odC5jb2xsZWN0aW9uR3JvdXAgPT09IHRoaXMuY29sbGVjdGlvbklkKTtcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYW4gYXJyYXkgZWxlbWVudCwgZmluZCBhIG1hdGNoaW5nIGZpbHRlci5cbiAgICAgICAgY29uc3QgZSA9IGh0KHQpO1xuICAgICAgICBpZiAodm9pZCAwICE9PSBlICYmICF0aGlzLldlKGUpKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG4gPSBsdCh0KTtcbiAgICAgICAgbGV0IHMgPSAwLCBpID0gMDtcbiAgICAgICAgLy8gUHJvY2VzcyBhbGwgZXF1YWxpdGllcyBmaXJzdC4gRXF1YWxpdGllcyBjYW4gYXBwZWFyIG91dCBvZiBvcmRlci5cbiAgICAgICAgZm9yICg7cyA8IG4ubGVuZ3RoICYmIHRoaXMuV2UobltzXSk7ICsrcykgO1xuICAgICAgICAvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgcHJvY2Vzc2VkIGFsbCBzZWdtZW50cywgYWxsIHNlZ21lbnRzIGFyZSB1c2VkIHRvIHNlcnZlXG4gICAgICAgIC8vIHRoZSBlcXVhbGl0eSBmaWx0ZXJzIGFuZCB3ZSBkbyBub3QgbmVlZCB0byBtYXAgYW55IHNlZ21lbnRzIHRvIHRoZVxuICAgICAgICAvLyB0YXJnZXQncyBpbmVxdWFsaXR5IGFuZCBvcmRlckJ5IGNsYXVzZXMuXG4gICAgICAgICAgICAgICAgaWYgKHMgPT09IG4ubGVuZ3RoKSByZXR1cm4gITA7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGFuIGluZXF1YWxpdHkgZmlsdGVyLCB0aGUgbmV4dCBzZWdtZW50IG11c3QgbWF0Y2ggYm90aCB0aGVcbiAgICAgICAgLy8gZmlsdGVyIGFuZCB0aGUgZmlyc3Qgb3JkZXJCeSBjbGF1c2UuXG4gICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdGhpcy5RZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5bc107XG4gICAgICAgICAgICBpZiAoIXRoaXMuemUodGhpcy5RZSwgdCkgfHwgIXRoaXMuSGUodGhpcy5LZVtpKytdLCB0KSkgcmV0dXJuICExO1xuICAgICAgICAgICAgKytzO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFsbCByZW1haW5pbmcgc2VnbWVudHMgbmVlZCB0byByZXByZXNlbnQgdGhlIHByZWZpeCBvZiB0aGUgdGFyZ2V0J3NcbiAgICAgICAgLy8gb3JkZXJCeS5cbiAgICAgICAgICAgICAgICBmb3IgKDtzIDwgbi5sZW5ndGg7ICsrcykge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5bc107XG4gICAgICAgICAgICBpZiAoaSA+PSB0aGlzLktlLmxlbmd0aCB8fCAhdGhpcy5IZSh0aGlzLktlW2krK10sIHQpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBXZSh0KSB7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLkdlKSBpZiAodGhpcy56ZShlLCB0KSkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIHplKHQsIGUpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gdCB8fCAhdC5maWVsZC5pc0VxdWFsKGUuZmllbGRQYXRoKSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovID09PSB0Lm9wIHx8IFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovID09PSB0Lm9wO1xuICAgICAgICByZXR1cm4gMiAvKiBJbmRleEtpbmQuQ09OVEFJTlMgKi8gPT09IGUua2luZCA9PT0gbjtcbiAgICB9XG4gICAgSGUodCwgZSkge1xuICAgICAgICByZXR1cm4gISF0LmZpZWxkLmlzRXF1YWwoZS5maWVsZFBhdGgpICYmICgwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8gPT09IGUua2luZCAmJiBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8gPT09IHQuZGlyIHx8IDEgLyogSW5kZXhLaW5kLkRFU0NFTkRJTkcgKi8gPT09IGUua2luZCAmJiBcImRlc2NcIiAvKiBEaXJlY3Rpb24uREVTQ0VORElORyAqLyA9PT0gdC5kaXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUHJvdmlkZXMgdXRpbGl0eSBmdW5jdGlvbnMgdGhhdCBoZWxwIHdpdGggYm9vbGVhbiBsb2dpYyB0cmFuc2Zvcm1hdGlvbnMgbmVlZGVkIGZvciBoYW5kbGluZ1xuICogY29tcGxleCBmaWx0ZXJzIHVzZWQgaW4gcXVlcmllcy5cbiAqL1xuLyoqXG4gKiBUaGUgYGluYCBmaWx0ZXIgaXMgb25seSBhIHN5bnRhY3RpYyBzdWdhciBvdmVyIGEgZGlzanVuY3Rpb24gb2YgZXF1YWxpdGllcy4gRm9yIGluc3RhbmNlOiBgYSBpblxuICogWzEsMiwzXWAgaXMgaW4gZmFjdCBgYT09MSB8fCBhPT0yIHx8IGE9PTNgLiBUaGlzIG1ldGhvZCBleHBhbmRzIGFueSBgaW5gIGZpbHRlciBpbiB0aGUgZ2l2ZW5cbiAqIGlucHV0IGludG8gYSBkaXNqdW5jdGlvbiBvZiBlcXVhbGl0eSBmaWx0ZXJzIGFuZCByZXR1cm5zIHRoZSBleHBhbmRlZCBmaWx0ZXIuXG4gKi8gZnVuY3Rpb24gUnIodCkge1xuICAgIHZhciBlLCBuO1xuICAgIGlmIChNKHQgaW5zdGFuY2VvZiBSZSB8fCB0IGluc3RhbmNlb2YgYmUpLCB0IGluc3RhbmNlb2YgUmUpIHtcbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBCZSkge1xuICAgICAgICAgICAgY29uc3QgcyA9IChudWxsID09PSAobiA9IG51bGwgPT09IChlID0gdC52YWx1ZS5hcnJheVZhbHVlKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLnZhbHVlcykgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5tYXAoKGUgPT4gUmUuY3JlYXRlKHQuZmllbGQsIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyAsIGUpKSkpIHx8IFtdO1xuICAgICAgICAgICAgcmV0dXJuIGJlLmNyZWF0ZShzLCBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGhhdmUgcmVhY2hlZCBvdGhlciBraW5kcyBvZiBmaWVsZCBmaWx0ZXJzLlxuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLy8gV2UgaGF2ZSBhIGNvbXBvc2l0ZSBmaWx0ZXIuXG4gICAgICAgIGNvbnN0IHMgPSB0LmZpbHRlcnMubWFwKCh0ID0+IFJyKHQpKSk7XG4gICAgcmV0dXJuIGJlLmNyZWF0ZShzLCB0Lm9wKTtcbn1cblxuLyoqXG4gKiBHaXZlbiBhIGNvbXBvc2l0ZSBmaWx0ZXIsIHJldHVybnMgdGhlIGxpc3Qgb2YgdGVybXMgaW4gaXRzIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtLlxuICpcbiAqIDxwPkVhY2ggZWxlbWVudCBpbiB0aGUgcmV0dXJuIHZhbHVlIGlzIG9uZSB0ZXJtIG9mIHRoZSByZXN1bHRpbmcgRE5GLiBGb3IgaW5zdGFuY2U6IEZvciB0aGVcbiAqIGlucHV0OiAoQSB8fCBCKSAmJiBDLCB0aGUgRE5GIGZvcm0gaXM6IChBICYmIEMpIHx8IChCICYmIEMpLCBhbmQgdGhlIHJldHVybiB2YWx1ZSBpcyBhIGxpc3RcbiAqIHdpdGggdHdvIGVsZW1lbnRzOiBhIGNvbXBvc2l0ZSBmaWx0ZXIgdGhhdCBwZXJmb3JtcyAoQSAmJiBDKSwgYW5kIGEgY29tcG9zaXRlIGZpbHRlciB0aGF0XG4gKiBwZXJmb3JtcyAoQiAmJiBDKS5cbiAqXG4gKiBAcGFyYW0gZmlsdGVyIHRoZSBjb21wb3NpdGUgZmlsdGVyIHRvIGNhbGN1bGF0ZSBETkYgdHJhbnNmb3JtIGZvci5cbiAqIEByZXR1cm4gdGhlIHRlcm1zIGluIHRoZSBETkYgdHJhbnNmb3JtLlxuICovIGZ1bmN0aW9uIGJyKHQpIHtcbiAgICBpZiAoMCA9PT0gdC5nZXRGaWx0ZXJzKCkubGVuZ3RoKSByZXR1cm4gW107XG4gICAgY29uc3QgZSA9IFNyKFJyKHQpKTtcbiAgICByZXR1cm4gTShWcihlKSksIFByKGUpIHx8IHZyKGUpID8gWyBlIF0gOiBlLmdldEZpbHRlcnMoKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIGEgc2luZ2xlIGZpZWxkIGZpbHRlci4gZS5nLiAoYSA9PSAxMCkuICovIGZ1bmN0aW9uIFByKHQpIHtcbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIFJlO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIHRoZSBjb25qdW5jdGlvbiBvZiBvbmUgb3IgbW9yZSBmaWVsZCBmaWx0ZXJzLiBlLmcuIChhID09IDEwXG4gKiAmJiBiID09IDIwKVxuICovIGZ1bmN0aW9uIHZyKHQpIHtcbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIGJlICYmIFZlKHQpO1xufVxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGdpdmVuIGZpbHRlciBpcyBpbiBkaXNqdW5jdGl2ZSBub3JtYWwgZm9ybSAoRE5GKS5cbiAqXG4gKiA8cD5JbiBib29sZWFuIGxvZ2ljLCBhIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtIChETkYpIGlzIGEgY2Fub25pY2FsIG5vcm1hbCBmb3JtIG9mIGEgbG9naWNhbFxuICogZm9ybXVsYSBjb25zaXN0aW5nIG9mIGEgZGlzanVuY3Rpb24gb2YgY29uanVuY3Rpb25zOyBpdCBjYW4gYWxzbyBiZSBkZXNjcmliZWQgYXMgYW4gT1Igb2YgQU5Ecy5cbiAqXG4gKiA8cD5Gb3IgbW9yZSBpbmZvLCB2aXNpdDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRGlzanVuY3RpdmVfbm9ybWFsX2Zvcm1cbiAqLyBmdW5jdGlvbiBWcih0KSB7XG4gICAgcmV0dXJuIFByKHQpIHx8IHZyKHQpIHx8IFxuICAgIC8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBmaWx0ZXIgaXMgdGhlIGRpc2p1bmN0aW9uIG9mIG9uZSBvciBtb3JlIFwiZmxhdCBjb25qdW5jdGlvbnNcIiBhbmRcbiAqIGZpZWxkIGZpbHRlcnMuIGUuZy4gKGEgPT0gMTApIHx8IChiPT0yMCAmJiBjPT0zMClcbiAqL1xuICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBiZSAmJiB2ZSh0KSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHQuZ2V0RmlsdGVycygpKSBpZiAoIVByKGUpICYmICF2cihlKSkgcmV0dXJuICExO1xuICAgICAgICAgICAgcmV0dXJuICEwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9KHQpO1xufVxuXG5mdW5jdGlvbiBTcih0KSB7XG4gICAgaWYgKE0odCBpbnN0YW5jZW9mIFJlIHx8IHQgaW5zdGFuY2VvZiBiZSksIHQgaW5zdGFuY2VvZiBSZSkgcmV0dXJuIHQ7XG4gICAgaWYgKDEgPT09IHQuZmlsdGVycy5sZW5ndGgpIHJldHVybiBTcih0LmZpbHRlcnNbMF0pO1xuICAgIC8vIENvbXB1dGUgRE5GIGZvciBlYWNoIG9mIHRoZSBzdWJmaWx0ZXJzIGZpcnN0XG4gICAgICAgIGNvbnN0IGUgPSB0LmZpbHRlcnMubWFwKCh0ID0+IFNyKHQpKSk7XG4gICAgbGV0IG4gPSBiZS5jcmVhdGUoZSwgdC5vcCk7XG4gICAgcmV0dXJuIG4gPSB4cihuKSwgVnIobikgPyBuIDogKE0obiBpbnN0YW5jZW9mIGJlKSwgTShQZShuKSksIE0obi5maWx0ZXJzLmxlbmd0aCA+IDEpLCBcbiAgICBuLmZpbHRlcnMucmVkdWNlKCgodCwgZSkgPT4gRHIodCwgZSkpKSk7XG59XG5cbmZ1bmN0aW9uIERyKHQsIGUpIHtcbiAgICBsZXQgbjtcbiAgICByZXR1cm4gTSh0IGluc3RhbmNlb2YgUmUgfHwgdCBpbnN0YW5jZW9mIGJlKSwgTShlIGluc3RhbmNlb2YgUmUgfHwgZSBpbnN0YW5jZW9mIGJlKSwgXG4gICAgLy8gRmllbGRGaWx0ZXIgRmllbGRGaWx0ZXJcbiAgICBuID0gdCBpbnN0YW5jZW9mIFJlID8gZSBpbnN0YW5jZW9mIFJlID8gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAvLyBDb25qdW5jdGlvbiBkaXN0cmlidXRpb24gZm9yIHR3byBmaWVsZCBmaWx0ZXJzIGlzIHRoZSBjb25qdW5jdGlvbiBvZiB0aGVtLlxuICAgICAgICByZXR1cm4gYmUuY3JlYXRlKFsgdCwgZSBdLCBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyk7XG4gICAgfSh0LCBlKSA6IENyKHQsIGUpIDogZSBpbnN0YW5jZW9mIFJlID8gQ3IoZSwgdCkgOiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIC8vIFRoZXJlIGFyZSBmb3VyIGNhc2VzOlxuICAgICAgICAvLyAoQSAmIEIpICYgKEMgJiBEKSAtLT4gKEEgJiBCICYgQyAmIEQpXG4gICAgICAgIC8vIChBICYgQikgJiAoQyB8IEQpIC0tPiAoQSAmIEIgJiBDKSB8IChBICYgQiAmIEQpXG4gICAgICAgIC8vIChBIHwgQikgJiAoQyAmIEQpIC0tPiAoQyAmIEQgJiBBKSB8IChDICYgRCAmIEIpXG4gICAgICAgIC8vIChBIHwgQikgJiAoQyB8IEQpIC0tPiAoQSAmIEMpIHwgKEEgJiBEKSB8IChCICYgQykgfCAoQiAmIEQpXG4gICAgICAgIC8vIENhc2UgMSBpcyBhIG1lcmdlLlxuICAgICAgICBpZiAoTSh0LmZpbHRlcnMubGVuZ3RoID4gMCAmJiBlLmZpbHRlcnMubGVuZ3RoID4gMCksIFBlKHQpICYmIFBlKGUpKSByZXR1cm4geGUodCwgZS5nZXRGaWx0ZXJzKCkpO1xuICAgICAgICAvLyBDYXNlIDIsMyw0IGFsbCBoYXZlIGF0IGxlYXN0IG9uZSBzaWRlIChsaHMgb3IgcmhzKSB0aGF0IGlzIGEgZGlzanVuY3Rpb24uIEluIGFsbCB0aHJlZSBjYXNlc1xuICAgICAgICAvLyB3ZSBzaG91bGQgdGFrZSBlYWNoIGVsZW1lbnQgb2YgdGhlIGRpc2p1bmN0aW9uIGFuZCBkaXN0cmlidXRlIGl0IG92ZXIgdGhlIG90aGVyIHNpZGUsIGFuZFxuICAgICAgICAvLyByZXR1cm4gdGhlIGRpc2p1bmN0aW9uIG9mIHRoZSBkaXN0cmlidXRpb24gcmVzdWx0cy5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gdmUodCkgPyB0IDogZSwgcyA9IHZlKHQpID8gZSA6IHQsIGkgPSBuLmZpbHRlcnMubWFwKCh0ID0+IERyKHQsIHMpKSk7XG4gICAgICAgIHJldHVybiBiZS5jcmVhdGUoaSwgXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovKTtcbiAgICB9KHQsIGUpLCB4cihuKTtcbn1cblxuZnVuY3Rpb24gQ3IodCwgZSkge1xuICAgIC8vIFRoZXJlIGFyZSB0d28gY2FzZXM6XG4gICAgLy8gQSAmIChCICYgQykgLS0+IChBICYgQiAmIEMpXG4gICAgLy8gQSAmIChCIHwgQykgLS0+IChBICYgQikgfCAoQSAmIEMpXG4gICAgaWYgKFBlKGUpKSBcbiAgICAvLyBDYXNlIDFcbiAgICByZXR1cm4geGUoZSwgdC5nZXRGaWx0ZXJzKCkpO1xuICAgIHtcbiAgICAgICAgLy8gQ2FzZSAyXG4gICAgICAgIGNvbnN0IG4gPSBlLmZpbHRlcnMubWFwKChlID0+IERyKHQsIGUpKSk7XG4gICAgICAgIHJldHVybiBiZS5jcmVhdGUobiwgXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyB0aGUgYXNzb2NpYXRpdml0eSBwcm9wZXJ0eSB0byB0aGUgZ2l2ZW4gZmlsdGVyIGFuZCByZXR1cm5zIHRoZSByZXN1bHRpbmcgZmlsdGVyLlxuICpcbiAqIDx1bD5cbiAqICAgPGxpPkEgfCAoQiB8IEMpID09IChBIHwgQikgfCBDID09IChBIHwgQiB8IEMpXG4gKiAgIDxsaT5BICYgKEIgJiBDKSA9PSAoQSAmIEIpICYgQyA9PSAoQSAmIEIgJiBDKVxuICogPC91bD5cbiAqXG4gKiA8cD5Gb3IgbW9yZSBpbmZvLCB2aXNpdDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQXNzb2NpYXRpdmVfcHJvcGVydHkjUHJvcG9zaXRpb25hbF9sb2dpY1xuICovIGZ1bmN0aW9uIHhyKHQpIHtcbiAgICBpZiAoTSh0IGluc3RhbmNlb2YgUmUgfHwgdCBpbnN0YW5jZW9mIGJlKSwgdCBpbnN0YW5jZW9mIFJlKSByZXR1cm4gdDtcbiAgICBjb25zdCBlID0gdC5nZXRGaWx0ZXJzKCk7XG4gICAgLy8gSWYgdGhlIGNvbXBvc2l0ZSBmaWx0ZXIgb25seSBjb250YWlucyAxIGZpbHRlciwgYXBwbHkgYXNzb2NpYXRpdml0eSB0byBpdC5cbiAgICAgICAgaWYgKDEgPT09IGUubGVuZ3RoKSByZXR1cm4geHIoZVswXSk7XG4gICAgLy8gQXNzb2NpYXRpdml0eSBhcHBsaWVkIHRvIGEgZmxhdCBjb21wb3NpdGUgZmlsdGVyIHJlc3VsdHMgaXMgaXRzZWxmLlxuICAgICAgICBpZiAoU2UodCkpIHJldHVybiB0O1xuICAgIC8vIEZpcnN0IGFwcGx5IGFzc29jaWF0aXZpdHkgdG8gYWxsIHN1YmZpbHRlcnMuIFRoaXMgd2lsbCBpbiB0dXJuIHJlY3Vyc2l2ZWx5IGFwcGx5XG4gICAgLy8gYXNzb2NpYXRpdml0eSB0byBhbGwgbmVzdGVkIGNvbXBvc2l0ZSBmaWx0ZXJzIGFuZCBmaWVsZCBmaWx0ZXJzLlxuICAgICAgICBjb25zdCBuID0gZS5tYXAoKHQgPT4geHIodCkpKSwgcyA9IFtdO1xuICAgIC8vIEZvciBjb21wb3NpdGUgc3ViZmlsdGVycyB0aGF0IHBlcmZvcm0gdGhlIHNhbWUga2luZCBvZiBsb2dpY2FsIG9wZXJhdGlvbiBhcyBgY29tcG9zaXRlRmlsdGVyYFxuICAgIC8vIHRha2Ugb3V0IHRoZWlyIGZpbHRlcnMgYW5kIGFkZCB0aGVtIHRvIGBjb21wb3NpdGVGaWx0ZXJgLiBGb3IgZXhhbXBsZTpcbiAgICAvLyBjb21wb3NpdGVGaWx0ZXIgPSAoQSB8IChCIHwgQyB8IEQpKVxuICAgIC8vIGNvbXBvc2l0ZVN1YmZpbHRlciA9IChCIHwgQyB8IEQpXG4gICAgLy8gUmVzdWx0OiAoQSB8IEIgfCBDIHwgRClcbiAgICAvLyBOb3RlIHRoYXQgdGhlIGBjb21wb3NpdGVTdWJmaWx0ZXJgIGhhcyBiZWVuIGVsaW1pbmF0ZWQsIGFuZCBpdHMgZmlsdGVycyAoQiwgQywgRCkgaGF2ZSBiZWVuXG4gICAgLy8gYWRkZWQgdG8gdGhlIHRvcC1sZXZlbCBcImNvbXBvc2l0ZUZpbHRlclwiLlxuICAgICAgICByZXR1cm4gbi5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgZSBpbnN0YW5jZW9mIFJlID8gcy5wdXNoKGUpIDogZSBpbnN0YW5jZW9mIGJlICYmIChlLm9wID09PSB0Lm9wID8gXG4gICAgICAgIC8vIGNvbXBvc2l0ZUZpbHRlcjogKEEgfCAoQiB8IEMpKVxuICAgICAgICAvLyBjb21wb3NpdGVTdWJmaWx0ZXI6IChCIHwgQylcbiAgICAgICAgLy8gUmVzdWx0OiAoQSB8IEIgfCBDKVxuICAgICAgICBzLnB1c2goLi4uZS5maWx0ZXJzKSA6IFxuICAgICAgICAvLyBjb21wb3NpdGVGaWx0ZXI6IChBIHwgKEIgJiBDKSlcbiAgICAgICAgLy8gY29tcG9zaXRlU3ViZmlsdGVyOiAoQiAmIEMpXG4gICAgICAgIC8vIFJlc3VsdDogKEEgfCAoQiAmIEMpKVxuICAgICAgICBzLnB1c2goZSkpO1xuICAgIH0pKSwgMSA9PT0gcy5sZW5ndGggPyBzWzBdIDogYmUuY3JlYXRlKHMsIHQub3ApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICovIGNsYXNzIE5yIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5KZSA9IG5ldyBrcjtcbiAgICB9XG4gICAgYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5KZS5hZGQoZSksIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0Q29sbGVjdGlvblBhcmVudHModCwgZSkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh0aGlzLkplLmdldEVudHJpZXMoZSkpO1xuICAgIH1cbiAgICBhZGRGaWVsZEluZGV4KHQsIGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgZGVsZXRlRmllbGRJbmRleCh0LCBlKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nVGFyZ2V0KHQsIGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIEF0LnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZSh0LCBlKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKDAgLyogSW5kZXhUeXBlLk5PTkUgKi8pO1xuICAgIH1cbiAgICBnZXRGaWVsZEluZGV4ZXModCwgZSkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZShbXSk7XG4gICAgfVxuICAgIGdldE5leHRDb2xsZWN0aW9uR3JvdXBUb1VwZGF0ZSh0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXQodCwgZSkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh5dC5taW4oKSk7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldEZyb21Db2xsZWN0aW9uR3JvdXAodCwgZSkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh5dC5taW4oKSk7XG4gICAgfVxuICAgIHVwZGF0ZUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHVwZGF0ZUluZGV4RW50cmllcyh0LCBlKSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIHRoZSBjb2xsZWN0aW9uLXBhcmVudCBpbmRleCBleHBvc2VkIGJ5IE1lbW9yeUluZGV4TWFuYWdlci5cbiAqIEFsc28gdXNlZCBmb3IgaW4tbWVtb3J5IGNhY2hpbmcgYnkgSW5kZXhlZERiSW5kZXhNYW5hZ2VyIGFuZCBpbml0aWFsIGluZGV4IHBvcHVsYXRpb25cbiAqIGluIGluZGV4ZWRkYl9zY2hlbWEudHNcbiAqLyBjbGFzcyBrciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSB7fTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBmYWxzZSBpZiB0aGUgZW50cnkgYWxyZWFkeSBleGlzdGVkLlxuICAgIGFkZCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0Lmxhc3RTZWdtZW50KCksIG4gPSB0LnBvcExhc3QoKSwgcyA9IHRoaXMuaW5kZXhbZV0gfHwgbmV3IFdlKHJ0LmNvbXBhcmF0b3IpLCBpID0gIXMuaGFzKG4pO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleFtlXSA9IHMuYWRkKG4pLCBpO1xuICAgIH1cbiAgICBoYXModCkge1xuICAgICAgICBjb25zdCBlID0gdC5sYXN0U2VnbWVudCgpLCBuID0gdC5wb3BMYXN0KCksIHMgPSB0aGlzLmluZGV4W2VdO1xuICAgICAgICByZXR1cm4gcyAmJiBzLmhhcyhuKTtcbiAgICB9XG4gICAgZ2V0RW50cmllcyh0KSB7XG4gICAgICAgIHJldHVybiAodGhpcy5pbmRleFt0XSB8fCBuZXcgV2UocnQuY29tcGFyYXRvcikpLnRvQXJyYXkoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IE9yID0gbmV3IFVpbnQ4QXJyYXkoMCk7XG5cbi8qKlxuICogQSBwZXJzaXN0ZWQgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVW5saWtlIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdlYiBTREsgZG9lcyBub3QgbWVtb2l6ZSBpbmRleFxuICogZGF0YSBhcyBpdCBzdXBwb3J0cyBtdWx0aS10YWIgYWNjZXNzLlxuICovXG5jbGFzcyBNciB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLnVzZXIgPSB0LCB0aGlzLmRhdGFiYXNlSWQgPSBlLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGluLW1lbW9yeSBjb3B5IG9mIHRoZSBpbmRleCBlbnRyaWVzIHdlJ3ZlIGFscmVhZHkgd3JpdHRlbiBzaW5jZSB0aGUgU0RLXG4gICAgICAgICAqIGxhdW5jaGVkLiBVc2VkIHRvIGF2b2lkIHJlLXdyaXRpbmcgdGhlIHNhbWUgZW50cnkgcmVwZWF0ZWRseS5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhpcyBpcyAqTk9UKiBhIGNvbXBsZXRlIGNhY2hlIG9mIHdoYXQncyBpbiBwZXJzaXN0ZW5jZSBhbmQgc28gY2FuIG5ldmVyIGJlXG4gICAgICAgICAqIHVzZWQgdG8gc2F0aXNmeSByZWFkcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuWWUgPSBuZXcga3IsIFxuICAgICAgICAvKipcbiAgICAgICAgICogTWFwcyBmcm9tIGEgdGFyZ2V0IHRvIGl0cyBlcXVpdmFsZW50IGxpc3Qgb2Ygc3ViLXRhcmdldHMuIEVhY2ggc3ViLXRhcmdldFxuICAgICAgICAgKiBjb250YWlucyBvbmx5IG9uZSB0ZXJtIGZyb20gdGhlIHRhcmdldCdzIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtIChETkYpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5YZSA9IG5ldyBscygodCA9PiBubih0KSksICgodCwgZSkgPT4gc24odCwgZSkpKSwgdGhpcy51aWQgPSB0LnVpZCB8fCBcIlwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IGVudHJ5IHRvIHRoZSBjb2xsZWN0aW9uIHBhcmVudCBpbmRleC5cbiAgICAgKlxuICAgICAqIFJlcGVhdGVkIGNhbGxzIGZvciB0aGUgc2FtZSBjb2xsZWN0aW9uUGF0aCBzaG91bGQgYmUgYXZvaWRlZCB3aXRoaW4gYVxuICAgICAqIHRyYW5zYWN0aW9uIGFzIEluZGV4ZWREYkluZGV4TWFuYWdlciBvbmx5IGNhY2hlcyB3cml0ZXMgb25jZSBhIHRyYW5zYWN0aW9uXG4gICAgICogaGFzIGJlZW4gY29tbWl0dGVkLlxuICAgICAqLyAgICBhZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleCh0LCBlKSB7XG4gICAgICAgIGlmICghdGhpcy5ZZS5oYXMoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmxhc3RTZWdtZW50KCksIHMgPSBlLnBvcExhc3QoKTtcbiAgICAgICAgICAgIHQuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgY29sbGVjdGlvbiB0byB0aGUgaW4gbWVtb3J5IGNhY2hlIG9ubHkgaWYgdGhlIHRyYW5zYWN0aW9uIHdhc1xuICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBjb21taXR0ZWQuXG4gICAgICAgICAgICAgICAgdGhpcy5ZZS5hZGQoZSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCBpID0ge1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZDogbixcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IG1pKHMpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIEZyKHQpLnB1dChpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRDb2xsZWN0aW9uUGFyZW50cyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXSwgcyA9IElEQktleVJhbmdlLmJvdW5kKFsgZSwgXCJcIiBdLCBbIGV0KGUpLCBcIlwiIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIEZyKHQpLlcocykubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdCkge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgY29sbGVjdGlvbklkIGd1YXJkIHNob3VsZG4ndCBiZSBuZWNlc3NhcnkgKGFuZCBpc24ndCBhcyBsb25nXG4gICAgICAgICAgICAgICAgLy8gYXMgd2UncmUgcnVubmluZyBpbiBhIHJlYWwgYnJvd3NlciksIGJ1dCB0aGVyZSdzIGEgYnVnIGluXG4gICAgICAgICAgICAgICAgLy8gaW5kZXhlZGRic2hpbSB0aGF0IGJyZWFrcyBvdXIgcmFuZ2UgaW4gb3VyIHRlc3RzIHJ1bm5pbmcgaW4gbm9kZTpcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXhlbWNsaW9uL0luZGV4ZWREQlNoaW0vaXNzdWVzLzMzNFxuICAgICAgICAgICAgICAgIGlmIChzLmNvbGxlY3Rpb25JZCAhPT0gZSkgYnJlYWs7XG4gICAgICAgICAgICAgICAgbi5wdXNoKHBpKHMucGFyZW50KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBhZGRGaWVsZEluZGV4KHQsIGUpIHtcbiAgICAgICAgLy8gVE9ETyhpbmRleGluZyk6IFZlcmlmeSB0aGF0IHRoZSBhdXRvLWluY3JlbWVudGluZyBpbmRleCBJRCB3b3JrcyBpblxuICAgICAgICAvLyBTYWZhcmkgJiBGaXJlZm94LlxuICAgICAgICBjb25zdCBuID0gQnIodCksIHMgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGluZGV4SWQ6IHQuaW5kZXhJZCxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IHQuY29sbGVjdGlvbkdyb3VwLFxuICAgICAgICAgICAgICAgIGZpZWxkczogdC5maWVsZHMubWFwKCh0ID0+IFsgdC5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIHQua2luZCBdKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oZSk7XG4gICAgICAgIGRlbGV0ZSBzLmluZGV4SWQ7XG4gICAgICAgIC8vIGBpbmRleElkYCBpcyBhdXRvLXBvcHVsYXRlZCBieSBJbmRleGVkRGJcbiAgICAgICAgY29uc3QgaSA9IG4uYWRkKHMpO1xuICAgICAgICBpZiAoZS5pbmRleFN0YXRlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gTHIodCk7XG4gICAgICAgICAgICByZXR1cm4gaS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICBuLnB1dCh1cih0LCB0aGlzLnVzZXIsIGUuaW5kZXhTdGF0ZS5zZXF1ZW5jZU51bWJlciwgZS5pbmRleFN0YXRlLm9mZnNldCkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpLm5leHQoKTtcbiAgICB9XG4gICAgZGVsZXRlRmllbGRJbmRleCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBCcih0KSwgcyA9IExyKHQpLCBpID0gJHIodCk7XG4gICAgICAgIHJldHVybiBuLmRlbGV0ZShlLmluZGV4SWQpLm5leHQoKCgpID0+IHMuZGVsZXRlKElEQktleVJhbmdlLmJvdW5kKFsgZS5pbmRleElkIF0sIFsgZS5pbmRleElkICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCkpKSkubmV4dCgoKCkgPT4gaS5kZWxldGUoSURCS2V5UmFuZ2UuYm91bmQoWyBlLmluZGV4SWQgXSwgWyBlLmluZGV4SWQgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKSkpKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gJHIodCk7XG4gICAgICAgIGxldCBzID0gITA7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgTWFwO1xuICAgICAgICByZXR1cm4gQXQuZm9yRWFjaCh0aGlzLlplKGUpLCAoZSA9PiB0aGlzLnRuKHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgcyAmJiAocyA9ICEhdCksIGkuc2V0KGUsIHQpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAocykge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gRXMoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIEF0LmZvckVhY2goaSwgKChpLCByKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvO1xuICAgICAgICAgICAgICAgICAgICBDKFwiSW5kZXhlZERiSW5kZXhNYW5hZ2VyXCIsIGBVc2luZyBpbmRleCAke28gPSBpLCBgaWQ9JHtvLmluZGV4SWR9fGNnPSR7by5jb2xsZWN0aW9uR3JvdXB9fGY9JHtvLmZpZWxkcy5tYXAoKHQgPT4gYCR7dC5maWVsZFBhdGh9OiR7dC5raW5kfWApKS5qb2luKFwiLFwiKX1gfSB0byBleGVjdXRlICR7bm4oZSl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHUgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gaHQoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBuKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiBvbih0LCBuLmZpZWxkUGF0aCkpIHN3aXRjaCAoZS5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZS52YWx1ZS5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgZS52YWx1ZSBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGFyZSBub3QgYXJyYXkgZmlsdGVycy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyB0aGUgbGlzdCBvZiB2YWx1ZXMgdGhhdCBhcmUgdXNlZCBpbiAhPSBvciBOT1RfSU4gZmlsdGVycy4gUmV0dXJuc1xuICogYG51bGxgIGlmIHRoZXJlIGFyZSBubyBzdWNoIGZpbHRlcnMuXG4gKi8gKHIsIGkpLCBjID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgbHQoZSkpIGZvciAoY29uc3QgZSBvZiBvbih0LCBzLmZpZWxkUGF0aCkpIHN3aXRjaCAoZS5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmNvZGUgZXF1YWxpdHkgcHJlZml4LCB3aGljaCBpcyBlbmNvZGVkIGluIHRoZSBpbmRleCB2YWx1ZSBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5lcXVhbGl0eSAoZS5nLiBgYSA9PSAnYScgJiYgYiAhPSAnYidgIGlzIGVuY29kZWQgdG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBgdmFsdWUgIT0gJ2FiJ2ApLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2V0KHMuZmllbGRQYXRoLmNhbm9uaWNhbFN0cmluZygpLCBlLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RJbi9Ob3RFcXVhbCBpcyBhbHdheXMgYSBzdWZmaXguIFRoZXJlIGNhbm5vdCBiZSBhbnkgcmVtYWluaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VnbWVudHMgYW5kIGhlbmNlIHdlIGNhbiByZXR1cm4gZWFybHkgaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zZXQocy5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIGUudmFsdWUpLCBBcnJheS5mcm9tKG4udmFsdWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGNhbm5vdCBiZSB1c2VkIGFzIG5vdEluIGJvdW5kcy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhIGxvd2VyIGJvdW5kIG9mIGZpZWxkIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIGFzIGEgc3RhcnRpbmcgcG9pbnQgdG9cbiAqIHNjYW4gdGhlIGluZGV4IGRlZmluZWQgYnkgYGZpZWxkSW5kZXhgLiBSZXR1cm5zIGBNSU5fVkFMVUVgIGlmIG5vIGxvd2VyIGJvdW5kXG4gKiBleGlzdHMuXG4gKi8gKHIsIGkpLCBhID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHMgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIHNlZ21lbnQsIHJldHJpZXZlIGEgbG93ZXIgYm91bmQgaWYgdGhlcmUgaXMgYSBzdWl0YWJsZSBmaWx0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0QXQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgbHQoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovID09PSBpLmtpbmQgPyB1bih0LCBpLmZpZWxkUGF0aCwgdC5zdGFydEF0KSA6IGNuKHQsIGkuZmllbGRQYXRoLCB0LnN0YXJ0QXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ucHVzaChlLnZhbHVlKSwgcyAmJiAocyA9IGUuaW5jbHVzaXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSWUobiwgcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGFuIHVwcGVyIGJvdW5kIG9mIGZpZWxkIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIGFzIGFuIGVuZGluZyBwb2ludFxuICogd2hlbiBzY2FubmluZyB0aGUgaW5kZXggZGVmaW5lZCBieSBgZmllbGRJbmRleGAuIFJldHVybnMgYE1BWF9WQUxVRWAgaWYgbm9cbiAqIHVwcGVyIGJvdW5kIGV4aXN0cy5cbiAqLyAociwgaSksIGggPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcyA9ICEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGVhY2ggc2VnbWVudCwgcmV0cmlldmUgYW4gdXBwZXIgYm91bmQgaWYgdGhlcmUgaXMgYSBzdWl0YWJsZSBmaWx0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVuZEF0LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIGx0KGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gaS5raW5kID8gY24odCwgaS5maWVsZFBhdGgsIHQuZW5kQXQpIDogdW4odCwgaS5maWVsZFBhdGgsIHQuZW5kQXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4ucHVzaChlLnZhbHVlKSwgcyAmJiAocyA9IGUuaW5jbHVzaXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSWUobiwgcyk7XG4gICAgICAgICAgICAgICAgICAgIH0ociwgaSksIGwgPSB0aGlzLmVuKGksIHIsIGEpLCBmID0gdGhpcy5lbihpLCByLCBoKSwgZCA9IHRoaXMubm4oaSwgciwgYyksIF8gPSB0aGlzLnNuKGkuaW5kZXhJZCwgdSwgbCwgYS5pbmNsdXNpdmUsIGYsIGguaW5jbHVzaXZlLCBkKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEF0LmZvckVhY2goXywgKGkgPT4gbi5KKGksIGUubGltaXQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gY3QuZnJvbVNlZ21lbnRzKGUuZG9jdW1lbnRLZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuaGFzKG4pIHx8ICh0ID0gdC5hZGQobiksIHMucHVzaChuKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiBzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gQXQucmVzb2x2ZShudWxsKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBaZSh0KSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5YZS5nZXQodCk7XG4gICAgICAgIGlmIChlKSByZXR1cm4gZTtcbiAgICAgICAgaWYgKDAgPT09IHQuZmlsdGVycy5sZW5ndGgpIGUgPSBbIHQgXTsgZWxzZSB7XG4gICAgICAgICAgICBlID0gYnIoYmUuY3JlYXRlKHQuZmlsdGVycywgXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8pKS5tYXAoKGUgPT4gZW4odC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5vcmRlckJ5LCBlLmdldEZpbHRlcnMoKSwgdC5saW1pdCwgdC5zdGFydEF0LCB0LmVuZEF0KSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLlhlLnNldCh0LCBlKSwgZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyBhIGtleSByYW5nZSBxdWVyeSBvbiBgRGJJbmRleEVudHJ5U3RvcmVgIHRoYXQgdW5pb25zIGFsbFxuICAgICAqIGJvdW5kcy5cbiAgICAgKi8gICAgc24odCwgZSwgbiwgcywgaSwgciwgbykge1xuICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIHRvdGFsIGluZGV4IHNjYW5zIHdlIHVuaW9uIHRvZ2V0aGVyLiBUaGlzIGlzIHNpbWlsYXIgdG8gYVxuICAgICAgICAvLyBkaXN0cmlidXRlZCBub3JtYWwgZm9ybSwgYnV0IGFkYXB0ZWQgZm9yIGFycmF5IHZhbHVlcy4gV2UgY3JlYXRlIGEgc2luZ2xlXG4gICAgICAgIC8vIGluZGV4IHJhbmdlIHBlciB2YWx1ZSBpbiBhbiBBUlJBWV9DT05UQUlOUyBvciBBUlJBWV9DT05UQUlOU19BTlkgZmlsdGVyXG4gICAgICAgIC8vIGNvbWJpbmVkIHdpdGggdGhlIHZhbHVlcyBmcm9tIHRoZSBxdWVyeSBib3VuZHMuXG4gICAgICAgIGNvbnN0IHUgPSAobnVsbCAhPSBlID8gZS5sZW5ndGggOiAxKSAqIE1hdGgubWF4KG4ubGVuZ3RoLCBpLmxlbmd0aCksIGMgPSB1IC8gKG51bGwgIT0gZSA/IGUubGVuZ3RoIDogMSksIGEgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaCA9IDA7IGggPCB1OyArK2gpIHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBlID8gdGhpcy5ybihlW2ggLyBjXSkgOiBPciwgbCA9IHRoaXMub24odCwgdSwgbltoICUgY10sIHMpLCBmID0gdGhpcy51bih0LCB1LCBpW2ggJSBjXSwgciksIGQgPSBvLm1hcCgoZSA9PiB0aGlzLm9uKHQsIHUsIGUsIFxuICAgICAgICAgICAgLyogaW5jbHVzaXZlPSAqLyAhMCkpKTtcbiAgICAgICAgICAgIGEucHVzaCguLi50aGlzLmNyZWF0ZVJhbmdlKGwsIGYsIGQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYTtcbiAgICB9XG4gICAgLyoqIEdlbmVyYXRlcyB0aGUgbG93ZXIgYm91bmQgZm9yIGBhcnJheVZhbHVlYCBhbmQgYGRpcmVjdGlvbmFsVmFsdWVgLiAqLyAgICBvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgSXIodCwgY3QuZW1wdHkoKSwgZSwgbik7XG4gICAgICAgIHJldHVybiBzID8gaSA6IGkuVWUoKTtcbiAgICB9XG4gICAgLyoqIEdlbmVyYXRlcyB0aGUgdXBwZXIgYm91bmQgZm9yIGBhcnJheVZhbHVlYCBhbmQgYGRpcmVjdGlvbmFsVmFsdWVgLiAqLyAgICB1bih0LCBlLCBuLCBzKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgSXIodCwgY3QuZW1wdHkoKSwgZSwgbik7XG4gICAgICAgIHJldHVybiBzID8gaS5VZSgpIDogaTtcbiAgICB9XG4gICAgdG4odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IEFyKGUpLCBzID0gbnVsbCAhPSBlLmNvbGxlY3Rpb25Hcm91cCA/IGUuY29sbGVjdGlvbkdyb3VwIDogZS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkSW5kZXhlcyh0LCBzKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgaW5kZXggd2l0aCB0aGUgbW9zdCBudW1iZXIgb2Ygc2VnbWVudHMuXG4gICAgICAgICAgICBsZXQgZSA9IG51bGw7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdCkge1xuICAgICAgICAgICAgICAgIG4uamUocykgJiYgKCFlIHx8IHMuZmllbGRzLmxlbmd0aCA+IGUuZmllbGRzLmxlbmd0aCkgJiYgKGUgPSBzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZSh0LCBlKSB7XG4gICAgICAgIGxldCBuID0gMiAvKiBJbmRleFR5cGUuRlVMTCAqLztcbiAgICAgICAgY29uc3QgcyA9IHRoaXMuWmUoZSk7XG4gICAgICAgIHJldHVybiBBdC5mb3JFYWNoKHMsIChlID0+IHRoaXMudG4odCwgZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICB0ID8gMCAvKiBJbmRleFR5cGUuTk9ORSAqLyAhPT0gbiAmJiB0LmZpZWxkcy5sZW5ndGggPCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBuZXcgV2UodXQuY29tcGFyYXRvciksIG4gPSAhMTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdC5maWx0ZXJzKSBmb3IgKGNvbnN0IHQgb2Ygcy5nZXRGbGF0dGVuZWRGaWx0ZXJzKCkpIFxuICAgICAgICAgICAgICAgIC8vIF9fbmFtZV9fIGlzIG5vdCBhbiBleHBsaWNpdCBzZWdtZW50IG9mIGFueSBpbmRleCwgc28gd2UgZG9uJ3QgbmVlZCB0b1xuICAgICAgICAgICAgICAgIC8vIGNvdW50IGl0LlxuICAgICAgICAgICAgICAgIHQuZmllbGQuaXNLZXlGaWVsZCgpIHx8IChcbiAgICAgICAgICAgICAgICAvLyBBUlJBWV9DT05UQUlOUyBvciBBUlJBWV9DT05UQUlOU19BTlkgZmlsdGVycyBtdXN0IGJlIGNvdW50ZWQgc2VwYXJhdGVseS5cbiAgICAgICAgICAgICAgICAvLyBGb3IgaW5zdGFuY2UsIGl0IGlzIHBvc3NpYmxlIHRvIGhhdmUgYW4gaW5kZXggZm9yIFwiYSBBUlJBWSBhIEFTQ1wiLiBFdmVuXG4gICAgICAgICAgICAgICAgLy8gdGhvdWdoIHRoZXNlIGFyZSBvbiB0aGUgc2FtZSBmaWVsZCwgdGhleSBzaG91bGQgYmUgY291bnRlZCBhcyB0d29cbiAgICAgICAgICAgICAgICAvLyBzZXBhcmF0ZSBzZWdtZW50cyBpbiBhbiBpbmRleC5cbiAgICAgICAgICAgICAgICBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IHQub3AgfHwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gPT09IHQub3AgPyBuID0gITAgOiBlID0gZS5hZGQodC5maWVsZCkpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB0Lm9yZGVyQnkpIFxuICAgICAgICAgICAgICAgIC8vIF9fbmFtZV9fIGlzIG5vdCBhbiBleHBsaWNpdCBzZWdtZW50IG9mIGFueSBpbmRleCwgc28gd2UgZG9uJ3QgbmVlZCB0b1xuICAgICAgICAgICAgICAgIC8vIGNvdW50IGl0LlxuICAgICAgICAgICAgICAgIG4uZmllbGQuaXNLZXlGaWVsZCgpIHx8IChlID0gZS5hZGQobi5maWVsZCkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBlLnNpemUgKyAobiA/IDEgOiAwKTtcbiAgICAgICAgICAgIH0oZSkgJiYgKG4gPSAxIC8qIEluZGV4VHlwZS5QQVJUSUFMICovKSA6IG4gPSAwIC8qIEluZGV4VHlwZS5OT05FICovO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBcbiAgICAgICAgLy8gT1IgcXVlcmllcyBoYXZlIG1vcmUgdGhhbiBvbmUgc3ViLXRhcmdldCAob25lIHN1Yi10YXJnZXQgcGVyIERORiB0ZXJtKS4gV2UgY3VycmVudGx5IGNvbnNpZGVyXG4gICAgICAgIC8vIE9SIHF1ZXJpZXMgdGhhdCBoYXZlIGEgYGxpbWl0YCB0byBoYXZlIGEgcGFydGlhbCBpbmRleC4gRm9yIHN1Y2ggcXVlcmllcyB3ZSBwZXJmb3JtIHNvcnRpbmdcbiAgICAgICAgLy8gYW5kIGFwcGx5IHRoZSBsaW1pdCBpbiBtZW1vcnkgYXMgYSBwb3N0LXByb2Nlc3Npbmcgc3RlcC5cbiAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09IHQubGltaXQ7XG4gICAgICAgIH0oZSkgJiYgcy5sZW5ndGggPiAxICYmIDIgLyogSW5kZXhUeXBlLkZVTEwgKi8gPT09IG4gPyAxIC8qIEluZGV4VHlwZS5QQVJUSUFMICovIDogbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBieXRlIGVuY29kZWQgZm9ybSBvZiB0aGUgZGlyZWN0aW9uYWwgdmFsdWVzIGluIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgaGF2ZSBhbGwgZmllbGRzIHNwZWNpZmllZCBpbiB0aGVcbiAgICAgKiBpbmRleC5cbiAgICAgKi8gICAgY24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gbmV3IHByO1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgbHQodCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQocy5maWVsZFBhdGgpO1xuICAgICAgICAgICAgaWYgKG51bGwgPT0gdCkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBjb25zdCBpID0gbi5xZShzLmtpbmQpO1xuICAgICAgICAgICAgZHIuSWUudWUodCwgaSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG4uRmUoKTtcbiAgICB9XG4gICAgLyoqIEVuY29kZXMgYSBzaW5nbGUgdmFsdWUgdG8gdGhlIGFzY2VuZGluZyBpbmRleCBmb3JtYXQuICovICAgIHJuKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBwcjtcbiAgICAgICAgcmV0dXJuIGRyLkllLnVlKHQsIGUucWUoMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovKSksIGUuRmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBlbmNvZGVkIGZvcm0gb2YgdGhlIGRvY3VtZW50IGtleSB0aGF0IHNvcnRzIGJhc2VkIG9uIHRoZSBrZXlcbiAgICAgKiBvcmRlcmluZyBvZiB0aGUgZmllbGQgaW5kZXguXG4gICAgICovICAgIGFuKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBwcjtcbiAgICAgICAgcmV0dXJuIGRyLkllLnVlKGNlKHRoaXMuZGF0YWJhc2VJZCwgZSksIG4ucWUoZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IGx0KHQpO1xuICAgICAgICAgICAgcmV0dXJuIDAgPT09IGUubGVuZ3RoID8gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovIDogZVtlLmxlbmd0aCAtIDFdLmtpbmQ7XG4gICAgICAgIH0odCkpKSwgbi5GZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZXMgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uIGluIGB0YXJnZXRgLlxuICAgICAqIEZvciBJTiBxdWVyaWVzLCBhIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBubih0LCBlLCBuKSB7XG4gICAgICAgIGlmIChudWxsID09PSBuKSByZXR1cm4gW107XG4gICAgICAgIGxldCBzID0gW107XG4gICAgICAgIHMucHVzaChuZXcgcHIpO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgciBvZiBsdCh0KSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5baSsrXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBzKSBpZiAodGhpcy5obihlLCByLmZpZWxkUGF0aCkgJiYgaGUodCkpIHMgPSB0aGlzLmxuKHMsIHIsIHQpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbi5xZShyLmtpbmQpO1xuICAgICAgICAgICAgICAgIGRyLkllLnVlKHQsIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmZuKHMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHRoZSBnaXZlbiBib3VuZHMgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uIGluIGB0YXJnZXRgLiBGb3IgSU5cbiAgICAgKiBxdWVyaWVzLCBhIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBlbih0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5uKHQsIGUsIG4ucG9zaXRpb24pO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgYnl0ZSByZXByZXNlbnRhdGlvbiBmb3IgdGhlIHByb3ZpZGVkIGVuY29kZXJzLiAqLyAgICBmbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lmxlbmd0aDsgKytuKSBlW25dID0gdFtuXS5GZSgpO1xuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNlcGFyYXRlIGVuY29kZXIgZm9yIGVhY2ggZWxlbWVudCBvZiBhbiBhcnJheS5cbiAgICAgKlxuICAgICAqIFRoZSBtZXRob2QgYXBwZW5kcyBlYWNoIHZhbHVlIHRvIGFsbCBleGlzdGluZyBlbmNvZGVycyAoZS5nLiBmaWx0ZXIoXCJhXCIsXG4gICAgICogXCI9PVwiLCBcImExXCIpLmZpbHRlcihcImJcIiwgXCJpblwiLCBbXCJiMVwiLCBcImIyXCJdKSBiZWNvbWVzIFtcImExLGIxXCIsIFwiYTEsYjJcIl0pLiBBXG4gICAgICogbGlzdCBvZiBuZXcgZW5jb2RlcnMgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIGxuKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9IFsgLi4udCBdLCBpID0gW107XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBuLmFycmF5VmFsdWUudmFsdWVzIHx8IFtdKSBmb3IgKGNvbnN0IG4gb2Ygcykge1xuICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBwcjtcbiAgICAgICAgICAgIHMuc2VlZChuLkZlKCkpLCBkci5JZS51ZSh0LCBzLnFlKGUua2luZCkpLCBpLnB1c2gocyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICAgIGhuKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuICEhdC5maWx0ZXJzLmZpbmQoKHQgPT4gdCBpbnN0YW5jZW9mIFJlICYmIHQuZmllbGQuaXNFcXVhbChlKSAmJiAoXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSB0Lm9wIHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSB0Lm9wKSkpO1xuICAgIH1cbiAgICBnZXRGaWVsZEluZGV4ZXModCwgZSkge1xuICAgICAgICBjb25zdCBuID0gQnIodCksIHMgPSBMcih0KTtcbiAgICAgICAgcmV0dXJuIChlID8gbi5XKFwiY29sbGVjdGlvbkdyb3VwSW5kZXhcIiwgSURCS2V5UmFuZ2UuYm91bmQoZSwgZSkpIDogbi5XKCkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIEF0LmZvckVhY2godCwgKHQgPT4gcy5nZXQoWyB0LmluZGV4SWQsIHRoaXMudWlkIF0pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIGUucHVzaChmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlID8gbmV3IHd0KGUuc2VxdWVuY2VOdW1iZXIsIG5ldyB5dCh0cihlLnJlYWRUaW1lKSwgbmV3IGN0KHBpKGUuZG9jdW1lbnRLZXkpKSwgZS5sYXJnZXN0QmF0Y2hJZCkpIDogd3QuZW1wdHkoKSwgcyA9IHQuZmllbGRzLm1hcCgoKFt0LCBlXSkgPT4gbmV3IGR0KHV0LmZyb21TZXJ2ZXJGb3JtYXQodCksIGUpKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgYXQodC5pbmRleElkLCB0LmNvbGxlY3Rpb25Hcm91cCwgcywgbik7XG4gICAgICAgICAgICAgICAgfSh0LCBuKSk7XG4gICAgICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBlKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TmV4dENvbGxlY3Rpb25Hcm91cFRvVXBkYXRlKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRJbmRleGVzKHQpLm5leHQoKHQgPT4gMCA9PT0gdC5sZW5ndGggPyBudWxsIDogKHQuc29ydCgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmluZGV4U3RhdGUuc2VxdWVuY2VOdW1iZXIgLSBlLmluZGV4U3RhdGUuc2VxdWVuY2VOdW1iZXI7XG4gICAgICAgICAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiBaKHQuY29sbGVjdGlvbkdyb3VwLCBlLmNvbGxlY3Rpb25Hcm91cCk7XG4gICAgICAgIH0pKSwgdFswXS5jb2xsZWN0aW9uR3JvdXApKSk7XG4gICAgfVxuICAgIHVwZGF0ZUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBCcih0KSwgaSA9IExyKHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5kbih0KS5uZXh0KCh0ID0+IHMuVyhcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsIElEQktleVJhbmdlLmJvdW5kKGUsIGUpKS5uZXh0KChlID0+IEF0LmZvckVhY2goZSwgKGUgPT4gaS5wdXQodXIoZS5pbmRleElkLCB0aGlzLnVzZXIsIHQsIG4pKSkpKSkpKTtcbiAgICB9XG4gICAgdXBkYXRlSW5kZXhFbnRyaWVzKHQsIGUpIHtcbiAgICAgICAgLy8gUG9ydGluZyBOb3RlOiBgZ2V0RmllbGRJbmRleGVzKClgIG9uIFdlYiBkb2VzIG5vdCBjYWNoZSBpbmRleCBsb29rdXBzIGFzXG4gICAgICAgIC8vIGl0IGNvdWxkIGJlIHVzZWQgYWNyb3NzIGRpZmZlcmVudCBJbmRleGVkREIgdHJhbnNhY3Rpb25zLiBBcyBhbnkgY2FjaGVkXG4gICAgICAgIC8vIGRhdGEgbWlnaHQgYmUgaW52YWxpZGF0ZWQgYnkgb3RoZXIgbXVsdGktdGFiIGNsaWVudHMsIHdlIGNhbiBvbmx5IHRydXN0XG4gICAgICAgIC8vIGRhdGEgd2l0aGluIGEgc2luZ2xlIEluZGV4ZWREQiB0cmFuc2FjdGlvbi4gV2UgdGhlcmVmb3JlIGFkZCBhIGNhY2hlXG4gICAgICAgIC8vIGhlcmUuXG4gICAgICAgIGNvbnN0IG4gPSBuZXcgTWFwO1xuICAgICAgICByZXR1cm4gQXQuZm9yRWFjaChlLCAoKGUsIHMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuLmdldChlLmNvbGxlY3Rpb25Hcm91cCk7XG4gICAgICAgICAgICByZXR1cm4gKGkgPyBBdC5yZXNvbHZlKGkpIDogdGhpcy5nZXRGaWVsZEluZGV4ZXModCwgZS5jb2xsZWN0aW9uR3JvdXApKS5uZXh0KChpID0+IChuLnNldChlLmNvbGxlY3Rpb25Hcm91cCwgaSksIFxuICAgICAgICAgICAgQXQuZm9yRWFjaChpLCAobiA9PiB0aGlzLl9uKHQsIGUsIG4pLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLnduKHMsIG4pO1xuICAgICAgICAgICAgICAgIHJldHVybiBlLmlzRXF1YWwoaSkgPyBBdC5yZXNvbHZlKCkgOiB0aGlzLm1uKHQsIHMsIG4sIGUsIGkpO1xuICAgICAgICAgICAgfSkpKSkpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ24odCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gJHIodCkucHV0KHtcbiAgICAgICAgICAgIGluZGV4SWQ6IHMuaW5kZXhJZCxcbiAgICAgICAgICAgIHVpZDogdGhpcy51aWQsXG4gICAgICAgICAgICBhcnJheVZhbHVlOiBzLmFycmF5VmFsdWUsXG4gICAgICAgICAgICBkaXJlY3Rpb25hbFZhbHVlOiBzLmRpcmVjdGlvbmFsVmFsdWUsXG4gICAgICAgICAgICBvcmRlcmVkRG9jdW1lbnRLZXk6IHRoaXMuYW4obiwgZS5rZXkpLFxuICAgICAgICAgICAgZG9jdW1lbnRLZXk6IGUua2V5LnBhdGgudG9BcnJheSgpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB5bih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHJldHVybiAkcih0KS5kZWxldGUoWyBzLmluZGV4SWQsIHRoaXMudWlkLCBzLmFycmF5VmFsdWUsIHMuZGlyZWN0aW9uYWxWYWx1ZSwgdGhpcy5hbihuLCBlLmtleSksIGUua2V5LnBhdGgudG9BcnJheSgpIF0pO1xuICAgIH1cbiAgICBfbih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSAkcih0KTtcbiAgICAgICAgbGV0IGkgPSBuZXcgV2UoVHIpO1xuICAgICAgICByZXR1cm4gcy5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50S2V5SW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS5vbmx5KFsgbi5pbmRleElkLCB0aGlzLnVpZCwgdGhpcy5hbihuLCBlKSBdKVxuICAgICAgICB9LCAoKHQsIHMpID0+IHtcbiAgICAgICAgICAgIGkgPSBpLmFkZChuZXcgSXIobi5pbmRleElkLCBlLCBzLmFycmF5VmFsdWUsIHMuZGlyZWN0aW9uYWxWYWx1ZSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyB0aGUgaW5kZXggZW50cmllcyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50LiAqLyAgICB3bih0LCBlKSB7XG4gICAgICAgIGxldCBuID0gbmV3IFdlKFRyKTtcbiAgICAgICAgY29uc3QgcyA9IHRoaXMuY24oZSwgdCk7XG4gICAgICAgIGlmIChudWxsID09IHMpIHJldHVybiBuO1xuICAgICAgICBjb25zdCBpID0gaHQoZSk7XG4gICAgICAgIGlmIChudWxsICE9IGkpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0LmRhdGEuZmllbGQoaS5maWVsZFBhdGgpO1xuICAgICAgICAgICAgaWYgKGhlKHIpKSBmb3IgKGNvbnN0IGkgb2Ygci5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSkgbiA9IG4uYWRkKG5ldyBJcihlLmluZGV4SWQsIHQua2V5LCB0aGlzLnJuKGkpLCBzKSk7XG4gICAgICAgIH0gZWxzZSBuID0gbi5hZGQobmV3IElyKGUuaW5kZXhJZCwgdC5rZXksIE9yLCBzKSk7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBpbmRleCBlbnRyaWVzIGZvciB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgYnkgZGVsZXRpbmcgZW50cmllc1xuICAgICAqIHRoYXQgYXJlIG5vIGxvbmdlciByZWZlcmVuY2VkIGluIGBuZXdFbnRyaWVzYCBhbmQgYWRkaW5nIGFsbCBuZXdseSBhZGRlZFxuICAgICAqIGVudHJpZXMuXG4gICAgICovICAgIG1uKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgQyhcIkluZGV4ZWREYkluZGV4TWFuYWdlclwiLCBcIlVwZGF0aW5nIGluZGV4IGVudHJpZXMgZm9yIGRvY3VtZW50ICclcydcIiwgZS5rZXkpO1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgICAgICBjb25zdCByID0gdC5nZXRJdGVyYXRvcigpLCBvID0gZS5nZXRJdGVyYXRvcigpO1xuICAgICAgICAgICAgbGV0IHUgPSBIZShyKSwgYyA9IEhlKG8pO1xuICAgICAgICAgICAgLy8gV2FsayB0aHJvdWdoIHRoZSB0d28gc2V0cyBhdCB0aGUgc2FtZSB0aW1lLCB1c2luZyB0aGUgb3JkZXJpbmcgZGVmaW5lZCBieVxuICAgICAgICAgICAgLy8gYGNvbXBhcmF0b3JgLlxuICAgICAgICAgICAgZm9yICg7dSB8fCBjOyApIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9ICExLCBlID0gITE7XG4gICAgICAgICAgICAgICAgaWYgKHUgJiYgYykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gbih1LCBjKTtcbiAgICAgICAgICAgICAgICAgICAgcyA8IDAgPyBcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnQgd2FzIHJlbW92ZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZFxuICAgICAgICAgICAgICAgICAgICAvLyB3YWxrdGhyb3VnaCBpcyBvbmx5IGluIGBiZWZvcmVgLlxuICAgICAgICAgICAgICAgICAgICBlID0gITAgOiBzID4gMCAmJiAoXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHdhcyBhZGRlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkIHdhbGt0aHJvdWdoXG4gICAgICAgICAgICAgICAgICAgIC8vIGlzIG9ubHkgaW4gYGFmdGVyYC5cbiAgICAgICAgICAgICAgICAgICAgdCA9ICEwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgbnVsbCAhPSB1ID8gZSA9ICEwIDogdCA9ICEwO1xuICAgICAgICAgICAgICAgIHQgPyAocyhjKSwgYyA9IEhlKG8pKSA6IGUgPyAoaSh1KSwgdSA9IEhlKHIpKSA6ICh1ID0gSGUociksIGMgPSBIZShvKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0ocywgaSwgVHIsIChcbiAgICAgICAgLyogb25BZGQ9ICovIHMgPT4ge1xuICAgICAgICAgICAgci5wdXNoKHRoaXMuZ24odCwgZSwgbiwgcykpO1xuICAgICAgICB9KSwgKFxuICAgICAgICAvKiBvblJlbW92ZT0gKi8gcyA9PiB7XG4gICAgICAgICAgICByLnB1c2godGhpcy55bih0LCBlLCBuLCBzKSk7XG4gICAgICAgIH0pKSwgQXQud2FpdEZvcihyKTtcbiAgICB9XG4gICAgZG4odCkge1xuICAgICAgICBsZXQgZSA9IDE7XG4gICAgICAgIHJldHVybiBMcih0KS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcInNlcXVlbmNlTnVtYmVySW5kZXhcIixcbiAgICAgICAgICAgIHJldmVyc2U6ICEwLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLnVwcGVyQm91bmQoWyB0aGlzLnVpZCwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgXSlcbiAgICAgICAgfSwgKCh0LCBuLCBzKSA9PiB7XG4gICAgICAgICAgICBzLmRvbmUoKSwgZSA9IG4uc2VxdWVuY2VOdW1iZXIgKyAxO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgbmV3IHNldCBvZiBJREIgcmFuZ2VzIHRoYXQgc3BsaXRzIHRoZSBleGlzdGluZyByYW5nZSBhbmQgZXhjbHVkZXNcbiAgICAgKiBhbnkgdmFsdWVzIHRoYXQgbWF0Y2ggdGhlIGBub3RJblZhbHVlYCBmcm9tIHRoZXNlIHJhbmdlcy4gQXMgYW4gZXhhbXBsZSxcbiAgICAgKiAnW2ZvbyA+IDIgJiYgZm9vICE9IDNdYCBiZWNvbWVzICBgW2ZvbyA+IDIgJiYgPCAzLCBmb28gPiAzXWAuXG4gICAgICovICAgIGNyZWF0ZVJhbmdlKHQsIGUsIG4pIHtcbiAgICAgICAgLy8gVGhlIG5vdEluIHZhbHVlcyBuZWVkIHRvIGJlIHNvcnRlZCBhbmQgdW5pcXVlIHNvIHRoYXQgd2UgY2FuIHJldHVybiBhXG4gICAgICAgIC8vIHNvcnRlZCBzZXQgb2Ygbm9uLW92ZXJsYXBwaW5nIHJhbmdlcy5cbiAgICAgICAgbiA9IG4uc29ydCgoKHQsIGUpID0+IFRyKHQsIGUpKSkuZmlsdGVyKCgodCwgZSwgbikgPT4gIWUgfHwgMCAhPT0gVHIodCwgbltlIC0gMV0pKSk7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcy5wdXNoKHQpO1xuICAgICAgICBmb3IgKGNvbnN0IGkgb2Ygbikge1xuICAgICAgICAgICAgY29uc3QgbiA9IFRyKGksIHQpLCByID0gVHIoaSwgZSk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gbikgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgaXMgdGhlIGxvd2VyIGJvdW5kLiBXZSB0aGVyZWZvcmUgbmVlZCB0byByYWlzZSB0aGUgYm91bmRcbiAgICAgICAgICAgIC8vIHRvIHRoZSBuZXh0IHZhbHVlLlxuICAgICAgICAgICAgc1swXSA9IHQuVWUoKTsgZWxzZSBpZiAobiA+IDAgJiYgciA8IDApIFxuICAgICAgICAgICAgLy8gYG5vdEluVmFsdWVgIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICBzLnB1c2goaSksIHMucHVzaChpLlVlKCkpOyBlbHNlIGlmIChyID4gMCkgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgKGFuZCBhbGwgZm9sbG93aW5nIHZhbHVlcykgYXJlIG91dCBvZiB0aGUgcmFuZ2VcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHMucHVzaChlKTtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IHMubGVuZ3RoOyB0ICs9IDIpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGVuY291bnRlciB0d28gYm91bmRzIHRoYXQgd2lsbCBjcmVhdGUgYW4gdW5tYXRjaGFibGUga2V5IHJhbmdlLFxuICAgICAgICAgICAgLy8gdGhlbiB3ZSByZXR1cm4gYW4gZW1wdHkgc2V0IG9mIGtleSByYW5nZXMuXG4gICAgICAgICAgICBpZiAodGhpcy5wbihzW3RdLCBzW3QgKyAxXSkpIHJldHVybiBbXTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBbIHNbdF0uaW5kZXhJZCwgdGhpcy51aWQsIHNbdF0uYXJyYXlWYWx1ZSwgc1t0XS5kaXJlY3Rpb25hbFZhbHVlLCBPciwgW10gXSwgbiA9IFsgc1t0ICsgMV0uaW5kZXhJZCwgdGhpcy51aWQsIHNbdCArIDFdLmFycmF5VmFsdWUsIHNbdCArIDFdLmRpcmVjdGlvbmFsVmFsdWUsIE9yLCBbXSBdO1xuICAgICAgICAgICAgaS5wdXNoKElEQktleVJhbmdlLmJvdW5kKGUsIG4pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaTtcbiAgICB9XG4gICAgcG4odCwgZSkge1xuICAgICAgICAvLyBJZiBsb3dlciBib3VuZCBpcyBncmVhdGVyIHRoYW4gdGhlIHVwcGVyIGJvdW5kLCB0aGVuIHRoZSBrZXlcbiAgICAgICAgLy8gcmFuZ2UgY2FuIG5ldmVyIGJlIG1hdGNoZWQuXG4gICAgICAgIHJldHVybiBUcih0LCBlKSA+IDA7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldEZyb21Db2xsZWN0aW9uR3JvdXAodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZEluZGV4ZXModCwgZSkubmV4dChxcik7XG4gICAgfVxuICAgIGdldE1pbk9mZnNldCh0LCBlKSB7XG4gICAgICAgIHJldHVybiBBdC5tYXBBcnJheSh0aGlzLlplKGUpLCAoZSA9PiB0aGlzLnRuKHQsIGUpLm5leHQoKHQgPT4gdCB8fCBPKCkpKSkpLm5leHQocXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGNvbGxlY3Rpb25QYXJlbnRzXG4gKiBkb2N1bWVudCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBGcih0KSB7XG4gICAgcmV0dXJuIEdpKHQsIFwiY29sbGVjdGlvblBhcmVudHNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBpbmRleCBlbnRyeSBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gJHIodCkge1xuICAgIHJldHVybiBHaSh0LCBcImluZGV4RW50cmllc1wiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGluZGV4IGNvbmZpZ3VyYXRpb24gb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIEJyKHQpIHtcbiAgICByZXR1cm4gR2kodCwgXCJpbmRleENvbmZpZ3VyYXRpb25cIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBpbmRleCBzdGF0ZSBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gTHIodCkge1xuICAgIHJldHVybiBHaSh0LCBcImluZGV4U3RhdGVcIik7XG59XG5cbmZ1bmN0aW9uIHFyKHQpIHtcbiAgICBNKDAgIT09IHQubGVuZ3RoKTtcbiAgICBsZXQgZSA9IHRbMF0uaW5kZXhTdGF0ZS5vZmZzZXQsIG4gPSBlLmxhcmdlc3RCYXRjaElkO1xuICAgIGZvciAobGV0IHMgPSAxOyBzIDwgdC5sZW5ndGg7IHMrKykge1xuICAgICAgICBjb25zdCBpID0gdFtzXS5pbmRleFN0YXRlLm9mZnNldDtcbiAgICAgICAgcHQoaSwgZSkgPCAwICYmIChlID0gaSksIG4gPCBpLmxhcmdlc3RCYXRjaElkICYmIChuID0gaS5sYXJnZXN0QmF0Y2hJZCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgeXQoZS5yZWFkVGltZSwgZS5kb2N1bWVudEtleSwgbik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IFVyID0ge1xuICAgIGRpZFJ1bjogITEsXG4gICAgc2VxdWVuY2VOdW1iZXJzQ29sbGVjdGVkOiAwLFxuICAgIHRhcmdldHNSZW1vdmVkOiAwLFxuICAgIGRvY3VtZW50c1JlbW92ZWQ6IDBcbn07XG5cbmNsYXNzIEtyIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvLyBXaGVuIHdlIGF0dGVtcHQgdG8gY29sbGVjdCwgd2Ugd2lsbCBvbmx5IGRvIHNvIGlmIHRoZSBjYWNoZSBzaXplIGlzIGdyZWF0ZXIgdGhhbiB0aGlzXG4gICAgLy8gdGhyZXNob2xkLiBQYXNzaW5nIGBDT0xMRUNUSU9OX0RJU0FCTEVEYCBoZXJlIHdpbGwgY2F1c2UgY29sbGVjdGlvbiB0byBhbHdheXMgYmUgc2tpcHBlZC5cbiAgICB0LCBcbiAgICAvLyBUaGUgcGVyY2VudGFnZSBvZiBzZXF1ZW5jZSBudW1iZXJzIHRoYXQgd2Ugd2lsbCBhdHRlbXB0IHRvIGNvbGxlY3RcbiAgICBlLCBcbiAgICAvLyBBIGNhcCBvbiB0aGUgdG90YWwgbnVtYmVyIG9mIHNlcXVlbmNlIG51bWJlcnMgdGhhdCB3aWxsIGJlIGNvbGxlY3RlZC4gVGhpcyBwcmV2ZW50c1xuICAgIC8vIHVzIGZyb20gY29sbGVjdGluZyBhIGh1Z2UgbnVtYmVyIG9mIHNlcXVlbmNlIG51bWJlcnMgaWYgdGhlIGNhY2hlIGhhcyBncm93biB2ZXJ5IGxhcmdlLlxuICAgIG4pIHtcbiAgICAgICAgdGhpcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkID0gdCwgdGhpcy5wZXJjZW50aWxlVG9Db2xsZWN0ID0gZSwgdGhpcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0ID0gbjtcbiAgICB9XG4gICAgc3RhdGljIHdpdGhDYWNoZVNpemUodCkge1xuICAgICAgICByZXR1cm4gbmV3IEtyKHQsIEtyLkRFRkFVTFRfQ09MTEVDVElPTl9QRVJDRU5USUxFLCBLci5ERUZBVUxUX01BWF9TRVFVRU5DRV9OVU1CRVJTX1RPX0NPTExFQ1QpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRGVsZXRlIGEgbXV0YXRpb24gYmF0Y2ggYW5kIHRoZSBhc3NvY2lhdGVkIGRvY3VtZW50IG11dGF0aW9ucy5cbiAqIEByZXR1cm5zIEEgUGVyc2lzdGVuY2VQcm9taXNlIG9mIHRoZSBkb2N1bWVudCBtdXRhdGlvbnMgdGhhdCB3ZXJlIHJlbW92ZWQuXG4gKi9cbmZ1bmN0aW9uIEdyKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gdC5zdG9yZShcIm11dGF0aW9uc1wiKSwgaSA9IHQuc3RvcmUoXCJkb2N1bWVudE11dGF0aW9uc1wiKSwgciA9IFtdLCBvID0gSURCS2V5UmFuZ2Uub25seShuLmJhdGNoSWQpO1xuICAgIGxldCB1ID0gMDtcbiAgICBjb25zdCBjID0gcy5aKHtcbiAgICAgICAgcmFuZ2U6IG9cbiAgICB9LCAoKHQsIGUsIG4pID0+ICh1KyssIG4uZGVsZXRlKCkpKSk7XG4gICAgci5wdXNoKGMubmV4dCgoKCkgPT4ge1xuICAgICAgICBNKDEgPT09IHUpO1xuICAgIH0pKSk7XG4gICAgY29uc3QgYSA9IFtdO1xuICAgIGZvciAoY29uc3QgdCBvZiBuLm11dGF0aW9ucykge1xuICAgICAgICBjb25zdCBzID0gRWkoZSwgdC5rZXkucGF0aCwgbi5iYXRjaElkKTtcbiAgICAgICAgci5wdXNoKGkuZGVsZXRlKHMpKSwgYS5wdXNoKHQua2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIEF0LndhaXRGb3IocikubmV4dCgoKCkgPT4gYSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYW4gYXBwcm94aW1hdGUgc2l6ZSBmb3IgdGhlIGdpdmVuIGRvY3VtZW50LlxuICovIGZ1bmN0aW9uIFFyKHQpIHtcbiAgICBpZiAoIXQpIHJldHVybiAwO1xuICAgIGxldCBlO1xuICAgIGlmICh0LmRvY3VtZW50KSBlID0gdC5kb2N1bWVudDsgZWxzZSBpZiAodC51bmtub3duRG9jdW1lbnQpIGUgPSB0LnVua25vd25Eb2N1bWVudDsgZWxzZSB7XG4gICAgICAgIGlmICghdC5ub0RvY3VtZW50KSB0aHJvdyBPKCk7XG4gICAgICAgIGUgPSB0Lm5vRG9jdW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShlKS5sZW5ndGg7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogQSBtdXRhdGlvbiBxdWV1ZSBmb3IgYSBzcGVjaWZpYyB1c2VyLCBiYWNrZWQgYnkgSW5kZXhlZERCLiAqLyBLci5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSA9IDEwLCBcbktyLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCA9IDFlMywgS3IuREVGQVVMVCA9IG5ldyBLcig0MTk0MzA0MCwgS3IuREVGQVVMVF9DT0xMRUNUSU9OX1BFUkNFTlRJTEUsIEtyLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCksIFxuS3IuRElTQUJMRUQgPSBuZXcgS3IoLTEsIDAsIDApO1xuXG5jbGFzcyBqciB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIG5vcm1hbGl6ZWQgdXNlcklkIChlLmcuIG51bGwgVUlEID0+IFwiXCIgdXNlcklkKSB1c2VkIHRvIHN0b3JlIC9cbiAgICAgKiByZXRyaWV2ZSBtdXRhdGlvbnMuXG4gICAgICovXG4gICAgdCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLnVzZXJJZCA9IHQsIHRoaXMueXQgPSBlLCB0aGlzLmluZGV4TWFuYWdlciA9IG4sIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSBzLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhY2hlcyB0aGUgZG9jdW1lbnQga2V5cyBmb3IgcGVuZGluZyBtdXRhdGlvbiBiYXRjaGVzLiBJZiB0aGUgbXV0YXRpb25cbiAgICAgICAgICogaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIEluZGV4ZWREYiwgdGhlIGNhY2hlZCB2YWx1ZSBtYXkgY29udGludWUgdG9cbiAgICAgICAgICogYmUgdXNlZCB0byByZXRyaWV2ZSB0aGUgYmF0Y2gncyBkb2N1bWVudCBrZXlzLiBUbyByZW1vdmUgYSBjYWNoZWQgdmFsdWVcbiAgICAgICAgICogbG9jYWxseSwgYHJlbW92ZUNhY2hlZE11dGF0aW9uS2V5cygpYCBzaG91bGQgYmUgaW52b2tlZCBlaXRoZXIgZGlyZWN0bHlcbiAgICAgICAgICogb3IgdGhyb3VnaCBgcmVtb3ZlTXV0YXRpb25CYXRjaGVzKClgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXaXRoIG11bHRpLXRhYiwgd2hlbiB0aGUgcHJpbWFyeSBjbGllbnQgYWNrbm93bGVkZ2VzIG9yIHJlamVjdHMgYSBtdXRhdGlvbixcbiAgICAgICAgICogdGhpcyBjYWNoZSBpcyB1c2VkIGJ5IHNlY29uZGFyeSBjbGllbnRzIHRvIGludmFsaWRhdGUgdGhlIGxvY2FsXG4gICAgICAgICAqIHZpZXcgb2YgdGhlIGRvY3VtZW50cyB0aGF0IHdlcmUgcHJldmlvdXNseSBhZmZlY3RlZCBieSB0aGUgbXV0YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgICAgICB0aGlzLkluID0ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgbXV0YXRpb24gcXVldWUgZm9yIHRoZSBnaXZlbiB1c2VyLlxuICAgICAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIG11dGF0aW9uIHF1ZXVlLlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIHNlcmlhbGl6ZXIgdG8gdXNlIHdoZW4gcGVyc2lzdGluZyB0byBJbmRleGVkRGIuXG4gICAgICovICAgIHN0YXRpYyByZSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIC8vIFRPRE8obWNnKTogRmlndXJlIG91dCB3aGF0IGNvbnN0cmFpbnRzIHRoZXJlIGFyZSBvbiB1c2VySURzXG4gICAgICAgIC8vIEluIHBhcnRpY3VsYXIsIGFyZSB0aGVyZSBhbnkgcmVzZXJ2ZWQgY2hhcmFjdGVycz8gYXJlIGVtcHR5IGlkcyBhbGxvd2VkP1xuICAgICAgICAvLyBGb3IgdGhlIG1vbWVudCBzdG9yZSB0aGVzZSB0b2dldGhlciBpbiB0aGUgc2FtZSBtdXRhdGlvbnMgdGFibGUgYXNzdW1pbmdcbiAgICAgICAgLy8gdGhhdCBlbXB0eSB1c2VySURzIGFyZW4ndCBhbGxvd2VkLlxuICAgICAgICBNKFwiXCIgIT09IHQudWlkKTtcbiAgICAgICAgY29uc3QgaSA9IHQuaXNBdXRoZW50aWNhdGVkKCkgPyB0LnVpZCA6IFwiXCI7XG4gICAgICAgIHJldHVybiBuZXcganIoaSwgZSwgbiwgcyk7XG4gICAgfVxuICAgIGNoZWNrRW1wdHkodCkge1xuICAgICAgICBsZXQgZSA9ICEwO1xuICAgICAgICBjb25zdCBuID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZIF0sIFsgdGhpcy51c2VySWQsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgcmV0dXJuIHpyKHQpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwidXNlck11dGF0aW9uc0luZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogblxuICAgICAgICB9LCAoKHQsIG4sIHMpID0+IHtcbiAgICAgICAgICAgIGUgPSAhMSwgcy5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBlKSk7XG4gICAgfVxuICAgIGFkZE11dGF0aW9uQmF0Y2godCwgZSwgbiwgcykge1xuICAgICAgICBjb25zdCBpID0gSHIodCksIHIgPSB6cih0KTtcbiAgICAgICAgLy8gVGhlIEluZGV4ZWREYiBpbXBsZW1lbnRhdGlvbiBpbiBDaHJvbWUgKGFuZCBGaXJlZm94KSBkb2VzIG5vdCBoYW5kbGVcbiAgICAgICAgLy8gY29tcG91bmQgaW5kaWNlcyB0aGF0IGluY2x1ZGUgYXV0by1nZW5lcmF0ZWQga2V5cyBjb3JyZWN0bHkuIFRvIGVuc3VyZVxuICAgICAgICAvLyB0aGF0IHRoZSBpbmRleCBlbnRyeSBpcyBhZGRlZCBjb3JyZWN0bHkgaW4gYWxsIGJyb3dzZXJzLCB3ZSBwZXJmb3JtIHR3b1xuICAgICAgICAvLyB3cml0ZXM6IFRoZSBmaXJzdCB3cml0ZSBpcyB1c2VkIHRvIHJldHJpZXZlIHRoZSBuZXh0IGF1dG8tZ2VuZXJhdGVkIEJhdGNoXG4gICAgICAgIC8vIElELCBhbmQgdGhlIHNlY29uZCB3cml0ZSBwb3B1bGF0ZXMgdGhlIGluZGV4IGFuZCBzdG9yZXMgdGhlIGFjdHVhbFxuICAgICAgICAvLyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgICAgLy8gU2VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD03MDE5NzJcbiAgICAgICAgLy8gV2Ugd3JpdGUgYW4gZW1wdHkgb2JqZWN0IHRvIG9idGFpbiBrZXlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHIuYWRkKHt9KS5uZXh0KChvID0+IHtcbiAgICAgICAgICAgIE0oXCJudW1iZXJcIiA9PSB0eXBlb2Ygbyk7XG4gICAgICAgICAgICBjb25zdCB1ID0gbmV3IFFpKG8sIGUsIG4sIHMpLCBjID0gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuLmJhc2VNdXRhdGlvbnMubWFwKChlID0+IHRpKHQuaWUsIGUpKSksIGkgPSBuLm11dGF0aW9ucy5tYXAoKGUgPT4gdGkodC5pZSwgZSkpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGUsXG4gICAgICAgICAgICAgICAgICAgIGJhdGNoSWQ6IG4uYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxXcml0ZVRpbWVNczogbi5sb2NhbFdyaXRlVGltZS50b01pbGxpcygpLFxuICAgICAgICAgICAgICAgICAgICBiYXNlTXV0YXRpb25zOiBzLFxuICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbnM6IGlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSh0aGlzLnl0LCB0aGlzLnVzZXJJZCwgdSksIGEgPSBbXTtcbiAgICAgICAgICAgIGxldCBoID0gbmV3IFdlKCgodCwgZSkgPT4gWih0LmNhbm9uaWNhbFN0cmluZygpLCBlLmNhbm9uaWNhbFN0cmluZygpKSkpO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIHMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gRWkodGhpcy51c2VySWQsIHQua2V5LnBhdGgsIG8pO1xuICAgICAgICAgICAgICAgIGggPSBoLmFkZCh0LmtleS5wYXRoLnBvcExhc3QoKSksIGEucHVzaChyLnB1dChjKSksIGEucHVzaChpLnB1dChlLCBBaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGguZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgYS5wdXNoKHRoaXMuaW5kZXhNYW5hZ2VyLmFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KHQsIGUpKTtcbiAgICAgICAgICAgIH0pKSwgdC5hZGRPbkNvbW1pdHRlZExpc3RlbmVyKCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5JbltvXSA9IHUua2V5cygpO1xuICAgICAgICAgICAgfSkpLCBBdC53YWl0Rm9yKGEpLm5leHQoKCgpID0+IHUpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBsb29rdXBNdXRhdGlvbkJhdGNoKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHpyKHQpLmdldChlKS5uZXh0KCh0ID0+IHQgPyAoTSh0LnVzZXJJZCA9PT0gdGhpcy51c2VySWQpLCBlcih0aGlzLnl0LCB0KSkgOiBudWxsKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIGRvY3VtZW50IGtleXMgZm9yIHRoZSBtdXRhdGlvbiBiYXRjaCB3aXRoIHRoZSBnaXZlbiBiYXRjaElkLlxuICAgICAqIEZvciBwcmltYXJ5IGNsaWVudHMsIHRoaXMgbWV0aG9kIHJldHVybnMgYG51bGxgIGFmdGVyXG4gICAgICogYHJlbW92ZU11dGF0aW9uQmF0Y2hlcygpYCBoYXMgYmVlbiBjYWxsZWQuIFNlY29uZGFyeSBjbGllbnRzIHJldHVybiBhXG4gICAgICogY2FjaGVkIHJlc3VsdCB1bnRpbCBgcmVtb3ZlQ2FjaGVkTXV0YXRpb25LZXlzKClgIGlzIGludm9rZWQuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBUbih0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkluW2VdID8gQXQucmVzb2x2ZSh0aGlzLkluW2VdKSA6IHRoaXMubG9va3VwTXV0YXRpb25CYXRjaCh0LCBlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHQua2V5cygpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLkluW2VdID0gbiwgbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUgKyAxLCBzID0gSURCS2V5UmFuZ2UubG93ZXJCb3VuZChbIHRoaXMudXNlcklkLCBuIF0pO1xuICAgICAgICBsZXQgaSA9IG51bGw7XG4gICAgICAgIHJldHVybiB6cih0KS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcInVzZXJNdXRhdGlvbnNJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IHNcbiAgICAgICAgfSwgKCh0LCBlLCBzKSA9PiB7XG4gICAgICAgICAgICBlLnVzZXJJZCA9PT0gdGhpcy51c2VySWQgJiYgKE0oZS5iYXRjaElkID49IG4pLCBpID0gZXIodGhpcy55dCwgZSkpLCBzLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgZ2V0SGlnaGVzdFVuYWNrbm93bGVkZ2VkQmF0Y2hJZCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBJREJLZXlSYW5nZS51cHBlckJvdW5kKFsgdGhpcy51c2VySWQsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgbGV0IG4gPSAtMTtcbiAgICAgICAgcmV0dXJuIHpyKHQpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwidXNlck11dGF0aW9uc0luZGV4XCIsXG4gICAgICAgICAgICByYW5nZTogZSxcbiAgICAgICAgICAgIHJldmVyc2U6ICEwXG4gICAgICAgIH0sICgodCwgZSwgcykgPT4ge1xuICAgICAgICAgICAgbiA9IGUuYmF0Y2hJZCwgcy5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIGdldEFsbE11dGF0aW9uQmF0Y2hlcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCAtMSBdLCBbIHRoaXMudXNlcklkLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSk7XG4gICAgICAgIHJldHVybiB6cih0KS5XKFwidXNlck11dGF0aW9uc0luZGV4XCIsIGUpLm5leHQoKHQgPT4gdC5tYXAoKHQgPT4gZXIodGhpcy55dCwgdCkpKSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleSh0LCBlKSB7XG4gICAgICAgIC8vIFNjYW4gdGhlIGRvY3VtZW50LW11dGF0aW9uIGluZGV4IHN0YXJ0aW5nIHdpdGggYSBwcmVmaXggc3RhcnRpbmcgd2l0aFxuICAgICAgICAvLyB0aGUgZ2l2ZW4gZG9jdW1lbnRLZXkuXG4gICAgICAgIGNvbnN0IG4gPSBUaSh0aGlzLnVzZXJJZCwgZS5wYXRoKSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQobiksIGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIEhyKHQpLlooe1xuICAgICAgICAgICAgcmFuZ2U6IHNcbiAgICAgICAgfSwgKChuLCBzLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbbywgdSwgY10gPSBuLCBhID0gcGkodSk7XG4gICAgICAgICAgICAvLyBPbmx5IGNvbnNpZGVyIHJvd3MgbWF0Y2hpbmcgZXhhY3RseSB0aGUgc3BlY2lmaWMga2V5IG9mXG4gICAgICAgICAgICAvLyBpbnRlcmVzdC4gTm90ZSB0aGF0IGJlY2F1c2Ugd2Ugb3JkZXIgYnkgcGF0aCBmaXJzdCwgYW5kIHdlXG4gICAgICAgICAgICAvLyBvcmRlciB0ZXJtaW5hdG9ycyBiZWZvcmUgcGF0aCBzZXBhcmF0b3JzLCB3ZSdsbCBlbmNvdW50ZXIgYWxsXG4gICAgICAgICAgICAvLyB0aGUgaW5kZXggcm93cyBmb3IgZG9jdW1lbnRLZXkgY29udGlndW91c2x5LiBJbiBwYXJ0aWN1bGFyLCBhbGxcbiAgICAgICAgICAgIC8vIHRoZSByb3dzIGZvciBkb2N1bWVudEtleSB3aWxsIG9jY3VyIGJlZm9yZSBhbnkgcm93cyBmb3JcbiAgICAgICAgICAgIC8vIGRvY3VtZW50cyBuZXN0ZWQgaW4gYSBzdWJjb2xsZWN0aW9uIGJlbmVhdGggZG9jdW1lbnRLZXkgc28gd2VcbiAgICAgICAgICAgIC8vIGNhbiBzdG9wIGFzIHNvb24gYXMgd2UgaGl0IGFueSBzdWNoIHJvdy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvID09PSB0aGlzLnVzZXJJZCAmJiBlLnBhdGguaXNFcXVhbChhKSkgXG4gICAgICAgICAgICAvLyBMb29rIHVwIHRoZSBtdXRhdGlvbiBiYXRjaCBpbiB0aGUgc3RvcmUuXG4gICAgICAgICAgICByZXR1cm4genIodCkuZ2V0KGMpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdCkgdGhyb3cgTygpO1xuICAgICAgICAgICAgICAgIE0odC51c2VySWQgPT09IHRoaXMudXNlcklkKSwgaS5wdXNoKGVyKHRoaXMueXQsIHQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleXModCwgZSkge1xuICAgICAgICBsZXQgbiA9IG5ldyBXZShaKTtcbiAgICAgICAgY29uc3QgcyA9IFtdO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBUaSh0aGlzLnVzZXJJZCwgZS5wYXRoKSwgciA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoaSksIG8gPSBIcih0KS5aKHtcbiAgICAgICAgICAgICAgICByYW5nZTogclxuICAgICAgICAgICAgfSwgKCh0LCBzLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3IsIG8sIHVdID0gdCwgYyA9IHBpKG8pO1xuICAgICAgICAgICAgICAgIC8vIE9ubHkgY29uc2lkZXIgcm93cyBtYXRjaGluZyBleGFjdGx5IHRoZSBzcGVjaWZpYyBrZXkgb2ZcbiAgICAgICAgICAgICAgICAvLyBpbnRlcmVzdC4gTm90ZSB0aGF0IGJlY2F1c2Ugd2Ugb3JkZXIgYnkgcGF0aCBmaXJzdCwgYW5kIHdlXG4gICAgICAgICAgICAgICAgLy8gb3JkZXIgdGVybWluYXRvcnMgYmVmb3JlIHBhdGggc2VwYXJhdG9ycywgd2UnbGwgZW5jb3VudGVyIGFsbFxuICAgICAgICAgICAgICAgIC8vIHRoZSBpbmRleCByb3dzIGZvciBkb2N1bWVudEtleSBjb250aWd1b3VzbHkuIEluIHBhcnRpY3VsYXIsIGFsbFxuICAgICAgICAgICAgICAgIC8vIHRoZSByb3dzIGZvciBkb2N1bWVudEtleSB3aWxsIG9jY3VyIGJlZm9yZSBhbnkgcm93cyBmb3JcbiAgICAgICAgICAgICAgICAvLyBkb2N1bWVudHMgbmVzdGVkIGluIGEgc3ViY29sbGVjdGlvbiBiZW5lYXRoIGRvY3VtZW50S2V5IHNvIHdlXG4gICAgICAgICAgICAgICAgLy8gY2FuIHN0b3AgYXMgc29vbiBhcyB3ZSBoaXQgYW55IHN1Y2ggcm93LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByID09PSB0aGlzLnVzZXJJZCAmJiBlLnBhdGguaXNFcXVhbChjKSA/IG4gPSBuLmFkZCh1KSA6IGkuZG9uZSgpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcy5wdXNoKG8pO1xuICAgICAgICB9KSksIEF0LndhaXRGb3IocykubmV4dCgoKCkgPT4gdGhpcy5Fbih0LCBuKSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdRdWVyeSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLnBhdGgsIHMgPSBuLmxlbmd0aCArIDEsIGkgPSBUaSh0aGlzLnVzZXJJZCwgbiksIHIgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKGkpO1xuICAgICAgICAvLyBDb2xsZWN0IHVwIHVuaXF1ZSBiYXRjaElEcyBlbmNvdW50ZXJlZCBkdXJpbmcgYSBzY2FuIG9mIHRoZSBpbmRleC4gVXNlIGFcbiAgICAgICAgLy8gU29ydGVkU2V0IHRvIGFjY3VtdWxhdGUgYmF0Y2ggSURzIHNvIHRoZXkgY2FuIGJlIHRyYXZlcnNlZCBpbiBvcmRlciBpbiBhXG4gICAgICAgIC8vIHNjYW4gb2YgdGhlIG1haW4gdGFibGUuXG4gICAgICAgIGxldCBvID0gbmV3IFdlKFopO1xuICAgICAgICByZXR1cm4gSHIodCkuWih7XG4gICAgICAgICAgICByYW5nZTogclxuICAgICAgICB9LCAoKHQsIGUsIGkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtyLCB1LCBjXSA9IHQsIGEgPSBwaSh1KTtcbiAgICAgICAgICAgIHIgPT09IHRoaXMudXNlcklkICYmIG4uaXNQcmVmaXhPZihhKSA/IFxuICAgICAgICAgICAgLy8gUm93cyB3aXRoIGRvY3VtZW50IGtleXMgbW9yZSB0aGFuIG9uZSBzZWdtZW50IGxvbmdlciB0aGFuIHRoZVxuICAgICAgICAgICAgLy8gcXVlcnkgcGF0aCBjYW4ndCBiZSBtYXRjaGVzLiBGb3IgZXhhbXBsZSwgYSBxdWVyeSBvbiAncm9vbXMnXG4gICAgICAgICAgICAvLyBjYW4ndCBtYXRjaCB0aGUgZG9jdW1lbnQgL3Jvb21zL2FiYy9tZXNzYWdlcy94eXguXG4gICAgICAgICAgICAvLyBUT0RPKG1jZyk6IHdlJ2xsIG5lZWQgYSBkaWZmZXJlbnQgc2Nhbm5lciB3aGVuIHdlIGltcGxlbWVudFxuICAgICAgICAgICAgLy8gYW5jZXN0b3IgcXVlcmllcy5cbiAgICAgICAgICAgIGEubGVuZ3RoID09PSBzICYmIChvID0gby5hZGQoYykpIDogaS5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0aGlzLkVuKHQsIG8pKSk7XG4gICAgfVxuICAgIEVuKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IFtdLCBzID0gW107XG4gICAgICAgIC8vIFRPRE8ocm9ja3dvb2QpOiBJbXBsZW1lbnQgdGhpcyB1c2luZyBpdGVyYXRlLlxuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHMucHVzaCh6cih0KS5nZXQoZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IHQpIHRocm93IE8oKTtcbiAgICAgICAgICAgICAgICBNKHQudXNlcklkID09PSB0aGlzLnVzZXJJZCksIG4ucHVzaChlcih0aGlzLnl0LCB0KSk7XG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB9KSksIEF0LndhaXRGb3IocykubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICByZW1vdmVNdXRhdGlvbkJhdGNoKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIEdyKHQuc2UsIHRoaXMudXNlcklkLCBlKS5uZXh0KChuID0+ICh0LmFkZE9uQ29tbWl0dGVkTGlzdGVuZXIoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuQW4oZS5iYXRjaElkKTtcbiAgICAgICAgfSkpLCBBdC5mb3JFYWNoKG4sIChlID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQodCwgZSkpKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSBjYWNoZWQga2V5cyBmb3IgYSBtdXRhdGlvbiBiYXRjaC4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlXG4gICAgICogY2FsbGVkIGJ5IHNlY29uZGFyeSBjbGllbnRzIGFmdGVyIHRoZXkgcHJvY2VzcyBtdXRhdGlvbiB1cGRhdGVzLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGhhdmUgdG8gYmUgY2FsbGVkIGZyb20gcHJpbWFyeSBjbGllbnRzIGFzXG4gICAgICogdGhlIGNvcnJlc3BvbmRpbmcgY2FjaGUgZW50cmllcyBhcmUgY2xlYXJlZCB3aGVuIGFuIGFja25vd2xlZGdlZCBvclxuICAgICAqIHJlamVjdGVkIGJhdGNoIGlzIHJlbW92ZWQgZnJvbSB0aGUgbXV0YXRpb24gcXVldWUuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seVxuICAgIEFuKHQpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuSW5bdF07XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbXB0eSh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmICghZSkgcmV0dXJuIEF0LnJlc29sdmUoKTtcbiAgICAgICAgICAgIC8vIFZlcmlmeSB0aGF0IHRoZXJlIGFyZSBubyBlbnRyaWVzIGluIHRoZSBkb2N1bWVudE11dGF0aW9ucyBpbmRleCBpZlxuICAgICAgICAgICAgLy8gdGhlIHF1ZXVlIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoWyB0aGlzLnVzZXJJZCBdKTtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiBIcih0KS5aKHtcbiAgICAgICAgICAgICAgICByYW5nZTogblxuICAgICAgICAgICAgfSwgKCh0LCBlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRbMF0gPT09IHRoaXMudXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBwaSh0WzFdKTtcbiAgICAgICAgICAgICAgICAgICAgcy5wdXNoKGUpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBuLmRvbmUoKTtcbiAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgTSgwID09PSBzLmxlbmd0aCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY29udGFpbnNLZXkodCwgZSkge1xuICAgICAgICByZXR1cm4gV3IodCwgdGhpcy51c2VySWQsIGUpO1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5IChzdGF0ZSBpcyBoZWxkIGluIG1lbW9yeSBpbiBvdGhlciBjbGllbnRzKS5cbiAgICAvKiogUmV0dXJucyB0aGUgbXV0YXRpb24gcXVldWUncyBtZXRhZGF0YSBmcm9tIEluZGV4ZWREYi4gKi9cbiAgICBSbih0KSB7XG4gICAgICAgIHJldHVybiBKcih0KS5nZXQodGhpcy51c2VySWQpLm5leHQoKHQgPT4gdCB8fCB7XG4gICAgICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLFxuICAgICAgICAgICAgbGFzdEFja25vd2xlZGdlZEJhdGNoSWQ6IC0xLFxuICAgICAgICAgICAgbGFzdFN0cmVhbVRva2VuOiBcIlwiXG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgbXV0YXRpb24gcXVldWUgZm9yIHRoZSBnaXZlbiB1c2VyIGNvbnRhaW5zIGEgcGVuZGluZ1xuICogICAgICAgICBtdXRhdGlvbiBmb3IgdGhlIGdpdmVuIGtleS5cbiAqLyBmdW5jdGlvbiBXcih0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IFRpKGUsIG4ucGF0aCksIGkgPSBzWzFdLCByID0gSURCS2V5UmFuZ2UubG93ZXJCb3VuZChzKTtcbiAgICBsZXQgbyA9ICExO1xuICAgIHJldHVybiBIcih0KS5aKHtcbiAgICAgICAgcmFuZ2U6IHIsXG4gICAgICAgIFg6ICEwXG4gICAgfSwgKCh0LCBuLCBzKSA9PiB7XG4gICAgICAgIGNvbnN0IFtyLCB1LCAvKmJhdGNoSUQqLyBjXSA9IHQ7XG4gICAgICAgIHIgPT09IGUgJiYgdSA9PT0gaSAmJiAobyA9ICEwKSwgcy5kb25lKCk7XG4gICAgfSkpLm5leHQoKCgpID0+IG8pKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBhbnkgbXV0YXRpb24gcXVldWUgY29udGFpbnMgdGhlIGdpdmVuIGRvY3VtZW50LiAqL1xuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIG11dGF0aW9ucyBvYmplY3Qgc3RvcmUuXG4gKi9cbmZ1bmN0aW9uIHpyKHQpIHtcbiAgICByZXR1cm4gR2kodCwgXCJtdXRhdGlvbnNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvblF1ZXVlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gSHIodCkge1xuICAgIHJldHVybiBHaSh0LCBcImRvY3VtZW50TXV0YXRpb25zXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgbXV0YXRpb25RdWV1ZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIEpyKHQpIHtcbiAgICByZXR1cm4gR2kodCwgXCJtdXRhdGlvblF1ZXVlc1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBPZmZzZXQgdG8gZW5zdXJlIG5vbi1vdmVybGFwcGluZyB0YXJnZXQgaWRzLiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nIHRhcmdldCBJRHMgZm9yIHNlbmRpbmcgdGFyZ2V0cyB0byB0aGVcbiAqIHdhdGNoIHN0cmVhbS5cbiAqXG4gKiBUaGUgY2xpZW50IGNvbnN0cnVjdHMgdHdvIGdlbmVyYXRvcnMsIG9uZSBmb3IgdGhlIHRhcmdldCBjYWNoZSwgYW5kIG9uZSBmb3JcbiAqIGZvciB0aGUgc3luYyBlbmdpbmUgKHRvIGdlbmVyYXRlIGxpbWJvIGRvY3VtZW50cyB0YXJnZXRzKS4gVGhlc2VcbiAqIGdlbmVyYXRvcnMgcHJvZHVjZSBub24tb3ZlcmxhcHBpbmcgSURzIChieSB1c2luZyBldmVuIGFuZCBvZGQgSURzXG4gKiByZXNwZWN0aXZlbHkpLlxuICpcbiAqIEJ5IHNlcGFyYXRpbmcgdGhlIHRhcmdldCBJRCBzcGFjZSwgdGhlIHF1ZXJ5IGNhY2hlIGNhbiBnZW5lcmF0ZSB0YXJnZXQgSURzXG4gKiB0aGF0IHBlcnNpc3QgYWNyb3NzIGNsaWVudCByZXN0YXJ0cywgd2hpbGUgc3luYyBlbmdpbmUgY2FuIGluZGVwZW5kZW50bHlcbiAqIGdlbmVyYXRlIGluLW1lbW9yeSB0YXJnZXQgSURzIHRoYXQgYXJlIHRyYW5zaWVudCBhbmQgY2FuIGJlIHJldXNlZCBhZnRlciBhXG4gKiByZXN0YXJ0LlxuICovXG5jbGFzcyBZciB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmJuID0gdDtcbiAgICB9XG4gICAgbmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYm4gKz0gMiwgdGhpcy5ibjtcbiAgICB9XG4gICAgc3RhdGljIFBuKCkge1xuICAgICAgICAvLyBUaGUgdGFyZ2V0IGNhY2hlIGdlbmVyYXRvciBtdXN0IHJldHVybiAnMicgaW4gaXRzIGZpcnN0IGNhbGwgdG8gYG5leHQoKWBcbiAgICAgICAgLy8gYXMgdGhlcmUgaXMgbm8gZGlmZmVyZW50aWF0aW9uIGluIHRoZSBwcm90b2NvbCBsYXllciBiZXR3ZWVuIGFuIHVuc2V0XG4gICAgICAgIC8vIG51bWJlciBhbmQgdGhlIG51bWJlciAnMCcuIElmIHdlIHdlcmUgdG8gc2VudCBhIHRhcmdldCB3aXRoIHRhcmdldCBJRFxuICAgICAgICAvLyAnMCcsIHRoZSBiYWNrZW5kIHdvdWxkIGNvbnNpZGVyIGl0IHVuc2V0IGFuZCByZXBsYWNlIGl0IHdpdGggaXRzIG93biBJRC5cbiAgICAgICAgcmV0dXJuIG5ldyBZcigwKTtcbiAgICB9XG4gICAgc3RhdGljIHZuKCkge1xuICAgICAgICAvLyBTeW5jIGVuZ2luZSBhc3NpZ25zIHRhcmdldCBJRHMgZm9yIGxpbWJvIGRvY3VtZW50IGRldGVjdGlvbi5cbiAgICAgICAgcmV0dXJuIG5ldyBZcigtMSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBYciB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gdCwgdGhpcy55dCA9IGU7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogV2UgZG9uJ3QgY2FjaGUgZ2xvYmFsIG1ldGFkYXRhIGZvciB0aGUgdGFyZ2V0IGNhY2hlLCBzaW5jZVxuICAgIC8vIHNvbWUgb2YgaXQgKGluIHBhcnRpY3VsYXIgYGhpZ2hlc3RUYXJnZXRJZGApIGNhbiBiZSBtb2RpZmllZCBieSBzZWNvbmRhcnlcbiAgICAvLyB0YWJzLiBXZSBjb3VsZCBwZXJoYXBzIGJlIG1vcmUgZ3JhbnVsYXIgKGFuZCBlLmcuIHN0aWxsIGNhY2hlXG4gICAgLy8gYGxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb25gIGluIG1lbW9yeSkgYnV0IGZvciBzaW1wbGljaXR5IHdlIGN1cnJlbnRseSBnb1xuICAgIC8vIHRvIEluZGV4ZWREYiB3aGVuZXZlciB3ZSBuZWVkIHRvIHJlYWQgbWV0YWRhdGEuIFdlIGNhbiByZXZpc2l0IGlmIGl0IHR1cm5zXG4gICAgLy8gb3V0IHRvIGhhdmUgYSBtZWFuaW5nZnVsIHBlcmZvcm1hbmNlIGltcGFjdC5cbiAgICBhbGxvY2F0ZVRhcmdldElkKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVm4odCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gbmV3IFlyKGUuaGlnaGVzdFRhcmdldElkKTtcbiAgICAgICAgICAgIHJldHVybiBlLmhpZ2hlc3RUYXJnZXRJZCA9IG4ubmV4dCgpLCB0aGlzLlNuKHQsIGUpLm5leHQoKCgpID0+IGUuaGlnaGVzdFRhcmdldElkKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbih0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlZuKHQpLm5leHQoKHQgPT4gc3QuZnJvbVRpbWVzdGFtcChuZXcgbnQodC5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uLnNlY29uZHMsIHQubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbi5uYW5vc2Vjb25kcykpKSk7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RTZXF1ZW5jZU51bWJlcih0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlZuKHQpLm5leHQoKHQgPT4gdC5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIpKTtcbiAgICB9XG4gICAgc2V0VGFyZ2V0c01ldGFkYXRhKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVm4odCkubmV4dCgocyA9PiAocy5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgPSBlLCBuICYmIChzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24gPSBuLnRvVGltZXN0YW1wKCkpLCBcbiAgICAgICAgZSA+IHMuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyICYmIChzLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciA9IGUpLCB0aGlzLlNuKHQsIHMpKSkpO1xuICAgIH1cbiAgICBhZGRUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRG4odCwgZSkubmV4dCgoKCkgPT4gdGhpcy5Wbih0KS5uZXh0KChuID0+IChuLnRhcmdldENvdW50ICs9IDEsIHRoaXMuQ24oZSwgbiksIFxuICAgICAgICB0aGlzLlNuKHQsIG4pKSkpKSk7XG4gICAgfVxuICAgIHVwZGF0ZVRhcmdldERhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Ebih0LCBlKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0RGF0YSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW92ZU1hdGNoaW5nS2V5c0ZvclRhcmdldElkKHQsIGUudGFyZ2V0SWQpLm5leHQoKCgpID0+IFpyKHQpLmRlbGV0ZShlLnRhcmdldElkKSkpLm5leHQoKCgpID0+IHRoaXMuVm4odCkpKS5uZXh0KChlID0+IChNKGUudGFyZ2V0Q291bnQgPiAwKSwgXG4gICAgICAgIGUudGFyZ2V0Q291bnQgLT0gMSwgdGhpcy5Tbih0LCBlKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRHJvcHMgYW55IHRhcmdldHMgd2l0aCBzZXF1ZW5jZSBudW1iZXIgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSB1cHBlciBib3VuZCwgZXhjZXB0aW5nIHRob3NlXG4gICAgICogcHJlc2VudCBpbiBgYWN0aXZlVGFyZ2V0SWRzYC4gRG9jdW1lbnQgYXNzb2NpYXRpb25zIGZvciB0aGUgcmVtb3ZlZCB0YXJnZXRzIGFyZSBhbHNvIHJlbW92ZWQuXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHRhcmdldHMgcmVtb3ZlZC5cbiAgICAgKi8gICAgcmVtb3ZlVGFyZ2V0cyh0LCBlLCBuKSB7XG4gICAgICAgIGxldCBzID0gMDtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICByZXR1cm4gWnIodCkuWigoKHIsIG8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBucihvKTtcbiAgICAgICAgICAgIHUuc2VxdWVuY2VOdW1iZXIgPD0gZSAmJiBudWxsID09PSBuLmdldCh1LnRhcmdldElkKSAmJiAocysrLCBpLnB1c2godGhpcy5yZW1vdmVUYXJnZXREYXRhKHQsIHUpKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBBdC53YWl0Rm9yKGkpKSkubmV4dCgoKCkgPT4gcykpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIHByb3ZpZGVkIGZ1bmN0aW9uIHdpdGggZWFjaCBgVGFyZ2V0RGF0YWAgdGhhdCB3ZSBoYXZlIGNhY2hlZC5cbiAgICAgKi8gICAgZm9yRWFjaFRhcmdldCh0LCBlKSB7XG4gICAgICAgIHJldHVybiBacih0KS5aKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IG5yKG4pO1xuICAgICAgICAgICAgZShzKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBWbih0KSB7XG4gICAgICAgIHJldHVybiB0byh0KS5nZXQoXCJ0YXJnZXRHbG9iYWxLZXlcIikubmV4dCgodCA9PiAoTShudWxsICE9PSB0KSwgdCkpKTtcbiAgICB9XG4gICAgU24odCwgZSkge1xuICAgICAgICByZXR1cm4gdG8odCkucHV0KFwidGFyZ2V0R2xvYmFsS2V5XCIsIGUpO1xuICAgIH1cbiAgICBEbih0LCBlKSB7XG4gICAgICAgIHJldHVybiBacih0KS5wdXQoc3IodGhpcy55dCwgZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbi1wbGFjZSB1cGRhdGVzIHRoZSBwcm92aWRlZCBtZXRhZGF0YSB0byBhY2NvdW50IGZvciB2YWx1ZXMgaW4gdGhlIGdpdmVuXG4gICAgICogVGFyZ2V0RGF0YS4gU2F2aW5nIGlzIGRvbmUgc2VwYXJhdGVseS4gUmV0dXJucyB0cnVlIGlmIHRoZXJlIHdlcmUgYW55XG4gICAgICogY2hhbmdlcyB0byB0aGUgbWV0YWRhdGEuXG4gICAgICovICAgIENuKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSAhMTtcbiAgICAgICAgcmV0dXJuIHQudGFyZ2V0SWQgPiBlLmhpZ2hlc3RUYXJnZXRJZCAmJiAoZS5oaWdoZXN0VGFyZ2V0SWQgPSB0LnRhcmdldElkLCBuID0gITApLCBcbiAgICAgICAgdC5zZXF1ZW5jZU51bWJlciA+IGUuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyICYmIChlLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciA9IHQuc2VxdWVuY2VOdW1iZXIsIFxuICAgICAgICBuID0gITApLCBuO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDb3VudCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlZuKHQpLm5leHQoKHQgPT4gdC50YXJnZXRDb3VudCkpO1xuICAgIH1cbiAgICBnZXRUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgLy8gSXRlcmF0aW5nIGJ5IHRoZSBjYW5vbmljYWxJZCBtYXkgeWllbGQgbW9yZSB0aGFuIG9uZSByZXN1bHQgYmVjYXVzZVxuICAgICAgICAvLyBjYW5vbmljYWxJZCB2YWx1ZXMgYXJlIG5vdCByZXF1aXJlZCB0byBiZSB1bmlxdWUgcGVyIHRhcmdldC4gVGhpcyBxdWVyeVxuICAgICAgICAvLyBkZXBlbmRzIG9uIHRoZSBxdWVyeVRhcmdldHMgaW5kZXggdG8gYmUgZWZmaWNpZW50LlxuICAgICAgICBjb25zdCBuID0gbm4oZSksIHMgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4sIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdLCBbIG4sIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgbGV0IGkgPSBudWxsO1xuICAgICAgICByZXR1cm4gWnIodCkuWih7XG4gICAgICAgICAgICByYW5nZTogcyxcbiAgICAgICAgICAgIGluZGV4OiBcInF1ZXJ5VGFyZ2V0c0luZGV4XCJcbiAgICAgICAgfSwgKCh0LCBuLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gbnIobik7XG4gICAgICAgICAgICAvLyBBZnRlciBmaW5kaW5nIGEgcG90ZW50aWFsIG1hdGNoLCBjaGVjayB0aGF0IHRoZSB0YXJnZXQgaXNcbiAgICAgICAgICAgIC8vIGFjdHVhbGx5IGVxdWFsIHRvIHRoZSByZXF1ZXN0ZWQgdGFyZ2V0LlxuICAgICAgICAgICAgICAgICAgICAgICAgc24oZSwgci50YXJnZXQpICYmIChpID0gciwgcy5kb25lKCkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBhZGRNYXRjaGluZ0tleXModCwgZSwgbikge1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IFRoZSByZXZlcnNlIGluZGV4IChkb2N1bWVudHNUYXJnZXRzKSBpcyBtYWludGFpbmVkIGJ5XG4gICAgICAgIC8vIEluZGV4ZWREYi5cbiAgICAgICAgY29uc3QgcyA9IFtdLCBpID0gZW8odCk7XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IG1pKGUucGF0aCk7XG4gICAgICAgICAgICBzLnB1c2goaS5wdXQoe1xuICAgICAgICAgICAgICAgIHRhcmdldElkOiBuLFxuICAgICAgICAgICAgICAgIHBhdGg6IHJcbiAgICAgICAgICAgIH0pKSwgcy5wdXNoKHRoaXMucmVmZXJlbmNlRGVsZWdhdGUuYWRkUmVmZXJlbmNlKHQsIG4sIGUpKTtcbiAgICAgICAgfSkpLCBBdC53YWl0Rm9yKHMpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXModCwgZSwgbikge1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IFRoZSByZXZlcnNlIGluZGV4IChkb2N1bWVudHNUYXJnZXRzKSBpcyBtYWludGFpbmVkIGJ5XG4gICAgICAgIC8vIEluZGV4ZWREYi5cbiAgICAgICAgY29uc3QgcyA9IGVvKHQpO1xuICAgICAgICByZXR1cm4gQXQuZm9yRWFjaChlLCAoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gbWkoZS5wYXRoKTtcbiAgICAgICAgICAgIHJldHVybiBBdC53YWl0Rm9yKFsgcy5kZWxldGUoWyBuLCBpIF0pLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVJlZmVyZW5jZSh0LCBuLCBlKSBdKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlbyh0KSwgcyA9IElEQktleVJhbmdlLmJvdW5kKFsgZSBdLCBbIGUgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIG4uZGVsZXRlKHMpO1xuICAgIH1cbiAgICBnZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZCh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5ib3VuZChbIGUgXSwgWyBlICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCksIHMgPSBlbyh0KTtcbiAgICAgICAgbGV0IGkgPSBFcygpO1xuICAgICAgICByZXR1cm4gcy5aKHtcbiAgICAgICAgICAgIHJhbmdlOiBuLFxuICAgICAgICAgICAgWDogITBcbiAgICAgICAgfSwgKCh0LCBlLCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gcGkodFsxXSksIHIgPSBuZXcgY3Qocyk7XG4gICAgICAgICAgICBpID0gaS5hZGQocik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IG1pKGUucGF0aCksIHMgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4gXSwgWyBldChuKSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgcmV0dXJuIGVvKHQpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRUYXJnZXRzSW5kZXhcIixcbiAgICAgICAgICAgIFg6ICEwLFxuICAgICAgICAgICAgcmFuZ2U6IHNcbiAgICAgICAgfSwgKChbdCwgZV0sIG4sIHMpID0+IHtcbiAgICAgICAgICAgIC8vIEhhdmluZyBhIHNlbnRpbmVsIHJvdyBmb3IgYSBkb2N1bWVudCBkb2VzIG5vdCBjb3VudCBhcyBjb250YWluaW5nIHRoYXQgZG9jdW1lbnQ7XG4gICAgICAgICAgICAvLyBGb3IgdGhlIHRhcmdldCBjYWNoZSwgY29udGFpbmluZyB0aGUgZG9jdW1lbnQgbWVhbnMgdGhlIGRvY3VtZW50IGlzIHBhcnQgb2Ygc29tZVxuICAgICAgICAgICAgLy8gdGFyZ2V0LlxuICAgICAgICAgICAgMCAhPT0gdCAmJiAoaSsrLCBzLmRvbmUoKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpID4gMCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhIFRhcmdldERhdGEgZW50cnkgYnkgdGFyZ2V0IElELlxuICAgICAqXG4gICAgICogQHBhcmFtIHRhcmdldElkIC0gVGhlIHRhcmdldCBJRCBvZiB0aGUgVGFyZ2V0RGF0YSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgVGFyZ2V0RGF0YSBlbnRyeSwgb3IgbnVsbCBpZiB0aGUgY2FjaGUgaGFzIG5vIGVudHJ5IGZvclxuICAgICAqIHRoZSB0YXJnZXQuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBuZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBacih0KS5nZXQoZSkubmV4dCgodCA9PiB0ID8gbnIodCkgOiBudWxsKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgcXVlcmllcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gWnIodCkge1xuICAgIHJldHVybiBHaSh0LCBcInRhcmdldHNcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSB0YXJnZXQgZ2xvYmFscyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gdG8odCkge1xuICAgIHJldHVybiBHaSh0LCBcInRhcmdldEdsb2JhbFwiKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGRvY3VtZW50IHRhcmdldCBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gZW8odCkge1xuICAgIHJldHVybiBHaSh0LCBcInRhcmdldERvY3VtZW50c1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gbm8oW3QsIGVdLCBbbiwgc10pIHtcbiAgICBjb25zdCBpID0gWih0LCBuKTtcbiAgICByZXR1cm4gMCA9PT0gaSA/IFooZSwgcykgOiBpO1xufVxuXG4vKipcbiAqIFVzZWQgdG8gY2FsY3VsYXRlIHRoZSBudGggc2VxdWVuY2UgbnVtYmVyLiBLZWVwcyBhIHJvbGxpbmcgYnVmZmVyIG9mIHRoZVxuICogbG93ZXN0IG4gdmFsdWVzIHBhc3NlZCB0byBgYWRkRWxlbWVudGAsIGFuZCBmaW5hbGx5IHJlcG9ydHMgdGhlIGxhcmdlc3Qgb2ZcbiAqIHRoZW0gaW4gYG1heFZhbHVlYC5cbiAqLyBjbGFzcyBzbyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnhuID0gdCwgdGhpcy5idWZmZXIgPSBuZXcgV2Uobm8pLCB0aGlzLk5uID0gMDtcbiAgICB9XG4gICAga24oKSB7XG4gICAgICAgIHJldHVybiArK3RoaXMuTm47XG4gICAgfVxuICAgIE9uKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IFsgdCwgdGhpcy5rbigpIF07XG4gICAgICAgIGlmICh0aGlzLmJ1ZmZlci5zaXplIDwgdGhpcy54bikgdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5hZGQoZSk7IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuYnVmZmVyLmxhc3QoKTtcbiAgICAgICAgICAgIG5vKGUsIHQpIDwgMCAmJiAodGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5kZWxldGUodCkuYWRkKGUpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbWF4VmFsdWUoKSB7XG4gICAgICAgIC8vIEd1YXJhbnRlZWQgdG8gYmUgbm9uLWVtcHR5LiBJZiB3ZSBkZWNpZGUgd2UgYXJlIG5vdCBjb2xsZWN0aW5nIGFueVxuICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXJzLCBudGhTZXF1ZW5jZU51bWJlciBiZWxvdyBzaG9ydC1jaXJjdWl0cy4gSWYgd2UgaGF2ZVxuICAgICAgICAvLyBkZWNpZGVkIHRoYXQgd2UgYXJlIGNvbGxlY3RpbmcgbiBzZXF1ZW5jZSBudW1iZXJzLCBpdCdzIGJlY2F1c2UgbiBpcyBzb21lXG4gICAgICAgIC8vIHBlcmNlbnRhZ2Ugb2YgdGhlIGV4aXN0aW5nIHNlcXVlbmNlIG51bWJlcnMuIFRoYXQgbWVhbnMgd2Ugc2hvdWxkIG5ldmVyXG4gICAgICAgIC8vIGJlIGluIGEgc2l0dWF0aW9uIHdoZXJlIHdlIGFyZSBjb2xsZWN0aW5nIHNlcXVlbmNlIG51bWJlcnMgYnV0IGRvbid0XG4gICAgICAgIC8vIGFjdHVhbGx5IGhhdmUgYW55LlxuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIubGFzdCgpWzBdO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciB0aGUgc2NoZWR1bGluZyBvZiBMUlUgZ2FyYmFnZSBjb2xsZWN0aW9uLiBJdCBoYW5kbGVzIGNoZWNraW5nXG4gKiB3aGV0aGVyIG9yIG5vdCBHQyBpcyBlbmFibGVkLCBhcyB3ZWxsIGFzIHdoaWNoIGRlbGF5IHRvIHVzZSBiZWZvcmUgdGhlIG5leHQgcnVuLlxuICovIGNsYXNzIGlvIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IHQsIHRoaXMuYXN5bmNRdWV1ZSA9IGUsIHRoaXMubG9jYWxTdG9yZSA9IG4sIHRoaXMuTW4gPSBudWxsO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgLTEgIT09IHRoaXMuZ2FyYmFnZUNvbGxlY3Rvci5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCAmJiB0aGlzLkZuKDZlNCk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuTW4gJiYgKHRoaXMuTW4uY2FuY2VsKCksIHRoaXMuTW4gPSBudWxsKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLk1uO1xuICAgIH1cbiAgICBGbih0KSB7XG4gICAgICAgIEMoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBHYXJiYWdlIGNvbGxlY3Rpb24gc2NoZWR1bGVkIGluICR7dH1tc2ApLCB0aGlzLk1uID0gdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBZnRlckRlbGF5KFwibHJ1X2dhcmJhZ2VfY29sbGVjdGlvblwiIC8qIFRpbWVySWQuTHJ1R2FyYmFnZUNvbGxlY3Rpb24gKi8gLCB0LCAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5NbiA9IG51bGw7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMubG9jYWxTdG9yZS5jb2xsZWN0R2FyYmFnZSh0aGlzLmdhcmJhZ2VDb2xsZWN0b3IpO1xuICAgICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgICAgIFZ0KHQpID8gQyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgXCJJZ25vcmluZyBJbmRleGVkREIgZXJyb3IgZHVyaW5nIGdhcmJhZ2UgY29sbGVjdGlvbjogXCIsIHQpIDogYXdhaXQgRXQodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCB0aGlzLkZuKDNlNSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKiBJbXBsZW1lbnRzIHRoZSBzdGVwcyBmb3IgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbi4gKi8gY2xhc3Mgcm8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy4kbiA9IHQsIHRoaXMucGFyYW1zID0gZTtcbiAgICB9XG4gICAgY2FsY3VsYXRlVGFyZ2V0Q291bnQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbi5Cbih0KS5uZXh0KCh0ID0+IE1hdGguZmxvb3IoZSAvIDEwMCAqIHQpKSk7XG4gICAgfVxuICAgIG50aFNlcXVlbmNlTnVtYmVyKHQsIGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUpIHJldHVybiBBdC5yZXNvbHZlKE90LmF0KTtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBzbyhlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuJG4uZm9yRWFjaFRhcmdldCh0LCAodCA9PiBuLk9uKHQuc2VxdWVuY2VOdW1iZXIpKSkubmV4dCgoKCkgPT4gdGhpcy4kbi5Mbih0LCAodCA9PiBuLk9uKHQpKSkpKS5uZXh0KCgoKSA9PiBuLm1heFZhbHVlKSk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHModCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy4kbi5yZW1vdmVUYXJnZXRzKHQsIGUsIG4pO1xuICAgIH1cbiAgICByZW1vdmVPcnBoYW5lZERvY3VtZW50cyh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRuLnJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKHQsIGUpO1xuICAgIH1cbiAgICBjb2xsZWN0KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIC0xID09PSB0aGlzLnBhcmFtcy5jYWNoZVNpemVDb2xsZWN0aW9uVGhyZXNob2xkID8gKEMoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIFwiR2FyYmFnZSBjb2xsZWN0aW9uIHNraXBwZWQ7IGRpc2FibGVkXCIpLCBcbiAgICAgICAgQXQucmVzb2x2ZShVcikpIDogdGhpcy5nZXRDYWNoZVNpemUodCkubmV4dCgobiA9PiBuIDwgdGhpcy5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCA/IChDKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBgR2FyYmFnZSBjb2xsZWN0aW9uIHNraXBwZWQ7IENhY2hlIHNpemUgJHtufSBpcyBsb3dlciB0aGFuIHRocmVzaG9sZCAke3RoaXMucGFyYW1zLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGR9YCksIFxuICAgICAgICBVcikgOiB0aGlzLnFuKHQsIGUpKSk7XG4gICAgfVxuICAgIGdldENhY2hlU2l6ZSh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRuLmdldENhY2hlU2l6ZSh0KTtcbiAgICB9XG4gICAgcW4odCwgZSkge1xuICAgICAgICBsZXQgbiwgcywgaSwgciwgbywgYywgYTtcbiAgICAgICAgY29uc3QgaCA9IERhdGUubm93KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZVRhcmdldENvdW50KHQsIHRoaXMucGFyYW1zLnBlcmNlbnRpbGVUb0NvbGxlY3QpLm5leHQoKGUgPT4gKFxuICAgICAgICAvLyBDYXAgYXQgdGhlIGNvbmZpZ3VyZWQgbWF4XG4gICAgICAgIGUgPiB0aGlzLnBhcmFtcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0ID8gKEMoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBDYXBwaW5nIHNlcXVlbmNlIG51bWJlcnMgdG8gY29sbGVjdCBkb3duIHRvIHRoZSBtYXhpbXVtIG9mICR7dGhpcy5wYXJhbXMubWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdH0gZnJvbSAke2V9YCksIFxuICAgICAgICBzID0gdGhpcy5wYXJhbXMubWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdCkgOiBzID0gZSwgciA9IERhdGUubm93KCksIHRoaXMubnRoU2VxdWVuY2VOdW1iZXIodCwgcykpKSkubmV4dCgocyA9PiAobiA9IHMsIFxuICAgICAgICBvID0gRGF0ZS5ub3coKSwgdGhpcy5yZW1vdmVUYXJnZXRzKHQsIG4sIGUpKSkpLm5leHQoKGUgPT4gKGkgPSBlLCBjID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIHRoaXMucmVtb3ZlT3JwaGFuZWREb2N1bWVudHModCwgbikpKSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBpZiAoYSA9IERhdGUubm93KCksIFMoKSA8PSBMb2dMZXZlbC5ERUJVRykge1xuICAgICAgICAgICAgICAgIEMoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBMUlUgR2FyYmFnZSBDb2xsZWN0aW9uXFxuXFx0Q291bnRlZCB0YXJnZXRzIGluICR7ciAtIGh9bXNcXG5cXHREZXRlcm1pbmVkIGxlYXN0IHJlY2VudGx5IHVzZWQgJHtzfSBpbiBgICsgKG8gLSByKSArIFwibXNcXG5cIiArIGBcXHRSZW1vdmVkICR7aX0gdGFyZ2V0cyBpbiBgICsgKGMgLSBvKSArIFwibXNcXG5cIiArIGBcXHRSZW1vdmVkICR7dH0gZG9jdW1lbnRzIGluIGAgKyAoYSAtIGMpICsgXCJtc1xcblwiICsgYFRvdGFsIER1cmF0aW9uOiAke2EgLSBofW1zYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh7XG4gICAgICAgICAgICAgICAgZGlkUnVuOiAhMCxcbiAgICAgICAgICAgICAgICBzZXF1ZW5jZU51bWJlcnNDb2xsZWN0ZWQ6IHMsXG4gICAgICAgICAgICAgICAgdGFyZ2V0c1JlbW92ZWQ6IGksXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRzUmVtb3ZlZDogdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogUHJvdmlkZXMgTFJVIGZ1bmN0aW9uYWxpdHkgZm9yIEluZGV4ZWREQiBwZXJzaXN0ZW5jZS4gKi9cbmNsYXNzIG9vIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMuZGIgPSB0LCB0aGlzLmdhcmJhZ2VDb2xsZWN0b3IgPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IHJvKHQsIGUpO1xuICAgICAgICB9KHRoaXMsIGUpO1xuICAgIH1cbiAgICBCbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLlVuKHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLmdldFRhcmdldENvdW50KHQpLm5leHQoKHQgPT4gZS5uZXh0KChlID0+IHQgKyBlKSkpKTtcbiAgICB9XG4gICAgVW4odCkge1xuICAgICAgICBsZXQgZSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLkxuKHQsICh0ID0+IHtcbiAgICAgICAgICAgIGUrKztcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGUpKTtcbiAgICB9XG4gICAgZm9yRWFjaFRhcmdldCh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFRhcmdldENhY2hlKCkuZm9yRWFjaFRhcmdldCh0LCBlKTtcbiAgICB9XG4gICAgTG4odCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Lbih0LCAoKHQsIG4pID0+IGUobikpKTtcbiAgICB9XG4gICAgYWRkUmVmZXJlbmNlKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIHVvKHQsIG4pO1xuICAgIH1cbiAgICByZW1vdmVSZWZlcmVuY2UodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdW8odCwgbik7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHModCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLnJlbW92ZVRhcmdldHModCwgZSwgbik7XG4gICAgfVxuICAgIG1hcmtQb3RlbnRpYWxseU9ycGhhbmVkKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHVvKHQsIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgYW55dGhpbmcgd291bGQgcHJldmVudCB0aGlzIGRvY3VtZW50IGZyb20gYmVpbmcgZ2FyYmFnZVxuICAgICAqIGNvbGxlY3RlZCwgZ2l2ZW4gdGhhdCB0aGUgZG9jdW1lbnQgaW4gcXVlc3Rpb24gaXMgbm90IHByZXNlbnQgaW4gYW55XG4gICAgICogdGFyZ2V0cyBhbmQgaGFzIGEgc2VxdWVuY2UgbnVtYmVyIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgdXBwZXIgYm91bmQgZm9yXG4gICAgICogdGhlIGNvbGxlY3Rpb24gcnVuLlxuICAgICAqLyAgICBHbih0LCBlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBsZXQgbiA9ICExO1xuICAgICAgICAgICAgcmV0dXJuIEpyKHQpLnR0KChzID0+IFdyKHQsIHMsIGUpLm5leHQoKHQgPT4gKHQgJiYgKG4gPSAhMCksIEF0LnJlc29sdmUoIXQpKSkpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgICAgICB9KHQsIGUpO1xuICAgIH1cbiAgICByZW1vdmVPcnBoYW5lZERvY3VtZW50cyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmRiLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5uZXdDaGFuZ2VCdWZmZXIoKSwgcyA9IFtdO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHJldHVybiB0aGlzLktuKHQsICgociwgbykgPT4ge1xuICAgICAgICAgICAgaWYgKG8gPD0gZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLkduKHQsIHIpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWUpIFxuICAgICAgICAgICAgICAgICAgICAvLyBPdXIgc2l6ZSBhY2NvdW50aW5nIHJlcXVpcmVzIHVzIHRvIHJlYWQgYWxsIGRvY3VtZW50cyBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZpbmcgdGhlbS5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkrKywgbi5nZXRFbnRyeSh0LCByKS5uZXh0KCgoKSA9PiAobi5yZW1vdmVFbnRyeShyLCBzdC5taW4oKSksIGVvKHQpLmRlbGV0ZShbIDAsIG1pKHIucGF0aCkgXSkpKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIHMucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLm5leHQoKCgpID0+IEF0LndhaXRGb3IocykpKS5uZXh0KCgoKSA9PiBuLmFwcGx5KHQpKSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZS53aXRoU2VxdWVuY2VOdW1iZXIodC5jdXJyZW50U2VxdWVuY2VOdW1iZXIpO1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRUYXJnZXRDYWNoZSgpLnVwZGF0ZVRhcmdldERhdGEodCwgbik7XG4gICAgfVxuICAgIHVwZGF0ZUxpbWJvRG9jdW1lbnQodCwgZSkge1xuICAgICAgICByZXR1cm4gdW8odCwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGwgcHJvdmlkZWQgZnVuY3Rpb24gZm9yIGVhY2ggZG9jdW1lbnQgaW4gdGhlIGNhY2hlIHRoYXQgaXMgJ29ycGhhbmVkJy4gT3JwaGFuZWRcbiAgICAgKiBtZWFucyBub3QgYSBwYXJ0IG9mIGFueSB0YXJnZXQsIHNvIHRoZSBvbmx5IGVudHJ5IGluIHRoZSB0YXJnZXQtZG9jdW1lbnQgaW5kZXggZm9yXG4gICAgICogdGhhdCBkb2N1bWVudCB3aWxsIGJlIHRoZSBzZW50aW5lbCByb3cgKHRhcmdldElkIDApLCB3aGljaCB3aWxsIGFsc28gaGF2ZSB0aGUgc2VxdWVuY2VcbiAgICAgKiBudW1iZXIgZm9yIHRoZSBsYXN0IHRpbWUgdGhlIGRvY3VtZW50IHdhcyBhY2Nlc3NlZC5cbiAgICAgKi8gICAgS24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZW8odCk7XG4gICAgICAgIGxldCBzLCBpID0gT3QuYXQ7XG4gICAgICAgIHJldHVybiBuLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRUYXJnZXRzSW5kZXhcIlxuICAgICAgICB9LCAoKFt0LCBuXSwge3BhdGg6IHIsIHNlcXVlbmNlTnVtYmVyOiBvfSkgPT4ge1xuICAgICAgICAgICAgMCA9PT0gdCA/IChcbiAgICAgICAgICAgIC8vIGlmIG5leHRUb1JlcG9ydCBpcyB2YWxpZCwgcmVwb3J0IGl0LCB0aGlzIGlzIGEgbmV3IGtleSBzbyB0aGVcbiAgICAgICAgICAgIC8vIGxhc3Qgb25lIG11c3Qgbm90IGJlIGEgbWVtYmVyIG9mIGFueSB0YXJnZXRzLlxuICAgICAgICAgICAgaSAhPT0gT3QuYXQgJiYgZShuZXcgY3QocGkocykpLCBpKSwgXG4gICAgICAgICAgICAvLyBzZXQgbmV4dFRvUmVwb3J0IHRvIGJlIHRoaXMgc2VxdWVuY2UgbnVtYmVyLiBJdCdzIHRoZSBuZXh0IG9uZSB3ZVxuICAgICAgICAgICAgLy8gbWlnaHQgcmVwb3J0LCBpZiB3ZSBkb24ndCBmaW5kIGFueSB0YXJnZXRzIGZvciB0aGlzIGRvY3VtZW50LlxuICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoZSBzZXF1ZW5jZSBudW1iZXIgbXVzdCBiZSBkZWZpbmVkIHdoZW4gdGhlIHRhcmdldElkXG4gICAgICAgICAgICAvLyBpcyAwLlxuICAgICAgICAgICAgaSA9IG8sIHMgPSByKSA6IFxuICAgICAgICAgICAgLy8gc2V0IG5leHRUb1JlcG9ydCB0byBiZSBpbnZhbGlkLCB3ZSBrbm93IHdlIGRvbid0IG5lZWQgdG8gcmVwb3J0XG4gICAgICAgICAgICAvLyB0aGlzIG9uZSBzaW5jZSB3ZSBmb3VuZCBhIHRhcmdldCBmb3IgaXQuXG4gICAgICAgICAgICBpID0gT3QuYXQ7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBTaW5jZSB3ZSByZXBvcnQgc2VxdWVuY2UgbnVtYmVycyBhZnRlciBnZXR0aW5nIHRvIHRoZSBuZXh0IGtleSwgd2VcbiAgICAgICAgICAgIC8vIG5lZWQgdG8gY2hlY2sgaWYgdGhlIGxhc3Qga2V5IHdlIGl0ZXJhdGVkIG92ZXIgd2FzIGFuIG9ycGhhbmVkXG4gICAgICAgICAgICAvLyBkb2N1bWVudCBhbmQgcmVwb3J0IGl0LlxuICAgICAgICAgICAgaSAhPT0gT3QuYXQgJiYgZShuZXcgY3QocGkocykpLCBpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRDYWNoZVNpemUodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCkuZ2V0U2l6ZSh0KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVvKHQsIGUpIHtcbiAgICByZXR1cm4gZW8odCkucHV0KFxuICAgIC8qKlxuICogQHJldHVybnMgQSB2YWx1ZSBzdWl0YWJsZSBmb3Igd3JpdGluZyBhIHNlbnRpbmVsIHJvdyBpbiB0aGUgdGFyZ2V0LWRvY3VtZW50XG4gKiBzdG9yZS5cbiAqL1xuICAgIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhcmdldElkOiAwLFxuICAgICAgICAgICAgcGF0aDogbWkodC5wYXRoKSxcbiAgICAgICAgICAgIHNlcXVlbmNlTnVtYmVyOiBlXG4gICAgICAgIH07XG4gICAgfShlLCB0LmN1cnJlbnRTZXF1ZW5jZU51bWJlcikpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgYnVmZmVyIG9mIGVudHJpZXMgdG8gYmUgd3JpdHRlbiB0byBhIFJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKiBJdCBjYW4gYmUgdXNlZCB0byBiYXRjaCB1cCBhIHNldCBvZiBjaGFuZ2VzIHRvIGJlIHdyaXR0ZW4gdG8gdGhlIGNhY2hlLCBidXRcbiAqIGFkZGl0aW9uYWxseSBzdXBwb3J0cyByZWFkaW5nIGVudHJpZXMgYmFjayB3aXRoIHRoZSBgZ2V0RW50cnkoKWAgbWV0aG9kLFxuICogZmFsbGluZyBiYWNrIHRvIHRoZSB1bmRlcmx5aW5nIFJlbW90ZURvY3VtZW50Q2FjaGUgaWYgbm8gZW50cnkgaXNcbiAqIGJ1ZmZlcmVkLlxuICpcbiAqIEVudHJpZXMgYWRkZWQgdG8gdGhlIGNhY2hlICptdXN0KiBiZSByZWFkIGZpcnN0LiBUaGlzIGlzIHRvIGZhY2lsaXRhdGVcbiAqIGNhbGN1bGF0aW5nIHRoZSBzaXplIGRlbHRhIG9mIHRoZSBwZW5kaW5nIGNoYW5nZXMuXG4gKlxuICogUE9SVElORyBOT1RFOiBUaGlzIGNsYXNzIHdhcyBpbXBsZW1lbnRlZCB0aGVuIHJlbW92ZWQgZnJvbSBvdGhlciBwbGF0Zm9ybXMuXG4gKiBJZiBieXRlLWNvdW50aW5nIGVuZHMgdXAgYmVpbmcgbmVlZGVkIG9uIHRoZSBvdGhlciBwbGF0Zm9ybXMsIGNvbnNpZGVyXG4gKiBwb3J0aW5nIHRoaXMgY2xhc3MgYXMgcGFydCBvZiB0aGF0IGltcGxlbWVudGF0aW9uIHdvcmsuXG4gKi8gY2xhc3MgY28ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBBIG1hcHBpbmcgb2YgZG9jdW1lbnQga2V5IHRvIHRoZSBuZXcgY2FjaGUgZW50cnkgdGhhdCBzaG91bGQgYmUgd3JpdHRlbi5cbiAgICAgICAgdGhpcy5jaGFuZ2VzID0gbmV3IGxzKCh0ID0+IHQudG9TdHJpbmcoKSksICgodCwgZSkgPT4gdC5pc0VxdWFsKGUpKSksIHRoaXMuY2hhbmdlc0FwcGxpZWQgPSAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVmZmVycyBhIGBSZW1vdGVEb2N1bWVudENhY2hlLmFkZEVudHJ5KClgIGNhbGwuXG4gICAgICpcbiAgICAgKiBZb3UgY2FuIG9ubHkgbW9kaWZ5IGRvY3VtZW50cyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCB2aWFcbiAgICAgKiBgZ2V0RW50cnkoKS9nZXRFbnRyaWVzKClgIChlbmZvcmNlZCB2aWEgSW5kZXhlZERicyBgYXBwbHkoKWApLlxuICAgICAqLyAgICBhZGRFbnRyeSh0KSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXMuc2V0KHQua2V5LCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVmZmVycyBhIGBSZW1vdGVEb2N1bWVudENhY2hlLnJlbW92ZUVudHJ5KClgIGNhbGwuXG4gICAgICpcbiAgICAgKiBZb3UgY2FuIG9ubHkgcmVtb3ZlIGRvY3VtZW50cyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCB2aWFcbiAgICAgKiBgZ2V0RW50cnkoKS9nZXRFbnRyaWVzKClgIChlbmZvcmNlZCB2aWEgSW5kZXhlZERicyBgYXBwbHkoKWApLlxuICAgICAqLyAgICByZW1vdmVFbnRyeSh0LCBlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXMuc2V0KHQsIFplLm5ld0ludmFsaWREb2N1bWVudCh0KS5zZXRSZWFkVGltZShlKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIGFuIGVudHJ5IGluIHRoZSBjYWNoZS4gVGhlIGJ1ZmZlcmVkIGNoYW5nZXMgd2lsbCBmaXJzdCBiZSBjaGVja2VkLFxuICAgICAqIGFuZCBpZiBubyBidWZmZXJlZCBjaGFuZ2UgYXBwbGllcywgdGhpcyB3aWxsIGZvcndhcmQgdG9cbiAgICAgKiBgUmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyeSgpYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSB0cmFuc2FjdGlvbiBpbiB3aGljaCB0byBwZXJmb3JtIGFueSBwZXJzaXN0ZW5jZVxuICAgICAqICAgICBvcGVyYXRpb25zLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudEtleSAtIFRoZSBrZXkgb2YgdGhlIGVudHJ5IHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgVGhlIGNhY2hlZCBkb2N1bWVudCBvciBhbiBpbnZhbGlkIGRvY3VtZW50IGlmIHdlIGhhdmUgbm90aGluZ1xuICAgICAqIGNhY2hlZC5cbiAgICAgKi8gICAgZ2V0RW50cnkodCwgZSkge1xuICAgICAgICB0aGlzLmFzc2VydE5vdEFwcGxpZWQoKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuY2hhbmdlcy5nZXQoZSk7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IG4gPyBBdC5yZXNvbHZlKG4pIDogdGhpcy5nZXRGcm9tQ2FjaGUodCwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIHNldmVyYWwgZW50cmllcyBpbiB0aGUgY2FjaGUsIGZvcndhcmRpbmcgdG9cbiAgICAgKiBgUmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyeSgpYC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSB0cmFuc2FjdGlvbiBpbiB3aGljaCB0byBwZXJmb3JtIGFueSBwZXJzaXN0ZW5jZVxuICAgICAqICAgICBvcGVyYXRpb25zLlxuICAgICAqIEBwYXJhbSBkb2N1bWVudEtleXMgLSBUaGUga2V5cyBvZiB0aGUgZW50cmllcyB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIEEgbWFwIG9mIGNhY2hlZCBkb2N1bWVudHMsIGluZGV4ZWQgYnkga2V5LiBJZiBhbiBlbnRyeSBjYW5ub3QgYmVcbiAgICAgKiAgICAgZm91bmQsIHRoZSBjb3JyZXNwb25kaW5nIGtleSB3aWxsIGJlIG1hcHBlZCB0byBhbiBpbnZhbGlkIGRvY3VtZW50LlxuICAgICAqLyAgICBnZXRFbnRyaWVzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsRnJvbUNhY2hlKHQsIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGJ1ZmZlcmVkIGNoYW5nZXMgdG8gdGhlIHVuZGVybHlpbmcgUmVtb3RlRG9jdW1lbnRDYWNoZSwgdXNpbmdcbiAgICAgKiB0aGUgcHJvdmlkZWQgdHJhbnNhY3Rpb24uXG4gICAgICovICAgIGFwcGx5KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXNBcHBsaWVkID0gITAsIHRoaXMuYXBwbHlDaGFuZ2VzKHQpO1xuICAgIH1cbiAgICAvKiogSGVscGVyIHRvIGFzc2VydCB0aGlzLmNoYW5nZXMgaXMgbm90IG51bGwgICovICAgIGFzc2VydE5vdEFwcGxpZWQoKSB7fVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgUmVtb3RlRG9jdW1lbnRDYWNoZSBmb3IgSW5kZXhlZERiLiBUbyBjb25zdHJ1Y3QsIGludm9rZVxuICogYG5ld0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUoKWAuXG4gKi8gY2xhc3MgYW8ge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy55dCA9IHQ7XG4gICAgfVxuICAgIHNldEluZGV4TWFuYWdlcih0KSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgc3VwcGxpZWQgZW50cmllcyB0byB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYGFkZEVudHJ5YCBhcmUgcmVxdWlyZWQgdG8gZ28gdGhyb3VnaCB0aGUgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXJcbiAgICAgKiByZXR1cm5lZCBieSBgbmV3Q2hhbmdlQnVmZmVyKClgIHRvIGVuc3VyZSBwcm9wZXIgYWNjb3VudGluZyBvZiBtZXRhZGF0YS5cbiAgICAgKi8gICAgYWRkRW50cnkodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gX28odCkucHV0KG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgZG9jdW1lbnQgZnJvbSB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYHJlbW92ZUVudHJ5YCAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYCB0byBlbnN1cmUgcHJvcGVyIGFjY291bnRpbmcgb2YgbWV0YWRhdGEuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9vKHQpLmRlbGV0ZShcbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEga2V5IHRoYXQgY2FuIGJlIHVzZWQgZm9yIGRvY3VtZW50IGxvb2t1cHMgdmlhIHRoZSBwcmltYXJ5IGtleSBvZlxuICogdGhlIERiUmVtb3RlRG9jdW1lbnQgb2JqZWN0IHN0b3JlLlxuICovXG4gICAgICAgIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LnBhdGgudG9BcnJheSgpO1xuICAgICAgICAgICAgcmV0dXJuIFsgXG4gICAgICAgICAgICAvKiBwcmVmaXggcGF0aCAqLyBuLnNsaWNlKDAsIG4ubGVuZ3RoIC0gMiksIFxuICAgICAgICAgICAgLyogY29sbGVjdGlvbiBpZCAqLyBuW24ubGVuZ3RoIC0gMl0sIFhpKGUpLCBcbiAgICAgICAgICAgIC8qIGRvY3VtZW50IGlkICovIG5bbi5sZW5ndGggLSAxXSBdO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIG9uIHRoZVxuICogYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudENvbGxlY3Rpb25Hcm91cEluZGV4YCBpbmRleC5cbiAqLyAoZSwgbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjdXJyZW50IGNhY2hlIHNpemUuXG4gICAgICpcbiAgICAgKiBDYWxsZXJzIHRvIGBhZGRFbnRyeSgpYCBhbmQgYHJlbW92ZUVudHJ5KClgICptdXN0KiBjYWxsIHRoaXMgYWZ0ZXJ3YXJkcyB0byB1cGRhdGUgdGhlXG4gICAgICogY2FjaGUncyBtZXRhZGF0YS5cbiAgICAgKi8gICAgdXBkYXRlTWV0YWRhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YSh0KS5uZXh0KChuID0+IChuLmJ5dGVTaXplICs9IGUsIHRoaXMuUW4odCwgbikpKSk7XG4gICAgfVxuICAgIGdldEVudHJ5KHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBaZS5uZXdJbnZhbGlkRG9jdW1lbnQoZSk7XG4gICAgICAgIHJldHVybiBfbyh0KS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBcImRvY3VtZW50S2V5SW5kZXhcIixcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS5vbmx5KHdvKGUpKVxuICAgICAgICB9LCAoKHQsIHMpID0+IHtcbiAgICAgICAgICAgIG4gPSB0aGlzLmpuKGUsIHMpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhbiBlbnRyeSBpbiB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXkgLSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgZG9jdW1lbnQgZW50cnkgYW5kIGl0cyBzaXplLlxuICAgICAqLyAgICBXbih0LCBlKSB7XG4gICAgICAgIGxldCBuID0ge1xuICAgICAgICAgICAgc2l6ZTogMCxcbiAgICAgICAgICAgIGRvY3VtZW50OiBaZS5uZXdJbnZhbGlkRG9jdW1lbnQoZSlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF9vKHQpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLm9ubHkod28oZSkpXG4gICAgICAgIH0sICgodCwgcykgPT4ge1xuICAgICAgICAgICAgbiA9IHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudDogdGhpcy5qbihlLCBzKSxcbiAgICAgICAgICAgICAgICBzaXplOiBRcihzKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgZ2V0RW50cmllcyh0LCBlKSB7XG4gICAgICAgIGxldCBuID0gZHMoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuem4odCwgZSwgKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gdGhpcy5qbih0LCBlKTtcbiAgICAgICAgICAgIG4gPSBuLmluc2VydCh0LCBzKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgc2V2ZXJhbCBlbnRyaWVzIGluIHRoZSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudEtleXMgLSBUaGUgc2V0IG9mIGtleXMgZW50cmllcyB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIEEgbWFwIG9mIGRvY3VtZW50cyBpbmRleGVkIGJ5IGtleSBhbmQgYSBtYXAgb2Ygc2l6ZXMgaW5kZXhlZCBieVxuICAgICAqICAgICBrZXkgKHplcm8gaWYgdGhlIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0KS5cbiAgICAgKi8gICAgSG4odCwgZSkge1xuICAgICAgICBsZXQgbiA9IGRzKCksIHMgPSBuZXcgR2UoY3QuY29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiB0aGlzLnpuKHQsIGUsICgodCwgZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuam4odCwgZSk7XG4gICAgICAgICAgICBuID0gbi5pbnNlcnQodCwgaSksIHMgPSBzLmluc2VydCh0LCBRcihlKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiAoe1xuICAgICAgICAgICAgZG9jdW1lbnRzOiBuLFxuICAgICAgICAgICAgSm46IHNcbiAgICAgICAgfSkpKTtcbiAgICB9XG4gICAgem4odCwgZSwgbikge1xuICAgICAgICBpZiAoZS5pc0VtcHR5KCkpIHJldHVybiBBdC5yZXNvbHZlKCk7XG4gICAgICAgIGxldCBzID0gbmV3IFdlKGdvKTtcbiAgICAgICAgZS5mb3JFYWNoKCh0ID0+IHMgPSBzLmFkZCh0KSkpO1xuICAgICAgICBjb25zdCBpID0gSURCS2V5UmFuZ2UuYm91bmQod28ocy5maXJzdCgpKSwgd28ocy5sYXN0KCkpKSwgciA9IHMuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgbGV0IG8gPSByLmdldE5leHQoKTtcbiAgICAgICAgcmV0dXJuIF9vKHQpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFwiZG9jdW1lbnRLZXlJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IGlcbiAgICAgICAgfSwgKCh0LCBlLCBzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gY3QuZnJvbVNlZ21lbnRzKFsgLi4uZS5wcmVmaXhQYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5kb2N1bWVudElkIF0pO1xuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCBrZXlzIG5vdCBmb3VuZCBpbiBjYWNoZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO28gJiYgZ28obywgaSkgPCAwOyApIG4obywgbnVsbCksIG8gPSByLmdldE5leHQoKTtcbiAgICAgICAgICAgIG8gJiYgby5pc0VxdWFsKGkpICYmIChcbiAgICAgICAgICAgIC8vIEtleSBmb3VuZCBpbiBjYWNoZS5cbiAgICAgICAgICAgIG4obywgZSksIG8gPSByLmhhc05leHQoKSA/IHIuZ2V0TmV4dCgpIDogbnVsbCksIFxuICAgICAgICAgICAgLy8gU2tpcCB0byB0aGUgbmV4dCBrZXkgKGlmIHRoZXJlIGlzIG9uZSkuXG4gICAgICAgICAgICBvID8gcy5qKHdvKG8pKSA6IHMuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGhlIHJlc3Qgb2YgdGhlIGtleXMgYXJlIG5vdCBpbiB0aGUgY2FjaGUuIE9uZSBjYXNlIHdoZXJlIGBpdGVyYXRlYFxuICAgICAgICAgICAgLy8gYWJvdmUgd29uJ3QgZ28gdGhyb3VnaCB0aGVtIGlzIHdoZW4gdGhlIGNhY2hlIGlzIGVtcHR5LlxuICAgICAgICAgICAgZm9yICg7bzsgKSBuKG8sIG51bGwpLCBvID0gci5oYXNOZXh0KCkgPyByLmdldE5leHQoKSA6IG51bGw7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNvbGxlY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gWyBlLnBvcExhc3QoKS50b0FycmF5KCksIGUubGFzdFNlZ21lbnQoKSwgWGkobi5yZWFkVGltZSksIG4uZG9jdW1lbnRLZXkucGF0aC5pc0VtcHR5KCkgPyBcIlwiIDogbi5kb2N1bWVudEtleS5wYXRoLmxhc3RTZWdtZW50KCkgXSwgaSA9IFsgZS5wb3BMYXN0KCkudG9BcnJheSgpLCBlLmxhc3RTZWdtZW50KCksIFsgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIF0sIFwiXCIgXTtcbiAgICAgICAgcmV0dXJuIF9vKHQpLlcoSURCS2V5UmFuZ2UuYm91bmQocywgaSwgITApKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGxldCBlID0gZHMoKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuam4oY3QuZnJvbVNlZ21lbnRzKG4ucHJlZml4UGF0aC5jb25jYXQobi5jb2xsZWN0aW9uR3JvdXAsIG4uZG9jdW1lbnRJZCkpLCBuKTtcbiAgICAgICAgICAgICAgICBlID0gZS5pbnNlcnQodC5rZXksIHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGxldCBpID0gZHMoKTtcbiAgICAgICAgY29uc3QgciA9IG1vKGUsIG4pLCBvID0gbW8oZSwgeXQubWF4KCkpO1xuICAgICAgICByZXR1cm4gX28odCkuWih7XG4gICAgICAgICAgICBpbmRleDogXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLmJvdW5kKHIsIG8sICEwKVxuICAgICAgICB9LCAoKHQsIGUsIG4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmpuKGN0LmZyb21TZWdtZW50cyhlLnByZWZpeFBhdGguY29uY2F0KGUuY29sbGVjdGlvbkdyb3VwLCBlLmRvY3VtZW50SWQpKSwgZSk7XG4gICAgICAgICAgICBpID0gaS5pbnNlcnQoci5rZXksIHIpLCBpLnNpemUgPT09IHMgJiYgbi5kb25lKCk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIG5ld0NoYW5nZUJ1ZmZlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgbG8odGhpcywgISF0ICYmIHQudHJhY2tSZW1vdmFscyk7XG4gICAgfVxuICAgIGdldFNpemUodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YSh0KS5uZXh0KCh0ID0+IHQuYnl0ZVNpemUpKTtcbiAgICB9XG4gICAgZ2V0TWV0YWRhdGEodCkge1xuICAgICAgICByZXR1cm4gZm8odCkuZ2V0KFwicmVtb3RlRG9jdW1lbnRHbG9iYWxLZXlcIikubmV4dCgodCA9PiAoTSghIXQpLCB0KSkpO1xuICAgIH1cbiAgICBRbih0LCBlKSB7XG4gICAgICAgIHJldHVybiBmbyh0KS5wdXQoXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBgZGJSZW1vdGVEb2NgIGFuZCByZXR1cm5zIHRoZSBkb2N1bWVudCAob3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZlxuICAgICAqIHRoZSBkb2N1bWVudCBjb3JyZXNwb25kcyB0byB0aGUgZm9ybWF0IHVzZWQgZm9yIHNlbnRpbmVsIGRlbGV0ZXMpLlxuICAgICAqLyAgICBqbih0LCBlKSB7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gSmkodGhpcy55dCwgZSk7XG4gICAgICAgICAgICAvLyBXaGV0aGVyIHRoZSBkb2N1bWVudCBpcyBhIHNlbnRpbmVsIHJlbW92YWwgYW5kIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gdGhlXG4gICAgICAgICAgICAvLyBgZ2V0TmV3RG9jdW1lbnRDaGFuZ2VzKClgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoISh0LmlzTm9Eb2N1bWVudCgpICYmIHQudmVyc2lvbi5pc0VxdWFsKHN0Lm1pbigpKSkpIHJldHVybiB0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBaZS5uZXdJbnZhbGlkRG9jdW1lbnQodCk7XG4gICAgfVxufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlLiAqLyBmdW5jdGlvbiBobyh0KSB7XG4gICAgcmV0dXJuIG5ldyBhbyh0KTtcbn1cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXRhaWxzIG9mIGFkZGluZyBhbmQgdXBkYXRpbmcgZG9jdW1lbnRzIGluIHRoZSBJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlLlxuICpcbiAqIFVubGlrZSB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIsIHRoZSBJbmRleGVkRGIgaW1wbGVtZW50YXRpb24gY29tcHV0ZXMgdGhlIHNpemVcbiAqIGRlbHRhIGZvciBhbGwgc3VibWl0dGVkIGNoYW5nZXMuIFRoaXMgYXZvaWRzIGhhdmluZyB0byByZS1yZWFkIGFsbCBkb2N1bWVudHMgZnJvbSBJbmRleGVkRGJcbiAqIHdoZW4gd2UgYXBwbHkgdGhlIGNoYW5nZXMuXG4gKi8gY2xhc3MgbG8gZXh0ZW5kcyBjbyB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGRvY3VtZW50Q2FjaGUgLSBUaGUgSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSB0byBhcHBseSB0aGUgY2hhbmdlcyB0by5cbiAgICAgKiBAcGFyYW0gdHJhY2tSZW1vdmFscyAtIFdoZXRoZXIgdG8gY3JlYXRlIHNlbnRpbmVsIGRlbGV0ZXMgdGhhdCBjYW4gYmUgdHJhY2tlZCBieVxuICAgICAqIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWAuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLlluID0gdCwgdGhpcy50cmFja1JlbW92YWxzID0gZSwgXG4gICAgICAgIC8vIEEgbWFwIG9mIGRvY3VtZW50IHNpemVzIGFuZCByZWFkIHRpbWVzIHByaW9yIHRvIGFwcGx5aW5nIHRoZSBjaGFuZ2VzIGluXG4gICAgICAgIC8vIHRoaXMgYnVmZmVyLlxuICAgICAgICB0aGlzLlhuID0gbmV3IGxzKCh0ID0+IHQudG9TdHJpbmcoKSksICgodCwgZSkgPT4gdC5pc0VxdWFsKGUpKSk7XG4gICAgfVxuICAgIGFwcGx5Q2hhbmdlcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgbGV0IG4gPSAwLCBzID0gbmV3IFdlKCgodCwgZSkgPT4gWih0LmNhbm9uaWNhbFN0cmluZygpLCBlLmNhbm9uaWNhbFN0cmluZygpKSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VzLmZvckVhY2goKChpLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvID0gdGhpcy5Ybi5nZXQoaSk7XG4gICAgICAgICAgICBpZiAoZS5wdXNoKHRoaXMuWW4ucmVtb3ZlRW50cnkodCwgaSwgby5yZWFkVGltZSkpLCByLmlzVmFsaWREb2N1bWVudCgpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdSA9IFlpKHRoaXMuWW4ueXQsIHIpO1xuICAgICAgICAgICAgICAgIHMgPSBzLmFkZChpLnBhdGgucG9wTGFzdCgpKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjID0gUXIodSk7XG4gICAgICAgICAgICAgICAgbiArPSBjIC0gby5zaXplLCBlLnB1c2godGhpcy5Zbi5hZGRFbnRyeSh0LCBpLCB1KSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG4gLT0gby5zaXplLCB0aGlzLnRyYWNrUmVtb3ZhbHMpIHtcbiAgICAgICAgICAgICAgICAvLyBJbiBvcmRlciB0byB0cmFjayByZW1vdmFscywgd2Ugc3RvcmUgYSBcInNlbnRpbmVsIGRlbGV0ZVwiIGluIHRoZVxuICAgICAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgZW50cnkgaXMgcmVwcmVzZW50ZWQgYnkgYSBOb0RvY3VtZW50XG4gICAgICAgICAgICAgICAgLy8gd2l0aCBhIHZlcnNpb24gb2YgMCBhbmQgaWdub3JlZCBieSBgbWF5YmVEZWNvZGVEb2N1bWVudCgpYCBidXRcbiAgICAgICAgICAgICAgICAvLyBwcmVzZXJ2ZWQgaW4gYGdldE5ld0RvY3VtZW50Q2hhbmdlcygpYC5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gWWkodGhpcy5Zbi55dCwgci5jb252ZXJ0VG9Ob0RvY3VtZW50KHN0Lm1pbigpKSk7XG4gICAgICAgICAgICAgICAgZS5wdXNoKHRoaXMuWW4uYWRkRW50cnkodCwgaSwgbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSksIHMuZm9yRWFjaCgobiA9PiB7XG4gICAgICAgICAgICBlLnB1c2godGhpcy5Zbi5pbmRleE1hbmFnZXIuYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgodCwgbikpO1xuICAgICAgICB9KSksIGUucHVzaCh0aGlzLlluLnVwZGF0ZU1ldGFkYXRhKHQsIG4pKSwgQXQud2FpdEZvcihlKTtcbiAgICB9XG4gICAgZ2V0RnJvbUNhY2hlKHQsIGUpIHtcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBzaXplIG9mIGV2ZXJ5dGhpbmcgd2UgbG9hZCBmcm9tIHRoZSBjYWNoZSBzbyB3ZSBjYW4gY29tcHV0ZSBhIGRlbHRhIGxhdGVyLlxuICAgICAgICByZXR1cm4gdGhpcy5Zbi5Xbih0LCBlKS5uZXh0KCh0ID0+ICh0aGlzLlhuLnNldChlLCB7XG4gICAgICAgICAgICBzaXplOiB0LnNpemUsXG4gICAgICAgICAgICByZWFkVGltZTogdC5kb2N1bWVudC5yZWFkVGltZVxuICAgICAgICB9KSwgdC5kb2N1bWVudCkpKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNhY2hlKHQsIGUpIHtcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBzaXplIG9mIGV2ZXJ5dGhpbmcgd2UgbG9hZCBmcm9tIHRoZSBjYWNoZSBzbyB3ZSBjYW4gY29tcHV0ZVxuICAgICAgICAvLyBhIGRlbHRhIGxhdGVyLlxuICAgICAgICByZXR1cm4gdGhpcy5Zbi5Ibih0LCBlKS5uZXh0KCgoe2RvY3VtZW50czogdCwgSm46IGV9KSA9PiAoXG4gICAgICAgIC8vIE5vdGU6IGBnZXRBbGxGcm9tQ2FjaGVgIHJldHVybnMgdHdvIG1hcHMgaW5zdGVhZCBvZiBhIHNpbmdsZSBtYXAgZnJvbVxuICAgICAgICAvLyBrZXlzIHRvIGBEb2N1bWVudFNpemVFbnRyeWBzLiBUaGlzIGlzIHRvIGFsbG93IHJldHVybmluZyB0aGVcbiAgICAgICAgLy8gYE11dGFibGVEb2N1bWVudE1hcGAgZGlyZWN0bHksIHdpdGhvdXQgYSBjb252ZXJzaW9uLlxuICAgICAgICBlLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICB0aGlzLlhuLnNldChlLCB7XG4gICAgICAgICAgICAgICAgc2l6ZTogbixcbiAgICAgICAgICAgICAgICByZWFkVGltZTogdC5nZXQoZSkucmVhZFRpbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSksIHQpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBmbyh0KSB7XG4gICAgcmV0dXJuIEdpKHQsIFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSByZW1vdGVEb2N1bWVudHMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9vKHQpIHtcbiAgICByZXR1cm4gR2kodCwgXCJyZW1vdGVEb2N1bWVudHNWMTRcIik7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIG9uIHRoZVxuICogYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudEtleUluZGV4YCBpbmRleC5cbiAqLyBmdW5jdGlvbiB3byh0KSB7XG4gICAgY29uc3QgZSA9IHQucGF0aC50b0FycmF5KCk7XG4gICAgcmV0dXJuIFsgXG4gICAgLyogcHJlZml4IHBhdGggKi8gZS5zbGljZSgwLCBlLmxlbmd0aCAtIDIpLCBcbiAgICAvKiBjb2xsZWN0aW9uIGlkICovIGVbZS5sZW5ndGggLSAyXSwgXG4gICAgLyogZG9jdW1lbnQgaWQgKi8gZVtlLmxlbmd0aCAtIDFdIF07XG59XG5cbmZ1bmN0aW9uIG1vKHQsIGUpIHtcbiAgICBjb25zdCBuID0gZS5kb2N1bWVudEtleS5wYXRoLnRvQXJyYXkoKTtcbiAgICByZXR1cm4gWyBcbiAgICAvKiBjb2xsZWN0aW9uIGlkICovIHQsIFhpKGUucmVhZFRpbWUpLCBcbiAgICAvKiBwcmVmaXggcGF0aCAqLyBuLnNsaWNlKDAsIG4ubGVuZ3RoIC0gMiksIFxuICAgIC8qIGRvY3VtZW50IGlkICovIG4ubGVuZ3RoID4gMCA/IG5bbi5sZW5ndGggLSAxXSA6IFwiXCIgXTtcbn1cblxuLyoqXG4gKiBDb21wYXJhdG9yIHRoYXQgY29tcGFyZXMgZG9jdW1lbnQga2V5cyBhY2NvcmRpbmcgdG8gdGhlIHByaW1hcnkga2V5IHNvcnRpbmdcbiAqIHVzZWQgYnkgdGhlIGBEYlJlbW90ZURvY3VtZW50RG9jdW1lbnRgIHN0b3JlIChieSBwcmVmaXggcGF0aCwgY29sbGVjdGlvbiBpZFxuICogYW5kIHRoZW4gZG9jdW1lbnQgSUQpLlxuICpcbiAqIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gKi8gZnVuY3Rpb24gZ28odCwgZSkge1xuICAgIGNvbnN0IG4gPSB0LnBhdGgudG9BcnJheSgpLCBzID0gZS5wYXRoLnRvQXJyYXkoKTtcbiAgICAvLyBUaGUgb3JkZXJpbmcgaXMgYmFzZWQgb24gaHR0cHM6Ly9jaHJvbWl1bS5nb29nbGVzb3VyY2UuY29tL2Nocm9taXVtL2JsaW5rLysvZmU1YzIxZmVmOTRkYWU3MWMxYzMzNDQ3NzViOGQ4YTdmN2U2ZDllYy9Tb3VyY2UvbW9kdWxlcy9pbmRleGVkZGIvSURCS2V5LmNwcCM3NFxuICAgIGxldCBpID0gMDtcbiAgICBmb3IgKGxldCB0ID0gMDsgdCA8IG4ubGVuZ3RoIC0gMiAmJiB0IDwgcy5sZW5ndGggLSAyOyArK3QpIGlmIChpID0gWihuW3RdLCBzW3RdKSwgXG4gICAgaSkgcmV0dXJuIGk7XG4gICAgcmV0dXJuIGkgPSBaKG4ubGVuZ3RoLCBzLmxlbmd0aCksIGkgfHwgKGkgPSBaKG5bbi5sZW5ndGggLSAyXSwgc1tzLmxlbmd0aCAtIDJdKSwgXG4gICAgaSB8fCBaKG5bbi5sZW5ndGggLSAxXSwgc1tzLmxlbmd0aCAtIDFdKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNjaGVtYSBWZXJzaW9uIGZvciB0aGUgV2ViIGNsaWVudDpcbiAqIDEuICBJbml0aWFsIHZlcnNpb24gaW5jbHVkaW5nIE11dGF0aW9uIFF1ZXVlLCBRdWVyeSBDYWNoZSwgYW5kIFJlbW90ZVxuICogICAgIERvY3VtZW50IENhY2hlXG4gKiAyLiAgVXNlZCB0byBlbnN1cmUgYSB0YXJnZXRHbG9iYWwgb2JqZWN0IGV4aXN0cyBhbmQgYWRkIHRhcmdldENvdW50IHRvIGl0LiBOb1xuICogICAgIGxvbmdlciByZXF1aXJlZCBiZWNhdXNlIG1pZ3JhdGlvbiAzIHVuY29uZGl0aW9uYWxseSBjbGVhcnMgaXQuXG4gKiAzLiAgRHJvcHBlZCBhbmQgcmUtY3JlYXRlZCBRdWVyeSBDYWNoZSB0byBkZWFsIHdpdGggY2FjaGUgY29ycnVwdGlvbiByZWxhdGVkXG4gKiAgICAgdG8gbGltYm8gcmVzb2x1dGlvbi4gQWRkcmVzc2VzXG4gKiAgICAgaHR0cHM6Ly9naXRodWIuY29tL2ZpcmViYXNlL2ZpcmViYXNlLWlvcy1zZGsvaXNzdWVzLzE1NDhcbiAqIDQuICBNdWx0aS1UYWIgU3VwcG9ydC5cbiAqIDUuICBSZW1vdmFsIG9mIGhlbGQgd3JpdGUgYWNrcy5cbiAqIDYuICBDcmVhdGUgZG9jdW1lbnQgZ2xvYmFsIGZvciB0cmFja2luZyBkb2N1bWVudCBjYWNoZSBzaXplLlxuICogNy4gIEVuc3VyZSBldmVyeSBjYWNoZWQgZG9jdW1lbnQgaGFzIGEgc2VudGluZWwgcm93IHdpdGggYSBzZXF1ZW5jZSBudW1iZXIuXG4gKiA4LiAgQWRkIGNvbGxlY3Rpb24tcGFyZW50IGluZGV4IGZvciBDb2xsZWN0aW9uIEdyb3VwIHF1ZXJpZXMuXG4gKiA5LiAgQ2hhbmdlIFJlbW90ZURvY3VtZW50Q2hhbmdlcyBzdG9yZSB0byBiZSBrZXllZCBieSByZWFkVGltZSByYXRoZXIgdGhhblxuICogICAgIGFuIGF1dG8taW5jcmVtZW50aW5nIElELiBUaGlzIGlzIHJlcXVpcmVkIGZvciBJbmRleC1GcmVlIHF1ZXJpZXMuXG4gKiAxMC4gUmV3cml0ZSB0aGUgY2Fub25pY2FsIElEcyB0byB0aGUgZXhwbGljaXQgUHJvdG9idWYtYmFzZWQgZm9ybWF0LlxuICogMTEuIEFkZCBidW5kbGVzIGFuZCBuYW1lZF9xdWVyaWVzIGZvciBidW5kbGUgc3VwcG9ydC5cbiAqIDEyLiBBZGQgZG9jdW1lbnQgb3ZlcmxheXMuXG4gKiAxMy4gUmV3cml0ZSB0aGUga2V5cyBvZiB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlIHRvIGFsbG93IGZvciBlZmZpY2llbnRcbiAqICAgICBkb2N1bWVudCBsb29rdXAgdmlhIGBnZXRBbGwoKWAuXG4gKiAxNC4gQWRkIG92ZXJsYXlzLlxuICogMTUuIEFkZCBpbmRleGluZyBzdXBwb3J0LlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgbG9jYWwgdmlldyAob3ZlcmxheSkgb2YgYSBkb2N1bWVudCwgYW5kIHRoZSBmaWVsZHMgdGhhdCBhcmVcbiAqIGxvY2FsbHkgbXV0YXRlZC5cbiAqL1xuY2xhc3MgeW8ge1xuICAgIGNvbnN0cnVjdG9yKHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBmaWVsZHMgdGhhdCBhcmUgbG9jYWxseSBtdXRhdGVkIGJ5IHBhdGNoIG11dGF0aW9ucy5cbiAgICAgKlxuICAgICAqIElmIHRoZSBvdmVybGF5ZWRcdGRvY3VtZW50IGlzIGZyb20gc2V0IG9yIGRlbGV0ZSBtdXRhdGlvbnMsIHRoaXMgaXMgYG51bGxgLlxuICAgICAqIElmIHRoZXJlIGlzIG5vIG92ZXJsYXkgKG11dGF0aW9uKSBmb3IgdGhlIGRvY3VtZW50LCB0aGlzIGlzIGFuIGVtcHR5IGBGaWVsZE1hc2tgLlxuICAgICAqL1xuICAgIGUpIHtcbiAgICAgICAgdGhpcy5vdmVybGF5ZWREb2N1bWVudCA9IHQsIHRoaXMubXV0YXRlZEZpZWxkcyA9IGU7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHJlYWRvbmx5IHZpZXcgb2YgdGhlIGxvY2FsIHN0YXRlIG9mIGFsbCBkb2N1bWVudHMgd2UncmUgdHJhY2tpbmcgKGkuZS4gd2VcbiAqIGhhdmUgYSBjYWNoZWQgdmVyc2lvbiBpbiByZW1vdGVEb2N1bWVudENhY2hlIG9yIGxvY2FsIG11dGF0aW9ucyBmb3IgdGhlXG4gKiBkb2N1bWVudCkuIFRoZSB2aWV3IGlzIGNvbXB1dGVkIGJ5IGFwcGx5aW5nIHRoZSBtdXRhdGlvbnMgaW4gdGhlXG4gKiBNdXRhdGlvblF1ZXVlIHRvIHRoZSBSZW1vdGVEb2N1bWVudENhY2hlLlxuICovIGNsYXNzIHBvIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZSA9IHQsIHRoaXMubXV0YXRpb25RdWV1ZSA9IGUsIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUgPSBuLCBcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50IGlkZW50aWZpZWQgYnkgYGtleWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBMb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudCBvciBudWxsIGlmIHdlIGRvbid0IGhhdmUgYW55IGNhY2hlZFxuICAgICAqIHN0YXRlIGZvciBpdC5cbiAgICAgKi8gICAgZ2V0RG9jdW1lbnQodCwgZSkge1xuICAgICAgICBsZXQgbiA9IG51bGw7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlLmdldE92ZXJsYXkodCwgZSkubmV4dCgocyA9PiAobiA9IHMsIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyeSh0LCBlKSkpKS5uZXh0KCh0ID0+IChudWxsICE9PSBuICYmIEpuKG4ubXV0YXRpb24sIHQsIEplLmVtcHR5KCksIG50Lm5vdygpKSwgXG4gICAgICAgIHQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50cyBpZGVudGlmaWVkIGJ5IGBrZXlzYC5cbiAgICAgKlxuICAgICAqIElmIHdlIGRvbid0IGhhdmUgY2FjaGVkIHN0YXRlIGZvciBhIGRvY3VtZW50IGluIGBrZXlzYCwgYSBOb0RvY3VtZW50IHdpbGxcbiAgICAgKiBiZSBzdG9yZWQgZm9yIHRoYXQga2V5IGluIHRoZSByZXN1bHRpbmcgc2V0LlxuICAgICAqLyAgICBnZXREb2N1bWVudHModCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJpZXModCwgZSkubmV4dCgoZSA9PiB0aGlzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKHQsIGUsIEVzKCkpLm5leHQoKCgpID0+IGUpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTaW1pbGFyIHRvIGBnZXREb2N1bWVudHNgLCBidXQgY3JlYXRlcyB0aGUgbG9jYWwgdmlldyBmcm9tIHRoZSBnaXZlblxuICAgICAqIGBiYXNlRG9jc2Agd2l0aG91dCByZXRyaWV2aW5nIGRvY3VtZW50cyBmcm9tIHRoZSBsb2NhbCBzdG9yZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSB0cmFuc2FjdGlvbiB0aGlzIG9wZXJhdGlvbiBpcyBzY29wZWQgdG8uXG4gICAgICogQHBhcmFtIGRvY3MgLSBUaGUgZG9jdW1lbnRzIHRvIGFwcGx5IGxvY2FsIG11dGF0aW9ucyB0byBnZXQgdGhlIGxvY2FsIHZpZXdzLlxuICAgICAqIEBwYXJhbSBleGlzdGVuY2VTdGF0ZUNoYW5nZWQgLSBUaGUgc2V0IG9mIGRvY3VtZW50IGtleXMgd2hvc2UgZXhpc3RlbmNlIHN0YXRlXG4gICAgICogICBpcyBjaGFuZ2VkLiBUaGlzIGlzIHVzZWZ1bCB0byBkZXRlcm1pbmUgaWYgc29tZSBkb2N1bWVudHMgb3ZlcmxheSBuZWVkc1xuICAgICAqICAgdG8gYmUgcmVjYWxjdWxhdGVkLlxuICAgICAqLyAgICBnZXRMb2NhbFZpZXdPZkRvY3VtZW50cyh0LCBlLCBuID0gRXMoKSkge1xuICAgICAgICBjb25zdCBzID0gZ3MoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9wdWxhdGVPdmVybGF5cyh0LCBzLCBlKS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyh0LCBlLCBzLCBuKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGxldCBlID0gd3MoKTtcbiAgICAgICAgICAgIHJldHVybiB0LmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgZSA9IGUuaW5zZXJ0KHQsIG4ub3ZlcmxheWVkRG9jdW1lbnQpO1xuICAgICAgICAgICAgfSkpLCBlO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgb3ZlcmxheWVkIGRvY3VtZW50cyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50IG1hcCwgd2hpY2ggd2lsbCBpbmNsdWRlXG4gICAgICogdGhlIGxvY2FsIHZpZXcgb2YgdGhvc2UgZG9jdW1lbnRzIGFuZCBhIGBGaWVsZE1hc2tgIGluZGljYXRpbmcgd2hpY2ggZmllbGRzXG4gICAgICogYXJlIG11dGF0ZWQgbG9jYWxseSwgYG51bGxgIGlmIG92ZXJsYXkgaXMgYSBTZXQgb3IgRGVsZXRlIG11dGF0aW9uLlxuICAgICAqLyAgICBnZXRPdmVybGF5ZWREb2N1bWVudHModCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZ3MoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9wdWxhdGVPdmVybGF5cyh0LCBuLCBlKS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyh0LCBlLCBuLCBFcygpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaGVzIHRoZSBvdmVybGF5cyBmb3Ige0Bjb2RlIGRvY3N9IGFuZCBhZGRzIHRoZW0gdG8gcHJvdmlkZWQgb3ZlcmxheSBtYXBcbiAgICAgKiBpZiB0aGUgbWFwIGRvZXMgbm90IGFscmVhZHkgY29udGFpbiBhbiBlbnRyeSBmb3IgdGhlIGdpdmVuIGRvY3VtZW50IGtleS5cbiAgICAgKi8gICAgcG9wdWxhdGVPdmVybGF5cyh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlLmhhcyh0KSB8fCBzLnB1c2godCk7XG4gICAgICAgIH0pKSwgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5nZXRPdmVybGF5cyh0LCBzKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIHQuZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBlLnNldCh0LCBuKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2NzIC0gVGhlIGRvY3VtZW50cyB0byBjb21wdXRlIHZpZXdzIGZvci4gSXQgYWxzbyBoYXMgdGhlIGJhc2VcbiAgICAgKiAgIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb3ZlcmxheXMgLSBUaGUgb3ZlcmxheXMgdGhhdCBuZWVkIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGdpdmVuIGJhc2VcbiAgICAgKiAgIHZlcnNpb24gb2YgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gZXhpc3RlbmNlU3RhdGVDaGFuZ2VkIC0gQSBzZXQgb2YgZG9jdW1lbnRzIHdob3NlIGV4aXN0ZW5jZSBzdGF0ZXNcbiAgICAgKiAgIG1pZ2h0IGhhdmUgY2hhbmdlZC4gVGhpcyBpcyB1c2VkIHRvIGRldGVybWluZSBpZiB3ZSBuZWVkIHRvIHJlLWNhbGN1bGF0ZVxuICAgICAqICAgb3ZlcmxheXMgZnJvbSBtdXRhdGlvbiBxdWV1ZXMuXG4gICAgICogQHJldHVybiBBIG1hcCByZXByZXNlbnRzIHRoZSBsb2NhbCBkb2N1bWVudHMgdmlldy5cbiAgICAgKi8gICAgY29tcHV0ZVZpZXdzKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgbGV0IGkgPSBkcygpO1xuICAgICAgICBjb25zdCByID0gcHMoKSwgbyA9IHBzKCk7XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvID0gbi5nZXQoZS5rZXkpO1xuICAgICAgICAgICAgLy8gUmVjYWxjdWxhdGUgYW4gb3ZlcmxheSBpZiB0aGUgZG9jdW1lbnQncyBleGlzdGVuY2Ugc3RhdGUgY2hhbmdlZCBkdWUgdG9cbiAgICAgICAgICAgIC8vIGEgcmVtb3RlIGV2ZW50ICphbmQqIHRoZSBvdmVybGF5IGlzIGEgUGF0Y2hNdXRhdGlvbi4gVGhpcyBpcyBiZWNhdXNlXG4gICAgICAgICAgICAvLyBkb2N1bWVudCBleGlzdGVuY2Ugc3RhdGUgY2FuIGNoYW5nZSBpZiBzb21lIHBhdGNoIG11dGF0aW9uJ3NcbiAgICAgICAgICAgIC8vIHByZWNvbmRpdGlvbnMgYXJlIG1ldC5cbiAgICAgICAgICAgIC8vIE5PVEU6IHdlIHJlY2FsY3VsYXRlIHdoZW4gYG92ZXJsYXlgIGlzIHVuZGVmaW5lZCBhcyB3ZWxsLCBiZWNhdXNlIHRoZXJlXG4gICAgICAgICAgICAvLyBtaWdodCBiZSBhIHBhdGNoIG11dGF0aW9uIHdob3NlIHByZWNvbmRpdGlvbiBkb2VzIG5vdCBtYXRjaCBiZWZvcmUgdGhlXG4gICAgICAgICAgICAvLyBjaGFuZ2UgKGhlbmNlIG92ZXJsYXkgaXMgdW5kZWZpbmVkKSwgYnV0IHdvdWxkIG5vdyBtYXRjaC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHMuaGFzKGUua2V5KSAmJiAodm9pZCAwID09PSBvIHx8IG8ubXV0YXRpb24gaW5zdGFuY2VvZiB0cykgPyBpID0gaS5pbnNlcnQoZS5rZXksIGUpIDogdm9pZCAwICE9PSBvID8gKHIuc2V0KGUua2V5LCBvLm11dGF0aW9uLmdldEZpZWxkTWFzaygpKSwgXG4gICAgICAgICAgICBKbihvLm11dGF0aW9uLCBlLCBvLm11dGF0aW9uLmdldEZpZWxkTWFzaygpLCBudC5ub3coKSkpIDogXG4gICAgICAgICAgICAvLyBubyBvdmVybGF5IGV4aXN0c1xuICAgICAgICAgICAgLy8gVXNpbmcgRU1QVFkgdG8gaW5kaWNhdGUgdGhlcmUgaXMgbm8gb3ZlcmxheSBmb3IgdGhlIGRvY3VtZW50LlxuICAgICAgICAgICAgci5zZXQoZS5rZXksIEplLmVtcHR5KCkpO1xuICAgICAgICB9KSksIHRoaXMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXModCwgaSkubmV4dCgodCA9PiAodC5mb3JFYWNoKCgodCwgZSkgPT4gci5zZXQodCwgZSkpKSwgXG4gICAgICAgIGUuZm9yRWFjaCgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIHZhciBuO1xuICAgICAgICAgICAgcmV0dXJuIG8uc2V0KHQsIG5ldyB5byhlLCBudWxsICE9PSAobiA9IHIuZ2V0KHQpKSAmJiB2b2lkIDAgIT09IG4gPyBuIDogbnVsbCkpO1xuICAgICAgICB9KSksIG8pKSk7XG4gICAgfVxuICAgIHJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHBzKCk7XG4gICAgICAgIC8vIEEgcmV2ZXJzZSBsb29rdXAgbWFwIGZyb20gYmF0Y2ggaWQgdG8gdGhlIGRvY3VtZW50cyB3aXRoaW4gdGhhdCBiYXRjaC5cbiAgICAgICAgICAgICAgICBsZXQgcyA9IG5ldyBHZSgoKHQsIGUpID0+IHQgLSBlKSksIGkgPSBFcygpO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ0RvY3VtZW50S2V5cyh0LCBlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiB0KSBpLmtleXMoKS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gZS5nZXQodCk7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IHIpIHJldHVybjtcbiAgICAgICAgICAgICAgICBsZXQgbyA9IG4uZ2V0KHQpIHx8IEplLmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgbyA9IGkuYXBwbHlUb0xvY2FsVmlldyhyLCBvKSwgbi5zZXQodCwgbyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdSA9IChzLmdldChpLmJhdGNoSWQpIHx8IEVzKCkpLmFkZCh0KTtcbiAgICAgICAgICAgICAgICBzID0gcy5pbnNlcnQoaS5iYXRjaElkLCB1KTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBbXSwgbyA9IHMuZ2V0UmV2ZXJzZUl0ZXJhdG9yKCk7XG4gICAgICAgICAgICAvLyBJdGVyYXRlIGluIGRlc2NlbmRpbmcgb3JkZXIgb2YgYmF0Y2ggSURzLCBhbmQgc2tpcCBkb2N1bWVudHMgdGhhdCBhcmVcbiAgICAgICAgICAgIC8vIGFscmVhZHkgc2F2ZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDtvLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG8uZ2V0TmV4dCgpLCB1ID0gcy5rZXksIGMgPSBzLnZhbHVlLCBhID0geXMoKTtcbiAgICAgICAgICAgICAgICBjLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWkuaGFzKHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gem4oZS5nZXQodCksIG4uZ2V0KHQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT09IHMgJiYgYS5zZXQodCwgcyksIGkgPSBpLmFkZCh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pKSwgci5wdXNoKHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuc2F2ZU92ZXJsYXlzKHQsIHUsIGEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBBdC53YWl0Rm9yKHIpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWNhbGN1bGF0ZXMgb3ZlcmxheXMgYnkgcmVhZGluZyB0aGUgZG9jdW1lbnRzIGZyb20gcmVtb3RlIGRvY3VtZW50IGNhY2hlXG4gICAgICogZmlyc3QsIGFuZCBzYXZlcyB0aGVtIGFmdGVyIHRoZXkgYXJlIGNhbGN1bGF0ZWQuXG4gICAgICovICAgIHJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzRm9yRG9jdW1lbnRLZXlzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyaWVzKHQsIGUpLm5leHQoKGUgPT4gdGhpcy5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5cyh0LCBlKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHZpZXcgb2YgYWxsIGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSBwZXJzaXN0ZW5jZSB0cmFuc2FjdGlvbi5cbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgdG8gbWF0Y2ggZG9jdW1lbnRzIGFnYWluc3QuXG4gICAgICogQHBhcmFtIG9mZnNldCAtIFJlYWQgdGltZSBhbmQga2V5IHRvIHN0YXJ0IHNjYW5uaW5nIGJ5IChleGNsdXNpdmUpLlxuICAgICAqLyAgICBnZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KHQsIGUsIG4pIHtcbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHF1ZXJ5IG1hdGNoZXMgYSBzaW5nbGUgZG9jdW1lbnQgYnkgcGF0aCAocmF0aGVyIHRoYW4gYVxuICogY29sbGVjdGlvbikuXG4gKi9cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBjdC5pc0RvY3VtZW50S2V5KHQucGF0aCkgJiYgbnVsbCA9PT0gdC5jb2xsZWN0aW9uR3JvdXAgJiYgMCA9PT0gdC5maWx0ZXJzLmxlbmd0aDtcbiAgICAgICAgfShlKSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdEb2N1bWVudFF1ZXJ5KHQsIGUucGF0aCkgOiB3bihlKSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uR3JvdXBRdWVyeSh0LCBlLCBuKSA6IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkodCwgZSwgbik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGEgY29sbGVjdGlvbiBncm91cCwgcmV0dXJucyB0aGUgbmV4dCBkb2N1bWVudHMgdGhhdCBmb2xsb3cgdGhlIHByb3ZpZGVkIG9mZnNldCwgYWxvbmdcbiAgICAgKiB3aXRoIGFuIHVwZGF0ZWQgYmF0Y2ggSUQuXG4gICAgICpcbiAgICAgKiA8cD5UaGUgZG9jdW1lbnRzIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kIGFyZSBvcmRlcmVkIGJ5IHJlbW90ZSB2ZXJzaW9uIGZyb20gdGhlIHByb3ZpZGVkXG4gICAgICogb2Zmc2V0LiBJZiB0aGVyZSBhcmUgbm8gbW9yZSByZW1vdGUgZG9jdW1lbnRzIGFmdGVyIHRoZSBwcm92aWRlZCBvZmZzZXQsIGRvY3VtZW50cyB3aXRoXG4gICAgICogbXV0YXRpb25zIGluIG9yZGVyIG9mIGJhdGNoIGlkIGZyb20gdGhlIG9mZnNldCBhcmUgcmV0dXJuZWQuIFNpbmNlIGFsbCBkb2N1bWVudHMgaW4gYSBiYXRjaCBhcmVcbiAgICAgKiByZXR1cm5lZCB0b2dldGhlciwgdGhlIHRvdGFsIG51bWJlciBvZiBkb2N1bWVudHMgcmV0dXJuZWQgY2FuIGV4Y2VlZCB7QGNvZGUgY291bnR9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIGNvbGxlY3Rpb25Hcm91cCBUaGUgY29sbGVjdGlvbiBncm91cCBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb2Zmc2V0IFRoZSBvZmZzZXQgdG8gaW5kZXggaW50by5cbiAgICAgKiBAcGFyYW0gY291bnQgVGhlIG51bWJlciBvZiBkb2N1bWVudHMgdG8gcmV0dXJuXG4gICAgICogQHJldHVybiBBIExvY2FsV3JpdGVSZXN1bHQgd2l0aCB0aGUgZG9jdW1lbnRzIHRoYXQgZm9sbG93IHRoZSBwcm92aWRlZCBvZmZzZXQgYW5kIHRoZSBsYXN0IHByb2Nlc3NlZCBiYXRjaCBpZC5cbiAgICAgKi8gICAgZ2V0TmV4dERvY3VtZW50cyh0LCBlLCBuLCBzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuLCBzKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBzIC0gaS5zaXplID4gMCA/IHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAodCwgZSwgbi5sYXJnZXN0QmF0Y2hJZCwgcyAtIGkuc2l6ZSkgOiBBdC5yZXNvbHZlKGdzKCkpO1xuICAgICAgICAgICAgLy8gVGhlIGNhbGxzaXRlIHdpbGwgdXNlIHRoZSBsYXJnZXN0IGJhdGNoIElEIHRvZ2V0aGVyIHdpdGggdGhlIGxhdGVzdCByZWFkIHRpbWUgdG8gY3JlYXRlXG4gICAgICAgICAgICAvLyBhIG5ldyBpbmRleCBvZmZzZXQuIFNpbmNlIHdlIG9ubHkgcHJvY2VzcyBiYXRjaCBJRHMgaWYgYWxsIHJlbW90ZSBkb2N1bWVudHMgaGF2ZSBiZWVuIHJlYWQsXG4gICAgICAgICAgICAvLyBubyBvdmVybGF5IHdpbGwgaW5jcmVhc2UgdGhlIG92ZXJhbGwgcmVhZCB0aW1lLiBUaGlzIGlzIHdoeSB3ZSBvbmx5IG5lZWQgdG8gc3BlY2lhbCBjYXNlXG4gICAgICAgICAgICAvLyB0aGUgYmF0Y2ggaWQuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbyA9IC0xLCB1ID0gaTtcbiAgICAgICAgICAgIHJldHVybiByLm5leHQoKGUgPT4gQXQuZm9yRWFjaChlLCAoKGUsIG4pID0+IChvIDwgbi5sYXJnZXN0QmF0Y2hJZCAmJiAobyA9IG4ubGFyZ2VzdEJhdGNoSWQpLCBcbiAgICAgICAgICAgIGkuZ2V0KGUpID8gQXQucmVzb2x2ZSgpIDogdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJ5KHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgIHUgPSB1Lmluc2VydChlLCB0KTtcbiAgICAgICAgICAgIH0pKSkpKS5uZXh0KCgoKSA9PiB0aGlzLnBvcHVsYXRlT3ZlcmxheXModCwgZSwgaSkpKS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyh0LCB1LCBlLCBFcygpKSkpLm5leHQoKHQgPT4gKHtcbiAgICAgICAgICAgICAgICBiYXRjaElkOiBvLFxuICAgICAgICAgICAgICAgIGNoYW5nZXM6IG1zKHQpXG4gICAgICAgICAgICB9KSkpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdEb2N1bWVudFF1ZXJ5KHQsIGUpIHtcbiAgICAgICAgLy8gSnVzdCBkbyBhIHNpbXBsZSBkb2N1bWVudCBsb29rdXAuXG4gICAgICAgIHJldHVybiB0aGlzLmdldERvY3VtZW50KHQsIG5ldyBjdChlKSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBsZXQgZSA9IHdzKCk7XG4gICAgICAgICAgICByZXR1cm4gdC5pc0ZvdW5kRG9jdW1lbnQoKSAmJiAoZSA9IGUuaW5zZXJ0KHQua2V5LCB0KSksIGU7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uR3JvdXBRdWVyeSh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBlLmNvbGxlY3Rpb25Hcm91cDtcbiAgICAgICAgbGV0IGkgPSB3cygpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE1hbmFnZXIuZ2V0Q29sbGVjdGlvblBhcmVudHModCwgcykubmV4dCgociA9PiBBdC5mb3JFYWNoKHIsIChyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBhbihlLCBcbiAgICAgICAgICAgICAgICAvKmNvbGxlY3Rpb25Hcm91cD0qLyBudWxsLCB0LmV4cGxpY2l0T3JkZXJCeS5zbGljZSgpLCB0LmZpbHRlcnMuc2xpY2UoKSwgdC5saW1pdCwgdC5saW1pdFR5cGUsIHQuc3RhcnRBdCwgdC5lbmRBdCk7XG4gICAgICAgICAgICB9KGUsIHIuY2hpbGQocykpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkodCwgbywgbikubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgdC5mb3JFYWNoKCgodCwgZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpID0gaS5pbnNlcnQodCwgZSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpKSk7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nQ29sbGVjdGlvblF1ZXJ5KHQsIGUsIG4pIHtcbiAgICAgICAgLy8gUXVlcnkgdGhlIHJlbW90ZSBkb2N1bWVudHMgYW5kIG92ZXJsYXkgbXV0YXRpb25zLlxuICAgICAgICBsZXQgcztcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRBbGxGcm9tQ29sbGVjdGlvbih0LCBlLnBhdGgsIG4pLm5leHQoKGkgPT4gKHMgPSBpLCBcbiAgICAgICAgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5nZXRPdmVybGF5c0ZvckNvbGxlY3Rpb24odCwgZS5wYXRoLCBuLmxhcmdlc3RCYXRjaElkKSkpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIC8vIEFzIGRvY3VtZW50cyBtaWdodCBtYXRjaCB0aGUgcXVlcnkgYmVjYXVzZSBvZiB0aGVpciBvdmVybGF5IHdlIG5lZWQgdG9cbiAgICAgICAgICAgIC8vIGluY2x1ZGUgZG9jdW1lbnRzIGZvciBhbGwgb3ZlcmxheXMgaW4gdGhlIGluaXRpYWwgZG9jdW1lbnQgc2V0LlxuICAgICAgICAgICAgdC5mb3JFYWNoKCgodCwgZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLmdldEtleSgpO1xuICAgICAgICAgICAgICAgIG51bGwgPT09IHMuZ2V0KG4pICYmIChzID0gcy5pbnNlcnQobiwgWmUubmV3SW52YWxpZERvY3VtZW50KG4pKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAvLyBBcHBseSB0aGUgb3ZlcmxheXMgYW5kIG1hdGNoIGFnYWluc3QgdGhlIHF1ZXJ5LlxuICAgICAgICAgICAgbGV0IG4gPSB3cygpO1xuICAgICAgICAgICAgcmV0dXJuIHMuZm9yRWFjaCgoKHMsIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gdC5nZXQocyk7XG4gICAgICAgICAgICAgICAgdm9pZCAwICE9PSByICYmIEpuKHIubXV0YXRpb24sIGksIEplLmVtcHR5KCksIG50Lm5vdygpKSwgXG4gICAgICAgICAgICAgICAgLy8gRmluYWxseSwgaW5zZXJ0IHRoZSBkb2N1bWVudHMgdGhhdCBzdGlsbCBtYXRjaCB0aGUgcXVlcnlcbiAgICAgICAgICAgICAgICBBbihlLCBpKSAmJiAobiA9IG4uaW5zZXJ0KHMsIGkpKTtcbiAgICAgICAgICAgIH0pKSwgbjtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgSW8ge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy55dCA9IHQsIHRoaXMuWm4gPSBuZXcgTWFwLCB0aGlzLnRzID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0QnVuZGxlTWV0YWRhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh0aGlzLlpuLmdldChlKSk7XG4gICAgfVxuICAgIHNhdmVCdW5kbGVNZXRhZGF0YSh0LCBlKSB7XG4gICAgICAgIC8qKiBEZWNvZGVzIGEgQnVuZGxlTWV0YWRhdGEgcHJvdG8gaW50byBhIEJ1bmRsZU1ldGFkYXRhIG9iamVjdC4gKi9cbiAgICAgICAgdmFyIG47XG4gICAgICAgIHJldHVybiB0aGlzLlpuLnNldChlLmlkLCB7XG4gICAgICAgICAgICBpZDogKG4gPSBlKS5pZCxcbiAgICAgICAgICAgIHZlcnNpb246IG4udmVyc2lvbixcbiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IHFzKG4uY3JlYXRlVGltZSlcbiAgICAgICAgfSksIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TmFtZWRRdWVyeSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHRoaXMudHMuZ2V0KGUpKTtcbiAgICB9XG4gICAgc2F2ZU5hbWVkUXVlcnkodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy50cy5zZXQoZS5uYW1lLCBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHQubmFtZSxcbiAgICAgICAgICAgICAgICBxdWVyeTogaXIodC5idW5kbGVkUXVlcnkpLFxuICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBxcyh0LnJlYWRUaW1lKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfShlKSksIEF0LnJlc29sdmUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBpbXBsZW1lbnRhdGlvbiBvZiBEb2N1bWVudE92ZXJsYXlDYWNoZS5cbiAqLyBjbGFzcyBUbyB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIEEgbWFwIHNvcnRlZCBieSBEb2N1bWVudEtleSwgd2hvc2UgdmFsdWUgaXMgYSBwYWlyIG9mIHRoZSBsYXJnZXN0IGJhdGNoIGlkXG4gICAgICAgIC8vIGZvciB0aGUgb3ZlcmxheSBhbmQgdGhlIG92ZXJsYXkgaXRzZWxmLlxuICAgICAgICB0aGlzLm92ZXJsYXlzID0gbmV3IEdlKGN0LmNvbXBhcmF0b3IpLCB0aGlzLmVzID0gbmV3IE1hcDtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHRoaXMub3ZlcmxheXMuZ2V0KGUpKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXModCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZ3MoKTtcbiAgICAgICAgcmV0dXJuIEF0LmZvckVhY2goZSwgKGUgPT4gdGhpcy5nZXRPdmVybGF5KHQsIGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgbnVsbCAhPT0gdCAmJiBuLnNldChlLCB0KTtcbiAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBzYXZlT3ZlcmxheXModCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbi5mb3JFYWNoKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgdGhpcy5vZSh0LCBlLCBzKTtcbiAgICAgICAgfSkpLCBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZCh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0aGlzLmVzLmdldChuKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gcyAmJiAocy5mb3JFYWNoKCh0ID0+IHRoaXMub3ZlcmxheXMgPSB0aGlzLm92ZXJsYXlzLnJlbW92ZSh0KSkpLCBcbiAgICAgICAgdGhpcy5lcy5kZWxldGUobikpLCBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBncygpLCBpID0gZS5sZW5ndGggKyAxLCByID0gbmV3IGN0KGUuY2hpbGQoXCJcIikpLCBvID0gdGhpcy5vdmVybGF5cy5nZXRJdGVyYXRvckZyb20ocik7XG4gICAgICAgIGZvciAoO28uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBvLmdldE5leHQoKS52YWx1ZSwgciA9IHQuZ2V0S2V5KCk7XG4gICAgICAgICAgICBpZiAoIWUuaXNQcmVmaXhPZihyLnBhdGgpKSBicmVhaztcbiAgICAgICAgICAgIC8vIERvY3VtZW50cyBmcm9tIHN1Yi1jb2xsZWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgci5wYXRoLmxlbmd0aCA9PT0gaSAmJiAodC5sYXJnZXN0QmF0Y2hJZCA+IG4gJiYgcy5zZXQodC5nZXRLZXkoKSwgdCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHMpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5c0ZvckNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGxldCBpID0gbmV3IEdlKCgodCwgZSkgPT4gdCAtIGUpKTtcbiAgICAgICAgY29uc3QgciA9IHRoaXMub3ZlcmxheXMuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7ci5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHIuZ2V0TmV4dCgpLnZhbHVlO1xuICAgICAgICAgICAgaWYgKHQuZ2V0S2V5KCkuZ2V0Q29sbGVjdGlvbkdyb3VwKCkgPT09IGUgJiYgdC5sYXJnZXN0QmF0Y2hJZCA+IG4pIHtcbiAgICAgICAgICAgICAgICBsZXQgZSA9IGkuZ2V0KHQubGFyZ2VzdEJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIG51bGwgPT09IGUgJiYgKGUgPSBncygpLCBpID0gaS5pbnNlcnQodC5sYXJnZXN0QmF0Y2hJZCwgZSkpLCBlLnNldCh0LmdldEtleSgpLCB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvID0gZ3MoKSwgdSA9IGkuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgZm9yICg7dS5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgaWYgKHUuZ2V0TmV4dCgpLnZhbHVlLmZvckVhY2goKCh0LCBlKSA9PiBvLnNldCh0LCBlKSkpLCBvLnNpemUoKSA+PSBzKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZShvKTtcbiAgICB9XG4gICAgb2UodCwgZSwgbikge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIGFzc29jaWF0aW9uIG9mIHRoZSBvdmVybGF5IHRvIGl0cyBiYXRjaCBpZC5cbiAgICAgICAgY29uc3QgcyA9IHRoaXMub3ZlcmxheXMuZ2V0KG4ua2V5KTtcbiAgICAgICAgaWYgKG51bGwgIT09IHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLmVzLmdldChzLmxhcmdlc3RCYXRjaElkKS5kZWxldGUobi5rZXkpO1xuICAgICAgICAgICAgdGhpcy5lcy5zZXQocy5sYXJnZXN0QmF0Y2hJZCwgdCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vdmVybGF5cyA9IHRoaXMub3ZlcmxheXMuaW5zZXJ0KG4ua2V5LCBuZXcgV2koZSwgbikpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGFzc29jaWF0aW9uIG9mIHRoaXMgb3ZlcmxheSB0byB0aGUgZ2l2ZW4gbGFyZ2VzdEJhdGNoSWQuXG4gICAgICAgIGxldCBpID0gdGhpcy5lcy5nZXQoZSk7XG4gICAgICAgIHZvaWQgMCA9PT0gaSAmJiAoaSA9IEVzKCksIHRoaXMuZXMuc2V0KGUsIGkpKSwgdGhpcy5lcy5zZXQoZSwgaS5hZGQobi5rZXkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgY29sbGVjdGlvbiBvZiByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgZnJvbSBzb21lIGtpbmQgb2YgbnVtYmVyZWQgZW50aXR5XG4gKiAoZWl0aGVyIGEgdGFyZ2V0IElEIG9yIGJhdGNoIElEKS4gQXMgcmVmZXJlbmNlcyBhcmUgYWRkZWQgdG8gb3IgcmVtb3ZlZCBmcm9tXG4gKiB0aGUgc2V0IGNvcnJlc3BvbmRpbmcgZXZlbnRzIGFyZSBlbWl0dGVkIHRvIGEgcmVnaXN0ZXJlZCBnYXJiYWdlIGNvbGxlY3Rvci5cbiAqXG4gKiBFYWNoIHJlZmVyZW5jZSBpcyByZXByZXNlbnRlZCBieSBhIERvY3VtZW50UmVmZXJlbmNlIG9iamVjdC4gRWFjaCBvZiB0aGVtXG4gKiBjb250YWlucyBlbm91Z2ggaW5mb3JtYXRpb24gdG8gdW5pcXVlbHkgaWRlbnRpZnkgdGhlIHJlZmVyZW5jZS4gVGhleSBhcmUgYWxsXG4gKiBzdG9yZWQgcHJpbWFyaWx5IGluIGEgc2V0IHNvcnRlZCBieSBrZXkuIEEgZG9jdW1lbnQgaXMgY29uc2lkZXJlZCBnYXJiYWdlIGlmXG4gKiB0aGVyZSdzIG5vIHJlZmVyZW5jZXMgaW4gdGhhdCBzZXQgKHRoaXMgY2FuIGJlIGVmZmljaWVudGx5IGNoZWNrZWQgdGhhbmtzIHRvXG4gKiBzb3J0aW5nIGJ5IGtleSkuXG4gKlxuICogUmVmZXJlbmNlU2V0IGFsc28ga2VlcHMgYSBzZWNvbmRhcnkgc2V0IHRoYXQgY29udGFpbnMgcmVmZXJlbmNlcyBzb3J0ZWQgYnlcbiAqIElEcy4gVGhpcyBvbmUgaXMgdXNlZCB0byBlZmZpY2llbnRseSBpbXBsZW1lbnQgcmVtb3ZhbCBvZiBhbGwgcmVmZXJlbmNlcyBieVxuICogc29tZSB0YXJnZXQgSUQuXG4gKi8gY2xhc3MgRW8ge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IGtleS5cbiAgICAgICAgdGhpcy5ucyA9IG5ldyBXZShBby5zcyksIFxuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IHRhcmdldCBpZC5cbiAgICAgICAgdGhpcy5ycyA9IG5ldyBXZShBby5vcyk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZSBzZXQgY29udGFpbnMgbm8gcmVmZXJlbmNlcy4gKi8gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubnMuaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKiogQWRkcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW4gSUQuICovICAgIGFkZFJlZmVyZW5jZSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgQW8odCwgZSk7XG4gICAgICAgIHRoaXMubnMgPSB0aGlzLm5zLmFkZChuKSwgdGhpcy5ycyA9IHRoaXMucnMuYWRkKG4pO1xuICAgIH1cbiAgICAvKiogQWRkIHJlZmVyZW5jZXMgdG8gdGhlIGdpdmVuIGRvY3VtZW50IGtleXMgZm9yIHRoZSBnaXZlbiBJRC4gKi8gICAgdXModCwgZSkge1xuICAgICAgICB0LmZvckVhY2goKHQgPT4gdGhpcy5hZGRSZWZlcmVuY2UodCwgZSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW5cbiAgICAgKiBJRC5cbiAgICAgKi8gICAgcmVtb3ZlUmVmZXJlbmNlKHQsIGUpIHtcbiAgICAgICAgdGhpcy5jcyhuZXcgQW8odCwgZSkpO1xuICAgIH1cbiAgICBocyh0LCBlKSB7XG4gICAgICAgIHQuZm9yRWFjaCgodCA9PiB0aGlzLnJlbW92ZVJlZmVyZW5jZSh0LCBlKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbGVhcnMgYWxsIHJlZmVyZW5jZXMgd2l0aCBhIGdpdmVuIElELiBDYWxscyByZW1vdmVSZWYoKSBmb3IgZWFjaCBrZXlcbiAgICAgKiByZW1vdmVkLlxuICAgICAqLyAgICBscyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgY3QobmV3IHJ0KFtdKSksIG4gPSBuZXcgQW8oZSwgdCksIHMgPSBuZXcgQW8oZSwgdCArIDEpLCBpID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLnJzLmZvckVhY2hJblJhbmdlKFsgbiwgcyBdLCAodCA9PiB7XG4gICAgICAgICAgICB0aGlzLmNzKHQpLCBpLnB1c2godC5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIGZzKCkge1xuICAgICAgICB0aGlzLm5zLmZvckVhY2goKHQgPT4gdGhpcy5jcyh0KSkpO1xuICAgIH1cbiAgICBjcyh0KSB7XG4gICAgICAgIHRoaXMubnMgPSB0aGlzLm5zLmRlbGV0ZSh0KSwgdGhpcy5ycyA9IHRoaXMucnMuZGVsZXRlKHQpO1xuICAgIH1cbiAgICBkcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgY3QobmV3IHJ0KFtdKSksIG4gPSBuZXcgQW8oZSwgdCksIHMgPSBuZXcgQW8oZSwgdCArIDEpO1xuICAgICAgICBsZXQgaSA9IEVzKCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJzLmZvckVhY2hJblJhbmdlKFsgbiwgcyBdLCAodCA9PiB7XG4gICAgICAgICAgICBpID0gaS5hZGQodC5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBBbyh0LCAwKSwgbiA9IHRoaXMubnMuZmlyc3RBZnRlck9yRXF1YWwoZSk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBuICYmIHQuaXNFcXVhbChuLmtleSk7XG4gICAgfVxufVxuXG5jbGFzcyBBbyB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmtleSA9IHQsIHRoaXMuX3MgPSBlO1xuICAgIH1cbiAgICAvKiogQ29tcGFyZSBieSBrZXkgdGhlbiBieSBJRCAqLyAgICBzdGF0aWMgc3ModCwgZSkge1xuICAgICAgICByZXR1cm4gY3QuY29tcGFyYXRvcih0LmtleSwgZS5rZXkpIHx8IFoodC5fcywgZS5fcyk7XG4gICAgfVxuICAgIC8qKiBDb21wYXJlIGJ5IElEIHRoZW4gYnkga2V5ICovICAgIHN0YXRpYyBvcyh0LCBlKSB7XG4gICAgICAgIHJldHVybiBaKHQuX3MsIGUuX3MpIHx8IGN0LmNvbXBhcmF0b3IodC5rZXksIGUua2V5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIFJvIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gdCwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNldCBvZiBhbGwgbXV0YXRpb25zIHRoYXQgaGF2ZSBiZWVuIHNlbnQgYnV0IG5vdCB5ZXQgYmVlbiBhcHBsaWVkIHRvXG4gICAgICAgICAqIHRoZSBiYWNrZW5kLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tdXRhdGlvblF1ZXVlID0gW10sIFxuICAgICAgICAvKiogTmV4dCB2YWx1ZSB0byB1c2Ugd2hlbiBhc3NpZ25pbmcgc2VxdWVudGlhbCBJRHMgdG8gZWFjaCBtdXRhdGlvbiBiYXRjaC4gKi9cbiAgICAgICAgdGhpcy53cyA9IDEsIFxuICAgICAgICAvKiogQW4gb3JkZXJlZCBtYXBwaW5nIGJldHdlZW4gZG9jdW1lbnRzIGFuZCB0aGUgbXV0YXRpb25zIGJhdGNoIElEcy4gKi9cbiAgICAgICAgdGhpcy5ncyA9IG5ldyBXZShBby5zcyk7XG4gICAgfVxuICAgIGNoZWNrRW1wdHkodCkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSgwID09PSB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoKTtcbiAgICB9XG4gICAgYWRkTXV0YXRpb25CYXRjaCh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGNvbnN0IGkgPSB0aGlzLndzO1xuICAgICAgICB0aGlzLndzKyssIHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGggPiAwICYmIHRoaXMubXV0YXRpb25RdWV1ZVt0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoIC0gMV07XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgUWkoaSwgZSwgbiwgcyk7XG4gICAgICAgIHRoaXMubXV0YXRpb25RdWV1ZS5wdXNoKHIpO1xuICAgICAgICAvLyBUcmFjayByZWZlcmVuY2VzIGJ5IGRvY3VtZW50IGtleSBhbmQgaW5kZXggY29sbGVjdGlvbiBwYXJlbnRzLlxuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgcykgdGhpcy5ncyA9IHRoaXMuZ3MuYWRkKG5ldyBBbyhlLmtleSwgaSkpLCB0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleCh0LCBlLmtleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHIpO1xuICAgIH1cbiAgICBsb29rdXBNdXRhdGlvbkJhdGNoKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIEF0LnJlc29sdmUodGhpcy55cyhlKSk7XG4gICAgfVxuICAgIGdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUgKyAxLCBzID0gdGhpcy5wcyhuKSwgaSA9IHMgPCAwID8gMCA6IHM7XG4gICAgICAgIC8vIFRoZSByZXF1ZXN0ZWQgYmF0Y2hJZCBtYXkgc3RpbGwgYmUgb3V0IG9mIHJhbmdlIHNvIG5vcm1hbGl6ZSBpdCB0byB0aGVcbiAgICAgICAgLy8gc3RhcnQgb2YgdGhlIHF1ZXVlLlxuICAgICAgICAgICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGggPiBpID8gdGhpcy5tdXRhdGlvblF1ZXVlW2ldIDogbnVsbCk7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQoKSB7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKDAgPT09IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGggPyAtMSA6IHRoaXMud3MgLSAxKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzKHQpIHtcbiAgICAgICAgcmV0dXJuIEF0LnJlc29sdmUodGhpcy5tdXRhdGlvblF1ZXVlLnNsaWNlKCkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdEb2N1bWVudEtleSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgQW8oZSwgMCksIHMgPSBuZXcgQW8oZSwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5ncy5mb3JFYWNoSW5SYW5nZShbIG4sIHMgXSwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMueXModC5fcyk7XG4gICAgICAgICAgICBpLnB1c2goZSk7XG4gICAgICAgIH0pKSwgQXQucmVzb2x2ZShpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgV2UoWik7XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBBbyh0LCAwKSwgcyA9IG5ldyBBbyh0LCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO1xuICAgICAgICAgICAgdGhpcy5ncy5mb3JFYWNoSW5SYW5nZShbIGUsIHMgXSwgKHQgPT4ge1xuICAgICAgICAgICAgICAgIG4gPSBuLmFkZCh0Ll9zKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLCBBdC5yZXNvbHZlKHRoaXMuSXMobikpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdRdWVyeSh0LCBlKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgcXVlcnkgcGF0aCBhcyBhIHByZWZpeCBmb3IgdGVzdGluZyBpZiBhIGRvY3VtZW50IG1hdGNoZXMgdGhlXG4gICAgICAgIC8vIHF1ZXJ5LlxuICAgICAgICBjb25zdCBuID0gZS5wYXRoLCBzID0gbi5sZW5ndGggKyAxO1xuICAgICAgICAvLyBDb25zdHJ1Y3QgYSBkb2N1bWVudCByZWZlcmVuY2UgZm9yIGFjdHVhbGx5IHNjYW5uaW5nIHRoZSBpbmRleC4gVW5saWtlXG4gICAgICAgIC8vIHRoZSBwcmVmaXggdGhlIGRvY3VtZW50IGtleSBpbiB0aGlzIHJlZmVyZW5jZSBtdXN0IGhhdmUgYW4gZXZlbiBudW1iZXIgb2ZcbiAgICAgICAgLy8gc2VnbWVudHMuIFRoZSBlbXB0eSBzZWdtZW50IGNhbiBiZSB1c2VkIGEgc3VmZml4IG9mIHRoZSBxdWVyeSBwYXRoXG4gICAgICAgIC8vIGJlY2F1c2UgaXQgcHJlY2VkZXMgYWxsIG90aGVyIHNlZ21lbnRzIGluIGFuIG9yZGVyZWQgdHJhdmVyc2FsLlxuICAgICAgICBsZXQgaSA9IG47XG4gICAgICAgIGN0LmlzRG9jdW1lbnRLZXkoaSkgfHwgKGkgPSBpLmNoaWxkKFwiXCIpKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBBbyhuZXcgY3QoaSksIDApO1xuICAgICAgICAvLyBGaW5kIHVuaXF1ZSBiYXRjaElEcyByZWZlcmVuY2VkIGJ5IGFsbCBkb2N1bWVudHMgcG90ZW50aWFsbHkgbWF0Y2hpbmcgdGhlXG4gICAgICAgIC8vIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIGxldCBvID0gbmV3IFdlKFopO1xuICAgICAgICByZXR1cm4gdGhpcy5ncy5mb3JFYWNoV2hpbGUoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQua2V5LnBhdGg7XG4gICAgICAgICAgICByZXR1cm4gISFuLmlzUHJlZml4T2YoZSkgJiYgKFxuICAgICAgICAgICAgLy8gUm93cyB3aXRoIGRvY3VtZW50IGtleXMgbW9yZSB0aGFuIG9uZSBzZWdtZW50IGxvbmdlciB0aGFuIHRoZSBxdWVyeVxuICAgICAgICAgICAgLy8gcGF0aCBjYW4ndCBiZSBtYXRjaGVzLiBGb3IgZXhhbXBsZSwgYSBxdWVyeSBvbiAncm9vbXMnIGNhbid0IG1hdGNoXG4gICAgICAgICAgICAvLyB0aGUgZG9jdW1lbnQgL3Jvb21zL2FiYy9tZXNzYWdlcy94eXguXG4gICAgICAgICAgICAvLyBUT0RPKG1jZyk6IHdlJ2xsIG5lZWQgYSBkaWZmZXJlbnQgc2Nhbm5lciB3aGVuIHdlIGltcGxlbWVudFxuICAgICAgICAgICAgLy8gYW5jZXN0b3IgcXVlcmllcy5cbiAgICAgICAgICAgIGUubGVuZ3RoID09PSBzICYmIChvID0gby5hZGQodC5fcykpLCAhMCk7XG4gICAgICAgIH0pLCByKSwgQXQucmVzb2x2ZSh0aGlzLklzKG8pKTtcbiAgICB9XG4gICAgSXModCkge1xuICAgICAgICAvLyBDb25zdHJ1Y3QgYW4gYXJyYXkgb2YgbWF0Y2hpbmcgYmF0Y2hlcywgc29ydGVkIGJ5IGJhdGNoSUQgdG8gZW5zdXJlIHRoYXRcbiAgICAgICAgLy8gbXVsdGlwbGUgbXV0YXRpb25zIGFmZmVjdGluZyB0aGUgc2FtZSBkb2N1bWVudCBrZXkgYXJlIGFwcGxpZWQgaW4gb3JkZXIuXG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy55cyh0KTtcbiAgICAgICAgICAgIG51bGwgIT09IG4gJiYgZS5wdXNoKG4pO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxuICAgIHJlbW92ZU11dGF0aW9uQmF0Y2godCwgZSkge1xuICAgICAgICBNKDAgPT09IHRoaXMuVHMoZS5iYXRjaElkLCBcInJlbW92ZWRcIikpLCB0aGlzLm11dGF0aW9uUXVldWUuc2hpZnQoKTtcbiAgICAgICAgbGV0IG4gPSB0aGlzLmdzO1xuICAgICAgICByZXR1cm4gQXQuZm9yRWFjaChlLm11dGF0aW9ucywgKHMgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBBbyhzLmtleSwgZS5iYXRjaElkKTtcbiAgICAgICAgICAgIHJldHVybiBuID0gbi5kZWxldGUoaSksIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQodCwgcy5rZXkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5ncyA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgQW4odCkge1xuICAgICAgICAvLyBOby1vcCBzaW5jZSB0aGUgbWVtb3J5IG11dGF0aW9uIHF1ZXVlIGRvZXMgbm90IG1haW50YWluIGEgc2VwYXJhdGUgY2FjaGUuXG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBBbyhlLCAwKSwgcyA9IHRoaXMuZ3MuZmlyc3RBZnRlck9yRXF1YWwobik7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKGUuaXNFcXVhbChzICYmIHMua2V5KSk7XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgsIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmluZHMgdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBiYXRjaElkIGluIHRoZSBtdXRhdGlvbiBxdWV1ZSBhbmQgYXNzZXJ0cyB0aGF0XG4gICAgICogdGhlIHJlc3VsdGluZyBpbmRleCBpcyB3aXRoaW4gdGhlIGJvdW5kcyBvZiB0aGUgcXVldWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmF0Y2hJZCAtIFRoZSBiYXRjaElkIHRvIHNlYXJjaCBmb3JcbiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQSBkZXNjcmlwdGlvbiBvZiB3aGF0IHRoZSBjYWxsZXIgaXMgZG9pbmcsIHBocmFzZWQgaW4gcGFzc2l2ZVxuICAgICAqIGZvcm0gKGUuZy4gXCJhY2tub3dsZWRnZWRcIiBpbiBhIHJvdXRpbmUgdGhhdCBhY2tub3dsZWRnZXMgYmF0Y2hlcykuXG4gICAgICovICAgIFRzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHModCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gYmF0Y2hJZCBpbiB0aGUgbXV0YXRpb24gcXVldWUuIFRoaXMgb3BlcmF0aW9uXG4gICAgICogaXMgTygxKS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBjb21wdXRlZCBpbmRleCBvZiB0aGUgYmF0Y2ggd2l0aCB0aGUgZ2l2ZW4gYmF0Y2hJZCwgYmFzZWQgb25cbiAgICAgKiB0aGUgc3RhdGUgb2YgdGhlIHF1ZXVlLiBOb3RlIHRoaXMgaW5kZXggY2FuIGJlIG5lZ2F0aXZlIGlmIHRoZSByZXF1ZXN0ZWRcbiAgICAgKiBiYXRjaElkIGhhcyBhbHJlYWR5IGJlZW4gcmVtdm9lZCBmcm9tIHRoZSBxdWV1ZSBvciBwYXN0IHRoZSBlbmQgb2YgdGhlXG4gICAgICogcXVldWUgaWYgdGhlIGJhdGNoSWQgaXMgbGFyZ2VyIHRoYW4gdGhlIGxhc3QgYWRkZWQgYmF0Y2guXG4gICAgICovICAgIHBzKHQpIHtcbiAgICAgICAgaWYgKDAgPT09IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgpIFxuICAgICAgICAvLyBBcyBhbiBpbmRleCB0aGlzIGlzIHBhc3QgdGhlIGVuZCBvZiB0aGUgcXVldWVcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIC8vIEV4YW1pbmUgdGhlIGZyb250IG9mIHRoZSBxdWV1ZSB0byBmaWd1cmUgb3V0IHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gdGhlXG4gICAgICAgIC8vIGJhdGNoSWQgYW5kIGluZGV4ZXMgaW4gdGhlIGFycmF5LiBOb3RlIHRoYXQgc2luY2UgdGhlIHF1ZXVlIGlzIG9yZGVyZWRcbiAgICAgICAgLy8gYnkgYmF0Y2hJZCwgaWYgdGhlIGZpcnN0IGJhdGNoIGhhcyBhIGxhcmdlciBiYXRjaElkIHRoZW4gdGhlIHJlcXVlc3RlZFxuICAgICAgICAvLyBiYXRjaElkIGRvZXNuJ3QgZXhpc3QgaW4gdGhlIHF1ZXVlLlxuICAgICAgICAgICAgICAgIHJldHVybiB0IC0gdGhpcy5tdXRhdGlvblF1ZXVlWzBdLmJhdGNoSWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgdmVyc2lvbiBvZiBsb29rdXBNdXRhdGlvbkJhdGNoIHRoYXQgZG9lc24ndCByZXR1cm4gYSBwcm9taXNlLCB0aGlzIG1ha2VzXG4gICAgICogb3RoZXIgZnVuY3Rpb25zIHRoYXQgdXNlcyB0aGlzIGNvZGUgZWFzaWVyIHRvIHJlYWQgYW5kIG1vcmUgZWZmaWNlbnQuXG4gICAgICovICAgIHlzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMucHModCk7XG4gICAgICAgIGlmIChlIDwgMCB8fCBlID49IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlW2VdO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIG1lbW9yeS1vbmx5IFJlbW90ZURvY3VtZW50Q2FjaGUgZm9yIEluZGV4ZWREYi4gVG8gY29uc3RydWN0LCBpbnZva2VcbiAqIGBuZXdNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlKClgLlxuICovXG5jbGFzcyBibyB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHNpemVyIC0gVXNlZCB0byBhc3Nlc3MgdGhlIHNpemUgb2YgYSBkb2N1bWVudC4gRm9yIGVhZ2VyIEdDLCB0aGlzIGlzXG4gICAgICogZXhwZWN0ZWQgdG8ganVzdCByZXR1cm4gMCB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGRvaW5nIHRoZSB3b3JrIG9mXG4gICAgICogY2FsY3VsYXRpbmcgdGhlIHNpemUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLkVzID0gdCwgXG4gICAgICAgIC8qKiBVbmRlcmx5aW5nIGNhY2hlIG9mIGRvY3VtZW50cyBhbmQgdGhlaXIgcmVhZCB0aW1lcy4gKi9cbiAgICAgICAgdGhpcy5kb2NzID0gbmV3IEdlKGN0LmNvbXBhcmF0b3IpLCBcbiAgICAgICAgLyoqIFNpemUgb2YgYWxsIGNhY2hlZCBkb2N1bWVudHMuICovXG4gICAgICAgIHRoaXMuc2l6ZSA9IDA7XG4gICAgfVxuICAgIHNldEluZGV4TWFuYWdlcih0KSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyB0aGUgc3VwcGxpZWQgZW50cnkgdG8gdGhlIGNhY2hlIGFuZCB1cGRhdGVzIHRoZSBjYWNoZSBzaXplIGFzIGFwcHJvcHJpYXRlLlxuICAgICAqXG4gICAgICogQWxsIGNhbGxzIG9mIGBhZGRFbnRyeWAgIGFyZSByZXF1aXJlZCB0byBnbyB0aHJvdWdoIHRoZSBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlclxuICAgICAqIHJldHVybmVkIGJ5IGBuZXdDaGFuZ2VCdWZmZXIoKWAuXG4gICAgICovICAgIGFkZEVudHJ5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IGUua2V5LCBzID0gdGhpcy5kb2NzLmdldChuKSwgaSA9IHMgPyBzLnNpemUgOiAwLCByID0gdGhpcy5FcyhlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9jcyA9IHRoaXMuZG9jcy5pbnNlcnQobiwge1xuICAgICAgICAgICAgZG9jdW1lbnQ6IGUubXV0YWJsZUNvcHkoKSxcbiAgICAgICAgICAgIHNpemU6IHJcbiAgICAgICAgfSksIHRoaXMuc2l6ZSArPSByIC0gaSwgdGhpcy5pbmRleE1hbmFnZXIuYWRkVG9Db2xsZWN0aW9uUGFyZW50SW5kZXgodCwgbi5wYXRoLnBvcExhc3QoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHNwZWNpZmllZCBlbnRyeSBmcm9tIHRoZSBjYWNoZSBhbmQgdXBkYXRlcyB0aGUgY2FjaGUgc2l6ZSBhcyBhcHByb3ByaWF0ZS5cbiAgICAgKlxuICAgICAqIEFsbCBjYWxscyBvZiBgcmVtb3ZlRW50cnlgIGFyZSByZXF1aXJlZCB0byBnbyB0aHJvdWdoIHRoZSBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlclxuICAgICAqIHJldHVybmVkIGJ5IGBuZXdDaGFuZ2VCdWZmZXIoKWAuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZG9jcy5nZXQodCk7XG4gICAgICAgIGUgJiYgKHRoaXMuZG9jcyA9IHRoaXMuZG9jcy5yZW1vdmUodCksIHRoaXMuc2l6ZSAtPSBlLnNpemUpO1xuICAgIH1cbiAgICBnZXRFbnRyeSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmRvY3MuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZShuID8gbi5kb2N1bWVudC5tdXRhYmxlQ29weSgpIDogWmUubmV3SW52YWxpZERvY3VtZW50KGUpKTtcbiAgICB9XG4gICAgZ2V0RW50cmllcyh0LCBlKSB7XG4gICAgICAgIGxldCBuID0gZHMoKTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5kb2NzLmdldCh0KTtcbiAgICAgICAgICAgIG4gPSBuLmluc2VydCh0LCBlID8gZS5kb2N1bWVudC5tdXRhYmxlQ29weSgpIDogWmUubmV3SW52YWxpZERvY3VtZW50KHQpKTtcbiAgICAgICAgfSkpLCBBdC5yZXNvbHZlKG4pO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ29sbGVjdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGxldCBzID0gZHMoKTtcbiAgICAgICAgLy8gRG9jdW1lbnRzIGFyZSBvcmRlcmVkIGJ5IGtleSwgc28gd2UgY2FuIHVzZSBhIHByZWZpeCBzY2FuIHRvIG5hcnJvdyBkb3duXG4gICAgICAgIC8vIHRoZSBkb2N1bWVudHMgd2UgbmVlZCB0byBtYXRjaCB0aGUgcXVlcnkgYWdhaW5zdC5cbiAgICAgICAgICAgICAgICBjb25zdCBpID0gbmV3IGN0KGUuY2hpbGQoXCJcIikpLCByID0gdGhpcy5kb2NzLmdldEl0ZXJhdG9yRnJvbShpKTtcbiAgICAgICAgZm9yICg7ci5oYXNOZXh0KCk7ICkge1xuICAgICAgICAgICAgY29uc3Qge2tleTogdCwgdmFsdWU6IHtkb2N1bWVudDogaX19ID0gci5nZXROZXh0KCk7XG4gICAgICAgICAgICBpZiAoIWUuaXNQcmVmaXhPZih0LnBhdGgpKSBicmVhaztcbiAgICAgICAgICAgIHQucGF0aC5sZW5ndGggPiBlLmxlbmd0aCArIDEgfHwgKHB0KGd0KGkpLCBuKSA8PSAwIHx8IChzID0gcy5pbnNlcnQoaS5rZXksIGkubXV0YWJsZUNvcHkoKSkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZShzKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBuLCBzKSB7XG4gICAgICAgIC8vIFRoaXMgbWV0aG9kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCBmcm9tIHRoZSBJbmRleEJhY2tmaWxsZXIgaWYgcGVyc2lzdGVuY2VcbiAgICAgICAgLy8gaXMgZW5hYmxlZC5cbiAgICAgICAgTygpO1xuICAgIH1cbiAgICBBcyh0LCBlKSB7XG4gICAgICAgIHJldHVybiBBdC5mb3JFYWNoKHRoaXMuZG9jcywgKHQgPT4gZSh0KSkpO1xuICAgIH1cbiAgICBuZXdDaGFuZ2VCdWZmZXIodCkge1xuICAgICAgICAvLyBgdHJhY2tSZW1vdmFsc2AgaXMgaWdub3JlcyBzaW5jZSB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZSBrZWVwc1xuICAgICAgICAvLyBhIHNlcGFyYXRlIGNoYW5nZWxvZyBhbmQgZG9lcyBub3QgbmVlZCBzcGVjaWFsIGhhbmRsaW5nIGZvciByZW1vdmFscy5cbiAgICAgICAgcmV0dXJuIG5ldyBQbyh0aGlzKTtcbiAgICB9XG4gICAgZ2V0U2l6ZSh0KSB7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHRoaXMuc2l6ZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgbWVtb3J5LW9ubHkgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAqXG4gKiBAcGFyYW0gc2l6ZXIgLSBVc2VkIHRvIGFzc2VzcyB0aGUgc2l6ZSBvZiBhIGRvY3VtZW50LiBGb3IgZWFnZXIgR0MsIHRoaXMgaXNcbiAqIGV4cGVjdGVkIHRvIGp1c3QgcmV0dXJuIDAgdG8gYXZvaWQgdW5uZWNlc3NhcmlseSBkb2luZyB0aGUgd29yayBvZlxuICogY2FsY3VsYXRpbmcgdGhlIHNpemUuXG4gKi9cbi8qKlxuICogSGFuZGxlcyB0aGUgZGV0YWlscyBvZiBhZGRpbmcgYW5kIHVwZGF0aW5nIGRvY3VtZW50cyBpbiB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAqL1xuY2xhc3MgUG8gZXh0ZW5kcyBjbyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLlluID0gdDtcbiAgICB9XG4gICAgYXBwbHlDaGFuZ2VzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VzLmZvckVhY2goKChuLCBzKSA9PiB7XG4gICAgICAgICAgICBzLmlzVmFsaWREb2N1bWVudCgpID8gZS5wdXNoKHRoaXMuWW4uYWRkRW50cnkodCwgcykpIDogdGhpcy5Zbi5yZW1vdmVFbnRyeShuKTtcbiAgICAgICAgfSkpLCBBdC53YWl0Rm9yKGUpO1xuICAgIH1cbiAgICBnZXRGcm9tQ2FjaGUodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Zbi5nZXRFbnRyeSh0LCBlKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNhY2hlKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuWW4uZ2V0RW50cmllcyh0LCBlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIHZvIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHMgYSB0YXJnZXQgdG8gdGhlIGRhdGEgYWJvdXQgdGhhdCB0YXJnZXRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuUnMgPSBuZXcgbHMoKHQgPT4gbm4odCkpLCBzbiksIFxuICAgICAgICAvKiogVGhlIGxhc3QgcmVjZWl2ZWQgc25hcHNob3QgdmVyc2lvbi4gKi9cbiAgICAgICAgdGhpcy5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gc3QubWluKCksIFxuICAgICAgICAvKiogVGhlIGhpZ2hlc3QgbnVtYmVyZWQgdGFyZ2V0IElEIGVuY291bnRlcmVkLiAqL1xuICAgICAgICB0aGlzLmhpZ2hlc3RUYXJnZXRJZCA9IDAsIFxuICAgICAgICAvKiogVGhlIGhpZ2hlc3Qgc2VxdWVuY2UgbnVtYmVyIGVuY291bnRlcmVkLiAqL1xuICAgICAgICB0aGlzLmJzID0gMCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIG9yZGVyZWQgYmlkaXJlY3Rpb25hbCBtYXBwaW5nIGJldHdlZW4gZG9jdW1lbnRzIGFuZCB0aGUgcmVtb3RlIHRhcmdldFxuICAgICAgICAgKiBJRHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLlBzID0gbmV3IEVvLCB0aGlzLnRhcmdldENvdW50ID0gMCwgdGhpcy52cyA9IFlyLlBuKCk7XG4gICAgfVxuICAgIGZvckVhY2hUYXJnZXQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Scy5mb3JFYWNoKCgodCwgbikgPT4gZShuKSkpLCBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24odCkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh0aGlzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24pO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0U2VxdWVuY2VOdW1iZXIodCkge1xuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZSh0aGlzLmJzKTtcbiAgICB9XG4gICAgYWxsb2NhdGVUYXJnZXRJZCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpZ2hlc3RUYXJnZXRJZCA9IHRoaXMudnMubmV4dCgpLCBBdC5yZXNvbHZlKHRoaXMuaGlnaGVzdFRhcmdldElkKTtcbiAgICB9XG4gICAgc2V0VGFyZ2V0c01ldGFkYXRhKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIG4gJiYgKHRoaXMubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbiA9IG4pLCBlID4gdGhpcy5icyAmJiAodGhpcy5icyA9IGUpLCBcbiAgICAgICAgQXQucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBEbih0KSB7XG4gICAgICAgIHRoaXMuUnMuc2V0KHQudGFyZ2V0LCB0KTtcbiAgICAgICAgY29uc3QgZSA9IHQudGFyZ2V0SWQ7XG4gICAgICAgIGUgPiB0aGlzLmhpZ2hlc3RUYXJnZXRJZCAmJiAodGhpcy52cyA9IG5ldyBZcihlKSwgdGhpcy5oaWdoZXN0VGFyZ2V0SWQgPSBlKSwgdC5zZXF1ZW5jZU51bWJlciA+IHRoaXMuYnMgJiYgKHRoaXMuYnMgPSB0LnNlcXVlbmNlTnVtYmVyKTtcbiAgICB9XG4gICAgYWRkVGFyZ2V0RGF0YSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkRuKGUpLCB0aGlzLnRhcmdldENvdW50ICs9IDEsIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlVGFyZ2V0RGF0YSh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkRuKGUpLCBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldERhdGEodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5Scy5kZWxldGUoZS50YXJnZXQpLCB0aGlzLlBzLmxzKGUudGFyZ2V0SWQpLCB0aGlzLnRhcmdldENvdW50IC09IDEsIFxuICAgICAgICBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHModCwgZSwgbikge1xuICAgICAgICBsZXQgcyA9IDA7XG4gICAgICAgIGNvbnN0IGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuUnMuZm9yRWFjaCgoKHIsIG8pID0+IHtcbiAgICAgICAgICAgIG8uc2VxdWVuY2VOdW1iZXIgPD0gZSAmJiBudWxsID09PSBuLmdldChvLnRhcmdldElkKSAmJiAodGhpcy5Scy5kZWxldGUociksIGkucHVzaCh0aGlzLnJlbW92ZU1hdGNoaW5nS2V5c0ZvclRhcmdldElkKHQsIG8udGFyZ2V0SWQpKSwgXG4gICAgICAgICAgICBzKyspO1xuICAgICAgICB9KSksIEF0LndhaXRGb3IoaSkubmV4dCgoKCkgPT4gcykpO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDb3VudCh0KSB7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKHRoaXMudGFyZ2V0Q291bnQpO1xuICAgIH1cbiAgICBnZXRUYXJnZXREYXRhKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuUnMuZ2V0KGUpIHx8IG51bGw7XG4gICAgICAgIHJldHVybiBBdC5yZXNvbHZlKG4pO1xuICAgIH1cbiAgICBhZGRNYXRjaGluZ0tleXModCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5Qcy51cyhlLCBuKSwgQXQucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXModCwgZSwgbikge1xuICAgICAgICB0aGlzLlBzLmhzKGUsIG4pO1xuICAgICAgICBjb25zdCBzID0gdGhpcy5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gcyAmJiBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgaS5wdXNoKHMubWFya1BvdGVudGlhbGx5T3JwaGFuZWQodCwgZSkpO1xuICAgICAgICB9KSksIEF0LndhaXRGb3IoaSk7XG4gICAgfVxuICAgIHJlbW92ZU1hdGNoaW5nS2V5c0ZvclRhcmdldElkKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUHMubHMoZSksIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5Qcy5kcyhlKTtcbiAgICAgICAgcmV0dXJuIEF0LnJlc29sdmUobik7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIEF0LnJlc29sdmUodGhpcy5Qcy5jb250YWluc0tleShlKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIG1lbW9yeS1iYWNrZWQgaW5zdGFuY2Ugb2YgUGVyc2lzdGVuY2UuIERhdGEgaXMgc3RvcmVkIG9ubHkgaW4gUkFNIGFuZFxuICogbm90IHBlcnNpc3RlZCBhY3Jvc3Mgc2Vzc2lvbnMuXG4gKi9cbmNsYXNzIFZvIHtcbiAgICAvKipcbiAgICAgKiBUaGUgY29uc3RydWN0b3IgYWNjZXB0cyBhIGZhY3RvcnkgZm9yIGNyZWF0aW5nIGEgcmVmZXJlbmNlIGRlbGVnYXRlLiBUaGlzXG4gICAgICogYWxsb3dzIGJvdGggdGhlIGRlbGVnYXRlIGFuZCB0aGlzIGluc3RhbmNlIHRvIGhhdmUgc3Ryb25nIHJlZmVyZW5jZXMgdG9cbiAgICAgKiBlYWNoIG90aGVyIHdpdGhvdXQgaGF2aW5nIG51bGxhYmxlIGZpZWxkcyB0aGF0IHdvdWxkIHRoZW4gbmVlZCB0byBiZVxuICAgICAqIGNoZWNrZWQgb3IgYXNzZXJ0ZWQgb24gZXZlcnkgYWNjZXNzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5WcyA9IHt9LCB0aGlzLm92ZXJsYXlzID0ge30sIHRoaXMuU3MgPSBuZXcgT3QoMCksIHRoaXMuRHMgPSAhMSwgdGhpcy5EcyA9ICEwLCBcbiAgICAgICAgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IHQodGhpcyksIHRoaXMuQ3MgPSBuZXcgdm8odGhpcyk7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gbmV3IE5yLCB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGJvKHQpO1xuICAgICAgICB9KCh0ID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUueHModCkpKSwgdGhpcy55dCA9IG5ldyBIaShlKSwgdGhpcy5OcyA9IG5ldyBJbyh0aGlzLnl0KTtcbiAgICB9XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIC8vIE5vIGR1cmFibGUgc3RhdGUgdG8gZW5zdXJlIGlzIGNsb3NlZCBvbiBzaHV0ZG93bi5cbiAgICAgICAgcmV0dXJuIHRoaXMuRHMgPSAhMSwgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5EcztcbiAgICB9XG4gICAgc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICBzZXROZXR3b3JrRW5hYmxlZCgpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGdldEluZGV4TWFuYWdlcih0KSB7XG4gICAgICAgIC8vIFdlIGRvIG5vdCBjdXJyZW50bHkgc3VwcG9ydCBpbmRpY2VzIGZvciBtZW1vcnkgcGVyc2lzdGVuY2UsIHNvIHdlIGNhblxuICAgICAgICAvLyByZXR1cm4gdGhlIHNhbWUgc2hhcmVkIGluc3RhbmNlIG9mIHRoZSBtZW1vcnkgaW5kZXggbWFuYWdlci5cbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyO1xuICAgIH1cbiAgICBnZXREb2N1bWVudE92ZXJsYXlDYWNoZSh0KSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5vdmVybGF5c1t0LnRvS2V5KCldO1xuICAgICAgICByZXR1cm4gZSB8fCAoZSA9IG5ldyBUbywgdGhpcy5vdmVybGF5c1t0LnRvS2V5KCldID0gZSksIGU7XG4gICAgfVxuICAgIGdldE11dGF0aW9uUXVldWUodCwgZSkge1xuICAgICAgICBsZXQgbiA9IHRoaXMuVnNbdC50b0tleSgpXTtcbiAgICAgICAgcmV0dXJuIG4gfHwgKG4gPSBuZXcgUm8oZSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSksIHRoaXMuVnNbdC50b0tleSgpXSA9IG4pLCBuO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQ3M7XG4gICAgfVxuICAgIGdldFJlbW90ZURvY3VtZW50Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGU7XG4gICAgfVxuICAgIGdldEJ1bmRsZUNhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5OcztcbiAgICB9XG4gICAgcnVuVHJhbnNhY3Rpb24odCwgZSwgbikge1xuICAgICAgICBDKFwiTWVtb3J5UGVyc2lzdGVuY2VcIiwgXCJTdGFydGluZyB0cmFuc2FjdGlvbjpcIiwgdCk7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgU28odGhpcy5Tcy5uZXh0KCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5rcygpLCBuKHMpLm5leHQoKHQgPT4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5PcyhzKS5uZXh0KCgoKSA9PiB0KSkpKS50b1Byb21pc2UoKS50aGVuKCh0ID0+IChzLnJhaXNlT25Db21taXR0ZWRFdmVudCgpLCBcbiAgICAgICAgdCkpKTtcbiAgICB9XG4gICAgTXModCwgZSkge1xuICAgICAgICByZXR1cm4gQXQub3IoT2JqZWN0LnZhbHVlcyh0aGlzLlZzKS5tYXAoKG4gPT4gKCkgPT4gbi5jb250YWluc0tleSh0LCBlKSkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogTWVtb3J5IHBlcnNpc3RlbmNlIGlzIG5vdCBhY3R1YWxseSB0cmFuc2FjdGlvbmFsLCBidXQgZnV0dXJlIGltcGxlbWVudGF0aW9uc1xuICogbWF5IGhhdmUgdHJhbnNhY3Rpb24tc2NvcGVkIHN0YXRlLlxuICovIGNsYXNzIFNvIGV4dGVuZHMgVHQge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5jdXJyZW50U2VxdWVuY2VOdW1iZXIgPSB0O1xuICAgIH1cbn1cblxuY2xhc3MgRG8ge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHQsIFxuICAgICAgICAvKiogVHJhY2tzIGFsbCBkb2N1bWVudHMgdGhhdCBhcmUgYWN0aXZlIGluIFF1ZXJ5IHZpZXdzLiAqL1xuICAgICAgICB0aGlzLkZzID0gbmV3IEVvLCBcbiAgICAgICAgLyoqIFRoZSBsaXN0IG9mIGRvY3VtZW50cyB0aGF0IGFyZSBwb3RlbnRpYWxseSBHQ2VkIGFmdGVyIGVhY2ggdHJhbnNhY3Rpb24uICovXG4gICAgICAgIHRoaXMuJHMgPSBudWxsO1xuICAgIH1cbiAgICBzdGF0aWMgQnModCkge1xuICAgICAgICByZXR1cm4gbmV3IERvKHQpO1xuICAgIH1cbiAgICBnZXQgTHMoKSB7XG4gICAgICAgIGlmICh0aGlzLiRzKSByZXR1cm4gdGhpcy4kcztcbiAgICAgICAgdGhyb3cgTygpO1xuICAgIH1cbiAgICBhZGRSZWZlcmVuY2UodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5Gcy5hZGRSZWZlcmVuY2UobiwgZSksIHRoaXMuTHMuZGVsZXRlKG4udG9TdHJpbmcoKSksIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlUmVmZXJlbmNlKHQsIGUsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRnMucmVtb3ZlUmVmZXJlbmNlKG4sIGUpLCB0aGlzLkxzLmFkZChuLnRvU3RyaW5nKCkpLCBBdC5yZXNvbHZlKCk7XG4gICAgfVxuICAgIG1hcmtQb3RlbnRpYWxseU9ycGhhbmVkKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuTHMuYWRkKGUudG9TdHJpbmcoKSksIEF0LnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KHQsIGUpIHtcbiAgICAgICAgdGhpcy5Gcy5scyhlLnRhcmdldElkKS5mb3JFYWNoKCh0ID0+IHRoaXMuTHMuYWRkKHQudG9TdHJpbmcoKSkpKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKTtcbiAgICAgICAgcmV0dXJuIG4uZ2V0TWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgZS50YXJnZXRJZCkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICB0LmZvckVhY2goKHQgPT4gdGhpcy5Mcy5hZGQodC50b1N0cmluZygpKSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbi5yZW1vdmVUYXJnZXREYXRhKHQsIGUpKSk7XG4gICAgfVxuICAgIGtzKCkge1xuICAgICAgICB0aGlzLiRzID0gbmV3IFNldDtcbiAgICB9XG4gICAgT3ModCkge1xuICAgICAgICAvLyBSZW1vdmUgbmV3bHkgb3JwaGFuZWQgZG9jdW1lbnRzLlxuICAgICAgICBjb25zdCBlID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCkubmV3Q2hhbmdlQnVmZmVyKCk7XG4gICAgICAgIHJldHVybiBBdC5mb3JFYWNoKHRoaXMuTHMsIChuID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBjdC5mcm9tUGF0aChuKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnFzKHQsIHMpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgIHQgfHwgZS5yZW1vdmVFbnRyeShzLCBzdC5taW4oKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiAodGhpcy4kcyA9IG51bGwsIGUuYXBwbHkodCkpKSk7XG4gICAgfVxuICAgIHVwZGF0ZUxpbWJvRG9jdW1lbnQodCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5xcyh0LCBlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIHQgPyB0aGlzLkxzLmRlbGV0ZShlLnRvU3RyaW5nKCkpIDogdGhpcy5Mcy5hZGQoZS50b1N0cmluZygpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICB4cyh0KSB7XG4gICAgICAgIC8vIEZvciBlYWdlciBHQywgd2UgZG9uJ3QgY2FyZSBhYm91dCB0aGUgZG9jdW1lbnQgc2l6ZSwgdGhlcmUgYXJlIG5vIHNpemUgdGhyZXNob2xkcy5cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHFzKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIEF0Lm9yKFsgKCkgPT4gQXQucmVzb2x2ZSh0aGlzLkZzLmNvbnRhaW5zS2V5KGUpKSwgKCkgPT4gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpLmNvbnRhaW5zS2V5KHQsIGUpLCAoKSA9PiB0aGlzLnBlcnNpc3RlbmNlLk1zKHQsIGUpIF0pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBQZXJmb3JtcyBkYXRhYmFzZSBjcmVhdGlvbiBhbmQgc2NoZW1hIHVwZ3JhZGVzLiAqLyBjbGFzcyBDbyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLnl0ID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgZGF0YWJhc2UgY3JlYXRpb24gYW5kIHNjaGVtYSB1cGdyYWRlcy5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBpbiBwcm9kdWN0aW9uLCB0aGlzIG1ldGhvZCBpcyBvbmx5IGV2ZXIgdXNlZCB0byB1cGdyYWRlIHRoZSBzY2hlbWFcbiAgICAgKiB0byBTQ0hFTUFfVkVSU0lPTi4gRGlmZmVyZW50IHZhbHVlcyBvZiB0b1ZlcnNpb24gYXJlIG9ubHkgdXNlZCBmb3IgdGVzdGluZ1xuICAgICAqIGFuZCBsb2NhbCBmZWF0dXJlIGRldmVsb3BtZW50LlxuICAgICAqLyAgICAkKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBSdChcImNyZWF0ZU9yVXBncmFkZVwiLCBlKTtcbiAgICAgICAgbiA8IDEgJiYgcyA+PSAxICYmIChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwib3duZXJcIik7XG4gICAgICAgIH0odCksIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJtdXRhdGlvblF1ZXVlc1wiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogXCJ1c2VySWRcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwibXV0YXRpb25zXCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJhdGNoSWRcIixcbiAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgfSkuY3JlYXRlSW5kZXgoXCJ1c2VyTXV0YXRpb25zSW5kZXhcIiwgSWksIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICEwXG4gICAgICAgICAgICB9KSwgdC5jcmVhdGVPYmplY3RTdG9yZShcImRvY3VtZW50TXV0YXRpb25zXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogVXBncmFkZSBmdW5jdGlvbiB0byBtaWdyYXRlIHRoZSAnbXV0YXRpb25zJyBzdG9yZSBmcm9tIFYxIHRvIFYzLiBMb2Fkc1xuICogYW5kIHJld3JpdGVzIGFsbCBkYXRhLlxuICovICh0KSwgeG8odCksIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudHNcIik7XG4gICAgICAgIH0odCkpO1xuICAgICAgICAvLyBNaWdyYXRpb24gMiB0byBwb3B1bGF0ZSB0aGUgdGFyZ2V0R2xvYmFsIG9iamVjdCBubyBsb25nZXIgbmVlZGVkIHNpbmNlXG4gICAgICAgIC8vIG1pZ3JhdGlvbiAzIHVuY29uZGl0aW9uYWxseSBjbGVhcnMgaXQuXG4gICAgICAgICAgICAgICAgbGV0IHIgPSBBdC5yZXNvbHZlKCk7XG4gICAgICAgIHJldHVybiBuIDwgMyAmJiBzID49IDMgJiYgKFxuICAgICAgICAvLyBCcmFuZCBuZXcgY2xpZW50cyBkb24ndCBuZWVkIHRvIGRyb3AgYW5kIHJlY3JlYXRlLS1vbmx5IGNsaWVudHMgdGhhdFxuICAgICAgICAvLyBwb3RlbnRpYWxseSBoYXZlIGNvcnJ1cHQgZGF0YS5cbiAgICAgICAgMCAhPT0gbiAmJiAoIWZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHQuZGVsZXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXREb2N1bWVudHNcIiksIHQuZGVsZXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXRzXCIpLCB0LmRlbGV0ZU9iamVjdFN0b3JlKFwidGFyZ2V0R2xvYmFsXCIpO1xuICAgICAgICB9KHQpLCB4byh0KSksIHIgPSByLm5leHQoKCgpID0+IFxuICAgICAgICAvKipcbiAqIENyZWF0ZXMgdGhlIHRhcmdldCBnbG9iYWwgc2luZ2xldG9uIHJvdy5cbiAqXG4gKiBAcGFyYW0gdHhuIC0gVGhlIHZlcnNpb24gdXBncmFkZSB0cmFuc2FjdGlvbiBmb3IgaW5kZXhlZGRiXG4gKi9cbiAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQuc3RvcmUoXCJ0YXJnZXRHbG9iYWxcIiksIG4gPSB7XG4gICAgICAgICAgICAgICAgaGlnaGVzdFRhcmdldElkOiAwLFxuICAgICAgICAgICAgICAgIGhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlcjogMCxcbiAgICAgICAgICAgICAgICBsYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uOiBzdC5taW4oKS50b1RpbWVzdGFtcCgpLFxuICAgICAgICAgICAgICAgIHRhcmdldENvdW50OiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIGUucHV0KFwidGFyZ2V0R2xvYmFsS2V5XCIsIG4pO1xuICAgICAgICB9KGkpKSkpLCBuIDwgNCAmJiBzID49IDQgJiYgKDAgIT09IG4gJiYgKFxuICAgICAgICAvLyBTY2hlbWEgdmVyc2lvbiAzIHVzZXMgYXV0by1nZW5lcmF0ZWQga2V5cyB0byBnZW5lcmF0ZSBnbG9iYWxseSB1bmlxdWVcbiAgICAgICAgLy8gbXV0YXRpb24gYmF0Y2ggSURzICh0aGlzIHdhcyBwcmV2aW91c2x5IGVuc3VyZWQgaW50ZXJuYWxseSBieSB0aGVcbiAgICAgICAgLy8gY2xpZW50KS4gVG8gbWlncmF0ZSB0byB0aGUgbmV3IHNjaGVtYSwgd2UgaGF2ZSB0byByZWFkIGFsbCBtdXRhdGlvbnNcbiAgICAgICAgLy8gYW5kIHdyaXRlIHRoZW0gYmFjayBvdXQuIFdlIHByZXNlcnZlIHRoZSBleGlzdGluZyBiYXRjaCBJRHMgdG8gZ3VhcmFudGVlXG4gICAgICAgIC8vIGNvbnNpc3RlbmN5IHdpdGggb3RoZXIgb2JqZWN0IHN0b3Jlcy4gQW55IGZ1cnRoZXIgbXV0YXRpb24gYmF0Y2ggSURzIHdpbGxcbiAgICAgICAgLy8gYmUgYXV0by1nZW5lcmF0ZWQuXG4gICAgICAgIHIgPSByLm5leHQoKCgpID0+IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBlLnN0b3JlKFwibXV0YXRpb25zXCIpLlcoKS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgICAgICB0LmRlbGV0ZU9iamVjdFN0b3JlKFwibXV0YXRpb25zXCIpO1xuICAgICAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJtdXRhdGlvbnNcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJhdGNoSWRcIixcbiAgICAgICAgICAgICAgICAgICAgYXV0b0luY3JlbWVudDogITBcbiAgICAgICAgICAgICAgICB9KS5jcmVhdGVJbmRleChcInVzZXJNdXRhdGlvbnNJbmRleFwiLCBJaSwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICEwXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IGUuc3RvcmUoXCJtdXRhdGlvbnNcIiksIGkgPSBuLm1hcCgodCA9PiBzLnB1dCh0KSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBBdC53YWl0Rm9yKGkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KHQsIGkpKSkpLCByID0gci5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJjbGllbnRNZXRhZGF0YVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IFwiY2xpZW50SWRcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSh0KTtcbiAgICAgICAgfSkpKSwgbiA8IDUgJiYgcyA+PSA1ICYmIChyID0gci5uZXh0KCgoKSA9PiB0aGlzLlVzKGkpKSkpLCBuIDwgNiAmJiBzID49IDYgJiYgKHIgPSByLm5leHQoKCgpID0+IChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwicmVtb3RlRG9jdW1lbnRHbG9iYWxcIik7XG4gICAgICAgIH0odCksIHRoaXMuS3MoaSkpKSkpLCBuIDwgNyAmJiBzID49IDcgJiYgKHIgPSByLm5leHQoKCgpID0+IHRoaXMuR3MoaSkpKSksIG4gPCA4ICYmIHMgPj0gOCAmJiAociA9IHIubmV4dCgoKCkgPT4gdGhpcy5Rcyh0LCBpKSkpKSwgXG4gICAgICAgIG4gPCA5ICYmIHMgPj0gOSAmJiAociA9IHIubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gTXVsdGktVGFiIHVzZWQgdG8gbWFuYWdlIGl0cyBvd24gY2hhbmdlbG9nLCBidXQgdGhpcyBoYXMgYmVlbiBtb3ZlZFxuICAgICAgICAgICAgLy8gdG8gdGhlIERiUmVtb3RlRG9jdW1lbnQgb2JqZWN0IHN0b3JlIGl0c2VsZi4gU2luY2UgdGhlIHByZXZpb3VzIGNoYW5nZVxuICAgICAgICAgICAgLy8gbG9nIG9ubHkgY29udGFpbmVkIHRyYW5zaWVudCBkYXRhLCB3ZSBjYW4gZHJvcCBpdHMgb2JqZWN0IHN0b3JlLlxuICAgICAgICAgICAgIWZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICB0Lm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoXCJyZW1vdGVEb2N1bWVudENoYW5nZXNcIikgJiYgdC5kZWxldGVPYmplY3RTdG9yZShcInJlbW90ZURvY3VtZW50Q2hhbmdlc1wiKTtcbiAgICAgICAgICAgIH0odCk7XG4gICAgICAgICAgICAvLyBOb3RlOiBTY2hlbWEgdmVyc2lvbiA5IHVzZWQgdG8gY3JlYXRlIGEgcmVhZCB0aW1lIGluZGV4IGZvciB0aGVcbiAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgaXMgbm93IGRvbmUgd2l0aCBzY2hlbWEgdmVyc2lvbiAxMy5cbiAgICAgICAgICAgICAgICB9KSkpLCBuIDwgMTAgJiYgcyA+PSAxMCAmJiAociA9IHIubmV4dCgoKCkgPT4gdGhpcy5qcyhpKSkpKSwgbiA8IDExICYmIHMgPj0gMTEgJiYgKHIgPSByLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICFmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcImJ1bmRsZXNcIiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImJ1bmRsZUlkXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0odCksIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwibmFtZWRRdWVyaWVzXCIsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogXCJuYW1lXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0odCk7XG4gICAgICAgIH0pKSksIG4gPCAxMiAmJiBzID49IDEyICYmIChyID0gci5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LmNyZWF0ZU9iamVjdFN0b3JlKFwiZG9jdW1lbnRPdmVybGF5c1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IE9pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIE1pLCB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgICAgICB9KSwgZS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cE92ZXJsYXlJbmRleFwiLCBGaSwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KHQpO1xuICAgICAgICB9KSkpLCBuIDwgMTMgJiYgcyA+PSAxMyAmJiAociA9IHIubmV4dCgoKCkgPT4gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudHNWMTRcIiwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IFJpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGUuY3JlYXRlSW5kZXgoXCJkb2N1bWVudEtleUluZGV4XCIsIGJpKSwgZS5jcmVhdGVJbmRleChcImNvbGxlY3Rpb25Hcm91cEluZGV4XCIsIFBpKTtcbiAgICAgICAgfSh0KSkpLm5leHQoKCgpID0+IHRoaXMuV3ModCwgaSkpKS5uZXh0KCgoKSA9PiB0LmRlbGV0ZU9iamVjdFN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpKSkpLCBcbiAgICAgICAgbiA8IDE0ICYmIHMgPj0gMTQgJiYgKHIgPSByLm5leHQoKCgpID0+IHRoaXMuenModCwgaSkpKSksIG4gPCAxNSAmJiBzID49IDE1ICYmIChyID0gci5uZXh0KCgoKSA9PiBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwiaW5kZXhDb25maWd1cmF0aW9uXCIsIHtcbiAgICAgICAgICAgICAgICBrZXlQYXRoOiBcImluZGV4SWRcIixcbiAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgfSkuY3JlYXRlSW5kZXgoXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLCBcImNvbGxlY3Rpb25Hcm91cFwiLCB7XG4gICAgICAgICAgICAgICAgdW5pcXVlOiAhMVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwiaW5kZXhTdGF0ZVwiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogQ2lcbiAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwic2VxdWVuY2VOdW1iZXJJbmRleFwiLCB4aSwge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdC5jcmVhdGVPYmplY3RTdG9yZShcImluZGV4RW50cmllc1wiLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogTmlcbiAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KFwiZG9jdW1lbnRLZXlJbmRleFwiLCBraSwge1xuICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KHQpKSkpLCByO1xuICAgIH1cbiAgICBLcyh0KSB7XG4gICAgICAgIGxldCBlID0gMDtcbiAgICAgICAgcmV0dXJuIHQuc3RvcmUoXCJyZW1vdGVEb2N1bWVudHNcIikuWigoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIGUgKz0gUXIobik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0ge1xuICAgICAgICAgICAgICAgIGJ5dGVTaXplOiBlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHQuc3RvcmUoXCJyZW1vdGVEb2N1bWVudEdsb2JhbFwiKS5wdXQoXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCBuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBVcyh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LnN0b3JlKFwibXV0YXRpb25RdWV1ZXNcIiksIG4gPSB0LnN0b3JlKFwibXV0YXRpb25zXCIpO1xuICAgICAgICByZXR1cm4gZS5XKCkubmV4dCgoZSA9PiBBdC5mb3JFYWNoKGUsIChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBJREJLZXlSYW5nZS5ib3VuZChbIGUudXNlcklkLCAtMSBdLCBbIGUudXNlcklkLCBlLmxhc3RBY2tub3dsZWRnZWRCYXRjaElkIF0pO1xuICAgICAgICAgICAgcmV0dXJuIG4uVyhcInVzZXJNdXRhdGlvbnNJbmRleFwiLCBzKS5uZXh0KChuID0+IEF0LmZvckVhY2gobiwgKG4gPT4ge1xuICAgICAgICAgICAgICAgIE0obi51c2VySWQgPT09IGUudXNlcklkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gZXIodGhpcy55dCwgbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEdyKHQsIGUudXNlcklkLCBzKS5uZXh0KCgoKSA9PiB7fSkpO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH0pKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnN1cmVzIHRoYXQgZXZlcnkgZG9jdW1lbnQgaW4gdGhlIHJlbW90ZSBkb2N1bWVudCBjYWNoZSBoYXMgYSBjb3JyZXNwb25kaW5nIHNlbnRpbmVsIHJvd1xuICAgICAqIHdpdGggYSBzZXF1ZW5jZSBudW1iZXIuIE1pc3Npbmcgcm93cyBhcmUgZ2l2ZW4gdGhlIG1vc3QgcmVjZW50bHkgdXNlZCBzZXF1ZW5jZSBudW1iZXIuXG4gICAgICovICAgIEdzKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuc3RvcmUoXCJ0YXJnZXREb2N1bWVudHNcIiksIG4gPSB0LnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpO1xuICAgICAgICByZXR1cm4gdC5zdG9yZShcInRhcmdldEdsb2JhbFwiKS5nZXQoXCJ0YXJnZXRHbG9iYWxLZXlcIikubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgICAgICByZXR1cm4gbi5aKCgobiwgaSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgcnQobiksIG8gPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbIDAsIG1pKHQpIF07XG4gICAgICAgICAgICAgICAgfShyKTtcbiAgICAgICAgICAgICAgICBzLnB1c2goZS5nZXQobykubmV4dCgobiA9PiBuID8gQXQucmVzb2x2ZSgpIDogKG4gPT4gZS5wdXQoe1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZDogMCxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogbWkobiksXG4gICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlTnVtYmVyOiB0LmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlclxuICAgICAgICAgICAgICAgIH0pKShyKSkpKTtcbiAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiBBdC53YWl0Rm9yKHMpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgUXModCwgZSkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGluZGV4LlxuICAgICAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwiY29sbGVjdGlvblBhcmVudHNcIiwge1xuICAgICAgICAgICAga2V5UGF0aDogRGlcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IG4gPSBlLnN0b3JlKFwiY29sbGVjdGlvblBhcmVudHNcIiksIHMgPSBuZXcga3IsIGkgPSB0ID0+IHtcbiAgICAgICAgICAgIGlmIChzLmFkZCh0KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0Lmxhc3RTZWdtZW50KCksIHMgPSB0LnBvcExhc3QoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wdXQoe1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uSWQ6IGUsXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudDogbWkocylcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gSGVscGVyIHRvIGFkZCBhbiBpbmRleCBlbnRyeSBpZmYgd2UgaGF2ZW4ndCBhbHJlYWR5IHdyaXR0ZW4gaXQuXG4gICAgICAgICAgICAgICAgLy8gSW5kZXggZXhpc3RpbmcgcmVtb3RlIGRvY3VtZW50cy5cbiAgICAgICAgcmV0dXJuIGUuc3RvcmUoXCJyZW1vdGVEb2N1bWVudHNcIikuWih7XG4gICAgICAgICAgICBYOiAhMFxuICAgICAgICB9LCAoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgcnQodCk7XG4gICAgICAgICAgICByZXR1cm4gaShuLnBvcExhc3QoKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBlLnN0b3JlKFwiZG9jdW1lbnRNdXRhdGlvbnNcIikuWih7XG4gICAgICAgICAgICBYOiAhMFxuICAgICAgICB9LCAoKFt0LCBlLCBuXSwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IHBpKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGkoci5wb3BMYXN0KCkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAganModCkge1xuICAgICAgICBjb25zdCBlID0gdC5zdG9yZShcInRhcmdldHNcIik7XG4gICAgICAgIHJldHVybiBlLlooKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gbnIobiksIGkgPSBzcih0aGlzLnl0LCBzKTtcbiAgICAgICAgICAgIHJldHVybiBlLnB1dChpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBXcyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLnN0b3JlKFwicmVtb3RlRG9jdW1lbnRzXCIpLCBzID0gW107XG4gICAgICAgIHJldHVybiBuLlooKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gZS5zdG9yZShcInJlbW90ZURvY3VtZW50c1YxNFwiKSwgciA9IChvID0gbiwgby5kb2N1bWVudCA/IG5ldyBjdChydC5mcm9tU3RyaW5nKG8uZG9jdW1lbnQubmFtZSkucG9wRmlyc3QoNSkpIDogby5ub0RvY3VtZW50ID8gY3QuZnJvbVNlZ21lbnRzKG8ubm9Eb2N1bWVudC5wYXRoKSA6IG8udW5rbm93bkRvY3VtZW50ID8gY3QuZnJvbVNlZ21lbnRzKG8udW5rbm93bkRvY3VtZW50LnBhdGgpIDogTygpKS5wYXRoLnRvQXJyYXkoKTtcbiAgICAgICAgICAgIHZhciBvO1xuICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gICAgICAgICAgICBjb25zdCB1ID0ge1xuICAgICAgICAgICAgICAgIHByZWZpeFBhdGg6IHIuc2xpY2UoMCwgci5sZW5ndGggLSAyKSxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IHJbci5sZW5ndGggLSAyXSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudElkOiByW3IubGVuZ3RoIC0gMV0sXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IG4ucmVhZFRpbWUgfHwgWyAwLCAwIF0sXG4gICAgICAgICAgICAgICAgdW5rbm93bkRvY3VtZW50OiBuLnVua25vd25Eb2N1bWVudCxcbiAgICAgICAgICAgICAgICBub0RvY3VtZW50OiBuLm5vRG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQ6IG4uZG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgaGFzQ29tbWl0dGVkTXV0YXRpb25zOiAhIW4uaGFzQ29tbWl0dGVkTXV0YXRpb25zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcy5wdXNoKGkucHV0KHUpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IEF0LndhaXRGb3IocykpKTtcbiAgICB9XG4gICAgenModCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZS5zdG9yZShcIm11dGF0aW9uc1wiKSwgcyA9IGhvKHRoaXMueXQpLCBpID0gbmV3IFZvKERvLkJzLCB0aGlzLnl0LmllKTtcbiAgICAgICAgcmV0dXJuIG4uVygpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgZTtcbiAgICAgICAgICAgICAgICBsZXQgcyA9IG51bGwgIT09IChlID0gbi5nZXQodC51c2VySWQpKSAmJiB2b2lkIDAgIT09IGUgPyBlIDogRXMoKTtcbiAgICAgICAgICAgICAgICBlcih0aGlzLnl0LCB0KS5rZXlzKCkuZm9yRWFjaCgodCA9PiBzID0gcy5hZGQodCkpKSwgbi5zZXQodC51c2VySWQsIHMpO1xuICAgICAgICAgICAgfSkpLCBBdC5mb3JFYWNoKG4sICgodCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgUChuKSwgbyA9IGxyLnJlKHRoaXMueXQsIHIpLCB1ID0gaS5nZXRJbmRleE1hbmFnZXIociksIGMgPSBqci5yZShyLCB0aGlzLnl0LCB1LCBpLnJlZmVyZW5jZURlbGVnYXRlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHBvKHMsIGMsIG8sIHUpLnJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzRm9yRG9jdW1lbnRLZXlzKG5ldyBLaShlLCBPdC5hdCksIHQpLm5leHQoKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24geG8odCkge1xuICAgIHQuY3JlYXRlT2JqZWN0U3RvcmUoXCJ0YXJnZXREb2N1bWVudHNcIiwge1xuICAgICAgICBrZXlQYXRoOiBWaVxuICAgIH0pLmNyZWF0ZUluZGV4KFwiZG9jdW1lbnRUYXJnZXRzSW5kZXhcIiwgU2ksIHtcbiAgICAgICAgdW5pcXVlOiAhMFxuICAgIH0pO1xuICAgIC8vIE5PVEU6IFRoaXMgaXMgdW5pcXVlIG9ubHkgYmVjYXVzZSB0aGUgVGFyZ2V0SWQgaXMgdGhlIHN1ZmZpeC5cbiAgICB0LmNyZWF0ZU9iamVjdFN0b3JlKFwidGFyZ2V0c1wiLCB7XG4gICAgICAgIGtleVBhdGg6IFwidGFyZ2V0SWRcIlxuICAgIH0pLmNyZWF0ZUluZGV4KFwicXVlcnlUYXJnZXRzSW5kZXhcIiwgdmksIHtcbiAgICAgICAgdW5pcXVlOiAhMFxuICAgIH0pLCB0LmNyZWF0ZU9iamVjdFN0b3JlKFwidGFyZ2V0R2xvYmFsXCIpO1xufVxuXG5jb25zdCBObyA9IFwiRmFpbGVkIHRvIG9idGFpbiBleGNsdXNpdmUgYWNjZXNzIHRvIHRoZSBwZXJzaXN0ZW5jZSBsYXllci4gVG8gYWxsb3cgc2hhcmVkIGFjY2VzcywgbXVsdGktdGFiIHN5bmNocm9uaXphdGlvbiBoYXMgdG8gYmUgZW5hYmxlZCBpbiBhbGwgdGFicy4gSWYgeW91IGFyZSB1c2luZyBgZXhwZXJpbWVudGFsRm9yY2VPd25pbmdUYWI6dHJ1ZWAsIG1ha2Ugc3VyZSB0aGF0IG9ubHkgb25lIHRhYiBoYXMgcGVyc2lzdGVuY2UgZW5hYmxlZCBhdCBhbnkgZ2l2ZW4gdGltZS5cIjtcblxuLyoqXG4gKiBPbGRlc3QgYWNjZXB0YWJsZSBhZ2UgaW4gbWlsbGlzZWNvbmRzIGZvciBjbGllbnQgbWV0YWRhdGEgYmVmb3JlIHRoZSBjbGllbnRcbiAqIGlzIGNvbnNpZGVyZWQgaW5hY3RpdmUgYW5kIGl0cyBhc3NvY2lhdGVkIGRhdGEgaXMgZ2FyYmFnZSBjb2xsZWN0ZWQuXG4gKi9cbi8qKlxuICogQW4gSW5kZXhlZERCLWJhY2tlZCBpbnN0YW5jZSBvZiBQZXJzaXN0ZW5jZS4gRGF0YSBpcyBzdG9yZWQgcGVyc2lzdGVudGx5XG4gKiBhY3Jvc3Mgc2Vzc2lvbnMuXG4gKlxuICogT24gV2ViIG9ubHksIHRoZSBGaXJlc3RvcmUgU0RLcyBzdXBwb3J0IHNoYXJlZCBhY2Nlc3MgdG8gaXRzIHBlcnNpc3RlbmNlXG4gKiBsYXllci4gVGhpcyBhbGxvd3MgbXVsdGlwbGUgYnJvd3NlciB0YWJzIHRvIHJlYWQgYW5kIHdyaXRlIHRvIEluZGV4ZWREYiBhbmRcbiAqIHRvIHN5bmNocm9uaXplIHN0YXRlIGV2ZW4gd2l0aG91dCBuZXR3b3JrIGNvbm5lY3Rpdml0eS4gU2hhcmVkIGFjY2VzcyBpc1xuICogY3VycmVudGx5IG9wdGlvbmFsIGFuZCBub3QgZW5hYmxlZCB1bmxlc3MgYWxsIGNsaWVudHMgaW52b2tlXG4gKiBgZW5hYmxlUGVyc2lzdGVuY2UoKWAgd2l0aCBge3N5bmNocm9uaXplVGFiczp0cnVlfWAuXG4gKlxuICogSW4gbXVsdGktdGFiIG1vZGUsIGlmIG11bHRpcGxlIGNsaWVudHMgYXJlIGFjdGl2ZSBhdCB0aGUgc2FtZSB0aW1lLCB0aGUgU0RLXG4gKiB3aWxsIGRlc2lnbmF0ZSBvbmUgY2xpZW50IGFzIHRoZSDigJxwcmltYXJ5IGNsaWVudOKAnS4gQW4gZWZmb3J0IGlzIG1hZGUgdG8gcGlja1xuICogYSB2aXNpYmxlLCBuZXR3b3JrLWNvbm5lY3RlZCBhbmQgYWN0aXZlIGNsaWVudCwgYW5kIHRoaXMgY2xpZW50IGlzXG4gKiByZXNwb25zaWJsZSBmb3IgbGV0dGluZyBvdGhlciBjbGllbnRzIGtub3cgYWJvdXQgaXRzIHByZXNlbmNlLiBUaGUgcHJpbWFyeVxuICogY2xpZW50IHdyaXRlcyBhIHVuaXF1ZSBjbGllbnQtZ2VuZXJhdGVkIGlkZW50aWZpZXIgKHRoZSBjbGllbnQgSUQpIHRvXG4gKiBJbmRleGVkRGLigJlzIOKAnG93bmVy4oCdIHN0b3JlIGV2ZXJ5IDQgc2Vjb25kcy4gSWYgdGhlIHByaW1hcnkgY2xpZW50IGZhaWxzIHRvXG4gKiB1cGRhdGUgdGhpcyBlbnRyeSwgYW5vdGhlciBjbGllbnQgY2FuIGFjcXVpcmUgdGhlIGxlYXNlIGFuZCB0YWtlIG92ZXIgYXNcbiAqIHByaW1hcnkuXG4gKlxuICogU29tZSBwZXJzaXN0ZW5jZSBvcGVyYXRpb25zIGluIHRoZSBTREsgYXJlIGRlc2lnbmF0ZWQgYXMgcHJpbWFyeS1jbGllbnQgb25seVxuICogb3BlcmF0aW9ucy4gVGhpcyBpbmNsdWRlcyB0aGUgYWNrbm93bGVkZ21lbnQgb2YgbXV0YXRpb25zIGFuZCBhbGwgdXBkYXRlcyBvZlxuICogcmVtb3RlIGRvY3VtZW50cy4gVGhlIGVmZmVjdHMgb2YgdGhlc2Ugb3BlcmF0aW9ucyBhcmUgd3JpdHRlbiB0byBwZXJzaXN0ZW5jZVxuICogYW5kIHRoZW4gYnJvYWRjYXN0IHRvIG90aGVyIHRhYnMgdmlhIExvY2FsU3RvcmFnZSAoc2VlXG4gKiBgV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlYCksIHdoaWNoIHRoZW4gcmVmcmVzaCB0aGVpciBzdGF0ZSBmcm9tXG4gKiBwZXJzaXN0ZW5jZS5cbiAqXG4gKiBTaW1pbGFybHksIHRoZSBwcmltYXJ5IGNsaWVudCBsaXN0ZW5zIHRvIG5vdGlmaWNhdGlvbnMgc2VudCBieSBzZWNvbmRhcnlcbiAqIGNsaWVudHMgdG8gZGlzY292ZXIgcGVyc2lzdGVuY2UgY2hhbmdlcyB3cml0dGVuIGJ5IHNlY29uZGFyeSBjbGllbnRzLCBzdWNoIGFzXG4gKiB0aGUgYWRkaXRpb24gb2YgbmV3IG11dGF0aW9ucyBhbmQgcXVlcnkgdGFyZ2V0cy5cbiAqXG4gKiBJZiBtdWx0aS10YWIgaXMgbm90IGVuYWJsZWQgYW5kIGFub3RoZXIgdGFiIGFscmVhZHkgb2J0YWluZWQgdGhlIHByaW1hcnlcbiAqIGxlYXNlLCBJbmRleGVkRGJQZXJzaXN0ZW5jZSBlbnRlcnMgYSBmYWlsZWQgc3RhdGUgYW5kIGFsbCBzdWJzZXF1ZW50XG4gKiBvcGVyYXRpb25zIHdpbGwgYXV0b21hdGljYWxseSBmYWlsLlxuICpcbiAqIEFkZGl0aW9uYWxseSwgdGhlcmUgaXMgYW4gb3B0aW1pemF0aW9uIHNvIHRoYXQgd2hlbiBhIHRhYiBpcyBjbG9zZWQsIHRoZVxuICogcHJpbWFyeSBsZWFzZSBpcyByZWxlYXNlZCBpbW1lZGlhdGVseSAodGhpcyBpcyBlc3BlY2lhbGx5IGltcG9ydGFudCB0byBtYWtlXG4gKiBzdXJlIHRoYXQgYSByZWZyZXNoZWQgdGFiIGlzIGFibGUgdG8gaW1tZWRpYXRlbHkgcmUtYWNxdWlyZSB0aGUgcHJpbWFyeVxuICogbGVhc2UpLiBVbmZvcnR1bmF0ZWx5LCBJbmRleGVkREIgY2Fubm90IGJlIHJlbGlhYmx5IHVzZWQgaW4gd2luZG93LnVubG9hZFxuICogc2luY2UgaXQgaXMgYW4gYXN5bmNocm9ub3VzIEFQSS4gU28gaW4gYWRkaXRpb24gdG8gYXR0ZW1wdGluZyB0byBnaXZlIHVwIHRoZVxuICogbGVhc2UsIHRoZSBsZWFzZWhvbGRlciB3cml0ZXMgaXRzIGNsaWVudCBJRCB0byBhIFwiem9tYmllZENsaWVudFwiIGVudHJ5IGluXG4gKiBMb2NhbFN0b3JhZ2Ugd2hpY2ggYWN0cyBhcyBhbiBpbmRpY2F0b3IgdGhhdCBhbm90aGVyIHRhYiBzaG91bGQgZ28gYWhlYWQgYW5kXG4gKiB0YWtlIHRoZSBwcmltYXJ5IGxlYXNlIGltbWVkaWF0ZWx5IHJlZ2FyZGxlc3Mgb2YgdGhlIGN1cnJlbnQgbGVhc2UgdGltZXN0YW1wLlxuICpcbiAqIFRPRE8oYi8xMTQyMjYyMzQpOiBSZW1vdmUgYHN5bmNocm9uaXplVGFic2Agc2VjdGlvbiB3aGVuIG11bHRpLXRhYiBpcyBub1xuICogbG9uZ2VyIG9wdGlvbmFsLlxuICovXG5jbGFzcyBrbyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0byBzeW5jaHJvbml6ZSB0aGUgaW4tbWVtb3J5IHN0YXRlIG9mIG11bHRpcGxlIHRhYnMgYW5kIHNoYXJlXG4gICAgICogYWNjZXNzIHRvIGxvY2FsIHBlcnNpc3RlbmNlLlxuICAgICAqL1xuICAgIHQsIGUsIG4sIHMsIGksIHIsIG8sIHUsIGMsIFxuICAgIC8qKlxuICAgICAqIElmIHNldCB0byB0cnVlLCBmb3JjZWZ1bGx5IG9idGFpbnMgZGF0YWJhc2UgYWNjZXNzLiBFeGlzdGluZyB0YWJzIHdpbGxcbiAgICAgKiBubyBsb25nZXIgYmUgYWJsZSB0byBhY2Nlc3MgSW5kZXhlZERCLlxuICAgICAqL1xuICAgIGEsIGggPSAxNSkge1xuICAgICAgICBpZiAodGhpcy5hbGxvd1RhYlN5bmNocm9uaXphdGlvbiA9IHQsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBlLCB0aGlzLmNsaWVudElkID0gbiwgXG4gICAgICAgIHRoaXMuSHMgPSBpLCB0aGlzLndpbmRvdyA9IHIsIHRoaXMuZG9jdW1lbnQgPSBvLCB0aGlzLkpzID0gYywgdGhpcy5ZcyA9IGEsIHRoaXMuWHMgPSBoLCBcbiAgICAgICAgdGhpcy5TcyA9IG51bGwsIHRoaXMuRHMgPSAhMSwgdGhpcy5pc1ByaW1hcnkgPSAhMSwgdGhpcy5uZXR3b3JrRW5hYmxlZCA9ICEwLCBcbiAgICAgICAgLyoqIE91ciB3aW5kb3cudW5sb2FkIGhhbmRsZXIsIGlmIHJlZ2lzdGVyZWQuICovXG4gICAgICAgIHRoaXMuWnMgPSBudWxsLCB0aGlzLmluRm9yZWdyb3VuZCA9ICExLCBcbiAgICAgICAgLyoqIE91ciAndmlzaWJpbGl0eWNoYW5nZScgbGlzdGVuZXIgaWYgcmVnaXN0ZXJlZC4gKi9cbiAgICAgICAgdGhpcy50aSA9IG51bGwsIFxuICAgICAgICAvKiogVGhlIGNsaWVudCBtZXRhZGF0YSByZWZyZXNoIHRhc2suICovXG4gICAgICAgIHRoaXMuZWkgPSBudWxsLCBcbiAgICAgICAgLyoqIFRoZSBsYXN0IHRpbWUgd2UgZ2FyYmFnZSBjb2xsZWN0ZWQgdGhlIGNsaWVudCBtZXRhZGF0YSBvYmplY3Qgc3RvcmUuICovXG4gICAgICAgIHRoaXMubmkgPSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFksIFxuICAgICAgICAvKiogQSBsaXN0ZW5lciB0byBub3RpZnkgb24gcHJpbWFyeSBzdGF0ZSBjaGFuZ2VzLiAqL1xuICAgICAgICB0aGlzLnNpID0gdCA9PiBQcm9taXNlLnJlc29sdmUoKSwgIWtvLkMoKSkgdGhyb3cgbmV3IEwoQi5VTklNUExFTUVOVEVELCBcIlRoaXMgcGxhdGZvcm0gaXMgZWl0aGVyIG1pc3NpbmcgSW5kZXhlZERCIG9yIGlzIGtub3duIHRvIGhhdmUgYW4gaW5jb21wbGV0ZSBpbXBsZW1lbnRhdGlvbi4gT2ZmbGluZSBwZXJzaXN0ZW5jZSBoYXMgYmVlbiBkaXNhYmxlZC5cIik7XG4gICAgICAgIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSBuZXcgb28odGhpcywgcyksIHRoaXMuaWkgPSBlICsgXCJtYWluXCIsIHRoaXMueXQgPSBuZXcgSGkodSksIFxuICAgICAgICB0aGlzLnJpID0gbmV3IGJ0KHRoaXMuaWksIHRoaXMuWHMsIG5ldyBDbyh0aGlzLnl0KSksIHRoaXMuQ3MgPSBuZXcgWHIodGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSwgdGhpcy55dCksIFxuICAgICAgICB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUgPSBobyh0aGlzLnl0KSwgdGhpcy5OcyA9IG5ldyBjciwgdGhpcy53aW5kb3cgJiYgdGhpcy53aW5kb3cubG9jYWxTdG9yYWdlID8gdGhpcy5vaSA9IHRoaXMud2luZG93LmxvY2FsU3RvcmFnZSA6ICh0aGlzLm9pID0gbnVsbCwgXG4gICAgICAgICExID09PSBhICYmIHgoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIkxvY2FsU3RvcmFnZSBpcyB1bmF2YWlsYWJsZS4gQXMgYSByZXN1bHQsIHBlcnNpc3RlbmNlIG1heSBub3Qgd29yayByZWxpYWJseS4gSW4gcGFydGljdWxhciBlbmFibGVQZXJzaXN0ZW5jZSgpIGNvdWxkIGZhaWwgaW1tZWRpYXRlbHkgYWZ0ZXIgcmVmcmVzaGluZyB0aGUgcGFnZS5cIikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBdHRlbXB0IHRvIHN0YXJ0IEluZGV4ZWREYiBwZXJzaXN0ZW5jZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFdoZXRoZXIgcGVyc2lzdGVuY2Ugd2FzIGVuYWJsZWQuXG4gICAgICovICAgIHN0YXJ0KCkge1xuICAgICAgICAvLyBOT1RFOiBUaGlzIGlzIGV4cGVjdGVkIHRvIGZhaWwgc29tZXRpbWVzIChpbiB0aGUgY2FzZSBvZiBhbm90aGVyIHRhYlxuICAgICAgICAvLyBhbHJlYWR5IGhhdmluZyB0aGUgcGVyc2lzdGVuY2UgbG9jayksIHNvIGl0J3MgdGhlIGZpcnN0IHRoaW5nIHdlIHNob3VsZFxuICAgICAgICAvLyBkby5cbiAgICAgICAgcmV0dXJuIHRoaXMudWkoKS50aGVuKCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNQcmltYXJ5ICYmICF0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uKSBcbiAgICAgICAgICAgIC8vIEZhaWwgYHN0YXJ0KClgIGlmIGBzeW5jaHJvbml6ZVRhYnNgIGlzIGRpc2FibGVkIGFuZCB3ZSBjYW5ub3RcbiAgICAgICAgICAgIC8vIG9idGFpbiB0aGUgcHJpbWFyeSBsZWFzZS5cbiAgICAgICAgICAgIHRocm93IG5ldyBMKEIuRkFJTEVEX1BSRUNPTkRJVElPTiwgTm8pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2koKSwgdGhpcy5haSgpLCB0aGlzLmhpKCksIHRoaXMucnVuVHJhbnNhY3Rpb24oXCJnZXRIaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXJcIiwgXCJyZWFkb25seVwiLCAodCA9PiB0aGlzLkNzLmdldEhpZ2hlc3RTZXF1ZW5jZU51bWJlcih0KSkpO1xuICAgICAgICB9KSkudGhlbigodCA9PiB7XG4gICAgICAgICAgICB0aGlzLlNzID0gbmV3IE90KHQsIHRoaXMuSnMpO1xuICAgICAgICB9KSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5EcyA9ICEwO1xuICAgICAgICB9KSkuY2F0Y2goKHQgPT4gKHRoaXMucmkgJiYgdGhpcy5yaS5jbG9zZSgpLCBQcm9taXNlLnJlamVjdCh0KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBwcmltYXJ5IHN0YXRlIG9mIHRoZVxuICAgICAqIGluc3RhbmNlIGNoYW5nZXMuIFVwb24gcmVnaXN0ZXJpbmcsIHRoaXMgbGlzdGVuZXIgaXMgaW52b2tlZCBpbW1lZGlhdGVseVxuICAgICAqIHdpdGggdGhlIGN1cnJlbnQgcHJpbWFyeSBzdGF0ZS5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIGxpKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2kgPSBhc3luYyBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHJldHVybiB0KGUpO1xuICAgICAgICB9LCB0KHRoaXMuaXNQcmltYXJ5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVnaXN0ZXJzIGEgbGlzdGVuZXIgdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBkYXRhYmFzZSByZWNlaXZlcyBhXG4gICAgICogdmVyc2lvbiBjaGFuZ2UgZXZlbnQgaW5kaWNhdGluZyB0aGF0IGl0IGhhcyBkZWxldGVkLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIodCkge1xuICAgICAgICB0aGlzLnJpLkwoKGFzeW5jIGUgPT4ge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW4gYXR0ZW1wdCBpcyBtYWRlIHRvIGRlbGV0ZSBJbmRleGVkREIuXG4gICAgICAgICAgICBudWxsID09PSBlLm5ld1ZlcnNpb24gJiYgYXdhaXQgdCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkanVzdHMgdGhlIGN1cnJlbnQgbmV0d29yayBzdGF0ZSBpbiB0aGUgY2xpZW50J3MgbWV0YWRhdGEsIHBvdGVudGlhbGx5XG4gICAgICogYWZmZWN0aW5nIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAqXG4gICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgV2ViIG11bHRpLXRhYi5cbiAgICAgKi8gICAgc2V0TmV0d29ya0VuYWJsZWQodCkge1xuICAgICAgICB0aGlzLm5ldHdvcmtFbmFibGVkICE9PSB0ICYmICh0aGlzLm5ldHdvcmtFbmFibGVkID0gdCwgXG4gICAgICAgIC8vIFNjaGVkdWxlIGEgcHJpbWFyeSBsZWFzZSByZWZyZXNoIGZvciBpbW1lZGlhdGUgZXhlY3V0aW9uLiBUaGUgZXZlbnR1YWxcbiAgICAgICAgLy8gbGVhc2UgdXBkYXRlIHdpbGwgYmUgcHJvcGFnYXRlZCB2aWEgYHByaW1hcnlTdGF0ZUxpc3RlbmVyYC5cbiAgICAgICAgdGhpcy5Icy5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgJiYgYXdhaXQgdGhpcy51aSgpO1xuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBjbGllbnQgbWV0YWRhdGEgaW4gSW5kZXhlZERiIGFuZCBhdHRlbXB0cyB0byBlaXRoZXIgb2J0YWluIG9yXG4gICAgICogZXh0ZW5kIHRoZSBwcmltYXJ5IGxlYXNlIGZvciB0aGUgbG9jYWwgY2xpZW50LiBBc3luY2hyb25vdXNseSBub3RpZmllcyB0aGVcbiAgICAgKiBwcmltYXJ5IHN0YXRlIGxpc3RlbmVyIGlmIHRoZSBjbGllbnQgZWl0aGVyIG5ld2x5IG9idGFpbmVkIG9yIHJlbGVhc2VkIGl0c1xuICAgICAqIHByaW1hcnkgbGVhc2UuXG4gICAgICovICAgIHVpKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcInVwZGF0ZUNsaWVudE1ldGFkYXRhQW5kVHJ5QmVjb21lUHJpbWFyeVwiLCBcInJlYWR3cml0ZVwiLCAodCA9PiBNbyh0KS5wdXQoe1xuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICB1cGRhdGVUaW1lTXM6IERhdGUubm93KCksXG4gICAgICAgICAgICBuZXR3b3JrRW5hYmxlZDogdGhpcy5uZXR3b3JrRW5hYmxlZCxcbiAgICAgICAgICAgIGluRm9yZWdyb3VuZDogdGhpcy5pbkZvcmVncm91bmRcbiAgICAgICAgfSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNQcmltYXJ5KSByZXR1cm4gdGhpcy5maSh0KS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICB0IHx8ICh0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLkhzLmVucXVldWVSZXRyeWFibGUoKCgpID0+IHRoaXMuc2koITEpKSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy5kaSh0KSkpLm5leHQoKGUgPT4gdGhpcy5pc1ByaW1hcnkgJiYgIWUgPyB0aGlzLl9pKHQpLm5leHQoKCgpID0+ICExKSkgOiAhIWUgJiYgdGhpcy53aSh0KS5uZXh0KCgoKSA9PiAhMCkpKSkpKS5jYXRjaCgodCA9PiB7XG4gICAgICAgICAgICBpZiAoVnQodCkpIFxuICAgICAgICAgICAgLy8gUHJvY2VlZCB3aXRoIHRoZSBleGlzdGluZyBzdGF0ZS4gQW55IHN1YnNlcXVlbnQgYWNjZXNzIHRvXG4gICAgICAgICAgICAvLyBJbmRleGVkREIgd2lsbCB2ZXJpZnkgdGhlIGxlYXNlLlxuICAgICAgICAgICAgcmV0dXJuIEMoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIkZhaWxlZCB0byBleHRlbmQgb3duZXIgbGVhc2U6IFwiLCB0KSwgdGhpcy5pc1ByaW1hcnk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIHRocm93IHQ7XG4gICAgICAgICAgICByZXR1cm4gQyhcIkluZGV4ZWREYlBlcnNpc3RlbmNlXCIsIFwiUmVsZWFzaW5nIG93bmVyIGxlYXNlIGFmdGVyIGVycm9yIGR1cmluZyBsZWFzZSByZWZyZXNoXCIsIHQpLCBcbiAgICAgICAgICAgIC8qIGlzUHJpbWFyeT0gKi8gITE7XG4gICAgICAgIH0pKS50aGVuKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNQcmltYXJ5ICE9PSB0ICYmIHRoaXMuSHMuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdGhpcy5zaSh0KSkpLCB0aGlzLmlzUHJpbWFyeSA9IHQ7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZmkodCkge1xuICAgICAgICByZXR1cm4gT28odCkuZ2V0KFwib3duZXJcIikubmV4dCgodCA9PiBBdC5yZXNvbHZlKHRoaXMubWkodCkpKSk7XG4gICAgfVxuICAgIGdpKHQpIHtcbiAgICAgICAgcmV0dXJuIE1vKHQpLmRlbGV0ZSh0aGlzLmNsaWVudElkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGdhcmJhZ2UgY29sbGVjdGlvbiB0aHJlc2hvbGQgaGFzIHBhc3NlZCwgcHJ1bmVzIHRoZVxuICAgICAqIFJlbW90ZURvY3VtZW50Q2hhbmdlcyBhbmQgdGhlIENsaWVudE1ldGFkYXRhIHN0b3JlIGJhc2VkIG9uIHRoZSBsYXN0IHVwZGF0ZVxuICAgICAqIHRpbWUgb2YgYWxsIGNsaWVudHMuXG4gICAgICovICAgIGFzeW5jIHlpKCkge1xuICAgICAgICBpZiAodGhpcy5pc1ByaW1hcnkgJiYgIXRoaXMucGkodGhpcy5uaSwgMThlNSkpIHtcbiAgICAgICAgICAgIHRoaXMubmkgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgY29uc3QgdCA9IGF3YWl0IHRoaXMucnVuVHJhbnNhY3Rpb24oXCJtYXliZUdhcmJhZ2VDb2xsZWN0TXVsdGlDbGllbnRTdGF0ZVwiLCBcInJlYWR3cml0ZS1wcmltYXJ5XCIsICh0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gR2kodCwgXCJjbGllbnRNZXRhZGF0YVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZS5XKCkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLklpKHQsIDE4ZTUpLCBzID0gdC5maWx0ZXIoKHQgPT4gLTEgPT09IG4uaW5kZXhPZih0KSkpO1xuICAgICAgICAgICAgICAgICAgICAvLyBEZWxldGUgbWV0YWRhdGEgZm9yIGNsaWVudHMgdGhhdCBhcmUgbm8gbG9uZ2VyIGNvbnNpZGVyZWQgYWN0aXZlLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gQXQuZm9yRWFjaChzLCAodCA9PiBlLmRlbGV0ZSh0LmNsaWVudElkKSkpLm5leHQoKCgpID0+IHMpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSkuY2F0Y2goKCgpID0+IFtdKSk7XG4gICAgICAgICAgICAvLyBEZWxldGUgcG90ZW50aWFsIGxlZnRvdmVyIGVudHJpZXMgdGhhdCBtYXkgY29udGludWUgdG8gbWFyayB0aGVcbiAgICAgICAgICAgIC8vIGluYWN0aXZlIGNsaWVudHMgYXMgem9tYmllZCBpbiBMb2NhbFN0b3JhZ2UuXG4gICAgICAgICAgICAvLyBJZGVhbGx5IHdlJ2QgZGVsZXRlIHRoZSBJbmRleGVkRGIgYW5kIExvY2FsU3RvcmFnZSB6b21iaWUgZW50cmllcyBmb3JcbiAgICAgICAgICAgIC8vIHRoZSBjbGllbnQgYXRvbWljYWxseSwgYnV0IHdlIGNhbid0LiBTbyB3ZSBvcHQgdG8gZGVsZXRlIHRoZSBJbmRleGVkRGJcbiAgICAgICAgICAgIC8vIGVudHJpZXMgZmlyc3QgdG8gYXZvaWQgcG90ZW50aWFsbHkgcmV2aXZpbmcgYSB6b21iaWVkIGNsaWVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9pKSBmb3IgKGNvbnN0IGUgb2YgdCkgdGhpcy5vaS5yZW1vdmVJdGVtKHRoaXMuVGkoZS5jbGllbnRJZCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNjaGVkdWxlcyBhIHJlY3VycmluZyB0aW1lciB0byB1cGRhdGUgdGhlIGNsaWVudCBtZXRhZGF0YSBhbmQgdG8gZWl0aGVyXG4gICAgICogZXh0ZW5kIG9yIGFjcXVpcmUgdGhlIHByaW1hcnkgbGVhc2UgaWYgdGhlIGNsaWVudCBpcyBlbGlnaWJsZS5cbiAgICAgKi8gICAgaGkoKSB7XG4gICAgICAgIHRoaXMuZWkgPSB0aGlzLkhzLmVucXVldWVBZnRlckRlbGF5KFwiY2xpZW50X21ldGFkYXRhX3JlZnJlc2hcIiAvKiBUaW1lcklkLkNsaWVudE1ldGFkYXRhUmVmcmVzaCAqLyAsIDRlMywgKCgpID0+IHRoaXMudWkoKS50aGVuKCgoKSA9PiB0aGlzLnlpKCkpKS50aGVuKCgoKSA9PiB0aGlzLmhpKCkpKSkpO1xuICAgIH1cbiAgICAvKiogQ2hlY2tzIHdoZXRoZXIgYGNsaWVudGAgaXMgdGhlIGxvY2FsIGNsaWVudC4gKi8gICAgbWkodCkge1xuICAgICAgICByZXR1cm4gISF0ICYmIHQub3duZXJJZCA9PT0gdGhpcy5jbGllbnRJZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXZhbHVhdGUgdGhlIHN0YXRlIG9mIGFsbCBhY3RpdmUgY2xpZW50cyBhbmQgZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGxvY2FsXG4gICAgICogY2xpZW50IGlzIG9yIGNhbiBhY3QgYXMgdGhlIGhvbGRlciBvZiB0aGUgcHJpbWFyeSBsZWFzZS4gUmV0dXJucyB3aGV0aGVyXG4gICAgICogdGhlIGNsaWVudCBpcyBlbGlnaWJsZSBmb3IgdGhlIGxlYXNlLCBidXQgZG9lcyBub3QgYWN0dWFsbHkgYWNxdWlyZSBpdC5cbiAgICAgKiBNYXkgcmV0dXJuICdmYWxzZScgZXZlbiBpZiB0aGVyZSBpcyBubyBhY3RpdmUgbGVhc2Vob2xkZXIgYW5kIGFub3RoZXJcbiAgICAgKiAoZm9yZWdyb3VuZCkgY2xpZW50IHNob3VsZCBiZWNvbWUgbGVhc2Vob2xkZXIgaW5zdGVhZC5cbiAgICAgKi8gICAgZGkodCkge1xuICAgICAgICBpZiAodGhpcy5ZcykgcmV0dXJuIEF0LnJlc29sdmUoITApO1xuICAgICAgICByZXR1cm4gT28odCkuZ2V0KFwib3duZXJcIikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAvLyBBIGNsaWVudCBpcyBlbGlnaWJsZSBmb3IgdGhlIHByaW1hcnkgbGVhc2UgaWY6XG4gICAgICAgICAgICAvLyAtIGl0cyBuZXR3b3JrIGlzIGVuYWJsZWQgYW5kIHRoZSBjbGllbnQncyB0YWIgaXMgaW4gdGhlIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIGl0cyBuZXR3b3JrIGlzIGVuYWJsZWQgYW5kIG5vIG90aGVyIGNsaWVudCdzIHRhYiBpcyBpbiB0aGVcbiAgICAgICAgICAgIC8vICAgZm9yZWdyb3VuZC5cbiAgICAgICAgICAgIC8vIC0gZXZlcnkgY2xpZW50cyBuZXR3b3JrIGlzIGRpc2FibGVkIGFuZCB0aGUgY2xpZW50J3MgdGFiIGlzIGluIHRoZVxuICAgICAgICAgICAgLy8gICBmb3JlZ3JvdW5kLlxuICAgICAgICAgICAgLy8gLSBldmVyeSBjbGllbnRzIG5ldHdvcmsgaXMgZGlzYWJsZWQgYW5kIG5vIG90aGVyIGNsaWVudCdzIHRhYiBpcyBpblxuICAgICAgICAgICAgLy8gICB0aGUgZm9yZWdyb3VuZC5cbiAgICAgICAgICAgIC8vIC0gdGhlIGBmb3JjZU93bmluZ1RhYmAgc2V0dGluZyB3YXMgcGFzc2VkIGluLlxuICAgICAgICAgICAgaWYgKG51bGwgIT09IGUgJiYgdGhpcy5waShlLmxlYXNlVGltZXN0YW1wTXMsIDVlMykgJiYgIXRoaXMuRWkoZS5vd25lcklkKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1pKGUpICYmIHRoaXMubmV0d29ya0VuYWJsZWQpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubWkoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlLmFsbG93VGFiU3luY2hyb25pemF0aW9uKSBcbiAgICAgICAgICAgICAgICAgICAgLy8gRmFpbCB0aGUgYGNhbkFjdEFzUHJpbWFyeWAgY2hlY2sgaWYgdGhlIGN1cnJlbnQgbGVhc2Vob2xkZXIgaGFzXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdCBvcHRlZCBpbnRvIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24uIElmIHRoaXMgaGFwcGVucyBhdFxuICAgICAgICAgICAgICAgICAgICAvLyBjbGllbnQgc3RhcnR1cCwgd2UgcmVqZWN0IHRoZSBQcm9taXNlIHJldHVybmVkIGJ5XG4gICAgICAgICAgICAgICAgICAgIC8vIGBlbmFibGVQZXJzaXN0ZW5jZSgpYCBhbmQgdGhlIHVzZXIgY2FuIGNvbnRpbnVlIHRvIHVzZSBGaXJlc3RvcmVcbiAgICAgICAgICAgICAgICAgICAgLy8gd2l0aCBpbi1tZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgZmFpbHMgZHVyaW5nIGEgbGVhc2UgcmVmcmVzaCwgd2Ugd2lsbCBpbnN0ZWFkIGJsb2NrIHRoZVxuICAgICAgICAgICAgICAgICAgICAvLyBBc3luY1F1ZXVlIGZyb20gZXhlY3V0aW5nIGZ1cnRoZXIgb3BlcmF0aW9ucy4gTm90ZSB0aGF0IHRoaXMgaXNcbiAgICAgICAgICAgICAgICAgICAgLy8gYWNjZXB0YWJsZSBzaW5jZSBtaXhpbmcgJiBtYXRjaGluZyBkaWZmZXJlbnQgYHN5bmNocm9uaXplVGFic2BcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0dGluZ3MgaXMgbm90IHN1cHBvcnRlZC5cbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyhiLzExNDIyNjIzNCk6IFJlbW92ZSB0aGlzIGNoZWNrIHdoZW4gYHN5bmNocm9uaXplVGFic2AgY2FuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGxvbmdlciBiZSB0dXJuZWQgb2ZmLlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTChCLkZBSUxFRF9QUkVDT05ESVRJT04sIE5vKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAhKCF0aGlzLm5ldHdvcmtFbmFibGVkIHx8ICF0aGlzLmluRm9yZWdyb3VuZCkgfHwgTW8odCkuVygpLm5leHQoKHQgPT4gdm9pZCAwID09PSB0aGlzLklpKHQsIDVlMykuZmluZCgodCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xpZW50SWQgIT09IHQuY2xpZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9ICF0aGlzLm5ldHdvcmtFbmFibGVkICYmIHQubmV0d29ya0VuYWJsZWQsIG4gPSAhdGhpcy5pbkZvcmVncm91bmQgJiYgdC5pbkZvcmVncm91bmQsIHMgPSB0aGlzLm5ldHdvcmtFbmFibGVkID09PSB0Lm5ldHdvcmtFbmFibGVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSB8fCBuICYmIHMpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH0pKS5uZXh0KCh0ID0+ICh0aGlzLmlzUHJpbWFyeSAhPT0gdCAmJiBDKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgYENsaWVudCAke3QgPyBcImlzXCIgOiBcImlzIG5vdFwifSBlbGlnaWJsZSBmb3IgYSBwcmltYXJ5IGxlYXNlLmApLCBcbiAgICAgICAgdCkpKTtcbiAgICB9XG4gICAgYXN5bmMgc2h1dGRvd24oKSB7XG4gICAgICAgIC8vIFRoZSBzaHV0ZG93bigpIG9wZXJhdGlvbnMgYXJlIGlkZW1wb3RlbnQgYW5kIGNhbiBiZSBjYWxsZWQgZXZlbiB3aGVuXG4gICAgICAgIC8vIHN0YXJ0KCkgYWJvcnRlZCAoZS5nLiBiZWNhdXNlIGl0IGNvdWxkbid0IGFjcXVpcmUgdGhlIHBlcnNpc3RlbmNlIGxlYXNlKS5cbiAgICAgICAgdGhpcy5EcyA9ICExLCB0aGlzLkFpKCksIHRoaXMuZWkgJiYgKHRoaXMuZWkuY2FuY2VsKCksIHRoaXMuZWkgPSBudWxsKSwgdGhpcy5SaSgpLCBcbiAgICAgICAgdGhpcy5iaSgpLCBcbiAgICAgICAgLy8gVXNlIGBTaW1wbGVEYi5ydW5UcmFuc2FjdGlvbmAgZGlyZWN0bHkgdG8gYXZvaWQgZmFpbGluZyBpZiBhbm90aGVyIHRhYlxuICAgICAgICAvLyBoYXMgb2J0YWluZWQgdGhlIHByaW1hcnkgbGVhc2UuXG4gICAgICAgIGF3YWl0IHRoaXMucmkucnVuVHJhbnNhY3Rpb24oXCJzaHV0ZG93blwiLCBcInJlYWR3cml0ZVwiLCBbIFwib3duZXJcIiwgXCJjbGllbnRNZXRhZGF0YVwiIF0sICh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgS2kodCwgT3QuYXQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2koZSkubmV4dCgoKCkgPT4gdGhpcy5naShlKSkpO1xuICAgICAgICB9KSksIHRoaXMucmkuY2xvc2UoKSwgXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgZW50cnkgbWFya2luZyB0aGUgY2xpZW50IGFzIHpvbWJpZWQgZnJvbSBMb2NhbFN0b3JhZ2Ugc2luY2VcbiAgICAgICAgLy8gd2Ugc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgaXRzIG1ldGFkYXRhIGZyb20gSW5kZXhlZERiLlxuICAgICAgICB0aGlzLlBpKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgY2xpZW50cyB0aGF0IGFyZSBub3Qgem9tYmllZCBhbmQgaGF2ZSBhbiB1cGRhdGVUaW1lIHdpdGhpbiB0aGVcbiAgICAgKiBwcm92aWRlZCB0aHJlc2hvbGQuXG4gICAgICovICAgIElpKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIHQuZmlsdGVyKCh0ID0+IHRoaXMucGkodC51cGRhdGVUaW1lTXMsIGUpICYmICF0aGlzLkVpKHQuY2xpZW50SWQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIElEcyBvZiB0aGUgY2xpZW50cyB0aGF0IGFyZSBjdXJyZW50bHkgYWN0aXZlLiBJZiBtdWx0aS10YWJcbiAgICAgKiBpcyBub3Qgc3VwcG9ydGVkLCByZXR1cm5zIGFuIGFycmF5IHRoYXQgb25seSBjb250YWlucyB0aGUgbG9jYWwgY2xpZW50J3NcbiAgICAgKiBJRC5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIHZpKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEFjdGl2ZUNsaWVudHNcIiwgXCJyZWFkb25seVwiLCAodCA9PiBNbyh0KS5XKCkubmV4dCgodCA9PiB0aGlzLklpKHQsIDE4ZTUpLm1hcCgodCA9PiB0LmNsaWVudElkKSkpKSkpO1xuICAgIH1cbiAgICBnZXQgc3RhcnRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuRHM7XG4gICAgfVxuICAgIGdldE11dGF0aW9uUXVldWUodCwgZSkge1xuICAgICAgICByZXR1cm4ganIucmUodCwgdGhpcy55dCwgZSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSk7XG4gICAgfVxuICAgIGdldFRhcmdldENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5DcztcbiAgICB9XG4gICAgZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZTtcbiAgICB9XG4gICAgZ2V0SW5kZXhNYW5hZ2VyKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNcih0LCB0aGlzLnl0LmllLmRhdGFiYXNlSWQpO1xuICAgIH1cbiAgICBnZXREb2N1bWVudE92ZXJsYXlDYWNoZSh0KSB7XG4gICAgICAgIHJldHVybiBsci5yZSh0aGlzLnl0LCB0KTtcbiAgICB9XG4gICAgZ2V0QnVuZGxlQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLk5zO1xuICAgIH1cbiAgICBydW5UcmFuc2FjdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIEMoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIlN0YXJ0aW5nIHRyYW5zYWN0aW9uOlwiLCB0KTtcbiAgICAgICAgY29uc3QgcyA9IFwicmVhZG9ubHlcIiA9PT0gZSA/IFwicmVhZG9ubHlcIiA6IFwicmVhZHdyaXRlXCIsIGkgPSAxNSA9PT0gKHIgPSB0aGlzLlhzKSA/IFVpIDogMTQgPT09IHIgPyBxaSA6IDEzID09PSByID8gTGkgOiAxMiA9PT0gciA/IEJpIDogMTEgPT09IHIgPyAkaSA6IHZvaWQgTygpO1xuICAgICAgICAvKiogUmV0dXJucyB0aGUgb2JqZWN0IHN0b3JlcyBmb3IgdGhlIHByb3ZpZGVkIHNjaGVtYS4gKi9cbiAgICAgICAgdmFyIHI7XG4gICAgICAgIGxldCBvO1xuICAgICAgICAvLyBEbyBhbGwgdHJhbnNhY3Rpb25zIGFzIHJlYWR3cml0ZSBhZ2FpbnN0IGFsbCBvYmplY3Qgc3RvcmVzLCBzaW5jZSB3ZVxuICAgICAgICAvLyBhcmUgdGhlIG9ubHkgcmVhZGVyL3dyaXRlci5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yaS5ydW5UcmFuc2FjdGlvbih0LCBzLCBpLCAocyA9PiAobyA9IG5ldyBLaShzLCB0aGlzLlNzID8gdGhpcy5Tcy5uZXh0KCkgOiBPdC5hdCksIFxuICAgICAgICBcInJlYWR3cml0ZS1wcmltYXJ5XCIgPT09IGUgPyB0aGlzLmZpKG8pLm5leHQoKHQgPT4gISF0IHx8IHRoaXMuZGkobykpKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmICghZSkgdGhyb3cgeChgRmFpbGVkIHRvIG9idGFpbiBwcmltYXJ5IGxlYXNlIGZvciBhY3Rpb24gJyR7dH0nLmApLCB0aGlzLmlzUHJpbWFyeSA9ICExLCBcbiAgICAgICAgICAgIHRoaXMuSHMuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdGhpcy5zaSghMSkpKSwgbmV3IEwoQi5GQUlMRURfUFJFQ09ORElUSU9OLCBJdCk7XG4gICAgICAgICAgICByZXR1cm4gbihvKTtcbiAgICAgICAgfSkpLm5leHQoKHQgPT4gdGhpcy53aShvKS5uZXh0KCgoKSA9PiB0KSkpKSA6IHRoaXMuVmkobykubmV4dCgoKCkgPT4gbihvKSkpKSkpLnRoZW4oKHQgPT4gKG8ucmFpc2VPbkNvbW1pdHRlZEV2ZW50KCksIFxuICAgICAgICB0KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWZXJpZmllcyB0aGF0IHRoZSBjdXJyZW50IHRhYiBpcyB0aGUgcHJpbWFyeSBsZWFzZWhvbGRlciBvciBhbHRlcm5hdGl2ZWx5XG4gICAgICogdGhhdCB0aGUgbGVhc2Vob2xkZXIgaGFzIG9wdGVkIGludG8gbXVsdGktdGFiIHN5bmNocm9uaXphdGlvbi5cbiAgICAgKi9cbiAgICAvLyBUT0RPKGIvMTE0MjI2MjM0KTogUmVtb3ZlIHRoaXMgY2hlY2sgd2hlbiBgc3luY2hyb25pemVUYWJzYCBjYW4gbm8gbG9uZ2VyXG4gICAgLy8gYmUgdHVybmVkIG9mZi5cbiAgICBWaSh0KSB7XG4gICAgICAgIHJldHVybiBPbyh0KS5nZXQoXCJvd25lclwiKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0ICYmIHRoaXMucGkodC5sZWFzZVRpbWVzdGFtcE1zLCA1ZTMpICYmICF0aGlzLkVpKHQub3duZXJJZCkgJiYgIXRoaXMubWkodCkgJiYgISh0aGlzLllzIHx8IHRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24gJiYgdC5hbGxvd1RhYlN5bmNocm9uaXphdGlvbikpIHRocm93IG5ldyBMKEIuRkFJTEVEX1BSRUNPTkRJVElPTiwgTm8pO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9idGFpbnMgb3IgZXh0ZW5kcyB0aGUgbmV3IHByaW1hcnkgbGVhc2UgZm9yIHRoZSBsb2NhbCBjbGllbnQuIFRoaXNcbiAgICAgKiBtZXRob2QgZG9lcyBub3QgdmVyaWZ5IHRoYXQgdGhlIGNsaWVudCBpcyBlbGlnaWJsZSBmb3IgdGhpcyBsZWFzZS5cbiAgICAgKi8gICAgd2kodCkge1xuICAgICAgICBjb25zdCBlID0ge1xuICAgICAgICAgICAgb3duZXJJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgICAgICAgIGFsbG93VGFiU3luY2hyb25pemF0aW9uOiB0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uLFxuICAgICAgICAgICAgbGVhc2VUaW1lc3RhbXBNczogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gT28odCkucHV0KFwib3duZXJcIiwgZSk7XG4gICAgfVxuICAgIHN0YXRpYyBDKCkge1xuICAgICAgICByZXR1cm4gYnQuQygpO1xuICAgIH1cbiAgICAvKiogQ2hlY2tzIHRoZSBwcmltYXJ5IGxlYXNlIGFuZCByZW1vdmVzIGl0IGlmIHdlIGFyZSB0aGUgY3VycmVudCBwcmltYXJ5LiAqLyAgICBfaSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBPbyh0KTtcbiAgICAgICAgcmV0dXJuIGUuZ2V0KFwib3duZXJcIikubmV4dCgodCA9PiB0aGlzLm1pKHQpID8gKEMoXCJJbmRleGVkRGJQZXJzaXN0ZW5jZVwiLCBcIlJlbGVhc2luZyBwcmltYXJ5IGxlYXNlLlwiKSwgXG4gICAgICAgIGUuZGVsZXRlKFwib3duZXJcIikpIDogQXQucmVzb2x2ZSgpKSk7XG4gICAgfVxuICAgIC8qKiBWZXJpZmllcyB0aGF0IGB1cGRhdGVUaW1lTXNgIGlzIHdpdGhpbiBgbWF4QWdlTXNgLiAqLyAgICBwaSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBEYXRlLm5vdygpO1xuICAgICAgICByZXR1cm4gISh0IDwgbiAtIGUpICYmICghKHQgPiBuKSB8fCAoeChgRGV0ZWN0ZWQgYW4gdXBkYXRlIHRpbWUgdGhhdCBpcyBpbiB0aGUgZnV0dXJlOiAke3R9ID4gJHtufWApLCBcbiAgICAgICAgITEpKTtcbiAgICB9XG4gICAgY2koKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuZG9jdW1lbnQgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB0aGlzLmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJiYgKHRoaXMudGkgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLkhzLmVucXVldWVBbmRGb3JnZXQoKCgpID0+ICh0aGlzLmluRm9yZWdyb3VuZCA9IFwidmlzaWJsZVwiID09PSB0aGlzLmRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSwgXG4gICAgICAgICAgICB0aGlzLnVpKCkpKSk7XG4gICAgICAgIH0sIHRoaXMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy50aSksIHRoaXMuaW5Gb3JlZ3JvdW5kID0gXCJ2aXNpYmxlXCIgPT09IHRoaXMuZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlKTtcbiAgICB9XG4gICAgUmkoKSB7XG4gICAgICAgIHRoaXMudGkgJiYgKHRoaXMuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy50aSksIHRoaXMudGkgPSBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXR0YWNoZXMgYSB3aW5kb3cudW5sb2FkIGhhbmRsZXIgdGhhdCB3aWxsIHN5bmNocm9ub3VzbHkgd3JpdGUgb3VyXG4gICAgICogY2xpZW50SWQgdG8gYSBcInpvbWJpZSBjbGllbnQgaWRcIiBsb2NhdGlvbiBpbiBMb2NhbFN0b3JhZ2UuIFRoaXMgY2FuIGJlIHVzZWRcbiAgICAgKiBieSB0YWJzIHRyeWluZyB0byBhY3F1aXJlIHRoZSBwcmltYXJ5IGxlYXNlIHRvIGRldGVybWluZSB0aGF0IHRoZSBsZWFzZVxuICAgICAqIGlzIG5vIGxvbmdlciB2YWxpZCBldmVuIGlmIHRoZSB0aW1lc3RhbXAgaXMgcmVjZW50LiBUaGlzIGlzIHBhcnRpY3VsYXJseVxuICAgICAqIGltcG9ydGFudCBmb3IgdGhlIHJlZnJlc2ggY2FzZSAoc28gdGhlIHRhYiBjb3JyZWN0bHkgcmUtYWNxdWlyZXMgdGhlXG4gICAgICogcHJpbWFyeSBsZWFzZSkuIExvY2FsU3RvcmFnZSBpcyB1c2VkIGZvciB0aGlzIHJhdGhlciB0aGFuIEluZGV4ZWREYiBiZWNhdXNlXG4gICAgICogaXQgaXMgYSBzeW5jaHJvbm91cyBBUEkgYW5kIHNvIGNhbiBiZSB1c2VkIHJlbGlhYmx5IGZyb20gIGFuIHVubG9hZFxuICAgICAqIGhhbmRsZXIuXG4gICAgICovICAgIGFpKCkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiAobnVsbCA9PT0gKHQgPSB0aGlzLndpbmRvdykgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC5hZGRFdmVudExpc3RlbmVyKSAmJiAodGhpcy5acyA9ICgpID0+IHtcbiAgICAgICAgICAgIC8vIE5vdGU6IEluIHRoZW9yeSwgdGhpcyBzaG91bGQgYmUgc2NoZWR1bGVkIG9uIHRoZSBBc3luY1F1ZXVlIHNpbmNlIGl0XG4gICAgICAgICAgICAvLyBhY2Nlc3NlcyBpbnRlcm5hbCBzdGF0ZS4gV2UgZXhlY3V0ZSB0aGlzIGNvZGUgZGlyZWN0bHkgZHVyaW5nIHNodXRkb3duXG4gICAgICAgICAgICAvLyB0byBtYWtlIHN1cmUgaXQgZ2V0cyBhIGNoYW5jZSB0byBydW4uXG4gICAgICAgICAgICB0aGlzLkFpKCksIGlzU2FmYXJpKCkgJiYgbmF2aWdhdG9yLmFwcFZlcnNpb24ubWF0Y2goL1ZlcnNpb25cXC8xWzQ1XS8pICYmIFxuICAgICAgICAgICAgLy8gT24gU2FmYXJpIDE0IGFuZCAxNSwgd2UgZG8gbm90IHJ1biBhbnkgY2xlYW51cCBhY3Rpb25zIGFzIGl0IG1pZ2h0XG4gICAgICAgICAgICAvLyB0cmlnZ2VyIGEgYnVnIHRoYXQgcHJldmVudHMgU2FmYXJpIGZyb20gcmUtb3BlbmluZyBJbmRleGVkREIgZHVyaW5nXG4gICAgICAgICAgICAvLyB0aGUgbmV4dCBwYWdlIGxvYWQuXG4gICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTIyNjU0N1xuICAgICAgICAgICAgdGhpcy5Icy5lbnRlclJlc3RyaWN0ZWRNb2RlKC8qIHB1cmdlRXhpc3RpbmdUYXNrcz0gKi8gITApLCB0aGlzLkhzLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IHRoaXMuc2h1dGRvd24oKSkpO1xuICAgICAgICB9LCB0aGlzLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicGFnZWhpZGVcIiwgdGhpcy5acykpO1xuICAgIH1cbiAgICBiaSgpIHtcbiAgICAgICAgdGhpcy5acyAmJiAodGhpcy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInBhZ2VoaWRlXCIsIHRoaXMuWnMpLCB0aGlzLlpzID0gbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciBhIGNsaWVudCBpcyBcInpvbWJpZWRcIiBiYXNlZCBvbiBpdHMgTG9jYWxTdG9yYWdlIGVudHJ5LlxuICAgICAqIENsaWVudHMgYmVjb21lIHpvbWJpZWQgd2hlbiB0aGVpciB0YWIgY2xvc2VzIHdpdGhvdXQgcnVubmluZyBhbGwgb2YgdGhlXG4gICAgICogY2xlYW51cCBsb2dpYyBpbiBgc2h1dGRvd24oKWAuXG4gICAgICovICAgIEVpKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBuID0gbnVsbCAhPT0gKG51bGwgPT09IChlID0gdGhpcy5vaSkgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5nZXRJdGVtKHRoaXMuVGkodCkpKTtcbiAgICAgICAgICAgIHJldHVybiBDKFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgYENsaWVudCAnJHt0fScgJHtuID8gXCJpc1wiIDogXCJpcyBub3RcIn0gem9tYmllZCBpbiBMb2NhbFN0b3JhZ2VgKSwgXG4gICAgICAgICAgICBuO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3Qgd29ya2luZy5cbiAgICAgICAgICAgIHJldHVybiB4KFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgXCJGYWlsZWQgdG8gZ2V0IHpvbWJpZWQgY2xpZW50IGlkLlwiLCB0KSwgITE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVjb3JkIGNsaWVudCBhcyB6b21iaWVkIChhIGNsaWVudCB0aGF0IGhhZCBpdHMgdGFiIGNsb3NlZCkuIFpvbWJpZWRcbiAgICAgKiBjbGllbnRzIGFyZSBpZ25vcmVkIGR1cmluZyBwcmltYXJ5IHRhYiBzZWxlY3Rpb24uXG4gICAgICovICAgIEFpKCkge1xuICAgICAgICBpZiAodGhpcy5vaSkgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMub2kuc2V0SXRlbSh0aGlzLlRpKHRoaXMuY2xpZW50SWQpLCBTdHJpbmcoRGF0ZS5ub3coKSkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3QgYXZhaWxhYmxlIC8gd29ya2luZy5cbiAgICAgICAgICAgIHgoXCJGYWlsZWQgdG8gc2V0IHpvbWJpZSBjbGllbnQgaWQuXCIsIHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoZSB6b21iaWVkIGNsaWVudCBlbnRyeSBpZiBpdCBleGlzdHMuICovICAgIFBpKCkge1xuICAgICAgICBpZiAodGhpcy5vaSkgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMub2kucmVtb3ZlSXRlbSh0aGlzLlRpKHRoaXMuY2xpZW50SWQpKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgLy8gSWdub3JlXG4gICAgICAgIH1cbiAgICB9XG4gICAgVGkodCkge1xuICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV96b21iaWVfJHt0aGlzLnBlcnNpc3RlbmNlS2V5fV8ke3R9YDtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBwcmltYXJ5IGNsaWVudCBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gT28odCkge1xuICAgIHJldHVybiBHaSh0LCBcIm93bmVyXCIpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgY2xpZW50IG1ldGFkYXRhIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBNbyh0KSB7XG4gICAgcmV0dXJuIEdpKHQsIFwiY2xpZW50TWV0YWRhdGFcIik7XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgc3RyaW5nIHVzZWQgYXMgYSBwcmVmaXggd2hlbiBzdG9yaW5nIGRhdGEgaW4gSW5kZXhlZERCIGFuZFxuICogTG9jYWxTdG9yYWdlLlxuICovIGZ1bmN0aW9uIEZvKHQsIGUpIHtcbiAgICAvLyBVc2UgdHdvIGRpZmZlcmVudCBwcmVmaXggZm9ybWF0czpcbiAgICAvLyAgICogZmlyZXN0b3JlIC8gcGVyc2lzdGVuY2VLZXkgLyBwcm9qZWN0SUQgLiBkYXRhYmFzZUlEIC8gLi4uXG4gICAgLy8gICAqIGZpcmVzdG9yZSAvIHBlcnNpc3RlbmNlS2V5IC8gcHJvamVjdElEIC8gLi4uXG4gICAgLy8gcHJvamVjdElEcyBhcmUgRE5TLWNvbXBhdGlibGUgbmFtZXMgYW5kIGNhbm5vdCBjb250YWluIGRvdHNcbiAgICAvLyBzbyB0aGVyZSdzIG5vIGRhbmdlciBvZiBjb2xsaXNpb25zLlxuICAgIGxldCBuID0gdC5wcm9qZWN0SWQ7XG4gICAgcmV0dXJuIHQuaXNEZWZhdWx0RGF0YWJhc2UgfHwgKG4gKz0gXCIuXCIgKyB0LmRhdGFiYXNlKSwgXCJmaXJlc3RvcmUvXCIgKyBlICsgXCIvXCIgKyBuICsgXCIvXCI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgc2V0IG9mIGNoYW5nZXMgdG8gd2hhdCBkb2N1bWVudHMgYXJlIGN1cnJlbnRseSBpbiB2aWV3IGFuZCBvdXQgb2YgdmlldyBmb3JcbiAqIGEgZ2l2ZW4gcXVlcnkuIFRoZXNlIGNoYW5nZXMgYXJlIHNlbnQgdG8gdGhlIExvY2FsU3RvcmUgYnkgdGhlIFZpZXcgKHZpYVxuICogdGhlIFN5bmNFbmdpbmUpIGFuZCBhcmUgdXNlZCB0byBwaW4gLyB1bnBpbiBkb2N1bWVudHMgYXMgYXBwcm9wcmlhdGUuXG4gKi9cbmNsYXNzICRvIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMudGFyZ2V0SWQgPSB0LCB0aGlzLmZyb21DYWNoZSA9IGUsIHRoaXMuU2kgPSBuLCB0aGlzLkRpID0gcztcbiAgICB9XG4gICAgc3RhdGljIENpKHQsIGUpIHtcbiAgICAgICAgbGV0IG4gPSBFcygpLCBzID0gRXMoKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUuZG9jQ2hhbmdlcykgc3dpdGNoICh0LnR5cGUpIHtcbiAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICBuID0gbi5hZGQodC5kb2Mua2V5KTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICBzID0gcy5hZGQodC5kb2Mua2V5KTtcbiAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3ICRvKHQsIGUuZnJvbUNhY2hlLCBuLCBzKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBGaXJlc3RvcmUgcXVlcnkgZW5naW5lLlxuICpcbiAqIEZpcmVzdG9yZSBxdWVyaWVzIGNhbiBiZSBleGVjdXRlZCBpbiB0aHJlZSBtb2Rlcy4gVGhlIFF1ZXJ5IEVuZ2luZSBkZXRlcm1pbmVzXG4gKiB3aGF0IG1vZGUgdG8gdXNlIGJhc2VkIG9uIHdoYXQgZGF0YSBpcyBwZXJzaXN0ZWQuIFRoZSBtb2RlIG9ubHkgZGV0ZXJtaW5lc1xuICogdGhlIHJ1bnRpbWUgY29tcGxleGl0eSBvZiB0aGUgcXVlcnkgLSB0aGUgcmVzdWx0IHNldCBpcyBlcXVpdmFsZW50IGFjcm9zcyBhbGxcbiAqIGltcGxlbWVudGF0aW9ucy5cbiAqXG4gKiBUaGUgUXVlcnkgZW5naW5lIHdpbGwgdXNlIGluZGV4ZWQtYmFzZWQgZXhlY3V0aW9uIGlmIGEgdXNlciBoYXMgY29uZmlndXJlZFxuICogYW55IGluZGV4IHRoYXQgY2FuIGJlIHVzZWQgdG8gZXhlY3V0ZSBxdWVyeSAodmlhIGBzZXRJbmRleENvbmZpZ3VyYXRpb24oKWApLlxuICogT3RoZXJ3aXNlLCB0aGUgZW5naW5lIHdpbGwgdHJ5IHRvIG9wdGltaXplIHRoZSBxdWVyeSBieSByZS11c2luZyBhIHByZXZpb3VzbHlcbiAqIHBlcnNpc3RlZCBxdWVyeSByZXN1bHQuIElmIHRoYXQgaXMgbm90IHBvc3NpYmxlLCB0aGUgcXVlcnkgd2lsbCBiZSBleGVjdXRlZFxuICogdmlhIGEgZnVsbCBjb2xsZWN0aW9uIHNjYW4uXG4gKlxuICogSW5kZXgtYmFzZWQgZXhlY3V0aW9uIGlzIHRoZSBkZWZhdWx0IHdoZW4gYXZhaWxhYmxlLiBUaGUgcXVlcnkgZW5naW5lXG4gKiBzdXBwb3J0cyBwYXJ0aWFsIGluZGV4ZWQgZXhlY3V0aW9uIGFuZCBtZXJnZXMgdGhlIHJlc3VsdCBmcm9tIHRoZSBpbmRleFxuICogbG9va3VwIHdpdGggZG9jdW1lbnRzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gaW5kZXhlZC4gVGhlIGluZGV4IGV2YWx1YXRpb25cbiAqIG1hdGNoZXMgdGhlIGJhY2tlbmQncyBmb3JtYXQgYW5kIGFzIHN1Y2gsIHRoZSBTREsgY2FuIHVzZSBpbmRleGluZyBmb3IgYWxsXG4gKiBxdWVyaWVzIHRoYXQgdGhlIGJhY2tlbmQgc3VwcG9ydHMuXG4gKlxuICogSWYgbm8gaW5kZXggZXhpc3RzLCB0aGUgcXVlcnkgZW5naW5lIHRyaWVzIHRvIHRha2UgYWR2YW50YWdlIG9mIHRoZSB0YXJnZXRcbiAqIGRvY3VtZW50IG1hcHBpbmcgaW4gdGhlIFRhcmdldENhY2hlLiBUaGVzZSBtYXBwaW5ncyBleGlzdHMgZm9yIGFsbCBxdWVyaWVzXG4gKiB0aGF0IGhhdmUgYmVlbiBzeW5jZWQgd2l0aCB0aGUgYmFja2VuZCBhdCBsZWFzdCBvbmNlIGFuZCBhbGxvdyB0aGUgcXVlcnlcbiAqIGVuZ2luZSB0byBvbmx5IHJlYWQgZG9jdW1lbnRzIHRoYXQgcHJldmlvdXNseSBtYXRjaGVkIGEgcXVlcnkgcGx1cyBhbnlcbiAqIGRvY3VtZW50cyB0aGF0IHdlcmUgZWRpdGVkIGFmdGVyIHRoZSBxdWVyeSB3YXMgbGFzdCBsaXN0ZW5lZCB0by5cbiAqXG4gKiBUaGVyZSBhcmUgc29tZSBjYXNlcyB3aGVuIHRoaXMgb3B0aW1pemF0aW9uIGlzIG5vdCBndWFyYW50ZWVkIHRvIHByb2R1Y2VcbiAqIHRoZSBzYW1lIHJlc3VsdHMgYXMgZnVsbCBjb2xsZWN0aW9uIHNjYW5zLiBJbiB0aGVzZSBjYXNlcywgcXVlcnlcbiAqIHByb2Nlc3NpbmcgZmFsbHMgYmFjayB0byBmdWxsIHNjYW5zLiBUaGVzZSBjYXNlcyBhcmU6XG4gKlxuICogLSBMaW1pdCBxdWVyaWVzIHdoZXJlIGEgZG9jdW1lbnQgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSBwcmV2aW91c2x5IG5vIGxvbmdlclxuICogICBtYXRjaGVzIHRoZSBxdWVyeS5cbiAqXG4gKiAtIExpbWl0IHF1ZXJpZXMgd2hlcmUgYSBkb2N1bWVudCBlZGl0IG1heSBjYXVzZSB0aGUgZG9jdW1lbnQgdG8gc29ydCBiZWxvd1xuICogICBhbm90aGVyIGRvY3VtZW50IHRoYXQgaXMgaW4gdGhlIGxvY2FsIGNhY2hlLlxuICpcbiAqIC0gUXVlcmllcyB0aGF0IGhhdmUgbmV2ZXIgYmVlbiBDVVJSRU5UIG9yIGZyZWUgb2YgbGltYm8gZG9jdW1lbnRzLlxuICovIGNsYXNzIEJvIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy54aSA9ICExO1xuICAgIH1cbiAgICAvKiogU2V0cyB0aGUgZG9jdW1lbnQgdmlldyB0byBxdWVyeSBhZ2FpbnN0LiAqLyAgICBpbml0aWFsaXplKHQsIGUpIHtcbiAgICAgICAgdGhpcy5OaSA9IHQsIHRoaXMuaW5kZXhNYW5hZ2VyID0gZSwgdGhpcy54aSA9ICEwO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbGwgbG9jYWwgZG9jdW1lbnRzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgcXVlcnkuICovICAgIGdldERvY3VtZW50c01hdGNoaW5nUXVlcnkodCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gdGhpcy5raSh0LCBlKS5uZXh0KChpID0+IGkgfHwgdGhpcy5PaSh0LCBlLCBzLCBuKSkpLm5leHQoKG4gPT4gbiB8fCB0aGlzLk1pKHQsIGUpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGFuIGluZGV4ZWQgcXVlcnkgdGhhdCBldmFsdWF0ZXMgdGhlIHF1ZXJ5IGJhc2VkIG9uIGEgY29sbGVjdGlvbidzXG4gICAgICogcGVyc2lzdGVkIGluZGV4IHZhbHVlcy4gUmV0dXJucyBgbnVsbGAgaWYgYW4gaW5kZXggaXMgbm90IGF2YWlsYWJsZS5cbiAgICAgKi8gICAga2kodCwgZSkge1xuICAgICAgICBpZiAoZm4oZSkpIFxuICAgICAgICAvLyBRdWVyaWVzIHRoYXQgbWF0Y2ggYWxsIGRvY3VtZW50cyBkb24ndCBiZW5lZml0IGZyb20gdXNpbmdcbiAgICAgICAgLy8ga2V5LWJhc2VkIGxvb2t1cHMuIEl0IGlzIG1vcmUgZWZmaWNpZW50IHRvIHNjYW4gYWxsIGRvY3VtZW50cyBpbiBhXG4gICAgICAgIC8vIGNvbGxlY3Rpb24sIHJhdGhlciB0aGFuIHRvIHBlcmZvcm0gaW5kaXZpZHVhbCBsb29rdXBzLlxuICAgICAgICByZXR1cm4gQXQucmVzb2x2ZShudWxsKTtcbiAgICAgICAgbGV0IG4gPSBnbihlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyLmdldEluZGV4VHlwZSh0LCBuKS5uZXh0KChzID0+IDAgLyogSW5kZXhUeXBlLk5PTkUgKi8gPT09IHMgPyBudWxsIDogKG51bGwgIT09IGUubGltaXQgJiYgMSAvKiBJbmRleFR5cGUuUEFSVElBTCAqLyA9PT0gcyAmJiAoXG4gICAgICAgIC8vIFdlIGNhbm5vdCBhcHBseSBhIGxpbWl0IGZvciB0YXJnZXRzIHRoYXQgYXJlIHNlcnZlZCB1c2luZyBhIHBhcnRpYWxcbiAgICAgICAgLy8gaW5kZXguIElmIGEgcGFydGlhbCBpbmRleCB3aWxsIGJlIHVzZWQgdG8gc2VydmUgdGhlIHRhcmdldCwgdGhlXG4gICAgICAgIC8vIHF1ZXJ5IG1heSByZXR1cm4gYSBzdXBlcnNldCBvZiBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGUgdGFyZ2V0XG4gICAgICAgIC8vIChlLmcuIGlmIHRoZSBpbmRleCBkb2Vzbid0IGluY2x1ZGUgYWxsIHRoZSB0YXJnZXQncyBmaWx0ZXJzKSwgb3JcbiAgICAgICAgLy8gbWF5IHJldHVybiB0aGUgY29ycmVjdCBzZXQgb2YgZG9jdW1lbnRzIGluIHRoZSB3cm9uZyBvcmRlciAoZS5nLiBpZlxuICAgICAgICAvLyB0aGUgaW5kZXggZG9lc24ndCBpbmNsdWRlIGEgc2VnbWVudCBmb3Igb25lIG9mIHRoZSBvcmRlckJ5cykuXG4gICAgICAgIC8vIFRoZXJlZm9yZSwgYSBsaW1pdCBzaG91bGQgbm90IGJlIGFwcGxpZWQgaW4gc3VjaCBjYXNlcy5cbiAgICAgICAgZSA9IHBuKGUsIG51bGwsIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyksIG4gPSBnbihlKSksIHRoaXMuaW5kZXhNYW5hZ2VyLmdldERvY3VtZW50c01hdGNoaW5nVGFyZ2V0KHQsIG4pLm5leHQoKHMgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IEVzKC4uLnMpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuTmkuZ2V0RG9jdW1lbnRzKHQsIGkpLm5leHQoKHMgPT4gdGhpcy5pbmRleE1hbmFnZXIuZ2V0TWluT2Zmc2V0KHQsIG4pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLkZpKGUsIHMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRpKGUsIHIsIGksIG4ucmVhZFRpbWUpID8gdGhpcy5raSh0LCBwbihlLCBudWxsLCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8pKSA6IHRoaXMuQmkodCwgciwgZSwgbik7XG4gICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgfSkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGJhc2VkIG9uIHRoZSB0YXJnZXQncyBwZXJzaXN0ZWQgcXVlcnkgbWFwcGluZy4gUmV0dXJuc1xuICAgICAqIGBudWxsYCBpZiB0aGUgbWFwcGluZyBpcyBub3QgYXZhaWxhYmxlIG9yIGNhbm5vdCBiZSB1c2VkLlxuICAgICAqLyAgICBPaSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIHJldHVybiBmbihlKSB8fCBzLmlzRXF1YWwoc3QubWluKCkpID8gdGhpcy5NaSh0LCBlKSA6IHRoaXMuTmkuZ2V0RG9jdW1lbnRzKHQsIG4pLm5leHQoKGkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuRmkoZSwgaSk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kaShlLCByLCBuLCBzKSA/IHRoaXMuTWkodCwgZSkgOiAoUygpIDw9IExvZ0xldmVsLkRFQlVHICYmIEMoXCJRdWVyeUVuZ2luZVwiLCBcIlJlLXVzaW5nIHByZXZpb3VzIHJlc3VsdCBmcm9tICVzIHRvIGV4ZWN1dGUgcXVlcnk6ICVzXCIsIHMudG9TdHJpbmcoKSwgRW4oZSkpLCBcbiAgICAgICAgICAgIHRoaXMuQmkodCwgciwgZSwgbXQocywgLTEpKSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgLy8gUXVlcmllcyB0aGF0IGhhdmUgbmV2ZXIgc2VlbiBhIHNuYXBzaG90IHdpdGhvdXQgbGltYm8gZnJlZSBkb2N1bWVudHNcbiAgICAgICAgLy8gc2hvdWxkIGFsc28gYmUgcnVuIGFzIGEgZnVsbCBjb2xsZWN0aW9uIHNjYW4uXG4gICAgICAgIH1cbiAgICAvKiogQXBwbGllcyB0aGUgcXVlcnkgZmlsdGVyIGFuZCBzb3J0aW5nIHRvIHRoZSBwcm92aWRlZCBkb2N1bWVudHMuICAqLyAgICBGaSh0LCBlKSB7XG4gICAgICAgIC8vIFNvcnQgdGhlIGRvY3VtZW50cyBhbmQgcmUtYXBwbHkgdGhlIHF1ZXJ5IGZpbHRlciBzaW5jZSBwcmV2aW91c2x5XG4gICAgICAgIC8vIG1hdGNoaW5nIGRvY3VtZW50cyBkbyBub3QgbmVjZXNzYXJpbHkgc3RpbGwgbWF0Y2ggdGhlIHF1ZXJ5LlxuICAgICAgICBsZXQgbiA9IG5ldyBXZShibih0KSk7XG4gICAgICAgIHJldHVybiBlLmZvckVhY2goKChlLCBzKSA9PiB7XG4gICAgICAgICAgICBBbih0LCBzKSAmJiAobiA9IG4uYWRkKHMpKTtcbiAgICAgICAgfSkpLCBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIGEgbGltaXQgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgZnJvbSBjYWNoZSwgbWFraW5nIGl0XG4gICAgICogaW5lbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBleGVjdXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkuXG4gICAgICogQHBhcmFtIHNvcnRlZFByZXZpb3VzUmVzdWx0cyAtIFRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSB3aGVuIGl0XG4gICAgICogd2FzIGxhc3Qgc3luY2hyb25pemVkLCBzb3J0ZWQgYnkgdGhlIHF1ZXJ5J3MgY29tcGFyYXRvci5cbiAgICAgKiBAcGFyYW0gcmVtb3RlS2V5cyAtIFRoZSBkb2N1bWVudCBrZXlzIHRoYXQgbWF0Y2hlZCB0aGUgcXVlcnkgYXQgdGhlIGxhc3RcbiAgICAgKiBzbmFwc2hvdC5cbiAgICAgKiBAcGFyYW0gbGltYm9GcmVlU25hcHNob3RWZXJzaW9uIC0gVGhlIHZlcnNpb24gb2YgdGhlIHNuYXBzaG90IHdoZW4gdGhlXG4gICAgICogcXVlcnkgd2FzIGxhc3Qgc3luY2hyb25pemVkLlxuICAgICAqLyAgICAkaSh0LCBlLCBuLCBzKSB7XG4gICAgICAgIGlmIChudWxsID09PSB0LmxpbWl0KSBcbiAgICAgICAgLy8gUXVlcmllcyB3aXRob3V0IGxpbWl0cyBkbyBub3QgbmVlZCB0byBiZSByZWZpbGxlZC5cbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgICBpZiAobi5zaXplICE9PSBlLnNpemUpIFxuICAgICAgICAvLyBUaGUgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgaWYgYSBwcmV2aW91c2x5IG1hdGNoaW5nIGRvY3VtZW50IG5vXG4gICAgICAgIC8vIGxvbmdlciBtYXRjaGVzLlxuICAgICAgICByZXR1cm4gITA7XG4gICAgICAgIC8vIExpbWl0IHF1ZXJpZXMgYXJlIG5vdCBlbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBxdWVyeSBleGVjdXRpb24gaWYgdGhlcmUgaXNcbiAgICAgICAgLy8gYSBwb3RlbnRpYWwgdGhhdCBhbiBvbGRlciBkb2N1bWVudCBmcm9tIGNhY2hlIG5vdyBzb3J0cyBiZWZvcmUgYSBkb2N1bWVudFxuICAgICAgICAvLyB0aGF0IHdhcyBwcmV2aW91c2x5IHBhcnQgb2YgdGhlIGxpbWl0LiBUaGlzLCBob3dldmVyLCBjYW4gb25seSBoYXBwZW4gaWZcbiAgICAgICAgLy8gdGhlIGRvY3VtZW50IGF0IHRoZSBlZGdlIG9mIHRoZSBsaW1pdCBnb2VzIG91dCBvZiBsaW1pdC5cbiAgICAgICAgLy8gSWYgYSBkb2N1bWVudCB0aGF0IGlzIG5vdCB0aGUgbGltaXQgYm91bmRhcnkgc29ydHMgZGlmZmVyZW50bHksXG4gICAgICAgIC8vIHRoZSBib3VuZGFyeSBvZiB0aGUgbGltaXQgaXRzZWxmIGRpZCBub3QgY2hhbmdlIGFuZCBkb2N1bWVudHMgZnJvbSBjYWNoZVxuICAgICAgICAvLyB3aWxsIGNvbnRpbnVlIHRvIGJlIFwicmVqZWN0ZWRcIiBieSB0aGlzIGJvdW5kYXJ5LiBUaGVyZWZvcmUsIHdlIGNhbiBpZ25vcmVcbiAgICAgICAgLy8gYW55IG1vZGlmaWNhdGlvbnMgdGhhdCBkb24ndCBhZmZlY3QgdGhlIGxhc3QgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gdC5saW1pdFR5cGUgPyBlLmxhc3QoKSA6IGUuZmlyc3QoKTtcbiAgICAgICAgcmV0dXJuICEhaSAmJiAoaS5oYXNQZW5kaW5nV3JpdGVzIHx8IGkudmVyc2lvbi5jb21wYXJlVG8ocykgPiAwKTtcbiAgICB9XG4gICAgTWkodCwgZSkge1xuICAgICAgICByZXR1cm4gUygpIDw9IExvZ0xldmVsLkRFQlVHICYmIEMoXCJRdWVyeUVuZ2luZVwiLCBcIlVzaW5nIGZ1bGwgY29sbGVjdGlvbiBzY2FuIHRvIGV4ZWN1dGUgcXVlcnk6XCIsIEVuKGUpKSwgXG4gICAgICAgIHRoaXMuTmkuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeSh0LCBlLCB5dC5taW4oKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbWJpbmVzIHRoZSByZXN1bHRzIGZyb20gYW4gaW5kZXhlZCBleGVjdXRpb24gd2l0aCB0aGUgcmVtYWluaW5nIGRvY3VtZW50c1xuICAgICAqIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gaW5kZXhlZC5cbiAgICAgKi8gICAgQmkodCwgZSwgbiwgcykge1xuICAgICAgICAvLyBSZXRyaWV2ZSBhbGwgcmVzdWx0cyBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZSB1cGRhdGVkIHNpbmNlIHRoZSBvZmZzZXQuXG4gICAgICAgIHJldHVybiB0aGlzLk5pLmdldERvY3VtZW50c01hdGNoaW5nUXVlcnkodCwgbiwgcykubmV4dCgodCA9PiAoXG4gICAgICAgIC8vIE1lcmdlIHdpdGggZXhpc3RpbmcgcmVzdWx0c1xuICAgICAgICBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdCA9IHQuaW5zZXJ0KGUua2V5LCBlKTtcbiAgICAgICAgfSkpLCB0KSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW1wbGVtZW50cyBgTG9jYWxTdG9yZWAgaW50ZXJmYWNlLlxuICpcbiAqIE5vdGU6IHNvbWUgZmllbGQgZGVmaW5lZCBpbiB0aGlzIGNsYXNzIG1pZ2h0IGhhdmUgcHVibGljIGFjY2VzcyBsZXZlbCwgYnV0XG4gKiB0aGUgY2xhc3MgaXMgbm90IGV4cG9ydGVkIHNvIHRoZXkgYXJlIG9ubHkgYWNjZXNzaWJsZSBmcm9tIHRoaXMgbW9kdWxlLlxuICogVGhpcyBpcyB1c2VmdWwgdG8gaW1wbGVtZW50IG9wdGlvbmFsIGZlYXR1cmVzIChsaWtlIGJ1bmRsZXMpIGluIGZyZWVcbiAqIGZ1bmN0aW9ucywgc3VjaCB0aGF0IHRoZXkgYXJlIHRyZWUtc2hha2VhYmxlLlxuICovXG5jbGFzcyBMbyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIE1hbmFnZXMgb3VyIGluLW1lbW9yeSBvciBkdXJhYmxlIHBlcnNpc3RlbmNlLiAqL1xuICAgIHQsIGUsIG4sIHMpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IHQsIHRoaXMuTGkgPSBlLCB0aGlzLnl0ID0gcywgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNYXBzIGEgdGFyZ2V0SUQgdG8gZGF0YSBhYm91dCBpdHMgdGFyZ2V0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBQT1JUSU5HIE5PVEU6IFdlIGFyZSB1c2luZyBhbiBpbW11dGFibGUgZGF0YSBzdHJ1Y3R1cmUgb24gV2ViIHRvIG1ha2UgcmUtcnVuc1xuICAgICAgICAgKiBvZiBgYXBwbHlSZW1vdGVFdmVudCgpYCBpZGVtcG90ZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5xaSA9IG5ldyBHZShaKSwgXG4gICAgICAgIC8qKiBNYXBzIGEgdGFyZ2V0IHRvIGl0cyB0YXJnZXRJRC4gKi9cbiAgICAgICAgLy8gVE9ETyh3dWFuZHkpOiBFdmFsdWF0ZSBpZiBUYXJnZXRJZCBjYW4gYmUgcGFydCBvZiBUYXJnZXQuXG4gICAgICAgIHRoaXMuVWkgPSBuZXcgbHMoKHQgPT4gbm4odCkpLCBzbiksIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBwZXIgY29sbGVjdGlvbiBncm91cCBpbmRleCBvZiB0aGUgbGFzdCByZWFkIHRpbWUgcHJvY2Vzc2VkIGJ5XG4gICAgICAgICAqIGBnZXROZXdEb2N1bWVudENoYW5nZXMoKWAuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLktpID0gbmV3IE1hcCwgdGhpcy5HaSA9IHQuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLCB0aGlzLkNzID0gdC5nZXRUYXJnZXRDYWNoZSgpLCBcbiAgICAgICAgdGhpcy5OcyA9IHQuZ2V0QnVuZGxlQ2FjaGUoKSwgdGhpcy5RaShuKTtcbiAgICB9XG4gICAgUWkodCkge1xuICAgICAgICAvLyBUT0RPKGluZGV4aW5nKTogQWRkIHNwZWMgdGVzdHMgdGhhdCB0ZXN0IHRoZXNlIGNvbXBvbmVudHMgY2hhbmdlIGFmdGVyIGFcbiAgICAgICAgLy8gdXNlciBjaGFuZ2VcbiAgICAgICAgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZSA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0RG9jdW1lbnRPdmVybGF5Q2FjaGUodCksIHRoaXMuaW5kZXhNYW5hZ2VyID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRJbmRleE1hbmFnZXIodCksIFxuICAgICAgICB0aGlzLm11dGF0aW9uUXVldWUgPSB0aGlzLnBlcnNpc3RlbmNlLmdldE11dGF0aW9uUXVldWUodCwgdGhpcy5pbmRleE1hbmFnZXIpLCB0aGlzLmxvY2FsRG9jdW1lbnRzID0gbmV3IHBvKHRoaXMuR2ksIHRoaXMubXV0YXRpb25RdWV1ZSwgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZSwgdGhpcy5pbmRleE1hbmFnZXIpLCBcbiAgICAgICAgdGhpcy5HaS5zZXRJbmRleE1hbmFnZXIodGhpcy5pbmRleE1hbmFnZXIpLCB0aGlzLkxpLmluaXRpYWxpemUodGhpcy5sb2NhbERvY3VtZW50cywgdGhpcy5pbmRleE1hbmFnZXIpO1xuICAgIH1cbiAgICBjb2xsZWN0R2FyYmFnZSh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQ29sbGVjdCBnYXJiYWdlXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4gdC5jb2xsZWN0KGUsIHRoaXMucWkpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBxbyhcbi8qKiBNYW5hZ2VzIG91ciBpbi1tZW1vcnkgb3IgZHVyYWJsZSBwZXJzaXN0ZW5jZS4gKi9cbnQsIGUsIG4sIHMpIHtcbiAgICByZXR1cm4gbmV3IExvKHQsIGUsIG4sIHMpO1xufVxuXG4vKipcbiAqIFRlbGxzIHRoZSBMb2NhbFN0b3JlIHRoYXQgdGhlIGN1cnJlbnRseSBhdXRoZW50aWNhdGVkIHVzZXIgaGFzIGNoYW5nZWQuXG4gKlxuICogSW4gcmVzcG9uc2UgdGhlIGxvY2FsIHN0b3JlIHN3aXRjaGVzIHRoZSBtdXRhdGlvbiBxdWV1ZSB0byB0aGUgbmV3IHVzZXIgYW5kXG4gKiByZXR1cm5zIGFueSByZXN1bHRpbmcgZG9jdW1lbnQgY2hhbmdlcy5cbiAqL1xuLy8gUE9SVElORyBOT1RFOiBBbmRyb2lkIGFuZCBpT1Mgb25seSByZXR1cm4gdGhlIGRvY3VtZW50cyBhZmZlY3RlZCBieSB0aGVcbi8vIGNoYW5nZS5cbmFzeW5jIGZ1bmN0aW9uIFVvKHQsIGUpIHtcbiAgICBjb25zdCBuID0gJCh0KTtcbiAgICByZXR1cm4gYXdhaXQgbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkhhbmRsZSB1c2VyIGNoYW5nZVwiLCBcInJlYWRvbmx5XCIsICh0ID0+IHtcbiAgICAgICAgLy8gU3dhcCBvdXQgdGhlIG11dGF0aW9uIHF1ZXVlLCBncmFiYmluZyB0aGUgcGVuZGluZyBtdXRhdGlvbiBiYXRjaGVzXG4gICAgICAgIC8vIGJlZm9yZSBhbmQgYWZ0ZXIuXG4gICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gbi5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlcyh0KS5uZXh0KChpID0+IChzID0gaSwgbi5RaShlKSwgbi5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlcyh0KSkpKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBbXSwgciA9IFtdO1xuICAgICAgICAgICAgLy8gVW5pb24gdGhlIG9sZC9uZXcgY2hhbmdlZCBrZXlzLlxuICAgICAgICAgICAgbGV0IG8gPSBFcygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIHMpIHtcbiAgICAgICAgICAgICAgICBpLnB1c2godC5iYXRjaElkKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdC5tdXRhdGlvbnMpIG8gPSBvLmFkZChlLmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICAgICAgICAgIHIucHVzaCh0LmJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0Lm11dGF0aW9ucykgbyA9IG8uYWRkKGUua2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgc2V0IG9mIGFsbCAocG90ZW50aWFsbHkpIGNoYW5nZWQgZG9jdW1lbnRzIGFuZCB0aGUgbGlzdFxuICAgICAgICAgICAgLy8gb2YgbXV0YXRpb24gYmF0Y2ggSURzIHRoYXQgd2VyZSBhZmZlY3RlZCBieSBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5sb2NhbERvY3VtZW50cy5nZXREb2N1bWVudHModCwgbykubmV4dCgodCA9PiAoe1xuICAgICAgICAgICAgICAgIGppOiB0LFxuICAgICAgICAgICAgICAgIHJlbW92ZWRCYXRjaElkczogaSxcbiAgICAgICAgICAgICAgICBhZGRlZEJhdGNoSWRzOiByXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB9KSk7XG4gICAgfSkpO1xufVxuXG4vKiBBY2NlcHRzIGxvY2FsbHkgZ2VuZXJhdGVkIE11dGF0aW9ucyBhbmQgY29tbWl0IHRoZW0gdG8gc3RvcmFnZS4gKi9cbi8qKlxuICogQWNrbm93bGVkZ2VzIHRoZSBnaXZlbiBiYXRjaC5cbiAqXG4gKiBPbiB0aGUgaGFwcHkgcGF0aCB3aGVuIGEgYmF0Y2ggaXMgYWNrbm93bGVkZ2VkLCB0aGUgbG9jYWwgc3RvcmUgd2lsbFxuICpcbiAqICArIHJlbW92ZSB0aGUgYmF0Y2ggZnJvbSB0aGUgbXV0YXRpb24gcXVldWU7XG4gKiAgKyBhcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlO1xuICogICsgcmVjYWxjdWxhdGUgdGhlIGxhdGVuY3kgY29tcGVuc2F0ZWQgdmlldyBpbXBsaWVkIGJ5IHRob3NlIGNoYW5nZXMgKHRoZXJlXG4gKiAgICBtYXkgYmUgbXV0YXRpb25zIGluIHRoZSBxdWV1ZSB0aGF0IGFmZmVjdCB0aGUgZG9jdW1lbnRzIGJ1dCBoYXZlbid0IGJlZW5cbiAqICAgIGFja25vd2xlZGdlZCB5ZXQpOyBhbmRcbiAqICArIGdpdmUgdGhlIGNoYW5nZWQgZG9jdW1lbnRzIGJhY2sgdGhlIHN5bmMgZW5naW5lXG4gKlxuICogQHJldHVybnMgVGhlIHJlc3VsdGluZyAobW9kaWZpZWQpIGRvY3VtZW50cy5cbiAqL1xuZnVuY3Rpb24gS28odCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQWNrbm93bGVkZ2UgYmF0Y2hcIiwgXCJyZWFkd3JpdGUtcHJpbWFyeVwiLCAodCA9PiB7XG4gICAgICAgIGNvbnN0IHMgPSBlLmJhdGNoLmtleXMoKSwgaSA9IG4uR2kubmV3Q2hhbmdlQnVmZmVyKHtcbiAgICAgICAgICAgIHRyYWNrUmVtb3ZhbHM6ICEwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSwgbiwgcykge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uYmF0Y2gsIHIgPSBpLmtleXMoKTtcbiAgICAgICAgICAgIGxldCBvID0gQXQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHIuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICAgICAgbyA9IG8ubmV4dCgoKCkgPT4gcy5nZXRFbnRyeShlLCB0KSkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gbi5kb2NWZXJzaW9ucy5nZXQodCk7XG4gICAgICAgICAgICAgICAgICAgIE0obnVsbCAhPT0gciksIGUudmVyc2lvbi5jb21wYXJlVG8ocikgPCAwICYmIChpLmFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCBuKSwgZS5pc1ZhbGlkRG9jdW1lbnQoKSAmJiAoXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIHVzZSB0aGUgY29tbWl0VmVyc2lvbiBhcyB0aGUgcmVhZFRpbWUgcmF0aGVyIHRoYW4gdGhlXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50J3MgdXBkYXRlVGltZSBzaW5jZSB0aGUgdXBkYXRlVGltZSBpcyBub3QgYWR2YW5jZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIHVwZGF0ZXMgdGhhdCBkbyBub3QgbW9kaWZ5IHRoZSB1bmRlcmx5aW5nIGRvY3VtZW50LlxuICAgICAgICAgICAgICAgICAgICBlLnNldFJlYWRUaW1lKG4uY29tbWl0VmVyc2lvbiksIHMuYWRkRW50cnkoZSkpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSksIG8ubmV4dCgoKCkgPT4gdC5tdXRhdGlvblF1ZXVlLnJlbW92ZU11dGF0aW9uQmF0Y2goZSwgaSkpKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJucyB0aGUgbG9jYWwgdmlldyBvZiB0aGUgZG9jdW1lbnRzIGFmZmVjdGVkIGJ5IGEgbXV0YXRpb24gYmF0Y2guICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIChuLCB0LCBlLCBpKS5uZXh0KCgoKSA9PiBpLmFwcGx5KHQpKSkubmV4dCgoKCkgPT4gbi5tdXRhdGlvblF1ZXVlLnBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKHQpKSkubmV4dCgoKCkgPT4gbi5kb2N1bWVudE92ZXJsYXlDYWNoZS5yZW1vdmVPdmVybGF5c0ZvckJhdGNoSWQodCwgcywgZS5iYXRjaC5iYXRjaElkKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXModCwgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgbGV0IGUgPSBFcygpO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB0Lm11dGF0aW9uUmVzdWx0cy5sZW5ndGg7ICsrbikge1xuICAgICAgICAgICAgICAgIHQubXV0YXRpb25SZXN1bHRzW25dLnRyYW5zZm9ybVJlc3VsdHMubGVuZ3RoID4gMCAmJiAoZSA9IGUuYWRkKHQuYmF0Y2gubXV0YXRpb25zW25dLmtleSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZW1vdmVzIG11dGF0aW9ucyBmcm9tIHRoZSBNdXRhdGlvblF1ZXVlIGZvciB0aGUgc3BlY2lmaWVkIGJhdGNoO1xuICogTG9jYWxEb2N1bWVudHMgd2lsbCBiZSByZWNhbGN1bGF0ZWQuXG4gKlxuICogQHJldHVybnMgVGhlIHJlc3VsdGluZyBtb2RpZmllZCBkb2N1bWVudHMuXG4gKi8gKGUpKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKHQsIHMpKSk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGxhc3QgY29uc2lzdGVudCBzbmFwc2hvdCBwcm9jZXNzZWQgKHVzZWQgYnkgdGhlIFJlbW90ZVN0b3JlIHRvXG4gKiBkZXRlcm1pbmUgd2hldGhlciB0byBidWZmZXIgaW5jb21pbmcgc25hcHNob3RzIGZyb20gdGhlIGJhY2tlbmQpLlxuICovXG5mdW5jdGlvbiBHbyh0KSB7XG4gICAgY29uc3QgZSA9ICQodCk7XG4gICAgcmV0dXJuIGUucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJHZXQgbGFzdCByZW1vdGUgc25hcHNob3QgdmVyc2lvblwiLCBcInJlYWRvbmx5XCIsICh0ID0+IGUuQ3MuZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbih0KSkpO1xufVxuXG4vKipcbiAqIFVwZGF0ZXMgdGhlIFwiZ3JvdW5kLXN0YXRlXCIgKHJlbW90ZSkgZG9jdW1lbnRzLiBXZSBhc3N1bWUgdGhhdCB0aGUgcmVtb3RlXG4gKiBldmVudCByZWZsZWN0cyBhbnkgd3JpdGUgYmF0Y2hlcyB0aGF0IGhhdmUgYmVlbiBhY2tub3dsZWRnZWQgb3IgcmVqZWN0ZWRcbiAqIChpLmUuIHdlIGRvIG5vdCByZS1hcHBseSBsb2NhbCBtdXRhdGlvbnMgdG8gdXBkYXRlcyBmcm9tIHRoaXMgZXZlbnQpLlxuICpcbiAqIExvY2FsRG9jdW1lbnRzIGFyZSByZS1jYWxjdWxhdGVkIGlmIHRoZXJlIGFyZSByZW1haW5pbmcgbXV0YXRpb25zIGluIHRoZVxuICogcXVldWUuXG4gKi8gZnVuY3Rpb24gUW8odCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gZS5zbmFwc2hvdFZlcnNpb247XG4gICAgbGV0IGkgPSBuLnFpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQXBwbHkgcmVtb3RlIGV2ZW50XCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4ge1xuICAgICAgICBjb25zdCByID0gbi5HaS5uZXdDaGFuZ2VCdWZmZXIoe1xuICAgICAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFJlc2V0IG5ld1RhcmdldERhdGFCeVRhcmdldE1hcCBpbiBjYXNlIHRoaXMgdHJhbnNhY3Rpb24gZ2V0cyByZS1ydW4uXG4gICAgICAgICAgICAgICAgaSA9IG4ucWk7XG4gICAgICAgIGNvbnN0IG8gPSBbXTtcbiAgICAgICAgZS50YXJnZXRDaGFuZ2VzLmZvckVhY2goKChyLCB1KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjID0gaS5nZXQodSk7XG4gICAgICAgICAgICBpZiAoIWMpIHJldHVybjtcbiAgICAgICAgICAgIC8vIE9ubHkgdXBkYXRlIHRoZSByZW1vdGUga2V5cyBpZiB0aGUgdGFyZ2V0IGlzIHN0aWxsIGFjdGl2ZS4gVGhpc1xuICAgICAgICAgICAgLy8gZW5zdXJlcyB0aGF0IHdlIGNhbiBwZXJzaXN0IHRoZSB1cGRhdGVkIHRhcmdldCBkYXRhIGFsb25nIHdpdGhcbiAgICAgICAgICAgIC8vIHRoZSB1cGRhdGVkIGFzc2lnbm1lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnB1c2gobi5Dcy5yZW1vdmVNYXRjaGluZ0tleXModCwgci5yZW1vdmVkRG9jdW1lbnRzLCB1KS5uZXh0KCgoKSA9PiBuLkNzLmFkZE1hdGNoaW5nS2V5cyh0LCByLmFkZGVkRG9jdW1lbnRzLCB1KSkpKTtcbiAgICAgICAgICAgIGxldCBhID0gYy53aXRoU2VxdWVuY2VOdW1iZXIodC5jdXJyZW50U2VxdWVuY2VOdW1iZXIpO1xuICAgICAgICAgICAgZS50YXJnZXRNaXNtYXRjaGVzLmhhcyh1KSA/IGEgPSBhLndpdGhSZXN1bWVUb2tlbihRdC5FTVBUWV9CWVRFX1NUUklORywgc3QubWluKCkpLndpdGhMYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uKHN0Lm1pbigpKSA6IHIucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCAmJiAoYSA9IGEud2l0aFJlc3VtZVRva2VuKHIucmVzdW1lVG9rZW4sIHMpKSwgXG4gICAgICAgICAgICBpID0gaS5pbnNlcnQodSwgYSksIFxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB0YXJnZXQgZGF0YSBpZiB0aGVyZSBhcmUgdGFyZ2V0IGNoYW5nZXMgKG9yIGlmXG4gICAgICAgICAgICAvLyBzdWZmaWNpZW50IHRpbWUgaGFzIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUpLlxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIG5ld1RhcmdldERhdGEgc2hvdWxkIGJlIHBlcnNpc3RlZCBkdXJpbmcgYW4gdXBkYXRlIG9mXG4gKiBhbiBhY3RpdmUgdGFyZ2V0LiBUYXJnZXREYXRhIHNob3VsZCBhbHdheXMgYmUgcGVyc2lzdGVkIHdoZW4gYSB0YXJnZXQgaXNcbiAqIGJlaW5nIHJlbGVhc2VkIGFuZCBzaG91bGQgbm90IGNhbGwgdGhpcyBmdW5jdGlvbi5cbiAqXG4gKiBXaGlsZSB0aGUgdGFyZ2V0IGlzIGFjdGl2ZSwgVGFyZ2V0RGF0YSB1cGRhdGVzIGNhbiBiZSBvbWl0dGVkIHdoZW4gbm90aGluZ1xuICogYWJvdXQgdGhlIHRhcmdldCBoYXMgY2hhbmdlZCBleGNlcHQgbWV0YWRhdGEgbGlrZSB0aGUgcmVzdW1lIHRva2VuIG9yXG4gKiBzbmFwc2hvdCB2ZXJzaW9uLiBPY2Nhc2lvbmFsbHkgaXQncyB3b3J0aCB0aGUgZXh0cmEgd3JpdGUgdG8gcHJldmVudCB0aGVzZVxuICogdmFsdWVzIGZyb20gZ2V0dGluZyB0b28gc3RhbGUgYWZ0ZXIgYSBjcmFzaCwgYnV0IHRoaXMgZG9lc24ndCBoYXZlIHRvIGJlXG4gKiB0b28gZnJlcXVlbnQuXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgICAgICAgICAvLyBBbHdheXMgcGVyc2lzdCB0YXJnZXQgZGF0YSBpZiB3ZSBkb24ndCBhbHJlYWR5IGhhdmUgYSByZXN1bWUgdG9rZW4uXG4gICAgICAgICAgICAgICAgaWYgKDAgPT09IHQucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpKSByZXR1cm4gITA7XG4gICAgICAgICAgICAgICAgLy8gRG9uJ3QgYWxsb3cgcmVzdW1lIHRva2VuIGNoYW5nZXMgdG8gYmUgYnVmZmVyZWQgaW5kZWZpbml0ZWx5LiBUaGlzXG4gICAgICAgICAgICAgICAgLy8gYWxsb3dzIHVzIHRvIGJlIHJlYXNvbmFibHkgdXAtdG8tZGF0ZSBhZnRlciBhIGNyYXNoIGFuZCBhdm9pZHMgbmVlZGluZ1xuICAgICAgICAgICAgICAgIC8vIHRvIGxvb3Agb3ZlciBhbGwgYWN0aXZlIHF1ZXJpZXMgb24gc2h1dGRvd24uIEVzcGVjaWFsbHkgaW4gdGhlIGJyb3dzZXJcbiAgICAgICAgICAgICAgICAvLyB3ZSBtYXkgbm90IGdldCB0aW1lIHRvIGRvIGFueXRoaW5nIGludGVyZXN0aW5nIHdoaWxlIHRoZSBjdXJyZW50IHRhYiBpc1xuICAgICAgICAgICAgICAgIC8vIGNsb3NpbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnNuYXBzaG90VmVyc2lvbi50b01pY3Jvc2Vjb25kcygpIC0gdC5zbmFwc2hvdFZlcnNpb24udG9NaWNyb3NlY29uZHMoKSA+PSAzZTgpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgdGhlIG9ubHkgdGhpbmcgdGhhdCBoYXMgY2hhbmdlZCBhYm91dCBhIHRhcmdldCBpcyBpdHMgcmVzdW1lXG4gICAgICAgICAgICAgICAgLy8gdG9rZW4gaXQncyBub3Qgd29ydGggcGVyc2lzdGluZy4gTm90ZSB0aGF0IHRoZSBSZW1vdGVTdG9yZSBrZWVwcyBhblxuICAgICAgICAgICAgICAgIC8vIGluLW1lbW9yeSB2aWV3IG9mIHRoZSBjdXJyZW50bHkgYWN0aXZlIHRhcmdldHMgd2hpY2ggaW5jbHVkZXMgdGhlIGN1cnJlbnRcbiAgICAgICAgICAgICAgICAvLyByZXN1bWUgdG9rZW4sIHNvIHN0cmVhbSBmYWlsdXJlIG9yIHVzZXIgY2hhbmdlcyB3aWxsIHN0aWxsIHVzZSBhblxuICAgICAgICAgICAgICAgIC8vIHVwLXRvLWRhdGUgcmVzdW1lIHRva2VuIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB3ZSBkbyBoZXJlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5hZGRlZERvY3VtZW50cy5zaXplICsgbi5tb2RpZmllZERvY3VtZW50cy5zaXplICsgbi5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBOb3RpZmllcyBsb2NhbCBzdG9yZSBvZiB0aGUgY2hhbmdlZCB2aWV3cyB0byBsb2NhbGx5IHBpbiBkb2N1bWVudHMuXG4gKi8gKGMsIGEsIHIpICYmIG8ucHVzaChuLkNzLnVwZGF0ZVRhcmdldERhdGEodCwgYSkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIGxldCB1ID0gZHMoKSwgYyA9IEVzKCk7XG4gICAgICAgIC8vIEhBQ0s6IFRoZSBvbmx5IHJlYXNvbiB3ZSBhbGxvdyBhIG51bGwgc25hcHNob3QgdmVyc2lvbiBpcyBzbyB0aGF0IHdlXG4gICAgICAgIC8vIGNhbiBzeW50aGVzaXplIHJlbW90ZSBldmVudHMgd2hlbiB3ZSBnZXQgcGVybWlzc2lvbiBkZW5pZWQgZXJyb3JzIHdoaWxlXG4gICAgICAgIC8vIHRyeWluZyB0byByZXNvbHZlIHRoZSBzdGF0ZSBvZiBhIGxvY2FsbHkgY2FjaGVkIGRvY3VtZW50IHRoYXQgaXMgaW5cbiAgICAgICAgLy8gbGltYm8uXG4gICAgICAgIGlmIChlLmRvY3VtZW50VXBkYXRlcy5mb3JFYWNoKChzID0+IHtcbiAgICAgICAgICAgIGUucmVzb2x2ZWRMaW1ib0RvY3VtZW50cy5oYXMocykgJiYgby5wdXNoKG4ucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUudXBkYXRlTGltYm9Eb2N1bWVudCh0LCBzKSk7XG4gICAgICAgIH0pKSwgXG4gICAgICAgIC8vIEVhY2ggbG9vcCBpdGVyYXRpb24gb25seSBhZmZlY3RzIGl0cyBcIm93blwiIGRvYywgc28gaXQncyBzYWZlIHRvIGdldCBhbGxcbiAgICAgICAgLy8gdGhlIHJlbW90ZSBkb2N1bWVudHMgaW4gYWR2YW5jZSBpbiBhIHNpbmdsZSBjYWxsLlxuICAgICAgICBvLnB1c2goam8odCwgciwgZS5kb2N1bWVudFVwZGF0ZXMpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgdSA9IHQuV2ksIGMgPSB0LnppO1xuICAgICAgICB9KSkpLCAhcy5pc0VxdWFsKHN0Lm1pbigpKSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IG4uQ3MuZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbih0KS5uZXh0KChlID0+IG4uQ3Muc2V0VGFyZ2V0c01ldGFkYXRhKHQsIHQuY3VycmVudFNlcXVlbmNlTnVtYmVyLCBzKSkpO1xuICAgICAgICAgICAgby5wdXNoKGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBBdC53YWl0Rm9yKG8pLm5leHQoKCgpID0+IHIuYXBwbHkodCkpKS5uZXh0KCgoKSA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKHQsIHUsIGMpKSkubmV4dCgoKCkgPT4gdSkpO1xuICAgIH0pKS50aGVuKCh0ID0+IChuLnFpID0gaSwgdCkpKTtcbn1cblxuLyoqXG4gKiBQb3B1bGF0ZXMgZG9jdW1lbnQgY2hhbmdlIGJ1ZmZlciB3aXRoIGRvY3VtZW50cyBmcm9tIGJhY2tlbmQgb3IgYSBidW5kbGUuXG4gKiBSZXR1cm5zIHRoZSBkb2N1bWVudCBjaGFuZ2VzIHJlc3VsdGluZyBmcm9tIGFwcGx5aW5nIHRob3NlIGRvY3VtZW50cywgYW5kXG4gKiBhbHNvIGEgc2V0IG9mIGRvY3VtZW50cyB3aG9zZSBleGlzdGVuY2Ugc3RhdGUgYXJlIGNoYW5nZWQgYXMgYSByZXN1bHQuXG4gKlxuICogQHBhcmFtIHR4biAtIFRyYW5zYWN0aW9uIHRvIHVzZSB0byByZWFkIGV4aXN0aW5nIGRvY3VtZW50cyBmcm9tIHN0b3JhZ2UuXG4gKiBAcGFyYW0gZG9jdW1lbnRCdWZmZXIgLSBEb2N1bWVudCBidWZmZXIgdG8gY29sbGVjdCB0aGUgcmVzdWx0ZWQgY2hhbmdlcyB0byBiZVxuICogICAgICAgIGFwcGxpZWQgdG8gc3RvcmFnZS5cbiAqIEBwYXJhbSBkb2N1bWVudHMgLSBEb2N1bWVudHMgdG8gYmUgYXBwbGllZC5cbiAqLyBmdW5jdGlvbiBqbyh0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSBFcygpLCBpID0gRXMoKTtcbiAgICByZXR1cm4gbi5mb3JFYWNoKCh0ID0+IHMgPSBzLmFkZCh0KSkpLCBlLmdldEVudHJpZXModCwgcykubmV4dCgodCA9PiB7XG4gICAgICAgIGxldCBzID0gZHMoKTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSB0LmdldChuKTtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHNlZSBpZiB0aGVyZSBpcyBhIGV4aXN0ZW5jZSBzdGF0ZSBjaGFuZ2UgZm9yIHRoaXMgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICByLmlzRm91bmREb2N1bWVudCgpICE9PSBvLmlzRm91bmREb2N1bWVudCgpICYmIChpID0gaS5hZGQobikpLCBcbiAgICAgICAgICAgIC8vIE5vdGU6IFRoZSBvcmRlciBvZiB0aGUgc3RlcHMgYmVsb3cgaXMgaW1wb3J0YW50LCBzaW5jZSB3ZSB3YW50XG4gICAgICAgICAgICAvLyB0byBlbnN1cmUgdGhhdCByZWplY3RlZCBsaW1ibyByZXNvbHV0aW9ucyAod2hpY2ggZmFicmljYXRlXG4gICAgICAgICAgICAvLyBOb0RvY3VtZW50cyB3aXRoIFNuYXBzaG90VmVyc2lvbi5taW4oKSkgbmV2ZXIgYWRkIGRvY3VtZW50cyB0b1xuICAgICAgICAgICAgLy8gY2FjaGUuXG4gICAgICAgICAgICByLmlzTm9Eb2N1bWVudCgpICYmIHIudmVyc2lvbi5pc0VxdWFsKHN0Lm1pbigpKSA/IChcbiAgICAgICAgICAgIC8vIE5vRG9jdW1lbnRzIHdpdGggU25hcHNob3RWZXJzaW9uLm1pbigpIGFyZSB1c2VkIGluIG1hbnVmYWN0dXJlZFxuICAgICAgICAgICAgLy8gZXZlbnRzLiBXZSByZW1vdmUgdGhlc2UgZG9jdW1lbnRzIGZyb20gY2FjaGUgc2luY2Ugd2UgbG9zdFxuICAgICAgICAgICAgLy8gYWNjZXNzLlxuICAgICAgICAgICAgZS5yZW1vdmVFbnRyeShuLCByLnJlYWRUaW1lKSwgcyA9IHMuaW5zZXJ0KG4sIHIpKSA6ICFvLmlzVmFsaWREb2N1bWVudCgpIHx8IHIudmVyc2lvbi5jb21wYXJlVG8oby52ZXJzaW9uKSA+IDAgfHwgMCA9PT0gci52ZXJzaW9uLmNvbXBhcmVUbyhvLnZlcnNpb24pICYmIG8uaGFzUGVuZGluZ1dyaXRlcyA/IChlLmFkZEVudHJ5KHIpLCBcbiAgICAgICAgICAgIHMgPSBzLmluc2VydChuLCByKSkgOiBDKFwiTG9jYWxTdG9yZVwiLCBcIklnbm9yaW5nIG91dGRhdGVkIHdhdGNoIHVwZGF0ZSBmb3IgXCIsIG4sIFwiLiBDdXJyZW50IHZlcnNpb246XCIsIG8udmVyc2lvbiwgXCIgV2F0Y2ggdmVyc2lvbjpcIiwgci52ZXJzaW9uKTtcbiAgICAgICAgfSkpLCB7XG4gICAgICAgICAgICBXaTogcyxcbiAgICAgICAgICAgIHppOiBpXG4gICAgICAgIH07XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIG11dGF0aW9uIGJhdGNoIGFmdGVyIHRoZSBwYXNzZWQgaW4gYmF0Y2hJZCBpbiB0aGUgbXV0YXRpb24gcXVldWVcbiAqIG9yIG51bGwgaWYgZW1wdHkuXG4gKiBAcGFyYW0gYWZ0ZXJCYXRjaElkIC0gSWYgcHJvdmlkZWQsIHRoZSBiYXRjaCB0byBzZWFyY2ggYWZ0ZXIuXG4gKiBAcmV0dXJucyBUaGUgbmV4dCBtdXRhdGlvbiBvciBudWxsIGlmIHRoZXJlIHdhc24ndCBvbmUuXG4gKi9cbmZ1bmN0aW9uIFdvKHQsIGUpIHtcbiAgICBjb25zdCBuID0gJCh0KTtcbiAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBuZXh0IG11dGF0aW9uIGJhdGNoXCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gKHZvaWQgMCA9PT0gZSAmJiAoZSA9IC0xKSwgXG4gICAgbi5tdXRhdGlvblF1ZXVlLmdldE5leHRNdXRhdGlvbkJhdGNoQWZ0ZXJCYXRjaElkKHQsIGUpKSkpO1xufVxuXG4vKipcbiAqIFJlYWRzIHRoZSBjdXJyZW50IHZhbHVlIG9mIGEgRG9jdW1lbnQgd2l0aCBhIGdpdmVuIGtleSBvciBudWxsIGlmIG5vdFxuICogZm91bmQgLSB1c2VkIGZvciB0ZXN0aW5nLlxuICovXG4vKipcbiAqIEFzc2lnbnMgdGhlIGdpdmVuIHRhcmdldCBhbiBpbnRlcm5hbCBJRCBzbyB0aGF0IGl0cyByZXN1bHRzIGNhbiBiZSBwaW5uZWQgc29cbiAqIHRoZXkgZG9uJ3QgZ2V0IEdDJ2QuIEEgdGFyZ2V0IG11c3QgYmUgYWxsb2NhdGVkIGluIHRoZSBsb2NhbCBzdG9yZSBiZWZvcmVcbiAqIHRoZSBzdG9yZSBjYW4gYmUgdXNlZCB0byBtYW5hZ2UgaXRzIHZpZXcuXG4gKlxuICogQWxsb2NhdGluZyBhbiBhbHJlYWR5IGFsbG9jYXRlZCBgVGFyZ2V0YCB3aWxsIHJldHVybiB0aGUgZXhpc3RpbmcgYFRhcmdldERhdGFgXG4gKiBmb3IgdGhhdCBgVGFyZ2V0YC5cbiAqL1xuZnVuY3Rpb24gem8odCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQWxsb2NhdGUgdGFyZ2V0XCIsIFwicmVhZHdyaXRlXCIsICh0ID0+IHtcbiAgICAgICAgbGV0IHM7XG4gICAgICAgIHJldHVybiBuLkNzLmdldFRhcmdldERhdGEodCwgZSkubmV4dCgoaSA9PiBpID8gKFxuICAgICAgICAvLyBUaGlzIHRhcmdldCBoYXMgYmVlbiBsaXN0ZW5lZCB0byBwcmV2aW91c2x5LCBzbyByZXVzZSB0aGVcbiAgICAgICAgLy8gcHJldmlvdXMgdGFyZ2V0SUQuXG4gICAgICAgIC8vIFRPRE8obWNnKTogZnJlc2hlbiBsYXN0IGFjY2Vzc2VkIGRhdGU/XG4gICAgICAgIHMgPSBpLCBBdC5yZXNvbHZlKHMpKSA6IG4uQ3MuYWxsb2NhdGVUYXJnZXRJZCh0KS5uZXh0KChpID0+IChzID0gbmV3IHppKGUsIGksIDAgLyogVGFyZ2V0UHVycG9zZS5MaXN0ZW4gKi8gLCB0LmN1cnJlbnRTZXF1ZW5jZU51bWJlciksIFxuICAgICAgICBuLkNzLmFkZFRhcmdldERhdGEodCwgcykubmV4dCgoKCkgPT4gcykpKSkpKSk7XG4gICAgfSkpLnRoZW4oKHQgPT4ge1xuICAgICAgICAvLyBJZiBNdWx0aS1UYWIgaXMgZW5hYmxlZCwgdGhlIGV4aXN0aW5nIHRhcmdldCBkYXRhIG1heSBiZSBuZXdlciB0aGFuXG4gICAgICAgIC8vIHRoZSBpbi1tZW1vcnkgZGF0YVxuICAgICAgICBjb25zdCBzID0gbi5xaS5nZXQodC50YXJnZXRJZCk7XG4gICAgICAgIHJldHVybiAobnVsbCA9PT0gcyB8fCB0LnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8ocy5zbmFwc2hvdFZlcnNpb24pID4gMCkgJiYgKG4ucWkgPSBuLnFpLmluc2VydCh0LnRhcmdldElkLCB0KSwgXG4gICAgICAgIG4uVWkuc2V0KGUsIHQudGFyZ2V0SWQpKSwgdDtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgVGFyZ2V0RGF0YSBhcyBzZWVuIGJ5IHRoZSBMb2NhbFN0b3JlLCBpbmNsdWRpbmcgdXBkYXRlcyB0aGF0IG1heVxuICogaGF2ZSBub3QgeWV0IGJlZW4gcGVyc2lzdGVkIHRvIHRoZSBUYXJnZXRDYWNoZS5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbi8qKlxuICogVW5waW5zIGFsbCB0aGUgZG9jdW1lbnRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gdGFyZ2V0LiBJZlxuICogYGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhYCBpcyBzZXQgdG8gZmFsc2UgYW5kIEVhZ2VyIEdDIGVuYWJsZWQsIHRoZSBtZXRob2RcbiAqIGRpcmVjdGx5IHJlbW92ZXMgdGhlIGFzc29jaWF0ZWQgdGFyZ2V0IGRhdGEgZnJvbSB0aGUgdGFyZ2V0IGNhY2hlLlxuICpcbiAqIFJlbGVhc2luZyBhIG5vbi1leGlzdGluZyBgVGFyZ2V0YCBpcyBhIG5vLW9wLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IGBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YWAgaXMgbXVsdGktdGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBIbyh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9ICQodCksIGkgPSBzLnFpLmdldChlKSwgciA9IG4gPyBcInJlYWR3cml0ZVwiIDogXCJyZWFkd3JpdGUtcHJpbWFyeVwiO1xuICAgIHRyeSB7XG4gICAgICAgIG4gfHwgYXdhaXQgcy5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIlJlbGVhc2UgdGFyZ2V0XCIsIHIsICh0ID0+IHMucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUucmVtb3ZlVGFyZ2V0KHQsIGkpKSk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBpZiAoIVZ0KHQpKSB0aHJvdyB0O1xuICAgICAgICAvLyBBbGwgYHJlbGVhc2VUYXJnZXRgIGRvZXMgaXMgcmVjb3JkIHRoZSBmaW5hbCBtZXRhZGF0YSBzdGF0ZSBmb3IgdGhlXG4gICAgICAgIC8vIHRhcmdldCwgYnV0IHdlJ3ZlIGJlZW4gcmVjb3JkaW5nIHRoaXMgcGVyaW9kaWNhbGx5IGR1cmluZyB0YXJnZXRcbiAgICAgICAgLy8gYWN0aXZpdHkuIElmIHdlIGxvc2UgdGhpcyB3cml0ZSB0aGlzIGNvdWxkIGNhdXNlIGEgdmVyeSBzbGlnaHRcbiAgICAgICAgLy8gZGlmZmVyZW5jZSBpbiB0aGUgb3JkZXIgb2YgdGFyZ2V0IGRlbGV0aW9uIGR1cmluZyBHQywgYnV0IHdlXG4gICAgICAgIC8vIGRvbid0IGRlZmluZSBleGFjdCBMUlUgc2VtYW50aWNzIHNvIHRoaXMgaXMgYWNjZXB0YWJsZS5cbiAgICAgICAgQyhcIkxvY2FsU3RvcmVcIiwgYEZhaWxlZCB0byB1cGRhdGUgc2VxdWVuY2UgbnVtYmVycyBmb3IgdGFyZ2V0ICR7ZX06ICR7dH1gKTtcbiAgICB9XG4gICAgcy5xaSA9IHMucWkucmVtb3ZlKGUpLCBzLlVpLmRlbGV0ZShpLnRhcmdldCk7XG59XG5cbi8qKlxuICogUnVucyB0aGUgc3BlY2lmaWVkIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHN0b3JlIGFuZCByZXR1cm5zIHRoZSByZXN1bHRzLFxuICogcG90ZW50aWFsbHkgdGFraW5nIGFkdmFudGFnZSBvZiBxdWVyeSBkYXRhIGZyb20gcHJldmlvdXMgZXhlY3V0aW9ucyAoc3VjaFxuICogYXMgdGhlIHNldCBvZiByZW1vdGUga2V5cykuXG4gKlxuICogQHBhcmFtIHVzZVByZXZpb3VzUmVzdWx0cyAtIFdoZXRoZXIgcmVzdWx0cyBmcm9tIHByZXZpb3VzIGV4ZWN1dGlvbnMgY2FuXG4gKiBiZSB1c2VkIHRvIG9wdGltaXplIHRoaXMgcXVlcnkgZXhlY3V0aW9uLlxuICovIGZ1bmN0aW9uIEpvKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gJCh0KTtcbiAgICBsZXQgaSA9IHN0Lm1pbigpLCByID0gRXMoKTtcbiAgICByZXR1cm4gcy5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkV4ZWN1dGUgcXVlcnlcIiwgXCJyZWFkb25seVwiLCAodCA9PiBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSAkKHQpLCBpID0gcy5VaS5nZXQobik7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IGkgPyBBdC5yZXNvbHZlKHMucWkuZ2V0KGkpKSA6IHMuQ3MuZ2V0VGFyZ2V0RGF0YShlLCBuKTtcbiAgICB9KHMsIHQsIGduKGUpKS5uZXh0KChlID0+IHtcbiAgICAgICAgaWYgKGUpIHJldHVybiBpID0gZS5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uLCBzLkNzLmdldE1hdGNoaW5nS2V5c0ZvclRhcmdldElkKHQsIGUudGFyZ2V0SWQpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgciA9IHQ7XG4gICAgICAgIH0pKTtcbiAgICB9KSkubmV4dCgoKCkgPT4gcy5MaS5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KHQsIGUsIG4gPyBpIDogc3QubWluKCksIG4gPyByIDogRXMoKSkpKS5uZXh0KCh0ID0+IChabyhzLCBSbihlKSwgdCksIFxuICAgIHtcbiAgICAgICAgZG9jdW1lbnRzOiB0LFxuICAgICAgICBIaTogclxuICAgIH0pKSkpKTtcbn1cblxuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmZ1bmN0aW9uIFlvKHQsIGUpIHtcbiAgICBjb25zdCBuID0gJCh0KSwgcyA9ICQobi5DcyksIGkgPSBuLnFpLmdldChlKTtcbiAgICByZXR1cm4gaSA/IFByb21pc2UucmVzb2x2ZShpLnRhcmdldCkgOiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IHRhcmdldCBkYXRhXCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gcy5uZSh0LCBlKS5uZXh0KCh0ID0+IHQgPyB0LnRhcmdldCA6IG51bGwpKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHNldCBvZiBkb2N1bWVudHMgdGhhdCBoYXZlIGJlZW4gdXBkYXRlZCBzaW5jZSB0aGUgbGFzdCBjYWxsLlxuICogSWYgdGhpcyBpcyB0aGUgZmlyc3QgY2FsbCwgcmV0dXJucyB0aGUgc2V0IG9mIGNoYW5nZXMgc2luY2UgY2xpZW50XG4gKiBpbml0aWFsaXphdGlvbi4gRnVydGhlciBpbnZvY2F0aW9ucyB3aWxsIHJldHVybiBkb2N1bWVudCB0aGF0IGhhdmUgY2hhbmdlZFxuICogc2luY2UgdGhlIHByaW9yIGNhbGwuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBYbyh0LCBlKSB7XG4gICAgY29uc3QgbiA9ICQodCksIHMgPSBuLktpLmdldChlKSB8fCBzdC5taW4oKTtcbiAgICAvLyBHZXQgdGhlIGN1cnJlbnQgbWF4aW11bSByZWFkIHRpbWUgZm9yIHRoZSBjb2xsZWN0aW9uLiBUaGlzIHNob3VsZCBhbHdheXNcbiAgICAvLyBleGlzdCwgYnV0IHRvIHJlZHVjZSB0aGUgY2hhbmNlIGZvciByZWdyZXNzaW9ucyB3ZSBkZWZhdWx0IHRvXG4gICAgLy8gU25hcHNob3RWZXJzaW9uLk1pbigpXG4gICAgLy8gVE9ETyhpbmRleGluZyk6IENvbnNpZGVyIHJlbW92aW5nIHRoZSBkZWZhdWx0IHZhbHVlLlxuICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBuZXcgZG9jdW1lbnQgY2hhbmdlc1wiLCBcInJlYWRvbmx5XCIsICh0ID0+IG4uR2kuZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cCh0LCBlLCBtdChzLCAtMSksIFxuICAgIC8qIGxpbWl0PSAqLyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikpKS50aGVuKCh0ID0+IChabyhuLCBlLCB0KSwgdCkpKTtcbn1cblxuLyoqIFNldHMgdGhlIGNvbGxlY3Rpb24gZ3JvdXAncyBtYXhpbXVtIHJlYWQgdGltZSBmcm9tIHRoZSBnaXZlbiBkb2N1bWVudHMuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gWm8odCwgZSwgbikge1xuICAgIGxldCBzID0gdC5LaS5nZXQoZSkgfHwgc3QubWluKCk7XG4gICAgbi5mb3JFYWNoKCgodCwgZSkgPT4ge1xuICAgICAgICBlLnJlYWRUaW1lLmNvbXBhcmVUbyhzKSA+IDAgJiYgKHMgPSBlLnJlYWRUaW1lKTtcbiAgICB9KSksIHQuS2kuc2V0KGUsIHMpO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgdGFyZ2V0IHVzaW5nIHRoZSBnaXZlbiBidW5kbGUgbmFtZSwgd2hpY2ggd2lsbCBiZSB1c2VkIHRvXG4gKiBob2xkIHRoZSBrZXlzIG9mIGFsbCBkb2N1bWVudHMgZnJvbSB0aGUgYnVuZGxlIGluIHF1ZXJ5LWRvY3VtZW50IG1hcHBpbmdzLlxuICogVGhpcyBlbnN1cmVzIHRoYXQgdGhlIGxvYWRlZCBkb2N1bWVudHMgZG8gbm90IGdldCBnYXJiYWdlIGNvbGxlY3RlZFxuICogcmlnaHQgYXdheS5cbiAqL1xuLyoqXG4gKiBBcHBsaWVzIHRoZSBkb2N1bWVudHMgZnJvbSBhIGJ1bmRsZSB0byB0aGUgXCJncm91bmQtc3RhdGVcIiAocmVtb3RlKVxuICogZG9jdW1lbnRzLlxuICpcbiAqIExvY2FsRG9jdW1lbnRzIGFyZSByZS1jYWxjdWxhdGVkIGlmIHRoZXJlIGFyZSByZW1haW5pbmcgbXV0YXRpb25zIGluIHRoZVxuICogcXVldWUuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHR1KHQsIGUsIG4sIHMpIHtcbiAgICBjb25zdCBpID0gJCh0KTtcbiAgICBsZXQgciA9IEVzKCksIG8gPSBkcygpO1xuICAgIGZvciAoY29uc3QgdCBvZiBuKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLkppKHQubWV0YWRhdGEubmFtZSk7XG4gICAgICAgIHQuZG9jdW1lbnQgJiYgKHIgPSByLmFkZChuKSk7XG4gICAgICAgIGNvbnN0IHMgPSBlLllpKHQpO1xuICAgICAgICBzLnNldFJlYWRUaW1lKGUuWGkodC5tZXRhZGF0YS5yZWFkVGltZSkpLCBvID0gby5pbnNlcnQobiwgcyk7XG4gICAgfVxuICAgIGNvbnN0IHUgPSBpLkdpLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgIHRyYWNrUmVtb3ZhbHM6ICEwXG4gICAgfSksIGMgPSBhd2FpdCB6byhpLCBmdW5jdGlvbih0KSB7XG4gICAgICAgIC8vIEl0IGlzIE9LIHRoYXQgdGhlIHBhdGggdXNlZCBmb3IgdGhlIHF1ZXJ5IGlzIG5vdCB2YWxpZCwgYmVjYXVzZSB0aGlzIHdpbGxcbiAgICAgICAgLy8gbm90IGJlIHJlYWQgYW5kIHF1ZXJpZWQuXG4gICAgICAgIHJldHVybiBnbihsbihydC5mcm9tU3RyaW5nKGBfX2J1bmRsZV9fL2RvY3MvJHt0fWApKSk7XG4gICAgfShzKSk7XG4gICAgLy8gQWxsb2NhdGVzIGEgdGFyZ2V0IHRvIGhvbGQgYWxsIGRvY3VtZW50IGtleXMgZnJvbSB0aGUgYnVuZGxlLCBzdWNoIHRoYXRcbiAgICAvLyB0aGV5IHdpbGwgbm90IGdldCBnYXJiYWdlIGNvbGxlY3RlZCByaWdodCBhd2F5LlxuICAgICAgICByZXR1cm4gaS5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkFwcGx5IGJ1bmRsZSBkb2N1bWVudHNcIiwgXCJyZWFkd3JpdGVcIiwgKHQgPT4gam8odCwgdSwgbykubmV4dCgoZSA9PiAodS5hcHBseSh0KSwgXG4gICAgZSkpKS5uZXh0KChlID0+IGkuQ3MucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQodCwgYy50YXJnZXRJZCkubmV4dCgoKCkgPT4gaS5Dcy5hZGRNYXRjaGluZ0tleXModCwgciwgYy50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLmxvY2FsRG9jdW1lbnRzLmdldExvY2FsVmlld09mRG9jdW1lbnRzKHQsIGUuV2ksIGUuemkpKSkubmV4dCgoKCkgPT4gZS5XaSkpKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiBhIGJvb2xlYW4gdG8gaW5kaWNhdGUgaWYgdGhlIGdpdmVuIGJ1bmRsZSBoYXMgYWxyZWFkeVxuICogYmVlbiBsb2FkZWQgYW5kIHRoZSBjcmVhdGUgdGltZSBpcyBuZXdlciB0aGFuIHRoZSBjdXJyZW50IGxvYWRpbmcgYnVuZGxlLlxuICovXG4vKipcbiAqIFNhdmVzIHRoZSBnaXZlbiBgTmFtZWRRdWVyeWAgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGV1KHQsIGUsIG4gPSBFcygpKSB7XG4gICAgLy8gQWxsb2NhdGUgYSB0YXJnZXQgZm9yIHRoZSBuYW1lZCBxdWVyeSBzdWNoIHRoYXQgaXQgY2FuIGJlIHJlc3VtZWRcbiAgICAvLyBmcm9tIGFzc29jaWF0ZWQgcmVhZCB0aW1lIGlmIHVzZXJzIHVzZSBpdCB0byBsaXN0ZW4uXG4gICAgLy8gTk9URTogdGhpcyBhbHNvIG1lYW5zIGlmIG5vIGNvcnJlc3BvbmRpbmcgdGFyZ2V0IGV4aXN0cywgdGhlIG5ldyB0YXJnZXRcbiAgICAvLyB3aWxsIHJlbWFpbiBhY3RpdmUgYW5kIHdpbGwgbm90IGdldCBjb2xsZWN0ZWQsIHVubGVzcyB1c2VycyBoYXBwZW4gdG9cbiAgICAvLyB1bmxpc3RlbiB0aGUgcXVlcnkgc29tZWhvdy5cbiAgICBjb25zdCBzID0gYXdhaXQgem8odCwgZ24oaXIoZS5idW5kbGVkUXVlcnkpKSksIGkgPSAkKHQpO1xuICAgIHJldHVybiBpLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiU2F2ZSBuYW1lZCBxdWVyeVwiLCBcInJlYWR3cml0ZVwiLCAodCA9PiB7XG4gICAgICAgIGNvbnN0IHIgPSBxcyhlLnJlYWRUaW1lKTtcbiAgICAgICAgLy8gU2ltcGx5IHNhdmUgdGhlIHF1ZXJ5IGl0c2VsZiBpZiBpdCBpcyBvbGRlciB0aGFuIHdoYXQgdGhlIFNESyBhbHJlYWR5XG4gICAgICAgIC8vIGhhcy5cbiAgICAgICAgICAgICAgICBpZiAocy5zbmFwc2hvdFZlcnNpb24uY29tcGFyZVRvKHIpID49IDApIHJldHVybiBpLk5zLnNhdmVOYW1lZFF1ZXJ5KHQsIGUpO1xuICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgdGFyZ2V0IGRhdGEgYmVjYXVzZSB0aGUgcXVlcnkgZnJvbSB0aGUgYnVuZGxlIGlzIG5ld2VyLlxuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBzLndpdGhSZXN1bWVUb2tlbihRdC5FTVBUWV9CWVRFX1NUUklORywgcik7XG4gICAgICAgIHJldHVybiBpLnFpID0gaS5xaS5pbnNlcnQoby50YXJnZXRJZCwgbyksIGkuQ3MudXBkYXRlVGFyZ2V0RGF0YSh0LCBvKS5uZXh0KCgoKSA9PiBpLkNzLnJlbW92ZU1hdGNoaW5nS2V5c0ZvclRhcmdldElkKHQsIHMudGFyZ2V0SWQpKSkubmV4dCgoKCkgPT4gaS5Dcy5hZGRNYXRjaGluZ0tleXModCwgbiwgcy50YXJnZXRJZCkpKS5uZXh0KCgoKSA9PiBpLk5zLnNhdmVOYW1lZFF1ZXJ5KHQsIGUpKSk7XG4gICAgfSkpO1xufVxuXG4vKiogQXNzZW1ibGVzIHRoZSBrZXkgZm9yIGEgY2xpZW50IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi9cbmZ1bmN0aW9uIG51KHQsIGUpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV9jbGllbnRzXyR7dH1fJHtlfWA7XG59XG5cbi8vIFRoZSBmb3JtYXQgb2YgdGhlIFdlYlN0b3JhZ2Uga2V5IHRoYXQgc3RvcmVzIHRoZSBtdXRhdGlvbiBzdGF0ZSBpczpcbi8vICAgICBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5cbi8vICAgICAoZm9yIHVuYXV0aGVudGljYXRlZCB1c2Vycylcbi8vIG9yOiBmaXJlc3RvcmVfbXV0YXRpb25zXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XzxiYXRjaF9pZD5fPHVzZXJfdWlkPlxuXG4vLyAndXNlcl91aWQnIGlzIGxhc3QgdG8gYXZvaWQgbmVlZGluZyB0byBlc2NhcGUgJ18nIGNoYXJhY3RlcnMgdGhhdCBpdCBtaWdodFxuLy8gY29udGFpbi5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBtdXRhdGlvbiBiYXRjaCBpbiBXZWJTdG9yYWdlICovXG5mdW5jdGlvbiBzdSh0LCBlLCBuKSB7XG4gICAgbGV0IHMgPSBgZmlyZXN0b3JlX211dGF0aW9uc18ke3R9XyR7bn1gO1xuICAgIHJldHVybiBlLmlzQXV0aGVudGljYXRlZCgpICYmIChzICs9IGBfJHtlLnVpZH1gKSwgcztcbn1cblxuLy8gVGhlIGZvcm1hdCBvZiB0aGUgV2ViU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgYSBxdWVyeSB0YXJnZXQncyBtZXRhZGF0YSBpczpcbi8vICAgICBmaXJlc3RvcmVfdGFyZ2V0c188cGVyc2lzdGVuY2VfcHJlZml4Pl88dGFyZ2V0X2lkPlxuLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciBhIHF1ZXJ5IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi9cbmZ1bmN0aW9uIGl1KHQsIGUpIHtcbiAgICByZXR1cm4gYGZpcmVzdG9yZV90YXJnZXRzXyR7dH1fJHtlfWA7XG59XG5cbi8vIFRoZSBXZWJTdG9yYWdlIHByZWZpeCB0aGF0IHN0b3JlcyB0aGUgcHJpbWFyeSB0YWIncyBvbmxpbmUgc3RhdGUuIFRoZVxuLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4vLyAgICAgZmlyZXN0b3JlX29ubGluZV9zdGF0ZV88cGVyc2lzdGVuY2VfcHJlZml4PlxuLyoqXG4gKiBIb2xkcyB0aGUgc3RhdGUgb2YgYSBtdXRhdGlvbiBiYXRjaCwgaW5jbHVkaW5nIGl0cyB1c2VyIElELCBiYXRjaCBJRCBhbmRcbiAqIHdoZXRoZXIgdGhlIGJhdGNoIGlzICdwZW5kaW5nJywgJ2Fja25vd2xlZGdlZCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgcnUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgdGhpcy51c2VyID0gdCwgdGhpcy5iYXRjaElkID0gZSwgdGhpcy5zdGF0ZSA9IG4sIHRoaXMuZXJyb3IgPSBzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBNdXRhdGlvbk1ldGFkYXRhIGZyb20gaXRzIEpTT04gcmVwcmVzZW50YXRpb24gaW4gV2ViU3RvcmFnZS5cbiAgICAgKiBMb2dzIGEgd2FybmluZyBhbmQgcmV0dXJucyBudWxsIGlmIHRoZSBmb3JtYXQgb2YgdGhlIGRhdGEgaXMgbm90IHZhbGlkLlxuICAgICAqLyAgICBzdGF0aWMgWmkodCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gSlNPTi5wYXJzZShuKTtcbiAgICAgICAgbGV0IGksIHIgPSBcIm9iamVjdFwiID09IHR5cGVvZiBzICYmIC0xICE9PSBbIFwicGVuZGluZ1wiLCBcImFja25vd2xlZGdlZFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKHMuc3RhdGUpICYmICh2b2lkIDAgPT09IHMuZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygcy5lcnJvcik7XG4gICAgICAgIHJldHVybiByICYmIHMuZXJyb3IgJiYgKHIgPSBcInN0cmluZ1wiID09IHR5cGVvZiBzLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygcy5lcnJvci5jb2RlLCBcbiAgICAgICAgciAmJiAoaSA9IG5ldyBMKHMuZXJyb3IuY29kZSwgcy5lcnJvci5tZXNzYWdlKSkpLCByID8gbmV3IHJ1KHQsIGUsIHMuc3RhdGUsIGkpIDogKHgoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIG11dGF0aW9uIHN0YXRlIGZvciBJRCAnJHtlfSc6ICR7bn1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbiAgICB0cigpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yICYmICh0LmVycm9yID0ge1xuICAgICAgICAgICAgY29kZTogdGhpcy5lcnJvci5jb2RlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5lcnJvci5tZXNzYWdlXG4gICAgICAgIH0pLCBKU09OLnN0cmluZ2lmeSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogSG9sZHMgdGhlIHN0YXRlIG9mIGEgcXVlcnkgdGFyZ2V0LCBpbmNsdWRpbmcgaXRzIHRhcmdldCBJRCBhbmQgd2hldGhlciB0aGVcbiAqIHRhcmdldCBpcyAnbm90LWN1cnJlbnQnLCAnY3VycmVudCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3Mgb3Uge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IHQsIHRoaXMuc3RhdGUgPSBlLCB0aGlzLmVycm9yID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUXVlcnlUYXJnZXRNZXRhZGF0YSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIFppKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UoZSk7XG4gICAgICAgIGxldCBzLCBpID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbiAmJiAtMSAhPT0gWyBcIm5vdC1jdXJyZW50XCIsIFwiY3VycmVudFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKG4uc3RhdGUpICYmICh2b2lkIDAgPT09IG4uZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygbi5lcnJvcik7XG4gICAgICAgIHJldHVybiBpICYmIG4uZXJyb3IgJiYgKGkgPSBcInN0cmluZ1wiID09IHR5cGVvZiBuLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygbi5lcnJvci5jb2RlLCBcbiAgICAgICAgaSAmJiAocyA9IG5ldyBMKG4uZXJyb3IuY29kZSwgbi5lcnJvci5tZXNzYWdlKSkpLCBpID8gbmV3IG91KHQsIG4uc3RhdGUsIHMpIDogKHgoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIHRhcmdldCBzdGF0ZSBmb3IgSUQgJyR7dH0nOiAke2V9YCksIFxuICAgICAgICBudWxsKTtcbiAgICB9XG4gICAgdHIoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgICAgICAgIHVwZGF0ZVRpbWVNczogRGF0ZS5ub3coKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5lcnJvciAmJiAodC5lcnJvciA9IHtcbiAgICAgICAgICAgIGNvZGU6IHRoaXMuZXJyb3IuY29kZSxcbiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuZXJyb3IubWVzc2FnZVxuICAgICAgICB9KSwgSlNPTi5zdHJpbmdpZnkodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyB0aGUgaW1tdXRhYmxlIENsaWVudFN0YXRlIGZvciBhIGNsaWVudCByZWFkIGZyb21cbiAqIFdlYlN0b3JhZ2UsIGNvbnRhaW5pbmcgdGhlIGxpc3Qgb2YgYWN0aXZlIHF1ZXJ5IHRhcmdldHMuXG4gKi8gY2xhc3MgdXUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IHQsIHRoaXMuYWN0aXZlVGFyZ2V0SWRzID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUmVtb3RlQ2xpZW50U3RhdGUgZnJvbSB0aGUgSlNPTiByZXByZXNlbnRhdGlvbiBpbiBXZWJTdG9yYWdlLlxuICAgICAqIExvZ3MgYSB3YXJuaW5nIGFuZCByZXR1cm5zIG51bGwgaWYgdGhlIGZvcm1hdCBvZiB0aGUgZGF0YSBpcyBub3QgdmFsaWQuXG4gICAgICovICAgIHN0YXRpYyBaaSh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBKU09OLnBhcnNlKGUpO1xuICAgICAgICBsZXQgcyA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIG4gJiYgbi5hY3RpdmVUYXJnZXRJZHMgaW5zdGFuY2VvZiBBcnJheSwgaSA9IFJzKCk7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyBzICYmIHQgPCBuLmFjdGl2ZVRhcmdldElkcy5sZW5ndGg7ICsrdCkgcyA9IEt0KG4uYWN0aXZlVGFyZ2V0SWRzW3RdKSwgXG4gICAgICAgIGkgPSBpLmFkZChuLmFjdGl2ZVRhcmdldElkc1t0XSk7XG4gICAgICAgIHJldHVybiBzID8gbmV3IHV1KHQsIGkpIDogKHgoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBgRmFpbGVkIHRvIHBhcnNlIGNsaWVudCBkYXRhIGZvciBpbnN0YW5jZSAnJHt0fSc6ICR7ZX1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgdGhlIG9ubGluZSBzdGF0ZSBmb3IgYWxsIGNsaWVudHMgcGFydGljaXBhdGluZyBpblxuICogbXVsdGktdGFiLiBUaGUgb25saW5lIHN0YXRlIGlzIG9ubHkgd3JpdHRlbiB0byBieSB0aGUgcHJpbWFyeSBjbGllbnQsIGFuZFxuICogdXNlZCBpbiBzZWNvbmRhcnkgY2xpZW50cyB0byB1cGRhdGUgdGhlaXIgcXVlcnkgdmlld3MuXG4gKi8gY2xhc3MgY3Uge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IHQsIHRoaXMub25saW5lU3RhdGUgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBTaGFyZWRPbmxpbmVTdGF0ZSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIFppKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IEpTT04ucGFyc2UodCk7XG4gICAgICAgIHJldHVybiBcIm9iamVjdFwiID09IHR5cGVvZiBlICYmIC0xICE9PSBbIFwiVW5rbm93blwiLCBcIk9ubGluZVwiLCBcIk9mZmxpbmVcIiBdLmluZGV4T2YoZS5vbmxpbmVTdGF0ZSkgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS5jbGllbnRJZCA/IG5ldyBjdShlLmNsaWVudElkLCBlLm9ubGluZVN0YXRlKSA6ICh4KFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgYEZhaWxlZCB0byBwYXJzZSBvbmxpbmUgc3RhdGU6ICR7dH1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBNZXRhZGF0YSBzdGF0ZSBvZiB0aGUgbG9jYWwgY2xpZW50LiBVbmxpa2UgYFJlbW90ZUNsaWVudFN0YXRlYCwgdGhpcyBjbGFzcyBpc1xuICogbXV0YWJsZSBhbmQga2VlcHMgdHJhY2sgb2YgYWxsIHBlbmRpbmcgbXV0YXRpb25zLCB3aGljaCBhbGxvd3MgdXMgdG9cbiAqIHVwZGF0ZSB0aGUgcmFuZ2Ugb2YgcGVuZGluZyBtdXRhdGlvbiBiYXRjaCBJRHMgYXMgbmV3IG11dGF0aW9ucyBhcmUgYWRkZWQgb3JcbiAqIHJlbW92ZWQuXG4gKlxuICogVGhlIGRhdGEgaW4gYExvY2FsQ2xpZW50U3RhdGVgIGlzIG5vdCByZWFkIGZyb20gV2ViU3RvcmFnZSBhbmQgaW5zdGVhZFxuICogdXBkYXRlZCB2aWEgaXRzIGluc3RhbmNlIG1ldGhvZHMuIFRoZSB1cGRhdGVkIHN0YXRlIGNhbiBiZSBzZXJpYWxpemVkIHZpYVxuICogYHRvV2ViU3RvcmFnZUpTT04oKWAuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG5jbGFzcyBhdSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYWN0aXZlVGFyZ2V0SWRzID0gUnMoKTtcbiAgICB9XG4gICAgZXIodCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmFkZCh0KTtcbiAgICB9XG4gICAgbnIodCkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmRlbGV0ZSh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBlbnRyeSBpbnRvIGEgSlNPTi1lbmNvZGVkIGZvcm1hdCB3ZSBjYW4gdXNlIGZvciBXZWJTdG9yYWdlLlxuICAgICAqIERvZXMgbm90IGVuY29kZSBgY2xpZW50SWRgIGFzIGl0IGlzIHBhcnQgb2YgdGhlIGtleSBpbiBXZWJTdG9yYWdlLlxuICAgICAqLyAgICB0cigpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIGFjdGl2ZVRhcmdldElkczogdGhpcy5hY3RpdmVUYXJnZXRJZHMudG9BcnJheSgpLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgdXNlcyBXZWJTdG9yYWdlICh3aW5kb3cubG9jYWxTdG9yYWdlKSBhcyB0aGVcbiAqIGJhY2tpbmcgc3RvcmUgZm9yIHRoZSBTaGFyZWRDbGllbnRTdGF0ZS4gSXQga2VlcHMgdHJhY2sgb2YgYWxsIGFjdGl2ZVxuICogY2xpZW50cyBhbmQgc3VwcG9ydHMgbW9kaWZpY2F0aW9ucyBvZiB0aGUgbG9jYWwgY2xpZW50J3MgZGF0YS5cbiAqLyBjbGFzcyBodSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLndpbmRvdyA9IHQsIHRoaXMuSHMgPSBlLCB0aGlzLnBlcnNpc3RlbmNlS2V5ID0gbiwgdGhpcy5zciA9IHMsIHRoaXMuc3luY0VuZ2luZSA9IG51bGwsIFxuICAgICAgICB0aGlzLm9ubGluZVN0YXRlSGFuZGxlciA9IG51bGwsIHRoaXMuc2VxdWVuY2VOdW1iZXJIYW5kbGVyID0gbnVsbCwgdGhpcy5pciA9IHRoaXMucnIuYmluZCh0aGlzKSwgXG4gICAgICAgIHRoaXMudXIgPSBuZXcgR2UoWiksIHRoaXMuc3RhcnRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhcHR1cmVzIFdlYlN0b3JhZ2UgZXZlbnRzIHRoYXQgb2NjdXIgYmVmb3JlIGBzdGFydCgpYCBpcyBjYWxsZWQuIFRoZXNlXG4gICAgICAgICAqIGV2ZW50cyBhcmUgcmVwbGF5ZWQgb25jZSBgV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlYCBpcyBzdGFydGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jciA9IFtdO1xuICAgICAgICAvLyBFc2NhcGUgdGhlIHNwZWNpYWwgY2hhcmFjdGVycyBtZW50aW9uZWQgaGVyZTpcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9HdWlkZS9SZWd1bGFyX0V4cHJlc3Npb25zXG4gICAgICAgIGNvbnN0IHIgPSBuLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCBcIlxcXFwkJlwiKTtcbiAgICAgICAgdGhpcy5zdG9yYWdlID0gdGhpcy53aW5kb3cubG9jYWxTdG9yYWdlLCB0aGlzLmN1cnJlbnRVc2VyID0gaSwgdGhpcy5hciA9IG51KHRoaXMucGVyc2lzdGVuY2VLZXksIHRoaXMuc3IpLCBcbiAgICAgICAgdGhpcy5ociA9IFxuICAgICAgICAvKiogQXNzZW1ibGVzIHRoZSBrZXkgZm9yIHRoZSBjdXJyZW50IHNlcXVlbmNlIG51bWJlci4gKi9cbiAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgcmV0dXJuIGBmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXyR7dH1gO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy51ciA9IHRoaXMudXIuaW5zZXJ0KHRoaXMuc3IsIG5ldyBhdSksIHRoaXMubHIgPSBuZXcgUmVnRXhwKGBeZmlyZXN0b3JlX2NsaWVudHNfJHtyfV8oW15fXSopJGApLCBcbiAgICAgICAgdGhpcy5kciA9IG5ldyBSZWdFeHAoYF5maXJlc3RvcmVfbXV0YXRpb25zXyR7cn1fKFxcXFxkKykoPzpfKC4qKSk/JGApLCB0aGlzLl9yID0gbmV3IFJlZ0V4cChgXmZpcmVzdG9yZV90YXJnZXRzXyR7cn1fKFxcXFxkKykkYCksIFxuICAgICAgICB0aGlzLndyID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIG9ubGluZSBzdGF0ZSBvZiB0aGUgcHJpbWFyeSB0YWIuICovXG4gICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBgZmlyZXN0b3JlX29ubGluZV9zdGF0ZV8ke3R9YDtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGUgV2ViU3RvcmFnZSBwcmVmaXggdGhhdCBwbGF5cyBhcyBhIGV2ZW50IHRvIGluZGljYXRlIHRoZSByZW1vdGUgZG9jdW1lbnRzXG4gICAgICAgIC8vIG1pZ2h0IGhhdmUgY2hhbmdlZCBkdWUgdG8gc29tZSBzZWNvbmRhcnkgdGFicyBsb2FkaW5nIGEgYnVuZGxlLlxuICAgICAgICAvLyBmb3JtYXQgb2YgdGhlIGtleSBpczpcbiAgICAgICAgLy8gICAgIGZpcmVzdG9yZV9idW5kbGVfbG9hZGVkX3YyXzxwZXJzaXN0ZW5jZUtleT5cbiAgICAgICAgLy8gVGhlIHZlcnNpb24gZW5kaW5nIHdpdGggXCJ2MlwiIHN0b3JlcyB0aGUgbGlzdCBvZiBtb2RpZmllZCBjb2xsZWN0aW9uIGdyb3Vwcy5cbiAgICAgICAgKHRoaXMucGVyc2lzdGVuY2VLZXkpLCB0aGlzLm1yID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgcmV0dXJuIGBmaXJlc3RvcmVfYnVuZGxlX2xvYWRlZF92Ml8ke3R9YDtcbiAgICAgICAgfVxuICAgICAgICAvLyBUaGUgV2ViU3RvcmFnZSBrZXkgcHJlZml4IGZvciB0aGUga2V5IHRoYXQgc3RvcmVzIHRoZSBsYXN0IHNlcXVlbmNlIG51bWJlciBhbGxvY2F0ZWQuIFRoZSBrZXlcbiAgICAgICAgLy8gbG9va3MgbGlrZSAnZmlyZXN0b3JlX3NlcXVlbmNlX251bWJlcl88cGVyc2lzdGVuY2VfcHJlZml4PicuXG4gICAgICAgICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgXG4gICAgICAgIC8vIFJhdGhlciB0aGFuIGFkZGluZyB0aGUgc3RvcmFnZSBvYnNlcnZlciBkdXJpbmcgc3RhcnQoKSwgd2UgYWRkIHRoZVxuICAgICAgICAvLyBzdG9yYWdlIG9ic2VydmVyIGR1cmluZyBpbml0aWFsaXphdGlvbi4gVGhpcyBlbnN1cmVzIHRoYXQgd2UgY29sbGVjdFxuICAgICAgICAvLyBldmVudHMgYmVmb3JlIG90aGVyIGNvbXBvbmVudHMgcG9wdWxhdGUgdGhlaXIgaW5pdGlhbCBzdGF0ZSAoZHVyaW5nIHRoZWlyXG4gICAgICAgIC8vIHJlc3BlY3RpdmUgc3RhcnQoKSBjYWxscykuIE90aGVyd2lzZSwgd2UgbWlnaHQgZm9yIGV4YW1wbGUgbWlzcyBhXG4gICAgICAgIC8vIG11dGF0aW9uIHRoYXQgaXMgYWRkZWQgYWZ0ZXIgTG9jYWxTdG9yZSdzIHN0YXJ0KCkgcHJvY2Vzc2VkIHRoZSBleGlzdGluZ1xuICAgICAgICAvLyBtdXRhdGlvbnMgYnV0IGJlZm9yZSB3ZSBvYnNlcnZlIFdlYlN0b3JhZ2UgZXZlbnRzLlxuICAgICAgICB0aGlzLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwic3RvcmFnZVwiLCB0aGlzLmlyKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgJ3RydWUnIGlmIFdlYlN0b3JhZ2UgaXMgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50LiAqLyAgICBzdGF0aWMgQyh0KSB7XG4gICAgICAgIHJldHVybiAhKCF0IHx8ICF0LmxvY2FsU3RvcmFnZSk7XG4gICAgfVxuICAgIGFzeW5jIHN0YXJ0KCkge1xuICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgbGlzdCBvZiBleGlzdGluZyBjbGllbnRzIHRvIGJhY2tmaWxsIHRoZSBkYXRhIGluXG4gICAgICAgIC8vIFNoYXJlZENsaWVudFN0YXRlLlxuICAgICAgICBjb25zdCB0ID0gYXdhaXQgdGhpcy5zeW5jRW5naW5lLnZpKCk7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICBpZiAoZSA9PT0gdGhpcy5zcikgY29udGludWU7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5nZXRJdGVtKG51KHRoaXMucGVyc2lzdGVuY2VLZXksIGUpKTtcbiAgICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHV1LlppKGUsIHQpO1xuICAgICAgICAgICAgICAgIG4gJiYgKHRoaXMudXIgPSB0aGlzLnVyLmluc2VydChuLmNsaWVudElkLCBuKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ncigpO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhbiBleGlzdGluZyBvbmxpbmUgc3RhdGUgYW5kIGNhbGwgdGhlIGNhbGxiYWNrIGhhbmRsZXJcbiAgICAgICAgLy8gaWYgYXBwbGljYWJsZS5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKHRoaXMud3IpO1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMueXIoZSk7XG4gICAgICAgICAgICB0ICYmIHRoaXMucHIodCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHRoaXMuY3IpIHRoaXMucnIodCk7XG4gICAgICAgIHRoaXMuY3IgPSBbXSwgXG4gICAgICAgIC8vIFJlZ2lzdGVyIGEgd2luZG93IHVubG9hZCBob29rIHRvIHJlbW92ZSB0aGUgY2xpZW50IG1ldGFkYXRhIGVudHJ5IGZyb21cbiAgICAgICAgLy8gV2ViU3RvcmFnZSBldmVuIGlmIGBzaHV0ZG93bigpYCB3YXMgbm90IGNhbGxlZC5cbiAgICAgICAgdGhpcy53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInBhZ2VoaWRlXCIsICgoKSA9PiB0aGlzLnNodXRkb3duKCkpKSwgdGhpcy5zdGFydGVkID0gITA7XG4gICAgfVxuICAgIHdyaXRlU2VxdWVuY2VOdW1iZXIodCkge1xuICAgICAgICB0aGlzLnNldEl0ZW0odGhpcy5ociwgSlNPTi5zdHJpbmdpZnkodCkpO1xuICAgIH1cbiAgICBnZXRBbGxBY3RpdmVRdWVyeVRhcmdldHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLklyKHRoaXMudXIpO1xuICAgIH1cbiAgICBpc0FjdGl2ZVF1ZXJ5VGFyZ2V0KHQpIHtcbiAgICAgICAgbGV0IGUgPSAhMTtcbiAgICAgICAgcmV0dXJuIHRoaXMudXIuZm9yRWFjaCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIHMuYWN0aXZlVGFyZ2V0SWRzLmhhcyh0KSAmJiAoZSA9ICEwKTtcbiAgICAgICAgfSkpLCBlO1xuICAgIH1cbiAgICBhZGRQZW5kaW5nTXV0YXRpb24odCkge1xuICAgICAgICB0aGlzLlRyKHQsIFwicGVuZGluZ1wiKTtcbiAgICB9XG4gICAgdXBkYXRlTXV0YXRpb25TdGF0ZSh0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuVHIodCwgZSwgbiksIFxuICAgICAgICAvLyBPbmNlIGEgZmluYWwgbXV0YXRpb24gcmVzdWx0IGlzIG9ic2VydmVkIGJ5IG90aGVyIGNsaWVudHMsIHRoZXkgbm8gbG9uZ2VyXG4gICAgICAgIC8vIGFjY2VzcyB0aGUgbXV0YXRpb24ncyBtZXRhZGF0YSBlbnRyeS4gU2luY2UgV2ViU3RvcmFnZSByZXBsYXlzIGV2ZW50c1xuICAgICAgICAvLyBpbiBvcmRlciwgaXQgaXMgc2FmZSB0byBkZWxldGUgdGhlIGVudHJ5IHJpZ2h0IGFmdGVyIHVwZGF0aW5nIGl0LlxuICAgICAgICB0aGlzLkVyKHQpO1xuICAgIH1cbiAgICBhZGRMb2NhbFF1ZXJ5VGFyZ2V0KHQpIHtcbiAgICAgICAgbGV0IGUgPSBcIm5vdC1jdXJyZW50XCI7XG4gICAgICAgIC8vIExvb2t1cCBhbiBleGlzdGluZyBxdWVyeSBzdGF0ZSBpZiB0aGUgdGFyZ2V0IElEIHdhcyBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAgICAgICAgLy8gYnkgYW5vdGhlciB0YWJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZVF1ZXJ5VGFyZ2V0KHQpKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oaXUodGhpcy5wZXJzaXN0ZW5jZUtleSwgdCkpO1xuICAgICAgICAgICAgaWYgKG4pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gb3UuWmkodCwgbik7XG4gICAgICAgICAgICAgICAgcyAmJiAoZSA9IHMuc3RhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLkFyLmVyKHQpLCB0aGlzLmdyKCksIGU7XG4gICAgfVxuICAgIHJlbW92ZUxvY2FsUXVlcnlUYXJnZXQodCkge1xuICAgICAgICB0aGlzLkFyLm5yKHQpLCB0aGlzLmdyKCk7XG4gICAgfVxuICAgIGlzTG9jYWxRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkFyLmFjdGl2ZVRhcmdldElkcy5oYXModCk7XG4gICAgfVxuICAgIGNsZWFyUXVlcnlTdGF0ZSh0KSB7XG4gICAgICAgIHRoaXMucmVtb3ZlSXRlbShpdSh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0KSk7XG4gICAgfVxuICAgIHVwZGF0ZVF1ZXJ5U3RhdGUodCwgZSwgbikge1xuICAgICAgICB0aGlzLlJyKHQsIGUsIG4pO1xuICAgIH1cbiAgICBoYW5kbGVVc2VyQ2hhbmdlKHQsIGUsIG4pIHtcbiAgICAgICAgZS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuRXIodCk7XG4gICAgICAgIH0pKSwgdGhpcy5jdXJyZW50VXNlciA9IHQsIG4uZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICB0aGlzLmFkZFBlbmRpbmdNdXRhdGlvbih0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzZXRPbmxpbmVTdGF0ZSh0KSB7XG4gICAgICAgIHRoaXMuYnIodCk7XG4gICAgfVxuICAgIG5vdGlmeUJ1bmRsZUxvYWRlZCh0KSB7XG4gICAgICAgIHRoaXMuUHIodCk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB0aGlzLnN0YXJ0ZWQgJiYgKHRoaXMud2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzdG9yYWdlXCIsIHRoaXMuaXIpLCB0aGlzLnJlbW92ZUl0ZW0odGhpcy5hciksIFxuICAgICAgICB0aGlzLnN0YXJ0ZWQgPSAhMSk7XG4gICAgfVxuICAgIGdldEl0ZW0odCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0odCk7XG4gICAgICAgIHJldHVybiBDKFwiU2hhcmVkQ2xpZW50U3RhdGVcIiwgXCJSRUFEXCIsIHQsIGUpLCBlO1xuICAgIH1cbiAgICBzZXRJdGVtKHQsIGUpIHtcbiAgICAgICAgQyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiU0VUXCIsIHQsIGUpLCB0aGlzLnN0b3JhZ2Uuc2V0SXRlbSh0LCBlKTtcbiAgICB9XG4gICAgcmVtb3ZlSXRlbSh0KSB7XG4gICAgICAgIEMoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBcIlJFTU9WRVwiLCB0KSwgdGhpcy5zdG9yYWdlLnJlbW92ZUl0ZW0odCk7XG4gICAgfVxuICAgIHJyKHQpIHtcbiAgICAgICAgLy8gTm90ZTogVGhlIGZ1bmN0aW9uIGlzIHR5cGVkIHRvIHRha2UgRXZlbnQgdG8gYmUgaW50ZXJmYWNlLWNvbXBhdGlibGUgd2l0aFxuICAgICAgICAvLyBgV2luZG93LmFkZEV2ZW50TGlzdGVuZXJgLlxuICAgICAgICBjb25zdCBlID0gdDtcbiAgICAgICAgaWYgKGUuc3RvcmFnZUFyZWEgPT09IHRoaXMuc3RvcmFnZSkge1xuICAgICAgICAgICAgaWYgKEMoXCJTaGFyZWRDbGllbnRTdGF0ZVwiLCBcIkVWRU5UXCIsIGUua2V5LCBlLm5ld1ZhbHVlKSwgZS5rZXkgPT09IHRoaXMuYXIpIHJldHVybiB2b2lkIHgoXCJSZWNlaXZlZCBXZWJTdG9yYWdlIG5vdGlmaWNhdGlvbiBmb3IgbG9jYWwgY2hhbmdlLiBBbm90aGVyIGNsaWVudCBtaWdodCBoYXZlIGdhcmJhZ2UtY29sbGVjdGVkIG91ciBzdGF0ZVwiKTtcbiAgICAgICAgICAgIHRoaXMuSHMuZW5xdWV1ZVJldHJ5YWJsZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IGUua2V5KSBpZiAodGhpcy5sci50ZXN0KGUua2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gZS5uZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLnZyKGUua2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5Wcih0LCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5TcihlLmtleSwgZS5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQpIHJldHVybiB0aGlzLlZyKHQuY2xpZW50SWQsIHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZHIudGVzdChlLmtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBlLm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuRHIoZS5rZXksIGUubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0KSByZXR1cm4gdGhpcy5Dcih0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9yLnRlc3QoZS5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gZS5uZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLk5yKGUua2V5LCBlLm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCkgcmV0dXJuIHRoaXMua3IodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IHRoaXMud3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSBlLm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMueXIoZS5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQpIHJldHVybiB0aGlzLnByKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGUua2V5ID09PSB0aGlzLmhyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBlID0gT3QuYXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdCkgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE0oXCJudW1iZXJcIiA9PSB0eXBlb2YgbiksIGUgPSBuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeChcIlNoYXJlZENsaWVudFN0YXRlXCIsIFwiRmFpbGVkIHRvIHJlYWQgc2VxdWVuY2UgbnVtYmVyIGZyb20gV2ViU3RvcmFnZVwiLCB0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAqIGBNZW1vcnlTaGFyZWRDbGllbnRTdGF0ZWAgaXMgYSBzaW1wbGUgaW1wbGVtZW50YXRpb24gb2YgU2hhcmVkQ2xpZW50U3RhdGUgZm9yXG4gKiBjbGllbnRzIHVzaW5nIG1lbW9yeSBwZXJzaXN0ZW5jZS4gVGhlIHN0YXRlIGluIHRoaXMgY2xhc3MgcmVtYWlucyBmdWxseVxuICogaXNvbGF0ZWQgYW5kIG5vIHN5bmNocm9uaXphdGlvbiBpcyBwZXJmb3JtZWQuXG4gKi8gKGUubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdCAhPT0gT3QuYXQgJiYgdGhpcy5zZXF1ZW5jZU51bWJlckhhbmRsZXIodCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXkgPT09IHRoaXMubXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLk9yKGUubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwodC5tYXAoKHQgPT4gdGhpcy5zeW5jRW5naW5lLk1yKHQpKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuY3IucHVzaChlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgQXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVyLmdldCh0aGlzLnNyKTtcbiAgICB9XG4gICAgZ3IoKSB7XG4gICAgICAgIHRoaXMuc2V0SXRlbSh0aGlzLmFyLCB0aGlzLkFyLnRyKCkpO1xuICAgIH1cbiAgICBUcih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgcnUodGhpcy5jdXJyZW50VXNlciwgdCwgZSwgbiksIGkgPSBzdSh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0aGlzLmN1cnJlbnRVc2VyLCB0KTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKGksIHMudHIoKSk7XG4gICAgfVxuICAgIEVyKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHN1KHRoaXMucGVyc2lzdGVuY2VLZXksIHRoaXMuY3VycmVudFVzZXIsIHQpO1xuICAgICAgICB0aGlzLnJlbW92ZUl0ZW0oZSk7XG4gICAgfVxuICAgIGJyKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLnNyLFxuICAgICAgICAgICAgb25saW5lU3RhdGU6IHRcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0odGhpcy53ciwgSlNPTi5zdHJpbmdpZnkoZSkpO1xuICAgIH1cbiAgICBScih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBpdSh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0KSwgaSA9IG5ldyBvdSh0LCBlLCBuKTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHMsIGkudHIoKSk7XG4gICAgfVxuICAgIFByKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IEpTT04uc3RyaW5naWZ5KEFycmF5LmZyb20odCkpO1xuICAgICAgICB0aGlzLnNldEl0ZW0odGhpcy5tciwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIGNsaWVudCBzdGF0ZSBrZXkgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyBudWxsIGlmIHRoZSBrZXkgZG9lcyBub3RcbiAgICAgKiBtYXRjaCB0aGUgZXhwZWN0ZWQga2V5IGZvcm1hdC5cbiAgICAgKi8gICAgdnIodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5sci5leGVjKHQpO1xuICAgICAgICByZXR1cm4gZSA/IGVbMV0gOiBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBjbGllbnQgc3RhdGUgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlIGNvdWxkIG5vdFxuICAgICAqIGJlIHBhcnNlZC5cbiAgICAgKi8gICAgU3IodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy52cih0KTtcbiAgICAgICAgcmV0dXJuIHV1LlppKG4sIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBtdXRhdGlvbiBiYXRjaCBzdGF0ZSBpbiBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICBEcih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmRyLmV4ZWModCksIHMgPSBOdW1iZXIoblsxXSksIGkgPSB2b2lkIDAgIT09IG5bMl0gPyBuWzJdIDogbnVsbDtcbiAgICAgICAgcmV0dXJuIHJ1LlppKG5ldyBQKGkpLCBzLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgcXVlcnkgdGFyZ2V0IHN0YXRlIGZyb20gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlXG4gICAgICogY291bGQgbm90IGJlIHBhcnNlZC5cbiAgICAgKi8gICAgTnIodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5fci5leGVjKHQpLCBzID0gTnVtYmVyKG5bMV0pO1xuICAgICAgICByZXR1cm4gb3UuWmkocywgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhbiBvbmxpbmUgc3RhdGUgZnJvbSBXZWJTdG9yYWdlLiBSZXR1cm5zICdudWxsJyBpZiB0aGUgdmFsdWVcbiAgICAgKiBjb3VsZCBub3QgYmUgcGFyc2VkLlxuICAgICAqLyAgICB5cih0KSB7XG4gICAgICAgIHJldHVybiBjdS5aaSh0KTtcbiAgICB9XG4gICAgT3IodCkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh0KTtcbiAgICB9XG4gICAgYXN5bmMgQ3IodCkge1xuICAgICAgICBpZiAodC51c2VyLnVpZCA9PT0gdGhpcy5jdXJyZW50VXNlci51aWQpIHJldHVybiB0aGlzLnN5bmNFbmdpbmUuRnIodC5iYXRjaElkLCB0LnN0YXRlLCB0LmVycm9yKTtcbiAgICAgICAgQyhcIlNoYXJlZENsaWVudFN0YXRlXCIsIGBJZ25vcmluZyBtdXRhdGlvbiBmb3Igbm9uLWFjdGl2ZSB1c2VyICR7dC51c2VyLnVpZH1gKTtcbiAgICB9XG4gICAga3IodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zeW5jRW5naW5lLiRyKHQudGFyZ2V0SWQsIHQuc3RhdGUsIHQuZXJyb3IpO1xuICAgIH1cbiAgICBWcih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBlID8gdGhpcy51ci5pbnNlcnQodCwgZSkgOiB0aGlzLnVyLnJlbW92ZSh0KSwgcyA9IHRoaXMuSXIodGhpcy51ciksIGkgPSB0aGlzLklyKG4pLCByID0gW10sIG8gPSBbXTtcbiAgICAgICAgcmV0dXJuIGkuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBzLmhhcyh0KSB8fCByLnB1c2godCk7XG4gICAgICAgIH0pKSwgcy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGkuaGFzKHQpIHx8IG8ucHVzaCh0KTtcbiAgICAgICAgfSkpLCB0aGlzLnN5bmNFbmdpbmUuQnIociwgbykudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51ciA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgcHIodCkge1xuICAgICAgICAvLyBXZSBjaGVjayB3aGV0aGVyIHRoZSBjbGllbnQgdGhhdCB3cm90ZSB0aGlzIG9ubGluZSBzdGF0ZSBpcyBzdGlsbCBhY3RpdmVcbiAgICAgICAgLy8gYnkgY29tcGFyaW5nIGl0cyBjbGllbnQgSUQgdG8gdGhlIGxpc3Qgb2YgY2xpZW50cyBrZXB0IGFjdGl2ZSBpblxuICAgICAgICAvLyBJbmRleGVkRGIuIElmIGEgY2xpZW50IGRvZXMgbm90IHVwZGF0ZSB0aGVpciBJbmRleGVkRGIgY2xpZW50IHN0YXRlXG4gICAgICAgIC8vIHdpdGhpbiA1IHNlY29uZHMsIGl0IGlzIGNvbnNpZGVyZWQgaW5hY3RpdmUgYW5kIHdlIGRvbid0IGVtaXQgYW4gb25saW5lXG4gICAgICAgIC8vIHN0YXRlIGV2ZW50LlxuICAgICAgICB0aGlzLnVyLmdldCh0LmNsaWVudElkKSAmJiB0aGlzLm9ubGluZVN0YXRlSGFuZGxlcih0Lm9ubGluZVN0YXRlKTtcbiAgICB9XG4gICAgSXIodCkge1xuICAgICAgICBsZXQgZSA9IFJzKCk7XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBlID0gZS51bmlvbldpdGgobi5hY3RpdmVUYXJnZXRJZHMpO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxufVxuXG5jbGFzcyBsdSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuTHIgPSBuZXcgYXUsIHRoaXMucXIgPSB7fSwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIgPSBudWxsLCB0aGlzLnNlcXVlbmNlTnVtYmVySGFuZGxlciA9IG51bGw7XG4gICAgfVxuICAgIGFkZFBlbmRpbmdNdXRhdGlvbih0KSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICB1cGRhdGVNdXRhdGlvblN0YXRlKHQsIGUsIG4pIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGFkZExvY2FsUXVlcnlUYXJnZXQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Mci5lcih0KSwgdGhpcy5xclt0XSB8fCBcIm5vdC1jdXJyZW50XCI7XG4gICAgfVxuICAgIHVwZGF0ZVF1ZXJ5U3RhdGUodCwgZSwgbikge1xuICAgICAgICB0aGlzLnFyW3RdID0gZTtcbiAgICB9XG4gICAgcmVtb3ZlTG9jYWxRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHRoaXMuTHIubnIodCk7XG4gICAgfVxuICAgIGlzTG9jYWxRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxyLmFjdGl2ZVRhcmdldElkcy5oYXModCk7XG4gICAgfVxuICAgIGNsZWFyUXVlcnlTdGF0ZSh0KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnFyW3RdO1xuICAgIH1cbiAgICBnZXRBbGxBY3RpdmVRdWVyeVRhcmdldHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxyLmFjdGl2ZVRhcmdldElkcztcbiAgICB9XG4gICAgaXNBY3RpdmVRdWVyeVRhcmdldCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLkxyLmFjdGl2ZVRhcmdldElkcy5oYXModCk7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5MciA9IG5ldyBhdSwgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGhhbmRsZVVzZXJDaGFuZ2UodCwgZSwgbikge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgc2V0T25saW5lU3RhdGUodCkge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG4gICAgc2h1dGRvd24oKSB7fVxuICAgIHdyaXRlU2VxdWVuY2VOdW1iZXIodCkge31cbiAgICBub3RpZnlCdW5kbGVMb2FkZWQodCkge1xuICAgICAgICAvLyBObyBvcC5cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIGZ1IHtcbiAgICBVcih0KSB7XG4gICAgICAgIC8vIE5vLW9wLlxuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgLy8gTm8tb3AuXG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUmVmZXJlbmNlcyB0byBgd2luZG93YCBhcmUgZ3VhcmRlZCBieSBCcm93c2VyQ29ubmVjdGl2aXR5TW9uaXRvci5pc0F2YWlsYWJsZSgpXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi9cbi8qKlxuICogQnJvd3NlciBpbXBsZW1lbnRhdGlvbiBvZiBDb25uZWN0aXZpdHlNb25pdG9yLlxuICovXG5jbGFzcyBkdSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuS3IgPSAoKSA9PiB0aGlzLkdyKCksIHRoaXMuUXIgPSAoKSA9PiB0aGlzLmpyKCksIHRoaXMuV3IgPSBbXSwgdGhpcy56cigpO1xuICAgIH1cbiAgICBVcih0KSB7XG4gICAgICAgIHRoaXMuV3IucHVzaCh0KTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwib25saW5lXCIsIHRoaXMuS3IpLCB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9mZmxpbmVcIiwgdGhpcy5Rcik7XG4gICAgfVxuICAgIHpyKCkge1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCB0aGlzLktyKSwgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIHRoaXMuUXIpO1xuICAgIH1cbiAgICBHcigpIHtcbiAgICAgICAgQyhcIkNvbm5lY3Rpdml0eU1vbml0b3JcIiwgXCJOZXR3b3JrIGNvbm5lY3Rpdml0eSBjaGFuZ2VkOiBBVkFJTEFCTEVcIik7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLldyKSB0KDAgLyogTmV0d29ya1N0YXR1cy5BVkFJTEFCTEUgKi8pO1xuICAgIH1cbiAgICBqcigpIHtcbiAgICAgICAgQyhcIkNvbm5lY3Rpdml0eU1vbml0b3JcIiwgXCJOZXR3b3JrIGNvbm5lY3Rpdml0eSBjaGFuZ2VkOiBVTkFWQUlMQUJMRVwiKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHRoaXMuV3IpIHQoMSAvKiBOZXR3b3JrU3RhdHVzLlVOQVZBSUxBQkxFICovKTtcbiAgICB9XG4gICAgLy8gVE9ETyhjaGVuYnJpYW4pOiBDb25zaWRlciBwYXNzaW5nIGluIHdpbmRvdyBlaXRoZXIgaW50byB0aGlzIGNvbXBvbmVudCBvclxuICAgIC8vIGhlcmUgZm9yIHRlc3RpbmcgdmlhIEZha2VXaW5kb3cuXG4gICAgLyoqIENoZWNrcyB0aGF0IGFsbCB1c2VkIGF0dHJpYnV0ZXMgb2Ygd2luZG93IGFyZSBhdmFpbGFibGUuICovXG4gICAgc3RhdGljIEMoKSB7XG4gICAgICAgIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB3aW5kb3cgJiYgdm9pZCAwICE9PSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAmJiB2b2lkIDAgIT09IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgX3UgPSB7XG4gICAgQmF0Y2hHZXREb2N1bWVudHM6IFwiYmF0Y2hHZXRcIixcbiAgICBDb21taXQ6IFwiY29tbWl0XCIsXG4gICAgUnVuUXVlcnk6IFwicnVuUXVlcnlcIixcbiAgICBSdW5BZ2dyZWdhdGlvblF1ZXJ5OiBcInJ1bkFnZ3JlZ2F0aW9uUXVlcnlcIlxufTtcblxuLyoqXG4gKiBNYXBzIFJQQyBuYW1lcyB0byB0aGUgY29ycmVzcG9uZGluZyBSRVNUIGVuZHBvaW50IG5hbWUuXG4gKlxuICogV2UgdXNlIGFycmF5IG5vdGF0aW9uIHRvIGF2b2lkIG1hbmdsaW5nLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlcyBhIHNpbXBsZSBoZWxwZXIgY2xhc3MgdGhhdCBpbXBsZW1lbnRzIHRoZSBTdHJlYW0gaW50ZXJmYWNlIHRvXG4gKiBicmlkZ2UgdG8gb3RoZXIgaW1wbGVtZW50YXRpb25zIHRoYXQgYXJlIHN0cmVhbXMgYnV0IGRvIG5vdCBpbXBsZW1lbnQgdGhlXG4gKiBpbnRlcmZhY2UuIFRoZSBzdHJlYW0gY2FsbGJhY2tzIGFyZSBpbnZva2VkIHdpdGggdGhlIGNhbGxPbi4uLiBtZXRob2RzLlxuICovXG5jbGFzcyB3dSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLkhyID0gdC5IciwgdGhpcy5KciA9IHQuSnI7XG4gICAgfVxuICAgIFlyKHQpIHtcbiAgICAgICAgdGhpcy5YciA9IHQ7XG4gICAgfVxuICAgIFpyKHQpIHtcbiAgICAgICAgdGhpcy5lbyA9IHQ7XG4gICAgfVxuICAgIG9uTWVzc2FnZSh0KSB7XG4gICAgICAgIHRoaXMubm8gPSB0O1xuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5KcigpO1xuICAgIH1cbiAgICBzZW5kKHQpIHtcbiAgICAgICAgdGhpcy5Icih0KTtcbiAgICB9XG4gICAgc28oKSB7XG4gICAgICAgIHRoaXMuWHIoKTtcbiAgICB9XG4gICAgaW8odCkge1xuICAgICAgICB0aGlzLmVvKHQpO1xuICAgIH1cbiAgICBybyh0KSB7XG4gICAgICAgIHRoaXMubm8odCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBtdSBleHRlbmRzIFxuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBhbGwgUmVzdC1iYXNlZCBjb25uZWN0aW9ucyB0byB0aGUgYmFja2VuZCAoV2ViQ2hhbm5lbCBhbmRcbiAqIEhUVFApLlxuICovXG5jbGFzcyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlSW5mbyA9IHQsIHRoaXMuZGF0YWJhc2VJZCA9IHQuZGF0YWJhc2VJZDtcbiAgICAgICAgY29uc3QgZSA9IHQuc3NsID8gXCJodHRwc1wiIDogXCJodHRwXCI7XG4gICAgICAgIHRoaXMub28gPSBlICsgXCI6Ly9cIiArIHQuaG9zdCwgdGhpcy51byA9IFwicHJvamVjdHMvXCIgKyB0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkICsgXCIvZGF0YWJhc2VzL1wiICsgdGhpcy5kYXRhYmFzZUlkLmRhdGFiYXNlICsgXCIvZG9jdW1lbnRzXCI7XG4gICAgfVxuICAgIGdldCBjbygpIHtcbiAgICAgICAgLy8gQm90aCBgaW52b2tlUlBDKClgIGFuZCBgaW52b2tlU3RyZWFtaW5nUlBDKClgIHVzZSB0aGVpciBgcGF0aGAgYXJndW1lbnRzIHRvIGRldGVybWluZVxuICAgICAgICAvLyB3aGVyZSB0byBydW4gdGhlIHF1ZXJ5LCBhbmQgZXhwZWN0IHRoZSBgcmVxdWVzdGAgdG8gTk9UIHNwZWNpZnkgdGhlIFwicGF0aFwiLlxuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGFvKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgY29uc3QgciA9IHRoaXMuaG8odCwgZSk7XG4gICAgICAgIEMoXCJSZXN0Q29ubmVjdGlvblwiLCBcIlNlbmRpbmc6IFwiLCByLCBuKTtcbiAgICAgICAgY29uc3QgbyA9IHt9O1xuICAgICAgICByZXR1cm4gdGhpcy5sbyhvLCBzLCBpKSwgdGhpcy5mbyh0LCByLCBvLCBuKS50aGVuKCh0ID0+IChDKFwiUmVzdENvbm5lY3Rpb25cIiwgXCJSZWNlaXZlZDogXCIsIHQpLCBcbiAgICAgICAgdCkpLCAoZSA9PiB7XG4gICAgICAgICAgICB0aHJvdyBOKFwiUmVzdENvbm5lY3Rpb25cIiwgYCR7dH0gZmFpbGVkIHdpdGggZXJyb3I6IGAsIGUsIFwidXJsOiBcIiwgciwgXCJyZXF1ZXN0OlwiLCBuKSwgXG4gICAgICAgICAgICBlO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIF9vKHQsIGUsIG4sIHMsIGksIHIpIHtcbiAgICAgICAgLy8gVGhlIFJFU1QgQVBJIGF1dG9tYXRpY2FsbHkgYWdncmVnYXRlcyBhbGwgb2YgdGhlIHN0cmVhbWVkIHJlc3VsdHMsIHNvIHdlXG4gICAgICAgIC8vIGNhbiBqdXN0IHVzZSB0aGUgbm9ybWFsIGludm9rZSgpIG1ldGhvZC5cbiAgICAgICAgcmV0dXJuIHRoaXMuYW8odCwgZSwgbiwgcywgaSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1vZGlmaWVzIHRoZSBoZWFkZXJzIGZvciBhIHJlcXVlc3QsIGFkZGluZyBhbnkgYXV0aG9yaXphdGlvbiB0b2tlbiBpZlxuICAgICAqIHByZXNlbnQgYW5kIGFueSBhZGRpdGlvbmFsIGhlYWRlcnMgZm9yIHRoZSByZXF1ZXN0LlxuICAgICAqLyAgICBsbyh0LCBlLCBuKSB7XG4gICAgICAgIHRbXCJYLUdvb2ctQXBpLUNsaWVudFwiXSA9IFwiZ2wtanMvIGZpcmUvXCIgKyB2LCBcbiAgICAgICAgLy8gQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluIHdpbGwgYXZvaWQgcHJlZmxpZ2h0IHJlcXVlc3RzIHdoaWNoIG1pZ2h0XG4gICAgICAgIC8vIG1lc3Mgd2l0aCBDT1JTIGFuZCByZWRpcmVjdHMgYnkgcHJveGllcy4gSWYgd2UgYWRkIGN1c3RvbSBoZWFkZXJzXG4gICAgICAgIC8vIHdlIHdpbGwgbmVlZCB0byBjaGFuZ2UgdGhpcyBjb2RlIHRvIHBvdGVudGlhbGx5IHVzZSB0aGUgJGh0dHBPdmVyd3JpdGVcbiAgICAgICAgLy8gcGFyYW1ldGVyIHN1cHBvcnRlZCBieSBFU0YgdG8gYXZvaWQgdHJpZ2dlcmluZyBwcmVmbGlnaHQgcmVxdWVzdHMuXG4gICAgICAgIHRbXCJDb250ZW50LVR5cGVcIl0gPSBcInRleHQvcGxhaW5cIiwgdGhpcy5kYXRhYmFzZUluZm8uYXBwSWQgJiYgKHRbXCJYLUZpcmViYXNlLUdNUElEXCJdID0gdGhpcy5kYXRhYmFzZUluZm8uYXBwSWQpLCBcbiAgICAgICAgZSAmJiBlLmhlYWRlcnMuZm9yRWFjaCgoKGUsIG4pID0+IHRbbl0gPSBlKSksIG4gJiYgbi5oZWFkZXJzLmZvckVhY2goKChlLCBuKSA9PiB0W25dID0gZSkpO1xuICAgIH1cbiAgICBobyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBfdVt0XTtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMub299L3YxLyR7ZX06JHtufWA7XG4gICAgfVxufSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICBzdXBlcih0KSwgdGhpcy5mb3JjZUxvbmdQb2xsaW5nID0gdC5mb3JjZUxvbmdQb2xsaW5nLCB0aGlzLmF1dG9EZXRlY3RMb25nUG9sbGluZyA9IHQuYXV0b0RldGVjdExvbmdQb2xsaW5nLCBcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgPSB0LnVzZUZldGNoU3RyZWFtcztcbiAgICB9XG4gICAgZm8odCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKChpLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvID0gbmV3IFhocklvO1xuICAgICAgICAgICAgby5zZXRXaXRoQ3JlZGVudGlhbHMoITApLCBvLmxpc3Rlbk9uY2UoRXZlbnRUeXBlLkNPTVBMRVRFLCAoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoby5nZXRMYXN0RXJyb3JDb2RlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5OT19FUlJPUjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBvLmdldFJlc3BvbnNlSnNvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgQyhcIkNvbm5lY3Rpb25cIiwgXCJYSFIgcmVjZWl2ZWQ6XCIsIEpTT04uc3RyaW5naWZ5KGUpKSwgaShlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBFcnJvckNvZGUuVElNRU9VVDpcbiAgICAgICAgICAgICAgICAgICAgICAgIEMoXCJDb25uZWN0aW9uXCIsICdSUEMgXCInICsgdCArICdcIiB0aW1lZCBvdXQnKSwgcihuZXcgTChCLkRFQURMSU5FX0VYQ0VFREVELCBcIlJlcXVlc3QgdGltZSBvdXRcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5IVFRQX0VSUk9SOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IG8uZ2V0U3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQyhcIkNvbm5lY3Rpb25cIiwgJ1JQQyBcIicgKyB0ICsgJ1wiIGZhaWxlZCB3aXRoIHN0YXR1czonLCBuLCBcInJlc3BvbnNlIHRleHQ6XCIsIG8uZ2V0UmVzcG9uc2VUZXh0KCkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIG4gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHQgPSBvLmdldFJlc3BvbnNlSnNvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkodCkgJiYgKHQgPSB0WzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSAmJiBlLnN0YXR1cyAmJiBlLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXy9nLCBcIi1cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhCKS5pbmRleE9mKGUpID49IDAgPyBlIDogQi5VTktOT1dOO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KGUuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcihuZXcgTCh0LCBlLm1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgcihuZXcgTChCLlVOS05PV04sIFwiU2VydmVyIHJlc3BvbmRlZCB3aXRoIHN0YXR1cyBcIiArIG8uZ2V0U3RhdHVzKCkpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHdlIHJlY2VpdmVkIGFuIEhUVFBfRVJST1IgYnV0IHRoZXJlJ3Mgbm8gc3RhdHVzIGNvZGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCdzIG1vc3QgcHJvYmFibHkgYSBjb25uZWN0aW9uIGlzc3VlXG4gICAgICAgICAgICAgICAgICAgICAgICByKG5ldyBMKEIuVU5BVkFJTEFCTEUsIFwiQ29ubmVjdGlvbiBmYWlsZWQuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIE8oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgIEMoXCJDb25uZWN0aW9uXCIsICdSUEMgXCInICsgdCArICdcIiBjb21wbGV0ZWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgdSA9IEpTT04uc3RyaW5naWZ5KHMpO1xuICAgICAgICAgICAgby5zZW5kKGUsIFwiUE9TVFwiLCB1LCBuLCAxNSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgd28odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gWyB0aGlzLm9vLCBcIi9cIiwgXCJnb29nbGUuZmlyZXN0b3JlLnYxLkZpcmVzdG9yZVwiLCBcIi9cIiwgdCwgXCIvY2hhbm5lbFwiIF0sIGkgPSBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0KCksIHIgPSBnZXRTdGF0RXZlbnRUYXJnZXQoKSwgbyA9IHtcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBiYWNrZW5kIHN0aWNraW5lc3MsIHJvdXRpbmcgYmVoYXZpb3IgaXMgYmFzZWQgb24gdGhpc1xuICAgICAgICAgICAgLy8gcGFyYW1ldGVyLlxuICAgICAgICAgICAgaHR0cFNlc3Npb25JZFBhcmFtOiBcImdzZXNzaW9uaWRcIixcbiAgICAgICAgICAgIGluaXRNZXNzYWdlSGVhZGVyczoge30sXG4gICAgICAgICAgICBtZXNzYWdlVXJsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBwYXJhbSBpcyB1c2VkIHRvIGltcHJvdmUgcm91dGluZyBhbmQgcHJvamVjdCBpc29sYXRpb24gYnkgdGhlXG4gICAgICAgICAgICAgICAgLy8gYmFja2VuZCBhbmQgbXVzdCBiZSBpbmNsdWRlZCBpbiBldmVyeSByZXF1ZXN0LlxuICAgICAgICAgICAgICAgIGRhdGFiYXNlOiBgcHJvamVjdHMvJHt0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkfS9kYXRhYmFzZXMvJHt0aGlzLmRhdGFiYXNlSWQuZGF0YWJhc2V9YFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmRSYXdKc29uOiAhMCxcbiAgICAgICAgICAgIHN1cHBvcnRzQ3Jvc3NEb21haW5YaHI6ICEwLFxuICAgICAgICAgICAgaW50ZXJuYWxDaGFubmVsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgdGltZW91dCAocmFuZG9taXplZCBiZXR3ZWVuIDEwLTIwIHNlY29uZHMpIHNpbmNlXG4gICAgICAgICAgICAgICAgLy8gYSBsYXJnZSB3cml0ZSBiYXRjaCBvbiBhIHNsb3cgaW50ZXJuZXQgY29ubmVjdGlvbiBtYXkgdGFrZSBhIGxvbmdcbiAgICAgICAgICAgICAgICAvLyB0aW1lIHRvIHNlbmQgdG8gdGhlIGJhY2tlbmQuIFJhdGhlciB0aGFuIGhhdmUgV2ViQ2hhbm5lbCBpbXBvc2UgYVxuICAgICAgICAgICAgICAgIC8vIHRpZ2h0IHRpbWVvdXQgd2hpY2ggY291bGQgbGVhZCB0byBpbmZpbml0ZSB0aW1lb3V0cyBhbmQgcmV0cmllcywgd2VcbiAgICAgICAgICAgICAgICAvLyBzZXQgaXQgdmVyeSBsYXJnZSAoNS0xMCBtaW51dGVzKSBhbmQgcmVseSBvbiB0aGUgYnJvd3NlcidzIGJ1aWx0aW5cbiAgICAgICAgICAgICAgICAvLyB0aW1lb3V0cyB0byBraWNrIGluIGlmIHRoZSByZXF1ZXN0IGlzbid0IHdvcmtpbmcuXG4gICAgICAgICAgICAgICAgZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zOiA2ZTVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JjZUxvbmdQb2xsaW5nOiB0aGlzLmZvcmNlTG9uZ1BvbGxpbmcsXG4gICAgICAgICAgICBkZXRlY3RCdWZmZXJpbmdQcm94eTogdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmdcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy51c2VGZXRjaFN0cmVhbXMgJiYgKG8ueG1sSHR0cEZhY3RvcnkgPSBuZXcgRmV0Y2hYbWxIdHRwRmFjdG9yeSh7fSkpLCB0aGlzLmxvKG8uaW5pdE1lc3NhZ2VIZWFkZXJzLCBlLCBuKSwgXG4gICAgICAgIC8vIFNlbmRpbmcgdGhlIGN1c3RvbSBoZWFkZXJzIHdlIGp1c3QgYWRkZWQgdG8gcmVxdWVzdC5pbml0TWVzc2FnZUhlYWRlcnNcbiAgICAgICAgLy8gKEF1dGhvcml6YXRpb24sIGV0Yy4pIHdpbGwgdHJpZ2dlciB0aGUgYnJvd3NlciB0byBtYWtlIGEgQ09SUyBwcmVmbGlnaHRcbiAgICAgICAgLy8gcmVxdWVzdCBiZWNhdXNlIHRoZSBYSFIgd2lsbCBubyBsb25nZXIgbWVldCB0aGUgY3JpdGVyaWEgZm9yIGEgXCJzaW1wbGVcIlxuICAgICAgICAvLyBDT1JTIHJlcXVlc3Q6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0hUVFAvQ09SUyNTaW1wbGVfcmVxdWVzdHNcbiAgICAgICAgLy8gVGhlcmVmb3JlIHRvIGF2b2lkIHRoZSBDT1JTIHByZWZsaWdodCByZXF1ZXN0IChhbiBleHRyYSBuZXR3b3JrXG4gICAgICAgIC8vIHJvdW5kdHJpcCksIHdlIHVzZSB0aGUgZW5jb2RlSW5pdE1lc3NhZ2VIZWFkZXJzIG9wdGlvbiB0byBzcGVjaWZ5IHRoYXRcbiAgICAgICAgLy8gdGhlIGhlYWRlcnMgc2hvdWxkIGluc3RlYWQgYmUgZW5jb2RlZCBpbiB0aGUgcmVxdWVzdCdzIFBPU1QgcGF5bG9hZCxcbiAgICAgICAgLy8gd2hpY2ggaXMgcmVjb2duaXplZCBieSB0aGUgd2ViY2hhbm5lbCBiYWNrZW5kLlxuICAgICAgICBvLmVuY29kZUluaXRNZXNzYWdlSGVhZGVycyA9ICEwO1xuICAgICAgICBjb25zdCB1ID0gcy5qb2luKFwiXCIpO1xuICAgICAgICBDKFwiQ29ubmVjdGlvblwiLCBcIkNyZWF0aW5nIFdlYkNoYW5uZWw6IFwiICsgdSwgbyk7XG4gICAgICAgIGNvbnN0IGMgPSBpLmNyZWF0ZVdlYkNoYW5uZWwodSwgbyk7XG4gICAgICAgIC8vIFdlYkNoYW5uZWwgc3VwcG9ydHMgc2VuZGluZyB0aGUgZmlyc3QgbWVzc2FnZSB3aXRoIHRoZSBoYW5kc2hha2UgLSBzYXZpbmdcbiAgICAgICAgLy8gYSBuZXR3b3JrIHJvdW5kIHRyaXAuIEhvd2V2ZXIsIGl0IHdpbGwgaGF2ZSB0byBjYWxsIHNlbmQgaW4gdGhlIHNhbWVcbiAgICAgICAgLy8gSlMgZXZlbnQgbG9vcCBhcyBvcGVuLiBJbiBvcmRlciB0byBlbmZvcmNlIHRoaXMsIHdlIGRlbGF5IGFjdHVhbGx5XG4gICAgICAgIC8vIG9wZW5pbmcgdGhlIFdlYkNoYW5uZWwgdW50aWwgc2VuZCBpcyBjYWxsZWQuIFdoZXRoZXIgd2UgaGF2ZSBjYWxsZWRcbiAgICAgICAgLy8gb3BlbiBpcyB0cmFja2VkIHdpdGggdGhpcyB2YXJpYWJsZS5cbiAgICAgICAgICAgICAgICBsZXQgYSA9ICExLCBoID0gITE7XG4gICAgICAgIC8vIEEgZmxhZyB0byBkZXRlcm1pbmUgd2hldGhlciB0aGUgc3RyZWFtIHdhcyBjbG9zZWQgKGJ5IHVzIG9yIHRocm91Z2ggYW5cbiAgICAgICAgLy8gZXJyb3IvY2xvc2UgZXZlbnQpIHRvIGF2b2lkIGRlbGl2ZXJpbmcgbXVsdGlwbGUgY2xvc2UgZXZlbnRzIG9yIHNlbmRpbmdcbiAgICAgICAgLy8gb24gYSBjbG9zZWQgc3RyZWFtXG4gICAgICAgICAgICAgICAgY29uc3QgbCA9IG5ldyB3dSh7XG4gICAgICAgICAgICBIcjogdCA9PiB7XG4gICAgICAgICAgICAgICAgaCA/IEMoXCJDb25uZWN0aW9uXCIsIFwiTm90IHNlbmRpbmcgYmVjYXVzZSBXZWJDaGFubmVsIGlzIGNsb3NlZDpcIiwgdCkgOiAoYSB8fCAoQyhcIkNvbm5lY3Rpb25cIiwgXCJPcGVuaW5nIFdlYkNoYW5uZWwgdHJhbnNwb3J0LlwiKSwgXG4gICAgICAgICAgICAgICAgYy5vcGVuKCksIGEgPSAhMCksIEMoXCJDb25uZWN0aW9uXCIsIFwiV2ViQ2hhbm5lbCBzZW5kaW5nOlwiLCB0KSwgYy5zZW5kKHQpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBKcjogKCkgPT4gYy5jbG9zZSgpXG4gICAgICAgIH0pLCBmID0gKHQsIGUsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8oZGltb25kKTogY2xvc3VyZSB0eXBpbmcgc2VlbXMgYnJva2VuIGJlY2F1c2UgV2ViQ2hhbm5lbCBkb2VzXG4gICAgICAgICAgICAvLyBub3QgaW1wbGVtZW50IGdvb2cuZXZlbnRzLkxpc3RlbmFibGVcbiAgICAgICAgICAgIHQubGlzdGVuKGUsICh0ID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBuKHQpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgdDtcbiAgICAgICAgICAgICAgICAgICAgfSksIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gQ2xvc3VyZSBldmVudHMgYXJlIGd1YXJkZWQgYW5kIGV4Y2VwdGlvbnMgYXJlIHN3YWxsb3dlZCwgc28gY2F0Y2ggYW55XG4gICAgICAgIC8vIGV4Y2VwdGlvbiBhbmQgcmV0aHJvdyB1c2luZyBhIHNldFRpbWVvdXQgc28gdGhleSBiZWNvbWUgdmlzaWJsZSBhZ2Fpbi5cbiAgICAgICAgLy8gTm90ZSB0aGF0IGV2ZW50dWFsbHkgdGhpcyBmdW5jdGlvbiBjb3VsZCBnbyBhd2F5IGlmIHdlIGFyZSBjb25maWRlbnRcbiAgICAgICAgLy8gZW5vdWdoIHRoZSBjb2RlIGlzIGV4Y2VwdGlvbiBmcmVlLlxuICAgICAgICAgICAgICAgIHJldHVybiBmKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLk9QRU4sICgoKSA9PiB7XG4gICAgICAgICAgICBoIHx8IEMoXCJDb25uZWN0aW9uXCIsIFwiV2ViQ2hhbm5lbCB0cmFuc3BvcnQgb3BlbmVkLlwiKTtcbiAgICAgICAgfSkpLCBmKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLkNMT1NFLCAoKCkgPT4ge1xuICAgICAgICAgICAgaCB8fCAoaCA9ICEwLCBDKFwiQ29ubmVjdGlvblwiLCBcIldlYkNoYW5uZWwgdHJhbnNwb3J0IGNsb3NlZFwiKSwgbC5pbygpKTtcbiAgICAgICAgfSkpLCBmKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLkVSUk9SLCAodCA9PiB7XG4gICAgICAgICAgICBoIHx8IChoID0gITAsIE4oXCJDb25uZWN0aW9uXCIsIFwiV2ViQ2hhbm5lbCB0cmFuc3BvcnQgZXJyb3JlZDpcIiwgdCksIGwuaW8obmV3IEwoQi5VTkFWQUlMQUJMRSwgXCJUaGUgb3BlcmF0aW9uIGNvdWxkIG5vdCBiZSBjb21wbGV0ZWRcIikpKTtcbiAgICAgICAgfSkpLCBmKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLk1FU1NBR0UsICh0ID0+IHtcbiAgICAgICAgICAgIHZhciBlO1xuICAgICAgICAgICAgaWYgKCFoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IHQuZGF0YVswXTtcbiAgICAgICAgICAgICAgICBNKCEhbik7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyhiLzM1MTQzODkxKTogVGhlcmUgaXMgYSBidWcgaW4gT25lIFBsYXRmb3JtIHRoYXQgY2F1c2VkIGVycm9yc1xuICAgICAgICAgICAgICAgIC8vIChhbmQgb25seSBlcnJvcnMpIHRvIGJlIHdyYXBwZWQgaW4gYW4gZXh0cmEgYXJyYXkuIFRvIGJlIGZvcndhcmRcbiAgICAgICAgICAgICAgICAvLyBjb21wYXRpYmxlIHdpdGggdGhlIGJ1ZyB3ZSBuZWVkIHRvIGNoZWNrIGVpdGhlciBjb25kaXRpb24uIFRoZSBsYXR0ZXJcbiAgICAgICAgICAgICAgICAvLyBjYW4gYmUgcmVtb3ZlZCBvbmNlIHRoZSBmaXggaGFzIGJlZW4gcm9sbGVkIG91dC5cbiAgICAgICAgICAgICAgICAvLyBVc2UgYW55IGJlY2F1c2UgbXNnRGF0YS5lcnJvciBpcyBub3QgdHlwZWQuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG4sIGkgPSBzLmVycm9yIHx8IChudWxsID09PSAoZSA9IHNbMF0pIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUuZXJyb3IpO1xuICAgICAgICAgICAgICAgIGlmIChpKSB7XG4gICAgICAgICAgICAgICAgICAgIEMoXCJDb25uZWN0aW9uXCIsIFwiV2ViQ2hhbm5lbCByZWNlaXZlZCBlcnJvcjpcIiwgaSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVycm9yLnN0YXR1cyB3aWxsIGJlIGEgc3RyaW5nIGxpa2UgJ09LJyBvciAnTk9UX0ZPVU5EJy5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IGkuc3RhdHVzO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZSA9IFxuICAgICAgICAgICAgICAgICAgICAvKipcbiAqIE1hcHMgYW4gZXJyb3IgQ29kZSBmcm9tIGEgR1JQQyBzdGF0dXMgaWRlbnRpZmllciBsaWtlICdOT1RfRk9VTkQnLlxuICpcbiAqIEByZXR1cm5zIFRoZSBDb2RlIGVxdWl2YWxlbnQgdG8gdGhlIGdpdmVuIHN0YXR1cyBzdHJpbmcgb3IgdW5kZWZpbmVkIGlmXG4gKiAgICAgdGhlcmUgaXMgbm8gbWF0Y2guXG4gKi9cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9va3VwIGJ5IHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB1c1t0XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGUpIHJldHVybiBocyhlKTtcbiAgICAgICAgICAgICAgICAgICAgfSh0KSwgbiA9IGkubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gQi5JTlRFUk5BTCwgbiA9IFwiVW5rbm93biBlcnJvciBzdGF0dXM6IFwiICsgdCArIFwiIHdpdGggbWVzc2FnZSBcIiArIGkubWVzc2FnZSksIFxuICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIGNsb3NlZCBzbyBubyBmdXJ0aGVyIGV2ZW50cyBhcmUgcHJvcGFnYXRlZFxuICAgICAgICAgICAgICAgICAgICBoID0gITAsIGwuaW8obmV3IEwoZSwgbikpLCBjLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIEMoXCJDb25uZWN0aW9uXCIsIFwiV2ViQ2hhbm5lbCByZWNlaXZlZDpcIiwgbiksIGwucm8obik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgZihyLCBFdmVudC5TVEFUX0VWRU5ULCAodCA9PiB7XG4gICAgICAgICAgICB0LnN0YXQgPT09IFN0YXQuUFJPWFkgPyBDKFwiQ29ubmVjdGlvblwiLCBcIkRldGVjdGVkIGJ1ZmZlcmluZyBwcm94eVwiKSA6IHQuc3RhdCA9PT0gU3RhdC5OT1BST1hZICYmIEMoXCJDb25uZWN0aW9uXCIsIFwiRGV0ZWN0ZWQgbm8gYnVmZmVyaW5nIHByb3h5XCIpO1xuICAgICAgICB9KSksIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFRlY2huaWNhbGx5IHdlIGNvdWxkL3Nob3VsZCB3YWl0IGZvciB0aGUgV2ViQ2hhbm5lbCBvcGVuZWQgZXZlbnQsXG4gICAgICAgICAgICAvLyBidXQgYmVjYXVzZSB3ZSB3YW50IHRvIHNlbmQgdGhlIGZpcnN0IG1lc3NhZ2Ugd2l0aCB0aGUgV2ViQ2hhbm5lbFxuICAgICAgICAgICAgLy8gaGFuZHNoYWtlIHdlIHByZXRlbmQgdGhlIGNoYW5uZWwgb3BlbmVkIGhlcmUgKGFzeW5jaHJvbm91c2x5KSwgYW5kXG4gICAgICAgICAgICAvLyB0aGVuIGRlbGF5IHRoZSBhY3R1YWwgb3BlbiB1bnRpbCB0aGUgZmlyc3QgbWVzc2FnZSBpcyBzZW50LlxuICAgICAgICAgICAgbC5zbygpO1xuICAgICAgICB9KSwgMCksIGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIEluaXRpYWxpemVzIHRoZSBXZWJDaGFubmVsQ29ubmVjdGlvbiBmb3IgdGhlIGJyb3dzZXIuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFRoZSBQbGF0Zm9ybSdzICd3aW5kb3cnIGltcGxlbWVudGF0aW9uIG9yIG51bGwgaWYgbm90IGF2YWlsYWJsZS4gKi9cbmZ1bmN0aW9uIGd1KCkge1xuICAgIC8vIGB3aW5kb3dgIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBlLmcuIGluIFJlYWN0TmF0aXZlIGFuZCBXZWJXb3JrZXJzLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogbnVsbDtcbn1cblxuLyoqIFRoZSBQbGF0Zm9ybSdzICdkb2N1bWVudCcgaW1wbGVtZW50YXRpb24gb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLiAqLyBmdW5jdGlvbiB5dSgpIHtcbiAgICAvLyBgZG9jdW1lbnRgIGlzIG5vdCBhbHdheXMgYXZhaWxhYmxlLCBlLmcuIGluIFJlYWN0TmF0aXZlIGFuZCBXZWJXb3JrZXJzLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWdsb2JhbHNcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgZG9jdW1lbnQgPyBkb2N1bWVudCA6IG51bGw7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIHB1KHQpIHtcbiAgICByZXR1cm4gbmV3IEZzKHQsIC8qIHVzZVByb3RvM0pzb249ICovICEwKTtcbn1cblxuLyoqXG4gKiBBbiBpbnN0YW5jZSBvZiB0aGUgUGxhdGZvcm0ncyAnVGV4dEVuY29kZXInIGltcGxlbWVudGF0aW9uLlxuICovXG4vKipcbiAqIEEgaGVscGVyIGZvciBydW5uaW5nIGRlbGF5ZWQgdGFza3MgZm9sbG93aW5nIGFuIGV4cG9uZW50aWFsIGJhY2tvZmYgY3VydmVcbiAqIGJldHdlZW4gYXR0ZW1wdHMuXG4gKlxuICogRWFjaCBkZWxheSBpcyBtYWRlIHVwIG9mIGEgXCJiYXNlXCIgZGVsYXkgd2hpY2ggZm9sbG93cyB0aGUgZXhwb25lbnRpYWxcbiAqIGJhY2tvZmYgY3VydmUsIGFuZCBhICsvLSA1MCUgXCJqaXR0ZXJcIiB0aGF0IGlzIGNhbGN1bGF0ZWQgYW5kIGFkZGVkIHRvIHRoZVxuICogYmFzZSBkZWxheS4gVGhpcyBwcmV2ZW50cyBjbGllbnRzIGZyb20gYWNjaWRlbnRhbGx5IHN5bmNocm9uaXppbmcgdGhlaXJcbiAqIGRlbGF5cyBjYXVzaW5nIHNwaWtlcyBvZiBsb2FkIHRvIHRoZSBiYWNrZW5kLlxuICovXG5jbGFzcyBJdSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIEFzeW5jUXVldWUgdG8gcnVuIGJhY2tvZmYgb3BlcmF0aW9ucyBvbi5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBUaGUgSUQgdG8gdXNlIHdoZW4gc2NoZWR1bGluZyBiYWNrb2ZmIG9wZXJhdGlvbnMgb24gdGhlIEFzeW5jUXVldWUuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGluaXRpYWwgZGVsYXkgKHVzZWQgYXMgdGhlIGJhc2UgZGVsYXkgb24gdGhlIGZpcnN0IHJldHJ5IGF0dGVtcHQpLlxuICAgICAqIE5vdGUgdGhhdCBqaXR0ZXIgd2lsbCBzdGlsbCBiZSBhcHBsaWVkLCBzbyB0aGUgYWN0dWFsIGRlbGF5IGNvdWxkIGJlIGFzXG4gICAgICogbGl0dGxlIGFzIDAuNSppbml0aWFsRGVsYXlNcy5cbiAgICAgKi9cbiAgICBuID0gMWUzXG4gICAgLyoqXG4gICAgICogVGhlIG11bHRpcGxpZXIgdG8gdXNlIHRvIGRldGVybWluZSB0aGUgZXh0ZW5kZWQgYmFzZSBkZWxheSBhZnRlciBlYWNoXG4gICAgICogYXR0ZW1wdC5cbiAgICAgKi8gLCBzID0gMS41XG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gYmFzZSBkZWxheSBhZnRlciB3aGljaCBubyBmdXJ0aGVyIGJhY2tvZmYgaXMgcGVyZm9ybWVkLlxuICAgICAqIE5vdGUgdGhhdCBqaXR0ZXIgd2lsbCBzdGlsbCBiZSBhcHBsaWVkLCBzbyB0aGUgYWN0dWFsIGRlbGF5IGNvdWxkIGJlIGFzXG4gICAgICogbXVjaCBhcyAxLjUqbWF4RGVsYXlNcy5cbiAgICAgKi8gLCBpID0gNmU0KSB7XG4gICAgICAgIHRoaXMuSHMgPSB0LCB0aGlzLnRpbWVySWQgPSBlLCB0aGlzLm1vID0gbiwgdGhpcy55byA9IHMsIHRoaXMucG8gPSBpLCB0aGlzLklvID0gMCwgXG4gICAgICAgIHRoaXMuVG8gPSBudWxsLCBcbiAgICAgICAgLyoqIFRoZSBsYXN0IGJhY2tvZmYgYXR0ZW1wdCwgYXMgZXBvY2ggbWlsbGlzZWNvbmRzLiAqL1xuICAgICAgICB0aGlzLkVvID0gRGF0ZS5ub3coKSwgdGhpcy5yZXNldCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJhY2tvZmYgZGVsYXkuXG4gICAgICpcbiAgICAgKiBUaGUgdmVyeSBuZXh0IGJhY2tvZmZBbmRXYWl0KCkgd2lsbCBoYXZlIG5vIGRlbGF5LiBJZiBpdCBpcyBjYWxsZWQgYWdhaW5cbiAgICAgKiAoaS5lLiBkdWUgdG8gYW4gZXJyb3IpLCBpbml0aWFsRGVsYXlNcyAocGx1cyBqaXR0ZXIpIHdpbGwgYmUgdXNlZCwgYW5kXG4gICAgICogc3Vic2VxdWVudCBvbmVzIHdpbGwgaW5jcmVhc2UgYWNjb3JkaW5nIHRvIHRoZSBiYWNrb2ZmRmFjdG9yLlxuICAgICAqLyAgICByZXNldCgpIHtcbiAgICAgICAgdGhpcy5JbyA9IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgYmFja29mZiBkZWxheSB0byB0aGUgbWF4aW11bSBkZWxheSAoZS5nLiBmb3IgdXNlIGFmdGVyIGFcbiAgICAgKiBSRVNPVVJDRV9FWEhBVVNURUQgZXJyb3IpLlxuICAgICAqLyAgICBBbygpIHtcbiAgICAgICAgdGhpcy5JbyA9IHRoaXMucG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgY3VycmVudERlbGF5TXMsIGFuZCBpbmNyZWFzZXMgdGhlXG4gICAgICogZGVsYXkgZm9yIGFueSBzdWJzZXF1ZW50IGF0dGVtcHRzLiBJZiB0aGVyZSB3YXMgYSBwZW5kaW5nIGJhY2tvZmYgb3BlcmF0aW9uXG4gICAgICogYWxyZWFkeSwgaXQgd2lsbCBiZSBjYW5jZWxlZC5cbiAgICAgKi8gICAgUm8odCkge1xuICAgICAgICAvLyBDYW5jZWwgYW55IHBlbmRpbmcgYmFja29mZiBvcGVyYXRpb24uXG4gICAgICAgIHRoaXMuY2FuY2VsKCk7XG4gICAgICAgIC8vIEZpcnN0IHNjaGVkdWxlIHVzaW5nIHRoZSBjdXJyZW50IGJhc2UgKHdoaWNoIG1heSBiZSAwIGFuZCBzaG91bGQgYmVcbiAgICAgICAgLy8gaG9ub3JlZCBhcyBzdWNoKS5cbiAgICAgICAgY29uc3QgZSA9IE1hdGguZmxvb3IodGhpcy5JbyArIHRoaXMuYm8oKSksIG4gPSBNYXRoLm1heCgwLCBEYXRlLm5vdygpIC0gdGhpcy5FbyksIHMgPSBNYXRoLm1heCgwLCBlIC0gbik7XG4gICAgICAgIC8vIEd1YXJkIGFnYWluc3QgbGFzdEF0dGVtcHRUaW1lIGJlaW5nIGluIHRoZSBmdXR1cmUgZHVlIHRvIGEgY2xvY2sgY2hhbmdlLlxuICAgICAgICAgICAgICAgIHMgPiAwICYmIEMoXCJFeHBvbmVudGlhbEJhY2tvZmZcIiwgYEJhY2tpbmcgb2ZmIGZvciAke3N9IG1zIChiYXNlIGRlbGF5OiAke3RoaXMuSW99IG1zLCBkZWxheSB3aXRoIGppdHRlcjogJHtlfSBtcywgbGFzdCBhdHRlbXB0OiAke259IG1zIGFnbylgKSwgXG4gICAgICAgIHRoaXMuVG8gPSB0aGlzLkhzLmVucXVldWVBZnRlckRlbGF5KHRoaXMudGltZXJJZCwgcywgKCgpID0+ICh0aGlzLkVvID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIHQoKSkpKSwgXG4gICAgICAgIC8vIEFwcGx5IGJhY2tvZmYgZmFjdG9yIHRvIGRldGVybWluZSBuZXh0IGRlbGF5IGFuZCBlbnN1cmUgaXQgaXMgd2l0aGluXG4gICAgICAgIC8vIGJvdW5kcy5cbiAgICAgICAgdGhpcy5JbyAqPSB0aGlzLnlvLCB0aGlzLklvIDwgdGhpcy5tbyAmJiAodGhpcy5JbyA9IHRoaXMubW8pLCB0aGlzLklvID4gdGhpcy5wbyAmJiAodGhpcy5JbyA9IHRoaXMucG8pO1xuICAgIH1cbiAgICBQbygpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy5UbyAmJiAodGhpcy5Uby5za2lwRGVsYXkoKSwgdGhpcy5UbyA9IG51bGwpO1xuICAgIH1cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuVG8gJiYgKHRoaXMuVG8uY2FuY2VsKCksIHRoaXMuVG8gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByYW5kb20gdmFsdWUgaW4gdGhlIHJhbmdlIFstY3VycmVudEJhc2VNcy8yLCBjdXJyZW50QmFzZU1zLzJdICovICAgIGJvKCkge1xuICAgICAgICByZXR1cm4gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiB0aGlzLklvO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIGlzIGFuIGFic3RyYWN0IGJhc2UgY2xhc3MgdGhhdCByZXByZXNlbnRzIGEgc3RyZWFtaW5nIFJQQ1xuICogdG8gdGhlIEZpcmVzdG9yZSBiYWNrZW5kLiBJdCdzIGJ1aWx0IG9uIHRvcCBvZiB0aGUgY29ubmVjdGlvbnMgb3duIHN1cHBvcnRcbiAqIGZvciBzdHJlYW1pbmcgUlBDcywgYW5kIGFkZHMgc2V2ZXJhbCBjcml0aWNhbCBmZWF0dXJlcyBmb3Igb3VyIGNsaWVudHM6XG4gKlxuICogICAtIEV4cG9uZW50aWFsIGJhY2tvZmYgb24gZmFpbHVyZVxuICogICAtIEF1dGhlbnRpY2F0aW9uIHZpYSBDcmVkZW50aWFsc1Byb3ZpZGVyXG4gKiAgIC0gRGlzcGF0Y2hpbmcgYWxsIGNhbGxiYWNrcyBpbnRvIHRoZSBzaGFyZWQgd29ya2VyIHF1ZXVlXG4gKiAgIC0gQ2xvc2luZyBpZGxlIHN0cmVhbXMgYWZ0ZXIgNjAgc2Vjb25kcyBvZiBpbmFjdGl2aXR5XG4gKlxuICogU3ViY2xhc3NlcyBvZiBQZXJzaXN0ZW50U3RyZWFtIGltcGxlbWVudCBzZXJpYWxpemF0aW9uIG9mIG1vZGVscyB0byBhbmRcbiAqIGZyb20gdGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgdGhlIHByb3RvY29sIGJ1ZmZlcnMgZm9yIGEgc3BlY2lmaWNcbiAqIHN0cmVhbWluZyBSUEMuXG4gKlxuICogIyMgU3RhcnRpbmcgYW5kIFN0b3BwaW5nXG4gKlxuICogU3RyZWFtaW5nIFJQQ3MgYXJlIHN0YXRlZnVsIGFuZCBuZWVkIHRvIGJlIHN0YXJ0KCllZCBiZWZvcmUgbWVzc2FnZXMgY2FuXG4gKiBiZSBzZW50IGFuZCByZWNlaXZlZC4gVGhlIFBlcnNpc3RlbnRTdHJlYW0gd2lsbCBjYWxsIHRoZSBvbk9wZW4oKSBmdW5jdGlvblxuICogb2YgdGhlIGxpc3RlbmVyIG9uY2UgdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgcmVxdWVzdHMuXG4gKlxuICogU2hvdWxkIGEgc3RhcnQoKSBmYWlsLCBQZXJzaXN0ZW50U3RyZWFtIHdpbGwgY2FsbCB0aGUgcmVnaXN0ZXJlZCBvbkNsb3NlKClcbiAqIGxpc3RlbmVyIHdpdGggYSBGaXJlc3RvcmVFcnJvciBpbmRpY2F0aW5nIHdoYXQgd2VudCB3cm9uZy5cbiAqXG4gKiBBIFBlcnNpc3RlbnRTdHJlYW0gY2FuIGJlIHN0YXJ0ZWQgYW5kIHN0b3BwZWQgcmVwZWF0ZWRseS5cbiAqXG4gKiBHZW5lcmljIHR5cGVzOlxuICogIFNlbmRUeXBlOiBUaGUgdHlwZSBvZiB0aGUgb3V0Z29pbmcgbWVzc2FnZSBvZiB0aGUgdW5kZXJseWluZ1xuICogICAgY29ubmVjdGlvbiBzdHJlYW1cbiAqICBSZWNlaXZlVHlwZTogVGhlIHR5cGUgb2YgdGhlIGluY29taW5nIG1lc3NhZ2Ugb2YgdGhlIHVuZGVybHlpbmdcbiAqICAgIGNvbm5lY3Rpb24gc3RyZWFtXG4gKiAgTGlzdGVuZXJUeXBlOiBUaGUgdHlwZSBvZiB0aGUgbGlzdGVuZXIgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIGNhbGxiYWNrc1xuICovXG5jbGFzcyBUdSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSwgciwgbywgdSkge1xuICAgICAgICB0aGlzLkhzID0gdCwgdGhpcy52byA9IG4sIHRoaXMuVm8gPSBzLCB0aGlzLmNvbm5lY3Rpb24gPSBpLCB0aGlzLmF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyID0gciwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsc1Byb3ZpZGVyID0gbywgdGhpcy5saXN0ZW5lciA9IHUsIHRoaXMuc3RhdGUgPSAwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovICwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGNsb3NlIGNvdW50IHRoYXQncyBpbmNyZW1lbnRlZCBldmVyeSB0aW1lIHRoZSBzdHJlYW0gaXMgY2xvc2VkOyB1c2VkIGJ5XG4gICAgICAgICAqIGdldENsb3NlR3VhcmRlZERpc3BhdGNoZXIoKSB0byBpbnZhbGlkYXRlIGNhbGxiYWNrcyB0aGF0IGhhcHBlbiBhZnRlclxuICAgICAgICAgKiBjbG9zZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuU28gPSAwLCB0aGlzLkRvID0gbnVsbCwgdGhpcy5DbyA9IG51bGwsIHRoaXMuc3RyZWFtID0gbnVsbCwgdGhpcy54byA9IG5ldyBJdSh0LCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHN0YXJ0KCkgaGFzIGJlZW4gY2FsbGVkIGFuZCBubyBlcnJvciBoYXMgb2NjdXJyZWQuIFRydWVcbiAgICAgKiBpbmRpY2F0ZXMgdGhlIHN0cmVhbSBpcyBvcGVuIG9yIGluIHRoZSBwcm9jZXNzIG9mIG9wZW5pbmcgKHdoaWNoXG4gICAgICogZW5jb21wYXNzZXMgcmVzcGVjdGluZyBiYWNrb2ZmLCBnZXR0aW5nIGF1dGggdG9rZW5zLCBhbmQgc3RhcnRpbmcgdGhlXG4gICAgICogYWN0dWFsIFJQQykuIFVzZSBpc09wZW4oKSB0byBkZXRlcm1pbmUgaWYgdGhlIHN0cmVhbSBpcyBvcGVuIGFuZCByZWFkeSBmb3JcbiAgICAgKiBvdXRib3VuZCByZXF1ZXN0cy5cbiAgICAgKi8gICAgTm8oKSB7XG4gICAgICAgIHJldHVybiAxIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5TdGFydGluZyAqLyA9PT0gdGhpcy5zdGF0ZSB8fCA1IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5CYWNrb2ZmICovID09PSB0aGlzLnN0YXRlIHx8IHRoaXMua28oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSB1bmRlcmx5aW5nIFJQQyBpcyBvcGVuICh0aGUgb25PcGVuKCkgbGlzdGVuZXIgaGFzIGJlZW5cbiAgICAgKiBjYWxsZWQpIGFuZCB0aGUgc3RyZWFtIGlzIHJlYWR5IGZvciBvdXRib3VuZCByZXF1ZXN0cy5cbiAgICAgKi8gICAga28oKSB7XG4gICAgICAgIHJldHVybiAyIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5PcGVuICovID09PSB0aGlzLnN0YXRlIHx8IDMgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkhlYWx0aHkgKi8gPT09IHRoaXMuc3RhdGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgUlBDLiBPbmx5IGFsbG93ZWQgaWYgaXNTdGFydGVkKCkgcmV0dXJucyBmYWxzZS4gVGhlIHN0cmVhbSBpc1xuICAgICAqIG5vdCBpbW1lZGlhdGVseSByZWFkeSBmb3IgdXNlOiBvbk9wZW4oKSB3aWxsIGJlIGludm9rZWQgd2hlbiB0aGUgUlBDIGlzXG4gICAgICogcmVhZHkgZm9yIG91dGJvdW5kIHJlcXVlc3RzLCBhdCB3aGljaCBwb2ludCBpc09wZW4oKSB3aWxsIHJldHVybiB0cnVlLlxuICAgICAqXG4gICAgICogV2hlbiBzdGFydCByZXR1cm5zLCBpc1N0YXJ0ZWQoKSB3aWxsIHJldHVybiB0cnVlLlxuICAgICAqLyAgICBzdGFydCgpIHtcbiAgICAgICAgNCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuRXJyb3IgKi8gIT09IHRoaXMuc3RhdGUgPyB0aGlzLmF1dGgoKSA6IHRoaXMuT28oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RvcHMgdGhlIFJQQy4gVGhpcyBjYWxsIGlzIGlkZW1wb3RlbnQgYW5kIGFsbG93ZWQgcmVnYXJkbGVzcyBvZiB0aGVcbiAgICAgKiBjdXJyZW50IGlzU3RhcnRlZCgpIHN0YXRlLlxuICAgICAqXG4gICAgICogV2hlbiBzdG9wIHJldHVybnMsIGlzU3RhcnRlZCgpIGFuZCBpc09wZW4oKSB3aWxsIGJvdGggcmV0dXJuIGZhbHNlLlxuICAgICAqLyAgICBhc3luYyBzdG9wKCkge1xuICAgICAgICB0aGlzLk5vKCkgJiYgYXdhaXQgdGhpcy5jbG9zZSgwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWZ0ZXIgYW4gZXJyb3IgdGhlIHN0cmVhbSB3aWxsIHVzdWFsbHkgYmFjayBvZmYgb24gdGhlIG5leHQgYXR0ZW1wdCB0b1xuICAgICAqIHN0YXJ0IGl0LiBJZiB0aGUgZXJyb3Igd2FycmFudHMgYW4gaW1tZWRpYXRlIHJlc3RhcnQgb2YgdGhlIHN0cmVhbSwgdGhlXG4gICAgICogc2VuZGVyIGNhbiB1c2UgdGhpcyB0byBpbmRpY2F0ZSB0aGF0IHRoZSByZWNlaXZlciBzaG91bGQgbm90IGJhY2sgb2ZmLlxuICAgICAqXG4gICAgICogRWFjaCBlcnJvciB3aWxsIGNhbGwgdGhlIG9uQ2xvc2UoKSBsaXN0ZW5lci4gVGhhdCBmdW5jdGlvbiBjYW4gZGVjaWRlIHRvXG4gICAgICogaW5oaWJpdCBiYWNrb2ZmIGlmIHJlcXVpcmVkLlxuICAgICAqLyAgICBNbygpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8gLCB0aGlzLnhvLnJlc2V0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1hcmtzIHRoaXMgc3RyZWFtIGFzIGlkbGUuIElmIG5vIGZ1cnRoZXIgYWN0aW9ucyBhcmUgcGVyZm9ybWVkIG9uIHRoZVxuICAgICAqIHN0cmVhbSBmb3Igb25lIG1pbnV0ZSwgdGhlIHN0cmVhbSB3aWxsIGF1dG9tYXRpY2FsbHkgY2xvc2UgaXRzZWxmIGFuZFxuICAgICAqIG5vdGlmeSB0aGUgc3RyZWFtJ3Mgb25DbG9zZSgpIGhhbmRsZXIgd2l0aCBTdGF0dXMuT0suIFRoZSBzdHJlYW0gd2lsbCB0aGVuXG4gICAgICogYmUgaW4gYSAhaXNTdGFydGVkKCkgc3RhdGUsIHJlcXVpcmluZyB0aGUgY2FsbGVyIHRvIHN0YXJ0IHRoZSBzdHJlYW0gYWdhaW5cbiAgICAgKiBiZWZvcmUgZnVydGhlciB1c2UuXG4gICAgICpcbiAgICAgKiBPbmx5IHN0cmVhbXMgdGhhdCBhcmUgaW4gc3RhdGUgJ09wZW4nIGNhbiBiZSBtYXJrZWQgaWRsZSwgYXMgYWxsIG90aGVyXG4gICAgICogc3RhdGVzIGltcGx5IHBlbmRpbmcgbmV0d29yayBvcGVyYXRpb25zLlxuICAgICAqLyAgICBGbygpIHtcbiAgICAgICAgLy8gU3RhcnRzIHRoZSBpZGxlIHRpbWUgaWYgd2UgYXJlIGluIHN0YXRlICdPcGVuJyBhbmQgYXJlIG5vdCB5ZXQgYWxyZWFkeVxuICAgICAgICAvLyBydW5uaW5nIGEgdGltZXIgKGluIHdoaWNoIGNhc2UgdGhlIHByZXZpb3VzIGlkbGUgdGltZW91dCBzdGlsbCBhcHBsaWVzKS5cbiAgICAgICAgdGhpcy5rbygpICYmIG51bGwgPT09IHRoaXMuRG8gJiYgKHRoaXMuRG8gPSB0aGlzLkhzLmVucXVldWVBZnRlckRlbGF5KHRoaXMudm8sIDZlNCwgKCgpID0+IHRoaXMuJG8oKSkpKTtcbiAgICB9XG4gICAgLyoqIFNlbmRzIGEgbWVzc2FnZSB0byB0aGUgdW5kZXJseWluZyBzdHJlYW0uICovICAgIEJvKHQpIHtcbiAgICAgICAgdGhpcy5MbygpLCB0aGlzLnN0cmVhbS5zZW5kKHQpO1xuICAgIH1cbiAgICAvKiogQ2FsbGVkIGJ5IHRoZSBpZGxlIHRpbWVyIHdoZW4gdGhlIHN0cmVhbSBzaG91bGQgY2xvc2UgZHVlIHRvIGluYWN0aXZpdHkuICovICAgIGFzeW5jICRvKCkge1xuICAgICAgICBpZiAodGhpcy5rbygpKSBcbiAgICAgICAgLy8gV2hlbiB0aW1pbmcgb3V0IGFuIGlkbGUgc3RyZWFtIHRoZXJlJ3Mgbm8gcmVhc29uIHRvIGZvcmNlIHRoZSBzdHJlYW0gaW50byBiYWNrb2ZmIHdoZW5cbiAgICAgICAgLy8gaXQgcmVzdGFydHMgc28gc2V0IHRoZSBzdHJlYW0gc3RhdGUgdG8gSW5pdGlhbCBpbnN0ZWFkIG9mIEVycm9yLlxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZSgwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovKTtcbiAgICB9XG4gICAgLyoqIE1hcmtzIHRoZSBzdHJlYW0gYXMgYWN0aXZlIGFnYWluLiAqLyAgICBMbygpIHtcbiAgICAgICAgdGhpcy5EbyAmJiAodGhpcy5Eby5jYW5jZWwoKSwgdGhpcy5EbyA9IG51bGwpO1xuICAgIH1cbiAgICAvKiogQ2FuY2VscyB0aGUgaGVhbHRoIGNoZWNrIGRlbGF5ZWQgb3BlcmF0aW9uLiAqLyAgICBxbygpIHtcbiAgICAgICAgdGhpcy5DbyAmJiAodGhpcy5Dby5jYW5jZWwoKSwgdGhpcy5DbyA9IG51bGwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbG9zZXMgdGhlIHN0cmVhbSBhbmQgY2xlYW5zIHVwIGFzIG5lY2Vzc2FyeTpcbiAgICAgKlxuICAgICAqICogY2xvc2VzIHRoZSB1bmRlcmx5aW5nIEdSUEMgc3RyZWFtO1xuICAgICAqICogY2FsbHMgdGhlIG9uQ2xvc2UgaGFuZGxlciB3aXRoIHRoZSBnaXZlbiAnZXJyb3InO1xuICAgICAqICogc2V0cyBpbnRlcm5hbCBzdHJlYW0gc3RhdGUgdG8gJ2ZpbmFsU3RhdGUnO1xuICAgICAqICogYWRqdXN0cyB0aGUgYmFja29mZiB0aW1lciBiYXNlZCBvbiB0aGUgZXJyb3JcbiAgICAgKlxuICAgICAqIEEgbmV3IHN0cmVhbSBjYW4gYmUgb3BlbmVkIGJ5IGNhbGxpbmcgc3RhcnQoKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaW5hbFN0YXRlIC0gdGhlIGludGVuZGVkIHN0YXRlIG9mIHRoZSBzdHJlYW0gYWZ0ZXIgY2xvc2luZy5cbiAgICAgKiBAcGFyYW0gZXJyb3IgLSB0aGUgZXJyb3IgdGhlIGNvbm5lY3Rpb24gd2FzIGNsb3NlZCB3aXRoLlxuICAgICAqLyAgICBhc3luYyBjbG9zZSh0LCBlKSB7XG4gICAgICAgIC8vIENhbmNlbCBhbnkgb3V0c3RhbmRpbmcgdGltZXJzICh0aGV5J3JlIGd1YXJhbnRlZWQgbm90IHRvIGV4ZWN1dGUpLlxuICAgICAgICB0aGlzLkxvKCksIHRoaXMucW8oKSwgdGhpcy54by5jYW5jZWwoKSwgXG4gICAgICAgIC8vIEludmFsaWRhdGVzIGFueSBzdHJlYW0tcmVsYXRlZCBjYWxsYmFja3MgKGUuZy4gZnJvbSBhdXRoIG9yIHRoZVxuICAgICAgICAvLyB1bmRlcmx5aW5nIHN0cmVhbSksIGd1YXJhbnRlZWluZyB0aGV5IHdvbid0IGV4ZWN1dGUuXG4gICAgICAgIHRoaXMuU28rKywgNCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuRXJyb3IgKi8gIT09IHQgPyBcbiAgICAgICAgLy8gSWYgdGhpcyBpcyBhbiBpbnRlbnRpb25hbCBjbG9zZSBlbnN1cmUgd2UgZG9uJ3QgZGVsYXkgb3VyIG5leHQgY29ubmVjdGlvbiBhdHRlbXB0LlxuICAgICAgICB0aGlzLnhvLnJlc2V0KCkgOiBlICYmIGUuY29kZSA9PT0gQi5SRVNPVVJDRV9FWEhBVVNURUQgPyAoXG4gICAgICAgIC8vIExvZyB0aGUgZXJyb3IuIChQcm9iYWJseSBlaXRoZXIgJ3F1b3RhIGV4Y2VlZGVkJyBvciAnbWF4IHF1ZXVlIGxlbmd0aCByZWFjaGVkJy4pXG4gICAgICAgIHgoZS50b1N0cmluZygpKSwgeChcIlVzaW5nIG1heGltdW0gYmFja29mZiBkZWxheSB0byBwcmV2ZW50IG92ZXJsb2FkaW5nIHRoZSBiYWNrZW5kLlwiKSwgXG4gICAgICAgIHRoaXMueG8uQW8oKSkgOiBlICYmIGUuY29kZSA9PT0gQi5VTkFVVEhFTlRJQ0FURUQgJiYgMyAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSGVhbHRoeSAqLyAhPT0gdGhpcy5zdGF0ZSAmJiAoXG4gICAgICAgIC8vIFwidW5hdXRoZW50aWNhdGVkXCIgZXJyb3IgbWVhbnMgdGhlIHRva2VuIHdhcyByZWplY3RlZC4gVGhpcyBzaG91bGQgcmFyZWx5XG4gICAgICAgIC8vIGhhcHBlbiBzaW5jZSBib3RoIEF1dGggYW5kIEFwcENoZWNrIGVuc3VyZSBhIHN1ZmZpY2llbnQgVFRMIHdoZW4gd2VcbiAgICAgICAgLy8gcmVxdWVzdCBhIHRva2VuLiBJZiBhIHVzZXIgbWFudWFsbHkgcmVzZXRzIHRoZWlyIHN5c3RlbSBjbG9jayB0aGlzIGNhblxuICAgICAgICAvLyBmYWlsLCBob3dldmVyLiBJbiB0aGlzIGNhc2UsIHdlIHNob3VsZCBnZXQgYSBDb2RlLlVOQVVUSEVOVElDQVRFRCBlcnJvclxuICAgICAgICAvLyBiZWZvcmUgd2UgcmVjZWl2ZWQgdGhlIGZpcnN0IG1lc3NhZ2UgYW5kIHdlIG5lZWQgdG8gaW52YWxpZGF0ZSB0aGUgdG9rZW5cbiAgICAgICAgLy8gdG8gZW5zdXJlIHRoYXQgd2UgZmV0Y2ggYSBuZXcgdG9rZW4uXG4gICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzUHJvdmlkZXIuaW52YWxpZGF0ZVRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsc1Byb3ZpZGVyLmludmFsaWRhdGVUb2tlbigpKSwgXG4gICAgICAgIC8vIENsZWFuIHVwIHRoZSB1bmRlcmx5aW5nIHN0cmVhbSBiZWNhdXNlIHdlIGFyZSBubyBsb25nZXIgaW50ZXJlc3RlZCBpbiBldmVudHMuXG4gICAgICAgIG51bGwgIT09IHRoaXMuc3RyZWFtICYmICh0aGlzLlVvKCksIHRoaXMuc3RyZWFtLmNsb3NlKCksIHRoaXMuc3RyZWFtID0gbnVsbCksIFxuICAgICAgICAvLyBUaGlzIHN0YXRlIG11c3QgYmUgYXNzaWduZWQgYmVmb3JlIGNhbGxpbmcgb25DbG9zZSgpIHRvIGFsbG93IHRoZSBjYWxsYmFjayB0b1xuICAgICAgICAvLyBpbmhpYml0IGJhY2tvZmYgb3Igb3RoZXJ3aXNlIG1hbmlwdWxhdGUgdGhlIHN0YXRlIGluIGl0cyBub24tc3RhcnRlZCBzdGF0ZS5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHQsIFxuICAgICAgICAvLyBOb3RpZnkgdGhlIGxpc3RlbmVyIHRoYXQgdGhlIHN0cmVhbSBjbG9zZWQuXG4gICAgICAgIGF3YWl0IHRoaXMubGlzdGVuZXIuWnIoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbiBiZSBvdmVycmlkZGVuIHRvIHBlcmZvcm0gYWRkaXRpb25hbCBjbGVhbnVwIGJlZm9yZSB0aGUgc3RyZWFtIGlzIGNsb3NlZC5cbiAgICAgKiBDYWxsaW5nIHN1cGVyLnRlYXJEb3duKCkgaXMgbm90IHJlcXVpcmVkLlxuICAgICAqLyAgICBVbygpIHt9XG4gICAgYXV0aCgpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDEgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLlN0YXJ0aW5nICovO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5Lbyh0aGlzLlNvKSwgZSA9IHRoaXMuU287XG4gICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogSnVzdCB1c2UgZGlzcGF0Y2hJZk5vdENsb3NlZCwgYnV0IHNlZSBUT0RPIGJlbG93LlxuICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHNQcm92aWRlci5nZXRUb2tlbigpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHNQcm92aWRlci5nZXRUb2tlbigpIF0pLnRoZW4oKChbdCwgbl0pID0+IHtcbiAgICAgICAgICAgIC8vIFN0cmVhbSBjYW4gYmUgc3RvcHBlZCB3aGlsZSB3YWl0aW5nIGZvciBhdXRoZW50aWNhdGlvbi5cbiAgICAgICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogV2UgcmVhbGx5IHNob3VsZCBqdXN0IHVzZSBkaXNwYXRjaElmTm90Q2xvc2VkXG4gICAgICAgICAgICAvLyBhbmQgbGV0IHRoaXMgZGlzcGF0Y2ggb250byB0aGUgcXVldWUsIGJ1dCB0aGF0IG9wZW5lZCBhIHNwZWMgdGVzdCBjYW5cbiAgICAgICAgICAgIC8vIG9mIHdvcm1zIHRoYXQgSSBkb24ndCB3YW50IHRvIGRlYWwgd2l0aCBpbiB0aGlzIFBSLlxuICAgICAgICAgICAgdGhpcy5TbyA9PT0gZSAmJiBcbiAgICAgICAgICAgIC8vIE5vcm1hbGx5IHdlJ2QgaGF2ZSB0byBzY2hlZHVsZSB0aGUgY2FsbGJhY2sgb24gdGhlIEFzeW5jUXVldWUuXG4gICAgICAgICAgICAvLyBIb3dldmVyLCB0aGUgZm9sbG93aW5nIGNhbGxzIGFyZSBzYWZlIHRvIGJlIGNhbGxlZCBvdXRzaWRlIHRoZVxuICAgICAgICAgICAgLy8gQXN5bmNRdWV1ZSBzaW5jZSB0aGV5IGRvbid0IGNoYWluIGFzeW5jaHJvbm91cyBjYWxsc1xuICAgICAgICAgICAgdGhpcy5Hbyh0LCBuKTtcbiAgICAgICAgfSksIChlID0+IHtcbiAgICAgICAgICAgIHQoKCgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IEwoQi5VTktOT1dOLCBcIkZldGNoaW5nIGF1dGggdG9rZW4gZmFpbGVkOiBcIiArIGUubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuUW8odCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgR28odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5Lbyh0aGlzLlNvKTtcbiAgICAgICAgdGhpcy5zdHJlYW0gPSB0aGlzLmpvKHQsIGUpLCB0aGlzLnN0cmVhbS5ZcigoKCkgPT4ge1xuICAgICAgICAgICAgbigoKCkgPT4gKHRoaXMuc3RhdGUgPSAyIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5PcGVuICovICwgdGhpcy5DbyA9IHRoaXMuSHMuZW5xdWV1ZUFmdGVyRGVsYXkodGhpcy5WbywgMWU0LCAoKCkgPT4gKHRoaXMua28oKSAmJiAodGhpcy5zdGF0ZSA9IDMgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkhlYWx0aHkgKi8pLCBcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpKSkpLCB0aGlzLmxpc3RlbmVyLllyKCkpKSk7XG4gICAgICAgIH0pKSwgdGhpcy5zdHJlYW0uWnIoKHQgPT4ge1xuICAgICAgICAgICAgbigoKCkgPT4gdGhpcy5Rbyh0KSkpO1xuICAgICAgICB9KSksIHRoaXMuc3RyZWFtLm9uTWVzc2FnZSgodCA9PiB7XG4gICAgICAgICAgICBuKCgoKSA9PiB0aGlzLm9uTWVzc2FnZSh0KSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIE9vKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gNSAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuQmFja29mZiAqLyAsIHRoaXMueG8uUm8oKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovICwgdGhpcy5zdGFydCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8vIFZpc2libGUgZm9yIHRlc3RzXG4gICAgUW8odCkge1xuICAgICAgICAvLyBJbiB0aGVvcnkgdGhlIHN0cmVhbSBjb3VsZCBjbG9zZSBjbGVhbmx5LCBob3dldmVyLCBpbiBvdXIgY3VycmVudCBtb2RlbFxuICAgICAgICAvLyB3ZSBuZXZlciBleHBlY3QgdGhpcyB0byBoYXBwZW4gYmVjYXVzZSBpZiB3ZSBzdG9wIGEgc3RyZWFtIG91cnNlbHZlcyxcbiAgICAgICAgLy8gdGhpcyBjYWxsYmFjayB3aWxsIG5ldmVyIGJlIGNhbGxlZC4gVG8gcHJldmVudCBjYXNlcyB3aGVyZSB3ZSByZXRyeVxuICAgICAgICAvLyB3aXRob3V0IGEgYmFja29mZiBhY2NpZGVudGFsbHksIHdlIHNldCB0aGUgc3RyZWFtIHRvIGVycm9yIGluIGFsbCBjYXNlcy5cbiAgICAgICAgcmV0dXJuIEMoXCJQZXJzaXN0ZW50U3RyZWFtXCIsIGBjbG9zZSB3aXRoIGVycm9yOiAke3R9YCksIHRoaXMuc3RyZWFtID0gbnVsbCwgdGhpcy5jbG9zZSg0IC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5FcnJvciAqLyAsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgXCJkaXNwYXRjaGVyXCIgZnVuY3Rpb24gdGhhdCBkaXNwYXRjaGVzIG9wZXJhdGlvbnMgb250byB0aGVcbiAgICAgKiBBc3luY1F1ZXVlIGJ1dCBvbmx5IHJ1bnMgdGhlbSBpZiBjbG9zZUNvdW50IHJlbWFpbnMgdW5jaGFuZ2VkLiBUaGlzIGFsbG93c1xuICAgICAqIHVzIHRvIHR1cm4gYXV0aCAvIHN0cmVhbSBjYWxsYmFja3MgaW50byBuby1vcHMgaWYgdGhlIHN0cmVhbSBpcyBjbG9zZWQgL1xuICAgICAqIHJlLW9wZW5lZCwgZXRjLlxuICAgICAqLyAgICBLbyh0KSB7XG4gICAgICAgIHJldHVybiBlID0+IHtcbiAgICAgICAgICAgIHRoaXMuSHMuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gdGhpcy5TbyA9PT0gdCA/IGUoKSA6IChDKFwiUGVyc2lzdGVudFN0cmVhbVwiLCBcInN0cmVhbSBjYWxsYmFjayBza2lwcGVkIGJ5IGdldENsb3NlR3VhcmRlZERpc3BhdGNoZXIuXCIpLCBcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpKSkpO1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIFBlcnNpc3RlbnRTdHJlYW0gdGhhdCBpbXBsZW1lbnRzIHRoZSBMaXN0ZW4gUlBDLlxuICpcbiAqIE9uY2UgdGhlIExpc3RlbiBzdHJlYW0gaGFzIGNhbGxlZCB0aGUgb25PcGVuKCkgbGlzdGVuZXIsIGFueSBudW1iZXIgb2ZcbiAqIGxpc3RlbigpIGFuZCB1bmxpc3RlbigpIGNhbGxzIGNhbiBiZSBtYWRlIHRvIGNvbnRyb2wgd2hhdCBjaGFuZ2VzIHdpbGwgYmVcbiAqIHNlbnQgZnJvbSB0aGUgc2VydmVyIGZvciBMaXN0ZW5SZXNwb25zZXMuXG4gKi8gY2xhc3MgRXUgZXh0ZW5kcyBUdSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSwgcikge1xuICAgICAgICBzdXBlcih0LCBcImxpc3Rlbl9zdHJlYW1fY29ubmVjdGlvbl9iYWNrb2ZmXCIgLyogVGltZXJJZC5MaXN0ZW5TdHJlYW1Db25uZWN0aW9uQmFja29mZiAqLyAsIFwibGlzdGVuX3N0cmVhbV9pZGxlXCIgLyogVGltZXJJZC5MaXN0ZW5TdHJlYW1JZGxlICovICwgXCJoZWFsdGhfY2hlY2tfdGltZW91dFwiIC8qIFRpbWVySWQuSGVhbHRoQ2hlY2tUaW1lb3V0ICovICwgZSwgbiwgcywgciksIFxuICAgICAgICB0aGlzLnl0ID0gaTtcbiAgICB9XG4gICAgam8odCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uLndvKFwiTGlzdGVuXCIsIHQsIGUpO1xuICAgIH1cbiAgICBvbk1lc3NhZ2UodCkge1xuICAgICAgICAvLyBBIHN1Y2Nlc3NmdWwgcmVzcG9uc2UgbWVhbnMgdGhlIHN0cmVhbSBpcyBoZWFsdGh5XG4gICAgICAgIHRoaXMueG8ucmVzZXQoKTtcbiAgICAgICAgY29uc3QgZSA9IFpzKHRoaXMueXQsIHQpLCBuID0gZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgLy8gV2UgaGF2ZSBvbmx5IHJlYWNoZWQgYSBjb25zaXN0ZW50IHNuYXBzaG90IGZvciB0aGUgZW50aXJlIHN0cmVhbSBpZiB0aGVyZVxuICAgICAgICAgICAgLy8gaXMgYSByZWFkX3RpbWUgc2V0IGFuZCBpdCBhcHBsaWVzIHRvIGFsbCB0YXJnZXRzIChpLmUuIHRoZSBsaXN0IG9mXG4gICAgICAgICAgICAvLyB0YXJnZXRzIGlzIGVtcHR5KS4gVGhlIGJhY2tlbmQgaXMgZ3VhcmFudGVlZCB0byBzZW5kIHN1Y2ggcmVzcG9uc2VzLlxuICAgICAgICAgICAgaWYgKCEoXCJ0YXJnZXRDaGFuZ2VcIiBpbiB0KSkgcmV0dXJuIHN0Lm1pbigpO1xuICAgICAgICAgICAgY29uc3QgZSA9IHQudGFyZ2V0Q2hhbmdlO1xuICAgICAgICAgICAgcmV0dXJuIGUudGFyZ2V0SWRzICYmIGUudGFyZ2V0SWRzLmxlbmd0aCA/IHN0Lm1pbigpIDogZS5yZWFkVGltZSA/IHFzKGUucmVhZFRpbWUpIDogc3QubWluKCk7XG4gICAgICAgIH0odCk7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLldvKGUsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgaW50ZXJlc3QgaW4gdGhlIHJlc3VsdHMgb2YgdGhlIGdpdmVuIHRhcmdldC4gSWYgdGhlIHRhcmdldFxuICAgICAqIGluY2x1ZGVzIGEgcmVzdW1lVG9rZW4gaXQgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVxdWVzdC4gUmVzdWx0cyB0aGF0XG4gICAgICogYWZmZWN0IHRoZSB0YXJnZXQgd2lsbCBiZSBzdHJlYW1lZCBiYWNrIGFzIFdhdGNoQ2hhbmdlIG1lc3NhZ2VzIHRoYXRcbiAgICAgKiByZWZlcmVuY2UgdGhlIHRhcmdldElkLlxuICAgICAqLyAgICB6byh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB7fTtcbiAgICAgICAgZS5kYXRhYmFzZSA9IHpzKHRoaXMueXQpLCBlLmFkZFRhcmdldCA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGxldCBuO1xuICAgICAgICAgICAgY29uc3QgcyA9IGUudGFyZ2V0O1xuICAgICAgICAgICAgcmV0dXJuIG4gPSBybihzKSA/IHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudHM6IHNpKHQsIHMpXG4gICAgICAgICAgICB9IDoge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBpaSh0LCBzKVxuICAgICAgICAgICAgfSwgbi50YXJnZXRJZCA9IGUudGFyZ2V0SWQsIGUucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCA/IG4ucmVzdW1lVG9rZW4gPSBCcyh0LCBlLnJlc3VtZVRva2VuKSA6IGUuc25hcHNob3RWZXJzaW9uLmNvbXBhcmVUbyhzdC5taW4oKSkgPiAwICYmIChcbiAgICAgICAgICAgIC8vIFRPRE8od3VhbmR5KTogQ29uc2lkZXIgcmVtb3ZpbmcgYWJvdmUgY2hlY2sgYmVjYXVzZSBpdCBpcyBtb3N0IGxpa2VseSB0cnVlLlxuICAgICAgICAgICAgLy8gUmlnaHQgbm93LCBtYW55IHRlc3RzIGRlcGVuZCBvbiB0aGlzIGJlaGF2aW91ciB0aG91Z2ggKGxlYXZpbmcgbWluKCkgb3V0XG4gICAgICAgICAgICAvLyBvZiBzZXJpYWxpemF0aW9uKS5cbiAgICAgICAgICAgIG4ucmVhZFRpbWUgPSAkcyh0LCBlLnNuYXBzaG90VmVyc2lvbi50b1RpbWVzdGFtcCgpKSksIG47XG4gICAgICAgIH0odGhpcy55dCwgdCk7XG4gICAgICAgIGNvbnN0IG4gPSBvaSh0aGlzLnl0LCB0KTtcbiAgICAgICAgbiAmJiAoZS5sYWJlbHMgPSBuKSwgdGhpcy5CbyhlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVW5yZWdpc3RlcnMgaW50ZXJlc3QgaW4gdGhlIHJlc3VsdHMgb2YgdGhlIHRhcmdldCBhc3NvY2lhdGVkIHdpdGggdGhlXG4gICAgICogZ2l2ZW4gdGFyZ2V0SWQuXG4gICAgICovICAgIEhvKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHt9O1xuICAgICAgICBlLmRhdGFiYXNlID0genModGhpcy55dCksIGUucmVtb3ZlVGFyZ2V0ID0gdCwgdGhpcy5CbyhlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBTdHJlYW0gdGhhdCBpbXBsZW1lbnRzIHRoZSBXcml0ZSBSUEMuXG4gKlxuICogVGhlIFdyaXRlIFJQQyByZXF1aXJlcyB0aGUgY2FsbGVyIHRvIG1haW50YWluIHNwZWNpYWwgc3RyZWFtVG9rZW5cbiAqIHN0YXRlIGluIGJldHdlZW4gY2FsbHMsIHRvIGhlbHAgdGhlIHNlcnZlciB1bmRlcnN0YW5kIHdoaWNoIHJlc3BvbnNlcyB0aGVcbiAqIGNsaWVudCBoYXMgcHJvY2Vzc2VkIGJ5IHRoZSB0aW1lIHRoZSBuZXh0IHJlcXVlc3QgaXMgbWFkZS4gRXZlcnkgcmVzcG9uc2VcbiAqIHdpbGwgY29udGFpbiBhIHN0cmVhbVRva2VuOyB0aGlzIHZhbHVlIG11c3QgYmUgcGFzc2VkIHRvIHRoZSBuZXh0XG4gKiByZXF1ZXN0LlxuICpcbiAqIEFmdGVyIGNhbGxpbmcgc3RhcnQoKSBvbiB0aGlzIHN0cmVhbSwgdGhlIG5leHQgcmVxdWVzdCBtdXN0IGJlIGEgaGFuZHNoYWtlLFxuICogY29udGFpbmluZyB3aGF0ZXZlciBzdHJlYW1Ub2tlbiBpcyBvbiBoYW5kLiBPbmNlIGEgcmVzcG9uc2UgdG8gdGhpc1xuICogcmVxdWVzdCBpcyByZWNlaXZlZCwgYWxsIHBlbmRpbmcgbXV0YXRpb25zIG1heSBiZSBzdWJtaXR0ZWQuIFdoZW5cbiAqIHN1Ym1pdHRpbmcgbXVsdGlwbGUgYmF0Y2hlcyBvZiBtdXRhdGlvbnMgYXQgdGhlIHNhbWUgdGltZSwgaXQnc1xuICogb2theSB0byB1c2UgdGhlIHNhbWUgc3RyZWFtVG9rZW4gZm9yIHRoZSBjYWxscyB0byB3cml0ZU11dGF0aW9ucy5cbiAqXG4gKiBUT0RPKGIvMzMyNzEyMzUpOiBVc2UgcHJvdG8gdHlwZXNcbiAqLyBjbGFzcyBBdSBleHRlbmRzIFR1IHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByKSB7XG4gICAgICAgIHN1cGVyKHQsIFwid3JpdGVfc3RyZWFtX2Nvbm5lY3Rpb25fYmFja29mZlwiIC8qIFRpbWVySWQuV3JpdGVTdHJlYW1Db25uZWN0aW9uQmFja29mZiAqLyAsIFwid3JpdGVfc3RyZWFtX2lkbGVcIiAvKiBUaW1lcklkLldyaXRlU3RyZWFtSWRsZSAqLyAsIFwiaGVhbHRoX2NoZWNrX3RpbWVvdXRcIiAvKiBUaW1lcklkLkhlYWx0aENoZWNrVGltZW91dCAqLyAsIGUsIG4sIHMsIHIpLCBcbiAgICAgICAgdGhpcy55dCA9IGksIHRoaXMuSm8gPSAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgb3Igbm90IGEgaGFuZHNoYWtlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBleGNoYW5nZWQgYW5kXG4gICAgICogdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgbXV0YXRpb25zLlxuICAgICAqLyAgICBnZXQgWW8oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLkpvO1xuICAgIH1cbiAgICAvLyBPdmVycmlkZSBvZiBQZXJzaXN0ZW50U3RyZWFtLnN0YXJ0XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMuSm8gPSAhMSwgdGhpcy5sYXN0U3RyZWFtVG9rZW4gPSB2b2lkIDAsIHN1cGVyLnN0YXJ0KCk7XG4gICAgfVxuICAgIFVvKCkge1xuICAgICAgICB0aGlzLkpvICYmIHRoaXMuWG8oW10pO1xuICAgIH1cbiAgICBqbyh0LCBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rpb24ud28oXCJXcml0ZVwiLCB0LCBlKTtcbiAgICB9XG4gICAgb25NZXNzYWdlKHQpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAvLyBBbHdheXMgY2FwdHVyZSB0aGUgbGFzdCBzdHJlYW0gdG9rZW4uXG4gICAgICAgIE0oISF0LnN0cmVhbVRva2VuKSwgdGhpcy5sYXN0U3RyZWFtVG9rZW4gPSB0LnN0cmVhbVRva2VuLCB0aGlzLkpvKSB7XG4gICAgICAgICAgICAvLyBBIHN1Y2Nlc3NmdWwgZmlyc3Qgd3JpdGUgcmVzcG9uc2UgbWVhbnMgdGhlIHN0cmVhbSBpcyBoZWFsdGh5LFxuICAgICAgICAgICAgLy8gTm90ZSwgdGhhdCB3ZSBjb3VsZCBjb25zaWRlciBhIHN1Y2Nlc3NmdWwgaGFuZHNoYWtlIGhlYWx0aHksIGhvd2V2ZXIsXG4gICAgICAgICAgICAvLyB0aGUgd3JpdGUgaXRzZWxmIG1pZ2h0IGJlIGNhdXNpbmcgYW4gZXJyb3Igd2Ugd2FudCB0byBiYWNrIG9mZiBmcm9tLlxuICAgICAgICAgICAgdGhpcy54by5yZXNldCgpO1xuICAgICAgICAgICAgY29uc3QgZSA9IG5pKHQud3JpdGVSZXN1bHRzLCB0LmNvbW1pdFRpbWUpLCBuID0gcXModC5jb21taXRUaW1lKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLlpvKG4sIGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBmaXJzdCByZXNwb25zZSBpcyBhbHdheXMgdGhlIGhhbmRzaGFrZSByZXNwb25zZVxuICAgICAgICByZXR1cm4gTSghdC53cml0ZVJlc3VsdHMgfHwgMCA9PT0gdC53cml0ZVJlc3VsdHMubGVuZ3RoKSwgdGhpcy5KbyA9ICEwLCB0aGlzLmxpc3RlbmVyLnR1KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNlbmRzIGFuIGluaXRpYWwgc3RyZWFtVG9rZW4gdG8gdGhlIHNlcnZlciwgcGVyZm9ybWluZyB0aGUgaGFuZHNoYWtlXG4gICAgICogcmVxdWlyZWQgdG8gbWFrZSB0aGUgU3RyZWFtaW5nV3JpdGUgUlBDIHdvcmsuIFN1YnNlcXVlbnRcbiAgICAgKiBjYWxscyBzaG91bGQgd2FpdCB1bnRpbCBvbkhhbmRzaGFrZUNvbXBsZXRlIHdhcyBjYWxsZWQuXG4gICAgICovICAgIGV1KCkge1xuICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IFN1cHBvcnQgc3RyZWFtIHJlc3VtcHRpb24uIFdlIGludGVudGlvbmFsbHkgZG8gbm90IHNldCB0aGVcbiAgICAgICAgLy8gc3RyZWFtIHRva2VuIG9uIHRoZSBoYW5kc2hha2UsIGlnbm9yaW5nIGFueSBzdHJlYW0gdG9rZW4gd2UgbWlnaHQgaGF2ZS5cbiAgICAgICAgY29uc3QgdCA9IHt9O1xuICAgICAgICB0LmRhdGFiYXNlID0genModGhpcy55dCksIHRoaXMuQm8odCk7XG4gICAgfVxuICAgIC8qKiBTZW5kcyBhIGdyb3VwIG9mIG11dGF0aW9ucyB0byB0aGUgRmlyZXN0b3JlIGJhY2tlbmQgdG8gYXBwbHkuICovICAgIFhvKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIHN0cmVhbVRva2VuOiB0aGlzLmxhc3RTdHJlYW1Ub2tlbixcbiAgICAgICAgICAgIHdyaXRlczogdC5tYXAoKHQgPT4gdGkodGhpcy55dCwgdCkpKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLkJvKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRGF0YXN0b3JlIGFuZCBpdHMgcmVsYXRlZCBtZXRob2RzIGFyZSBhIHdyYXBwZXIgYXJvdW5kIHRoZSBleHRlcm5hbCBHb29nbGVcbiAqIENsb3VkIERhdGFzdG9yZSBncnBjIEFQSSwgd2hpY2ggcHJvdmlkZXMgYW4gaW50ZXJmYWNlIHRoYXQgaXMgbW9yZSBjb252ZW5pZW50XG4gKiBmb3IgdGhlIHJlc3Qgb2YgdGhlIGNsaWVudCBTREsgYXJjaGl0ZWN0dXJlIHRvIGNvbnN1bWUuXG4gKi9cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgRGF0YXN0b3JlIHRoYXQgZXhwb3NlcyBhZGRpdGlvbmFsIHN0YXRlIGZvciBpbnRlcm5hbFxuICogY29uc3VtcHRpb24uXG4gKi9cbmNsYXNzIFJ1IGV4dGVuZHMgY2xhc3Mge30ge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5hdXRoQ3JlZGVudGlhbHMgPSB0LCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMgPSBlLCB0aGlzLmNvbm5lY3Rpb24gPSBuLCBcbiAgICAgICAgdGhpcy55dCA9IHMsIHRoaXMubnUgPSAhMTtcbiAgICB9XG4gICAgc3UoKSB7XG4gICAgICAgIGlmICh0aGlzLm51KSB0aHJvdyBuZXcgTChCLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIH1cbiAgICAvKiogSW52b2tlcyB0aGUgcHJvdmlkZWQgUlBDIHdpdGggYXV0aCBhbmQgQXBwQ2hlY2sgdG9rZW5zLiAqLyAgICBhbyh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN1KCksIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHMuZ2V0VG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmdldFRva2VuKCkgXSkudGhlbigoKFtzLCBpXSkgPT4gdGhpcy5jb25uZWN0aW9uLmFvKHQsIGUsIG4sIHMsIGkpKSkuY2F0Y2goKHQgPT4ge1xuICAgICAgICAgICAgdGhyb3cgXCJGaXJlYmFzZUVycm9yXCIgPT09IHQubmFtZSA/ICh0LmNvZGUgPT09IEIuVU5BVVRIRU5USUNBVEVEICYmICh0aGlzLmF1dGhDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSwgXG4gICAgICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCkpLCB0KSA6IG5ldyBMKEIuVU5LTk9XTiwgdC50b1N0cmluZygpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKiogSW52b2tlcyB0aGUgcHJvdmlkZWQgUlBDIHdpdGggc3RyZWFtZWQgcmVzdWx0cyB3aXRoIGF1dGggYW5kIEFwcENoZWNrIHRva2Vucy4gKi8gICAgX28odCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gdGhpcy5zdSgpLCBQcm9taXNlLmFsbChbIHRoaXMuYXV0aENyZWRlbnRpYWxzLmdldFRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5nZXRUb2tlbigpIF0pLnRoZW4oKChbaSwgcl0pID0+IHRoaXMuY29ubmVjdGlvbi5fbyh0LCBlLCBuLCBpLCByLCBzKSkpLmNhdGNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRocm93IFwiRmlyZWJhc2VFcnJvclwiID09PSB0Lm5hbWUgPyAodC5jb2RlID09PSBCLlVOQVVUSEVOVElDQVRFRCAmJiAodGhpcy5hdXRoQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCksIFxuICAgICAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmludmFsaWRhdGVUb2tlbigpKSwgdCkgOiBuZXcgTChCLlVOS05PV04sIHQudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgdGVybWluYXRlKCkge1xuICAgICAgICB0aGlzLm51ID0gITA7XG4gICAgfVxufVxuXG4vLyBUT0RPKGZpcmVzdG9yZXhwKTogTWFrZSBzdXJlIHRoZXJlIGlzIG9ubHkgb25lIERhdGFzdG9yZSBpbnN0YW5jZSBwZXJcbi8vIGZpcmVzdG9yZS1leHAgY2xpZW50LlxuYXN5bmMgZnVuY3Rpb24gYnUodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gaWkodCwgZSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdHJ1Y3R1cmVkQWdncmVnYXRpb25RdWVyeToge1xuICAgICAgICAgICAgICAgIGFnZ3JlZ2F0aW9uczogWyB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiB7fSxcbiAgICAgICAgICAgICAgICAgICAgYWxpYXM6IFwiY291bnRfYWxpYXNcIlxuICAgICAgICAgICAgICAgIH0gXSxcbiAgICAgICAgICAgICAgICBzdHJ1Y3R1cmVkUXVlcnk6IG4uc3RydWN0dXJlZFF1ZXJ5XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGFyZW50OiBuLnBhcmVudFxuICAgICAgICB9O1xuICAgIH0obi55dCwgZ24oZSkpLCBpID0gcy5wYXJlbnQ7XG4gICAgbi5jb25uZWN0aW9uLmNvIHx8IGRlbGV0ZSBzLnBhcmVudDtcbiAgICByZXR1cm4gKGF3YWl0IG4uX28oXCJSdW5BZ2dyZWdhdGlvblF1ZXJ5XCIsIGksIHMsIC8qZXhwZWN0ZWRSZXNwb25zZUNvdW50PSovIDEpKS5maWx0ZXIoKHQgPT4gISF0LnJlc3VsdCkpLm1hcCgodCA9PiB0LnJlc3VsdC5hZ2dyZWdhdGVGaWVsZHMpKTtcbn1cblxuLyoqXG4gKiBBIGNvbXBvbmVudCB1c2VkIGJ5IHRoZSBSZW1vdGVTdG9yZSB0byB0cmFjayB0aGUgT25saW5lU3RhdGUgKHRoYXQgaXMsXG4gKiB3aGV0aGVyIG9yIG5vdCB0aGUgY2xpZW50IGFzIGEgd2hvbGUgc2hvdWxkIGJlIGNvbnNpZGVyZWQgdG8gYmUgb25saW5lIG9yXG4gKiBvZmZsaW5lKSwgaW1wbGVtZW50aW5nIHRoZSBhcHByb3ByaWF0ZSBoZXVyaXN0aWNzLlxuICpcbiAqIEluIHBhcnRpY3VsYXIsIHdoZW4gdGhlIGNsaWVudCBpcyB0cnlpbmcgdG8gY29ubmVjdCB0byB0aGUgYmFja2VuZCwgd2VcbiAqIGFsbG93IHVwIHRvIE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMgd2l0aGluIE9OTElORV9TVEFURV9USU1FT1VUX01TIGZvclxuICogYSBjb25uZWN0aW9uIHRvIHN1Y2NlZWQuIElmIHdlIGhhdmUgdG9vIG1hbnkgZmFpbHVyZXMgb3IgdGhlIHRpbWVvdXQgZWxhcHNlcyxcbiAqIHRoZW4gd2Ugc2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBPZmZsaW5lLCBhbmQgdGhlIGNsaWVudCB3aWxsIGJlaGF2ZSBhcyBpZlxuICogaXQgaXMgb2ZmbGluZSAoZ2V0KClzIHdpbGwgcmV0dXJuIGNhY2hlZCBkYXRhLCBldGMuKS5cbiAqL1xuY2xhc3MgUHUge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gdCwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIgPSBlLCBcbiAgICAgICAgLyoqIFRoZSBjdXJyZW50IE9ubGluZVN0YXRlLiAqL1xuICAgICAgICB0aGlzLnN0YXRlID0gXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBjb3VudCBvZiBjb25zZWN1dGl2ZSBmYWlsdXJlcyB0byBvcGVuIHRoZSBzdHJlYW0uIElmIGl0IHJlYWNoZXMgdGhlXG4gICAgICAgICAqIG1heGltdW0gZGVmaW5lZCBieSBNQVhfV0FUQ0hfU1RSRUFNX0ZBSUxVUkVTLCB3ZSdsbCBzZXQgdGhlIE9ubGluZVN0YXRlIHRvXG4gICAgICAgICAqIE9mZmxpbmUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLml1ID0gMCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHRpbWVyIHRoYXQgZWxhcHNlcyBhZnRlciBPTkxJTkVfU1RBVEVfVElNRU9VVF9NUywgYXQgd2hpY2ggcG9pbnQgd2VcbiAgICAgICAgICogdHJhbnNpdGlvbiBmcm9tIE9ubGluZVN0YXRlLlVua25vd24gdG8gT25saW5lU3RhdGUuT2ZmbGluZSB3aXRob3V0IHdhaXRpbmdcbiAgICAgICAgICogZm9yIHRoZSBzdHJlYW0gdG8gYWN0dWFsbHkgZmFpbCAoTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUyB0aW1lcykuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJ1ID0gbnVsbCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBjbGllbnQgc2hvdWxkIGxvZyBhIHdhcm5pbmcgbWVzc2FnZSBpZiBpdCBmYWlscyB0byBjb25uZWN0IHRvXG4gICAgICAgICAqIHRoZSBiYWNrZW5kIChpbml0aWFsbHkgdHJ1ZSwgY2xlYXJlZCBhZnRlciBhIHN1Y2Nlc3NmdWwgc3RyZWFtLCBvciBpZiB3ZSd2ZVxuICAgICAgICAgKiBsb2dnZWQgdGhlIG1lc3NhZ2UgYWxyZWFkeSkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm91ID0gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGxlZCBieSBSZW1vdGVTdG9yZSB3aGVuIGEgd2F0Y2ggc3RyZWFtIGlzIHN0YXJ0ZWQgKGluY2x1ZGluZyBvbiBlYWNoXG4gICAgICogYmFja29mZiBhdHRlbXB0KS5cbiAgICAgKlxuICAgICAqIElmIHRoaXMgaXMgdGhlIGZpcnN0IGF0dGVtcHQsIGl0IHNldHMgdGhlIE9ubGluZVN0YXRlIHRvIFVua25vd24gYW5kIHN0YXJ0c1xuICAgICAqIHRoZSBvbmxpbmVTdGF0ZVRpbWVyLlxuICAgICAqLyAgICB1dSgpIHtcbiAgICAgICAgMCA9PT0gdGhpcy5pdSAmJiAodGhpcy5jdShcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSwgdGhpcy5ydSA9IHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQWZ0ZXJEZWxheShcIm9ubGluZV9zdGF0ZV90aW1lb3V0XCIgLyogVGltZXJJZC5PbmxpbmVTdGF0ZVRpbWVvdXQgKi8gLCAxZTQsICgoKSA9PiAodGhpcy5ydSA9IG51bGwsIFxuICAgICAgICB0aGlzLmF1KFwiQmFja2VuZCBkaWRuJ3QgcmVzcG9uZCB3aXRoaW4gMTAgc2Vjb25kcy5cIiksIHRoaXMuY3UoXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyksIFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgb3VyIE9ubGluZVN0YXRlIGFzIGFwcHJvcHJpYXRlIGFmdGVyIHRoZSB3YXRjaCBzdHJlYW0gcmVwb3J0cyBhXG4gICAgICogZmFpbHVyZS4gVGhlIGZpcnN0IGZhaWx1cmUgbW92ZXMgdXMgdG8gdGhlICdVbmtub3duJyBzdGF0ZS4gV2UgdGhlbiBtYXlcbiAgICAgKiBhbGxvdyBtdWx0aXBsZSBmYWlsdXJlcyAoYmFzZWQgb24gTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUykgYmVmb3JlIHdlXG4gICAgICogYWN0dWFsbHkgdHJhbnNpdGlvbiB0byB0aGUgJ09mZmxpbmUnIHN0YXRlLlxuICAgICAqLyAgICBodSh0KSB7XG4gICAgICAgIFwiT25saW5lXCIgLyogT25saW5lU3RhdGUuT25saW5lICovID09PSB0aGlzLnN0YXRlID8gdGhpcy5jdShcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSA6ICh0aGlzLml1KyssIFxuICAgICAgICB0aGlzLml1ID49IDEgJiYgKHRoaXMubHUoKSwgdGhpcy5hdShgQ29ubmVjdGlvbiBmYWlsZWQgMSB0aW1lcy4gTW9zdCByZWNlbnQgZXJyb3I6ICR7dC50b1N0cmluZygpfWApLCBcbiAgICAgICAgdGhpcy5jdShcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeHBsaWNpdGx5IHNldHMgdGhlIE9ubGluZVN0YXRlIHRvIHRoZSBzcGVjaWZpZWQgc3RhdGUuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgdGhpcyByZXNldHMgb3VyIHRpbWVycyAvIGZhaWx1cmUgY291bnRlcnMsIGV0Yy4gdXNlZCBieSBvdXJcbiAgICAgKiBPZmZsaW5lIGhldXJpc3RpY3MsIHNvIG11c3Qgbm90IGJlIHVzZWQgaW4gcGxhY2Ugb2ZcbiAgICAgKiBoYW5kbGVXYXRjaFN0cmVhbVN0YXJ0KCkgYW5kIGhhbmRsZVdhdGNoU3RyZWFtRmFpbHVyZSgpLlxuICAgICAqLyAgICBzZXQodCkge1xuICAgICAgICB0aGlzLmx1KCksIHRoaXMuaXUgPSAwLCBcIk9ubGluZVwiIC8qIE9ubGluZVN0YXRlLk9ubGluZSAqLyA9PT0gdCAmJiAoXG4gICAgICAgIC8vIFdlJ3ZlIGNvbm5lY3RlZCB0byB3YXRjaCBhdCBsZWFzdCBvbmNlLiBEb24ndCB3YXJuIHRoZSBkZXZlbG9wZXJcbiAgICAgICAgLy8gYWJvdXQgYmVpbmcgb2ZmbGluZSBnb2luZyBmb3J3YXJkLlxuICAgICAgICB0aGlzLm91ID0gITEpLCB0aGlzLmN1KHQpO1xuICAgIH1cbiAgICBjdSh0KSB7XG4gICAgICAgIHQgIT09IHRoaXMuc3RhdGUgJiYgKHRoaXMuc3RhdGUgPSB0LCB0aGlzLm9ubGluZVN0YXRlSGFuZGxlcih0KSk7XG4gICAgfVxuICAgIGF1KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IGBDb3VsZCBub3QgcmVhY2ggQ2xvdWQgRmlyZXN0b3JlIGJhY2tlbmQuICR7dH1cXG5UaGlzIHR5cGljYWxseSBpbmRpY2F0ZXMgdGhhdCB5b3VyIGRldmljZSBkb2VzIG5vdCBoYXZlIGEgaGVhbHRoeSBJbnRlcm5ldCBjb25uZWN0aW9uIGF0IHRoZSBtb21lbnQuIFRoZSBjbGllbnQgd2lsbCBvcGVyYXRlIGluIG9mZmxpbmUgbW9kZSB1bnRpbCBpdCBpcyBhYmxlIHRvIHN1Y2Nlc3NmdWxseSBjb25uZWN0IHRvIHRoZSBiYWNrZW5kLmA7XG4gICAgICAgIHRoaXMub3UgPyAoeChlKSwgdGhpcy5vdSA9ICExKSA6IEMoXCJPbmxpbmVTdGF0ZVRyYWNrZXJcIiwgZSk7XG4gICAgfVxuICAgIGx1KCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLnJ1ICYmICh0aGlzLnJ1LmNhbmNlbCgpLCB0aGlzLnJ1ID0gbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyB2dSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGxvY2FsIHN0b3JlLCB1c2VkIHRvIGZpbGwgdGhlIHdyaXRlIHBpcGVsaW5lIHdpdGggb3V0Ym91bmQgbXV0YXRpb25zLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUgY2xpZW50LXNpZGUgcHJveHkgZm9yIGludGVyYWN0aW5nIHdpdGggdGhlIGJhY2tlbmQuICovXG4gICAgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLmxvY2FsU3RvcmUgPSB0LCB0aGlzLmRhdGFzdG9yZSA9IGUsIHRoaXMuYXN5bmNRdWV1ZSA9IG4sIHRoaXMucmVtb3RlU3luY2VyID0ge30sIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBsaXN0IG9mIHVwIHRvIE1BWF9QRU5ESU5HX1dSSVRFUyB3cml0ZXMgdGhhdCB3ZSBoYXZlIGZldGNoZWQgZnJvbSB0aGVcbiAgICAgICAgICogTG9jYWxTdG9yZSB2aWEgZmlsbFdyaXRlUGlwZWxpbmUoKSBhbmQgaGF2ZSBvciB3aWxsIHNlbmQgdG8gdGhlIHdyaXRlXG4gICAgICAgICAqIHN0cmVhbS5cbiAgICAgICAgICpcbiAgICAgICAgICogV2hlbmV2ZXIgd3JpdGVQaXBlbGluZS5sZW5ndGggPiAwIHRoZSBSZW1vdGVTdG9yZSB3aWxsIGF0dGVtcHQgdG8gc3RhcnQgb3JcbiAgICAgICAgICogcmVzdGFydCB0aGUgd3JpdGUgc3RyZWFtLiBXaGVuIHRoZSBzdHJlYW0gaXMgZXN0YWJsaXNoZWQgdGhlIHdyaXRlcyBpbiB0aGVcbiAgICAgICAgICogcGlwZWxpbmUgd2lsbCBiZSBzZW50IGluIG9yZGVyLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXcml0ZXMgcmVtYWluIGluIHdyaXRlUGlwZWxpbmUgdW50aWwgdGhleSBhcmUgYWNrbm93bGVkZ2VkIGJ5IHRoZSBiYWNrZW5kXG4gICAgICAgICAqIGFuZCB0aHVzIHdpbGwgYXV0b21hdGljYWxseSBiZSByZS1zZW50IGlmIHRoZSBzdHJlYW0gaXMgaW50ZXJydXB0ZWQgL1xuICAgICAgICAgKiByZXN0YXJ0ZWQgYmVmb3JlIHRoZXkncmUgYWNrbm93bGVkZ2VkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXcml0ZSByZXNwb25zZXMgZnJvbSB0aGUgYmFja2VuZCBhcmUgbGlua2VkIHRvIHRoZWlyIG9yaWdpbmF0aW5nIHJlcXVlc3RcbiAgICAgICAgICogcHVyZWx5IGJhc2VkIG9uIG9yZGVyLCBhbmQgc28gd2UgY2FuIGp1c3Qgc2hpZnQoKSB3cml0ZXMgZnJvbSB0aGUgZnJvbnQgb2ZcbiAgICAgICAgICogdGhlIHdyaXRlUGlwZWxpbmUgYXMgd2UgcmVjZWl2ZSByZXNwb25zZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZ1ID0gW10sIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBtYXBwaW5nIG9mIHdhdGNoZWQgdGFyZ2V0cyB0aGF0IHRoZSBjbGllbnQgY2FyZXMgYWJvdXQgdHJhY2tpbmcgYW5kIHRoZVxuICAgICAgICAgKiB1c2VyIGhhcyBleHBsaWNpdGx5IGNhbGxlZCBhICdsaXN0ZW4nIGZvciB0aGlzIHRhcmdldC5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhlc2UgdGFyZ2V0cyBtYXkgb3IgbWF5IG5vdCBoYXZlIGJlZW4gc2VudCB0byBvciBhY2tub3dsZWRnZWQgYnkgdGhlXG4gICAgICAgICAqIHNlcnZlci4gT24gcmUtZXN0YWJsaXNoaW5nIHRoZSBsaXN0ZW4gc3RyZWFtLCB0aGVzZSB0YXJnZXRzIHNob3VsZCBiZSBzZW50XG4gICAgICAgICAqIHRvIHRoZSBzZXJ2ZXIuIFRoZSB0YXJnZXRzIHJlbW92ZWQgd2l0aCB1bmxpc3RlbnMgYXJlIHJlbW92ZWQgZWFnZXJseVxuICAgICAgICAgKiB3aXRob3V0IHdhaXRpbmcgZm9yIGNvbmZpcm1hdGlvbiBmcm9tIHRoZSBsaXN0ZW4gc3RyZWFtLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kdSA9IG5ldyBNYXAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBzZXQgb2YgcmVhc29ucyBmb3Igd2h5IHRoZSBSZW1vdGVTdG9yZSBtYXkgYmUgb2ZmbGluZS4gSWYgZW1wdHksIHRoZVxuICAgICAgICAgKiBSZW1vdGVTdG9yZSBtYXkgc3RhcnQgaXRzIG5ldHdvcmsgY29ubmVjdGlvbnMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl91ID0gbmV3IFNldCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFdmVudCBoYW5kbGVycyB0aGF0IGdldCBjYWxsZWQgd2hlbiB0aGUgbmV0d29yayBpcyBkaXNhYmxlZCBvciBlbmFibGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBQT1JUSU5HIE5PVEU6IFRoZXNlIGZ1bmN0aW9ucyBhcmUgdXNlZCBvbiB0aGUgV2ViIGNsaWVudCB0byBjcmVhdGUgdGhlXG4gICAgICAgICAqIHVuZGVybHlpbmcgc3RyZWFtcyAodG8gc3VwcG9ydCB0cmVlLXNoYWtlYWJsZSBzdHJlYW1zKS4gT24gQW5kcm9pZCBhbmQgaU9TLFxuICAgICAgICAgKiB0aGUgc3RyZWFtcyBhcmUgY3JlYXRlZCBkdXJpbmcgY29uc3RydWN0aW9uIG9mIFJlbW90ZVN0b3JlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53dSA9IFtdLCB0aGlzLm11ID0gaSwgdGhpcy5tdS5VcigodCA9PiB7XG4gICAgICAgICAgICBuLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBQb3J0aW5nIE5vdGU6IFVubGlrZSBpT1MsIGByZXN0YXJ0TmV0d29yaygpYCBpcyBjYWxsZWQgZXZlbiB3aGVuIHRoZVxuICAgICAgICAgICAgICAgIC8vIG5ldHdvcmsgYmVjb21lcyB1bnJlYWNoYWJsZSBhcyB3ZSBkb24ndCBoYXZlIGFueSBvdGhlciB3YXkgdG8gdGVhclxuICAgICAgICAgICAgICAgIC8vIGRvd24gb3VyIHN0cmVhbXMuXG4gICAgICAgICAgICAgICAgTXUodGhpcykgJiYgKEMoXCJSZW1vdGVTdG9yZVwiLCBcIlJlc3RhcnRpbmcgc3RyZWFtcyBmb3IgbmV0d29yayByZWFjaGFiaWxpdHkgY2hhbmdlLlwiKSwgXG4gICAgICAgICAgICAgICAgYXdhaXQgYXN5bmMgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gJCh0KTtcbiAgICAgICAgICAgICAgICAgICAgZS5fdS5hZGQoNCAvKiBPZmZsaW5lQ2F1c2UuQ29ubmVjdGl2aXR5Q2hhbmdlICovKSwgYXdhaXQgU3UoZSksIGUuZ3Uuc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pLCBcbiAgICAgICAgICAgICAgICAgICAgZS5fdS5kZWxldGUoNCAvKiBPZmZsaW5lQ2F1c2UuQ29ubmVjdGl2aXR5Q2hhbmdlICovKSwgYXdhaXQgVnUoZSk7XG4gICAgICAgICAgICAgICAgfSh0aGlzKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKSwgdGhpcy5ndSA9IG5ldyBQdShuLCBzKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIFZ1KHQpIHtcbiAgICBpZiAoTXUodCkpIGZvciAoY29uc3QgZSBvZiB0Lnd1KSBhd2FpdCBlKC8qIGVuYWJsZWQ9ICovICEwKTtcbn1cblxuLyoqXG4gKiBUZW1wb3JhcmlseSBkaXNhYmxlcyB0aGUgbmV0d29yay4gVGhlIG5ldHdvcmsgY2FuIGJlIHJlLWVuYWJsZWQgdXNpbmdcbiAqIGVuYWJsZU5ldHdvcmsoKS5cbiAqLyBhc3luYyBmdW5jdGlvbiBTdSh0KSB7XG4gICAgZm9yIChjb25zdCBlIG9mIHQud3UpIGF3YWl0IGUoLyogZW5hYmxlZD0gKi8gITEpO1xufVxuXG4vKipcbiAqIFN0YXJ0cyBuZXcgbGlzdGVuIGZvciB0aGUgZ2l2ZW4gdGFyZ2V0LiBVc2VzIHJlc3VtZSB0b2tlbiBpZiBwcm92aWRlZC4gSXRcbiAqIGlzIGEgbm8tb3AgaWYgdGhlIHRhcmdldCBvZiBnaXZlbiBgVGFyZ2V0RGF0YWAgaXMgYWxyZWFkeSBiZWluZyBsaXN0ZW5lZCB0by5cbiAqL1xuZnVuY3Rpb24gRHUodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgIG4uZHUuaGFzKGUudGFyZ2V0SWQpIHx8IChcbiAgICAvLyBNYXJrIHRoaXMgYXMgc29tZXRoaW5nIHRoZSBjbGllbnQgaXMgY3VycmVudGx5IGxpc3RlbmluZyBmb3IuXG4gICAgbi5kdS5zZXQoZS50YXJnZXRJZCwgZSksIE91KG4pID8gXG4gICAgLy8gVGhlIGxpc3RlbiB3aWxsIGJlIHNlbnQgaW4gb25XYXRjaFN0cmVhbU9wZW5cbiAgICBrdShuKSA6IHRjKG4pLmtvKCkgJiYgeHUobiwgZSkpO1xufVxuXG4vKipcbiAqIFJlbW92ZXMgdGhlIGxpc3RlbiBmcm9tIHNlcnZlci4gSXQgaXMgYSBuby1vcCBpZiB0aGUgZ2l2ZW4gdGFyZ2V0IGlkIGlzXG4gKiBub3QgYmVpbmcgbGlzdGVuZWQgdG8uXG4gKi8gZnVuY3Rpb24gQ3UodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gdGMobik7XG4gICAgbi5kdS5kZWxldGUoZSksIHMua28oKSAmJiBOdShuLCBlKSwgMCA9PT0gbi5kdS5zaXplICYmIChzLmtvKCkgPyBzLkZvKCkgOiBNdShuKSAmJiBcbiAgICAvLyBSZXZlcnQgdG8gT25saW5lU3RhdGUuVW5rbm93biBpZiB0aGUgd2F0Y2ggc3RyZWFtIGlzIG5vdCBvcGVuIGFuZCB3ZVxuICAgIC8vIGhhdmUgbm8gbGlzdGVuZXJzLCBzaW5jZSB3aXRob3V0IGFueSBsaXN0ZW5zIHRvIHNlbmQgd2UgY2Fubm90XG4gICAgLy8gY29uZmlybSBpZiB0aGUgc3RyZWFtIGlzIGhlYWx0aHkgYW5kIHVwZ3JhZGUgdG8gT25saW5lU3RhdGUuT25saW5lLlxuICAgIG4uZ3Uuc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pKTtcbn1cblxuLyoqXG4gKiBXZSBuZWVkIHRvIGluY3JlbWVudCB0aGUgdGhlIGV4cGVjdGVkIG51bWJlciBvZiBwZW5kaW5nIHJlc3BvbnNlcyB3ZSdyZSBkdWVcbiAqIGZyb20gd2F0Y2ggc28gd2Ugd2FpdCBmb3IgdGhlIGFjayB0byBwcm9jZXNzIGFueSBtZXNzYWdlcyBmcm9tIHRoaXMgdGFyZ2V0LlxuICovIGZ1bmN0aW9uIHh1KHQsIGUpIHtcbiAgICB0Lnl1Lk90KGUudGFyZ2V0SWQpLCB0Yyh0KS56byhlKTtcbn1cblxuLyoqXG4gKiBXZSBuZWVkIHRvIGluY3JlbWVudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHBlbmRpbmcgcmVzcG9uc2VzIHdlJ3JlIGR1ZVxuICogZnJvbSB3YXRjaCBzbyB3ZSB3YWl0IGZvciB0aGUgcmVtb3ZhbCBvbiB0aGUgc2VydmVyIGJlZm9yZSB3ZSBwcm9jZXNzIGFueVxuICogbWVzc2FnZXMgZnJvbSB0aGlzIHRhcmdldC5cbiAqLyBmdW5jdGlvbiBOdSh0LCBlKSB7XG4gICAgdC55dS5PdChlKSwgdGModCkuSG8oZSk7XG59XG5cbmZ1bmN0aW9uIGt1KHQpIHtcbiAgICB0Lnl1ID0gbmV3IENzKHtcbiAgICAgICAgZ2V0UmVtb3RlS2V5c0ZvclRhcmdldDogZSA9PiB0LnJlbW90ZVN5bmNlci5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUpLFxuICAgICAgICBuZTogZSA9PiB0LmR1LmdldChlKSB8fCBudWxsXG4gICAgfSksIHRjKHQpLnN0YXJ0KCksIHQuZ3UudXUoKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHdhdGNoIHN0cmVhbSBzaG91bGQgYmUgc3RhcnRlZCBiZWNhdXNlIGl0J3MgbmVjZXNzYXJ5XG4gKiBhbmQgaGFzIG5vdCB5ZXQgYmVlbiBzdGFydGVkLlxuICovIGZ1bmN0aW9uIE91KHQpIHtcbiAgICByZXR1cm4gTXUodCkgJiYgIXRjKHQpLk5vKCkgJiYgdC5kdS5zaXplID4gMDtcbn1cblxuZnVuY3Rpb24gTXUodCkge1xuICAgIHJldHVybiAwID09PSAkKHQpLl91LnNpemU7XG59XG5cbmZ1bmN0aW9uIEZ1KHQpIHtcbiAgICB0Lnl1ID0gdm9pZCAwO1xufVxuXG5hc3luYyBmdW5jdGlvbiAkdSh0KSB7XG4gICAgdC5kdS5mb3JFYWNoKCgoZSwgbikgPT4ge1xuICAgICAgICB4dSh0LCBlKTtcbiAgICB9KSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIEJ1KHQsIGUpIHtcbiAgICBGdSh0KSwgXG4gICAgLy8gSWYgd2Ugc3RpbGwgbmVlZCB0aGUgd2F0Y2ggc3RyZWFtLCByZXRyeSB0aGUgY29ubmVjdGlvbi5cbiAgICBPdSh0KSA/ICh0Lmd1Lmh1KGUpLCBrdSh0KSkgOiBcbiAgICAvLyBObyBuZWVkIHRvIHJlc3RhcnQgd2F0Y2ggc3RyZWFtIGJlY2F1c2UgdGhlcmUgYXJlIG5vIGFjdGl2ZSB0YXJnZXRzLlxuICAgIC8vIFRoZSBvbmxpbmUgc3RhdGUgaXMgc2V0IHRvIHVua25vd24gYmVjYXVzZSB0aGVyZSBpcyBubyBhY3RpdmUgYXR0ZW1wdFxuICAgIC8vIGF0IGVzdGFibGlzaGluZyBhIGNvbm5lY3Rpb25cbiAgICB0Lmd1LnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gTHUodCwgZSwgbikge1xuICAgIGlmIChcbiAgICAvLyBNYXJrIHRoZSBjbGllbnQgYXMgb25saW5lIHNpbmNlIHdlIGdvdCBhIG1lc3NhZ2UgZnJvbSB0aGUgc2VydmVyXG4gICAgdC5ndS5zZXQoXCJPbmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PbmxpbmUgKi8pLCBlIGluc3RhbmNlb2YgU3MgJiYgMiAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlbW92ZWQgKi8gPT09IGUuc3RhdGUgJiYgZS5jYXVzZSkgXG4gICAgLy8gVGhlcmUgd2FzIGFuIGVycm9yIG9uIGEgdGFyZ2V0LCBkb24ndCB3YWl0IGZvciBhIGNvbnNpc3RlbnQgc25hcHNob3RcbiAgICAvLyB0byByYWlzZSBldmVudHNcbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBcbiAgICAgICAgLyoqIEhhbmRsZXMgYW4gZXJyb3Igb24gYSB0YXJnZXQgKi9cbiAgICAgICAgYXN5bmMgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IGUuY2F1c2U7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHMgb2YgZS50YXJnZXRJZHMpIFxuICAgICAgICAgICAgLy8gQSB3YXRjaGVkIHRhcmdldCBtaWdodCBoYXZlIGJlZW4gcmVtb3ZlZCBhbHJlYWR5LlxuICAgICAgICAgICAgdC5kdS5oYXMocykgJiYgKGF3YWl0IHQucmVtb3RlU3luY2VyLnJlamVjdExpc3RlbihzLCBuKSwgdC5kdS5kZWxldGUocyksIHQueXUucmVtb3ZlVGFyZ2V0KHMpKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEF0dGVtcHRzIHRvIGZpbGwgb3VyIHdyaXRlIHBpcGVsaW5lIHdpdGggd3JpdGVzIGZyb20gdGhlIExvY2FsU3RvcmUuXG4gKlxuICogQ2FsbGVkIGludGVybmFsbHkgdG8gYm9vdHN0cmFwIG9yIHJlZmlsbCB0aGUgd3JpdGUgcGlwZWxpbmUgYW5kIGJ5XG4gKiBTeW5jRW5naW5lIHdoZW5ldmVyIHRoZXJlIGFyZSBuZXcgbXV0YXRpb25zIHRvIHByb2Nlc3MuXG4gKlxuICogU3RhcnRzIHRoZSB3cml0ZSBzdHJlYW0gaWYgbmVjZXNzYXJ5LlxuICovICh0LCBlKTtcbiAgICB9IGNhdGNoIChuKSB7XG4gICAgICAgIEMoXCJSZW1vdGVTdG9yZVwiLCBcIkZhaWxlZCB0byByZW1vdmUgdGFyZ2V0cyAlczogJXMgXCIsIGUudGFyZ2V0SWRzLmpvaW4oXCIsXCIpLCBuKSwgXG4gICAgICAgIGF3YWl0IHF1KHQsIG4pO1xuICAgIH0gZWxzZSBpZiAoZSBpbnN0YW5jZW9mIHZzID8gdC55dS5LdChlKSA6IGUgaW5zdGFuY2VvZiBWcyA/IHQueXUuSnQoZSkgOiB0Lnl1Lmp0KGUpLCBcbiAgICAhbi5pc0VxdWFsKHN0Lm1pbigpKSkgdHJ5IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IEdvKHQubG9jYWxTdG9yZSk7XG4gICAgICAgIG4uY29tcGFyZVRvKGUpID49IDAgJiYgXG4gICAgICAgIC8vIFdlIGhhdmUgcmVjZWl2ZWQgYSB0YXJnZXQgY2hhbmdlIHdpdGggYSBnbG9iYWwgc25hcHNob3QgaWYgdGhlIHNuYXBzaG90XG4gICAgICAgIC8vIHZlcnNpb24gaXMgbm90IGVxdWFsIHRvIFNuYXBzaG90VmVyc2lvbi5taW4oKS5cbiAgICAgICAgYXdhaXQgXG4gICAgICAgIC8qKlxuICogVGFrZXMgYSBiYXRjaCBvZiBjaGFuZ2VzIGZyb20gdGhlIERhdGFzdG9yZSwgcmVwYWNrYWdlcyB0aGVtIGFzIGFcbiAqIFJlbW90ZUV2ZW50LCBhbmQgcGFzc2VzIHRoYXQgb24gdG8gdGhlIGxpc3RlbmVyLCB3aGljaCBpcyB0eXBpY2FsbHkgdGhlXG4gKiBTeW5jRW5naW5lLlxuICovXG4gICAgICAgIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0Lnl1Llp0KGUpO1xuICAgICAgICAgICAgLy8gVXBkYXRlIGluLW1lbW9yeSByZXN1bWUgdG9rZW5zLiBMb2NhbFN0b3JlIHdpbGwgdXBkYXRlIHRoZVxuICAgICAgICAgICAgLy8gcGVyc2lzdGVudCB2aWV3IG9mIHRoZXNlIHdoZW4gYXBwbHlpbmcgdGhlIGNvbXBsZXRlZCBSZW1vdGVFdmVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuLnRhcmdldENoYW5nZXMuZm9yRWFjaCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobi5yZXN1bWVUb2tlbi5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSB0LmR1LmdldChzKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQSB3YXRjaGVkIHRhcmdldCBtaWdodCBoYXZlIGJlZW4gcmVtb3ZlZCBhbHJlYWR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgJiYgdC5kdS5zZXQocywgaS53aXRoUmVzdW1lVG9rZW4obi5yZXN1bWVUb2tlbiwgZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKSwgXG4gICAgICAgICAgICAvLyBSZS1lc3RhYmxpc2ggbGlzdGVucyBmb3IgdGhlIHRhcmdldHMgdGhhdCBoYXZlIGJlZW4gaW52YWxpZGF0ZWQgYnlcbiAgICAgICAgICAgIC8vIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2hlcy5cbiAgICAgICAgICAgIG4udGFyZ2V0TWlzbWF0Y2hlcy5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gdC5kdS5nZXQoZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFuKSBcbiAgICAgICAgICAgICAgICAvLyBBIHdhdGNoZWQgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIC8vIENsZWFyIHRoZSByZXN1bWUgdG9rZW4gZm9yIHRoZSB0YXJnZXQsIHNpbmNlIHdlJ3JlIGluIGEga25vd24gbWlzbWF0Y2hcbiAgICAgICAgICAgICAgICAvLyBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC5kdS5zZXQoZSwgbi53aXRoUmVzdW1lVG9rZW4oUXQuRU1QVFlfQllURV9TVFJJTkcsIG4uc25hcHNob3RWZXJzaW9uKSksIFxuICAgICAgICAgICAgICAgIC8vIENhdXNlIGEgaGFyZCByZXNldCBieSB1bndhdGNoaW5nIGFuZCByZXdhdGNoaW5nIGltbWVkaWF0ZWx5LCBidXRcbiAgICAgICAgICAgICAgICAvLyBkZWxpYmVyYXRlbHkgZG9uJ3Qgc2VuZCBhIHJlc3VtZSB0b2tlbiBzbyB0aGF0IHdlIGdldCBhIGZ1bGwgdXBkYXRlLlxuICAgICAgICAgICAgICAgIE51KHQsIGUpO1xuICAgICAgICAgICAgICAgIC8vIE1hcmsgdGhlIHRhcmdldCB3ZSBzZW5kIGFzIGJlaW5nIG9uIGJlaGFsZiBvZiBhbiBleGlzdGVuY2UgZmlsdGVyXG4gICAgICAgICAgICAgICAgLy8gbWlzbWF0Y2gsIGJ1dCBkb24ndCBhY3R1YWxseSByZXRhaW4gdGhhdCBpbiBsaXN0ZW5UYXJnZXRzLiBUaGlzIGVuc3VyZXNcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHdlIGZsYWcgdGhlIGZpcnN0IHJlLWxpc3RlbiB0aGlzIHdheSB3aXRob3V0IGltcGFjdGluZyBmdXR1cmVcbiAgICAgICAgICAgICAgICAvLyBsaXN0ZW5zIG9mIHRoaXMgdGFyZ2V0ICh0aGF0IG1pZ2h0IGhhcHBlbiBlLmcuIG9uIHJlY29ubmVjdCkuXG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyB6aShuLnRhcmdldCwgZSwgMSAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoICovICwgbi5zZXF1ZW5jZU51bWJlcik7XG4gICAgICAgICAgICAgICAgeHUodCwgcyk7XG4gICAgICAgICAgICB9KSksIHQucmVtb3RlU3luY2VyLmFwcGx5UmVtb3RlRXZlbnQobik7XG4gICAgICAgIH0odCwgbik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBDKFwiUmVtb3RlU3RvcmVcIiwgXCJGYWlsZWQgdG8gcmFpc2Ugc25hcHNob3Q6XCIsIGUpLCBhd2FpdCBxdSh0LCBlKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVjb3ZlcnkgbG9naWMgZm9yIEluZGV4ZWREQiBlcnJvcnMgdGhhdCB0YWtlcyB0aGUgbmV0d29yayBvZmZsaW5lIHVudGlsXG4gKiBgb3BgIHN1Y2NlZWRzLiBSZXRyaWVzIGFyZSBzY2hlZHVsZWQgd2l0aCBiYWNrb2ZmIHVzaW5nXG4gKiBgZW5xdWV1ZVJldHJ5YWJsZSgpYC4gSWYgYG9wKClgIGlzIG5vdCBwcm92aWRlZCwgSW5kZXhlZERCIGFjY2VzcyBpc1xuICogdmFsaWRhdGVkIHZpYSBhIGdlbmVyaWMgb3BlcmF0aW9uLlxuICpcbiAqIFRoZSByZXR1cm5lZCBQcm9taXNlIGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQgYW5kIGJlZm9yZVxuICogYW55IHJldHJ5IGF0dGVtcHQuXG4gKi8gYXN5bmMgZnVuY3Rpb24gcXUodCwgZSwgbikge1xuICAgIGlmICghVnQoZSkpIHRocm93IGU7XG4gICAgdC5fdS5hZGQoMSAvKiBPZmZsaW5lQ2F1c2UuSW5kZXhlZERiRmFpbGVkICovKSwgXG4gICAgLy8gRGlzYWJsZSBuZXR3b3JrIGFuZCByYWlzZSBvZmZsaW5lIHNuYXBzaG90c1xuICAgIGF3YWl0IFN1KHQpLCB0Lmd1LnNldChcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovKSwgbiB8fCAoXG4gICAgLy8gVXNlIGEgc2ltcGxlIHJlYWQgb3BlcmF0aW9uIHRvIGRldGVybWluZSBpZiBJbmRleGVkREIgcmVjb3ZlcmVkLlxuICAgIC8vIElkZWFsbHksIHdlIHdvdWxkIGV4cG9zZSBhIGhlYWx0aCBjaGVjayBkaXJlY3RseSBvbiBTaW1wbGVEYiwgYnV0XG4gICAgLy8gUmVtb3RlU3RvcmUgb25seSBoYXMgYWNjZXNzIHRvIHBlcnNpc3RlbmNlIHRocm91Z2ggTG9jYWxTdG9yZS5cbiAgICBuID0gKCkgPT4gR28odC5sb2NhbFN0b3JlKSksIFxuICAgIC8vIFByb2JlIEluZGV4ZWREQiBwZXJpb2RpY2FsbHkgYW5kIHJlLWVuYWJsZSBuZXR3b3JrXG4gICAgdC5hc3luY1F1ZXVlLmVucXVldWVSZXRyeWFibGUoKGFzeW5jICgpID0+IHtcbiAgICAgICAgQyhcIlJlbW90ZVN0b3JlXCIsIFwiUmV0cnlpbmcgSW5kZXhlZERCIGFjY2Vzc1wiKSwgYXdhaXQgbigpLCB0Ll91LmRlbGV0ZSgxIC8qIE9mZmxpbmVDYXVzZS5JbmRleGVkRGJGYWlsZWQgKi8pLCBcbiAgICAgICAgYXdhaXQgVnUodCk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIGBvcGAuIElmIGBvcGAgZmFpbHMsIHRha2VzIHRoZSBuZXR3b3JrIG9mZmxpbmUgdW50aWwgYG9wYFxuICogc3VjY2VlZHMuIFJldHVybnMgYWZ0ZXIgdGhlIGZpcnN0IGF0dGVtcHQuXG4gKi8gZnVuY3Rpb24gVXUodCwgZSkge1xuICAgIHJldHVybiBlKCkuY2F0Y2goKG4gPT4gcXUodCwgbiwgZSkpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gS3UodCkge1xuICAgIGNvbnN0IGUgPSAkKHQpLCBuID0gZWMoZSk7XG4gICAgbGV0IHMgPSBlLmZ1Lmxlbmd0aCA+IDAgPyBlLmZ1W2UuZnUubGVuZ3RoIC0gMV0uYmF0Y2hJZCA6IC0xO1xuICAgIGZvciAoO0d1KGUpOyApIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBXbyhlLmxvY2FsU3RvcmUsIHMpO1xuICAgICAgICBpZiAobnVsbCA9PT0gdCkge1xuICAgICAgICAgICAgMCA9PT0gZS5mdS5sZW5ndGggJiYgbi5GbygpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcyA9IHQuYmF0Y2hJZCwgUXUoZSwgdCk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBhd2FpdCBxdShlLCB0KTtcbiAgICB9XG4gICAganUoZSkgJiYgV3UoZSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHdlIGNhbiBhZGQgdG8gdGhlIHdyaXRlIHBpcGVsaW5lIChpLmUuIHRoZSBuZXR3b3JrIGlzXG4gKiBlbmFibGVkIGFuZCB0aGUgd3JpdGUgcGlwZWxpbmUgaXMgbm90IGZ1bGwpLlxuICovIGZ1bmN0aW9uIEd1KHQpIHtcbiAgICByZXR1cm4gTXUodCkgJiYgdC5mdS5sZW5ndGggPCAxMDtcbn1cblxuLyoqXG4gKiBRdWV1ZXMgYWRkaXRpb25hbCB3cml0ZXMgdG8gYmUgc2VudCB0byB0aGUgd3JpdGUgc3RyZWFtLCBzZW5kaW5nIHRoZW1cbiAqIGltbWVkaWF0ZWx5IGlmIHRoZSB3cml0ZSBzdHJlYW0gaXMgZXN0YWJsaXNoZWQuXG4gKi8gZnVuY3Rpb24gUXUodCwgZSkge1xuICAgIHQuZnUucHVzaChlKTtcbiAgICBjb25zdCBuID0gZWModCk7XG4gICAgbi5rbygpICYmIG4uWW8gJiYgbi5YbyhlLm11dGF0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGp1KHQpIHtcbiAgICByZXR1cm4gTXUodCkgJiYgIWVjKHQpLk5vKCkgJiYgdC5mdS5sZW5ndGggPiAwO1xufVxuXG5mdW5jdGlvbiBXdSh0KSB7XG4gICAgZWModCkuc3RhcnQoKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24genUodCkge1xuICAgIGVjKHQpLmV1KCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIEh1KHQpIHtcbiAgICBjb25zdCBlID0gZWModCk7XG4gICAgLy8gU2VuZCB0aGUgd3JpdGUgcGlwZWxpbmUgbm93IHRoYXQgdGhlIHN0cmVhbSBpcyBlc3RhYmxpc2hlZC5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIHQuZnUpIGUuWG8obi5tdXRhdGlvbnMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBKdSh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IHQuZnUuc2hpZnQoKSwgaSA9IGppLmZyb20ocywgZSwgbik7XG4gICAgYXdhaXQgVXUodCwgKCgpID0+IHQucmVtb3RlU3luY2VyLmFwcGx5U3VjY2Vzc2Z1bFdyaXRlKGkpKSksIFxuICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aXRoIHRoZSBjb21wbGV0aW9uIG9mIHRoaXMgbXV0YXRpb24gYW5vdGhlclxuICAgIC8vIHNsb3QgaGFzIGZyZWVkIHVwLlxuICAgIGF3YWl0IEt1KHQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBZdSh0LCBlKSB7XG4gICAgLy8gSWYgdGhlIHdyaXRlIHN0cmVhbSBjbG9zZWQgYWZ0ZXIgdGhlIHdyaXRlIGhhbmRzaGFrZSBjb21wbGV0ZXMsIGEgd3JpdGVcbiAgICAvLyBvcGVyYXRpb24gZmFpbGVkIGFuZCB3ZSBmYWlsIHRoZSBwZW5kaW5nIG9wZXJhdGlvbi5cbiAgICBlICYmIGVjKHQpLllvICYmIFxuICAgIC8vIFRoaXMgZXJyb3IgYWZmZWN0cyB0aGUgYWN0dWFsIHdyaXRlLlxuICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgLy8gT25seSBoYW5kbGUgcGVybWFuZW50IGVycm9ycyBoZXJlLiBJZiBpdCdzIHRyYW5zaWVudCwganVzdCBsZXQgdGhlIHJldHJ5XG4gICAgICAgIC8vIGxvZ2ljIGtpY2sgaW4uXG4gICAgICAgIGlmIChuID0gZS5jb2RlLCBhcyhuKSAmJiBuICE9PSBCLkFCT1JURUQpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgd2FzIGEgcGVybWFuZW50IGVycm9yLCB0aGUgcmVxdWVzdCBpdHNlbGYgd2FzIHRoZSBwcm9ibGVtXG4gICAgICAgICAgICAvLyBzbyBpdCdzIG5vdCBnb2luZyB0byBzdWNjZWVkIGlmIHdlIHJlc2VuZCBpdC5cbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmZ1LnNoaWZ0KCk7XG4gICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2UgaXQncyBhbHNvIHVubGlrZWx5IHRoYXQgdGhlIHNlcnZlciBpdHNlbGYgaXMgbWVsdGluZ1xuICAgICAgICAgICAgLy8gZG93biAtLSB0aGlzIHdhcyBqdXN0IGEgYmFkIHJlcXVlc3Qgc28gaW5oaWJpdCBiYWNrb2ZmIG9uIHRoZSBuZXh0XG4gICAgICAgICAgICAvLyByZXN0YXJ0LlxuICAgICAgICAgICAgICAgICAgICAgICAgZWModCkuTW8oKSwgYXdhaXQgVXUodCwgKCgpID0+IHQucmVtb3RlU3luY2VyLnJlamVjdEZhaWxlZFdyaXRlKG4uYmF0Y2hJZCwgZSkpKSwgXG4gICAgICAgICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2l0aCB0aGUgY29tcGxldGlvbiBvZiB0aGlzIG11dGF0aW9uXG4gICAgICAgICAgICAvLyBhbm90aGVyIHNsb3QgaGFzIGZyZWVkIHVwLlxuICAgICAgICAgICAgYXdhaXQgS3UodCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG47XG4gICAgfSh0LCBlKSwgXG4gICAgLy8gVGhlIHdyaXRlIHN0cmVhbSBtaWdodCBoYXZlIGJlZW4gc3RhcnRlZCBieSByZWZpbGxpbmcgdGhlIHdyaXRlXG4gICAgLy8gcGlwZWxpbmUgZm9yIGZhaWxlZCB3cml0ZXNcbiAgICBqdSh0KSAmJiBXdSh0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gWHUodCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgIG4uYXN5bmNRdWV1ZS52ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCksIEMoXCJSZW1vdGVTdG9yZVwiLCBcIlJlbW90ZVN0b3JlIHJlY2VpdmVkIG5ldyBjcmVkZW50aWFsc1wiKTtcbiAgICBjb25zdCBzID0gTXUobik7XG4gICAgLy8gVGVhciBkb3duIGFuZCByZS1jcmVhdGUgb3VyIG5ldHdvcmsgc3RyZWFtcy4gVGhpcyB3aWxsIGVuc3VyZSB3ZSBnZXQgYVxuICAgIC8vIGZyZXNoIGF1dGggdG9rZW4gZm9yIHRoZSBuZXcgdXNlciBhbmQgcmUtZmlsbCB0aGUgd3JpdGUgcGlwZWxpbmUgd2l0aFxuICAgIC8vIG5ldyBtdXRhdGlvbnMgZnJvbSB0aGUgTG9jYWxTdG9yZSAoc2luY2UgbXV0YXRpb25zIGFyZSBwZXItdXNlcikuXG4gICAgICAgIG4uX3UuYWRkKDMgLyogT2ZmbGluZUNhdXNlLkNyZWRlbnRpYWxDaGFuZ2UgKi8pLCBhd2FpdCBTdShuKSwgcyAmJiBcbiAgICAvLyBEb24ndCBzZXQgdGhlIG5ldHdvcmsgc3RhdHVzIHRvIFVua25vd24gaWYgd2UgYXJlIG9mZmxpbmUuXG4gICAgbi5ndS5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyksIGF3YWl0IG4ucmVtb3RlU3luY2VyLmhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UoZSksIFxuICAgIG4uX3UuZGVsZXRlKDMgLyogT2ZmbGluZUNhdXNlLkNyZWRlbnRpYWxDaGFuZ2UgKi8pLCBhd2FpdCBWdShuKTtcbn1cblxuLyoqXG4gKiBUb2dnbGVzIHRoZSBuZXR3b3JrIHN0YXRlIHdoZW4gdGhlIGNsaWVudCBnYWlucyBvciBsb3NlcyBpdHMgcHJpbWFyeSBsZWFzZS5cbiAqLyBhc3luYyBmdW5jdGlvbiBadSh0LCBlKSB7XG4gICAgY29uc3QgbiA9ICQodCk7XG4gICAgZSA/IChuLl91LmRlbGV0ZSgyIC8qIE9mZmxpbmVDYXVzZS5Jc1NlY29uZGFyeSAqLyksIGF3YWl0IFZ1KG4pKSA6IGUgfHwgKG4uX3UuYWRkKDIgLyogT2ZmbGluZUNhdXNlLklzU2Vjb25kYXJ5ICovKSwgXG4gICAgYXdhaXQgU3UobiksIG4uZ3Uuc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pKTtcbn1cblxuLyoqXG4gKiBJZiBub3QgeWV0IGluaXRpYWxpemVkLCByZWdpc3RlcnMgdGhlIFdhdGNoU3RyZWFtIGFuZCBpdHMgbmV0d29yayBzdGF0ZVxuICogY2FsbGJhY2sgd2l0aCBgcmVtb3RlU3RvcmVJbXBsYC4gUmV0dXJucyB0aGUgZXhpc3Rpbmcgc3RyZWFtIGlmIG9uZSBpc1xuICogYWxyZWFkeSBhdmFpbGFibGUuXG4gKlxuICogUE9SVElORyBOT1RFOiBPbiBpT1MgYW5kIEFuZHJvaWQsIHRoZSBXYXRjaFN0cmVhbSBnZXRzIHJlZ2lzdGVyZWQgb24gc3RhcnR1cC5cbiAqIFRoaXMgaXMgbm90IGRvbmUgb24gV2ViIHRvIGFsbG93IGl0IHRvIGJlIHRyZWUtc2hha2VuLlxuICovIGZ1bmN0aW9uIHRjKHQpIHtcbiAgICByZXR1cm4gdC5wdSB8fCAoXG4gICAgLy8gQ3JlYXRlIHN0cmVhbSAoYnV0IG5vdGUgdGhhdCBpdCBpcyBub3Qgc3RhcnRlZCB5ZXQpLlxuICAgIHQucHUgPSBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSAkKHQpO1xuICAgICAgICByZXR1cm4gcy5zdSgpLCBuZXcgRXUoZSwgcy5jb25uZWN0aW9uLCBzLmF1dGhDcmVkZW50aWFscywgcy5hcHBDaGVja0NyZWRlbnRpYWxzLCBzLnl0LCBuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKHQuZGF0YXN0b3JlLCB0LmFzeW5jUXVldWUsIHtcbiAgICAgICAgWXI6ICR1LmJpbmQobnVsbCwgdCksXG4gICAgICAgIFpyOiBCdS5iaW5kKG51bGwsIHQpLFxuICAgICAgICBXbzogTHUuYmluZChudWxsLCB0KVxuICAgIH0pLCB0Lnd1LnB1c2goKGFzeW5jIGUgPT4ge1xuICAgICAgICBlID8gKHQucHUuTW8oKSwgT3UodCkgPyBrdSh0KSA6IHQuZ3Uuc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pKSA6IChhd2FpdCB0LnB1LnN0b3AoKSwgXG4gICAgICAgIEZ1KHQpKTtcbiAgICB9KSkpLCB0LnB1O1xufVxuXG4vKipcbiAqIElmIG5vdCB5ZXQgaW5pdGlhbGl6ZWQsIHJlZ2lzdGVycyB0aGUgV3JpdGVTdHJlYW0gYW5kIGl0cyBuZXR3b3JrIHN0YXRlXG4gKiBjYWxsYmFjayB3aXRoIGByZW1vdGVTdG9yZUltcGxgLiBSZXR1cm5zIHRoZSBleGlzdGluZyBzdHJlYW0gaWYgb25lIGlzXG4gKiBhbHJlYWR5IGF2YWlsYWJsZS5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IE9uIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdyaXRlU3RyZWFtIGdldHMgcmVnaXN0ZXJlZCBvbiBzdGFydHVwLlxuICogVGhpcyBpcyBub3QgZG9uZSBvbiBXZWIgdG8gYWxsb3cgaXQgdG8gYmUgdHJlZS1zaGFrZW4uXG4gKi8gZnVuY3Rpb24gZWModCkge1xuICAgIHJldHVybiB0Lkl1IHx8IChcbiAgICAvLyBDcmVhdGUgc3RyZWFtIChidXQgbm90ZSB0aGF0IGl0IGlzIG5vdCBzdGFydGVkIHlldCkuXG4gICAgdC5JdSA9IGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgY29uc3QgcyA9ICQodCk7XG4gICAgICAgIHJldHVybiBzLnN1KCksIG5ldyBBdShlLCBzLmNvbm5lY3Rpb24sIHMuYXV0aENyZWRlbnRpYWxzLCBzLmFwcENoZWNrQ3JlZGVudGlhbHMsIHMueXQsIG4pO1xuICAgIH0odC5kYXRhc3RvcmUsIHQuYXN5bmNRdWV1ZSwge1xuICAgICAgICBZcjogenUuYmluZChudWxsLCB0KSxcbiAgICAgICAgWnI6IFl1LmJpbmQobnVsbCwgdCksXG4gICAgICAgIHR1OiBIdS5iaW5kKG51bGwsIHQpLFxuICAgICAgICBabzogSnUuYmluZChudWxsLCB0KVxuICAgIH0pLCB0Lnd1LnB1c2goKGFzeW5jIGUgPT4ge1xuICAgICAgICBlID8gKHQuSXUuTW8oKSwgXG4gICAgICAgIC8vIFRoaXMgd2lsbCBzdGFydCB0aGUgd3JpdGUgc3RyZWFtIGlmIG5lY2Vzc2FyeS5cbiAgICAgICAgYXdhaXQgS3UodCkpIDogKGF3YWl0IHQuSXUuc3RvcCgpLCB0LmZ1Lmxlbmd0aCA+IDAgJiYgKEMoXCJSZW1vdGVTdG9yZVwiLCBgU3RvcHBpbmcgd3JpdGUgc3RyZWFtIHdpdGggJHt0LmZ1Lmxlbmd0aH0gcGVuZGluZyB3cml0ZXNgKSwgXG4gICAgICAgIHQuZnUgPSBbXSkpO1xuICAgIH0pKSksIHQuSXU7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gb3BlcmF0aW9uIHNjaGVkdWxlZCB0byBiZSBydW4gaW4gdGhlIGZ1dHVyZSBvbiBhbiBBc3luY1F1ZXVlLlxuICpcbiAqIEl0IGlzIGNyZWF0ZWQgdmlhIERlbGF5ZWRPcGVyYXRpb24uY3JlYXRlQW5kU2NoZWR1bGUoKS5cbiAqXG4gKiBTdXBwb3J0cyBjYW5jZWxsYXRpb24gKHZpYSBjYW5jZWwoKSkgYW5kIGVhcmx5IGV4ZWN1dGlvbiAodmlhIHNraXBEZWxheSgpKS5cbiAqXG4gKiBOb3RlOiBXZSBpbXBsZW1lbnQgYFByb21pc2VMaWtlYCBpbnN0ZWFkIG9mIGBQcm9taXNlYCwgYXMgdGhlIGBQcm9taXNlYCB0eXBlXG4gKiBpbiBuZXdlciB2ZXJzaW9ucyBvZiBUeXBlU2NyaXB0IGRlZmluZXMgYGZpbmFsbHlgLCB3aGljaCBpcyBub3QgYXZhaWxhYmxlIGluXG4gKiBJRS5cbiAqL1xuY2xhc3MgbmMge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gdCwgdGhpcy50aW1lcklkID0gZSwgdGhpcy50YXJnZXRUaW1lTXMgPSBuLCB0aGlzLm9wID0gcywgdGhpcy5yZW1vdmFsQ2FsbGJhY2sgPSBpLCBcbiAgICAgICAgdGhpcy5kZWZlcnJlZCA9IG5ldyBxLCB0aGlzLnRoZW4gPSB0aGlzLmRlZmVycmVkLnByb21pc2UudGhlbi5iaW5kKHRoaXMuZGVmZXJyZWQucHJvbWlzZSksIFxuICAgICAgICAvLyBJdCdzIG5vcm1hbCBmb3IgdGhlIGRlZmVycmVkIHByb21pc2UgdG8gYmUgY2FuY2VsZWQgKGR1ZSB0byBjYW5jZWxsYXRpb24pXG4gICAgICAgIC8vIGFuZCBzbyB3ZSBhdHRhY2ggYSBkdW1teSBjYXRjaCBjYWxsYmFjayB0byBhdm9pZFxuICAgICAgICAvLyAnVW5oYW5kbGVkUHJvbWlzZVJlamVjdGlvbldhcm5pbmcnIGxvZyBzcGFtLlxuICAgICAgICB0aGlzLmRlZmVycmVkLnByb21pc2UuY2F0Y2goKHQgPT4ge30pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIERlbGF5ZWRPcGVyYXRpb24gdGhhdCBoYXMgYmVlbiBzY2hlZHVsZWQgdG8gYmVcbiAgICAgKiBleGVjdXRlZCBvbiB0aGUgcHJvdmlkZWQgYXN5bmNRdWV1ZSBhZnRlciB0aGUgcHJvdmlkZWQgZGVsYXlNcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhc3luY1F1ZXVlIC0gVGhlIHF1ZXVlIHRvIHNjaGVkdWxlIHRoZSBvcGVyYXRpb24gb24uXG4gICAgICogQHBhcmFtIGlkIC0gQSBUaW1lciBJRCBpZGVudGlmeWluZyB0aGUgdHlwZSBvZiBvcGVyYXRpb24gdGhpcyBpcy5cbiAgICAgKiBAcGFyYW0gZGVsYXlNcyAtIFRoZSBkZWxheSAobXMpIGJlZm9yZSB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBzY2hlZHVsZWQuXG4gICAgICogQHBhcmFtIG9wIC0gVGhlIG9wZXJhdGlvbiB0byBydW4uXG4gICAgICogQHBhcmFtIHJlbW92YWxDYWxsYmFjayAtIEEgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgb25jZSB0aGVcbiAgICAgKiAgIG9wZXJhdGlvbiBpcyBleGVjdXRlZCBvciBjYW5jZWxlZCwgbm90aWZ5aW5nIHRoZSBBc3luY1F1ZXVlIHRvIHJlbW92ZSBpdFxuICAgICAqICAgZnJvbSBpdHMgZGVsYXllZE9wZXJhdGlvbnMgbGlzdC5cbiAgICAgKiAgIFBPUlRJTkcgTk9URTogVGhpcyBleGlzdHMgdG8gcHJldmVudCBtYWtpbmcgcmVtb3ZlRGVsYXllZE9wZXJhdGlvbigpIGFuZFxuICAgICAqICAgdGhlIERlbGF5ZWRPcGVyYXRpb24gY2xhc3MgcHVibGljLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlQW5kU2NoZWR1bGUodCwgZSwgbiwgcywgaSkge1xuICAgICAgICBjb25zdCByID0gRGF0ZS5ub3coKSArIG4sIG8gPSBuZXcgbmModCwgZSwgciwgcywgaSk7XG4gICAgICAgIHJldHVybiBvLnN0YXJ0KG4pLCBvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydHMgdGhlIHRpbWVyLiBUaGlzIGlzIGNhbGxlZCBpbW1lZGlhdGVseSBhZnRlciBjb25zdHJ1Y3Rpb24gYnlcbiAgICAgKiBjcmVhdGVBbmRTY2hlZHVsZSgpLlxuICAgICAqLyAgICBzdGFydCh0KSB7XG4gICAgICAgIHRoaXMudGltZXJIYW5kbGUgPSBzZXRUaW1lb3V0KCgoKSA9PiB0aGlzLmhhbmRsZURlbGF5RWxhcHNlZCgpKSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFF1ZXVlcyB0aGUgb3BlcmF0aW9uIHRvIHJ1biBpbW1lZGlhdGVseSAoaWYgaXQgaGFzbid0IGFscmVhZHkgYmVlbiBydW4gb3JcbiAgICAgKiBjYW5jZWxlZCkuXG4gICAgICovICAgIHNraXBEZWxheSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRGVsYXlFbGFwc2VkKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbmNlbHMgdGhlIG9wZXJhdGlvbiBpZiBpdCBoYXNuJ3QgYWxyZWFkeSBiZWVuIGV4ZWN1dGVkIG9yIGNhbmNlbGVkLiBUaGVcbiAgICAgKiBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQuXG4gICAgICpcbiAgICAgKiBBcyBsb25nIGFzIHRoZSBvcGVyYXRpb24gaGFzIG5vdCB5ZXQgYmVlbiBydW4sIGNhbGxpbmcgY2FuY2VsKCkgcHJvdmlkZXMgYVxuICAgICAqIGd1YXJhbnRlZSB0aGF0IHRoZSBvcGVyYXRpb24gd2lsbCBub3QgYmUgcnVuLlxuICAgICAqLyAgICBjYW5jZWwodCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLnRpbWVySGFuZGxlICYmICh0aGlzLmNsZWFyVGltZW91dCgpLCB0aGlzLmRlZmVycmVkLnJlamVjdChuZXcgTChCLkNBTkNFTExFRCwgXCJPcGVyYXRpb24gY2FuY2VsbGVkXCIgKyAodCA/IFwiOiBcIiArIHQgOiBcIlwiKSkpKTtcbiAgICB9XG4gICAgaGFuZGxlRGVsYXlFbGFwc2VkKCkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gbnVsbCAhPT0gdGhpcy50aW1lckhhbmRsZSA/ICh0aGlzLmNsZWFyVGltZW91dCgpLCBcbiAgICAgICAgdGhpcy5vcCgpLnRoZW4oKHQgPT4gdGhpcy5kZWZlcnJlZC5yZXNvbHZlKHQpKSkpIDogUHJvbWlzZS5yZXNvbHZlKCkpKTtcbiAgICB9XG4gICAgY2xlYXJUaW1lb3V0KCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLnRpbWVySGFuZGxlICYmICh0aGlzLnJlbW92YWxDYWxsYmFjayh0aGlzKSwgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJIYW5kbGUpLCBcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgRmlyZXN0b3JlRXJyb3IgdGhhdCBjYW4gYmUgc3VyZmFjZWQgdG8gdGhlIHVzZXIgaWYgdGhlIHByb3ZpZGVkXG4gKiBlcnJvciBpcyBhbiBJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yLiBSZS10aHJvd3MgdGhlIGVycm9yIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBzYyh0LCBlKSB7XG4gICAgaWYgKHgoXCJBc3luY1F1ZXVlXCIsIGAke2V9OiAke3R9YCksIFZ0KHQpKSByZXR1cm4gbmV3IEwoQi5VTkFWQUlMQUJMRSwgYCR7ZX06ICR7dH1gKTtcbiAgICB0aHJvdyB0O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEb2N1bWVudFNldCBpcyBhbiBpbW11dGFibGUgKGNvcHktb24td3JpdGUpIGNvbGxlY3Rpb24gdGhhdCBob2xkcyBkb2N1bWVudHNcbiAqIGluIG9yZGVyIHNwZWNpZmllZCBieSB0aGUgcHJvdmlkZWQgY29tcGFyYXRvci4gV2UgYWx3YXlzIGFkZCBhIGRvY3VtZW50IGtleVxuICogY29tcGFyYXRvciBvbiB0b3Agb2Ygd2hhdCBpcyBwcm92aWRlZCB0byBndWFyYW50ZWUgZG9jdW1lbnQgZXF1YWxpdHkgYmFzZWQgb25cbiAqIHRoZSBrZXkuXG4gKi8gY2xhc3MgaWMge1xuICAgIC8qKiBUaGUgZGVmYXVsdCBvcmRlcmluZyBpcyBieSBrZXkgaWYgdGhlIGNvbXBhcmF0b3IgaXMgb21pdHRlZCAqL1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgLy8gV2UgYXJlIGFkZGluZyBkb2N1bWVudCBrZXkgY29tcGFyYXRvciB0byB0aGUgZW5kIGFzIGl0J3MgdGhlIG9ubHlcbiAgICAgICAgLy8gZ3VhcmFudGVlZCB1bmlxdWUgcHJvcGVydHkgb2YgYSBkb2N1bWVudC5cbiAgICAgICAgdGhpcy5jb21wYXJhdG9yID0gdCA/IChlLCBuKSA9PiB0KGUsIG4pIHx8IGN0LmNvbXBhcmF0b3IoZS5rZXksIG4ua2V5KSA6ICh0LCBlKSA9PiBjdC5jb21wYXJhdG9yKHQua2V5LCBlLmtleSksIFxuICAgICAgICB0aGlzLmtleWVkTWFwID0gd3MoKSwgdGhpcy5zb3J0ZWRTZXQgPSBuZXcgR2UodGhpcy5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBlbXB0eSBjb3B5IG9mIHRoZSBleGlzdGluZyBEb2N1bWVudFNldCwgdXNpbmcgdGhlIHNhbWVcbiAgICAgKiBjb21wYXJhdG9yLlxuICAgICAqLyAgICBzdGF0aWMgZW1wdHlTZXQodCkge1xuICAgICAgICByZXR1cm4gbmV3IGljKHQuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIGhhcyh0KSB7XG4gICAgICAgIHJldHVybiBudWxsICE9IHRoaXMua2V5ZWRNYXAuZ2V0KHQpO1xuICAgIH1cbiAgICBnZXQodCkge1xuICAgICAgICByZXR1cm4gdGhpcy5rZXllZE1hcC5nZXQodCk7XG4gICAgfVxuICAgIGZpcnN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQubWluS2V5KCk7XG4gICAgfVxuICAgIGxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZFNldC5tYXhLZXkoKTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGVkU2V0LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIHByb3ZpZGVkIGtleSBpbiB0aGUgZG9jdW1lbnQgc2V0LCBvciAtMSBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBrZXkgaXMgbm90IHByZXNlbnQgaW4gdGhlIHNldDtcbiAgICAgKi8gICAgaW5kZXhPZih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmtleWVkTWFwLmdldCh0KTtcbiAgICAgICAgcmV0dXJuIGUgPyB0aGlzLnNvcnRlZFNldC5pbmRleE9mKGUpIDogLTE7XG4gICAgfVxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQuc2l6ZTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIGRvY3VtZW50cyBpbiBvcmRlciBkZWZpbmVkIGJ5IFwiY29tcGFyYXRvclwiICovICAgIGZvckVhY2godCkge1xuICAgICAgICB0aGlzLnNvcnRlZFNldC5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgbikgPT4gKHQoZSksICExKSkpO1xuICAgIH1cbiAgICAvKiogSW5zZXJ0cyBvciB1cGRhdGVzIGEgZG9jdW1lbnQgd2l0aCB0aGUgc2FtZSBrZXkgKi8gICAgYWRkKHQpIHtcbiAgICAgICAgLy8gRmlyc3QgcmVtb3ZlIHRoZSBlbGVtZW50IGlmIHdlIGhhdmUgaXQuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmRlbGV0ZSh0LmtleSk7XG4gICAgICAgIHJldHVybiBlLmNvcHkoZS5rZXllZE1hcC5pbnNlcnQodC5rZXksIHQpLCBlLnNvcnRlZFNldC5pbnNlcnQodCwgbnVsbCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyBhIGRvY3VtZW50IHdpdGggYSBnaXZlbiBrZXkgKi8gICAgZGVsZXRlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuZ2V0KHQpO1xuICAgICAgICByZXR1cm4gZSA/IHRoaXMuY29weSh0aGlzLmtleWVkTWFwLnJlbW92ZSh0KSwgdGhpcy5zb3J0ZWRTZXQucmVtb3ZlKGUpKSA6IHRoaXM7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICBpZiAoISh0IGluc3RhbmNlb2YgaWMpKSByZXR1cm4gITE7XG4gICAgICAgIGlmICh0aGlzLnNpemUgIT09IHQuc2l6ZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5zb3J0ZWRTZXQuZ2V0SXRlcmF0b3IoKSwgbiA9IHQuc29ydGVkU2V0LmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO2UuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmdldE5leHQoKS5rZXksIHMgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoIXQuaXNFcXVhbChzKSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0LnB1c2goZS50b1N0cmluZygpKTtcbiAgICAgICAgfSkpLCAwID09PSB0Lmxlbmd0aCA/IFwiRG9jdW1lbnRTZXQgKClcIiA6IFwiRG9jdW1lbnRTZXQgKFxcbiAgXCIgKyB0LmpvaW4oXCIgIFxcblwiKSArIFwiXFxuKVwiO1xuICAgIH1cbiAgICBjb3B5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBpYztcbiAgICAgICAgcmV0dXJuIG4uY29tcGFyYXRvciA9IHRoaXMuY29tcGFyYXRvciwgbi5rZXllZE1hcCA9IHQsIG4uc29ydGVkU2V0ID0gZSwgbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50Q2hhbmdlU2V0IGtlZXBzIHRyYWNrIG9mIGEgc2V0IG9mIGNoYW5nZXMgdG8gZG9jcyBpbiBhIHF1ZXJ5LCBtZXJnaW5nXG4gKiBkdXBsaWNhdGUgZXZlbnRzIGZvciB0aGUgc2FtZSBkb2MuXG4gKi8gY2xhc3MgcmMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlR1ID0gbmV3IEdlKGN0LmNvbXBhcmF0b3IpO1xuICAgIH1cbiAgICB0cmFjayh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LmRvYy5rZXksIG4gPSB0aGlzLlR1LmdldChlKTtcbiAgICAgICAgbiA/IFxuICAgICAgICAvLyBNZXJnZSB0aGUgbmV3IGNoYW5nZSB3aXRoIHRoZSBleGlzdGluZyBjaGFuZ2UuXG4gICAgICAgIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAhPT0gdC50eXBlICYmIDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyA9PT0gbi50eXBlID8gdGhpcy5UdSA9IHRoaXMuVHUuaW5zZXJ0KGUsIHQpIDogMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovID09PSB0LnR5cGUgJiYgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gIT09IG4udHlwZSA/IHRoaXMuVHUgPSB0aGlzLlR1Lmluc2VydChlLCB7XG4gICAgICAgICAgICB0eXBlOiBuLnR5cGUsXG4gICAgICAgICAgICBkb2M6IHQuZG9jXG4gICAgICAgIH0pIDogMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovID09PSB0LnR5cGUgJiYgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovID09PSBuLnR5cGUgPyB0aGlzLlR1ID0gdGhpcy5UdS5pbnNlcnQoZSwge1xuICAgICAgICAgICAgdHlwZTogMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovICxcbiAgICAgICAgICAgIGRvYzogdC5kb2NcbiAgICAgICAgfSkgOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IHQudHlwZSAmJiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuVHUgPSB0aGlzLlR1Lmluc2VydChlLCB7XG4gICAgICAgICAgICB0eXBlOiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiB0LmRvY1xuICAgICAgICB9KSA6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSB0LnR5cGUgJiYgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovID09PSBuLnR5cGUgPyB0aGlzLlR1ID0gdGhpcy5UdS5yZW1vdmUoZSkgOiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA9PT0gdC50eXBlICYmIDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA9PT0gbi50eXBlID8gdGhpcy5UdSA9IHRoaXMuVHUuaW5zZXJ0KGUsIHtcbiAgICAgICAgICAgIHR5cGU6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovICxcbiAgICAgICAgICAgIGRvYzogbi5kb2NcbiAgICAgICAgfSkgOiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gPT09IHQudHlwZSAmJiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA9PT0gbi50eXBlID8gdGhpcy5UdSA9IHRoaXMuVHUuaW5zZXJ0KGUsIHtcbiAgICAgICAgICAgIHR5cGU6IDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyAsXG4gICAgICAgICAgICBkb2M6IHQuZG9jXG4gICAgICAgIH0pIDogXG4gICAgICAgIC8vIFRoaXMgaW5jbHVkZXMgdGhlc2UgY2FzZXMsIHdoaWNoIGRvbid0IG1ha2Ugc2Vuc2U6XG4gICAgICAgIC8vIEFkZGVkLT5BZGRlZFxuICAgICAgICAvLyBSZW1vdmVkLT5SZW1vdmVkXG4gICAgICAgIC8vIE1vZGlmaWVkLT5BZGRlZFxuICAgICAgICAvLyBSZW1vdmVkLT5Nb2RpZmllZFxuICAgICAgICAvLyBNZXRhZGF0YS0+QWRkZWRcbiAgICAgICAgLy8gUmVtb3ZlZC0+TWV0YWRhdGFcbiAgICAgICAgTygpIDogdGhpcy5UdSA9IHRoaXMuVHUuaW5zZXJ0KGUsIHQpO1xuICAgIH1cbiAgICBFdSgpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5UdS5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgdC5wdXNoKG4pO1xuICAgICAgICB9KSksIHQ7XG4gICAgfVxufVxuXG5jbGFzcyBvYyB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSwgciwgbywgdSwgYykge1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gdCwgdGhpcy5kb2NzID0gZSwgdGhpcy5vbGREb2NzID0gbiwgdGhpcy5kb2NDaGFuZ2VzID0gcywgdGhpcy5tdXRhdGVkS2V5cyA9IGksIFxuICAgICAgICB0aGlzLmZyb21DYWNoZSA9IHIsIHRoaXMuc3luY1N0YXRlQ2hhbmdlZCA9IG8sIHRoaXMuZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXMgPSB1LCBcbiAgICAgICAgdGhpcy5oYXNDYWNoZWRSZXN1bHRzID0gYztcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSB2aWV3IHNuYXBzaG90IGFzIGlmIGFsbCBkb2N1bWVudHMgaW4gdGhlIHNuYXBzaG90IHdlcmUgYWRkZWQuICovICAgIHN0YXRpYyBmcm9tSW5pdGlhbERvY3VtZW50cyh0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgIGNvbnN0IHIgPSBbXTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICByLnB1c2goe1xuICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiB0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpLCBuZXcgb2ModCwgZSwgaWMuZW1wdHlTZXQoZSksIHIsIG4sIHMsIFxuICAgICAgICAvKiBzeW5jU3RhdGVDaGFuZ2VkPSAqLyAhMCwgXG4gICAgICAgIC8qIGV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzPSAqLyAhMSwgaSk7XG4gICAgfVxuICAgIGdldCBoYXNQZW5kaW5nV3JpdGVzKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMubXV0YXRlZEtleXMuaXNFbXB0eSgpO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgaWYgKCEodGhpcy5mcm9tQ2FjaGUgPT09IHQuZnJvbUNhY2hlICYmIHRoaXMuaGFzQ2FjaGVkUmVzdWx0cyA9PT0gdC5oYXNDYWNoZWRSZXN1bHRzICYmIHRoaXMuc3luY1N0YXRlQ2hhbmdlZCA9PT0gdC5zeW5jU3RhdGVDaGFuZ2VkICYmIHRoaXMubXV0YXRlZEtleXMuaXNFcXVhbCh0Lm11dGF0ZWRLZXlzKSAmJiBJbih0aGlzLnF1ZXJ5LCB0LnF1ZXJ5KSAmJiB0aGlzLmRvY3MuaXNFcXVhbCh0LmRvY3MpICYmIHRoaXMub2xkRG9jcy5pc0VxdWFsKHQub2xkRG9jcykpKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmRvY0NoYW5nZXMsIG4gPSB0LmRvY0NoYW5nZXM7XG4gICAgICAgIGlmIChlLmxlbmd0aCAhPT0gbi5sZW5ndGgpIHJldHVybiAhMTtcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCBlLmxlbmd0aDsgdCsrKSBpZiAoZVt0XS50eXBlICE9PSBuW3RdLnR5cGUgfHwgIWVbdF0uZG9jLmlzRXF1YWwoblt0XS5kb2MpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEhvbGRzIHRoZSBsaXN0ZW5lcnMgYW5kIHRoZSBsYXN0IHJlY2VpdmVkIFZpZXdTbmFwc2hvdCBmb3IgYSBxdWVyeSBiZWluZ1xuICogdHJhY2tlZCBieSBFdmVudE1hbmFnZXIuXG4gKi8gY2xhc3MgdWMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLkF1ID0gdm9pZCAwLCB0aGlzLmxpc3RlbmVycyA9IFtdO1xuICAgIH1cbn1cblxuY2xhc3MgY2Mge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnF1ZXJpZXMgPSBuZXcgbHMoKHQgPT4gVG4odCkpLCBJbiksIHRoaXMub25saW5lU3RhdGUgPSBcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovICwgXG4gICAgICAgIHRoaXMuUnUgPSBuZXcgU2V0O1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gYWModCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gZS5xdWVyeTtcbiAgICBsZXQgaSA9ICExLCByID0gbi5xdWVyaWVzLmdldChzKTtcbiAgICBpZiAociB8fCAoaSA9ICEwLCByID0gbmV3IHVjKSwgaSkgdHJ5IHtcbiAgICAgICAgci5BdSA9IGF3YWl0IG4ub25MaXN0ZW4ocyk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBjb25zdCBuID0gc2ModCwgYEluaXRpYWxpemF0aW9uIG9mIHF1ZXJ5ICcke0VuKGUucXVlcnkpfScgZmFpbGVkYCk7XG4gICAgICAgIHJldHVybiB2b2lkIGUub25FcnJvcihuKTtcbiAgICB9XG4gICAgaWYgKG4ucXVlcmllcy5zZXQocywgciksIHIubGlzdGVuZXJzLnB1c2goZSksIFxuICAgIC8vIFJ1biBnbG9iYWwgc25hcHNob3QgbGlzdGVuZXJzIGlmIGEgY29uc2lzdGVudCBzbmFwc2hvdCBoYXMgYmVlbiBlbWl0dGVkLlxuICAgIGUuYnUobi5vbmxpbmVTdGF0ZSksIHIuQXUpIHtcbiAgICAgICAgZS5QdShyLkF1KSAmJiBkYyhuKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhjKHQsIGUpIHtcbiAgICBjb25zdCBuID0gJCh0KSwgcyA9IGUucXVlcnk7XG4gICAgbGV0IGkgPSAhMTtcbiAgICBjb25zdCByID0gbi5xdWVyaWVzLmdldChzKTtcbiAgICBpZiAocikge1xuICAgICAgICBjb25zdCB0ID0gci5saXN0ZW5lcnMuaW5kZXhPZihlKTtcbiAgICAgICAgdCA+PSAwICYmIChyLmxpc3RlbmVycy5zcGxpY2UodCwgMSksIGkgPSAwID09PSByLmxpc3RlbmVycy5sZW5ndGgpO1xuICAgIH1cbiAgICBpZiAoaSkgcmV0dXJuIG4ucXVlcmllcy5kZWxldGUocyksIG4ub25Vbmxpc3RlbihzKTtcbn1cblxuZnVuY3Rpb24gbGModCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgIGxldCBzID0gITE7XG4gICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgY29uc3QgZSA9IHQucXVlcnksIGkgPSBuLnF1ZXJpZXMuZ2V0KGUpO1xuICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIGkubGlzdGVuZXJzKSBlLlB1KHQpICYmIChzID0gITApO1xuICAgICAgICAgICAgaS5BdSA9IHQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcyAmJiBkYyhuKTtcbn1cblxuZnVuY3Rpb24gZmModCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSAkKHQpLCBpID0gcy5xdWVyaWVzLmdldChlKTtcbiAgICBpZiAoaSkgZm9yIChjb25zdCB0IG9mIGkubGlzdGVuZXJzKSB0Lm9uRXJyb3Iobik7XG4gICAgLy8gUmVtb3ZlIGFsbCBsaXN0ZW5lcnMuIE5PVEU6IFdlIGRvbid0IG5lZWQgdG8gY2FsbCBzeW5jRW5naW5lLnVubGlzdGVuKClcbiAgICAvLyBhZnRlciBhbiBlcnJvci5cbiAgICAgICAgcy5xdWVyaWVzLmRlbGV0ZShlKTtcbn1cblxuLy8gQ2FsbCBhbGwgZ2xvYmFsIHNuYXBzaG90IGxpc3RlbmVycyB0aGF0IGhhdmUgYmVlbiBzZXQuXG5mdW5jdGlvbiBkYyh0KSB7XG4gICAgdC5SdS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgdC5uZXh0KCk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFF1ZXJ5TGlzdGVuZXIgdGFrZXMgYSBzZXJpZXMgb2YgaW50ZXJuYWwgdmlldyBzbmFwc2hvdHMgYW5kIGRldGVybWluZXNcbiAqIHdoZW4gdG8gcmFpc2UgdGhlIGV2ZW50LlxuICpcbiAqIEl0IHVzZXMgYW4gT2JzZXJ2ZXIgdG8gZGlzcGF0Y2ggZXZlbnRzLlxuICovIGNsYXNzIF9jIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSB0LCB0aGlzLnZ1ID0gZSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsIHNuYXBzaG90cyAoZS5nLiBmcm9tIGNhY2hlKSBtYXkgbm90IGJlIHByb3BhZ2F0ZWQgdG8gdGhlIHdyYXBwZWRcbiAgICAgICAgICogb2JzZXJ2ZXIuIFRoaXMgZmxhZyBpcyBzZXQgdG8gdHJ1ZSBvbmNlIHdlJ3ZlIGFjdHVhbGx5IHJhaXNlZCBhbiBldmVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVnUgPSAhMSwgdGhpcy5TdSA9IG51bGwsIHRoaXMub25saW5lU3RhdGUgPSBcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovICwgXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG4gfHwge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgdGhlIG5ldyBWaWV3U25hcHNob3QgdG8gdGhpcyBsaXN0ZW5lciwgcmFpc2luZyBhIHVzZXItZmFjaW5nIGV2ZW50XG4gICAgICogaWYgYXBwbGljYWJsZSAoZGVwZW5kaW5nIG9uIHdoYXQgY2hhbmdlZCwgd2hldGhlciB0aGUgdXNlciBoYXMgb3B0ZWQgaW50b1xuICAgICAqIG1ldGFkYXRhLW9ubHkgY2hhbmdlcywgZXRjLikuIFJldHVybnMgdHJ1ZSBpZiBhIHVzZXItZmFjaW5nIGV2ZW50IHdhc1xuICAgICAqIGluZGVlZCByYWlzZWQuXG4gICAgICovICAgIFB1KHQpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuaW5jbHVkZU1ldGFkYXRhQ2hhbmdlcykge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBtZXRhZGF0YSBvbmx5IGNoYW5nZXMuXG4gICAgICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdC5kb2NDaGFuZ2VzKSAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gIT09IG4udHlwZSAmJiBlLnB1c2gobik7XG4gICAgICAgICAgICB0ID0gbmV3IG9jKHQucXVlcnksIHQuZG9jcywgdC5vbGREb2NzLCBlLCB0Lm11dGF0ZWRLZXlzLCB0LmZyb21DYWNoZSwgdC5zeW5jU3RhdGVDaGFuZ2VkLCBcbiAgICAgICAgICAgIC8qIGV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzPSAqLyAhMCwgdC5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZSA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5WdSA/IHRoaXMuRHUodCkgJiYgKHRoaXMudnUubmV4dCh0KSwgZSA9ICEwKSA6IHRoaXMuQ3UodCwgdGhpcy5vbmxpbmVTdGF0ZSkgJiYgKHRoaXMueHUodCksIFxuICAgICAgICBlID0gITApLCB0aGlzLlN1ID0gdCwgZTtcbiAgICB9XG4gICAgb25FcnJvcih0KSB7XG4gICAgICAgIHRoaXMudnUuZXJyb3IodCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHdoZXRoZXIgYSBzbmFwc2hvdCB3YXMgcmFpc2VkLiAqLyAgICBidSh0KSB7XG4gICAgICAgIHRoaXMub25saW5lU3RhdGUgPSB0O1xuICAgICAgICBsZXQgZSA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5TdSAmJiAhdGhpcy5WdSAmJiB0aGlzLkN1KHRoaXMuU3UsIHQpICYmICh0aGlzLnh1KHRoaXMuU3UpLCBlID0gITApLCBcbiAgICAgICAgZTtcbiAgICB9XG4gICAgQ3UodCwgZSkge1xuICAgICAgICAvLyBBbHdheXMgcmFpc2UgdGhlIGZpcnN0IGV2ZW50IHdoZW4gd2UncmUgc3luY2VkXG4gICAgICAgIGlmICghdC5mcm9tQ2FjaGUpIHJldHVybiAhMDtcbiAgICAgICAgLy8gTk9URTogV2UgY29uc2lkZXIgT25saW5lU3RhdGUuVW5rbm93biBhcyBvbmxpbmUgKGl0IHNob3VsZCBiZWNvbWUgT2ZmbGluZVxuICAgICAgICAvLyBvciBPbmxpbmUgaWYgd2Ugd2FpdCBsb25nIGVub3VnaCkuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8gIT09IGU7XG4gICAgICAgIC8vIERvbid0IHJhaXNlIHRoZSBldmVudCBpZiB3ZSdyZSBvbmxpbmUsIGFyZW4ndCBzeW5jZWQgeWV0IChjaGVja2VkXG4gICAgICAgIC8vIGFib3ZlKSBhbmQgYXJlIHdhaXRpbmcgZm9yIGEgc3luYy5cbiAgICAgICAgICAgICAgICByZXR1cm4gKCF0aGlzLm9wdGlvbnMuTnUgfHwgIW4pICYmICghdC5kb2NzLmlzRW1wdHkoKSB8fCB0Lmhhc0NhY2hlZFJlc3VsdHMgfHwgXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyA9PT0gZSk7XG4gICAgICAgIC8vIFJhaXNlIGRhdGEgZnJvbSBjYWNoZSBpZiB3ZSBoYXZlIGFueSBkb2N1bWVudHMsIGhhdmUgY2FjaGVkIHJlc3VsdHMgYmVmb3JlLFxuICAgICAgICAvLyBvciB3ZSBhcmUgb2ZmbGluZS5cbiAgICAgICAgfVxuICAgIER1KHQpIHtcbiAgICAgICAgLy8gV2UgZG9uJ3QgbmVlZCB0byBoYW5kbGUgaW5jbHVkZURvY3VtZW50TWV0YWRhdGFDaGFuZ2VzIGhlcmUgYmVjYXVzZVxuICAgICAgICAvLyB0aGUgTWV0YWRhdGEgb25seSBjaGFuZ2VzIGhhdmUgYWxyZWFkeSBiZWVuIHN0cmlwcGVkIG91dCBpZiBuZWVkZWQuXG4gICAgICAgIC8vIEF0IHRoaXMgcG9pbnQgdGhlIG9ubHkgY2hhbmdlcyB3ZSB3aWxsIHNlZSBhcmUgdGhlIG9uZXMgd2Ugc2hvdWxkXG4gICAgICAgIC8vIHByb3BhZ2F0ZS5cbiAgICAgICAgaWYgKHQuZG9jQ2hhbmdlcy5sZW5ndGggPiAwKSByZXR1cm4gITA7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLlN1ICYmIHRoaXMuU3UuaGFzUGVuZGluZ1dyaXRlcyAhPT0gdC5oYXNQZW5kaW5nV3JpdGVzO1xuICAgICAgICByZXR1cm4gISghdC5zeW5jU3RhdGVDaGFuZ2VkICYmICFlKSAmJiAhMCA9PT0gdGhpcy5vcHRpb25zLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXM7XG4gICAgICAgIC8vIEdlbmVyYWxseSB3ZSBzaG91bGQgaGF2ZSBoaXQgb25lIG9mIHRoZSBjYXNlcyBhYm92ZSwgYnV0IGl0J3MgcG9zc2libGVcbiAgICAgICAgLy8gdG8gZ2V0IGhlcmUgaWYgdGhlcmUgd2VyZSBvbmx5IG1ldGFkYXRhIGRvY0NoYW5nZXMgYW5kIHRoZXkgZ290XG4gICAgICAgIC8vIHN0cmlwcGVkIG91dC5cbiAgICAgICAgfVxuICAgIHh1KHQpIHtcbiAgICAgICAgdCA9IG9jLmZyb21Jbml0aWFsRG9jdW1lbnRzKHQucXVlcnksIHQuZG9jcywgdC5tdXRhdGVkS2V5cywgdC5mcm9tQ2FjaGUsIHQuaGFzQ2FjaGVkUmVzdWx0cyksIFxuICAgICAgICB0aGlzLlZ1ID0gITAsIHRoaXMudnUubmV4dCh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgY29tcGxldGUgZWxlbWVudCBpbiB0aGUgYnVuZGxlIHN0cmVhbSwgdG9nZXRoZXIgd2l0aCB0aGUgYnl0ZSBsZW5ndGggaXRcbiAqIG9jY3VwaWVzIGluIHRoZSBzdHJlYW0uXG4gKi8gY2xhc3Mgd2Mge1xuICAgIGNvbnN0cnVjdG9yKHQsIFxuICAgIC8vIEhvdyBtYW55IGJ5dGVzIHRoaXMgZWxlbWVudCB0YWtlcyB0byBzdG9yZSBpbiB0aGUgYnVuZGxlLlxuICAgIGUpIHtcbiAgICAgICAgdGhpcy5rdSA9IHQsIHRoaXMuYnl0ZUxlbmd0aCA9IGU7XG4gICAgfVxuICAgIE91KCkge1xuICAgICAgICByZXR1cm4gXCJtZXRhZGF0YVwiIGluIHRoaXMua3U7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBIZWxwZXIgdG8gY29udmVydCBvYmplY3RzIGZyb20gYnVuZGxlcyB0byBtb2RlbCBvYmplY3RzIGluIHRoZSBTREsuXG4gKi8gY2xhc3MgbWMge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy55dCA9IHQ7XG4gICAgfVxuICAgIEppKHQpIHtcbiAgICAgICAgcmV0dXJuIFFzKHRoaXMueXQsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhIEJ1bmRsZURvY3VtZW50IHRvIGEgTXV0YWJsZURvY3VtZW50LlxuICAgICAqLyAgICBZaSh0KSB7XG4gICAgICAgIHJldHVybiB0Lm1ldGFkYXRhLmV4aXN0cyA/IFlzKHRoaXMueXQsIHQuZG9jdW1lbnQsICExKSA6IFplLm5ld05vRG9jdW1lbnQodGhpcy5KaSh0Lm1ldGFkYXRhLm5hbWUpLCB0aGlzLlhpKHQubWV0YWRhdGEucmVhZFRpbWUpKTtcbiAgICB9XG4gICAgWGkodCkge1xuICAgICAgICByZXR1cm4gcXModCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgY2xhc3MgdG8gcHJvY2VzcyB0aGUgZWxlbWVudHMgZnJvbSBhIGJ1bmRsZSwgbG9hZCB0aGVtIGludG8gbG9jYWxcbiAqIHN0b3JhZ2UgYW5kIHByb3ZpZGUgcHJvZ3Jlc3MgdXBkYXRlIHdoaWxlIGxvYWRpbmcuXG4gKi8gY2xhc3MgZ2Mge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5NdSA9IHQsIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMueXQgPSBuLCBcbiAgICAgICAgLyoqIEJhdGNoZWQgcXVlcmllcyB0byBiZSBzYXZlZCBpbnRvIHN0b3JhZ2UgKi9cbiAgICAgICAgdGhpcy5xdWVyaWVzID0gW10sIFxuICAgICAgICAvKiogQmF0Y2hlZCBkb2N1bWVudHMgdG8gYmUgc2F2ZWQgaW50byBzdG9yYWdlICovXG4gICAgICAgIHRoaXMuZG9jdW1lbnRzID0gW10sIFxuICAgICAgICAvKiogVGhlIGNvbGxlY3Rpb24gZ3JvdXBzIGFmZmVjdGVkIGJ5IHRoaXMgYnVuZGxlLiAqL1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25Hcm91cHMgPSBuZXcgU2V0LCB0aGlzLnByb2dyZXNzID0geWModCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYW4gZWxlbWVudCBmcm9tIHRoZSBidW5kbGUgdG8gdGhlIGxvYWRlci5cbiAgICAgKlxuICAgICAqIFJldHVybnMgYSBuZXcgcHJvZ3Jlc3MgaWYgYWRkaW5nIHRoZSBlbGVtZW50IGxlYWRzIHRvIGEgbmV3IHByb2dyZXNzLFxuICAgICAqIG90aGVyd2lzZSByZXR1cm5zIG51bGwuXG4gICAgICovICAgIEZ1KHQpIHtcbiAgICAgICAgdGhpcy5wcm9ncmVzcy5ieXRlc0xvYWRlZCArPSB0LmJ5dGVMZW5ndGg7XG4gICAgICAgIGxldCBlID0gdGhpcy5wcm9ncmVzcy5kb2N1bWVudHNMb2FkZWQ7XG4gICAgICAgIGlmICh0Lmt1Lm5hbWVkUXVlcnkpIHRoaXMucXVlcmllcy5wdXNoKHQua3UubmFtZWRRdWVyeSk7IGVsc2UgaWYgKHQua3UuZG9jdW1lbnRNZXRhZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IHQua3UuZG9jdW1lbnRNZXRhZGF0YVxuICAgICAgICAgICAgfSksIHQua3UuZG9jdW1lbnRNZXRhZGF0YS5leGlzdHMgfHwgKytlO1xuICAgICAgICAgICAgY29uc3QgbiA9IHJ0LmZyb21TdHJpbmcodC5rdS5kb2N1bWVudE1ldGFkYXRhLm5hbWUpO1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uR3JvdXBzLmFkZChuLmdldChuLmxlbmd0aCAtIDIpKTtcbiAgICAgICAgfSBlbHNlIHQua3UuZG9jdW1lbnQgJiYgKHRoaXMuZG9jdW1lbnRzW3RoaXMuZG9jdW1lbnRzLmxlbmd0aCAtIDFdLmRvY3VtZW50ID0gdC5rdS5kb2N1bWVudCwgXG4gICAgICAgICsrZSk7XG4gICAgICAgIHJldHVybiBlICE9PSB0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZCA/ICh0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZCA9IGUsIFxuICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnByb2dyZXNzKSkgOiBudWxsO1xuICAgIH1cbiAgICAkdSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgTWFwLCBuID0gbmV3IG1jKHRoaXMueXQpO1xuICAgICAgICBmb3IgKGNvbnN0IHMgb2YgdCkgaWYgKHMubWV0YWRhdGEucXVlcmllcykge1xuICAgICAgICAgICAgY29uc3QgdCA9IG4uSmkocy5tZXRhZGF0YS5uYW1lKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBzLm1ldGFkYXRhLnF1ZXJpZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gKGUuZ2V0KG4pIHx8IEVzKCkpLmFkZCh0KTtcbiAgICAgICAgICAgICAgICBlLnNldChuLCBzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBwcm9ncmVzcyB0byAnU3VjY2VzcycgYW5kIHJldHVybiB0aGUgdXBkYXRlZCBwcm9ncmVzcy5cbiAgICAgKi8gICAgYXN5bmMgY29tcGxldGUoKSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCB0dSh0aGlzLmxvY2FsU3RvcmUsIG5ldyBtYyh0aGlzLnl0KSwgdGhpcy5kb2N1bWVudHMsIHRoaXMuTXUuaWQpLCBlID0gdGhpcy4kdSh0aGlzLmRvY3VtZW50cyk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLnF1ZXJpZXMpIGF3YWl0IGV1KHRoaXMubG9jYWxTdG9yZSwgdCwgZS5nZXQodC5uYW1lKSk7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2dyZXNzLnRhc2tTdGF0ZSA9IFwiU3VjY2Vzc1wiLCB7XG4gICAgICAgICAgICBwcm9ncmVzczogdGhpcy5wcm9ncmVzcyxcbiAgICAgICAgICAgIEJ1OiB0aGlzLmNvbGxlY3Rpb25Hcm91cHMsXG4gICAgICAgICAgICBMdTogdFxuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgYExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3NgIHJlcHJlc2VudGluZyB0aGUgaW5pdGlhbCBwcm9ncmVzcyBvZlxuICogbG9hZGluZyBhIGJ1bmRsZS5cbiAqLyBmdW5jdGlvbiB5Yyh0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGFza1N0YXRlOiBcIlJ1bm5pbmdcIixcbiAgICAgICAgZG9jdW1lbnRzTG9hZGVkOiAwLFxuICAgICAgICBieXRlc0xvYWRlZDogMCxcbiAgICAgICAgdG90YWxEb2N1bWVudHM6IHQudG90YWxEb2N1bWVudHMsXG4gICAgICAgIHRvdGFsQnl0ZXM6IHQudG90YWxCeXRlc1xuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGBMb2FkQnVuZGxlVGFza1Byb2dyZXNzYCByZXByZXNlbnRpbmcgdGhlIHByb2dyZXNzIHRoYXQgdGhlIGxvYWRpbmdcbiAqIGhhcyBzdWNjZWVkZWQuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBwYyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmtleSA9IHQ7XG4gICAgfVxufVxuXG5jbGFzcyBJYyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmtleSA9IHQ7XG4gICAgfVxufVxuXG4vKipcbiAqIFZpZXcgaXMgcmVzcG9uc2libGUgZm9yIGNvbXB1dGluZyB0aGUgZmluYWwgbWVyZ2VkIHRydXRoIG9mIHdoYXQgZG9jcyBhcmUgaW5cbiAqIGEgcXVlcnkuIEl0IGdldHMgbm90aWZpZWQgb2YgbG9jYWwgYW5kIHJlbW90ZSBjaGFuZ2VzIHRvIGRvY3MsIGFuZCBhcHBsaWVzXG4gKiB0aGUgcXVlcnkgZmlsdGVycyBhbmQgbGltaXRzIHRvIGRldGVybWluZSB0aGUgbW9zdCBjb3JyZWN0IHBvc3NpYmxlIHJlc3VsdHMuXG4gKi8gY2xhc3MgVGMge1xuICAgIGNvbnN0cnVjdG9yKHQsIFxuICAgIC8qKiBEb2N1bWVudHMgaW5jbHVkZWQgaW4gdGhlIHJlbW90ZSB0YXJnZXQgKi9cbiAgICBlKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSB0LCB0aGlzLnF1ID0gZSwgdGhpcy5VdSA9IG51bGwsIHRoaXMuaGFzQ2FjaGVkUmVzdWx0cyA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZmxhZyB3aGV0aGVyIHRoZSB2aWV3IGlzIGN1cnJlbnQgd2l0aCB0aGUgYmFja2VuZC4gQSB2aWV3IGlzIGNvbnNpZGVyZWRcbiAgICAgICAgICogY3VycmVudCBhZnRlciBpdCBoYXMgc2VlbiB0aGUgY3VycmVudCBmbGFnIGZyb20gdGhlIGJhY2tlbmQgYW5kIGRpZCBub3RcbiAgICAgICAgICogbG9zZSBjb25zaXN0ZW5jeSB3aXRoaW4gdGhlIHdhdGNoIHN0cmVhbSAoZS5nLiBiZWNhdXNlIG9mIGFuIGV4aXN0ZW5jZVxuICAgICAgICAgKiBmaWx0ZXIgbWlzbWF0Y2gpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jdXJyZW50ID0gITEsIFxuICAgICAgICAvKiogRG9jdW1lbnRzIGluIHRoZSB2aWV3IGJ1dCBub3QgaW4gdGhlIHJlbW90ZSB0YXJnZXQgKi9cbiAgICAgICAgdGhpcy5LdSA9IEVzKCksIFxuICAgICAgICAvKiogRG9jdW1lbnQgS2V5cyB0aGF0IGhhdmUgbG9jYWwgY2hhbmdlcyAqL1xuICAgICAgICB0aGlzLm11dGF0ZWRLZXlzID0gRXMoKSwgdGhpcy5HdSA9IGJuKHQpLCB0aGlzLlF1ID0gbmV3IGljKHRoaXMuR3UpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgc2V0IG9mIHJlbW90ZSBkb2N1bWVudHMgdGhhdCB0aGUgc2VydmVyIGhhcyB0b2xkIHVzIGJlbG9uZ3MgdG8gdGhlIHRhcmdldCBhc3NvY2lhdGVkIHdpdGhcbiAgICAgKiB0aGlzIHZpZXcuXG4gICAgICovICAgIGdldCBqdSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYSBzZXQgb2YgZG9jIGNoYW5nZXMsIGFwcGxpZXMgdGhlIHF1ZXJ5IGxpbWl0LCBhbmQgY29tcHV0ZXNcbiAgICAgKiB3aGF0IHRoZSBuZXcgcmVzdWx0cyBzaG91bGQgYmUsIHdoYXQgdGhlIGNoYW5nZXMgd2VyZSwgYW5kIHdoZXRoZXIgd2UgbWF5XG4gICAgICogbmVlZCB0byBnbyBiYWNrIHRvIHRoZSBsb2NhbCBjYWNoZSBmb3IgbW9yZSByZXN1bHRzLiBEb2VzIG5vdCBtYWtlIGFueVxuICAgICAqIGNoYW5nZXMgdG8gdGhlIHZpZXcuXG4gICAgICogQHBhcmFtIGRvY0NoYW5nZXMgLSBUaGUgZG9jIGNoYW5nZXMgdG8gYXBwbHkgdG8gdGhpcyB2aWV3LlxuICAgICAqIEBwYXJhbSBwcmV2aW91c0NoYW5nZXMgLSBJZiB0aGlzIGlzIGJlaW5nIGNhbGxlZCB3aXRoIGEgcmVmaWxsLCB0aGVuIHN0YXJ0XG4gICAgICogICAgICAgIHdpdGggdGhpcyBzZXQgb2YgZG9jcyBhbmQgY2hhbmdlcyBpbnN0ZWFkIG9mIHRoZSBjdXJyZW50IHZpZXcuXG4gICAgICogQHJldHVybnMgYSBuZXcgc2V0IG9mIGRvY3MsIGNoYW5nZXMsIGFuZCByZWZpbGwgZmxhZy5cbiAgICAgKi8gICAgV3UodCwgZSkge1xuICAgICAgICBjb25zdCBuID0gZSA/IGUuenUgOiBuZXcgcmMsIHMgPSBlID8gZS5RdSA6IHRoaXMuUXU7XG4gICAgICAgIGxldCBpID0gZSA/IGUubXV0YXRlZEtleXMgOiB0aGlzLm11dGF0ZWRLZXlzLCByID0gcywgbyA9ICExO1xuICAgICAgICAvLyBUcmFjayB0aGUgbGFzdCBkb2MgaW4gYSAoZnVsbCkgbGltaXQuIFRoaXMgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIHNvbWVcbiAgICAgICAgLy8gdXBkYXRlIChhIGRlbGV0ZSwgb3IgYW4gdXBkYXRlIG1vdmluZyBhIGRvYyBwYXN0IHRoZSBvbGQgbGltaXQpIG1pZ2h0XG4gICAgICAgIC8vIG1lYW4gdGhlcmUgaXMgc29tZSBvdGhlciBkb2N1bWVudCBpbiB0aGUgbG9jYWwgY2FjaGUgdGhhdCBlaXRoZXIgc2hvdWxkXG4gICAgICAgIC8vIGNvbWUgKDEpIGJldHdlZW4gdGhlIG9sZCBsYXN0IGxpbWl0IGRvYyBhbmQgdGhlIG5ldyBsYXN0IGRvY3VtZW50LCBpbiB0aGVcbiAgICAgICAgLy8gY2FzZSBvZiB1cGRhdGVzLCBvciAoMikgYWZ0ZXIgdGhlIG5ldyBsYXN0IGRvY3VtZW50LCBpbiB0aGUgY2FzZSBvZlxuICAgICAgICAvLyBkZWxldGVzLiBTbyB3ZSBrZWVwIHRoaXMgZG9jIGF0IHRoZSBvbGQgbGltaXQgdG8gY29tcGFyZSB0aGUgdXBkYXRlcyB0by5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgc2hvdWxkIG5ldmVyIGdldCB1c2VkIGluIGEgcmVmaWxsICh3aGVuIHByZXZpb3VzQ2hhbmdlcyBpc1xuICAgICAgICAvLyBzZXQpLCBiZWNhdXNlIHRoZXJlIHdpbGwgb25seSBiZSBhZGRzIC0tIG5vIGRlbGV0ZXMgb3IgdXBkYXRlcy5cbiAgICAgICAgY29uc3QgdSA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgJiYgcy5zaXplID09PSB0aGlzLnF1ZXJ5LmxpbWl0ID8gcy5sYXN0KCkgOiBudWxsLCBjID0gXCJMXCIgLyogTGltaXRUeXBlLkxhc3QgKi8gPT09IHRoaXMucXVlcnkubGltaXRUeXBlICYmIHMuc2l6ZSA9PT0gdGhpcy5xdWVyeS5saW1pdCA/IHMuZmlyc3QoKSA6IG51bGw7XG4gICAgICAgIC8vIERyb3AgZG9jdW1lbnRzIG91dCB0byBtZWV0IGxpbWl0L2xpbWl0VG9MYXN0IHJlcXVpcmVtZW50LlxuICAgICAgICBpZiAodC5pbm9yZGVyVHJhdmVyc2FsKCgodCwgZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYSA9IHMuZ2V0KHQpLCBoID0gQW4odGhpcy5xdWVyeSwgZSkgPyBlIDogbnVsbCwgbCA9ICEhYSAmJiB0aGlzLm11dGF0ZWRLZXlzLmhhcyhhLmtleSksIGYgPSAhIWggJiYgKGguaGFzTG9jYWxNdXRhdGlvbnMgfHwgXG4gICAgICAgICAgICAvLyBXZSBvbmx5IGNvbnNpZGVyIGNvbW1pdHRlZCBtdXRhdGlvbnMgZm9yIGRvY3VtZW50cyB0aGF0IHdlcmVcbiAgICAgICAgICAgIC8vIG11dGF0ZWQgZHVyaW5nIHRoZSBsaWZldGltZSBvZiB0aGUgdmlldy5cbiAgICAgICAgICAgIHRoaXMubXV0YXRlZEtleXMuaGFzKGgua2V5KSAmJiBoLmhhc0NvbW1pdHRlZE11dGF0aW9ucyk7XG4gICAgICAgICAgICBsZXQgZCA9ICExO1xuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGNoYW5nZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEgJiYgaCkge1xuICAgICAgICAgICAgICAgIGEuZGF0YS5pc0VxdWFsKGguZGF0YSkgPyBsICE9PSBmICYmIChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovICxcbiAgICAgICAgICAgICAgICAgICAgZG9jOiBoXG4gICAgICAgICAgICAgICAgfSksIGQgPSAhMCkgOiB0aGlzLkh1KGEsIGgpIHx8IChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovICxcbiAgICAgICAgICAgICAgICAgICAgZG9jOiBoXG4gICAgICAgICAgICAgICAgfSksIGQgPSAhMCwgKHUgJiYgdGhpcy5HdShoLCB1KSA+IDAgfHwgYyAmJiB0aGlzLkd1KGgsIGMpIDwgMCkgJiYgKFxuICAgICAgICAgICAgICAgIC8vIFRoaXMgZG9jIG1vdmVkIGZyb20gaW5zaWRlIHRoZSBsaW1pdCB0byBvdXRzaWRlIHRoZSBsaW1pdC5cbiAgICAgICAgICAgICAgICAvLyBUaGF0IG1lYW5zIHRoZXJlIG1heSBiZSBzb21lIG90aGVyIGRvYyBpbiB0aGUgbG9jYWwgY2FjaGVcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHNob3VsZCBiZSBpbmNsdWRlZCBpbnN0ZWFkLlxuICAgICAgICAgICAgICAgIG8gPSAhMCkpO1xuICAgICAgICAgICAgfSBlbHNlICFhICYmIGggPyAobi50cmFjayh7XG4gICAgICAgICAgICAgICAgdHlwZTogMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovICxcbiAgICAgICAgICAgICAgICBkb2M6IGhcbiAgICAgICAgICAgIH0pLCBkID0gITApIDogYSAmJiAhaCAmJiAobi50cmFjayh7XG4gICAgICAgICAgICAgICAgdHlwZTogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogYVxuICAgICAgICAgICAgfSksIGQgPSAhMCwgKHUgfHwgYykgJiYgKFxuICAgICAgICAgICAgLy8gQSBkb2Mgd2FzIHJlbW92ZWQgZnJvbSBhIGZ1bGwgbGltaXQgcXVlcnkuIFdlJ2xsIG5lZWQgdG9cbiAgICAgICAgICAgIC8vIHJlcXVlcnkgZnJvbSB0aGUgbG9jYWwgY2FjaGUgdG8gc2VlIGlmIHdlIGtub3cgYWJvdXQgc29tZSBvdGhlclxuICAgICAgICAgICAgLy8gZG9jIHRoYXQgc2hvdWxkIGJlIGluIHRoZSByZXN1bHRzLlxuICAgICAgICAgICAgbyA9ICEwKSk7XG4gICAgICAgICAgICBkICYmIChoID8gKHIgPSByLmFkZChoKSwgaSA9IGYgPyBpLmFkZCh0KSA6IGkuZGVsZXRlKHQpKSA6IChyID0gci5kZWxldGUodCksIGkgPSBpLmRlbGV0ZSh0KSkpO1xuICAgICAgICB9KSksIG51bGwgIT09IHRoaXMucXVlcnkubGltaXQpIGZvciAoO3Iuc2l6ZSA+IHRoaXMucXVlcnkubGltaXQ7ICkge1xuICAgICAgICAgICAgY29uc3QgdCA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgPyByLmxhc3QoKSA6IHIuZmlyc3QoKTtcbiAgICAgICAgICAgIHIgPSByLmRlbGV0ZSh0LmtleSksIGkgPSBpLmRlbGV0ZSh0LmtleSksIG4udHJhY2soe1xuICAgICAgICAgICAgICAgIHR5cGU6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovICxcbiAgICAgICAgICAgICAgICBkb2M6IHRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBRdTogcixcbiAgICAgICAgICAgIHp1OiBuLFxuICAgICAgICAgICAgJGk6IG8sXG4gICAgICAgICAgICBtdXRhdGVkS2V5czogaVxuICAgICAgICB9O1xuICAgIH1cbiAgICBIdSh0LCBlKSB7XG4gICAgICAgIC8vIFdlIHN1cHByZXNzIHRoZSBpbml0aWFsIGNoYW5nZSBldmVudCBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZSBtb2RpZmllZCBhc1xuICAgICAgICAvLyBwYXJ0IG9mIGEgd3JpdGUgYWNrbm93bGVkZ21lbnQgKGUuZy4gd2hlbiB0aGUgdmFsdWUgb2YgYSBzZXJ2ZXIgdHJhbnNmb3JtXG4gICAgICAgIC8vIGlzIGFwcGxpZWQpIGFzIFdhdGNoIHdpbGwgc2VuZCB1cyB0aGUgc2FtZSBkb2N1bWVudCBhZ2Fpbi5cbiAgICAgICAgLy8gQnkgc3VwcHJlc3NpbmcgdGhlIGV2ZW50LCB3ZSBvbmx5IHJhaXNlIHR3byB1c2VyIHZpc2libGUgZXZlbnRzIChvbmUgd2l0aFxuICAgICAgICAvLyBgaGFzUGVuZGluZ1dyaXRlc2AgYW5kIHRoZSBmaW5hbCBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQpIGluc3RlYWQgb2YgdGhyZWVcbiAgICAgICAgLy8gKG9uZSB3aXRoIGBoYXNQZW5kaW5nV3JpdGVzYCwgdGhlIG1vZGlmaWVkIGRvY3VtZW50IHdpdGhcbiAgICAgICAgLy8gYGhhc1BlbmRpbmdXcml0ZXNgIGFuZCB0aGUgZmluYWwgc3RhdGUgb2YgdGhlIGRvY3VtZW50KS5cbiAgICAgICAgcmV0dXJuIHQuaGFzTG9jYWxNdXRhdGlvbnMgJiYgZS5oYXNDb21taXR0ZWRNdXRhdGlvbnMgJiYgIWUuaGFzTG9jYWxNdXRhdGlvbnM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHZpZXcgd2l0aCB0aGUgZ2l2ZW4gVmlld0RvY3VtZW50Q2hhbmdlcyBhbmQgb3B0aW9uYWxseSB1cGRhdGVzXG4gICAgICogbGltYm8gZG9jcyBhbmQgc3luYyBzdGF0ZSBmcm9tIHRoZSBwcm92aWRlZCB0YXJnZXQgY2hhbmdlLlxuICAgICAqIEBwYXJhbSBkb2NDaGFuZ2VzIC0gVGhlIHNldCBvZiBjaGFuZ2VzIHRvIG1ha2UgdG8gdGhlIHZpZXcncyBkb2NzLlxuICAgICAqIEBwYXJhbSB1cGRhdGVMaW1ib0RvY3VtZW50cyAtIFdoZXRoZXIgdG8gdXBkYXRlIGxpbWJvIGRvY3VtZW50cyBiYXNlZCBvblxuICAgICAqICAgICAgICB0aGlzIGNoYW5nZS5cbiAgICAgKiBAcGFyYW0gdGFyZ2V0Q2hhbmdlIC0gQSB0YXJnZXQgY2hhbmdlIHRvIGFwcGx5IGZvciBjb21wdXRpbmcgbGltYm8gZG9jcyBhbmRcbiAgICAgKiAgICAgICAgc3luYyBzdGF0ZS5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyBWaWV3Q2hhbmdlIHdpdGggdGhlIGdpdmVuIGRvY3MsIGNoYW5nZXMsIGFuZCBzeW5jIHN0YXRlLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIGlPUy9BbmRyb2lkIGNsaWVudHMgYWx3YXlzIGNvbXB1dGUgbGltYm8gZG9jdW1lbnQgY2hhbmdlcy5cbiAgICBhcHBseUNoYW5nZXModCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gdGhpcy5RdTtcbiAgICAgICAgdGhpcy5RdSA9IHQuUXUsIHRoaXMubXV0YXRlZEtleXMgPSB0Lm11dGF0ZWRLZXlzO1xuICAgICAgICAvLyBTb3J0IGNoYW5nZXMgYmFzZWQgb24gdHlwZSBhbmQgcXVlcnkgY29tcGFyYXRvclxuICAgICAgICBjb25zdCBpID0gdC56dS5FdSgpO1xuICAgICAgICBpLnNvcnQoKCh0LCBlKSA9PiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAxO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA6XG4gICAgICAgICAgICAgICAgICBjYXNlIDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyA6XG4gICAgICAgICAgICAgICAgICAgIC8vIEEgbWV0YWRhdGEgY2hhbmdlIGlzIGNvbnZlcnRlZCB0byBhIG1vZGlmaWVkIGNoYW5nZSBhdCB0aGUgcHVibGljXG4gICAgICAgICAgICAgICAgICAgIC8vIGFwaSBsYXllci4gIFNpbmNlIHdlIHNvcnQgYnkgZG9jdW1lbnQga2V5IGFuZCB0aGVuIGNoYW5nZSB0eXBlLFxuICAgICAgICAgICAgICAgICAgICAvLyBtZXRhZGF0YSBhbmQgbW9kaWZpZWQgY2hhbmdlcyBtdXN0IGJlIHNvcnRlZCBlcXVpdmFsZW50bHkuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovIDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG5cbiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJldHVybiBuKHQpIC0gbihlKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAodC50eXBlLCBlLnR5cGUpIHx8IHRoaXMuR3UodC5kb2MsIGUuZG9jKSkpLCB0aGlzLkp1KG4pO1xuICAgICAgICBjb25zdCByID0gZSA/IHRoaXMuWXUoKSA6IFtdLCBvID0gMCA9PT0gdGhpcy5LdS5zaXplICYmIHRoaXMuY3VycmVudCA/IDEgLyogU3luY1N0YXRlLlN5bmNlZCAqLyA6IDAgLyogU3luY1N0YXRlLkxvY2FsICovICwgdSA9IG8gIT09IHRoaXMuVXU7XG4gICAgICAgIGlmICh0aGlzLlV1ID0gbywgMCAhPT0gaS5sZW5ndGggfHwgdSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzbmFwc2hvdDogbmV3IG9jKHRoaXMucXVlcnksIHQuUXUsIHMsIGksIHQubXV0YXRlZEtleXMsIDAgLyogU3luY1N0YXRlLkxvY2FsICovID09PSBvLCB1LCBcbiAgICAgICAgICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsICEhbiAmJiBuLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDApLFxuICAgICAgICAgICAgICAgIFh1OiByXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vIGNoYW5nZXNcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIFh1OiByXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYW4gT25saW5lU3RhdGUgY2hhbmdlIHRvIHRoZSB2aWV3LCBwb3RlbnRpYWxseSBnZW5lcmF0aW5nIGFcbiAgICAgKiBWaWV3Q2hhbmdlIGlmIHRoZSB2aWV3J3Mgc3luY1N0YXRlIGNoYW5nZXMgYXMgYSByZXN1bHQuXG4gICAgICovICAgIGJ1KHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCAmJiBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovID09PSB0ID8gKFxuICAgICAgICAvLyBJZiB3ZSdyZSBvZmZsaW5lLCBzZXQgYGN1cnJlbnRgIHRvIGZhbHNlIGFuZCB0aGVuIGNhbGwgYXBwbHlDaGFuZ2VzKClcbiAgICAgICAgLy8gdG8gcmVmcmVzaCBvdXIgc3luY1N0YXRlIGFuZCBnZW5lcmF0ZSBhIFZpZXdDaGFuZ2UgYXMgYXBwcm9wcmlhdGUuIFdlXG4gICAgICAgIC8vIGFyZSBndWFyYW50ZWVkIHRvIGdldCBhIG5ldyBUYXJnZXRDaGFuZ2UgdGhhdCBzZXRzIGBjdXJyZW50YCBiYWNrIHRvXG4gICAgICAgIC8vIHRydWUgb25jZSB0aGUgY2xpZW50IGlzIGJhY2sgb25saW5lLlxuICAgICAgICB0aGlzLmN1cnJlbnQgPSAhMSwgdGhpcy5hcHBseUNoYW5nZXMoe1xuICAgICAgICAgICAgUXU6IHRoaXMuUXUsXG4gICAgICAgICAgICB6dTogbmV3IHJjLFxuICAgICAgICAgICAgbXV0YXRlZEtleXM6IHRoaXMubXV0YXRlZEtleXMsXG4gICAgICAgICAgICAkaTogITFcbiAgICAgICAgfSwgXG4gICAgICAgIC8qIHVwZGF0ZUxpbWJvRG9jdW1lbnRzPSAqLyAhMSkpIDoge1xuICAgICAgICAgICAgWHU6IFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgZG9jIGZvciB0aGUgZ2l2ZW4ga2V5IHNob3VsZCBiZSBpbiBsaW1iby5cbiAgICAgKi8gICAgWnUodCkge1xuICAgICAgICAvLyBJZiB0aGUgcmVtb3RlIGVuZCBzYXlzIGl0J3MgcGFydCBvZiB0aGlzIHF1ZXJ5LCBpdCdzIG5vdCBpbiBsaW1iby5cbiAgICAgICAgcmV0dXJuICF0aGlzLnF1Lmhhcyh0KSAmJiAoXG4gICAgICAgIC8vIFRoZSBsb2NhbCBzdG9yZSBkb2Vzbid0IHRoaW5rIGl0J3MgYSByZXN1bHQsIHNvIGl0IHNob3VsZG4ndCBiZSBpbiBsaW1iby5cbiAgICAgICAgISF0aGlzLlF1Lmhhcyh0KSAmJiAhdGhpcy5RdS5nZXQodCkuaGFzTG9jYWxNdXRhdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHN5bmNlZERvY3VtZW50cywgY3VycmVudCwgYW5kIGxpbWJvIGRvY3MgYmFzZWQgb24gdGhlIGdpdmVuIGNoYW5nZS5cbiAgICAgKiBSZXR1cm5zIHRoZSBsaXN0IG9mIGNoYW5nZXMgdG8gd2hpY2ggZG9jcyBhcmUgaW4gbGltYm8uXG4gICAgICovICAgIEp1KHQpIHtcbiAgICAgICAgdCAmJiAodC5hZGRlZERvY3VtZW50cy5mb3JFYWNoKCh0ID0+IHRoaXMucXUgPSB0aGlzLnF1LmFkZCh0KSkpLCB0Lm1vZGlmaWVkRG9jdW1lbnRzLmZvckVhY2goKHQgPT4ge30pKSwgXG4gICAgICAgIHQucmVtb3ZlZERvY3VtZW50cy5mb3JFYWNoKCh0ID0+IHRoaXMucXUgPSB0aGlzLnF1LmRlbGV0ZSh0KSkpLCB0aGlzLmN1cnJlbnQgPSB0LmN1cnJlbnQpO1xuICAgIH1cbiAgICBZdSgpIHtcbiAgICAgICAgLy8gV2UgY2FuIG9ubHkgZGV0ZXJtaW5lIGxpbWJvIGRvY3VtZW50cyB3aGVuIHdlJ3JlIGluLXN5bmMgd2l0aCB0aGUgc2VydmVyLlxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudCkgcmV0dXJuIFtdO1xuICAgICAgICAvLyBUT0RPKGtsaW10KTogRG8gdGhpcyBpbmNyZW1lbnRhbGx5IHNvIHRoYXQgaXQncyBub3QgcXVhZHJhdGljIHdoZW5cbiAgICAgICAgLy8gdXBkYXRpbmcgbWFueSBkb2N1bWVudHMuXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuS3U7XG4gICAgICAgIHRoaXMuS3UgPSBFcygpLCB0aGlzLlF1LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5adSh0LmtleSkgJiYgKHRoaXMuS3UgPSB0aGlzLkt1LmFkZCh0LmtleSkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIC8vIERpZmYgdGhlIG5ldyBsaW1ibyBkb2NzIHdpdGggdGhlIG9sZCBsaW1ibyBkb2NzLlxuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5LdS5oYXModCkgfHwgZS5wdXNoKG5ldyBJYyh0KSk7XG4gICAgICAgIH0pKSwgdGhpcy5LdS5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIHQuaGFzKG4pIHx8IGUucHVzaChuZXcgcGMobikpO1xuICAgICAgICB9KSksIGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgaW4tbWVtb3J5IHN0YXRlIG9mIHRoZSBjdXJyZW50IHZpZXcgd2l0aCB0aGUgc3RhdGUgcmVhZCBmcm9tXG4gICAgICogcGVyc2lzdGVuY2UuXG4gICAgICpcbiAgICAgKiBXZSB1cGRhdGUgdGhlIHF1ZXJ5IHZpZXcgd2hlbmV2ZXIgYSBjbGllbnQncyBwcmltYXJ5IHN0YXR1cyBjaGFuZ2VzOlxuICAgICAqIC0gV2hlbiBhIGNsaWVudCB0cmFuc2l0aW9ucyBmcm9tIHByaW1hcnkgdG8gc2Vjb25kYXJ5LCBpdCBjYW4gbWlzc1xuICAgICAqICAgTG9jYWxTdG9yYWdlIHVwZGF0ZXMgYW5kIGl0cyBxdWVyeSB2aWV3cyBtYXkgdGVtcG9yYXJpbHkgbm90IGJlXG4gICAgICogICBzeW5jaHJvbml6ZWQgd2l0aCB0aGUgc3RhdGUgb24gZGlzay5cbiAgICAgKiAtIEZvciBzZWNvbmRhcnkgdG8gcHJpbWFyeSB0cmFuc2l0aW9ucywgdGhlIGNsaWVudCBuZWVkcyB0byB1cGRhdGUgdGhlIGxpc3RcbiAgICAgKiAgIG9mIGBzeW5jZWREb2N1bWVudHNgIHNpbmNlIHNlY29uZGFyeSBjbGllbnRzIHVwZGF0ZSB0aGVpciBxdWVyeSB2aWV3c1xuICAgICAqICAgYmFzZWQgcHVyZWx5IG9uIHN5bnRoZXNpemVkIFJlbW90ZUV2ZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBxdWVyeVJlc3VsdC5kb2N1bWVudHMgLSBUaGUgZG9jdW1lbnRzIHRoYXQgbWF0Y2ggdGhlIHF1ZXJ5IGFjY29yZGluZ1xuICAgICAqIHRvIHRoZSBMb2NhbFN0b3JlLlxuICAgICAqIEBwYXJhbSBxdWVyeVJlc3VsdC5yZW1vdGVLZXlzIC0gVGhlIGtleXMgb2YgdGhlIGRvY3VtZW50cyB0aGF0IG1hdGNoIHRoZVxuICAgICAqIHF1ZXJ5IGFjY29yZGluZyB0byB0aGUgYmFja2VuZC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBWaWV3Q2hhbmdlIHRoYXQgcmVzdWx0ZWQgZnJvbSB0aGlzIHN5bmNocm9uaXphdGlvbi5cbiAgICAgKi9cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgIHRjKHQpIHtcbiAgICAgICAgdGhpcy5xdSA9IHQuSGksIHRoaXMuS3UgPSBFcygpO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5XdSh0LmRvY3VtZW50cyk7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGx5Q2hhbmdlcyhlLCAvKnVwZGF0ZUxpbWJvRG9jdW1lbnRzPSovICEwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZpZXcgc25hcHNob3QgYXMgaWYgdGhpcyBxdWVyeSB3YXMganVzdCBsaXN0ZW5lZCB0by4gQ29udGFpbnNcbiAgICAgKiBhIGRvY3VtZW50IGFkZCBmb3IgZXZlcnkgZXhpc3RpbmcgZG9jdW1lbnQgYW5kIHRoZSBgZnJvbUNhY2hlYCBhbmRcbiAgICAgKiBgaGFzUGVuZGluZ1dyaXRlc2Agc3RhdHVzIG9mIHRoZSBhbHJlYWR5IGVzdGFibGlzaGVkIHZpZXcuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBlYygpIHtcbiAgICAgICAgcmV0dXJuIG9jLmZyb21Jbml0aWFsRG9jdW1lbnRzKHRoaXMucXVlcnksIHRoaXMuUXUsIHRoaXMubXV0YXRlZEtleXMsIDAgLyogU3luY1N0YXRlLkxvY2FsICovID09PSB0aGlzLlV1LCB0aGlzLmhhc0NhY2hlZFJlc3VsdHMpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBRdWVyeVZpZXcgY29udGFpbnMgYWxsIG9mIHRoZSBkYXRhIHRoYXQgU3luY0VuZ2luZSBuZWVkcyB0byBrZWVwIHRyYWNrIG9mIGZvclxuICogYSBwYXJ0aWN1bGFyIHF1ZXJ5LlxuICovXG5jbGFzcyBFYyB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIHF1ZXJ5IGl0c2VsZi5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBUaGUgdGFyZ2V0IG51bWJlciBjcmVhdGVkIGJ5IHRoZSBjbGllbnQgdGhhdCBpcyB1c2VkIGluIHRoZSB3YXRjaFxuICAgICAqIHN0cmVhbSB0byBpZGVudGlmeSB0aGlzIHF1ZXJ5LlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSB2aWV3IGlzIHJlc3BvbnNpYmxlIGZvciBjb21wdXRpbmcgdGhlIGZpbmFsIG1lcmdlZCB0cnV0aCBvZiB3aGF0XG4gICAgICogZG9jcyBhcmUgaW4gdGhlIHF1ZXJ5LiBJdCBnZXRzIG5vdGlmaWVkIG9mIGxvY2FsIGFuZCByZW1vdGUgY2hhbmdlcyxcbiAgICAgKiBhbmQgYXBwbGllcyB0aGUgcXVlcnkgZmlsdGVycyBhbmQgbGltaXRzIHRvIGRldGVybWluZSB0aGUgbW9zdCBjb3JyZWN0XG4gICAgICogcG9zc2libGUgcmVzdWx0cy5cbiAgICAgKi9cbiAgICBuKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSB0LCB0aGlzLnRhcmdldElkID0gZSwgdGhpcy52aWV3ID0gbjtcbiAgICB9XG59XG5cbi8qKiBUcmFja3MgYSBsaW1ibyByZXNvbHV0aW9uLiAqLyBjbGFzcyBBYyB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLmtleSA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IHRvIHRydWUgb25jZSB3ZSd2ZSByZWNlaXZlZCBhIGRvY3VtZW50LiBUaGlzIGlzIHVzZWQgaW5cbiAgICAgICAgICogZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCgpIGFuZCB1bHRpbWF0ZWx5IHVzZWQgYnkgV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yIHRvXG4gICAgICAgICAqIGRlY2lkZSB3aGV0aGVyIGl0IG5lZWRzIHRvIG1hbnVmYWN0dXJlIGEgZGVsZXRlIGV2ZW50IGZvciB0aGUgdGFyZ2V0IG9uY2VcbiAgICAgICAgICogdGhlIHRhcmdldCBpcyBDVVJSRU5ULlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYyA9ICExO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBgU3luY0VuZ2luZWAgY29vcmRpbmF0aW5nIHdpdGggb3RoZXIgcGFydHMgb2YgU0RLLlxuICpcbiAqIFRoZSBwYXJ0cyBvZiBTeW5jRW5naW5lIHRoYXQgYWN0IGFzIGEgY2FsbGJhY2sgdG8gUmVtb3RlU3RvcmUgbmVlZCB0byBiZVxuICogcmVnaXN0ZXJlZCBpbmRpdmlkdWFsbHkuIFRoaXMgaXMgZG9uZSBpbiBgc3luY0VuZ2luZVdyaXRlKClgIGFuZFxuICogYHN5bmNFbmdpbmVMaXN0ZW4oKWAgKGFzIHdlbGwgYXMgYGFwcGx5UHJpbWFyeVN0YXRlKClgKSBhcyB0aGVzZSBtZXRob2RzXG4gKiBzZXJ2ZSBhcyBlbnRyeSBwb2ludHMgdG8gUmVtb3RlU3RvcmUncyBmdW5jdGlvbmFsaXR5LlxuICpcbiAqIE5vdGU6IHNvbWUgZmllbGQgZGVmaW5lZCBpbiB0aGlzIGNsYXNzIG1pZ2h0IGhhdmUgcHVibGljIGFjY2VzcyBsZXZlbCwgYnV0XG4gKiB0aGUgY2xhc3MgaXMgbm90IGV4cG9ydGVkIHNvIHRoZXkgYXJlIG9ubHkgYWNjZXNzaWJsZSBmcm9tIHRoaXMgbW9kdWxlLlxuICogVGhpcyBpcyB1c2VmdWwgdG8gaW1wbGVtZW50IG9wdGlvbmFsIGZlYXR1cmVzIChsaWtlIGJ1bmRsZXMpIGluIGZyZWVcbiAqIGZ1bmN0aW9ucywgc3VjaCB0aGF0IHRoZXkgYXJlIHRyZWUtc2hha2VhYmxlLlxuICovIGNsYXNzIFJjIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBcbiAgICAvLyBQT1JUSU5HIE5PVEU6IE1hbmFnZXMgc3RhdGUgc3luY2hyb25pemF0aW9uIGluIG11bHRpLXRhYiBlbnZpcm9ubWVudHMuXG4gICAgcywgaSwgcikge1xuICAgICAgICB0aGlzLmxvY2FsU3RvcmUgPSB0LCB0aGlzLnJlbW90ZVN0b3JlID0gZSwgdGhpcy5ldmVudE1hbmFnZXIgPSBuLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlID0gcywgXG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBpLCB0aGlzLm1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zID0gciwgdGhpcy5zYyA9IHt9LCB0aGlzLmljID0gbmV3IGxzKCh0ID0+IFRuKHQpKSwgSW4pLCBcbiAgICAgICAgdGhpcy5yYyA9IG5ldyBNYXAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGtleXMgb2YgZG9jdW1lbnRzIHRoYXQgYXJlIGluIGxpbWJvIGZvciB3aGljaCB3ZSBoYXZlbid0IHlldCBzdGFydGVkIGFcbiAgICAgICAgICogbGltYm8gcmVzb2x1dGlvbiBxdWVyeS4gVGhlIHN0cmluZ3MgaW4gdGhpcyBzZXQgYXJlIHRoZSByZXN1bHQgb2YgY2FsbGluZ1xuICAgICAgICAgKiBga2V5LnBhdGguY2Fub25pY2FsU3RyaW5nKClgIHdoZXJlIGBrZXlgIGlzIGEgYERvY3VtZW50S2V5YCBvYmplY3QuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZSBgU2V0YCB0eXBlIHdhcyBjaG9zZW4gYmVjYXVzZSBpdCBwcm92aWRlcyBlZmZpY2llbnQgbG9va3VwIGFuZCByZW1vdmFsXG4gICAgICAgICAqIG9mIGFyYml0cmFyeSBlbGVtZW50cyBhbmQgaXQgYWxzbyBtYWludGFpbnMgaW5zZXJ0aW9uIG9yZGVyLCBwcm92aWRpbmcgdGhlXG4gICAgICAgICAqIGRlc2lyZWQgcXVldWUtbGlrZSBGSUZPIHNlbWFudGljcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub2MgPSBuZXcgU2V0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXBzIHRyYWNrIG9mIHRoZSB0YXJnZXQgSUQgZm9yIGVhY2ggZG9jdW1lbnQgdGhhdCBpcyBpbiBsaW1ibyB3aXRoIGFuXG4gICAgICAgICAqIGFjdGl2ZSB0YXJnZXQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVjID0gbmV3IEdlKGN0LmNvbXBhcmF0b3IpLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXBzIHRyYWNrIG9mIHRoZSBpbmZvcm1hdGlvbiBhYm91dCBhbiBhY3RpdmUgbGltYm8gcmVzb2x1dGlvbiBmb3IgZWFjaFxuICAgICAgICAgKiBhY3RpdmUgdGFyZ2V0IElEIHRoYXQgd2FzIHN0YXJ0ZWQgZm9yIHRoZSBwdXJwb3NlIG9mIGxpbWJvIHJlc29sdXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNjID0gbmV3IE1hcCwgdGhpcy5hYyA9IG5ldyBFbywgXG4gICAgICAgIC8qKiBTdG9yZXMgdXNlciBjb21wbGV0aW9uIGhhbmRsZXJzLCBpbmRleGVkIGJ5IFVzZXIgYW5kIEJhdGNoSWQuICovXG4gICAgICAgIHRoaXMuaGMgPSB7fSwgXG4gICAgICAgIC8qKiBTdG9yZXMgdXNlciBjYWxsYmFja3Mgd2FpdGluZyBmb3IgYWxsIHBlbmRpbmcgd3JpdGVzIHRvIGJlIGFja25vd2xlZGdlZC4gKi9cbiAgICAgICAgdGhpcy5sYyA9IG5ldyBNYXAsIHRoaXMuZmMgPSBZci52bigpLCB0aGlzLm9ubGluZVN0YXRlID0gXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyAsIFxuICAgICAgICAvLyBUaGUgcHJpbWFyeSBzdGF0ZSBpcyBzZXQgdG8gYHRydWVgIG9yIGBmYWxzZWAgaW1tZWRpYXRlbHkgYWZ0ZXIgRmlyZXN0b3JlXG4gICAgICAgIC8vIHN0YXJ0dXAuIEluIHRoZSBpbnRlcmltLCBhIGNsaWVudCBzaG91bGQgb25seSBiZSBjb25zaWRlcmVkIHByaW1hcnkgaWZcbiAgICAgICAgLy8gYGlzUHJpbWFyeWAgaXMgdHJ1ZS5cbiAgICAgICAgdGhpcy5kYyA9IHZvaWQgMDtcbiAgICB9XG4gICAgZ2V0IGlzUHJpbWFyeUNsaWVudCgpIHtcbiAgICAgICAgcmV0dXJuICEwID09PSB0aGlzLmRjO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWF0ZXMgdGhlIG5ldyBsaXN0ZW4sIHJlc29sdmVzIHByb21pc2Ugd2hlbiBsaXN0ZW4gZW5xdWV1ZWQgdG8gdGhlXG4gKiBzZXJ2ZXIuIEFsbCB0aGUgc3Vic2VxdWVudCB2aWV3IHNuYXBzaG90cyBvciBlcnJvcnMgYXJlIHNlbnQgdG8gdGhlXG4gKiBzdWJzY3JpYmVkIGhhbmRsZXJzLiBSZXR1cm5zIHRoZSBpbml0aWFsIHNuYXBzaG90LlxuICovXG5hc3luYyBmdW5jdGlvbiBiYyh0LCBlKSB7XG4gICAgY29uc3QgbiA9IHRhKHQpO1xuICAgIGxldCBzLCBpO1xuICAgIGNvbnN0IHIgPSBuLmljLmdldChlKTtcbiAgICBpZiAocikgXG4gICAgLy8gUE9SVElORyBOT1RFOiBXaXRoIE11bHRpLVRhYiBXZWIsIGl0IGlzIHBvc3NpYmxlIHRoYXQgYSBxdWVyeSB2aWV3XG4gICAgLy8gYWxyZWFkeSBleGlzdHMgd2hlbiBFdmVudE1hbmFnZXIgY2FsbHMgdXMgZm9yIHRoZSBmaXJzdCB0aW1lLiBUaGlzXG4gICAgLy8gaGFwcGVucyB3aGVuIHRoZSBwcmltYXJ5IHRhYiBpcyBhbHJlYWR5IGxpc3RlbmluZyB0byB0aGlzIHF1ZXJ5IG9uXG4gICAgLy8gYmVoYWxmIG9mIGFub3RoZXIgdGFiIGFuZCB0aGUgdXNlciBvZiB0aGUgcHJpbWFyeSBhbHNvIHN0YXJ0cyBsaXN0ZW5pbmdcbiAgICAvLyB0byB0aGUgcXVlcnkuIEV2ZW50TWFuYWdlciB3aWxsIG5vdCBoYXZlIGFuIGFzc2lnbmVkIHRhcmdldCBJRCBpbiB0aGlzXG4gICAgLy8gY2FzZSBhbmQgY2FsbHMgYGxpc3RlbmAgdG8gb2J0YWluIHRoaXMgSUQuXG4gICAgcyA9IHIudGFyZ2V0SWQsIG4uc2hhcmVkQ2xpZW50U3RhdGUuYWRkTG9jYWxRdWVyeVRhcmdldChzKSwgaSA9IHIudmlldy5lYygpOyBlbHNlIHtcbiAgICAgICAgY29uc3QgdCA9IGF3YWl0IHpvKG4ubG9jYWxTdG9yZSwgZ24oZSkpO1xuICAgICAgICBuLmlzUHJpbWFyeUNsaWVudCAmJiBEdShuLnJlbW90ZVN0b3JlLCB0KTtcbiAgICAgICAgY29uc3QgciA9IG4uc2hhcmVkQ2xpZW50U3RhdGUuYWRkTG9jYWxRdWVyeVRhcmdldCh0LnRhcmdldElkKTtcbiAgICAgICAgcyA9IHQudGFyZ2V0SWQsIGkgPSBhd2FpdCBQYyhuLCBlLCBzLCBcImN1cnJlbnRcIiA9PT0gciwgdC5yZXN1bWVUb2tlbik7XG4gICAgfVxuICAgIHJldHVybiBpO1xufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIHZpZXcgZm9yIGEgcHJldmlvdXNseSB1bmtub3duIHF1ZXJ5IGFuZCBjb21wdXRlcyBpdHMgaW5pdGlhbFxuICogc25hcHNob3QuXG4gKi8gYXN5bmMgZnVuY3Rpb24gUGModCwgZSwgbiwgcywgaSkge1xuICAgIC8vIFBPUlRJTkcgTk9URTogT24gV2ViIG9ubHksIHdlIGluamVjdCB0aGUgY29kZSB0aGF0IHJlZ2lzdGVycyBuZXcgTGltYm9cbiAgICAvLyB0YXJnZXRzIGJhc2VkIG9uIHZpZXcgY2hhbmdlcy4gVGhpcyBhbGxvd3MgdXMgdG8gb25seSBkZXBlbmQgb24gTGltYm9cbiAgICAvLyBjaGFuZ2VzIHdoZW4gdXNlciBjb2RlIGluY2x1ZGVzIHF1ZXJpZXMuXG4gICAgdC5fYyA9IChlLCBuLCBzKSA9PiBhc3luYyBmdW5jdGlvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgIGxldCBpID0gZS52aWV3Lld1KG4pO1xuICAgICAgICBpLiRpICYmIChcbiAgICAgICAgLy8gVGhlIHF1ZXJ5IGhhcyBhIGxpbWl0IGFuZCBzb21lIGRvY3Mgd2VyZSByZW1vdmVkLCBzbyB3ZSBuZWVkXG4gICAgICAgIC8vIHRvIHJlLXJ1biB0aGUgcXVlcnkgYWdhaW5zdCB0aGUgbG9jYWwgc3RvcmUgdG8gbWFrZSBzdXJlIHdlXG4gICAgICAgIC8vIGRpZG4ndCBsb3NlIGFueSBnb29kIGRvY3MgdGhhdCBoYWQgYmVlbiBwYXN0IHRoZSBsaW1pdC5cbiAgICAgICAgaSA9IGF3YWl0IEpvKHQubG9jYWxTdG9yZSwgZS5xdWVyeSwgXG4gICAgICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITEpLnRoZW4oKCh7ZG9jdW1lbnRzOiB0fSkgPT4gZS52aWV3Lld1KHQsIGkpKSkpO1xuICAgICAgICBjb25zdCByID0gcyAmJiBzLnRhcmdldENoYW5nZXMuZ2V0KGUudGFyZ2V0SWQpLCBvID0gZS52aWV3LmFwcGx5Q2hhbmdlcyhpLCBcbiAgICAgICAgLyogdXBkYXRlTGltYm9Eb2N1bWVudHM9ICovIHQuaXNQcmltYXJ5Q2xpZW50LCByKTtcbiAgICAgICAgcmV0dXJuIEJjKHQsIGUudGFyZ2V0SWQsIG8uWHUpLCBvLnNuYXBzaG90O1xuICAgIH0odCwgZSwgbiwgcyk7XG4gICAgY29uc3QgciA9IGF3YWl0IEpvKHQubG9jYWxTdG9yZSwgZSwgXG4gICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMCksIG8gPSBuZXcgVGMoZSwgci5IaSksIHUgPSBvLld1KHIuZG9jdW1lbnRzKSwgYyA9IFBzLmNyZWF0ZVN5bnRoZXNpemVkVGFyZ2V0Q2hhbmdlRm9yQ3VycmVudENoYW5nZShuLCBzICYmIFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8gIT09IHQub25saW5lU3RhdGUsIGkpLCBhID0gby5hcHBseUNoYW5nZXModSwgXG4gICAgLyogdXBkYXRlTGltYm9Eb2N1bWVudHM9ICovIHQuaXNQcmltYXJ5Q2xpZW50LCBjKTtcbiAgICBCYyh0LCBuLCBhLlh1KTtcbiAgICBjb25zdCBoID0gbmV3IEVjKGUsIG4sIG8pO1xuICAgIHJldHVybiB0LmljLnNldChlLCBoKSwgdC5yYy5oYXMobikgPyB0LnJjLmdldChuKS5wdXNoKGUpIDogdC5yYy5zZXQobiwgWyBlIF0pLCBhLnNuYXBzaG90O1xufVxuXG4vKiogU3RvcHMgbGlzdGVuaW5nIHRvIHRoZSBxdWVyeS4gKi8gYXN5bmMgZnVuY3Rpb24gdmModCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gbi5pYy5nZXQoZSksIGkgPSBuLnJjLmdldChzLnRhcmdldElkKTtcbiAgICBpZiAoaS5sZW5ndGggPiAxKSByZXR1cm4gbi5yYy5zZXQocy50YXJnZXRJZCwgaS5maWx0ZXIoKHQgPT4gIUluKHQsIGUpKSkpLCB2b2lkIG4uaWMuZGVsZXRlKGUpO1xuICAgIC8vIE5vIG90aGVyIHF1ZXJpZXMgYXJlIG1hcHBlZCB0byB0aGUgdGFyZ2V0LCBjbGVhbiB1cCB0aGUgcXVlcnkgYW5kIHRoZSB0YXJnZXQuXG4gICAgICAgIGlmIChuLmlzUHJpbWFyeUNsaWVudCkge1xuICAgICAgICAvLyBXZSBuZWVkIHRvIHJlbW92ZSB0aGUgbG9jYWwgcXVlcnkgdGFyZ2V0IGZpcnN0IHRvIGFsbG93IHVzIHRvIHZlcmlmeVxuICAgICAgICAvLyB3aGV0aGVyIGFueSBvdGhlciBjbGllbnQgaXMgc3RpbGwgaW50ZXJlc3RlZCBpbiB0aGlzIHRhcmdldC5cbiAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5yZW1vdmVMb2NhbFF1ZXJ5VGFyZ2V0KHMudGFyZ2V0SWQpO1xuICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLmlzQWN0aXZlUXVlcnlUYXJnZXQocy50YXJnZXRJZCkgfHwgYXdhaXQgSG8obi5sb2NhbFN0b3JlLCBzLnRhcmdldElkLCBcbiAgICAgICAgLyprZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YT0qLyAhMSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5jbGVhclF1ZXJ5U3RhdGUocy50YXJnZXRJZCksIEN1KG4ucmVtb3RlU3RvcmUsIHMudGFyZ2V0SWQpLCBcbiAgICAgICAgICAgIEZjKG4sIHMudGFyZ2V0SWQpO1xuICAgICAgICB9KSkuY2F0Y2goRXQpO1xuICAgIH0gZWxzZSBGYyhuLCBzLnRhcmdldElkKSwgYXdhaXQgSG8obi5sb2NhbFN0b3JlLCBzLnRhcmdldElkLCBcbiAgICAvKmtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhPSovICEwKTtcbn1cblxuLyoqXG4gKiBJbml0aWF0ZXMgdGhlIHdyaXRlIG9mIGxvY2FsIG11dGF0aW9uIGJhdGNoIHdoaWNoIGludm9sdmVzIGFkZGluZyB0aGVcbiAqIHdyaXRlcyB0byB0aGUgbXV0YXRpb24gcXVldWUsIG5vdGlmeWluZyB0aGUgcmVtb3RlIHN0b3JlIGFib3V0IG5ld1xuICogbXV0YXRpb25zIGFuZCByYWlzaW5nIGV2ZW50cyBmb3IgYW55IGNoYW5nZXMgdGhpcyB3cml0ZSBjYXVzZWQuXG4gKlxuICogVGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhpcyBjYWxsIGlzIHJlc29sdmVkIHdoZW4gdGhlIGFib3ZlIHN0ZXBzXG4gKiBoYXZlIGNvbXBsZXRlZCwgKm5vdCogd2hlbiB0aGUgd3JpdGUgd2FzIGFja2VkIGJ5IHRoZSBiYWNrZW5kLiBUaGVcbiAqIHVzZXJDYWxsYmFjayBpcyByZXNvbHZlZCBvbmNlIHRoZSB3cml0ZSB3YXMgYWNrZWQvcmVqZWN0ZWQgYnkgdGhlXG4gKiBiYWNrZW5kIChvciBmYWlsZWQgbG9jYWxseSBmb3IgYW55IG90aGVyIHJlYXNvbikuXG4gKi8gYXN5bmMgZnVuY3Rpb24gVmModCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBlYSh0KTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9ICQodCksIHMgPSBudC5ub3coKSwgaSA9IGUucmVkdWNlKCgodCwgZSkgPT4gdC5hZGQoZS5rZXkpKSwgRXMoKSk7XG4gICAgICAgICAgICBsZXQgciwgbztcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiTG9jYWxseSB3cml0ZSBtdXRhdGlvbnNcIiwgXCJyZWFkd3JpdGVcIiwgKHQgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2gga2V5cyBkbyBub3QgaGF2ZSBhIHJlbW90ZSB2ZXJzaW9uIGluIHRoZSBjYWNoZSwgdGhpc1xuICAgICAgICAgICAgICAgIC8vIGlzIG5lZWRlZCB0byBjcmVhdGUgdGhlIHJpZ2h0IG92ZXJsYXkgbXV0YXRpb246IGlmIG5vIHJlbW90ZSB2ZXJzaW9uXG4gICAgICAgICAgICAgICAgLy8gcHJlc2VudHMsIHdlIGRvIG5vdCBuZWVkIHRvIGNyZWF0ZSBvdmVybGF5cyBhcyBwYXRjaCBtdXRhdGlvbnMuXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhPdmVybGF5KTogSXMgdGhlcmUgYSBiZXR0ZXIgd2F5IHRvIGRldGVybWluZSB0aGlzPyBVc2luZyB0aGVcbiAgICAgICAgICAgICAgICAvLyAgZG9jdW1lbnQgdmVyc2lvbiBkb2VzIG5vdCB3b3JrIGJlY2F1c2UgbG9jYWwgbXV0YXRpb25zIHNldCB0aGVtIGJhY2tcbiAgICAgICAgICAgICAgICAvLyAgdG8gMC5cbiAgICAgICAgICAgICAgICBsZXQgdSA9IGRzKCksIGMgPSBFcygpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLkdpLmdldEVudHJpZXModCwgaSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHUgPSB0LCB1LmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmlzVmFsaWREb2N1bWVudCgpIHx8IChjID0gYy5hZGQodCkpO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0T3ZlcmxheWVkRG9jdW1lbnRzKHQsIHUpKSkubmV4dCgoaSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHIgPSBpO1xuICAgICAgICAgICAgICAgICAgICAvLyBGb3Igbm9uLWlkZW1wb3RlbnQgbXV0YXRpb25zIChzdWNoIGFzIGBGaWVsZFZhbHVlLmluY3JlbWVudCgpYCksXG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIHJlY29yZCB0aGUgYmFzZSBzdGF0ZSBpbiBhIHNlcGFyYXRlIHBhdGNoIG11dGF0aW9uLiBUaGlzIGlzXG4gICAgICAgICAgICAgICAgICAgIC8vIGxhdGVyIHVzZWQgdG8gZ3VhcmFudGVlIGNvbnNpc3RlbnQgdmFsdWVzIGFuZCBwcmV2ZW50cyBmbGlja2VyXG4gICAgICAgICAgICAgICAgICAgIC8vIGV2ZW4gaWYgdGhlIGJhY2tlbmQgc2VuZHMgdXMgYW4gdXBkYXRlIHRoYXQgYWxyZWFkeSBpbmNsdWRlcyBvdXJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNmb3JtLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gWW4odCwgci5nZXQodC5rZXkpLm92ZXJsYXllZERvY3VtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwgIT0gZSAmJiBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5PVEU6IFRoZSBiYXNlIHN0YXRlIHNob3VsZCBvbmx5IGJlIGFwcGxpZWQgaWYgdGhlcmUncyBzb21lXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBleGlzdGluZyBkb2N1bWVudCB0byBvdmVycmlkZSwgc28gdXNlIGEgUHJlY29uZGl0aW9uIG9mXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBleGlzdHM9dHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgby5wdXNoKG5ldyB0cyh0LmtleSwgZSwgWGUoZS52YWx1ZS5tYXBWYWx1ZSksIFFuLmV4aXN0cyghMCkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5tdXRhdGlvblF1ZXVlLmFkZE11dGF0aW9uQmF0Y2godCwgcywgbywgZSk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvID0gZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IGUuYXBwbHlUb0xvY2FsRG9jdW1lbnRTZXQociwgYyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmRvY3VtZW50T3ZlcmxheUNhY2hlLnNhdmVPdmVybGF5cyh0LCBlLmJhdGNoSWQsIHMpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKS50aGVuKCgoKSA9PiAoe1xuICAgICAgICAgICAgICAgIGJhdGNoSWQ6IG8uYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICBjaGFuZ2VzOiBtcyhyKVxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfShzLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICBzLnNoYXJlZENsaWVudFN0YXRlLmFkZFBlbmRpbmdNdXRhdGlvbih0LmJhdGNoSWQpLCBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgICAgICBsZXQgcyA9IHQuaGNbdC5jdXJyZW50VXNlci50b0tleSgpXTtcbiAgICAgICAgICAgIHMgfHwgKHMgPSBuZXcgR2UoWikpO1xuICAgICAgICAgICAgcyA9IHMuaW5zZXJ0KGUsIG4pLCB0LmhjW3QuY3VycmVudFVzZXIudG9LZXkoKV0gPSBzO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmVzb2x2ZXMgb3IgcmVqZWN0cyB0aGUgdXNlciBjYWxsYmFjayBmb3IgdGhlIGdpdmVuIGJhdGNoIGFuZCB0aGVuIGRpc2NhcmRzXG4gKiBpdC5cbiAqLyAocywgdC5iYXRjaElkLCBuKSwgYXdhaXQgVWMocywgdC5jaGFuZ2VzKSwgYXdhaXQgS3Uocy5yZW1vdGVTdG9yZSk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICAvLyBJZiB3ZSBjYW4ndCBwZXJzaXN0IHRoZSBtdXRhdGlvbiwgd2UgcmVqZWN0IHRoZSB1c2VyIGNhbGxiYWNrIGFuZFxuICAgICAgICAvLyBkb24ndCBzZW5kIHRoZSBtdXRhdGlvbi4gVGhlIHVzZXIgY2FuIHRoZW4gcmV0cnkgdGhlIHdyaXRlLlxuICAgICAgICBjb25zdCBlID0gc2ModCwgXCJGYWlsZWQgdG8gcGVyc2lzdCB3cml0ZVwiKTtcbiAgICAgICAgbi5yZWplY3QoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgb25lIHJlbW90ZSBldmVudCB0byB0aGUgc3luYyBlbmdpbmUsIG5vdGlmeWluZyBhbnkgdmlld3Mgb2YgdGhlXG4gKiBjaGFuZ2VzLCBhbmQgcmVsZWFzaW5nIGFueSBwZW5kaW5nIG11dGF0aW9uIGJhdGNoZXMgdGhhdCB3b3VsZCBiZWNvbWVcbiAqIHZpc2libGUgYmVjYXVzZSBvZiB0aGUgc25hcHNob3QgdmVyc2lvbiB0aGUgcmVtb3RlIGV2ZW50IGNvbnRhaW5zLlxuICovIGFzeW5jIGZ1bmN0aW9uIFNjKHQsIGUpIHtcbiAgICBjb25zdCBuID0gJCh0KTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgUW8obi5sb2NhbFN0b3JlLCBlKTtcbiAgICAgICAgLy8gVXBkYXRlIGByZWNlaXZlZERvY3VtZW50YCBhcyBhcHByb3ByaWF0ZSBmb3IgYW55IGxpbWJvIHRhcmdldHMuXG4gICAgICAgICAgICAgICAgZS50YXJnZXRDaGFuZ2VzLmZvckVhY2goKCh0LCBlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gbi5jYy5nZXQoZSk7XG4gICAgICAgICAgICBzICYmIChcbiAgICAgICAgICAgIC8vIFNpbmNlIHRoaXMgaXMgYSBsaW1ibyByZXNvbHV0aW9uIGxvb2t1cCwgaXQncyBmb3IgYSBzaW5nbGUgZG9jdW1lbnRcbiAgICAgICAgICAgIC8vIGFuZCBpdCBjb3VsZCBiZSBhZGRlZCwgbW9kaWZpZWQsIG9yIHJlbW92ZWQsIGJ1dCBub3QgYSBjb21iaW5hdGlvbi5cbiAgICAgICAgICAgIE0odC5hZGRlZERvY3VtZW50cy5zaXplICsgdC5tb2RpZmllZERvY3VtZW50cy5zaXplICsgdC5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPD0gMSksIFxuICAgICAgICAgICAgdC5hZGRlZERvY3VtZW50cy5zaXplID4gMCA/IHMubmMgPSAhMCA6IHQubW9kaWZpZWREb2N1bWVudHMuc2l6ZSA+IDAgPyBNKHMubmMpIDogdC5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPiAwICYmIChNKHMubmMpLCBcbiAgICAgICAgICAgIHMubmMgPSAhMSkpO1xuICAgICAgICB9KSksIGF3YWl0IFVjKG4sIHQsIGUpO1xuICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgYXdhaXQgRXQodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgYW4gT25saW5lU3RhdGUgY2hhbmdlIHRvIHRoZSBzeW5jIGVuZ2luZSBhbmQgbm90aWZpZXMgYW55IHZpZXdzIG9mXG4gKiB0aGUgY2hhbmdlLlxuICovIGZ1bmN0aW9uIERjKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gJCh0KTtcbiAgICAvLyBJZiB3ZSBhcmUgdGhlIHNlY29uZGFyeSBjbGllbnQsIHdlIGV4cGxpY2l0bHkgaWdub3JlIHRoZSByZW1vdGUgc3RvcmUnc1xuICAgIC8vIG9ubGluZSBzdGF0ZSAodGhlIGxvY2FsIGNsaWVudCBtYXkgZ28gb2ZmbGluZSwgZXZlbiB0aG91Z2ggdGhlIHByaW1hcnlcbiAgICAvLyB0YWIgcmVtYWlucyBvbmxpbmUpIGFuZCBvbmx5IGFwcGx5IHRoZSBwcmltYXJ5IHRhYidzIG9ubGluZSBzdGF0ZSBmcm9tXG4gICAgLy8gU2hhcmVkQ2xpZW50U3RhdGUuXG4gICAgICAgIGlmIChzLmlzUHJpbWFyeUNsaWVudCAmJiAwIC8qIE9ubGluZVN0YXRlU291cmNlLlJlbW90ZVN0b3JlICovID09PSBuIHx8ICFzLmlzUHJpbWFyeUNsaWVudCAmJiAxIC8qIE9ubGluZVN0YXRlU291cmNlLlNoYXJlZENsaWVudFN0YXRlICovID09PSBuKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgcy5pYy5mb3JFYWNoKCgobiwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHMudmlldy5idShlKTtcbiAgICAgICAgICAgIGkuc25hcHNob3QgJiYgdC5wdXNoKGkuc25hcHNob3QpO1xuICAgICAgICB9KSksIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgICAgICAgICAgbi5vbmxpbmVTdGF0ZSA9IGU7XG4gICAgICAgICAgICBsZXQgcyA9ICExO1xuICAgICAgICAgICAgbi5xdWVyaWVzLmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIG4ubGlzdGVuZXJzKSBcbiAgICAgICAgICAgICAgICAvLyBSdW4gZ2xvYmFsIHNuYXBzaG90IGxpc3RlbmVycyBpZiBhIGNvbnNpc3RlbnQgc25hcHNob3QgaGFzIGJlZW4gZW1pdHRlZC5cbiAgICAgICAgICAgICAgICB0LmJ1KGUpICYmIChzID0gITApO1xuICAgICAgICAgICAgfSkpLCBzICYmIGRjKG4pO1xuICAgICAgICB9KHMuZXZlbnRNYW5hZ2VyLCBlKSwgdC5sZW5ndGggJiYgcy5zYy5Xbyh0KSwgcy5vbmxpbmVTdGF0ZSA9IGUsIHMuaXNQcmltYXJ5Q2xpZW50ICYmIHMuc2hhcmVkQ2xpZW50U3RhdGUuc2V0T25saW5lU3RhdGUoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlamVjdHMgdGhlIGxpc3RlbiBmb3IgdGhlIGdpdmVuIHRhcmdldElELiBUaGlzIGNhbiBiZSB0cmlnZ2VyZWQgYnkgdGhlXG4gKiBiYWNrZW5kIGZvciBhbnkgYWN0aXZlIHRhcmdldC5cbiAqXG4gKiBAcGFyYW0gc3luY0VuZ2luZSAtIFRoZSBzeW5jIGVuZ2luZSBpbXBsZW1lbnRhdGlvbi5cbiAqIEBwYXJhbSB0YXJnZXRJZCAtIFRoZSB0YXJnZXRJRCBjb3JyZXNwb25kcyB0byBvbmUgcHJldmlvdXNseSBpbml0aWF0ZWQgYnkgdGhlXG4gKiB1c2VyIGFzIHBhcnQgb2YgVGFyZ2V0RGF0YSBwYXNzZWQgdG8gbGlzdGVuKCkgb24gUmVtb3RlU3RvcmUuXG4gKiBAcGFyYW0gZXJyIC0gQSBkZXNjcmlwdGlvbiBvZiB0aGUgY29uZGl0aW9uIHRoYXQgaGFzIGZvcmNlZCB0aGUgcmVqZWN0aW9uLlxuICogTmVhcmx5IGFsd2F5cyB0aGlzIHdpbGwgYmUgYW4gaW5kaWNhdGlvbiB0aGF0IHRoZSB1c2VyIGlzIG5vIGxvbmdlclxuICogYXV0aG9yaXplZCB0byBzZWUgdGhlIGRhdGEgbWF0Y2hpbmcgdGhlIHRhcmdldC5cbiAqLyBhc3luYyBmdW5jdGlvbiBDYyh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9ICQodCk7XG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICAgICAgcy5zaGFyZWRDbGllbnRTdGF0ZS51cGRhdGVRdWVyeVN0YXRlKGUsIFwicmVqZWN0ZWRcIiwgbik7XG4gICAgY29uc3QgaSA9IHMuY2MuZ2V0KGUpLCByID0gaSAmJiBpLmtleTtcbiAgICBpZiAocikge1xuICAgICAgICAvLyBUT0RPKGtsaW10KTogV2UgcmVhbGx5IG9ubHkgc2hvdWxkIGRvIHRoZSBmb2xsb3dpbmcgb24gcGVybWlzc2lvblxuICAgICAgICAvLyBkZW5pZWQgZXJyb3JzLCBidXQgd2UgZG9uJ3QgaGF2ZSB0aGUgY2F1c2UgY29kZSBoZXJlLlxuICAgICAgICAvLyBJdCdzIGEgbGltYm8gZG9jLiBDcmVhdGUgYSBzeW50aGV0aWMgZXZlbnQgc2F5aW5nIGl0IHdhcyBkZWxldGVkLlxuICAgICAgICAvLyBUaGlzIGlzIGtpbmQgb2YgYSBoYWNrLiBJZGVhbGx5LCB3ZSB3b3VsZCBoYXZlIGEgbWV0aG9kIGluIHRoZSBsb2NhbFxuICAgICAgICAvLyBzdG9yZSB0byBwdXJnZSBhIGRvY3VtZW50LiBIb3dldmVyLCBpdCB3b3VsZCBiZSB0cmlja3kgdG8ga2VlcCBhbGwgb2ZcbiAgICAgICAgLy8gdGhlIGxvY2FsIHN0b3JlJ3MgaW52YXJpYW50cyB3aXRoIGFub3RoZXIgbWV0aG9kLlxuICAgICAgICBsZXQgdCA9IG5ldyBHZShjdC5jb21wYXJhdG9yKTtcbiAgICAgICAgLy8gVE9ETyhiLzIxNzE4OTIxNik6IFRoaXMgbGltYm8gZG9jdW1lbnQgc2hvdWxkIGlkZWFsbHkgaGF2ZSBhIHJlYWQgdGltZSxcbiAgICAgICAgLy8gc28gdGhhdCBpdCBpcyBwaWNrZWQgdXAgYnkgYW55IHJlYWQtdGltZSBiYXNlZCBzY2Fucy4gVGhlIGJhY2tlbmQsXG4gICAgICAgIC8vIGhvd2V2ZXIsIGRvZXMgbm90IHNlbmQgYSByZWFkIHRpbWUgZm9yIHRhcmdldCByZW1vdmFscy5cbiAgICAgICAgICAgICAgICB0ID0gdC5pbnNlcnQociwgWmUubmV3Tm9Eb2N1bWVudChyLCBzdC5taW4oKSkpO1xuICAgICAgICBjb25zdCBuID0gRXMoKS5hZGQociksIGkgPSBuZXcgYnMoc3QubWluKCksIFxuICAgICAgICAvKiB0YXJnZXRDaGFuZ2VzPSAqLyBuZXcgTWFwLCBcbiAgICAgICAgLyogdGFyZ2V0TWlzbWF0Y2hlcz0gKi8gbmV3IFdlKFopLCB0LCBuKTtcbiAgICAgICAgYXdhaXQgU2MocywgaSksIFxuICAgICAgICAvLyBTaW5jZSB0aGlzIHF1ZXJ5IGZhaWxlZCwgd2Ugd29uJ3Qgd2FudCB0byBtYW51YWxseSB1bmxpc3RlbiB0byBpdC5cbiAgICAgICAgLy8gV2Ugb25seSByZW1vdmUgaXQgZnJvbSBib29ra2VlcGluZyBhZnRlciB3ZSBzdWNjZXNzZnVsbHkgYXBwbGllZCB0aGVcbiAgICAgICAgLy8gUmVtb3RlRXZlbnQuIElmIGBhcHBseVJlbW90ZUV2ZW50KClgIHRocm93cywgd2Ugd2FudCB0byByZS1saXN0ZW4gdG9cbiAgICAgICAgLy8gdGhpcyBxdWVyeSB3aGVuIHRoZSBSZW1vdGVTdG9yZSByZXN0YXJ0cyB0aGUgV2F0Y2ggc3RyZWFtLCB3aGljaCBzaG91bGRcbiAgICAgICAgLy8gcmUtdHJpZ2dlciB0aGUgdGFyZ2V0IGZhaWx1cmUuXG4gICAgICAgIHMudWMgPSBzLnVjLnJlbW92ZShyKSwgcy5jYy5kZWxldGUoZSksIHFjKHMpO1xuICAgIH0gZWxzZSBhd2FpdCBIbyhzLmxvY2FsU3RvcmUsIGUsIFxuICAgIC8qIGtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhICovICExKS50aGVuKCgoKSA9PiBGYyhzLCBlLCBuKSkpLmNhdGNoKEV0KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24geGModCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gZS5iYXRjaC5iYXRjaElkO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBLbyhuLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgbWF5IG9yIG1heSBub3QgYmUgYWJsZSB0byBhcHBseSB0aGUgd3JpdGUgcmVzdWx0IGFuZFxuICAgICAgICAvLyByYWlzZSBldmVudHMgaW1tZWRpYXRlbHkgKGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSB3YXRjaGVyIGlzIGNhdWdodFxuICAgICAgICAvLyB1cCksIHNvIHdlIHJhaXNlIHVzZXIgY2FsbGJhY2tzIGZpcnN0IHNvIHRoYXQgdGhleSBjb25zaXN0ZW50bHkgaGFwcGVuXG4gICAgICAgIC8vIGJlZm9yZSBsaXN0ZW4gZXZlbnRzLlxuICAgICAgICAgICAgICAgIE1jKG4sIHMsIC8qZXJyb3I9Ki8gbnVsbCksIE9jKG4sIHMpLCBuLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZU11dGF0aW9uU3RhdGUocywgXCJhY2tub3dsZWRnZWRcIiksIFxuICAgICAgICBhd2FpdCBVYyhuLCB0KTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIGF3YWl0IEV0KHQpO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gTmModCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSAkKHQpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gJCh0KTtcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiUmVqZWN0IGJhdGNoXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLm11dGF0aW9uUXVldWUubG9va3VwTXV0YXRpb25CYXRjaCh0LCBlKS5uZXh0KChlID0+IChNKG51bGwgIT09IGUpLCBzID0gZS5rZXlzKCksIFxuICAgICAgICAgICAgICAgIG4ubXV0YXRpb25RdWV1ZS5yZW1vdmVNdXRhdGlvbkJhdGNoKHQsIGUpKSkpLm5leHQoKCgpID0+IG4ubXV0YXRpb25RdWV1ZS5wZXJmb3JtQ29uc2lzdGVuY3lDaGVjayh0KSkpLm5leHQoKCgpID0+IG4uZG9jdW1lbnRPdmVybGF5Q2FjaGUucmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKHQsIHMsIGUpKSkubmV4dCgoKCkgPT4gbi5sb2NhbERvY3VtZW50cy5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5c0ZvckRvY3VtZW50S2V5cyh0LCBzKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKHQsIHMpKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXJnZXN0IChsYXRlc3QpIGJhdGNoIGlkIGluIG11dGF0aW9uIHF1ZXVlIHRoYXQgaXMgcGVuZGluZ1xuICogc2VydmVyIHJlc3BvbnNlLlxuICpcbiAqIFJldHVybnMgYEJBVENISURfVU5LTk9XTmAgaWYgdGhlIHF1ZXVlIGlzIGVtcHR5LlxuICovIChzLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgbWF5IG9yIG1heSBub3QgYmUgYWJsZSB0byBhcHBseSB0aGUgd3JpdGUgcmVzdWx0IGFuZFxuICAgICAgICAvLyByYWlzZSBldmVudHMgaW1tZWRpYXRlbHkgKGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSB3YXRjaGVyIGlzIGNhdWdodCB1cCksXG4gICAgICAgIC8vIHNvIHdlIHJhaXNlIHVzZXIgY2FsbGJhY2tzIGZpcnN0IHNvIHRoYXQgdGhleSBjb25zaXN0ZW50bHkgaGFwcGVuIGJlZm9yZVxuICAgICAgICAvLyBsaXN0ZW4gZXZlbnRzLlxuICAgICAgICAgICAgICAgIE1jKHMsIGUsIG4pLCBPYyhzLCBlKSwgcy5zaGFyZWRDbGllbnRTdGF0ZS51cGRhdGVNdXRhdGlvblN0YXRlKGUsIFwicmVqZWN0ZWRcIiwgbiksIFxuICAgICAgICBhd2FpdCBVYyhzLCB0KTtcbiAgICB9IGNhdGNoIChuKSB7XG4gICAgICAgIGF3YWl0IEV0KG4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYSB1c2VyIGNhbGxiYWNrIHRoYXQgcmVzb2x2ZXMgd2hlbiBhbGwgcGVuZGluZyBtdXRhdGlvbnMgYXQgdGhlIG1vbWVudCBvZiBjYWxsaW5nXG4gKiBhcmUgYWNrbm93bGVkZ2VkIC5cbiAqLyBhc3luYyBmdW5jdGlvbiBrYyh0LCBlKSB7XG4gICAgY29uc3QgbiA9ICQodCk7XG4gICAgTXUobi5yZW1vdGVTdG9yZSkgfHwgQyhcIlN5bmNFbmdpbmVcIiwgXCJUaGUgbmV0d29yayBpcyBkaXNhYmxlZC4gVGhlIHRhc2sgcmV0dXJuZWQgYnkgJ2F3YWl0UGVuZGluZ1dyaXRlcygpJyB3aWxsIG5vdCBjb21wbGV0ZSB1bnRpbCB0aGUgbmV0d29yayBpcyBlbmFibGVkLlwiKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9ICQodCk7XG4gICAgICAgICAgICByZXR1cm4gZS5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBoaWdoZXN0IHVuYWNrbm93bGVkZ2VkIGJhdGNoIGlkXCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gZS5tdXRhdGlvblF1ZXVlLmdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQodCkpKTtcbiAgICAgICAgfShuLmxvY2FsU3RvcmUpO1xuICAgICAgICBpZiAoLTEgPT09IHQpIFxuICAgICAgICAvLyBUcmlnZ2VyIHRoZSBjYWxsYmFjayByaWdodCBhd2F5IGlmIHRoZXJlIGlzIG5vIHBlbmRpbmcgd3JpdGVzIGF0IHRoZSBtb21lbnQuXG4gICAgICAgIHJldHVybiB2b2lkIGUucmVzb2x2ZSgpO1xuICAgICAgICBjb25zdCBzID0gbi5sYy5nZXQodCkgfHwgW107XG4gICAgICAgIHMucHVzaChlKSwgbi5sYy5zZXQodCwgcyk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBjb25zdCBuID0gc2ModCwgXCJJbml0aWFsaXphdGlvbiBvZiB3YWl0Rm9yUGVuZGluZ1dyaXRlcygpIG9wZXJhdGlvbiBmYWlsZWRcIik7XG4gICAgICAgIGUucmVqZWN0KG4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUcmlnZ2VycyB0aGUgY2FsbGJhY2tzIHRoYXQgYXJlIHdhaXRpbmcgZm9yIHRoaXMgYmF0Y2ggaWQgdG8gZ2V0IGFja25vd2xlZGdlZCBieSBzZXJ2ZXIsXG4gKiBpZiB0aGVyZSBhcmUgYW55LlxuICovIGZ1bmN0aW9uIE9jKHQsIGUpIHtcbiAgICAodC5sYy5nZXQoZSkgfHwgW10pLmZvckVhY2goKHQgPT4ge1xuICAgICAgICB0LnJlc29sdmUoKTtcbiAgICB9KSksIHQubGMuZGVsZXRlKGUpO1xufVxuXG4vKiogUmVqZWN0IGFsbCBvdXRzdGFuZGluZyBjYWxsYmFja3Mgd2FpdGluZyBmb3IgcGVuZGluZyB3cml0ZXMgdG8gY29tcGxldGUuICovIGZ1bmN0aW9uIE1jKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gJCh0KTtcbiAgICBsZXQgaSA9IHMuaGNbcy5jdXJyZW50VXNlci50b0tleSgpXTtcbiAgICAvLyBOT1RFOiBNdXRhdGlvbnMgcmVzdG9yZWQgZnJvbSBwZXJzaXN0ZW5jZSB3b24ndCBoYXZlIGNhbGxiYWNrcywgc28gaXQnc1xuICAgIC8vIG9rYXkgZm9yIHRoZXJlIHRvIGJlIG5vIGNhbGxiYWNrIGZvciB0aGlzIElELlxuICAgICAgICBpZiAoaSkge1xuICAgICAgICBjb25zdCB0ID0gaS5nZXQoZSk7XG4gICAgICAgIHQgJiYgKG4gPyB0LnJlamVjdChuKSA6IHQucmVzb2x2ZSgpLCBpID0gaS5yZW1vdmUoZSkpLCBzLmhjW3MuY3VycmVudFVzZXIudG9LZXkoKV0gPSBpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gRmModCwgZSwgbiA9IG51bGwpIHtcbiAgICB0LnNoYXJlZENsaWVudFN0YXRlLnJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoZSk7XG4gICAgZm9yIChjb25zdCBzIG9mIHQucmMuZ2V0KGUpKSB0LmljLmRlbGV0ZShzKSwgbiAmJiB0LnNjLndjKHMsIG4pO1xuICAgIGlmICh0LnJjLmRlbGV0ZShlKSwgdC5pc1ByaW1hcnlDbGllbnQpIHtcbiAgICAgICAgdC5hYy5scyhlKS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQuYWMuY29udGFpbnNLZXkoZSkgfHwgXG4gICAgICAgICAgICAvLyBXZSByZW1vdmVkIHRoZSBsYXN0IHJlZmVyZW5jZSBmb3IgdGhpcyBrZXlcbiAgICAgICAgICAgICRjKHQsIGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiAkYyh0LCBlKSB7XG4gICAgdC5vYy5kZWxldGUoZS5wYXRoLmNhbm9uaWNhbFN0cmluZygpKTtcbiAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHRhcmdldCBhbHJlYWR5IGdvdCByZW1vdmVkIGJlY2F1c2UgdGhlIHF1ZXJ5IGZhaWxlZC4gSW4gdGhhdCBjYXNlLFxuICAgIC8vIHRoZSBrZXkgd29uJ3QgZXhpc3QgaW4gYGxpbWJvVGFyZ2V0c0J5S2V5YC4gT25seSBkbyB0aGUgY2xlYW51cCBpZiB3ZSBzdGlsbCBoYXZlIHRoZSB0YXJnZXQuXG4gICAgY29uc3QgbiA9IHQudWMuZ2V0KGUpO1xuICAgIG51bGwgIT09IG4gJiYgKEN1KHQucmVtb3RlU3RvcmUsIG4pLCB0LnVjID0gdC51Yy5yZW1vdmUoZSksIHQuY2MuZGVsZXRlKG4pLCBxYyh0KSk7XG59XG5cbmZ1bmN0aW9uIEJjKHQsIGUsIG4pIHtcbiAgICBmb3IgKGNvbnN0IHMgb2YgbikgaWYgKHMgaW5zdGFuY2VvZiBwYykgdC5hYy5hZGRSZWZlcmVuY2Uocy5rZXksIGUpLCBMYyh0LCBzKTsgZWxzZSBpZiAocyBpbnN0YW5jZW9mIEljKSB7XG4gICAgICAgIEMoXCJTeW5jRW5naW5lXCIsIFwiRG9jdW1lbnQgbm8gbG9uZ2VyIGluIGxpbWJvOiBcIiArIHMua2V5KSwgdC5hYy5yZW1vdmVSZWZlcmVuY2Uocy5rZXksIGUpO1xuICAgICAgICB0LmFjLmNvbnRhaW5zS2V5KHMua2V5KSB8fCBcbiAgICAgICAgLy8gV2UgcmVtb3ZlZCB0aGUgbGFzdCByZWZlcmVuY2UgZm9yIHRoaXMga2V5XG4gICAgICAgICRjKHQsIHMua2V5KTtcbiAgICB9IGVsc2UgTygpO1xufVxuXG5mdW5jdGlvbiBMYyh0LCBlKSB7XG4gICAgY29uc3QgbiA9IGUua2V5LCBzID0gbi5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIHQudWMuZ2V0KG4pIHx8IHQub2MuaGFzKHMpIHx8IChDKFwiU3luY0VuZ2luZVwiLCBcIk5ldyBkb2N1bWVudCBpbiBsaW1ibzogXCIgKyBuKSwgdC5vYy5hZGQocyksIFxuICAgIHFjKHQpKTtcbn1cblxuLyoqXG4gKiBTdGFydHMgbGlzdGVucyBmb3IgZG9jdW1lbnRzIGluIGxpbWJvIHRoYXQgYXJlIGVucXVldWVkIGZvciByZXNvbHV0aW9uLFxuICogc3ViamVjdCB0byBhIG1heGltdW0gbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMuXG4gKlxuICogV2l0aG91dCBib3VuZGluZyB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgcmVzb2x1dGlvbnMsIHRoZSBzZXJ2ZXIgY2FuIGZhaWxcbiAqIHdpdGggXCJyZXNvdXJjZSBleGhhdXN0ZWRcIiBlcnJvcnMgd2hpY2ggY2FuIGxlYWQgdG8gcGF0aG9sb2dpY2FsIGNsaWVudFxuICogYmVoYXZpb3IgYXMgc2VlbiBpbiBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy8yNjgzLlxuICovIGZ1bmN0aW9uIHFjKHQpIHtcbiAgICBmb3IgKDt0Lm9jLnNpemUgPiAwICYmIHQudWMuc2l6ZSA8IHQubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnM7ICkge1xuICAgICAgICBjb25zdCBlID0gdC5vYy52YWx1ZXMoKS5uZXh0KCkudmFsdWU7XG4gICAgICAgIHQub2MuZGVsZXRlKGUpO1xuICAgICAgICBjb25zdCBuID0gbmV3IGN0KHJ0LmZyb21TdHJpbmcoZSkpLCBzID0gdC5mYy5uZXh0KCk7XG4gICAgICAgIHQuY2Muc2V0KHMsIG5ldyBBYyhuKSksIHQudWMgPSB0LnVjLmluc2VydChuLCBzKSwgRHUodC5yZW1vdGVTdG9yZSwgbmV3IHppKGduKGxuKG4ucGF0aCkpLCBzLCAyIC8qIFRhcmdldFB1cnBvc2UuTGltYm9SZXNvbHV0aW9uICovICwgT3QuYXQpKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIFVjKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gJCh0KSwgaSA9IFtdLCByID0gW10sIG8gPSBbXTtcbiAgICBzLmljLmlzRW1wdHkoKSB8fCAocy5pYy5mb3JFYWNoKCgodCwgdSkgPT4ge1xuICAgICAgICBvLnB1c2gocy5fYyh1LCBlLCBuKS50aGVuKCh0ID0+IHtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB2aWV3cyBpZiB0aGVyZSBhcmUgYWN0dWFsIGNoYW5nZXMuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgY2hhbmdlcywgb3Igd2UgYXJlIGhhbmRsaW5nIGEgZ2xvYmFsIHNuYXBzaG90LCBub3RpZnlcbiAgICAgICAgICAgIC8vIHNlY29uZGFyeSBjbGllbnRzIHRvIHVwZGF0ZSBxdWVyeSBzdGF0ZS5cbiAgICAgICAgICAgICh0IHx8IG4pICYmIHMuaXNQcmltYXJ5Q2xpZW50ICYmIHMuc2hhcmVkQ2xpZW50U3RhdGUudXBkYXRlUXVlcnlTdGF0ZSh1LnRhcmdldElkLCAobnVsbCA9PSB0ID8gdm9pZCAwIDogdC5mcm9tQ2FjaGUpID8gXCJub3QtY3VycmVudFwiIDogXCJjdXJyZW50XCIpLCBcbiAgICAgICAgICAgIHQpIHtcbiAgICAgICAgICAgICAgICBpLnB1c2godCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9ICRvLkNpKHUudGFyZ2V0SWQsIHQpO1xuICAgICAgICAgICAgICAgIHIucHVzaChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpKTtcbiAgICB9KSksIGF3YWl0IFByb21pc2UuYWxsKG8pLCBzLnNjLldvKGkpLCBhd2FpdCBhc3luYyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSAkKHQpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIm5vdGlmeUxvY2FsVmlld0NoYW5nZXNcIiwgXCJyZWFkd3JpdGVcIiwgKHQgPT4gQXQuZm9yRWFjaChlLCAoZSA9PiBBdC5mb3JFYWNoKGUuU2ksIChzID0+IG4ucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUuYWRkUmVmZXJlbmNlKHQsIGUudGFyZ2V0SWQsIHMpKSkubmV4dCgoKCkgPT4gQXQuZm9yRWFjaChlLkRpLCAocyA9PiBuLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVJlZmVyZW5jZSh0LCBlLnRhcmdldElkLCBzKSkpKSkpKSkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICBpZiAoIVZ0KHQpKSB0aHJvdyB0O1xuICAgICAgICAgICAgLy8gSWYgYG5vdGlmeUxvY2FsVmlld0NoYW5nZXNgIGZhaWxzLCB3ZSBkaWQgbm90IGFkdmFuY2UgdGhlIHNlcXVlbmNlXG4gICAgICAgICAgICAvLyBudW1iZXIgZm9yIHRoZSBkb2N1bWVudHMgdGhhdCB3ZXJlIGluY2x1ZGVkIGluIHRoaXMgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAvLyBUaGlzIG1pZ2h0IHRyaWdnZXIgdGhlbSB0byBiZSBkZWxldGVkIGVhcmxpZXIgdGhhbiB0aGV5IG90aGVyd2lzZVxuICAgICAgICAgICAgLy8gd291bGQgaGF2ZSwgYnV0IGl0IHNob3VsZCBub3QgaW52YWxpZGF0ZSB0aGUgaW50ZWdyaXR5IG9mIHRoZSBkYXRhLlxuICAgICAgICAgICAgQyhcIkxvY2FsU3RvcmVcIiwgXCJGYWlsZWQgdG8gdXBkYXRlIHNlcXVlbmNlIG51bWJlcnM6IFwiICsgdCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LnRhcmdldElkO1xuICAgICAgICAgICAgaWYgKCF0LmZyb21DYWNoZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuLnFpLmdldChlKSwgcyA9IHQuc25hcHNob3RWZXJzaW9uLCBpID0gdC53aXRoTGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbihzKTtcbiAgICAgICAgICAgICAgICAvLyBBZHZhbmNlIHRoZSBsYXN0IGxpbWJvIGZyZWUgc25hcHNob3QgdmVyc2lvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnFpID0gbi5xaS5pbnNlcnQoZSwgaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KHMubG9jYWxTdG9yZSwgcikpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBLYyh0LCBlKSB7XG4gICAgY29uc3QgbiA9ICQodCk7XG4gICAgaWYgKCFuLmN1cnJlbnRVc2VyLmlzRXF1YWwoZSkpIHtcbiAgICAgICAgQyhcIlN5bmNFbmdpbmVcIiwgXCJVc2VyIGNoYW5nZS4gTmV3IHVzZXI6XCIsIGUudG9LZXkoKSk7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBVbyhuLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICBuLmN1cnJlbnRVc2VyID0gZSwgXG4gICAgICAgIC8vIEZhaWxzIHRhc2tzIHdhaXRpbmcgZm9yIHBlbmRpbmcgd3JpdGVzIHJlcXVlc3RlZCBieSBwcmV2aW91cyB1c2VyLlxuICAgICAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICB0LmxjLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHQucmVqZWN0KG5ldyBMKEIuQ0FOQ0VMTEVELCBlKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLCB0LmxjLmNsZWFyKCk7XG4gICAgICAgIH0obiwgXCInd2FpdEZvclBlbmRpbmdXcml0ZXMnIHByb21pc2UgaXMgcmVqZWN0ZWQgZHVlIHRvIGEgdXNlciBjaGFuZ2UuXCIpLCBcbiAgICAgICAgLy8gVE9ETyhiLzExNDIyNjQxNyk6IENvbnNpZGVyIGNhbGxpbmcgdGhpcyBvbmx5IGluIHRoZSBwcmltYXJ5IHRhYi5cbiAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5oYW5kbGVVc2VyQ2hhbmdlKGUsIHQucmVtb3ZlZEJhdGNoSWRzLCB0LmFkZGVkQmF0Y2hJZHMpLCBhd2FpdCBVYyhuLCB0LmppKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIEdjKHQsIGUpIHtcbiAgICBjb25zdCBuID0gJCh0KSwgcyA9IG4uY2MuZ2V0KGUpO1xuICAgIGlmIChzICYmIHMubmMpIHJldHVybiBFcygpLmFkZChzLmtleSk7XG4gICAge1xuICAgICAgICBsZXQgdCA9IEVzKCk7XG4gICAgICAgIGNvbnN0IHMgPSBuLnJjLmdldChlKTtcbiAgICAgICAgaWYgKCFzKSByZXR1cm4gdDtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHMpIHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuLmljLmdldChlKTtcbiAgICAgICAgICAgIHQgPSB0LnVuaW9uV2l0aChzLnZpZXcuanUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWNvbmNpbGUgdGhlIGxpc3Qgb2Ygc3luY2VkIGRvY3VtZW50cyBpbiBhbiBleGlzdGluZyB2aWV3IHdpdGggdGhvc2VcbiAqIGZyb20gcGVyc2lzdGVuY2UuXG4gKi8gYXN5bmMgZnVuY3Rpb24gUWModCwgZSkge1xuICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gYXdhaXQgSm8obi5sb2NhbFN0b3JlLCBlLnF1ZXJ5LCBcbiAgICAvKiB1c2VQcmV2aW91c1Jlc3VsdHM9ICovICEwKSwgaSA9IGUudmlldy50YyhzKTtcbiAgICByZXR1cm4gbi5pc1ByaW1hcnlDbGllbnQgJiYgQmMobiwgZS50YXJnZXRJZCwgaS5YdSksIGk7XG59XG5cbi8qKlxuICogUmV0cmlldmVzIG5ld2x5IGNoYW5nZWQgZG9jdW1lbnRzIGZyb20gcmVtb3RlIGRvY3VtZW50IGNhY2hlIGFuZCByYWlzZXNcbiAqIHNuYXBzaG90cyBpZiBuZWVkZWQuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBqYyh0LCBlKSB7XG4gICAgY29uc3QgbiA9ICQodCk7XG4gICAgcmV0dXJuIFhvKG4ubG9jYWxTdG9yZSwgZSkudGhlbigodCA9PiBVYyhuLCB0KSkpO1xufVxuXG4vKiogQXBwbGllcyBhIG11dGF0aW9uIHN0YXRlIHRvIGFuIGV4aXN0aW5nIGJhdGNoLiAgKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBXYyh0LCBlLCBuLCBzKSB7XG4gICAgY29uc3QgaSA9ICQodCksIHIgPSBhd2FpdCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSAkKHQpLCBzID0gJChuLm11dGF0aW9uUXVldWUpO1xuICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkxvb2t1cCBtdXRhdGlvbiBkb2N1bWVudHNcIiwgXCJyZWFkb25seVwiLCAodCA9PiBzLlRuKHQsIGUpLm5leHQoKGUgPT4gZSA/IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKHQsIGUpIDogQXQucmVzb2x2ZShudWxsKSkpKSk7XG4gICAgfVxuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgKGkubG9jYWxTdG9yZSwgZSk7XG4gICAgbnVsbCAhPT0gciA/IChcInBlbmRpbmdcIiA9PT0gbiA/IFxuICAgIC8vIElmIHdlIGFyZSB0aGUgcHJpbWFyeSBjbGllbnQsIHdlIG5lZWQgdG8gc2VuZCB0aGlzIHdyaXRlIHRvIHRoZVxuICAgIC8vIGJhY2tlbmQuIFNlY29uZGFyeSBjbGllbnRzIHdpbGwgaWdub3JlIHRoZXNlIHdyaXRlcyBzaW5jZSB0aGVpciByZW1vdGVcbiAgICAvLyBjb25uZWN0aW9uIGlzIGRpc2FibGVkLlxuICAgIGF3YWl0IEt1KGkucmVtb3RlU3RvcmUpIDogXCJhY2tub3dsZWRnZWRcIiA9PT0gbiB8fCBcInJlamVjdGVkXCIgPT09IG4gPyAoXG4gICAgLy8gTk9URTogQm90aCB0aGVzZSBtZXRob2RzIGFyZSBuby1vcHMgZm9yIGJhdGNoZXMgdGhhdCBvcmlnaW5hdGVkIGZyb21cbiAgICAvLyBvdGhlciBjbGllbnRzLlxuICAgIE1jKGksIGUsIHMgfHwgbnVsbCksIE9jKGksIGUpLCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICQoJCh0KS5tdXRhdGlvblF1ZXVlKS5BbihlKTtcbiAgICB9XG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAoaS5sb2NhbFN0b3JlLCBlKSkgOiBPKCksIGF3YWl0IFVjKGksIHIpKSA6IFxuICAgIC8vIEEgdGhyb3R0bGVkIHRhYiBtYXkgbm90IGhhdmUgc2VlbiB0aGUgbXV0YXRpb24gYmVmb3JlIGl0IHdhcyBjb21wbGV0ZWRcbiAgICAvLyBhbmQgcmVtb3ZlZCBmcm9tIHRoZSBtdXRhdGlvbiBxdWV1ZSwgaW4gd2hpY2ggY2FzZSB3ZSB3b24ndCBoYXZlIGNhY2hlZFxuICAgIC8vIHRoZSBhZmZlY3RlZCBkb2N1bWVudHMuIEluIHRoaXMgY2FzZSB3ZSBjYW4gc2FmZWx5IGlnbm9yZSB0aGUgdXBkYXRlXG4gICAgLy8gc2luY2UgdGhhdCBtZWFucyB3ZSBkaWRuJ3QgYXBwbHkgdGhlIG11dGF0aW9uIGxvY2FsbHkgYXQgYWxsIChpZiB3ZVxuICAgIC8vIGhhZCwgd2Ugd291bGQgaGF2ZSBjYWNoZWQgdGhlIGFmZmVjdGVkIGRvY3VtZW50cyksIGFuZCBzbyB3ZSB3aWxsIGp1c3RcbiAgICAvLyBzZWUgYW55IHJlc3VsdGluZyBkb2N1bWVudCBjaGFuZ2VzIHZpYSBub3JtYWwgcmVtb3RlIGRvY3VtZW50IHVwZGF0ZXNcbiAgICAvLyBhcyBhcHBsaWNhYmxlLlxuICAgIEMoXCJTeW5jRW5naW5lXCIsIFwiQ2Fubm90IGFwcGx5IG11dGF0aW9uIGJhdGNoIHdpdGggaWQ6IFwiICsgZSk7XG59XG5cbi8qKiBBcHBsaWVzIGEgcXVlcnkgdGFyZ2V0IGNoYW5nZSBmcm9tIGEgZGlmZmVyZW50IHRhYi4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiB6Yyh0LCBlKSB7XG4gICAgY29uc3QgbiA9ICQodCk7XG4gICAgaWYgKHRhKG4pLCBlYShuKSwgITAgPT09IGUgJiYgITAgIT09IG4uZGMpIHtcbiAgICAgICAgLy8gU2Vjb25kYXJ5IHRhYnMgb25seSBtYWludGFpbiBWaWV3cyBmb3IgdGhlaXIgbG9jYWwgbGlzdGVuZXJzIGFuZCB0aGVcbiAgICAgICAgLy8gVmlld3MgaW50ZXJuYWwgc3RhdGUgbWF5IG5vdCBiZSAxMDAlIHBvcHVsYXRlZCAoaW4gcGFydGljdWxhclxuICAgICAgICAvLyBzZWNvbmRhcnkgdGFicyBkb24ndCB0cmFjayBzeW5jZWREb2N1bWVudHMsIHRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoZVxuICAgICAgICAvLyBzZXJ2ZXIgY29uc2lkZXJzIHRvIGJlIGluIHRoZSB0YXJnZXQpLiBTbyB3aGVuIGEgc2Vjb25kYXJ5IGJlY29tZXNcbiAgICAgICAgLy8gcHJpbWFyeSwgd2UgbmVlZCB0byBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IGFsbCB2aWV3cyBmb3IgYWxsIHRhcmdldHNcbiAgICAgICAgLy8gbWF0Y2ggdGhlIHN0YXRlIG9uIGRpc2suXG4gICAgICAgIGNvbnN0IHQgPSBuLnNoYXJlZENsaWVudFN0YXRlLmdldEFsbEFjdGl2ZVF1ZXJ5VGFyZ2V0cygpLCBlID0gYXdhaXQgSGMobiwgdC50b0FycmF5KCkpO1xuICAgICAgICBuLmRjID0gITAsIGF3YWl0IFp1KG4ucmVtb3RlU3RvcmUsICEwKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIER1KG4ucmVtb3RlU3RvcmUsIHQpO1xuICAgIH0gZWxzZSBpZiAoITEgPT09IGUgJiYgITEgIT09IG4uZGMpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBsZXQgZSA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICBuLnJjLmZvckVhY2goKChzLCBpKSA9PiB7XG4gICAgICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLmlzTG9jYWxRdWVyeVRhcmdldChpKSA/IHQucHVzaChpKSA6IGUgPSBlLnRoZW4oKCgpID0+IChGYyhuLCBpKSwgXG4gICAgICAgICAgICBIbyhuLmxvY2FsU3RvcmUsIGksIFxuICAgICAgICAgICAgLyprZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YT0qLyAhMCkpKSksIEN1KG4ucmVtb3RlU3RvcmUsIGkpO1xuICAgICAgICB9KSksIGF3YWl0IGUsIGF3YWl0IEhjKG4sIHQpLCBcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9ICQodCk7XG4gICAgICAgICAgICBlLmNjLmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgQ3UoZS5yZW1vdGVTdG9yZSwgbik7XG4gICAgICAgICAgICB9KSksIGUuYWMuZnMoKSwgZS5jYyA9IG5ldyBNYXAsIGUudWMgPSBuZXcgR2UoY3QuY29tcGFyYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZWNvbmNpbGUgdGhlIHF1ZXJ5IHZpZXdzIG9mIHRoZSBwcm92aWRlZCBxdWVyeSB0YXJnZXRzIHdpdGggdGhlIHN0YXRlIGZyb21cbiAqIHBlcnNpc3RlbmNlLiBSYWlzZXMgc25hcHNob3RzIGZvciBhbnkgY2hhbmdlcyB0aGF0IGFmZmVjdCB0aGUgbG9jYWxcbiAqIGNsaWVudCBhbmQgcmV0dXJucyB0aGUgdXBkYXRlZCBzdGF0ZSBvZiBhbGwgdGFyZ2V0J3MgcXVlcnkgZGF0YS5cbiAqXG4gKiBAcGFyYW0gc3luY0VuZ2luZSAtIFRoZSBzeW5jIGVuZ2luZSBpbXBsZW1lbnRhdGlvblxuICogQHBhcmFtIHRhcmdldHMgLSB0aGUgbGlzdCBvZiB0YXJnZXRzIHdpdGggdmlld3MgdGhhdCBuZWVkIHRvIGJlIHJlY29tcHV0ZWRcbiAqIEBwYXJhbSB0cmFuc2l0aW9uVG9QcmltYXJ5IC0gYHRydWVgIGlmZiB0aGUgdGFiIHRyYW5zaXRpb25zIGZyb20gYSBzZWNvbmRhcnlcbiAqIHRhYiB0byBhIHByaW1hcnkgdGFiXG4gKi9cbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAgICAgKG4pLCBuLmRjID0gITEsIGF3YWl0IFp1KG4ucmVtb3RlU3RvcmUsICExKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIEhjKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gJCh0KSwgaSA9IFtdLCByID0gW107XG4gICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgbGV0IGU7XG4gICAgICAgIGNvbnN0IG4gPSBzLnJjLmdldCh0KTtcbiAgICAgICAgaWYgKG4gJiYgMCAhPT0gbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIEZvciBxdWVyaWVzIHRoYXQgaGF2ZSBhIGxvY2FsIFZpZXcsIHdlIGZldGNoIHRoZWlyIGN1cnJlbnQgc3RhdGVcbiAgICAgICAgICAgIC8vIGZyb20gTG9jYWxTdG9yZSAoYXMgdGhlIHJlc3VtZSB0b2tlbiBhbmQgdGhlIHNuYXBzaG90IHZlcnNpb25cbiAgICAgICAgICAgIC8vIG1pZ2h0IGhhdmUgY2hhbmdlZCkgYW5kIHJlY29uY2lsZSB0aGVpciB2aWV3cyB3aXRoIHRoZSBwZXJzaXN0ZWRcbiAgICAgICAgICAgIC8vIHN0YXRlICh0aGUgbGlzdCBvZiBzeW5jZWREb2N1bWVudHMgbWF5IGhhdmUgZ290dGVuIG91dCBvZiBzeW5jKS5cbiAgICAgICAgICAgIGUgPSBhd2FpdCB6byhzLmxvY2FsU3RvcmUsIGduKG5bMF0pKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBuKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHMuaWMuZ2V0KHQpLCBuID0gYXdhaXQgUWMocywgZSk7XG4gICAgICAgICAgICAgICAgbi5zbmFwc2hvdCAmJiByLnB1c2gobi5zbmFwc2hvdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGb3IgcXVlcmllcyB0aGF0IG5ldmVyIGV4ZWN1dGVkIG9uIHRoaXMgY2xpZW50LCB3ZSBuZWVkIHRvXG4gICAgICAgICAgICAvLyBhbGxvY2F0ZSB0aGUgdGFyZ2V0IGluIExvY2FsU3RvcmUgYW5kIGluaXRpYWxpemUgYSBuZXcgVmlldy5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBhd2FpdCBZbyhzLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICAgICAgZSA9IGF3YWl0IHpvKHMubG9jYWxTdG9yZSwgbiksIGF3YWl0IFBjKHMsIEpjKG4pLCB0LCBcbiAgICAgICAgICAgIC8qY3VycmVudD0qLyAhMSwgZS5yZXN1bWVUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgaS5wdXNoKGUpO1xuICAgIH1cbiAgICByZXR1cm4gcy5zYy5XbyhyKSwgaTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgYFF1ZXJ5YCBvYmplY3QgZnJvbSB0aGUgc3BlY2lmaWVkIGBUYXJnZXRgLiBUaGVyZSBpcyBubyB3YXkgdG9cbiAqIG9idGFpbiB0aGUgb3JpZ2luYWwgYFF1ZXJ5YCwgc28gd2Ugc3ludGhlc2l6ZSBhIGBRdWVyeWAgZnJvbSB0aGUgYFRhcmdldGBcbiAqIG9iamVjdC5cbiAqXG4gKiBUaGUgc3ludGhlc2l6ZWQgcmVzdWx0IG1pZ2h0IGJlIGRpZmZlcmVudCBmcm9tIHRoZSBvcmlnaW5hbCBgUXVlcnlgLCBidXRcbiAqIHNpbmNlIHRoZSBzeW50aGVzaXplZCBgUXVlcnlgIHNob3VsZCByZXR1cm4gdGhlIHNhbWUgcmVzdWx0cyBhcyB0aGVcbiAqIG9yaWdpbmFsIG9uZSAob25seSB0aGUgcHJlc2VudGF0aW9uIG9mIHJlc3VsdHMgbWlnaHQgZGlmZmVyKSwgdGhlIHBvdGVudGlhbFxuICogZGlmZmVyZW5jZSB3aWxsIG5vdCBjYXVzZSBpc3N1ZXMuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBKYyh0KSB7XG4gICAgcmV0dXJuIGhuKHQucGF0aCwgdC5jb2xsZWN0aW9uR3JvdXAsIHQub3JkZXJCeSwgdC5maWx0ZXJzLCB0LmxpbWl0LCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gLCB0LnN0YXJ0QXQsIHQuZW5kQXQpO1xufVxuXG4vKiogUmV0dXJucyB0aGUgSURzIG9mIHRoZSBjbGllbnRzIHRoYXQgYXJlIGN1cnJlbnRseSBhY3RpdmUuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gWWModCkge1xuICAgIGNvbnN0IGUgPSAkKHQpO1xuICAgIHJldHVybiAkKCQoZS5sb2NhbFN0b3JlKS5wZXJzaXN0ZW5jZSkudmkoKTtcbn1cblxuLyoqIEFwcGxpZXMgYSBxdWVyeSB0YXJnZXQgY2hhbmdlIGZyb20gYSBkaWZmZXJlbnQgdGFiLiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIFhjKHQsIGUsIG4sIHMpIHtcbiAgICBjb25zdCBpID0gJCh0KTtcbiAgICBpZiAoaS5kYykgXG4gICAgLy8gSWYgd2UgcmVjZWl2ZSBhIHRhcmdldCBzdGF0ZSBub3RpZmljYXRpb24gdmlhIFdlYlN0b3JhZ2UsIHdlIGFyZVxuICAgIC8vIGVpdGhlciBhbHJlYWR5IHNlY29uZGFyeSBvciBhbm90aGVyIHRhYiBoYXMgdGFrZW4gdGhlIHByaW1hcnkgbGVhc2UuXG4gICAgcmV0dXJuIHZvaWQgQyhcIlN5bmNFbmdpbmVcIiwgXCJJZ25vcmluZyB1bmV4cGVjdGVkIHF1ZXJ5IHN0YXRlIG5vdGlmaWNhdGlvbi5cIik7XG4gICAgY29uc3QgciA9IGkucmMuZ2V0KGUpO1xuICAgIGlmIChyICYmIHIubGVuZ3RoID4gMCkgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIFwiY3VycmVudFwiOlxuICAgICAgY2FzZSBcIm5vdC1jdXJyZW50XCI6XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBhd2FpdCBYbyhpLmxvY2FsU3RvcmUsIFJuKHJbMF0pKSwgcyA9IGJzLmNyZWF0ZVN5bnRoZXNpemVkUmVtb3RlRXZlbnRGb3JDdXJyZW50Q2hhbmdlKGUsIFwiY3VycmVudFwiID09PSBuLCBRdC5FTVBUWV9CWVRFX1NUUklORyk7XG4gICAgICAgICAgICBhd2FpdCBVYyhpLCB0LCBzKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgXCJyZWplY3RlZFwiOlxuICAgICAgICBhd2FpdCBIbyhpLmxvY2FsU3RvcmUsIGUsIFxuICAgICAgICAvKiBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YSAqLyAhMCksIEZjKGksIGUsIHMpO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgTygpO1xuICAgIH1cbn1cblxuLyoqIEFkZHMgb3IgcmVtb3ZlcyBXYXRjaCB0YXJnZXRzIGZvciBxdWVyaWVzIGZyb20gZGlmZmVyZW50IHRhYnMuICovIGFzeW5jIGZ1bmN0aW9uIFpjKHQsIGUsIG4pIHtcbiAgICBjb25zdCBzID0gdGEodCk7XG4gICAgaWYgKHMuZGMpIHtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGlmIChzLnJjLmhhcyh0KSkge1xuICAgICAgICAgICAgICAgIC8vIEEgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiBhZGRlZCBpbiBhIHByZXZpb3VzIGF0dGVtcHRcbiAgICAgICAgICAgICAgICBDKFwiU3luY0VuZ2luZVwiLCBcIkFkZGluZyBhbiBhbHJlYWR5IGFjdGl2ZSB0YXJnZXQgXCIgKyB0KTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGUgPSBhd2FpdCBZbyhzLmxvY2FsU3RvcmUsIHQpLCBuID0gYXdhaXQgem8ocy5sb2NhbFN0b3JlLCBlKTtcbiAgICAgICAgICAgIGF3YWl0IFBjKHMsIEpjKGUpLCBuLnRhcmdldElkLCBcbiAgICAgICAgICAgIC8qY3VycmVudD0qLyAhMSwgbi5yZXN1bWVUb2tlbiksIER1KHMucmVtb3RlU3RvcmUsIG4pO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBuKSBcbiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgdGFyZ2V0IGlzIHN0aWxsIGFjdGl2ZSBzaW5jZSB0aGUgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlblxuICAgICAgICAvLyByZW1vdmVkIGlmIGl0IGhhcyBiZWVuIHJlamVjdGVkIGJ5IHRoZSBiYWNrZW5kLlxuICAgICAgICBzLnJjLmhhcyh0KSAmJiBcbiAgICAgICAgLy8gUmVsZWFzZSBxdWVyaWVzIHRoYXQgYXJlIHN0aWxsIGFjdGl2ZS5cbiAgICAgICAgYXdhaXQgSG8ocy5sb2NhbFN0b3JlLCB0LCBcbiAgICAgICAgLyoga2VlcFBlcnNpc3RlZFRhcmdldERhdGEgKi8gITEpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIEN1KHMucmVtb3RlU3RvcmUsIHQpLCBGYyhzLCB0KTtcbiAgICAgICAgfSkpLmNhdGNoKEV0KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHRhKHQpIHtcbiAgICBjb25zdCBlID0gJCh0KTtcbiAgICByZXR1cm4gZS5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIuYXBwbHlSZW1vdGVFdmVudCA9IFNjLmJpbmQobnVsbCwgZSksIGUucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLmdldFJlbW90ZUtleXNGb3JUYXJnZXQgPSBHYy5iaW5kKG51bGwsIGUpLCBcbiAgICBlLnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5yZWplY3RMaXN0ZW4gPSBDYy5iaW5kKG51bGwsIGUpLCBlLnNjLldvID0gbGMuYmluZChudWxsLCBlLmV2ZW50TWFuYWdlciksIFxuICAgIGUuc2Mud2MgPSBmYy5iaW5kKG51bGwsIGUuZXZlbnRNYW5hZ2VyKSwgZTtcbn1cblxuZnVuY3Rpb24gZWEodCkge1xuICAgIGNvbnN0IGUgPSAkKHQpO1xuICAgIHJldHVybiBlLnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5hcHBseVN1Y2Nlc3NmdWxXcml0ZSA9IHhjLmJpbmQobnVsbCwgZSksIGUucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLnJlamVjdEZhaWxlZFdyaXRlID0gTmMuYmluZChudWxsLCBlKSwgXG4gICAgZTtcbn1cblxuLyoqXG4gKiBMb2FkcyBhIEZpcmVzdG9yZSBidW5kbGUgaW50byB0aGUgU0RLLiBUaGUgcmV0dXJuZWQgcHJvbWlzZSByZXNvbHZlcyB3aGVuXG4gKiB0aGUgYnVuZGxlIGZpbmlzaGVkIGxvYWRpbmcuXG4gKlxuICogQHBhcmFtIHN5bmNFbmdpbmUgLSBTeW5jRW5naW5lIHRvIHVzZS5cbiAqIEBwYXJhbSBidW5kbGVSZWFkZXIgLSBCdW5kbGUgdG8gbG9hZCBpbnRvIHRoZSBTREsuXG4gKiBAcGFyYW0gdGFzayAtIExvYWRCdW5kbGVUYXNrIHVzZWQgdG8gdXBkYXRlIHRoZSBsb2FkaW5nIHByb2dyZXNzIHRvIHB1YmxpYyBBUEkuXG4gKi8gZnVuY3Rpb24gbmEodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSAkKHQpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgKFxuICAgIC8qKiBMb2FkcyBhIGJ1bmRsZSBhbmQgcmV0dXJucyB0aGUgbGlzdCBvZiBhZmZlY3RlZCBjb2xsZWN0aW9uIGdyb3Vwcy4gKi9cbiAgICBhc3luYyBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzID0gYXdhaXQgZS5nZXRNZXRhZGF0YSgpO1xuICAgICAgICAgICAgaWYgKGF3YWl0IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gJCh0KSwgcyA9IHFzKGUuY3JlYXRlVGltZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJoYXNOZXdlckJ1bmRsZVwiLCBcInJlYWRvbmx5XCIsICh0ID0+IG4uTnMuZ2V0QnVuZGxlTWV0YWRhdGEodCwgZS5pZCkpKS50aGVuKCh0ID0+ICEhdCAmJiB0LmNyZWF0ZVRpbWUuY29tcGFyZVRvKHMpID49IDApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogU2F2ZXMgdGhlIGdpdmVuIGBCdW5kbGVNZXRhZGF0YWAgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gKi8gKHQubG9jYWxTdG9yZSwgcykpIHJldHVybiBhd2FpdCBlLmNsb3NlKCksIG4uX2NvbXBsZXRlV2l0aChmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRlOiBcIlN1Y2Nlc3NcIixcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRzTG9hZGVkOiB0LnRvdGFsRG9jdW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBieXRlc0xvYWRlZDogdC50b3RhbEJ5dGVzLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbERvY3VtZW50czogdC50b3RhbERvY3VtZW50cyxcbiAgICAgICAgICAgICAgICAgICAgdG90YWxCeXRlczogdC50b3RhbEJ5dGVzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0ocykpLCBQcm9taXNlLnJlc29sdmUobmV3IFNldCk7XG4gICAgICAgICAgICBuLl91cGRhdGVQcm9ncmVzcyh5YyhzKSk7XG4gICAgICAgICAgICBjb25zdCBpID0gbmV3IGdjKHMsIHQubG9jYWxTdG9yZSwgZS55dCk7XG4gICAgICAgICAgICBsZXQgciA9IGF3YWl0IGUubWMoKTtcbiAgICAgICAgICAgIGZvciAoO3I7ICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBhd2FpdCBpLkZ1KHIpO1xuICAgICAgICAgICAgICAgIHQgJiYgbi5fdXBkYXRlUHJvZ3Jlc3ModCksIHIgPSBhd2FpdCBlLm1jKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBvID0gYXdhaXQgaS5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IFVjKHQsIG8uTHUsIFxuICAgICAgICAgICAgLyogcmVtb3RlRXZlbnQgKi8gdm9pZCAwKSwgXG4gICAgICAgICAgICAvLyBTYXZlIG1ldGFkYXRhLCBzbyBsb2FkaW5nIHRoZSBzYW1lIGJ1bmRsZSB3aWxsIHNraXAuXG4gICAgICAgICAgICBhd2FpdCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9ICQodCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJTYXZlIGJ1bmRsZVwiLCBcInJlYWR3cml0ZVwiLCAodCA9PiBuLk5zLnNhdmVCdW5kbGVNZXRhZGF0YSh0LCBlKSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiBhIGBOYW1lZFF1ZXJ5YCBhc3NvY2lhdGVkIHdpdGggZ2l2ZW4gcXVlcnkgbmFtZS4gUHJvbWlzZVxuICogcmVzb2x2ZXMgdG8gdW5kZWZpbmVkIGlmIG5vIHBlcnNpc3RlZCBkYXRhIGNhbiBiZSBmb3VuZC5cbiAqLyAodC5sb2NhbFN0b3JlLCBzKSwgbi5fY29tcGxldGVXaXRoKG8ucHJvZ3Jlc3MpLCBQcm9taXNlLnJlc29sdmUoby5CdSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIHJldHVybiBOKFwiU3luY0VuZ2luZVwiLCBgTG9hZGluZyBidW5kbGUgZmFpbGVkIHdpdGggJHt0fWApLCBuLl9mYWlsV2l0aCh0KSwgUHJvbWlzZS5yZXNvbHZlKG5ldyBTZXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLyoqXG4gKiBQcm92aWRlcyBhbGwgY29tcG9uZW50cyBuZWVkZWQgZm9yIEZpcmVzdG9yZSB3aXRoIGluLW1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAqIFVzZXMgRWFnZXJHQyBnYXJiYWdlIGNvbGxlY3Rpb24uXG4gKi8pKHMsIGUsIG4pLnRoZW4oKHQgPT4ge1xuICAgICAgICBzLnNoYXJlZENsaWVudFN0YXRlLm5vdGlmeUJ1bmRsZUxvYWRlZCh0KTtcbiAgICB9KSk7XG59XG5cbmNsYXNzIHNhIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZSh0KSB7XG4gICAgICAgIHRoaXMueXQgPSBwdSh0LmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkKSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IHRoaXMuZ2ModCksIHRoaXMucGVyc2lzdGVuY2UgPSB0aGlzLnljKHQpLCBcbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5zdGFydCgpLCB0aGlzLmxvY2FsU3RvcmUgPSB0aGlzLkljKHQpLCB0aGlzLmdjU2NoZWR1bGVyID0gdGhpcy5UYyh0LCB0aGlzLmxvY2FsU3RvcmUpLCBcbiAgICAgICAgdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIgPSB0aGlzLkVjKHQsIHRoaXMubG9jYWxTdG9yZSk7XG4gICAgfVxuICAgIFRjKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIEVjKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIEljKHQpIHtcbiAgICAgICAgcmV0dXJuIHFvKHRoaXMucGVyc2lzdGVuY2UsIG5ldyBCbywgdC5pbml0aWFsVXNlciwgdGhpcy55dCk7XG4gICAgfVxuICAgIHljKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBWbyhEby5CcywgdGhpcy55dCk7XG4gICAgfVxuICAgIGdjKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBsdTtcbiAgICB9XG4gICAgYXN5bmMgdGVybWluYXRlKCkge1xuICAgICAgICB0aGlzLmdjU2NoZWR1bGVyICYmIHRoaXMuZ2NTY2hlZHVsZXIuc3RvcCgpLCBhd2FpdCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLnNodXRkb3duKCksIFxuICAgICAgICBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLnNodXRkb3duKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVzIGFsbCBjb21wb25lbnRzIG5lZWRlZCBmb3IgRmlyZXN0b3JlIHdpdGggSW5kZXhlZERCIHBlcnNpc3RlbmNlLlxuICovIGNsYXNzIGlhIGV4dGVuZHMgc2Ege1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5BYyA9IHQsIHRoaXMuY2FjaGVTaXplQnl0ZXMgPSBlLCB0aGlzLmZvcmNlT3duZXJzaGlwID0gbiwgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZSh0KSB7XG4gICAgICAgIGF3YWl0IHN1cGVyLmluaXRpYWxpemUodCksIGF3YWl0IHRoaXMuQWMuaW5pdGlhbGl6ZSh0aGlzLCB0KSwgXG4gICAgICAgIC8vIEVucXVldWUgd3JpdGVzIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uXG4gICAgICAgIGF3YWl0IGVhKHRoaXMuQWMuc3luY0VuZ2luZSksIGF3YWl0IEt1KHRoaXMuQWMucmVtb3RlU3RvcmUpLCBcbiAgICAgICAgLy8gTk9URTogVGhpcyB3aWxsIGltbWVkaWF0ZWx5IGNhbGwgdGhlIGxpc3RlbmVyLCBzbyB3ZSBtYWtlIHN1cmUgdG9cbiAgICAgICAgLy8gc2V0IGl0IGFmdGVyIGxvY2FsU3RvcmUgLyByZW1vdGVTdG9yZSBhcmUgc3RhcnRlZC5cbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5saSgoKCkgPT4gKHRoaXMuZ2NTY2hlZHVsZXIgJiYgIXRoaXMuZ2NTY2hlZHVsZXIuc3RhcnRlZCAmJiB0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0KCksIFxuICAgICAgICB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlciAmJiAhdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIuc3RhcnRlZCAmJiB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdGFydCgpLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSk7XG4gICAgfVxuICAgIEljKHQpIHtcbiAgICAgICAgcmV0dXJuIHFvKHRoaXMucGVyc2lzdGVuY2UsIG5ldyBCbywgdC5pbml0aWFsVXNlciwgdGhpcy55dCk7XG4gICAgfVxuICAgIFRjKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUuZ2FyYmFnZUNvbGxlY3RvcjtcbiAgICAgICAgcmV0dXJuIG5ldyBpbyhuLCB0LmFzeW5jUXVldWUsIGUpO1xuICAgIH1cbiAgICBFYyh0LCBlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcga3QoZSwgdGhpcy5wZXJzaXN0ZW5jZSk7XG4gICAgICAgIHJldHVybiBuZXcgTnQodC5hc3luY1F1ZXVlLCBuKTtcbiAgICB9XG4gICAgeWModCkge1xuICAgICAgICBjb25zdCBlID0gRm8odC5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCwgdC5kYXRhYmFzZUluZm8ucGVyc2lzdGVuY2VLZXkpLCBuID0gdm9pZCAwICE9PSB0aGlzLmNhY2hlU2l6ZUJ5dGVzID8gS3Iud2l0aENhY2hlU2l6ZSh0aGlzLmNhY2hlU2l6ZUJ5dGVzKSA6IEtyLkRFRkFVTFQ7XG4gICAgICAgIHJldHVybiBuZXcga28odGhpcy5zeW5jaHJvbml6ZVRhYnMsIGUsIHQuY2xpZW50SWQsIG4sIHQuYXN5bmNRdWV1ZSwgZ3UoKSwgeXUoKSwgdGhpcy55dCwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSwgISF0aGlzLmZvcmNlT3duZXJzaGlwKTtcbiAgICB9XG4gICAgZ2ModCkge1xuICAgICAgICByZXR1cm4gbmV3IGx1O1xuICAgIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhbGwgY29tcG9uZW50cyBuZWVkZWQgZm9yIEZpcmVzdG9yZSB3aXRoIG11bHRpLXRhYiBJbmRleGVkREJcbiAqIHBlcnNpc3RlbmNlLlxuICpcbiAqIEluIHRoZSBsZWdhY3kgY2xpZW50LCB0aGlzIHByb3ZpZGVyIGlzIHVzZWQgdG8gcHJvdmlkZSBib3RoIG11bHRpLXRhYiBhbmRcbiAqIG5vbi1tdWx0aS10YWIgcGVyc2lzdGVuY2Ugc2luY2Ugd2UgY2Fubm90IHRlbGwgYXQgYnVpbGQgdGltZSB3aGV0aGVyXG4gKiBgc3luY2hyb25pemVUYWJzYCB3aWxsIGJlIGVuYWJsZWQuXG4gKi8gY2xhc3MgcmEgZXh0ZW5kcyBpYSB7XG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBlLCAvKiBmb3JjZU93bmVyc2hpcD0gKi8gITEpLCB0aGlzLkFjID0gdCwgdGhpcy5jYWNoZVNpemVCeXRlcyA9IGUsIHRoaXMuc3luY2hyb25pemVUYWJzID0gITA7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUodCkge1xuICAgICAgICBhd2FpdCBzdXBlci5pbml0aWFsaXplKHQpO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5BYy5zeW5jRW5naW5lO1xuICAgICAgICB0aGlzLnNoYXJlZENsaWVudFN0YXRlIGluc3RhbmNlb2YgaHUgJiYgKHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUuc3luY0VuZ2luZSA9IHtcbiAgICAgICAgICAgIEZyOiBXYy5iaW5kKG51bGwsIGUpLFxuICAgICAgICAgICAgJHI6IFhjLmJpbmQobnVsbCwgZSksXG4gICAgICAgICAgICBCcjogWmMuYmluZChudWxsLCBlKSxcbiAgICAgICAgICAgIHZpOiBZYy5iaW5kKG51bGwsIGUpLFxuICAgICAgICAgICAgTXI6IGpjLmJpbmQobnVsbCwgZSlcbiAgICAgICAgfSwgYXdhaXQgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5zdGFydCgpKSwgXG4gICAgICAgIC8vIE5PVEU6IFRoaXMgd2lsbCBpbW1lZGlhdGVseSBjYWxsIHRoZSBsaXN0ZW5lciwgc28gd2UgbWFrZSBzdXJlIHRvXG4gICAgICAgIC8vIHNldCBpdCBhZnRlciBsb2NhbFN0b3JlIC8gcmVtb3RlU3RvcmUgYXJlIHN0YXJ0ZWQuXG4gICAgICAgIGF3YWl0IHRoaXMucGVyc2lzdGVuY2UubGkoKGFzeW5jIHQgPT4ge1xuICAgICAgICAgICAgYXdhaXQgemModGhpcy5BYy5zeW5jRW5naW5lLCB0KSwgdGhpcy5nY1NjaGVkdWxlciAmJiAodCAmJiAhdGhpcy5nY1NjaGVkdWxlci5zdGFydGVkID8gdGhpcy5nY1NjaGVkdWxlci5zdGFydCgpIDogdCB8fCB0aGlzLmdjU2NoZWR1bGVyLnN0b3AoKSksIFxuICAgICAgICAgICAgdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIgJiYgKHQgJiYgIXRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyLnN0YXJ0ZWQgPyB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdGFydCgpIDogdCB8fCB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdG9wKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdjKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IGd1KCk7XG4gICAgICAgIGlmICghaHUuQyhlKSkgdGhyb3cgbmV3IEwoQi5VTklNUExFTUVOVEVELCBcIkluZGV4ZWREQiBwZXJzaXN0ZW5jZSBpcyBvbmx5IGF2YWlsYWJsZSBvbiBwbGF0Zm9ybXMgdGhhdCBzdXBwb3J0IExvY2FsU3RvcmFnZS5cIik7XG4gICAgICAgIGNvbnN0IG4gPSBGbyh0LmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkLCB0LmRhdGFiYXNlSW5mby5wZXJzaXN0ZW5jZUtleSk7XG4gICAgICAgIHJldHVybiBuZXcgaHUoZSwgdC5hc3luY1F1ZXVlLCBuLCB0LmNsaWVudElkLCB0LmluaXRpYWxVc2VyKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYW5kIHdpcmVzIHRoZSBjb21wb25lbnRzIHRoYXQgYXJlIG5lZWRlZCB0byBpbnRlcmZhY2Ugd2l0aCB0aGVcbiAqIG5ldHdvcmsuXG4gKi8gY2xhc3Mgb2Ege1xuICAgIGFzeW5jIGluaXRpYWxpemUodCwgZSkge1xuICAgICAgICB0aGlzLmxvY2FsU3RvcmUgfHwgKHRoaXMubG9jYWxTdG9yZSA9IHQubG9jYWxTdG9yZSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IHQuc2hhcmVkQ2xpZW50U3RhdGUsIFxuICAgICAgICB0aGlzLmRhdGFzdG9yZSA9IHRoaXMuY3JlYXRlRGF0YXN0b3JlKGUpLCB0aGlzLnJlbW90ZVN0b3JlID0gdGhpcy5jcmVhdGVSZW1vdGVTdG9yZShlKSwgXG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gdGhpcy5jcmVhdGVFdmVudE1hbmFnZXIoZSksIHRoaXMuc3luY0VuZ2luZSA9IHRoaXMuY3JlYXRlU3luY0VuZ2luZShlLCBcbiAgICAgICAgLyogc3RhcnRBc1ByaW1hcnk9Ki8gIXQuc3luY2hyb25pemVUYWJzKSwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5vbmxpbmVTdGF0ZUhhbmRsZXIgPSB0ID0+IERjKHRoaXMuc3luY0VuZ2luZSwgdCwgMSAvKiBPbmxpbmVTdGF0ZVNvdXJjZS5TaGFyZWRDbGllbnRTdGF0ZSAqLyksIFxuICAgICAgICB0aGlzLnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5oYW5kbGVDcmVkZW50aWFsQ2hhbmdlID0gS2MuYmluZChudWxsLCB0aGlzLnN5bmNFbmdpbmUpLCBcbiAgICAgICAgYXdhaXQgWnUodGhpcy5yZW1vdGVTdG9yZSwgdGhpcy5zeW5jRW5naW5lLmlzUHJpbWFyeUNsaWVudCkpO1xuICAgIH1cbiAgICBjcmVhdGVFdmVudE1hbmFnZXIodCkge1xuICAgICAgICByZXR1cm4gbmV3IGNjO1xuICAgIH1cbiAgICBjcmVhdGVEYXRhc3RvcmUodCkge1xuICAgICAgICBjb25zdCBlID0gcHUodC5kYXRhYmFzZUluZm8uZGF0YWJhc2VJZCksIG4gPSAocyA9IHQuZGF0YWJhc2VJbmZvLCBuZXcgbXUocykpO1xuICAgICAgICB2YXIgcztcbiAgICAgICAgLyoqIFJldHVybiB0aGUgUGxhdGZvcm0tc3BlY2lmaWMgY29ubmVjdGl2aXR5IG1vbml0b3IuICovICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSwgbiwgcykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSdSh0LCBlLCBuLCBzKTtcbiAgICAgICAgfSh0LmF1dGhDcmVkZW50aWFscywgdC5hcHBDaGVja0NyZWRlbnRpYWxzLCBuLCBlKTtcbiAgICB9XG4gICAgY3JlYXRlUmVtb3RlU3RvcmUodCkge1xuICAgICAgICByZXR1cm4gZSA9IHRoaXMubG9jYWxTdG9yZSwgbiA9IHRoaXMuZGF0YXN0b3JlLCBzID0gdC5hc3luY1F1ZXVlLCBpID0gdCA9PiBEYyh0aGlzLnN5bmNFbmdpbmUsIHQsIDAgLyogT25saW5lU3RhdGVTb3VyY2UuUmVtb3RlU3RvcmUgKi8pLCBcbiAgICAgICAgciA9IGR1LkMoKSA/IG5ldyBkdSA6IG5ldyBmdSwgbmV3IHZ1KGUsIG4sIHMsIGksIHIpO1xuICAgICAgICB2YXIgZSwgbiwgcywgaSwgcjtcbiAgICAgICAgLyoqIFJlLWVuYWJsZXMgdGhlIG5ldHdvcmsuIElkZW1wb3RlbnQuICovICAgIH1cbiAgICBjcmVhdGVTeW5jRW5naW5lKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUsIG4sIFxuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE1hbmFnZXMgc3RhdGUgc3luY2hyb25pemF0aW9uIGluIG11bHRpLXRhYiBlbnZpcm9ubWVudHMuXG4gICAgICAgIHMsIGksIHIsIG8pIHtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBuZXcgUmModCwgZSwgbiwgcywgaSwgcik7XG4gICAgICAgICAgICByZXR1cm4gbyAmJiAodS5kYyA9ICEwKSwgdTtcbiAgICAgICAgfSh0aGlzLmxvY2FsU3RvcmUsIHRoaXMucmVtb3RlU3RvcmUsIHRoaXMuZXZlbnRNYW5hZ2VyLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLCB0LmluaXRpYWxVc2VyLCB0Lm1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zLCBlKTtcbiAgICB9XG4gICAgdGVybWluYXRlKCkge1xuICAgICAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9ICQodCk7XG4gICAgICAgICAgICBDKFwiUmVtb3RlU3RvcmVcIiwgXCJSZW1vdGVTdG9yZSBzaHV0dGluZyBkb3duLlwiKSwgZS5fdS5hZGQoNSAvKiBPZmZsaW5lQ2F1c2UuU2h1dGRvd24gKi8pLCBcbiAgICAgICAgICAgIGF3YWl0IFN1KGUpLCBlLm11LnNodXRkb3duKCksIFxuICAgICAgICAgICAgLy8gU2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBVbmtub3duIChyYXRoZXIgdGhhbiBPZmZsaW5lKSB0byBhdm9pZCBwb3RlbnRpYWxseVxuICAgICAgICAgICAgLy8gdHJpZ2dlcmluZyBzcHVyaW91cyBsaXN0ZW5lciBldmVudHMgd2l0aCBjYWNoZWQgZGF0YSwgZXRjLlxuICAgICAgICAgICAgZS5ndS5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyk7XG4gICAgICAgIH0odGhpcy5yZW1vdGVTdG9yZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiB1YSh0LCBlLCBuKSB7XG4gICAgaWYgKCFuKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBGdW5jdGlvbiAke3R9KCkgY2Fubm90IGJlIGNhbGxlZCB3aXRoIGFuIGVtcHR5ICR7ZX0uYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgdHdvIGJvb2xlYW4gb3B0aW9ucyBhcmUgbm90IHNldCBhdCB0aGUgc2FtZSB0aW1lLlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gY2EodCwgZSwgbiwgcykge1xuICAgIGlmICghMCA9PT0gZSAmJiAhMCA9PT0gcykgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgJHt0fSBhbmQgJHtufSBjYW5ub3QgYmUgdXNlZCB0b2dldGhlci5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBgcGF0aGAgcmVmZXJzIHRvIGEgZG9jdW1lbnQgKGluZGljYXRlZCBieSB0aGUgZmFjdCBpdCBjb250YWluc1xuICogYW4gZXZlbiBudW1iZXJzIG9mIHNlZ21lbnRzKS5cbiAqLyBmdW5jdGlvbiBhYSh0KSB7XG4gICAgaWYgKCFjdC5pc0RvY3VtZW50S2V5KHQpKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGRvY3VtZW50IHJlZmVyZW5jZS4gRG9jdW1lbnQgcmVmZXJlbmNlcyBtdXN0IGhhdmUgYW4gZXZlbiBudW1iZXIgb2Ygc2VnbWVudHMsIGJ1dCAke3R9IGhhcyAke3QubGVuZ3RofS5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBgcGF0aGAgcmVmZXJzIHRvIGEgY29sbGVjdGlvbiAoaW5kaWNhdGVkIGJ5IHRoZSBmYWN0IGl0XG4gKiBjb250YWlucyBhbiBvZGQgbnVtYmVycyBvZiBzZWdtZW50cykuXG4gKi8gZnVuY3Rpb24gaGEodCkge1xuICAgIGlmIChjdC5pc0RvY3VtZW50S2V5KHQpKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGNvbGxlY3Rpb24gcmVmZXJlbmNlLiBDb2xsZWN0aW9uIHJlZmVyZW5jZXMgbXVzdCBoYXZlIGFuIG9kZCBudW1iZXIgb2Ygc2VnbWVudHMsIGJ1dCAke3R9IGhhcyAke3QubGVuZ3RofS5gKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgaXQncyBhIG5vbi1udWxsIG9iamVjdCB3aXRob3V0IGEgY3VzdG9tIHByb3RvdHlwZVxuICogKGkuZS4gZXhjbHVkZXMgQXJyYXksIERhdGUsIGV0Yy4pLlxuICovXG4vKiogUmV0dXJucyBhIHN0cmluZyBkZXNjcmliaW5nIHRoZSB0eXBlIC8gdmFsdWUgb2YgdGhlIHByb3ZpZGVkIGlucHV0LiAqL1xuZnVuY3Rpb24gbGEodCkge1xuICAgIGlmICh2b2lkIDAgPT09IHQpIHJldHVybiBcInVuZGVmaW5lZFwiO1xuICAgIGlmIChudWxsID09PSB0KSByZXR1cm4gXCJudWxsXCI7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpIHJldHVybiB0Lmxlbmd0aCA+IDIwICYmICh0ID0gYCR7dC5zdWJzdHJpbmcoMCwgMjApfS4uLmApLCBcbiAgICBKU09OLnN0cmluZ2lmeSh0KTtcbiAgICBpZiAoXCJudW1iZXJcIiA9PSB0eXBlb2YgdCB8fCBcImJvb2xlYW5cIiA9PSB0eXBlb2YgdCkgcmV0dXJuIFwiXCIgKyB0O1xuICAgIGlmIChcIm9iamVjdFwiID09IHR5cGVvZiB0KSB7XG4gICAgICAgIGlmICh0IGluc3RhbmNlb2YgQXJyYXkpIHJldHVybiBcImFuIGFycmF5XCI7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBcbiAgICAgICAgICAgIC8qKiB0cnkgdG8gZ2V0IHRoZSBjb25zdHJ1Y3RvciBuYW1lIGZvciBhbiBvYmplY3QuICovXG4gICAgICAgICAgICBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHQuY29uc3RydWN0b3IpIHJldHVybiB0LmNvbnN0cnVjdG9yLm5hbWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIENhc3RzIGBvYmpgIHRvIGBUYCwgb3B0aW9uYWxseSB1bndyYXBwaW5nIENvbXBhdCB0eXBlcyB0byBleHBvc2UgdGhlXG4gKiB1bmRlcmx5aW5nIGluc3RhbmNlLiBUaHJvd3MgaWYgIGBvYmpgIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBgVGAuXG4gKlxuICogVGhpcyBjYXN0IGlzIHVzZWQgaW4gdGhlIExpdGUgYW5kIEZ1bGwgU0RLIHRvIHZlcmlmeSBpbnN0YW5jZSB0eXBlcyBmb3JcbiAqIGFyZ3VtZW50cyBwYXNzZWQgdG8gdGhlIHB1YmxpYyBBUEkuXG4gKiBAaW50ZXJuYWxcbiAqLyAodCk7XG4gICAgICAgICAgICByZXR1cm4gZSA/IGBhIGN1c3RvbSAke2V9IG9iamVjdGAgOiBcImFuIG9iamVjdFwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQgPyBcImEgZnVuY3Rpb25cIiA6IE8oKTtcbn1cblxuZnVuY3Rpb24gZmEodCwgXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuZSkge1xuICAgIGlmIChcIl9kZWxlZ2F0ZVwiIGluIHQgJiYgKFxuICAgIC8vIFVud3JhcCBDb21wYXQgdHlwZXNcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIHQgPSB0Ll9kZWxlZ2F0ZSksICEodCBpbnN0YW5jZW9mIGUpKSB7XG4gICAgICAgIGlmIChlLm5hbWUgPT09IHQuY29uc3RydWN0b3IubmFtZSkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIlR5cGUgZG9lcyBub3QgbWF0Y2ggdGhlIGV4cGVjdGVkIGluc3RhbmNlLiBEaWQgeW91IHBhc3MgYSByZWZlcmVuY2UgZnJvbSBhIGRpZmZlcmVudCBGaXJlc3RvcmUgU0RLP1wiKTtcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgbiA9IGxhKHQpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgRXhwZWN0ZWQgdHlwZSAnJHtlLm5hbWV9JywgYnV0IGl0IHdhczogJHtufWApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0O1xufVxuXG5mdW5jdGlvbiBkYSh0LCBlKSB7XG4gICAgaWYgKGUgPD0gMCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHt0fSgpIHJlcXVpcmVzIGEgcG9zaXRpdmUgbnVtYmVyLCBidXQgaXQgd2FzOiAke2V9LmApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBfYSA9IG5ldyBNYXA7XG5cbi8qKlxuICogQW4gaW5zdGFuY2UgbWFwIHRoYXQgZW5zdXJlcyBvbmx5IG9uZSBEYXRhc3RvcmUgZXhpc3RzIHBlciBGaXJlc3RvcmVcbiAqIGluc3RhbmNlLlxuICovXG4vKipcbiAqIEEgY29uY3JldGUgdHlwZSBkZXNjcmliaW5nIGFsbCB0aGUgdmFsdWVzIHRoYXQgY2FuIGJlIGFwcGxpZWQgdmlhIGFcbiAqIHVzZXItc3VwcGxpZWQgYEZpcmVzdG9yZVNldHRpbmdzYCBvYmplY3QuIFRoaXMgaXMgYSBzZXBhcmF0ZSB0eXBlIHNvIHRoYXRcbiAqIGRlZmF1bHRzIGNhbiBiZSBzdXBwbGllZCBhbmQgdGhlIHZhbHVlIGNhbiBiZSBjaGVja2VkIGZvciBlcXVhbGl0eS5cbiAqL1xuY2xhc3Mgd2Ege1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIGlmICh2b2lkIDAgPT09IHQuaG9zdCkge1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdC5zc2wpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJDYW4ndCBwcm92aWRlIHNzbCBvcHRpb24gaWYgaG9zdCBvcHRpb24gaXMgbm90IHNldFwiKTtcbiAgICAgICAgICAgIHRoaXMuaG9zdCA9IFwiZmlyZXN0b3JlLmdvb2dsZWFwaXMuY29tXCIsIHRoaXMuc3NsID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHRoaXMuaG9zdCA9IHQuaG9zdCwgdGhpcy5zc2wgPSBudWxsID09PSAoZSA9IHQuc3NsKSB8fCB2b2lkIDAgPT09IGUgfHwgZTtcbiAgICAgICAgaWYgKHRoaXMuY3JlZGVudGlhbHMgPSB0LmNyZWRlbnRpYWxzLCB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgPSAhIXQuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcywgXG4gICAgICAgIHZvaWQgMCA9PT0gdC5jYWNoZVNpemVCeXRlcykgdGhpcy5jYWNoZVNpemVCeXRlcyA9IDQxOTQzMDQwOyBlbHNlIHtcbiAgICAgICAgICAgIGlmICgtMSAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiB0LmNhY2hlU2l6ZUJ5dGVzIDwgMTA0ODU3NikgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcImNhY2hlU2l6ZUJ5dGVzIG11c3QgYmUgYXQgbGVhc3QgMTA0ODU3NlwiKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTaXplQnl0ZXMgPSB0LmNhY2hlU2l6ZUJ5dGVzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZyA9ICEhdC5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nLCB0aGlzLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyA9ICEhdC5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcsIFxuICAgICAgICB0aGlzLnVzZUZldGNoU3RyZWFtcyA9ICEhdC51c2VGZXRjaFN0cmVhbXMsIGNhKFwiZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZ1wiLCB0LmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcsIFwiZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nXCIsIHQuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nKTtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhvc3QgPT09IHQuaG9zdCAmJiB0aGlzLnNzbCA9PT0gdC5zc2wgJiYgdGhpcy5jcmVkZW50aWFscyA9PT0gdC5jcmVkZW50aWFscyAmJiB0aGlzLmNhY2hlU2l6ZUJ5dGVzID09PSB0LmNhY2hlU2l6ZUJ5dGVzICYmIHRoaXMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZyA9PT0gdC5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nICYmIHRoaXMuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nID09PSB0LmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyAmJiB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgPT09IHQuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyAmJiB0aGlzLnVzZUZldGNoU3RyZWFtcyA9PT0gdC51c2VGZXRjaFN0cmVhbXM7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKi8gY2xhc3MgbWEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcykge1xuICAgICAgICB0aGlzLl9hdXRoQ3JlZGVudGlhbHMgPSB0LCB0aGlzLl9hcHBDaGVja0NyZWRlbnRpYWxzID0gZSwgdGhpcy5fZGF0YWJhc2VJZCA9IG4sIFxuICAgICAgICB0aGlzLl9hcHAgPSBzLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgaXQncyBhIEZpcmVzdG9yZSBvciBGaXJlc3RvcmUgTGl0ZSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZmlyZXN0b3JlLWxpdGVcIiwgdGhpcy5fcGVyc2lzdGVuY2VLZXkgPSBcIihsaXRlKVwiLCB0aGlzLl9zZXR0aW5ncyA9IG5ldyB3YSh7fSksIFxuICAgICAgICB0aGlzLl9zZXR0aW5nc0Zyb3plbiA9ICExO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGBGaXJlc3RvcmVgIHNlcnZpY2VcbiAgICAgKiBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGFwcCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9hcHApIHRocm93IG5ldyBMKEIuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJGaXJlc3RvcmUgd2FzIG5vdCBpbml0aWFsaXplZCB1c2luZyB0aGUgRmlyZWJhc2UgU0RLLiAnYXBwJyBpcyBub3QgYXZhaWxhYmxlXCIpO1xuICAgICAgICByZXR1cm4gdGhpcy5fYXBwO1xuICAgIH1cbiAgICBnZXQgX2luaXRpYWxpemVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3NGcm96ZW47XG4gICAgfVxuICAgIGdldCBfdGVybWluYXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5fdGVybWluYXRlVGFzaztcbiAgICB9XG4gICAgX3NldFNldHRpbmdzKHQpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NldHRpbmdzRnJvemVuKSB0aHJvdyBuZXcgTChCLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiRmlyZXN0b3JlIGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZCBhbmQgaXRzIHNldHRpbmdzIGNhbiBubyBsb25nZXIgYmUgY2hhbmdlZC4gWW91IGNhbiBvbmx5IG1vZGlmeSBzZXR0aW5ncyBiZWZvcmUgY2FsbGluZyBhbnkgb3RoZXIgbWV0aG9kcyBvbiBhIEZpcmVzdG9yZSBvYmplY3QuXCIpO1xuICAgICAgICB0aGlzLl9zZXR0aW5ncyA9IG5ldyB3YSh0KSwgdm9pZCAwICE9PSB0LmNyZWRlbnRpYWxzICYmICh0aGlzLl9hdXRoQ3JlZGVudGlhbHMgPSBmdW5jdGlvbih0KSB7XG4gICAgICAgICAgICBpZiAoIXQpIHJldHVybiBuZXcgSztcbiAgICAgICAgICAgIHN3aXRjaCAodC50eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJnYXBpXCI6XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHQuY2xpZW50O1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVyhlLCB0LnNlc3Npb25JbmRleCB8fCBcIjBcIiwgdC5pYW1Ub2tlbiB8fCBudWxsLCB0LmF1dGhUb2tlbkZhY3RvcnkgfHwgbnVsbCk7XG5cbiAgICAgICAgICAgICAgY2FzZSBcInByb3ZpZGVyXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuY2xpZW50O1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIm1ha2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlciBmYWlsZWQgZHVlIHRvIGludmFsaWQgY3JlZGVudGlhbCB0eXBlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KHQuY3JlZGVudGlhbHMpKTtcbiAgICB9XG4gICAgX2dldFNldHRpbmdzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dGluZ3M7XG4gICAgfVxuICAgIF9mcmVlemVTZXR0aW5ncygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzRnJvemVuID0gITAsIHRoaXMuX3NldHRpbmdzO1xuICAgIH1cbiAgICBfZGVsZXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYXRlVGFzayB8fCAodGhpcy5fdGVybWluYXRlVGFzayA9IHRoaXMuX3Rlcm1pbmF0ZSgpKSwgdGhpcy5fdGVybWluYXRlVGFzaztcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSBKU09OLXNlcmlhbGl6YWJsZSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGBGaXJlc3RvcmVgIGluc3RhbmNlLiAqLyAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhcHA6IHRoaXMuX2FwcCxcbiAgICAgICAgICAgIGRhdGFiYXNlSWQ6IHRoaXMuX2RhdGFiYXNlSWQsXG4gICAgICAgICAgICBzZXR0aW5nczogdGhpcy5fc2V0dGluZ3NcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGVybWluYXRlcyBhbGwgY29tcG9uZW50cyB1c2VkIGJ5IHRoaXMgY2xpZW50LiBTdWJjbGFzc2VzIGNhbiBvdmVycmlkZVxuICAgICAqIHRoaXMgbWV0aG9kIHRvIGNsZWFuIHVwIHRoZWlyIG93biBkZXBlbmRlbmNpZXMsIGJ1dCBtdXN0IGFsc28gY2FsbCB0aGlzXG4gICAgICogbWV0aG9kLlxuICAgICAqXG4gICAgICogT25seSBldmVyIGNhbGxlZCBvbmNlLlxuICAgICAqLyAgICBfdGVybWluYXRlKCkge1xuICAgICAgICAvKipcbiAqIFJlbW92ZXMgYWxsIGNvbXBvbmVudHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBwcm92aWRlZCBpbnN0YW5jZS4gTXVzdCBiZSBjYWxsZWRcbiAqIHdoZW4gdGhlIGBGaXJlc3RvcmVgIGluc3RhbmNlIGlzIHRlcm1pbmF0ZWQuXG4gKi9cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBfYS5nZXQodCk7XG4gICAgICAgICAgICBlICYmIChDKFwiQ29tcG9uZW50UHJvdmlkZXJcIiwgXCJSZW1vdmluZyBEYXRhc3RvcmVcIiksIF9hLmRlbGV0ZSh0KSwgZS50ZXJtaW5hdGUoKSk7XG4gICAgICAgIH0odGhpcyksIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBNb2RpZnkgdGhpcyBpbnN0YW5jZSB0byBjb21tdW5pY2F0ZSB3aXRoIHRoZSBDbG91ZCBGaXJlc3RvcmUgZW11bGF0b3IuXG4gKlxuICogTm90ZTogVGhpcyBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgdGhpcyBpbnN0YW5jZSBoYXMgYmVlbiB1c2VkIHRvIGRvIGFueVxuICogb3BlcmF0aW9ucy5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIGBGaXJlc3RvcmVgIGluc3RhbmNlIHRvIGNvbmZpZ3VyZSB0byBjb25uZWN0IHRvIHRoZVxuICogZW11bGF0b3IuXG4gKiBAcGFyYW0gaG9zdCAtIHRoZSBlbXVsYXRvciBob3N0IChleDogbG9jYWxob3N0KS5cbiAqIEBwYXJhbSBwb3J0IC0gdGhlIGVtdWxhdG9yIHBvcnQgKGV4OiA5MDAwKS5cbiAqIEBwYXJhbSBvcHRpb25zLm1vY2tVc2VyVG9rZW4gLSB0aGUgbW9jayBhdXRoIHRva2VuIHRvIHVzZSBmb3IgdW5pdCB0ZXN0aW5nXG4gKiBTZWN1cml0eSBSdWxlcy5cbiAqLyBmdW5jdGlvbiBnYSh0LCBlLCBuLCBzID0ge30pIHtcbiAgICB2YXIgaTtcbiAgICBjb25zdCByID0gKHQgPSBmYSh0LCBtYSkpLl9nZXRTZXR0aW5ncygpO1xuICAgIGlmIChcImZpcmVzdG9yZS5nb29nbGVhcGlzLmNvbVwiICE9PSByLmhvc3QgJiYgci5ob3N0ICE9PSBlICYmIE4oXCJIb3N0IGhhcyBiZWVuIHNldCBpbiBib3RoIHNldHRpbmdzKCkgYW5kIHVzZUVtdWxhdG9yKCksIGVtdWxhdG9yIGhvc3Qgd2lsbCBiZSB1c2VkXCIpLCBcbiAgICB0Ll9zZXRTZXR0aW5ncyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHIpLCB7XG4gICAgICAgIGhvc3Q6IGAke2V9OiR7bn1gLFxuICAgICAgICBzc2w6ICExXG4gICAgfSkpLCBzLm1vY2tVc2VyVG9rZW4pIHtcbiAgICAgICAgbGV0IGUsIG47XG4gICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBzLm1vY2tVc2VyVG9rZW4pIGUgPSBzLm1vY2tVc2VyVG9rZW4sIG4gPSBQLk1PQ0tfVVNFUjsgZWxzZSB7XG4gICAgICAgICAgICAvLyBMZXQgY3JlYXRlTW9ja1VzZXJUb2tlbiB2YWxpZGF0ZSBmaXJzdCAoY2F0Y2hlcyBjb21tb24gbWlzdGFrZXMgbGlrZVxuICAgICAgICAgICAgLy8gaW52YWxpZCBmaWVsZCBcInVpZFwiIGFuZCBtaXNzaW5nIGZpZWxkIFwic3ViXCIgLyBcInVzZXJfaWRcIi4pXG4gICAgICAgICAgICBlID0gY3JlYXRlTW9ja1VzZXJUb2tlbihzLm1vY2tVc2VyVG9rZW4sIG51bGwgPT09IChpID0gdC5fYXBwKSB8fCB2b2lkIDAgPT09IGkgPyB2b2lkIDAgOiBpLm9wdGlvbnMucHJvamVjdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBzLm1vY2tVc2VyVG9rZW4uc3ViIHx8IHMubW9ja1VzZXJUb2tlbi51c2VyX2lkO1xuICAgICAgICAgICAgaWYgKCFyKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkIVwiKTtcbiAgICAgICAgICAgIG4gPSBuZXcgUChyKTtcbiAgICAgICAgfVxuICAgICAgICB0Ll9hdXRoQ3JlZGVudGlhbHMgPSBuZXcgRyhuZXcgVShlLCBuKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBEb2N1bWVudFJlZmVyZW5jZWAgcmVmZXJzIHRvIGEgZG9jdW1lbnQgbG9jYXRpb24gaW4gYSBGaXJlc3RvcmUgZGF0YWJhc2VcbiAqIGFuZCBjYW4gYmUgdXNlZCB0byB3cml0ZSwgcmVhZCwgb3IgbGlzdGVuIHRvIHRoZSBsb2NhdGlvbi4gVGhlIGRvY3VtZW50IGF0XG4gKiB0aGUgcmVmZXJlbmNlZCBsb2NhdGlvbiBtYXkgb3IgbWF5IG5vdCBleGlzdC5cbiAqLyBjbGFzcyB5YSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBcbiAgICAvKipcbiAgICAgKiBJZiBwcm92aWRlZCwgdGhlIGBGaXJlc3RvcmVEYXRhQ29udmVydGVyYCBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBlLCBuKSB7XG4gICAgICAgIHRoaXMuY29udmVydGVyID0gZSwgdGhpcy5fa2V5ID0gbiwgXG4gICAgICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIEZpcmVzdG9yZSByZWZlcmVuY2UuICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZG9jdW1lbnRcIiwgdGhpcy5maXJlc3RvcmUgPSB0O1xuICAgIH1cbiAgICBnZXQgX3BhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGRvY3VtZW50J3MgaWRlbnRpZmllciB3aXRoaW4gaXRzIGNvbGxlY3Rpb24uXG4gICAgICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgcGF0aCBvZiB0aGUgcmVmZXJlbmNlZCBkb2N1bWVudCAocmVsYXRpdmVcbiAgICAgKiB0byB0aGUgcm9vdCBvZiB0aGUgZGF0YWJhc2UpLlxuICAgICAqLyAgICBnZXQgcGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgY29sbGVjdGlvbiB0aGlzIGBEb2N1bWVudFJlZmVyZW5jZWAgYmVsb25ncyB0by5cbiAgICAgKi8gICAgZ2V0IHBhcmVudCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJYSh0aGlzLmZpcmVzdG9yZSwgdGhpcy5jb252ZXJ0ZXIsIHRoaXMuX2tleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIodCkge1xuICAgICAgICByZXR1cm4gbmV3IHlhKHRoaXMuZmlyZXN0b3JlLCB0LCB0aGlzLl9rZXkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeWAgcmVmZXJzIHRvIGEgcXVlcnkgd2hpY2ggeW91IGNhbiByZWFkIG9yIGxpc3RlbiB0by4gWW91IGNhbiBhbHNvXG4gKiBjb25zdHJ1Y3QgcmVmaW5lZCBgUXVlcnlgIG9iamVjdHMgYnkgYWRkaW5nIGZpbHRlcnMgYW5kIG9yZGVyaW5nLlxuICovIGNsYXNzIHBhIHtcbiAgICAvLyBUaGlzIGlzIHRoZSBsaXRlIHZlcnNpb24gb2YgdGhlIFF1ZXJ5IGNsYXNzIGluIHRoZSBtYWluIFNESy5cbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciBwcm90ZWN0ZWQgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBcbiAgICAvKipcbiAgICAgKiBJZiBwcm92aWRlZCwgdGhlIGBGaXJlc3RvcmVEYXRhQ29udmVydGVyYCBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbnN0YW5jZS5cbiAgICAgKi9cbiAgICBlLCBuKSB7XG4gICAgICAgIHRoaXMuY29udmVydGVyID0gZSwgdGhpcy5fcXVlcnkgPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJxdWVyeVwiLCB0aGlzLmZpcmVzdG9yZSA9IHQ7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIodCkge1xuICAgICAgICByZXR1cm4gbmV3IHBhKHRoaXMuZmlyZXN0b3JlLCB0LCB0aGlzLl9xdWVyeSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYENvbGxlY3Rpb25SZWZlcmVuY2VgIG9iamVjdCBjYW4gYmUgdXNlZCBmb3IgYWRkaW5nIGRvY3VtZW50cywgZ2V0dGluZ1xuICogZG9jdW1lbnQgcmVmZXJlbmNlcywgYW5kIHF1ZXJ5aW5nIGZvciBkb2N1bWVudHMgKHVzaW5nIHtAbGluayBxdWVyeX0pLlxuICovIGNsYXNzIElhIGV4dGVuZHMgcGEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbikge1xuICAgICAgICBzdXBlcih0LCBlLCBsbihuKSksIHRoaXMuX3BhdGggPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJjb2xsZWN0aW9uXCI7XG4gICAgfVxuICAgIC8qKiBUaGUgY29sbGVjdGlvbidzIGlkZW50aWZpZXIuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5LnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBwYXRoIG9mIHRoZSByZWZlcmVuY2VkIGNvbGxlY3Rpb24gKHJlbGF0aXZlXG4gICAgICogdG8gdGhlIHJvb3Qgb2YgdGhlIGRhdGFiYXNlKS5cbiAgICAgKi8gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgY29udGFpbmluZyBgRG9jdW1lbnRSZWZlcmVuY2VgIGlmIHRoaXMgaXMgYVxuICAgICAqIHN1YmNvbGxlY3Rpb24uIElmIHRoaXMgaXNuJ3QgYSBzdWJjb2xsZWN0aW9uLCB0aGUgcmVmZXJlbmNlIGlzIG51bGwuXG4gICAgICovICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLl9wYXRoLnBvcExhc3QoKTtcbiAgICAgICAgcmV0dXJuIHQuaXNFbXB0eSgpID8gbnVsbCA6IG5ldyB5YSh0aGlzLmZpcmVzdG9yZSwgXG4gICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgbmV3IGN0KHQpKTtcbiAgICB9XG4gICAgd2l0aENvbnZlcnRlcih0KSB7XG4gICAgICAgIHJldHVybiBuZXcgSWEodGhpcy5maXJlc3RvcmUsIHQsIHRoaXMuX3BhdGgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gVGEodCwgZSwgLi4ubikge1xuICAgIGlmICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpLCB1YShcImNvbGxlY3Rpb25cIiwgXCJwYXRoXCIsIGUpLCB0IGluc3RhbmNlb2YgbWEpIHtcbiAgICAgICAgY29uc3QgcyA9IHJ0LmZyb21TdHJpbmcoZSwgLi4ubik7XG4gICAgICAgIHJldHVybiBoYShzKSwgbmV3IElhKHQsIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgcyk7XG4gICAgfVxuICAgIHtcbiAgICAgICAgaWYgKCEodCBpbnN0YW5jZW9mIHlhIHx8IHQgaW5zdGFuY2VvZiBJYSkpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJFeHBlY3RlZCBmaXJzdCBhcmd1bWVudCB0byBjb2xsZWN0aW9uKCkgdG8gYmUgYSBDb2xsZWN0aW9uUmVmZXJlbmNlLCBhIERvY3VtZW50UmVmZXJlbmNlIG9yIEZpcmViYXNlRmlyZXN0b3JlXCIpO1xuICAgICAgICBjb25zdCBzID0gdC5fcGF0aC5jaGlsZChydC5mcm9tU3RyaW5nKGUsIC4uLm4pKTtcbiAgICAgICAgcmV0dXJuIGhhKHMpLCBuZXcgSWEodC5maXJlc3RvcmUsIFxuICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHMpO1xuICAgIH1cbn1cblxuLy8gVE9ETyhmaXJlc3RvcmVsaXRlKTogQ29uc2lkZXIgdXNpbmcgRXJyb3JGYWN0b3J5IC1cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvYmxvYi8wMTMxZTFmL3BhY2thZ2VzL3V0aWwvc3JjL2Vycm9ycy50cyNMMTA2XG4vKipcbiAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgYFF1ZXJ5YCBpbnN0YW5jZSB0aGF0IGluY2x1ZGVzIGFsbCBkb2N1bWVudHMgaW4gdGhlXG4gKiBkYXRhYmFzZSB0aGF0IGFyZSBjb250YWluZWQgaW4gYSBjb2xsZWN0aW9uIG9yIHN1YmNvbGxlY3Rpb24gd2l0aCB0aGVcbiAqIGdpdmVuIGBjb2xsZWN0aW9uSWRgLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBBIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBgRmlyZXN0b3JlYCBpbnN0YW5jZS5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWQgLSBJZGVudGlmaWVzIHRoZSBjb2xsZWN0aW9ucyB0byBxdWVyeSBvdmVyLiBFdmVyeVxuICogY29sbGVjdGlvbiBvciBzdWJjb2xsZWN0aW9uIHdpdGggdGhpcyBJRCBhcyB0aGUgbGFzdCBzZWdtZW50IG9mIGl0cyBwYXRoXG4gKiB3aWxsIGJlIGluY2x1ZGVkLiBDYW5ub3QgY29udGFpbiBhIHNsYXNoLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQgYFF1ZXJ5YC5cbiAqLyBmdW5jdGlvbiBFYSh0LCBlKSB7XG4gICAgaWYgKHQgPSBmYSh0LCBtYSksIHVhKFwiY29sbGVjdGlvbkdyb3VwXCIsIFwiY29sbGVjdGlvbiBpZFwiLCBlKSwgZS5pbmRleE9mKFwiL1wiKSA+PSAwKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGNvbGxlY3Rpb24gSUQgJyR7ZX0nIHBhc3NlZCB0byBmdW5jdGlvbiBjb2xsZWN0aW9uR3JvdXAoKS4gQ29sbGVjdGlvbiBJRHMgbXVzdCBub3QgY29udGFpbiAnLycuYCk7XG4gICAgcmV0dXJuIG5ldyBwYSh0LCBcbiAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBhbihydC5lbXB0eVBhdGgoKSwgdCk7XG4gICAgfShlKSk7XG59XG5cbmZ1bmN0aW9uIEFhKHQsIGUsIC4uLm4pIHtcbiAgICBpZiAodCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSwgXG4gICAgLy8gV2UgYWxsb3cgb21pc3Npb24gb2YgJ3BhdGhTdHJpbmcnIGJ1dCBleHBsaWNpdGx5IHByb2hpYml0IHBhc3NpbmcgaW4gYm90aFxuICAgIC8vICd1bmRlZmluZWQnIGFuZCAnbnVsbCcuXG4gICAgMSA9PT0gYXJndW1lbnRzLmxlbmd0aCAmJiAoZSA9IFguUigpKSwgdWEoXCJkb2NcIiwgXCJwYXRoXCIsIGUpLCB0IGluc3RhbmNlb2YgbWEpIHtcbiAgICAgICAgY29uc3QgcyA9IHJ0LmZyb21TdHJpbmcoZSwgLi4ubik7XG4gICAgICAgIHJldHVybiBhYShzKSwgbmV3IHlhKHQsIFxuICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIG5ldyBjdChzKSk7XG4gICAgfVxuICAgIHtcbiAgICAgICAgaWYgKCEodCBpbnN0YW5jZW9mIHlhIHx8IHQgaW5zdGFuY2VvZiBJYSkpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJFeHBlY3RlZCBmaXJzdCBhcmd1bWVudCB0byBjb2xsZWN0aW9uKCkgdG8gYmUgYSBDb2xsZWN0aW9uUmVmZXJlbmNlLCBhIERvY3VtZW50UmVmZXJlbmNlIG9yIEZpcmViYXNlRmlyZXN0b3JlXCIpO1xuICAgICAgICBjb25zdCBzID0gdC5fcGF0aC5jaGlsZChydC5mcm9tU3RyaW5nKGUsIC4uLm4pKTtcbiAgICAgICAgcmV0dXJuIGFhKHMpLCBuZXcgeWEodC5maXJlc3RvcmUsIHQgaW5zdGFuY2VvZiBJYSA/IHQuY29udmVydGVyIDogbnVsbCwgbmV3IGN0KHMpKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCByZWZlcmVuY2VzIGFyZSBlcXVhbC5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgcmVmZXJlbmNlIHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBBIHJlZmVyZW5jZSB0byBjb21wYXJlLlxuICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgcmVmZXJlbmNlcyBwb2ludCB0byB0aGUgc2FtZSBsb2NhdGlvbiBpbiB0aGUgc2FtZVxuICogRmlyZXN0b3JlIGRhdGFiYXNlLlxuICovIGZ1bmN0aW9uIFJhKHQsIGUpIHtcbiAgICByZXR1cm4gdCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSwgZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgKHQgaW5zdGFuY2VvZiB5YSB8fCB0IGluc3RhbmNlb2YgSWEpICYmIChlIGluc3RhbmNlb2YgeWEgfHwgZSBpbnN0YW5jZW9mIElhKSAmJiAodC5maXJlc3RvcmUgPT09IGUuZmlyZXN0b3JlICYmIHQucGF0aCA9PT0gZS5wYXRoICYmIHQuY29udmVydGVyID09PSBlLmNvbnZlcnRlcik7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBxdWVyaWVzIHBvaW50IHRvIHRoZSBzYW1lIGNvbGxlY3Rpb24gYW5kIGFwcGx5XG4gKiB0aGUgc2FtZSBjb25zdHJhaW50cy5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgYFF1ZXJ5YCB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gQSBgUXVlcnlgIHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSByZWZlcmVuY2VzIHBvaW50IHRvIHRoZSBzYW1lIGxvY2F0aW9uIGluIHRoZSBzYW1lXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UuXG4gKi8gZnVuY3Rpb24gYmEodCwgZSkge1xuICAgIHJldHVybiB0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpLCBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpLCB0IGluc3RhbmNlb2YgcGEgJiYgZSBpbnN0YW5jZW9mIHBhICYmICh0LmZpcmVzdG9yZSA9PT0gZS5maXJlc3RvcmUgJiYgSW4odC5fcXVlcnksIGUuX3F1ZXJ5KSAmJiB0LmNvbnZlcnRlciA9PT0gZS5jb252ZXJ0ZXIpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBIb3cgbWFueSBieXRlcyB0byByZWFkIGVhY2ggdGltZSB3aGVuIGBSZWFkYWJsZVN0cmVhbVJlYWRlci5yZWFkKClgIGlzXG4gKiBjYWxsZWQuIE9ubHkgYXBwbGljYWJsZSBmb3IgYnl0ZSBzdHJlYW1zIHRoYXQgd2UgY29udHJvbCAoZS5nLiB0aG9zZSBiYWNrZWRcbiAqIGJ5IGFuIFVJbnQ4QXJyYXkpLlxuICovXG4vKipcbiAqIEJ1aWxkcyBhIGBCeXRlU3RyZWFtUmVhZGVyYCBmcm9tIGEgVUludDhBcnJheS5cbiAqIEBwYXJhbSBzb3VyY2UgLSBUaGUgZGF0YSBzb3VyY2UgdG8gdXNlLlxuICogQHBhcmFtIGJ5dGVzUGVyUmVhZCAtIEhvdyBtYW55IGJ5dGVzIGVhY2ggYHJlYWQoKWAgZnJvbSB0aGUgcmV0dXJuZWQgcmVhZGVyXG4gKiAgICAgICAgd2lsbCByZWFkLlxuICovXG5mdW5jdGlvbiBQYSh0LCBlID0gMTAyNDApIHtcbiAgICBsZXQgbiA9IDA7XG4gICAgLy8gVGhlIFR5cGVTY3JpcHQgZGVmaW5pdGlvbiBmb3IgUmVhZGFibGVTdHJlYW1SZWFkZXIgY2hhbmdlZC4gV2UgdXNlXG4gICAgLy8gYGFueWAgaGVyZSB0byBhbGxvdyB0aGlzIGNvZGUgdG8gY29tcGlsZSB3aXRoIGRpZmZlcmVudCB2ZXJzaW9ucy5cbiAgICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC9UeXBlU2NyaXB0L2lzc3Vlcy80Mjk3MFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGFzeW5jIHJlYWQoKSB7XG4gICAgICAgICAgICBpZiAobiA8IHQuYnl0ZUxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0LnNsaWNlKG4sIG4gKyBlKSxcbiAgICAgICAgICAgICAgICAgICAgZG9uZTogITFcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHJldHVybiBuICs9IGUsIHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGRvbmU6ICEwXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICBhc3luYyBjYW5jZWwoKSB7fSxcbiAgICAgICAgcmVsZWFzZUxvY2soKSB7fSxcbiAgICAgICAgY2xvc2VkOiBQcm9taXNlLnJlamVjdChcInVuaW1wbGVtZW50ZWRcIilcbiAgICB9O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBPbiB3ZWIsIGEgYFJlYWRhYmxlU3RyZWFtYCBpcyB3cmFwcGVkIGFyb3VuZCBieSBhIGBCeXRlU3RyZWFtUmVhZGVyYC5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qXG4gKiBBIHdyYXBwZXIgaW1wbGVtZW50YXRpb24gb2YgT2JzZXJ2ZXI8VD4gdGhhdCB3aWxsIGRpc3BhdGNoIGV2ZW50c1xuICogYXN5bmNocm9ub3VzbHkuIFRvIGFsbG93IGltbWVkaWF0ZSBzaWxlbmNpbmcsIGEgbXV0ZSBjYWxsIGlzIGFkZGVkIHdoaWNoXG4gKiBjYXVzZXMgZXZlbnRzIHNjaGVkdWxlZCB0byBubyBsb25nZXIgYmUgcmFpc2VkLlxuICovXG5jbGFzcyB2YSB7XG4gICAgY29uc3RydWN0b3IodCkge1xuICAgICAgICB0aGlzLm9ic2VydmVyID0gdCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGVuIHNldCB0byB0cnVlLCB3aWxsIG5vdCByYWlzZSBmdXR1cmUgZXZlbnRzLiBOZWNlc3NhcnkgdG8gZGVhbCB3aXRoXG4gICAgICAgICAqIGFzeW5jIGRldGFjaG1lbnQgb2YgbGlzdGVuZXIuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm11dGVkID0gITE7XG4gICAgfVxuICAgIG5leHQodCkge1xuICAgICAgICB0aGlzLm9ic2VydmVyLm5leHQgJiYgdGhpcy5SYyh0aGlzLm9ic2VydmVyLm5leHQsIHQpO1xuICAgIH1cbiAgICBlcnJvcih0KSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIuZXJyb3IgPyB0aGlzLlJjKHRoaXMub2JzZXJ2ZXIuZXJyb3IsIHQpIDogeChcIlVuY2F1Z2h0IEVycm9yIGluIHNuYXBzaG90IGxpc3RlbmVyOlwiLCB0LnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBiYygpIHtcbiAgICAgICAgdGhpcy5tdXRlZCA9ICEwO1xuICAgIH1cbiAgICBSYyh0LCBlKSB7XG4gICAgICAgIHRoaXMubXV0ZWQgfHwgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5tdXRlZCB8fCB0KGUpO1xuICAgICAgICB9KSwgMCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNsYXNzIHJlcHJlc2VudGluZyBhIGJ1bmRsZS5cbiAqXG4gKiBUYWtlcyBhIGJ1bmRsZSBzdHJlYW0gb3IgYnVmZmVyLCBhbmQgcHJlc2VudHMgYWJzdHJhY3Rpb25zIHRvIHJlYWQgYnVuZGxlZFxuICogZWxlbWVudHMgb3V0IG9mIHRoZSB1bmRlcmx5aW5nIGNvbnRlbnQuXG4gKi8gY2xhc3MgVmEge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgcmVhZGVyIHRvIHJlYWQgZnJvbSB1bmRlcmx5aW5nIGJpbmFyeSBidW5kbGUgZGF0YSBzb3VyY2UuICovXG4gICAgdCwgZSkge1xuICAgICAgICB0aGlzLlBjID0gdCwgdGhpcy55dCA9IGUsIFxuICAgICAgICAvKiogQ2FjaGVkIGJ1bmRsZSBtZXRhZGF0YS4gKi9cbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG5ldyBxLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIGJ1ZmZlciB0byBob2xkIGJ1bmRsZSBjb250ZW50LCBhY2N1bXVsYXRpbmcgaW5jb21wbGV0ZSBlbGVtZW50XG4gICAgICAgICAqIGNvbnRlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBVaW50OEFycmF5LCB0aGlzLnZjID0gbmV3IFRleHREZWNvZGVyKFwidXRmLThcIiksIFxuICAgICAgICAvLyBSZWFkIHRoZSBtZXRhZGF0YSAod2hpY2ggaXMgdGhlIGZpcnN0IGVsZW1lbnQpLlxuICAgICAgICB0aGlzLlZjKCkudGhlbigodCA9PiB7XG4gICAgICAgICAgICB0ICYmIHQuT3UoKSA/IHRoaXMubWV0YWRhdGEucmVzb2x2ZSh0Lmt1Lm1ldGFkYXRhKSA6IHRoaXMubWV0YWRhdGEucmVqZWN0KG5ldyBFcnJvcihgVGhlIGZpcnN0IGVsZW1lbnQgb2YgdGhlIGJ1bmRsZSBpcyBub3QgYSBtZXRhZGF0YSwgaXQgaXNcXG4gICAgICAgICAgICAgJHtKU09OLnN0cmluZ2lmeShudWxsID09IHQgPyB2b2lkIDAgOiB0Lmt1KX1gKSk7XG4gICAgICAgIH0pLCAodCA9PiB0aGlzLm1ldGFkYXRhLnJlamVjdCh0KSkpO1xuICAgIH1cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUGMuY2FuY2VsKCk7XG4gICAgfVxuICAgIGFzeW5jIGdldE1ldGFkYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tZXRhZGF0YS5wcm9taXNlO1xuICAgIH1cbiAgICBhc3luYyBtYygpIHtcbiAgICAgICAgLy8gTWFrZXMgc3VyZSBtZXRhZGF0YSBpcyByZWFkIGJlZm9yZSBwcm9jZWVkaW5nLlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRNZXRhZGF0YSgpLCB0aGlzLlZjKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIGZyb20gdGhlIGhlYWQgb2YgaW50ZXJuYWwgYnVmZmVyLCBhbmQgcHVsbGluZyBtb3JlIGRhdGEgZnJvbVxuICAgICAqIHVuZGVybHlpbmcgc3RyZWFtIGlmIGEgY29tcGxldGUgZWxlbWVudCBjYW5ub3QgYmUgZm91bmQsIHVudGlsIGFuXG4gICAgICogZWxlbWVudChpbmNsdWRpbmcgdGhlIHByZWZpeGVkIGxlbmd0aCBhbmQgdGhlIEpTT04gc3RyaW5nKSBpcyBmb3VuZC5cbiAgICAgKlxuICAgICAqIE9uY2UgYSBjb21wbGV0ZSBlbGVtZW50IGlzIHJlYWQsIGl0IGlzIGRyb3BwZWQgZnJvbSBpbnRlcm5hbCBidWZmZXIuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIGVpdGhlciB0aGUgYnVuZGxlZCBlbGVtZW50LCBvciBudWxsIGlmIHdlIGhhdmUgcmVhY2hlZCB0aGUgZW5kIG9mXG4gICAgICogdGhlIHN0cmVhbS5cbiAgICAgKi8gICAgYXN5bmMgVmMoKSB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCB0aGlzLlNjKCk7XG4gICAgICAgIGlmIChudWxsID09PSB0KSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMudmMuZGVjb2RlKHQpLCBuID0gTnVtYmVyKGUpO1xuICAgICAgICBpc05hTihuKSAmJiB0aGlzLkRjKGBsZW5ndGggc3RyaW5nICgke2V9KSBpcyBub3QgdmFsaWQgbnVtYmVyYCk7XG4gICAgICAgIGNvbnN0IHMgPSBhd2FpdCB0aGlzLkNjKG4pO1xuICAgICAgICByZXR1cm4gbmV3IHdjKEpTT04ucGFyc2UocyksIHQubGVuZ3RoICsgbik7XG4gICAgfVxuICAgIC8qKiBGaXJzdCBpbmRleCBvZiAneycgZnJvbSB0aGUgdW5kZXJseWluZyBidWZmZXIuICovICAgIHhjKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIuZmluZEluZGV4KCh0ID0+IHQgPT09IFwie1wiLmNoYXJDb2RlQXQoMCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBpbnRlcm5hbCBidWZmZXIsIHVudGlsIHRoZSBmaXJzdCAneycsIGFuZFxuICAgICAqIHJldHVybiB0aGUgY29udGVudC5cbiAgICAgKlxuICAgICAqIElmIHJlYWNoZWQgZW5kIG9mIHRoZSBzdHJlYW0sIHJldHVybnMgYSBudWxsLlxuICAgICAqLyAgICBhc3luYyBTYygpIHtcbiAgICAgICAgZm9yICg7dGhpcy54YygpIDwgMDsgKSB7XG4gICAgICAgICAgICBpZiAoYXdhaXQgdGhpcy5OYygpKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAvLyBCcm9rZSBvdXQgb2YgdGhlIGxvb3AgYmVjYXVzZSB1bmRlcmx5aW5nIHN0cmVhbSBpcyBjbG9zZWQsIGFuZCB0aGVyZVxuICAgICAgICAvLyBoYXBwZW5zIHRvIGJlIG5vIG1vcmUgZGF0YSB0byBwcm9jZXNzLlxuICAgICAgICAgICAgICAgIGlmICgwID09PSB0aGlzLmJ1ZmZlci5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy54YygpO1xuICAgICAgICAvLyBCcm9rZSBvdXQgb2YgdGhlIGxvb3AgYmVjYXVzZSB1bmRlcmx5aW5nIHN0cmVhbSBpcyBjbG9zZWQsIGJ1dCBzdGlsbFxuICAgICAgICAvLyBjYW5ub3QgZmluZCBhbiBvcGVuIGJyYWNrZXQuXG4gICAgICAgICAgICAgICAgdCA8IDAgJiYgdGhpcy5EYyhcIlJlYWNoZWQgdGhlIGVuZCBvZiBidW5kbGUgd2hlbiBhIGxlbmd0aCBzdHJpbmcgaXMgZXhwZWN0ZWQuXCIpO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5idWZmZXIuc2xpY2UoMCwgdCk7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW50ZXJuYWwgYnVmZmVyIHRvIGRyb3AgdGhlIHJlYWQgbGVuZ3RoLlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLnNsaWNlKHQpLCBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyBmcm9tIGEgc3BlY2lmaWVkIHBvc2l0aW9uIGZyb20gdGhlIGludGVybmFsIGJ1ZmZlciwgZm9yIGEgc3BlY2lmaWVkXG4gICAgICogbnVtYmVyIG9mIGJ5dGVzLCBwdWxsaW5nIG1vcmUgZGF0YSBmcm9tIHRoZSB1bmRlcmx5aW5nIHN0cmVhbSBpZiBuZWVkZWQuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIGRlY29kZWQgZnJvbSB0aGUgcmVhZCBieXRlcy5cbiAgICAgKi8gICAgYXN5bmMgQ2ModCkge1xuICAgICAgICBmb3IgKDt0aGlzLmJ1ZmZlci5sZW5ndGggPCB0OyApIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuTmMoKSAmJiB0aGlzLkRjKFwiUmVhY2hlZCB0aGUgZW5kIG9mIGJ1bmRsZSB3aGVuIG1vcmUgaXMgZXhwZWN0ZWQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnZjLmRlY29kZSh0aGlzLmJ1ZmZlci5zbGljZSgwLCB0KSk7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgaW50ZXJuYWwgYnVmZmVyIHRvIGRyb3AgdGhlIHJlYWQganNvbiBzdHJpbmcuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuc2xpY2UodCksIGU7XG4gICAgfVxuICAgIERjKHQpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICB0aHJvdyB0aGlzLlBjLmNhbmNlbCgpLCBuZXcgRXJyb3IoYEludmFsaWQgYnVuZGxlIGZvcm1hdDogJHt0fWApO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQdWxscyBtb3JlIGRhdGEgZnJvbSB1bmRlcmx5aW5nIHN0cmVhbSB0byBpbnRlcm5hbCBidWZmZXIuXG4gICAgICogUmV0dXJucyBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBzdHJlYW0gaXMgZmluaXNoZWQuXG4gICAgICovICAgIGFzeW5jIE5jKCkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgdGhpcy5QYy5yZWFkKCk7XG4gICAgICAgIGlmICghdC5kb25lKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIubGVuZ3RoICsgdC52YWx1ZS5sZW5ndGgpO1xuICAgICAgICAgICAgZS5zZXQodGhpcy5idWZmZXIpLCBlLnNldCh0LnZhbHVlLCB0aGlzLmJ1ZmZlci5sZW5ndGgpLCB0aGlzLmJ1ZmZlciA9IGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQuZG9uZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gYWdncmVnYXRpb24gdGhhdCBjYW4gYmUgcGVyZm9ybWVkIGJ5IEZpcmVzdG9yZS5cbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuY2xhc3MgU2Ege1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvKiogQSB0eXBlIHN0cmluZyB0byB1bmlxdWVseSBpZGVudGlmeSBpbnN0YW5jZXMgb2YgdGhpcyBjbGFzcy4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJBZ2dyZWdhdGVGaWVsZFwiO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgcmVzdWx0cyBvZiBleGVjdXRpbmcgYW4gYWdncmVnYXRpb24gcXVlcnkuXG4gKi8gY2xhc3MgRGEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLl9kYXRhID0gZSwgXG4gICAgICAgIC8qKiBBIHR5cGUgc3RyaW5nIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcIkFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RcIiwgdGhpcy5xdWVyeSA9IHQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHJlc3VsdHMgb2YgdGhlIGFnZ3JlZ2F0aW9ucyBwZXJmb3JtZWQgb3ZlciB0aGUgdW5kZXJseWluZ1xuICAgICAqIHF1ZXJ5LlxuICAgICAqXG4gICAgICogVGhlIGtleXMgb2YgdGhlIHJldHVybmVkIG9iamVjdCB3aWxsIGJlIHRoZSBzYW1lIGFzIHRob3NlIG9mIHRoZVxuICAgICAqIGBBZ2dyZWdhdGVTcGVjYCBvYmplY3Qgc3BlY2lmaWVkIHRvIHRoZSBhZ2dyZWdhdGlvbiBtZXRob2QsIGFuZCB0aGUgdmFsdWVzXG4gICAgICogd2lsbCBiZSB0aGUgY29ycmVzcG9uZGluZyBhZ2dyZWdhdGlvbiByZXN1bHQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgcmVzdWx0cyBvZiB0aGUgYWdncmVnYXRpb25zIHBlcmZvcm1lZCBvdmVyIHRoZSB1bmRlcmx5aW5nXG4gICAgICogcXVlcnkuXG4gICAgICovICAgIGRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ291bnRRdWVyeVJ1bm5lciBlbmNhcHN1bGF0ZXMgdGhlIGxvZ2ljIG5lZWRlZCB0byBydW4gdGhlIGNvdW50IGFnZ3JlZ2F0aW9uXG4gKiBxdWVyaWVzLlxuICovIGNsYXNzIENhIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSB0LCB0aGlzLmRhdGFzdG9yZSA9IGUsIHRoaXMudXNlckRhdGFXcml0ZXIgPSBuO1xuICAgIH1cbiAgICBydW4oKSB7XG4gICAgICAgIHJldHVybiBidSh0aGlzLmRhdGFzdG9yZSwgdGhpcy5xdWVyeS5fcXVlcnkpLnRoZW4oKHQgPT4ge1xuICAgICAgICAgICAgTSh2b2lkIDAgIT09IHRbMF0pO1xuICAgICAgICAgICAgY29uc3QgZSA9IE9iamVjdC5lbnRyaWVzKHRbMF0pLmZpbHRlcigoKFt0LCBlXSkgPT4gXCJjb3VudF9hbGlhc1wiID09PSB0KSkubWFwKCgoW3QsIGVdKSA9PiB0aGlzLnVzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZShlKSkpWzBdO1xuICAgICAgICAgICAgcmV0dXJuIE0oXCJudW1iZXJcIiA9PSB0eXBlb2YgZSksIFByb21pc2UucmVzb2x2ZShuZXcgRGEodGhpcy5xdWVyeSwge1xuICAgICAgICAgICAgICAgIGNvdW50OiBlXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEludGVybmFsIHRyYW5zYWN0aW9uIG9iamVjdCByZXNwb25zaWJsZSBmb3IgYWNjdW11bGF0aW5nIHRoZSBtdXRhdGlvbnMgdG9cbiAqIHBlcmZvcm0gYW5kIHRoZSBiYXNlIHZlcnNpb25zIGZvciBhbnkgZG9jdW1lbnRzIHJlYWQuXG4gKi8gY2xhc3MgeGEge1xuICAgIGNvbnN0cnVjdG9yKHQpIHtcbiAgICAgICAgdGhpcy5kYXRhc3RvcmUgPSB0LCBcbiAgICAgICAgLy8gVGhlIHZlcnNpb24gb2YgZWFjaCBkb2N1bWVudCB0aGF0IHdhcyByZWFkIGR1cmluZyB0aGlzIHRyYW5zYWN0aW9uLlxuICAgICAgICB0aGlzLnJlYWRWZXJzaW9ucyA9IG5ldyBNYXAsIHRoaXMubXV0YXRpb25zID0gW10sIHRoaXMuY29tbWl0dGVkID0gITEsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBkZWZlcnJlZCB1c2FnZSBlcnJvciB0aGF0IG9jY3VycmVkIHByZXZpb3VzbHkgaW4gdGhpcyB0cmFuc2FjdGlvbiB0aGF0XG4gICAgICAgICAqIHdpbGwgY2F1c2UgdGhlIHRyYW5zYWN0aW9uIHRvIGZhaWwgb25jZSBpdCBhY3R1YWxseSBjb21taXRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sYXN0V3JpdGVFcnJvciA9IG51bGwsIFxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IG9mIGRvY3VtZW50cyB0aGF0IGhhdmUgYmVlbiB3cml0dGVuIGluIHRoZSB0cmFuc2FjdGlvbi5cbiAgICAgICAgICpcbiAgICAgICAgICogV2hlbiB0aGVyZSdzIG1vcmUgdGhhbiBvbmUgd3JpdGUgdG8gdGhlIHNhbWUga2V5IGluIGEgdHJhbnNhY3Rpb24sIGFueVxuICAgICAgICAgKiB3cml0ZXMgYWZ0ZXIgdGhlIGZpcnN0IGFyZSBoYW5kbGVkIGRpZmZlcmVudGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53cml0dGVuRG9jcyA9IG5ldyBTZXQ7XG4gICAgfVxuICAgIGFzeW5jIGxvb2t1cCh0KSB7XG4gICAgICAgIGlmICh0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLm11dGF0aW9ucy5sZW5ndGggPiAwKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiRmlyZXN0b3JlIHRyYW5zYWN0aW9ucyByZXF1aXJlIGFsbCByZWFkcyB0byBiZSBleGVjdXRlZCBiZWZvcmUgYWxsIHdyaXRlcy5cIik7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBhc3luYyBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gJCh0KSwgcyA9IHpzKG4ueXQpICsgXCIvZG9jdW1lbnRzXCIsIGkgPSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRzOiBlLm1hcCgodCA9PiBHcyhuLnl0LCB0KSkpXG4gICAgICAgICAgICB9LCByID0gYXdhaXQgbi5fbyhcIkJhdGNoR2V0RG9jdW1lbnRzXCIsIHMsIGksIGUubGVuZ3RoKSwgbyA9IG5ldyBNYXA7XG4gICAgICAgICAgICByLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBYcyhuLnl0LCB0KTtcbiAgICAgICAgICAgICAgICBvLnNldChlLmtleS50b1N0cmluZygpLCBlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IHUgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiBlLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBvLmdldCh0LnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgICAgIE0oISFlKSwgdS5wdXNoKGUpO1xuICAgICAgICAgICAgfSkpLCB1O1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCB0KTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgodCA9PiB0aGlzLnJlY29yZFZlcnNpb24odCkpKSwgZTtcbiAgICB9XG4gICAgc2V0KHQsIGUpIHtcbiAgICAgICAgdGhpcy53cml0ZShlLnRvTXV0YXRpb24odCwgdGhpcy5wcmVjb25kaXRpb24odCkpKSwgdGhpcy53cml0dGVuRG9jcy5hZGQodC50b1N0cmluZygpKTtcbiAgICB9XG4gICAgdXBkYXRlKHQsIGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3JpdGUoZS50b011dGF0aW9uKHQsIHRoaXMucHJlY29uZGl0aW9uRm9yVXBkYXRlKHQpKSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFdyaXRlRXJyb3IgPSB0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MuYWRkKHQudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGRlbGV0ZSh0KSB7XG4gICAgICAgIHRoaXMud3JpdGUobmV3IGlzKHQsIHRoaXMucHJlY29uZGl0aW9uKHQpKSksIHRoaXMud3JpdHRlbkRvY3MuYWRkKHQudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbW1pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZW5zdXJlQ29tbWl0Tm90Q2FsbGVkKCksIHRoaXMubGFzdFdyaXRlRXJyb3IpIHRocm93IHRoaXMubGFzdFdyaXRlRXJyb3I7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnJlYWRWZXJzaW9ucztcbiAgICAgICAgLy8gRm9yIGVhY2ggbXV0YXRpb24sIG5vdGUgdGhhdCB0aGUgZG9jIHdhcyB3cml0dGVuLlxuICAgICAgICAgICAgICAgIHRoaXMubXV0YXRpb25zLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdC5kZWxldGUoZS5rZXkudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKSwgXG4gICAgICAgIC8vIEZvciBlYWNoIGRvY3VtZW50IHRoYXQgd2FzIHJlYWQgYnV0IG5vdCB3cml0dGVuIHRvLCB3ZSB3YW50IHRvIHBlcmZvcm1cbiAgICAgICAgLy8gYSBgdmVyaWZ5YCBvcGVyYXRpb24uXG4gICAgICAgIHQuZm9yRWFjaCgoKHQsIGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBjdC5mcm9tUGF0aChlKTtcbiAgICAgICAgICAgIHRoaXMubXV0YXRpb25zLnB1c2gobmV3IHJzKG4sIHRoaXMucHJlY29uZGl0aW9uKG4pKSk7XG4gICAgICAgIH0pKSwgYXdhaXQgYXN5bmMgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9ICQodCksIHMgPSB6cyhuLnl0KSArIFwiL2RvY3VtZW50c1wiLCBpID0ge1xuICAgICAgICAgICAgICAgIHdyaXRlczogZS5tYXAoKHQgPT4gdGkobi55dCwgdCkpKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGF3YWl0IG4uYW8oXCJDb21taXRcIiwgcywgaSk7XG4gICAgICAgIH0odGhpcy5kYXRhc3RvcmUsIHRoaXMubXV0YXRpb25zKSwgdGhpcy5jb21taXR0ZWQgPSAhMDtcbiAgICB9XG4gICAgcmVjb3JkVmVyc2lvbih0KSB7XG4gICAgICAgIGxldCBlO1xuICAgICAgICBpZiAodC5pc0ZvdW5kRG9jdW1lbnQoKSkgZSA9IHQudmVyc2lvbjsgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXQuaXNOb0RvY3VtZW50KCkpIHRocm93IE8oKTtcbiAgICAgICAgICAgIC8vIFJlcHJlc2VudCBhIGRlbGV0ZWQgZG9jIHVzaW5nIFNuYXBzaG90VmVyc2lvbi5taW4oKS5cbiAgICAgICAgICAgIGUgPSBzdC5taW4oKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuID0gdGhpcy5yZWFkVmVyc2lvbnMuZ2V0KHQua2V5LnRvU3RyaW5nKCkpO1xuICAgICAgICBpZiAobikge1xuICAgICAgICAgICAgaWYgKCFlLmlzRXF1YWwobikpIFxuICAgICAgICAgICAgLy8gVGhpcyB0cmFuc2FjdGlvbiB3aWxsIGZhaWwgbm8gbWF0dGVyIHdoYXQuXG4gICAgICAgICAgICB0aHJvdyBuZXcgTChCLkFCT1JURUQsIFwiRG9jdW1lbnQgdmVyc2lvbiBjaGFuZ2VkIGJldHdlZW4gdHdvIHJlYWRzLlwiKTtcbiAgICAgICAgfSBlbHNlIHRoaXMucmVhZFZlcnNpb25zLnNldCh0LmtleS50b1N0cmluZygpLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdmVyc2lvbiBvZiB0aGlzIGRvY3VtZW50IHdoZW4gaXQgd2FzIHJlYWQgaW4gdGhpcyB0cmFuc2FjdGlvbixcbiAgICAgKiBhcyBhIHByZWNvbmRpdGlvbiwgb3Igbm8gcHJlY29uZGl0aW9uIGlmIGl0IHdhcyBub3QgcmVhZC5cbiAgICAgKi8gICAgcHJlY29uZGl0aW9uKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMucmVhZFZlcnNpb25zLmdldCh0LnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gIXRoaXMud3JpdHRlbkRvY3MuaGFzKHQudG9TdHJpbmcoKSkgJiYgZSA/IGUuaXNFcXVhbChzdC5taW4oKSkgPyBRbi5leGlzdHMoITEpIDogUW4udXBkYXRlVGltZShlKSA6IFFuLm5vbmUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgcHJlY29uZGl0aW9uIGZvciBhIGRvY3VtZW50IGlmIHRoZSBvcGVyYXRpb24gaXMgYW4gdXBkYXRlLlxuICAgICAqLyAgICBwcmVjb25kaXRpb25Gb3JVcGRhdGUodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5yZWFkVmVyc2lvbnMuZ2V0KHQudG9TdHJpbmcoKSk7XG4gICAgICAgIC8vIFRoZSBmaXJzdCB0aW1lIGEgZG9jdW1lbnQgaXMgd3JpdHRlbiwgd2Ugd2FudCB0byB0YWtlIGludG8gYWNjb3VudCB0aGVcbiAgICAgICAgLy8gcmVhZCB0aW1lIGFuZCBleGlzdGVuY2VcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMud3JpdHRlbkRvY3MuaGFzKHQudG9TdHJpbmcoKSkgJiYgZSkge1xuICAgICAgICAgICAgaWYgKGUuaXNFcXVhbChzdC5taW4oKSkpIFxuICAgICAgICAgICAgLy8gVGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QsIHNvIGZhaWwgdGhlIHRyYW5zYWN0aW9uLlxuICAgICAgICAgICAgLy8gVGhpcyBoYXMgdG8gYmUgdmFsaWRhdGVkIGxvY2FsbHkgYmVjYXVzZSB5b3UgY2FuJ3Qgc2VuZCBhXG4gICAgICAgICAgICAvLyBwcmVjb25kaXRpb24gdGhhdCBhIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0IHdpdGhvdXQgY2hhbmdpbmcgdGhlXG4gICAgICAgICAgICAvLyBzZW1hbnRpY3Mgb2YgdGhlIGJhY2tlbmQgd3JpdGUgdG8gYmUgYW4gaW5zZXJ0LiBUaGlzIGlzIHRoZSByZXZlcnNlXG4gICAgICAgICAgICAvLyBvZiB3aGF0IHdlIHdhbnQsIHNpbmNlIHdlIHdhbnQgdG8gYXNzZXJ0IHRoYXQgdGhlIGRvY3VtZW50IGRvZXNuJ3RcbiAgICAgICAgICAgIC8vIGV4aXN0IGJ1dCB0aGVuIHNlbmQgdGhlIHVwZGF0ZSBhbmQgaGF2ZSBpdCBmYWlsLiBTaW5jZSB3ZSBjYW4ndFxuICAgICAgICAgICAgLy8gZXhwcmVzcyB0aGF0IHRvIHRoZSBiYWNrZW5kLCB3ZSBoYXZlIHRvIHZhbGlkYXRlIGxvY2FsbHkuXG4gICAgICAgICAgICAvLyBOb3RlOiB0aGlzIGNhbiBjaGFuZ2Ugb25jZSB3ZSBjYW4gc2VuZCBzZXBhcmF0ZSB2ZXJpZnkgd3JpdGVzIGluIHRoZVxuICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiQ2FuJ3QgdXBkYXRlIGEgZG9jdW1lbnQgdGhhdCBkb2Vzbid0IGV4aXN0LlwiKTtcbiAgICAgICAgICAgIC8vIERvY3VtZW50IGV4aXN0cywgYmFzZSBwcmVjb25kaXRpb24gb24gZG9jdW1lbnQgdXBkYXRlIHRpbWUuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUW4udXBkYXRlVGltZShlKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBEb2N1bWVudCB3YXMgbm90IHJlYWQsIHNvIHdlIGp1c3QgdXNlIHRoZSBwcmVjb25kaXRpb25zIGZvciBhIGJsaW5kXG4gICAgICAgIC8vIHVwZGF0ZS5cbiAgICAgICAgcmV0dXJuIFFuLmV4aXN0cyghMCk7XG4gICAgfVxuICAgIHdyaXRlKHQpIHtcbiAgICAgICAgdGhpcy5lbnN1cmVDb21taXROb3RDYWxsZWQoKSwgdGhpcy5tdXRhdGlvbnMucHVzaCh0KTtcbiAgICB9XG4gICAgZW5zdXJlQ29tbWl0Tm90Q2FsbGVkKCkge31cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVHJhbnNhY3Rpb25SdW5uZXIgZW5jYXBzdWxhdGVzIHRoZSBsb2dpYyBuZWVkZWQgdG8gcnVuIGFuZCByZXRyeSB0cmFuc2FjdGlvbnNcbiAqIHdpdGggYmFja29mZi5cbiAqLyBjbGFzcyBOYSB7XG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUgPSB0LCB0aGlzLmRhdGFzdG9yZSA9IGUsIHRoaXMub3B0aW9ucyA9IG4sIHRoaXMudXBkYXRlRnVuY3Rpb24gPSBzLCBcbiAgICAgICAgdGhpcy5kZWZlcnJlZCA9IGksIHRoaXMua2MgPSBuLm1heEF0dGVtcHRzLCB0aGlzLnhvID0gbmV3IEl1KHRoaXMuYXN5bmNRdWV1ZSwgXCJ0cmFuc2FjdGlvbl9yZXRyeVwiIC8qIFRpbWVySWQuVHJhbnNhY3Rpb25SZXRyeSAqLyk7XG4gICAgfVxuICAgIC8qKiBSdW5zIHRoZSB0cmFuc2FjdGlvbiBhbmQgc2V0cyB0aGUgcmVzdWx0IG9uIGRlZmVycmVkLiAqLyAgICBydW4oKSB7XG4gICAgICAgIHRoaXMua2MgLT0gMSwgdGhpcy5PYygpO1xuICAgIH1cbiAgICBPYygpIHtcbiAgICAgICAgdGhpcy54by5SbygoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyB4YSh0aGlzLmRhdGFzdG9yZSksIGUgPSB0aGlzLk1jKHQpO1xuICAgICAgICAgICAgZSAmJiBlLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiB0LmNvbW1pdCgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZlcnJlZC5yZXNvbHZlKGUpO1xuICAgICAgICAgICAgICAgIH0pKS5jYXRjaCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuRmModCk7XG4gICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICB9KSkuY2F0Y2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuRmModCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgTWModCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMudXBkYXRlRnVuY3Rpb24odCk7XG4gICAgICAgICAgICByZXR1cm4gIXF0KGUpICYmIGUuY2F0Y2ggJiYgZS50aGVuID8gZSA6ICh0aGlzLmRlZmVycmVkLnJlamVjdChFcnJvcihcIlRyYW5zYWN0aW9uIGNhbGxiYWNrIG11c3QgcmV0dXJuIGEgUHJvbWlzZVwiKSksIFxuICAgICAgICAgICAgbnVsbCk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIC8vIERvIG5vdCByZXRyeSBlcnJvcnMgdGhyb3duIGJ5IHVzZXIgcHJvdmlkZWQgdXBkYXRlRnVuY3Rpb24uXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZWZlcnJlZC5yZWplY3QodCksIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgRmModCkge1xuICAgICAgICB0aGlzLmtjID4gMCAmJiB0aGlzLiRjKHQpID8gKHRoaXMua2MgLT0gMSwgdGhpcy5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKCgpID0+ICh0aGlzLk9jKCksIFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKSkgOiB0aGlzLmRlZmVycmVkLnJlamVjdCh0KTtcbiAgICB9XG4gICAgJGModCkge1xuICAgICAgICBpZiAoXCJGaXJlYmFzZUVycm9yXCIgPT09IHQubmFtZSkge1xuICAgICAgICAgICAgLy8gSW4gdHJhbnNhY3Rpb25zLCB0aGUgYmFja2VuZCB3aWxsIGZhaWwgb3V0ZGF0ZWQgcmVhZHMgd2l0aCBGQUlMRURfUFJFQ09ORElUSU9OIGFuZFxuICAgICAgICAgICAgLy8gbm9uLW1hdGNoaW5nIGRvY3VtZW50IHZlcnNpb25zIHdpdGggQUJPUlRFRC4gVGhlc2UgZXJyb3JzIHNob3VsZCBiZSByZXRyaWVkLlxuICAgICAgICAgICAgY29uc3QgZSA9IHQuY29kZTtcbiAgICAgICAgICAgIHJldHVybiBcImFib3J0ZWRcIiA9PT0gZSB8fCBcImZhaWxlZC1wcmVjb25kaXRpb25cIiA9PT0gZSB8fCBcImFscmVhZHktZXhpc3RzXCIgPT09IGUgfHwgIWFzKGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEZpcmVzdG9yZUNsaWVudCBpcyBhIHRvcC1sZXZlbCBjbGFzcyB0aGF0IGNvbnN0cnVjdHMgYW5kIG93bnMgYWxsIG9mIHRoZVxuICogcGllY2VzIG9mIHRoZSBjbGllbnQgU0RLIGFyY2hpdGVjdHVyZS4gSXQgaXMgcmVzcG9uc2libGUgZm9yIGNyZWF0aW5nIHRoZVxuICogYXN5bmMgcXVldWUgdGhhdCBpcyBzaGFyZWQgYnkgYWxsIG9mIHRoZSBvdGhlciBjb21wb25lbnRzIGluIHRoZSBzeXN0ZW0uXG4gKi9cbmNsYXNzIGthIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBcbiAgICAvKipcbiAgICAgKiBBc3luY2hyb25vdXMgcXVldWUgcmVzcG9uc2libGUgZm9yIGFsbCBvZiBvdXIgaW50ZXJuYWwgcHJvY2Vzc2luZy4gV2hlblxuICAgICAqIHdlIGdldCBpbmNvbWluZyB3b3JrIGZyb20gdGhlIHVzZXIgKHZpYSBwdWJsaWMgQVBJKSBvciB0aGUgbmV0d29ya1xuICAgICAqIChpbmNvbWluZyBHUlBDIG1lc3NhZ2VzKSwgd2Ugc2hvdWxkIGFsd2F5cyBzY2hlZHVsZSBvbnRvIHRoaXMgcXVldWUuXG4gICAgICogVGhpcyBlbnN1cmVzIGFsbCBvZiBvdXIgd29yayBpcyBwcm9wZXJseSBzZXJpYWxpemVkIChlLmcuIHdlIGRvbid0XG4gICAgICogc3RhcnQgcHJvY2Vzc2luZyBhIG5ldyBvcGVyYXRpb24gd2hpbGUgdGhlIHByZXZpb3VzIG9uZSBpcyB3YWl0aW5nIGZvclxuICAgICAqIGFuIGFzeW5jIEkvTyB0byBjb21wbGV0ZSkuXG4gICAgICovXG4gICAgbiwgcykge1xuICAgICAgICB0aGlzLmF1dGhDcmVkZW50aWFscyA9IHQsIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscyA9IGUsIHRoaXMuYXN5bmNRdWV1ZSA9IG4sIHRoaXMuZGF0YWJhc2VJbmZvID0gcywgXG4gICAgICAgIHRoaXMudXNlciA9IFAuVU5BVVRIRU5USUNBVEVELCB0aGlzLmNsaWVudElkID0gWC5SKCksIHRoaXMuYXV0aENyZWRlbnRpYWxMaXN0ZW5lciA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLCBcbiAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxMaXN0ZW5lciA9ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLCB0aGlzLmF1dGhDcmVkZW50aWFscy5zdGFydChuLCAoYXN5bmMgdCA9PiB7XG4gICAgICAgICAgICBDKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiUmVjZWl2ZWQgdXNlcj1cIiwgdC51aWQpLCBhd2FpdCB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIodCksIFxuICAgICAgICAgICAgdGhpcy51c2VyID0gdDtcbiAgICAgICAgfSkpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuc3RhcnQobiwgKHQgPT4gKEMoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJSZWNlaXZlZCBuZXcgYXBwIGNoZWNrIHRva2VuPVwiLCB0KSwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIodCwgdGhpcy51c2VyKSkpKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0Q29uZmlndXJhdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGFzeW5jUXVldWU6IHRoaXMuYXN5bmNRdWV1ZSxcbiAgICAgICAgICAgIGRhdGFiYXNlSW5mbzogdGhpcy5kYXRhYmFzZUluZm8sXG4gICAgICAgICAgICBjbGllbnRJZDogdGhpcy5jbGllbnRJZCxcbiAgICAgICAgICAgIGF1dGhDcmVkZW50aWFsczogdGhpcy5hdXRoQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICBhcHBDaGVja0NyZWRlbnRpYWxzOiB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICBpbml0aWFsVXNlcjogdGhpcy51c2VyLFxuICAgICAgICAgICAgbWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnM6IDEwMFxuICAgICAgICB9O1xuICAgIH1cbiAgICBzZXRDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIodCkge1xuICAgICAgICB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIgPSB0O1xuICAgIH1cbiAgICBzZXRBcHBDaGVja1Rva2VuQ2hhbmdlTGlzdGVuZXIodCkge1xuICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbExpc3RlbmVyID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHRoYXQgdGhlIGNsaWVudCBoYXMgbm90IGJlZW4gdGVybWluYXRlZC4gRW5zdXJlcyB0aGF0IG90aGVyIG1ldGhvZHMgb25cbiAgICAgKiB0aGlzIGNsYXNzIGNhbm5vdCBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGNsaWVudCBpcyB0ZXJtaW5hdGVkLlxuICAgICAqLyAgICB2ZXJpZnlOb3RUZXJtaW5hdGVkKCkge1xuICAgICAgICBpZiAodGhpcy5hc3luY1F1ZXVlLmlzU2h1dHRpbmdEb3duKSB0aHJvdyBuZXcgTChCLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIH1cbiAgICB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnRlclJlc3RyaWN0ZWRNb2RlKCk7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgcTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0RXZlbldoaWxlUmVzdHJpY3RlZCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9ubGluZUNvbXBvbmVudHMgJiYgYXdhaXQgdGhpcy5vbmxpbmVDb21wb25lbnRzLnRlcm1pbmF0ZSgpLCB0aGlzLm9mZmxpbmVDb21wb25lbnRzICYmIGF3YWl0IHRoaXMub2ZmbGluZUNvbXBvbmVudHMudGVybWluYXRlKCksIFxuICAgICAgICAgICAgICAgIC8vIFRoZSBjcmVkZW50aWFscyBwcm92aWRlciBtdXN0IGJlIHRlcm1pbmF0ZWQgYWZ0ZXIgc2h1dHRpbmcgZG93biB0aGVcbiAgICAgICAgICAgICAgICAvLyBSZW1vdGVTdG9yZSBhcyBpdCB3aWxsIHByZXZlbnQgdGhlIFJlbW90ZVN0b3JlIGZyb20gcmV0cmlldmluZyBhdXRoXG4gICAgICAgICAgICAgICAgLy8gdG9rZW5zLlxuICAgICAgICAgICAgICAgIHRoaXMuYXV0aENyZWRlbnRpYWxzLnNodXRkb3duKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5zaHV0ZG93bigpLCB0LnJlc29sdmUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gc2MoZSwgXCJGYWlsZWQgdG8gc2h1dGRvd24gcGVyc2lzdGVuY2VcIik7XG4gICAgICAgICAgICAgICAgdC5yZWplY3Qobik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgdC5wcm9taXNlO1xuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gT2EodCwgZSkge1xuICAgIHQuYXN5bmNRdWV1ZS52ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCksIEMoXCJGaXJlc3RvcmVDbGllbnRcIiwgXCJJbml0aWFsaXppbmcgT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyXCIpO1xuICAgIGNvbnN0IG4gPSBhd2FpdCB0LmdldENvbmZpZ3VyYXRpb24oKTtcbiAgICBhd2FpdCBlLmluaXRpYWxpemUobik7XG4gICAgbGV0IHMgPSBuLmluaXRpYWxVc2VyO1xuICAgIHQuc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKChhc3luYyB0ID0+IHtcbiAgICAgICAgcy5pc0VxdWFsKHQpIHx8IChhd2FpdCBVbyhlLmxvY2FsU3RvcmUsIHQpLCBzID0gdCk7XG4gICAgfSkpLCBcbiAgICAvLyBXaGVuIGEgdXNlciBjYWxscyBjbGVhclBlcnNpc3RlbmNlKCkgaW4gb25lIGNsaWVudCwgYWxsIG90aGVyIGNsaWVudHNcbiAgICAvLyBuZWVkIHRvIGJlIHRlcm1pbmF0ZWQgdG8gYWxsb3cgdGhlIGRlbGV0ZSB0byBzdWNjZWVkLlxuICAgIGUucGVyc2lzdGVuY2Uuc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoKCgpID0+IHQudGVybWluYXRlKCkpKSwgdC5vZmZsaW5lQ29tcG9uZW50cyA9IGU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIE1hKHQsIGUpIHtcbiAgICB0LmFzeW5jUXVldWUudmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcygpO1xuICAgIGNvbnN0IG4gPSBhd2FpdCBGYSh0KTtcbiAgICBDKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiSW5pdGlhbGl6aW5nIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXCIpO1xuICAgIGNvbnN0IHMgPSBhd2FpdCB0LmdldENvbmZpZ3VyYXRpb24oKTtcbiAgICBhd2FpdCBlLmluaXRpYWxpemUobiwgcyksIFxuICAgIC8vIFRoZSBDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIgb2YgdGhlIG9ubGluZSBjb21wb25lbnQgcHJvdmlkZXIgdGFrZXNcbiAgICAvLyBwcmVjZWRlbmNlIG92ZXIgdGhlIG9mZmxpbmUgY29tcG9uZW50IHByb3ZpZGVyLlxuICAgIHQuc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKCh0ID0+IFh1KGUucmVtb3RlU3RvcmUsIHQpKSksIHQuc2V0QXBwQ2hlY2tUb2tlbkNoYW5nZUxpc3RlbmVyKCgodCwgbikgPT4gWHUoZS5yZW1vdGVTdG9yZSwgbikpKSwgXG4gICAgdC5vbmxpbmVDb21wb25lbnRzID0gZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gRmEodCkge1xuICAgIHJldHVybiB0Lm9mZmxpbmVDb21wb25lbnRzIHx8IChDKFwiRmlyZXN0b3JlQ2xpZW50XCIsIFwiVXNpbmcgZGVmYXVsdCBPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXJcIiksIFxuICAgIGF3YWl0IE9hKHQsIG5ldyBzYSkpLCB0Lm9mZmxpbmVDb21wb25lbnRzO1xufVxuXG5hc3luYyBmdW5jdGlvbiAkYSh0KSB7XG4gICAgcmV0dXJuIHQub25saW5lQ29tcG9uZW50cyB8fCAoQyhcIkZpcmVzdG9yZUNsaWVudFwiLCBcIlVzaW5nIGRlZmF1bHQgT25saW5lQ29tcG9uZW50UHJvdmlkZXJcIiksIFxuICAgIGF3YWl0IE1hKHQsIG5ldyBvYSkpLCB0Lm9ubGluZUNvbXBvbmVudHM7XG59XG5cbmZ1bmN0aW9uIEJhKHQpIHtcbiAgICByZXR1cm4gRmEodCkudGhlbigodCA9PiB0LnBlcnNpc3RlbmNlKSk7XG59XG5cbmZ1bmN0aW9uIExhKHQpIHtcbiAgICByZXR1cm4gRmEodCkudGhlbigodCA9PiB0LmxvY2FsU3RvcmUpKTtcbn1cblxuZnVuY3Rpb24gcWEodCkge1xuICAgIHJldHVybiAkYSh0KS50aGVuKCh0ID0+IHQucmVtb3RlU3RvcmUpKTtcbn1cblxuZnVuY3Rpb24gVWEodCkge1xuICAgIHJldHVybiAkYSh0KS50aGVuKCh0ID0+IHQuc3luY0VuZ2luZSkpO1xufVxuXG5mdW5jdGlvbiBLYSh0KSB7XG4gICAgcmV0dXJuICRhKHQpLnRoZW4oKHQgPT4gdC5kYXRhc3RvcmUpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gR2EodCkge1xuICAgIGNvbnN0IGUgPSBhd2FpdCAkYSh0KSwgbiA9IGUuZXZlbnRNYW5hZ2VyO1xuICAgIHJldHVybiBuLm9uTGlzdGVuID0gYmMuYmluZChudWxsLCBlLnN5bmNFbmdpbmUpLCBuLm9uVW5saXN0ZW4gPSB2Yy5iaW5kKG51bGwsIGUuc3luY0VuZ2luZSksIFxuICAgIG47XG59XG5cbi8qKiBFbmFibGVzIHRoZSBuZXR3b3JrIGNvbm5lY3Rpb24gYW5kIHJlLWVucXVldWVzIGFsbCBwZW5kaW5nIG9wZXJhdGlvbnMuICovIGZ1bmN0aW9uIFFhKHQpIHtcbiAgICByZXR1cm4gdC5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IEJhKHQpLCBuID0gYXdhaXQgcWEodCk7XG4gICAgICAgIHJldHVybiBlLnNldE5ldHdvcmtFbmFibGVkKCEwKSwgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgY29uc3QgZSA9ICQodCk7XG4gICAgICAgICAgICByZXR1cm4gZS5fdS5kZWxldGUoMCAvKiBPZmZsaW5lQ2F1c2UuVXNlckRpc2FibGVkICovKSwgVnUoZSk7XG4gICAgICAgIH0obik7XG4gICAgfSkpO1xufVxuXG4vKiogRGlzYWJsZXMgdGhlIG5ldHdvcmsgY29ubmVjdGlvbi4gUGVuZGluZyBvcGVyYXRpb25zIHdpbGwgbm90IGNvbXBsZXRlLiAqLyBmdW5jdGlvbiBqYSh0KSB7XG4gICAgcmV0dXJuIHQuYXN5bmNRdWV1ZS5lbnF1ZXVlKChhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBCYSh0KSwgbiA9IGF3YWl0IHFhKHQpO1xuICAgICAgICByZXR1cm4gZS5zZXROZXR3b3JrRW5hYmxlZCghMSksIGFzeW5jIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSAkKHQpO1xuICAgICAgICAgICAgZS5fdS5hZGQoMCAvKiBPZmZsaW5lQ2F1c2UuVXNlckRpc2FibGVkICovKSwgYXdhaXQgU3UoZSksIFxuICAgICAgICAgICAgLy8gU2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBPZmZsaW5lIHNvIGdldCgpcyByZXR1cm4gZnJvbSBjYWNoZSwgZXRjLlxuICAgICAgICAgICAgZS5ndS5zZXQoXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyk7XG4gICAgICAgIH0obik7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiBhbGwgd3JpdGVzIHRoYXQgd2VyZSBwZW5kaW5nIGF0IHRoZSB0aW1lXG4gKiB0aGlzIG1ldGhvZCB3YXMgY2FsbGVkIHJlY2VpdmVkIHNlcnZlciBhY2tub3dsZWRnZW1lbnQuIEFuIGFja25vd2xlZGdlbWVudFxuICogY2FuIGJlIGVpdGhlciBhY2NlcHRhbmNlIG9yIHJlamVjdGlvbi5cbiAqLyBmdW5jdGlvbiBXYSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IG5ldyBxO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGF3YWl0IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gJCh0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcInJlYWQgZG9jdW1lbnRcIiwgXCJyZWFkb25seVwiLCAodCA9PiBuLmxvY2FsRG9jdW1lbnRzLmdldERvY3VtZW50KHQsIGUpKSk7XG4gICAgICAgICAgICB9KHQsIGUpO1xuICAgICAgICAgICAgcy5pc0ZvdW5kRG9jdW1lbnQoKSA/IG4ucmVzb2x2ZShzKSA6IHMuaXNOb0RvY3VtZW50KCkgPyBuLnJlc29sdmUobnVsbCkgOiBuLnJlamVjdChuZXcgTChCLlVOQVZBSUxBQkxFLCBcIkZhaWxlZCB0byBnZXQgZG9jdW1lbnQgZnJvbSBjYWNoZS4gKEhvd2V2ZXIsIHRoaXMgZG9jdW1lbnQgbWF5IGV4aXN0IG9uIHRoZSBzZXJ2ZXIuIFJ1biBhZ2FpbiB3aXRob3V0IHNldHRpbmcgJ3NvdXJjZScgaW4gdGhlIEdldE9wdGlvbnMgdG8gYXR0ZW1wdCB0byByZXRyaWV2ZSB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgc2VydmVyLilcIikpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICBjb25zdCBzID0gc2ModCwgYEZhaWxlZCB0byBnZXQgZG9jdW1lbnQgJyR7ZX0gZnJvbSBjYWNoZWApO1xuICAgICAgICAgICAgbi5yZWplY3Qocyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gKiBSZXRyaWV2ZXMgYSBsYXRlbmN5LWNvbXBlbnNhdGVkIGRvY3VtZW50IGZyb20gdGhlIGJhY2tlbmQgdmlhIGFcbiAqIFNuYXBzaG90TGlzdGVuZXIuXG4gKi8gKGF3YWl0IExhKHQpLCBlLCBuKSkpLCBuLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIHphKHQsIGUsIG4gPSB7fSkge1xuICAgIGNvbnN0IHMgPSBuZXcgcTtcbiAgICByZXR1cm4gdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgY29uc3QgciA9IG5ldyB2YSh7XG4gICAgICAgICAgICBuZXh0OiByID0+IHtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgcXVlcnkgZmlyc3QgYmVmb3JlIHBhc3NpbmcgZXZlbnQgdG8gdXNlciB0byBhdm9pZFxuICAgICAgICAgICAgICAgIC8vIHVzZXIgYWN0aW9ucyBhZmZlY3RpbmcgdGhlIG5vdyBzdGFsZSBxdWVyeS5cbiAgICAgICAgICAgICAgICBlLmVucXVldWVBbmRGb3JnZXQoKCgpID0+IGhjKHQsIG8pKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdSA9IHIuZG9jcy5oYXMobik7XG4gICAgICAgICAgICAgICAgIXUgJiYgci5mcm9tQ2FjaGUgPyBcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IElmIHdlJ3JlIG9ubGluZSBhbmQgdGhlIGRvY3VtZW50IGRvZXNuJ3RcbiAgICAgICAgICAgICAgICAvLyBleGlzdCB0aGVuIHdlIHJlc29sdmUgd2l0aCBhIGRvYy5leGlzdHMgc2V0IHRvIGZhbHNlLiBJZlxuICAgICAgICAgICAgICAgIC8vIHdlJ3JlIG9mZmxpbmUgaG93ZXZlciwgd2UgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoaXNcbiAgICAgICAgICAgICAgICAvLyBjYXNlLiBUd28gb3B0aW9uczogMSkgQ2FjaGUgdGhlIG5lZ2F0aXZlIHJlc3BvbnNlIGZyb21cbiAgICAgICAgICAgICAgICAvLyB0aGUgc2VydmVyIHNvIHdlIGNhbiBkZWxpdmVyIHRoYXQgZXZlbiB3aGVuIHlvdSdyZVxuICAgICAgICAgICAgICAgIC8vIG9mZmxpbmUgMikgQWN0dWFsbHkgcmVqZWN0IHRoZSBQcm9taXNlIGluIHRoZSBvbmxpbmUgY2FzZVxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBkb2N1bWVudCBkb2Vzbid0IGV4aXN0LlxuICAgICAgICAgICAgICAgIGkucmVqZWN0KG5ldyBMKEIuVU5BVkFJTEFCTEUsIFwiRmFpbGVkIHRvIGdldCBkb2N1bWVudCBiZWNhdXNlIHRoZSBjbGllbnQgaXMgb2ZmbGluZS5cIikpIDogdSAmJiByLmZyb21DYWNoZSAmJiBzICYmIFwic2VydmVyXCIgPT09IHMuc291cmNlID8gaS5yZWplY3QobmV3IEwoQi5VTkFWQUlMQUJMRSwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnQgZnJvbSBzZXJ2ZXIuIChIb3dldmVyLCB0aGlzIGRvY3VtZW50IGRvZXMgZXhpc3QgaW4gdGhlIGxvY2FsIGNhY2hlLiBSdW4gYWdhaW4gd2l0aG91dCBzZXR0aW5nIHNvdXJjZSB0byBcInNlcnZlclwiIHRvIHJldHJpZXZlIHRoZSBjYWNoZWQgZG9jdW1lbnQuKScpKSA6IGkucmVzb2x2ZShyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogdCA9PiBpLnJlamVjdCh0KVxuICAgICAgICB9KSwgbyA9IG5ldyBfYyhsbihuLnBhdGgpLCByLCB7XG4gICAgICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiAhMCxcbiAgICAgICAgICAgIE51OiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGFjKHQsIG8pO1xuICAgIH0oYXdhaXQgR2EodCksIHQuYXN5bmNRdWV1ZSwgZSwgbiwgcykpKSwgcy5wcm9taXNlO1xufVxuXG5mdW5jdGlvbiBIYSh0LCBlKSB7XG4gICAgY29uc3QgbiA9IG5ldyBxO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGF3YWl0IEpvKHQsIGUsIFxuICAgICAgICAgICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMCksIGkgPSBuZXcgVGMoZSwgcy5IaSksIHIgPSBpLld1KHMuZG9jdW1lbnRzKSwgbyA9IGkuYXBwbHlDaGFuZ2VzKHIsIFxuICAgICAgICAgICAgLyogdXBkYXRlTGltYm9Eb2N1bWVudHM9ICovICExKTtcbiAgICAgICAgICAgIG4ucmVzb2x2ZShvLnNuYXBzaG90KTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgY29uc3QgcyA9IHNjKHQsIGBGYWlsZWQgdG8gZXhlY3V0ZSBxdWVyeSAnJHtlfSBhZ2FpbnN0IGNhY2hlYCk7XG4gICAgICAgICAgICBuLnJlamVjdChzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAqIFJldHJpZXZlcyBhIGxhdGVuY3ktY29tcGVuc2F0ZWQgcXVlcnkgc25hcHNob3QgZnJvbSB0aGUgYmFja2VuZCB2aWEgYVxuICogU25hcHNob3RMaXN0ZW5lci5cbiAqLyAoYXdhaXQgTGEodCksIGUsIG4pKSksIG4ucHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gSmEodCwgZSwgbiA9IHt9KSB7XG4gICAgY29uc3QgcyA9IG5ldyBxO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24odCwgZSwgbiwgcywgaSkge1xuICAgICAgICBjb25zdCByID0gbmV3IHZhKHtcbiAgICAgICAgICAgIG5leHQ6IG4gPT4ge1xuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBxdWVyeSBmaXJzdCBiZWZvcmUgcGFzc2luZyBldmVudCB0byB1c2VyIHRvIGF2b2lkXG4gICAgICAgICAgICAgICAgLy8gdXNlciBhY3Rpb25zIGFmZmVjdGluZyB0aGUgbm93IHN0YWxlIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIGUuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gaGModCwgbykpKSwgbi5mcm9tQ2FjaGUgJiYgXCJzZXJ2ZXJcIiA9PT0gcy5zb3VyY2UgPyBpLnJlamVjdChuZXcgTChCLlVOQVZBSUxBQkxFLCAnRmFpbGVkIHRvIGdldCBkb2N1bWVudHMgZnJvbSBzZXJ2ZXIuIChIb3dldmVyLCB0aGVzZSBkb2N1bWVudHMgbWF5IGV4aXN0IGluIHRoZSBsb2NhbCBjYWNoZS4gUnVuIGFnYWluIHdpdGhvdXQgc2V0dGluZyBzb3VyY2UgdG8gXCJzZXJ2ZXJcIiB0byByZXRyaWV2ZSB0aGUgY2FjaGVkIGRvY3VtZW50cy4pJykpIDogaS5yZXNvbHZlKG4pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB0ID0+IGkucmVqZWN0KHQpXG4gICAgICAgIH0pLCBvID0gbmV3IF9jKG4sIHIsIHtcbiAgICAgICAgICAgIGluY2x1ZGVNZXRhZGF0YUNoYW5nZXM6ICEwLFxuICAgICAgICAgICAgTnU6ICEwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYWModCwgbyk7XG4gICAgfShhd2FpdCBHYSh0KSwgdC5hc3luY1F1ZXVlLCBlLCBuLCBzKSkpLCBzLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIFlhKHQsIGUpIHtcbiAgICBjb25zdCBuID0gbmV3IHZhKGUpO1xuICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAkKHQpLlJ1LmFkZChlKSwgXG4gICAgICAgIC8vIEltbWVkaWF0ZWx5IGZpcmUgYW4gaW5pdGlhbCBldmVudCwgaW5kaWNhdGluZyBhbGwgZXhpc3RpbmcgbGlzdGVuZXJzXG4gICAgICAgIC8vIGFyZSBpbi1zeW5jLlxuICAgICAgICBlLm5leHQoKTtcbiAgICB9KGF3YWl0IEdhKHQpLCBuKSkpLCAoKSA9PiB7XG4gICAgICAgIG4uYmMoKSwgdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgICQodCkuUnUuZGVsZXRlKGUpO1xuICAgICAgICB9KGF3YWl0IEdhKHQpLCBuKSkpO1xuICAgIH07XG59XG5cbi8qKlxuICogVGFrZXMgYW4gdXBkYXRlRnVuY3Rpb24gaW4gd2hpY2ggYSBzZXQgb2YgcmVhZHMgYW5kIHdyaXRlcyBjYW4gYmUgcGVyZm9ybWVkXG4gKiBhdG9taWNhbGx5LiBJbiB0aGUgdXBkYXRlRnVuY3Rpb24sIHRoZSBjbGllbnQgY2FuIHJlYWQgYW5kIHdyaXRlIHZhbHVlc1xuICogdXNpbmcgdGhlIHN1cHBsaWVkIHRyYW5zYWN0aW9uIG9iamVjdC4gQWZ0ZXIgdGhlIHVwZGF0ZUZ1bmN0aW9uLCBhbGxcbiAqIGNoYW5nZXMgd2lsbCBiZSBjb21taXR0ZWQuIElmIGEgcmV0cnlhYmxlIGVycm9yIG9jY3VycyAoZXg6IHNvbWUgb3RoZXJcbiAqIGNsaWVudCBoYXMgY2hhbmdlZCBhbnkgb2YgdGhlIGRhdGEgcmVmZXJlbmNlZCksIHRoZW4gdGhlIHVwZGF0ZUZ1bmN0aW9uXG4gKiB3aWxsIGJlIGNhbGxlZCBhZ2FpbiBhZnRlciBhIGJhY2tvZmYuIElmIHRoZSB1cGRhdGVGdW5jdGlvbiBzdGlsbCBmYWlsc1xuICogYWZ0ZXIgYWxsIHJldHJpZXMsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIHdpbGwgYmUgcmVqZWN0ZWQuXG4gKlxuICogVGhlIHRyYW5zYWN0aW9uIG9iamVjdCBwYXNzZWQgdG8gdGhlIHVwZGF0ZUZ1bmN0aW9uIGNvbnRhaW5zIG1ldGhvZHMgZm9yXG4gKiBhY2Nlc3NpbmcgZG9jdW1lbnRzIGFuZCBjb2xsZWN0aW9ucy4gVW5saWtlIG90aGVyIGRhdGFzdG9yZSBhY2Nlc3MsIGRhdGFcbiAqIGFjY2Vzc2VkIHdpdGggdGhlIHRyYW5zYWN0aW9uIHdpbGwgbm90IHJlZmxlY3QgbG9jYWwgY2hhbmdlcyB0aGF0IGhhdmUgbm90XG4gKiBiZWVuIGNvbW1pdHRlZC4gRm9yIHRoaXMgcmVhc29uLCBpdCBpcyByZXF1aXJlZCB0aGF0IGFsbCByZWFkcyBhcmVcbiAqIHBlcmZvcm1lZCBiZWZvcmUgYW55IHdyaXRlcy4gVHJhbnNhY3Rpb25zIG11c3QgYmUgcGVyZm9ybWVkIHdoaWxlIG9ubGluZS5cbiAqLyBmdW5jdGlvbiBYYSh0LCBlLCBuLCBzKSB7XG4gICAgY29uc3QgaSA9IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIG4gPSBcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gKG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKHQpIDogdDtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmEodCwgZSk7XG4gICAgICAgIH0oZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSByZXR1cm4gUGEodCwgZSk7XG4gICAgICAgICAgICBpZiAodCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSByZXR1cm4gUGEobmV3IFVpbnQ4QXJyYXkodCksIGUpO1xuICAgICAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBSZWFkYWJsZVN0cmVhbSkgcmV0dXJuIHQuZ2V0UmVhZGVyKCk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTb3VyY2Ugb2YgYHRvQnl0ZVN0cmVhbVJlYWRlcmAgaGFzIHRvIGJlIGEgQXJyYXlCdWZmZXIgb3IgUmVhZGFibGVTdHJlYW1cIik7XG4gICAgICAgIH0obiksIGUpO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAobiwgcHUoZSkpO1xuICAgIHQuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgIG5hKGF3YWl0IFVhKHQpLCBpLCBzKTtcbiAgICB9KSk7XG59XG5cbmZ1bmN0aW9uIFphKHQsIGUpIHtcbiAgICByZXR1cm4gdC5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9ICQodCk7XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5hbWVkIHF1ZXJ5XCIsIFwicmVhZG9ubHlcIiwgKHQgPT4gbi5Ocy5nZXROYW1lZFF1ZXJ5KHQsIGUpKSk7XG4gICAgfShhd2FpdCBMYSh0KSwgZSkpKTtcbn1cblxuY2xhc3MgdGgge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBUaGUgbGFzdCBwcm9taXNlIGluIHRoZSBxdWV1ZS5cbiAgICAgICAgdGhpcy5CYyA9IFByb21pc2UucmVzb2x2ZSgpLCBcbiAgICAgICAgLy8gQSBsaXN0IG9mIHJldHJ5YWJsZSBvcGVyYXRpb25zLiBSZXRyeWFibGUgb3BlcmF0aW9ucyBhcmUgcnVuIGluIG9yZGVyIGFuZFxuICAgICAgICAvLyByZXRyaWVkIHdpdGggYmFja29mZi5cbiAgICAgICAgdGhpcy5MYyA9IFtdLCBcbiAgICAgICAgLy8gSXMgdGhpcyBBc3luY1F1ZXVlIGJlaW5nIHNodXQgZG93bj8gT25jZSBpdCBpcyBzZXQgdG8gdHJ1ZSwgaXQgd2lsbCBub3RcbiAgICAgICAgLy8gYmUgY2hhbmdlZCBhZ2Fpbi5cbiAgICAgICAgdGhpcy5xYyA9ICExLCBcbiAgICAgICAgLy8gT3BlcmF0aW9ucyBzY2hlZHVsZWQgdG8gYmUgcXVldWVkIGluIHRoZSBmdXR1cmUuIE9wZXJhdGlvbnMgYXJlXG4gICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgcmVtb3ZlZCBhZnRlciB0aGV5IGFyZSBydW4gb3IgY2FuY2VsZWQuXG4gICAgICAgIHRoaXMuVWMgPSBbXSwgXG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgdGhpcy5LYyA9IG51bGwsIFxuICAgICAgICAvLyBGbGFnIHNldCB3aGlsZSB0aGVyZSdzIGFuIG91dHN0YW5kaW5nIEFzeW5jUXVldWUgb3BlcmF0aW9uLCB1c2VkIGZvclxuICAgICAgICAvLyBhc3NlcnRpb24gc2FuaXR5LWNoZWNrcy5cbiAgICAgICAgdGhpcy5HYyA9ICExLCBcbiAgICAgICAgLy8gRW5hYmxlZCBkdXJpbmcgc2h1dGRvd24gb24gU2FmYXJpIHRvIHByZXZlbnQgZnV0dXJlIGFjY2VzcyB0byBJbmRleGVkREIuXG4gICAgICAgIHRoaXMuUWMgPSAhMSwgXG4gICAgICAgIC8vIExpc3Qgb2YgVGltZXJJZHMgdG8gZmFzdC1mb3J3YXJkIGRlbGF5cyBmb3IuXG4gICAgICAgIHRoaXMuamMgPSBbXSwgXG4gICAgICAgIC8vIEJhY2tvZmYgdGltZXIgdXNlZCB0byBzY2hlZHVsZSByZXRyaWVzIGZvciByZXRyeWFibGUgb3BlcmF0aW9uc1xuICAgICAgICB0aGlzLnhvID0gbmV3IEl1KHRoaXMsIFwiYXN5bmNfcXVldWVfcmV0cnlcIiAvKiBUaW1lcklkLkFzeW5jUXVldWVSZXRyeSAqLyksIFxuICAgICAgICAvLyBWaXNpYmlsaXR5IGhhbmRsZXIgdGhhdCB0cmlnZ2VycyBhbiBpbW1lZGlhdGUgcmV0cnkgb2YgYWxsIHJldHJ5YWJsZVxuICAgICAgICAvLyBvcGVyYXRpb25zLiBNZWFudCB0byBzcGVlZCB1cCByZWNvdmVyeSB3aGVuIHdlIHJlZ2FpbiBmaWxlIHN5c3RlbSBhY2Nlc3NcbiAgICAgICAgLy8gYWZ0ZXIgcGFnZSBjb21lcyBpbnRvIGZvcmVncm91bmQuXG4gICAgICAgIHRoaXMuV2MgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0geXUoKTtcbiAgICAgICAgICAgIHQgJiYgQyhcIkFzeW5jUXVldWVcIiwgXCJWaXNpYmlsaXR5IHN0YXRlIGNoYW5nZWQgdG8gXCIgKyB0LnZpc2liaWxpdHlTdGF0ZSksIHRoaXMueG8uUG8oKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdCA9IHl1KCk7XG4gICAgICAgIHQgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB0LmFkZEV2ZW50TGlzdGVuZXIgJiYgdC5hZGRFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCB0aGlzLldjKTtcbiAgICB9XG4gICAgZ2V0IGlzU2h1dHRpbmdEb3duKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5xYztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyBvcGVyYXRpb24gdG8gdGhlIHF1ZXVlIHdpdGhvdXQgd2FpdGluZyBmb3IgaXQgdG8gY29tcGxldGUgKGkuZS5cbiAgICAgKiB3ZSBpZ25vcmUgdGhlIFByb21pc2UgcmVzdWx0KS5cbiAgICAgKi8gICAgZW5xdWV1ZUFuZEZvcmdldCh0KSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhpcy5lbnF1ZXVlKHQpO1xuICAgIH1cbiAgICBlbnF1ZXVlQW5kRm9yZ2V0RXZlbldoaWxlUmVzdHJpY3RlZCh0KSB7XG4gICAgICAgIHRoaXMuemMoKSwgXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhpcy5IYyh0KTtcbiAgICB9XG4gICAgZW50ZXJSZXN0cmljdGVkTW9kZSh0KSB7XG4gICAgICAgIGlmICghdGhpcy5xYykge1xuICAgICAgICAgICAgdGhpcy5xYyA9ICEwLCB0aGlzLlFjID0gdCB8fCAhMTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB5dSgpO1xuICAgICAgICAgICAgZSAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUucmVtb3ZlRXZlbnRMaXN0ZW5lciAmJiBlLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ2aXNpYmlsaXR5Y2hhbmdlXCIsIHRoaXMuV2MpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVucXVldWUodCkge1xuICAgICAgICBpZiAodGhpcy56YygpLCB0aGlzLnFjKSBcbiAgICAgICAgLy8gUmV0dXJuIGEgUHJvbWlzZSB3aGljaCBuZXZlciByZXNvbHZlcy5cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgoKSA9PiB7fSkpO1xuICAgICAgICAvLyBDcmVhdGUgYSBkZWZlcnJlZCBQcm9taXNlIHRoYXQgd2UgY2FuIHJldHVybiB0byB0aGUgY2FsbGVlLiBUaGlzXG4gICAgICAgIC8vIGFsbG93cyB1cyB0byByZXR1cm4gYSBcImhhbmdpbmcgUHJvbWlzZVwiIG9ubHkgdG8gdGhlIGNhbGxlZSBhbmQgc3RpbGxcbiAgICAgICAgLy8gYWR2YW5jZSB0aGUgcXVldWUgZXZlbiB3aGVuIHRoZSBvcGVyYXRpb24gaXMgbm90IHJ1bi5cbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbmV3IHE7XG4gICAgICAgIHJldHVybiB0aGlzLkhjKCgoKSA9PiB0aGlzLnFjICYmIHRoaXMuUWMgPyBQcm9taXNlLnJlc29sdmUoKSA6ICh0KCkudGhlbihlLnJlc29sdmUsIGUucmVqZWN0KSwgXG4gICAgICAgIGUucHJvbWlzZSkpKS50aGVuKCgoKSA9PiBlLnByb21pc2UpKTtcbiAgICB9XG4gICAgZW5xdWV1ZVJldHJ5YWJsZSh0KSB7XG4gICAgICAgIHRoaXMuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gKHRoaXMuTGMucHVzaCh0KSwgdGhpcy5KYygpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSdW5zIHRoZSBuZXh0IG9wZXJhdGlvbiBmcm9tIHRoZSByZXRyeWFibGUgcXVldWUuIElmIHRoZSBvcGVyYXRpb24gZmFpbHMsXG4gICAgICogcmVzY2hlZHVsZXMgd2l0aCBiYWNrb2ZmLlxuICAgICAqLyAgICBhc3luYyBKYygpIHtcbiAgICAgICAgaWYgKDAgIT09IHRoaXMuTGMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuTGNbMF0oKSwgdGhpcy5MYy5zaGlmdCgpLCB0aGlzLnhvLnJlc2V0KCk7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgaWYgKCFWdCh0KSkgdGhyb3cgdDtcbiAvLyBGYWlsdXJlIHdpbGwgYmUgaGFuZGxlZCBieSBBc3luY1F1ZXVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEMoXCJBc3luY1F1ZXVlXCIsIFwiT3BlcmF0aW9uIGZhaWxlZCB3aXRoIHJldHJ5YWJsZSBlcnJvcjogXCIgKyB0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuTGMubGVuZ3RoID4gMCAmJiBcbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBhZGRpdGlvbmFsIG9wZXJhdGlvbnMsIHdlIHJlLXNjaGVkdWxlIGByZXRyeU5leHRPcCgpYC5cbiAgICAgICAgICAgIC8vIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIHJ1biByZXRyeWFibGUgb3BlcmF0aW9ucyB0aGF0IGZhaWxlZCBkdXJpbmdcbiAgICAgICAgICAgIC8vIHRoZWlyIGluaXRpYWwgYXR0ZW1wdCBzaW5jZSB3ZSBkb24ndCBrbm93IHdoZXRoZXIgdGhleSBhcmUgYWxyZWFkeVxuICAgICAgICAgICAgLy8gZW5xdWV1ZWQuIElmLCBmb3IgZXhhbXBsZSwgYG9wMWAsIGBvcDJgLCBgb3AzYCBhcmUgZW5xdWV1ZWQgYW5kIGBvcDFgXG4gICAgICAgICAgICAvLyBuZWVkcyB0byAgYmUgcmUtcnVuLCB3ZSB3aWxsIHJ1biBgb3AxYCwgYG9wMWAsIGBvcDJgIHVzaW5nIHRoZVxuICAgICAgICAgICAgLy8gYWxyZWFkeSBlbnF1ZXVlZCBjYWxscyB0byBgcmV0cnlOZXh0T3AoKWAuIGBvcDMoKWAgd2lsbCB0aGVuIHJ1biBpbiB0aGVcbiAgICAgICAgICAgIC8vIGNhbGwgc2NoZWR1bGVkIGhlcmUuXG4gICAgICAgICAgICAvLyBTaW5jZSBgYmFja29mZkFuZFJ1bigpYCBjYW5jZWxzIGFuIGV4aXN0aW5nIGJhY2tvZmYgYW5kIHNjaGVkdWxlcyBhXG4gICAgICAgICAgICAvLyBuZXcgYmFja29mZiBvbiBldmVyeSBjYWxsLCB0aGVyZSBpcyBvbmx5IGV2ZXIgYSBzaW5nbGUgYWRkaXRpb25hbFxuICAgICAgICAgICAgLy8gb3BlcmF0aW9uIGluIHRoZSBxdWV1ZS5cbiAgICAgICAgICAgIHRoaXMueG8uUm8oKCgpID0+IHRoaXMuSmMoKSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIEhjKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuQmMudGhlbigoKCkgPT4gKHRoaXMuR2MgPSAhMCwgdCgpLmNhdGNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuS2MgPSB0LCB0aGlzLkdjID0gITE7XG4gICAgICAgICAgICBjb25zdCBlID0gXG4gICAgICAgICAgICAvKipcbiAqIENocm9tZSBpbmNsdWRlcyBFcnJvci5tZXNzYWdlIGluIEVycm9yLnN0YWNrLiBPdGhlciBicm93c2VycyBkbyBub3QuXG4gKiBUaGlzIHJldHVybnMgZXhwZWN0ZWQgb3V0cHV0IG9mIG1lc3NhZ2UgKyBzdGFjayB3aGVuIGF2YWlsYWJsZS5cbiAqIEBwYXJhbSBlcnJvciAtIEVycm9yIG9yIEZpcmVzdG9yZUVycm9yXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICBsZXQgZSA9IHQubWVzc2FnZSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIHQuc3RhY2sgJiYgKGUgPSB0LnN0YWNrLmluY2x1ZGVzKHQubWVzc2FnZSkgPyB0LnN0YWNrIDogdC5tZXNzYWdlICsgXCJcXG5cIiArIHQuc3RhY2spO1xuICAgICAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKHQpO1xuICAgICAgICAgICAgLy8gUmUtdGhyb3cgdGhlIGVycm9yIHNvIHRoYXQgdGhpcy50YWlsIGJlY29tZXMgYSByZWplY3RlZCBQcm9taXNlIGFuZFxuICAgICAgICAgICAgLy8gYWxsIGZ1cnRoZXIgYXR0ZW1wdHMgdG8gY2hhaW4gKHZpYSAudGhlbikgd2lsbCBqdXN0IHNob3J0LWNpcmN1aXRcbiAgICAgICAgICAgIC8vIGFuZCByZXR1cm4gdGhlIHJlamVjdGVkIFByb21pc2UuXG4gICAgICAgICAgICB0aHJvdyB4KFwiSU5URVJOQUwgVU5IQU5ETEVEIEVSUk9SOiBcIiwgZSksIHQ7XG4gICAgICAgIH0pKS50aGVuKCh0ID0+ICh0aGlzLkdjID0gITEsIHQpKSkpKSk7XG4gICAgICAgIHJldHVybiB0aGlzLkJjID0gZSwgZTtcbiAgICB9XG4gICAgZW5xdWV1ZUFmdGVyRGVsYXkodCwgZSwgbikge1xuICAgICAgICB0aGlzLnpjKCksIFxuICAgICAgICAvLyBGYXN0LWZvcndhcmQgZGVsYXlzIGZvciB0aW1lcklkcyB0aGF0IGhhdmUgYmVlbiBvdmVycmlkZW4uXG4gICAgICAgIHRoaXMuamMuaW5kZXhPZih0KSA+IC0xICYmIChlID0gMCk7XG4gICAgICAgIGNvbnN0IHMgPSBuYy5jcmVhdGVBbmRTY2hlZHVsZSh0aGlzLCB0LCBlLCBuLCAodCA9PiB0aGlzLlljKHQpKSk7XG4gICAgICAgIHJldHVybiB0aGlzLlVjLnB1c2gocyksIHM7XG4gICAgfVxuICAgIHpjKCkge1xuICAgICAgICB0aGlzLktjICYmIE8oKTtcbiAgICB9XG4gICAgdmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcygpIHt9XG4gICAgLyoqXG4gICAgICogV2FpdHMgdW50aWwgYWxsIGN1cnJlbnRseSBxdWV1ZWQgdGFza3MgYXJlIGZpbmlzaGVkIGV4ZWN1dGluZy4gRGVsYXllZFxuICAgICAqIG9wZXJhdGlvbnMgYXJlIG5vdCBydW4uXG4gICAgICovICAgIGFzeW5jIFhjKCkge1xuICAgICAgICAvLyBPcGVyYXRpb25zIGluIHRoZSBxdWV1ZSBwcmlvciB0byBkcmFpbmluZyBtYXkgaGF2ZSBlbnF1ZXVlZCBhZGRpdGlvbmFsXG4gICAgICAgIC8vIG9wZXJhdGlvbnMuIEtlZXAgZHJhaW5pbmcgdGhlIHF1ZXVlIHVudGlsIHRoZSB0YWlsIGlzIG5vIGxvbmdlciBhZHZhbmNlZCxcbiAgICAgICAgLy8gd2hpY2ggaW5kaWNhdGVzIHRoYXQgbm8gbW9yZSBuZXcgb3BlcmF0aW9ucyB3ZXJlIGVucXVldWVkIGFuZCB0aGF0IGFsbFxuICAgICAgICAvLyBvcGVyYXRpb25zIHdlcmUgZXhlY3V0ZWQuXG4gICAgICAgIGxldCB0O1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICB0ID0gdGhpcy5CYywgYXdhaXQgdDtcbiAgICAgICAgfSB3aGlsZSAodCAhPT0gdGhpcy5CYyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvciBUZXN0czogRGV0ZXJtaW5lIGlmIGEgZGVsYXllZCBvcGVyYXRpb24gd2l0aCBhIHBhcnRpY3VsYXIgVGltZXJJZFxuICAgICAqIGV4aXN0cy5cbiAgICAgKi8gICAgWmModCkge1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5VYykgaWYgKGUudGltZXJJZCA9PT0gdCkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvciBUZXN0czogUnVucyBzb21lIG9yIGFsbCBkZWxheWVkIG9wZXJhdGlvbnMgZWFybHkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbGFzdFRpbWVySWQgLSBEZWxheWVkIG9wZXJhdGlvbnMgdXAgdG8gYW5kIGluY2x1ZGluZyB0aGlzIFRpbWVySWRcbiAgICAgKiB3aWxsIGJlIGRyYWluZWQuIFBhc3MgVGltZXJJZC5BbGwgdG8gcnVuIGFsbCBkZWxheWVkIG9wZXJhdGlvbnMuXG4gICAgICogQHJldHVybnMgYSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgb25jZSBhbGwgb3BlcmF0aW9ucyBoYXZlIGJlZW4gcnVuLlxuICAgICAqLyAgICB0YSh0KSB7XG4gICAgICAgIC8vIE5vdGUgdGhhdCBkcmFpbmluZyBtYXkgZ2VuZXJhdGUgbW9yZSBkZWxheWVkIG9wcywgc28gd2UgZG8gdGhhdCBmaXJzdC5cbiAgICAgICAgcmV0dXJuIHRoaXMuWGMoKS50aGVuKCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBSdW4gb3BzIGluIHRoZSBzYW1lIG9yZGVyIHRoZXknZCBydW4gaWYgdGhleSByYW4gbmF0dXJhbGx5LlxuICAgICAgICAgICAgdGhpcy5VYy5zb3J0KCgodCwgZSkgPT4gdC50YXJnZXRUaW1lTXMgLSBlLnRhcmdldFRpbWVNcykpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMuVWMpIGlmIChlLnNraXBEZWxheSgpLCBcImFsbFwiIC8qIFRpbWVySWQuQWxsICovICE9PSB0ICYmIGUudGltZXJJZCA9PT0gdCkgYnJlYWs7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5YYygpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvciBUZXN0czogU2tpcCBhbGwgc3Vic2VxdWVudCBkZWxheXMgZm9yIGEgdGltZXIgaWQuXG4gICAgICovICAgIGVhKHQpIHtcbiAgICAgICAgdGhpcy5qYy5wdXNoKHQpO1xuICAgIH1cbiAgICAvKiogQ2FsbGVkIG9uY2UgYSBEZWxheWVkT3BlcmF0aW9uIGlzIHJ1biBvciBjYW5jZWxlZC4gKi8gICAgWWModCkge1xuICAgICAgICAvLyBOT1RFOiBpbmRleE9mIC8gc2xpY2UgYXJlIE8obiksIGJ1dCBkZWxheWVkT3BlcmF0aW9ucyBpcyBleHBlY3RlZCB0byBiZSBzbWFsbC5cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuVWMuaW5kZXhPZih0KTtcbiAgICAgICAgdGhpcy5VYy5zcGxpY2UoZSwgMSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBlaCh0KSB7XG4gICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgb2JqIGlzIGFuIG9iamVjdCBhbmQgY29udGFpbnMgYXQgbGVhc3Qgb25lIG9mIHRoZSBzcGVjaWZpZWRcbiAqIG1ldGhvZHMuXG4gKi9cbiAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgdCB8fCBudWxsID09PSB0KSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG4gPSB0O1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkgaWYgKHQgaW4gbiAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG5bdF0pIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKlxuICogUmVwcmVzZW50cyB0aGUgdGFzayBvZiBsb2FkaW5nIGEgRmlyZXN0b3JlIGJ1bmRsZS4gSXQgcHJvdmlkZXMgcHJvZ3Jlc3Mgb2YgYnVuZGxlXG4gKiBsb2FkaW5nLCBhcyB3ZWxsIGFzIHRhc2sgY29tcGxldGlvbiBhbmQgZXJyb3IgZXZlbnRzLlxuICpcbiAqIFRoZSBBUEkgaXMgY29tcGF0aWJsZSB3aXRoIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+YC5cbiAqLyAodCwgWyBcIm5leHRcIiwgXCJlcnJvclwiLCBcImNvbXBsZXRlXCIgXSk7XG59XG5cbmNsYXNzIG5oIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlciA9IHt9LCB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyID0gbmV3IHEsIHRoaXMuX2xhc3RQcm9ncmVzcyA9IHtcbiAgICAgICAgICAgIHRhc2tTdGF0ZTogXCJSdW5uaW5nXCIsXG4gICAgICAgICAgICB0b3RhbEJ5dGVzOiAwLFxuICAgICAgICAgICAgdG90YWxEb2N1bWVudHM6IDAsXG4gICAgICAgICAgICBieXRlc0xvYWRlZDogMCxcbiAgICAgICAgICAgIGRvY3VtZW50c0xvYWRlZDogMFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgZnVuY3Rpb25zIHRvIGxpc3RlbiB0byBidW5kbGUgbG9hZGluZyBwcm9ncmVzcyBldmVudHMuXG4gICAgICogQHBhcmFtIG5leHQgLSBDYWxsZWQgd2hlbiB0aGVyZSBpcyBhIHByb2dyZXNzIHVwZGF0ZSBmcm9tIGJ1bmRsZSBsb2FkaW5nLiBUeXBpY2FsbHkgYG5leHRgIGNhbGxzIG9jY3VyXG4gICAgICogICBlYWNoIHRpbWUgYSBGaXJlc3RvcmUgZG9jdW1lbnQgaXMgbG9hZGVkIGZyb20gdGhlIGJ1bmRsZS5cbiAgICAgKiBAcGFyYW0gZXJyb3IgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLiBUaGUgdGFzayBhYm9ydHMgYWZ0ZXIgcmVwb3J0aW5nIHRoZVxuICAgICAqICAgZXJyb3IsIGFuZCB0aGVyZSBzaG91bGQgYmUgbm8gbW9yZSB1cGRhdGVzIGFmdGVyIHRoaXMuXG4gICAgICogQHBhcmFtIGNvbXBsZXRlIC0gQ2FsbGVkIHdoZW4gdGhlIGxvYWRpbmcgdGFzayBpcyBjb21wbGV0ZS5cbiAgICAgKi8gICAgb25Qcm9ncmVzcyh0LCBlLCBuKSB7XG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIgPSB7XG4gICAgICAgICAgICBuZXh0OiB0LFxuICAgICAgICAgICAgZXJyb3I6IGUsXG4gICAgICAgICAgICBjb21wbGV0ZTogblxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRzIHRoZSBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPi5jYXRjaGAgaW50ZXJmYWNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9uUmVqZWN0ZWQgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLlxuICAgICAqLyAgICBjYXRjaCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyLnByb21pc2UuY2F0Y2godCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEltcGxlbWVudHMgdGhlIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+LnRoZW5gIGludGVyZmFjZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvbkZ1bGZpbGxlZCAtIENhbGxlZCBvbiB0aGUgY29tcGxldGlvbiBvZiB0aGUgbG9hZGluZyB0YXNrIHdpdGggYSBmaW5hbCBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2AgdXBkYXRlLlxuICAgICAqICAgVGhlIHVwZGF0ZSB3aWxsIGFsd2F5cyBoYXZlIGl0cyBgdGFza1N0YXRlYCBzZXQgdG8gYFwiU3VjY2Vzc1wiYC5cbiAgICAgKiBAcGFyYW0gb25SZWplY3RlZCAtIENhbGxlZCB3aGVuIGFuIGVycm9yIG9jY3VycyBkdXJpbmcgYnVuZGxlIGxvYWRpbmcuXG4gICAgICovICAgIHRoZW4odCwgZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5wcm9taXNlLnRoZW4odCwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGFsbCBvYnNlcnZlcnMgdGhhdCBidW5kbGUgbG9hZGluZyBoYXMgY29tcGxldGVkLCB3aXRoIGEgcHJvdmlkZWRcbiAgICAgKiBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi8gICAgX2NvbXBsZXRlV2l0aCh0KSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVByb2dyZXNzKHQpLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmNvbXBsZXRlICYmIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuY29tcGxldGUoKSwgXG4gICAgICAgIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucmVzb2x2ZSh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTm90aWZpZXMgYWxsIG9ic2VydmVycyB0aGF0IGJ1bmRsZSBsb2FkaW5nIGhhcyBmYWlsZWQsIHdpdGggYSBwcm92aWRlZFxuICAgICAqIGBFcnJvcmAgYXMgdGhlIHJlYXNvbi5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF9mYWlsV2l0aCh0KSB7XG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcy50YXNrU3RhdGUgPSBcIkVycm9yXCIsIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIubmV4dCAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQodGhpcy5fbGFzdFByb2dyZXNzKSwgXG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuZXJyb3IgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5lcnJvcih0KSwgdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5yZWplY3QodCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGEgcHJvZ3Jlc3MgdXBkYXRlIG9mIGxvYWRpbmcgYSBidW5kbGUuXG4gICAgICogQHBhcmFtIHByb2dyZXNzIC0gVGhlIG5ldyBwcm9ncmVzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF91cGRhdGVQcm9ncmVzcyh0KSB7XG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcyA9IHQsIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIubmV4dCAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQodCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIERPTUV4Y2VwdGlvbiBlcnJvciBjb2RlIGNvbnN0YW50cy4gKi8gY29uc3Qgc2ggPSAtMTtcblxuLyoqXG4gKiBUaGUgQ2xvdWQgRmlyZXN0b3JlIHNlcnZpY2UgaW50ZXJmYWNlLlxuICpcbiAqIERvIG5vdCBjYWxsIHRoaXMgY29uc3RydWN0b3IgZGlyZWN0bHkuIEluc3RlYWQsIHVzZSB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKi9cbmNsYXNzIGloIGV4dGVuZHMgbWEge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcykge1xuICAgICAgICBzdXBlcih0LCBlLCBuLCBzKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGl0J3MgYSB7QGxpbmsgRmlyZXN0b3JlfSBvciBGaXJlc3RvcmUgTGl0ZSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiZmlyZXN0b3JlXCIsIHRoaXMuX3F1ZXVlID0gbmV3IHRoLCB0aGlzLl9wZXJzaXN0ZW5jZUtleSA9IChudWxsID09IHMgPyB2b2lkIDAgOiBzLm5hbWUpIHx8IFwiW0RFRkFVTFRdXCI7XG4gICAgfVxuICAgIF90ZXJtaW5hdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maXJlc3RvcmVDbGllbnQgfHwgXG4gICAgICAgIC8vIFRoZSBjbGllbnQgbXVzdCBiZSBpbml0aWFsaXplZCB0byBlbnN1cmUgdGhhdCBhbGwgc3Vic2VxdWVudCBBUElcbiAgICAgICAgLy8gdXNhZ2UgdGhyb3dzIGFuIGV4Y2VwdGlvbi5cbiAgICAgICAgY2godGhpcyksIHRoaXMuX2ZpcmVzdG9yZUNsaWVudC50ZXJtaW5hdGUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugb2Yge0BsaW5rIEZpcmVzdG9yZX0gd2l0aCB0aGUgcHJvdmlkZWQgc2V0dGluZ3MuXG4gKiBDYW4gb25seSBiZSBjYWxsZWQgYmVmb3JlIGFueSBvdGhlciBmdW5jdGlvbiwgaW5jbHVkaW5nXG4gKiB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uIElmIHRoZSBjdXN0b20gc2V0dGluZ3MgYXJlIGVtcHR5LCB0aGlzIGZ1bmN0aW9uIGlzXG4gKiBlcXVpdmFsZW50IHRvIGNhbGxpbmcge0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9LlxuICpcbiAqIEBwYXJhbSBhcHAgLSBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IHdpdGggd2hpY2ggdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGxcbiAqIGJlIGFzc29jaWF0ZWQuXG4gKiBAcGFyYW0gc2V0dGluZ3MgLSBBIHNldHRpbmdzIG9iamVjdCB0byBjb25maWd1cmUgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlLlxuICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgbmFtZSBvZiBkYXRhYmFzZS5cbiAqIEByZXR1cm5zIEEgbmV3bHkgaW5pdGlhbGl6ZWQge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gcmgodCwgZSwgbikge1xuICAgIG4gfHwgKG4gPSBcIihkZWZhdWx0KVwiKTtcbiAgICBjb25zdCBzID0gX2dldFByb3ZpZGVyKHQsIFwiZmlyZXN0b3JlXCIpO1xuICAgIGlmIChzLmlzSW5pdGlhbGl6ZWQobikpIHtcbiAgICAgICAgY29uc3QgdCA9IHMuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6IG5cbiAgICAgICAgfSksIGkgPSBzLmdldE9wdGlvbnMobik7XG4gICAgICAgIGlmIChkZWVwRXF1YWwoaSwgZSkpIHJldHVybiB0O1xuICAgICAgICB0aHJvdyBuZXcgTChCLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiaW5pdGlhbGl6ZUZpcmVzdG9yZSgpIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIHdpdGggZGlmZmVyZW50IG9wdGlvbnMuIFRvIGF2b2lkIHRoaXMgZXJyb3IsIGNhbGwgaW5pdGlhbGl6ZUZpcmVzdG9yZSgpIHdpdGggdGhlIHNhbWUgb3B0aW9ucyBhcyB3aGVuIGl0IHdhcyBvcmlnaW5hbGx5IGNhbGxlZCwgb3IgY2FsbCBnZXRGaXJlc3RvcmUoKSB0byByZXR1cm4gdGhlIGFscmVhZHkgaW5pdGlhbGl6ZWQgaW5zdGFuY2UuXCIpO1xuICAgIH1cbiAgICBpZiAodm9pZCAwICE9PSBlLmNhY2hlU2l6ZUJ5dGVzICYmIC0xICE9PSBlLmNhY2hlU2l6ZUJ5dGVzICYmIGUuY2FjaGVTaXplQnl0ZXMgPCAxMDQ4NTc2KSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiY2FjaGVTaXplQnl0ZXMgbXVzdCBiZSBhdCBsZWFzdCAxMDQ4NTc2XCIpO1xuICAgIHJldHVybiBzLmluaXRpYWxpemUoe1xuICAgICAgICBvcHRpb25zOiBlLFxuICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gb2goZSwgbikge1xuICAgIGNvbnN0IHMgPSBcIm9iamVjdFwiID09IHR5cGVvZiBlID8gZSA6IGdldEFwcCgpLCBpID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IGUgOiBuIHx8IFwiKGRlZmF1bHQpXCIsIHIgPSBfZ2V0UHJvdmlkZXIocywgXCJmaXJlc3RvcmVcIikuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgaWRlbnRpZmllcjogaVxuICAgIH0pO1xuICAgIGlmICghci5faW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgY29uc3QgdCA9IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydChcImZpcmVzdG9yZVwiKTtcbiAgICAgICAgdCAmJiBnYShyLCAuLi50KTtcbiAgICB9XG4gICAgcmV0dXJuIHI7XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gdWgodCkge1xuICAgIHJldHVybiB0Ll9maXJlc3RvcmVDbGllbnQgfHwgY2godCksIHQuX2ZpcmVzdG9yZUNsaWVudC52ZXJpZnlOb3RUZXJtaW5hdGVkKCksIHQuX2ZpcmVzdG9yZUNsaWVudDtcbn1cblxuZnVuY3Rpb24gY2godCkge1xuICAgIHZhciBlO1xuICAgIGNvbnN0IG4gPSB0Ll9mcmVlemVTZXR0aW5ncygpLCBzID0gZnVuY3Rpb24odCwgZSwgbiwgcykge1xuICAgICAgICByZXR1cm4gbmV3IE10KHQsIGUsIG4sIHMuaG9zdCwgcy5zc2wsIHMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZywgcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcsIHMudXNlRmV0Y2hTdHJlYW1zKTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAvLyBzZXR0aW5ncygpIGRlZmF1bHRzOlxuICAgICh0Ll9kYXRhYmFzZUlkLCAobnVsbCA9PT0gKGUgPSB0Ll9hcHApIHx8IHZvaWQgMCA9PT0gZSA/IHZvaWQgMCA6IGUub3B0aW9ucy5hcHBJZCkgfHwgXCJcIiwgdC5fcGVyc2lzdGVuY2VLZXksIG4pO1xuICAgIHQuX2ZpcmVzdG9yZUNsaWVudCA9IG5ldyBrYSh0Ll9hdXRoQ3JlZGVudGlhbHMsIHQuX2FwcENoZWNrQ3JlZGVudGlhbHMsIHQuX3F1ZXVlLCBzKTtcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgcGVyc2lzdGVudCBzdG9yYWdlLCBpZiBwb3NzaWJsZS5cbiAqXG4gKiBNdXN0IGJlIGNhbGxlZCBiZWZvcmUgYW55IG90aGVyIGZ1bmN0aW9ucyAob3RoZXIgdGhhblxuICoge0BsaW5rIGluaXRpYWxpemVGaXJlc3RvcmV9LCB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0gb3JcbiAqIHtAbGluayBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlfS5cbiAqXG4gKiBJZiB0aGlzIGZhaWxzLCBgZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgd2lsbCByZWplY3QgdGhlIHByb21pc2UgaXRcbiAqIHJldHVybnMuIE5vdGUgdGhhdCBldmVuIGFmdGVyIHRoaXMgZmFpbHVyZSwgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGxcbiAqIHJlbWFpbiB1c2FibGUsIGhvd2V2ZXIgb2ZmbGluZSBwZXJzaXN0ZW5jZSB3aWxsIGJlIGRpc2FibGVkLlxuICpcbiAqIFRoZXJlIGFyZSBzZXZlcmFsIHJlYXNvbnMgd2h5IHRoaXMgY2FuIGZhaWwsIHdoaWNoIGNhbiBiZSBpZGVudGlmaWVkIGJ5XG4gKiB0aGUgYGNvZGVgIG9uIHRoZSBlcnJvci5cbiAqXG4gKiAgICogZmFpbGVkLXByZWNvbmRpdGlvbjogVGhlIGFwcCBpcyBhbHJlYWR5IG9wZW4gaW4gYW5vdGhlciBicm93c2VyIHRhYi5cbiAqICAgKiB1bmltcGxlbWVudGVkOiBUaGUgYnJvd3NlciBpcyBpbmNvbXBhdGlibGUgd2l0aCB0aGUgb2ZmbGluZVxuICogICAgIHBlcnNpc3RlbmNlIGltcGxlbWVudGF0aW9uLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gZW5hYmxlIHBlcnNpc3RlbmNlIGZvci5cbiAqIEBwYXJhbSBwZXJzaXN0ZW5jZVNldHRpbmdzIC0gT3B0aW9uYWwgc2V0dGluZ3Mgb2JqZWN0IHRvIGNvbmZpZ3VyZVxuICogcGVyc2lzdGVuY2UuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlcHJlc2VudHMgc3VjY2Vzc2Z1bGx5IGVuYWJsaW5nIHBlcnNpc3RlbnQgc3RvcmFnZS5cbiAqLyBmdW5jdGlvbiBhaCh0LCBlKSB7XG4gICAgcGgodCA9IGZhKHQsIGloKSk7XG4gICAgY29uc3QgbiA9IHVoKHQpLCBzID0gdC5fZnJlZXplU2V0dGluZ3MoKSwgaSA9IG5ldyBvYTtcbiAgICByZXR1cm4gbGgobiwgaSwgbmV3IGlhKGksIHMuY2FjaGVTaXplQnl0ZXMsIG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZm9yY2VPd25lcnNoaXApKTtcbn1cblxuLyoqXG4gKiBBdHRlbXB0cyB0byBlbmFibGUgbXVsdGktdGFiIHBlcnNpc3RlbnQgc3RvcmFnZSwgaWYgcG9zc2libGUuIElmIGVuYWJsZWRcbiAqIGFjcm9zcyBhbGwgdGFicywgYWxsIG9wZXJhdGlvbnMgc2hhcmUgYWNjZXNzIHRvIGxvY2FsIHBlcnNpc3RlbmNlLCBpbmNsdWRpbmdcbiAqIHNoYXJlZCBleGVjdXRpb24gb2YgcXVlcmllcyBhbmQgbGF0ZW5jeS1jb21wZW5zYXRlZCBsb2NhbCBkb2N1bWVudCB1cGRhdGVzXG4gKiBhY3Jvc3MgYWxsIGNvbm5lY3RlZCBpbnN0YW5jZXMuXG4gKlxuICogSWYgdGhpcyBmYWlscywgYGVuYWJsZU11bHRpVGFiSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgd2lsbCByZWplY3QgdGhlIHByb21pc2VcbiAqIGl0IHJldHVybnMuIE5vdGUgdGhhdCBldmVuIGFmdGVyIHRoaXMgZmFpbHVyZSwgdGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHdpbGxcbiAqIHJlbWFpbiB1c2FibGUsIGhvd2V2ZXIgb2ZmbGluZSBwZXJzaXN0ZW5jZSB3aWxsIGJlIGRpc2FibGVkLlxuICpcbiAqIFRoZXJlIGFyZSBzZXZlcmFsIHJlYXNvbnMgd2h5IHRoaXMgY2FuIGZhaWwsIHdoaWNoIGNhbiBiZSBpZGVudGlmaWVkIGJ5XG4gKiB0aGUgYGNvZGVgIG9uIHRoZSBlcnJvci5cbiAqXG4gKiAgICogZmFpbGVkLXByZWNvbmRpdGlvbjogVGhlIGFwcCBpcyBhbHJlYWR5IG9wZW4gaW4gYW5vdGhlciBicm93c2VyIHRhYiBhbmRcbiAqICAgICBtdWx0aS10YWIgaXMgbm90IGVuYWJsZWQuXG4gKiAgICogdW5pbXBsZW1lbnRlZDogVGhlIGJyb3dzZXIgaXMgaW5jb21wYXRpYmxlIHdpdGggdGhlIG9mZmxpbmVcbiAqICAgICBwZXJzaXN0ZW5jZSBpbXBsZW1lbnRhdGlvbi5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGVuYWJsZSBwZXJzaXN0ZW5jZSBmb3IuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlcHJlc2VudHMgc3VjY2Vzc2Z1bGx5IGVuYWJsaW5nIHBlcnNpc3RlbnRcbiAqIHN0b3JhZ2UuXG4gKi8gZnVuY3Rpb24gaGgodCkge1xuICAgIHBoKHQgPSBmYSh0LCBpaCkpO1xuICAgIGNvbnN0IGUgPSB1aCh0KSwgbiA9IHQuX2ZyZWV6ZVNldHRpbmdzKCksIHMgPSBuZXcgb2E7XG4gICAgcmV0dXJuIGxoKGUsIHMsIG5ldyByYShzLCBuLmNhY2hlU2l6ZUJ5dGVzKSk7XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGJvdGggdGhlIGBPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXJgIGFuZCBgT25saW5lQ29tcG9uZW50UHJvdmlkZXJgLlxuICogSWYgdGhlIG9wZXJhdGlvbiBmYWlscyB3aXRoIGEgcmVjb3ZlcmFibGUgZXJyb3IgKHNlZVxuICogYGNhblJlY292ZXJGcm9tSW5kZXhlZERiRXJyb3IoKWAgYmVsb3cpLCB0aGUgcmV0dXJuZWQgUHJvbWlzZSBpcyByZWplY3RlZFxuICogYnV0IHRoZSBjbGllbnQgcmVtYWlucyB1c2FibGUuXG4gKi8gZnVuY3Rpb24gbGgodCwgZSwgbikge1xuICAgIGNvbnN0IHMgPSBuZXcgcTtcbiAgICByZXR1cm4gdC5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IE9hKHQsIG4pLCBhd2FpdCBNYSh0LCBlKSwgcy5yZXNvbHZlKCk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0O1xuICAgICAgICAgICAgaWYgKCFcbiAgICAgICAgICAgIC8qKlxuICogRGVjaWRlcyB3aGV0aGVyIHRoZSBwcm92aWRlZCBlcnJvciBhbGxvd3MgdXMgdG8gZ3JhY2VmdWxseSBkaXNhYmxlXG4gKiBwZXJzaXN0ZW5jZSAoYXMgb3Bwb3NlZCB0byBjcmFzaGluZyB0aGUgY2xpZW50KS5cbiAqL1xuICAgICAgICAgICAgZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICAgIGlmIChcIkZpcmViYXNlRXJyb3JcIiA9PT0gdC5uYW1lKSByZXR1cm4gdC5jb2RlID09PSBCLkZBSUxFRF9QUkVDT05ESVRJT04gfHwgdC5jb2RlID09PSBCLlVOSU1QTEVNRU5URUQ7XG4gICAgICAgICAgICAgICAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIERPTUV4Y2VwdGlvbiAmJiB0IGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uKSBcbiAgICAgICAgICAgICAgICAvLyBUaGVyZSBhcmUgYSBmZXcga25vd24gY2lyY3Vtc3RhbmNlcyB3aGVyZSB3ZSBjYW4gb3BlbiBJbmRleGVkRGIgYnV0XG4gICAgICAgICAgICAgICAgLy8gdHJ5aW5nIHRvIHJlYWQvd3JpdGUgd2lsbCBmYWlsIChlLmcuIHF1b3RhIGV4Y2VlZGVkKS4gRm9yXG4gICAgICAgICAgICAgICAgLy8gd2VsbC11bmRlcnN0b29kIGNhc2VzLCB3ZSBhdHRlbXB0IHRvIGRldGVjdCB0aGVzZSBhbmQgdGhlbiBncmFjZWZ1bGx5XG4gICAgICAgICAgICAgICAgLy8gZmFsbCBiYWNrIHRvIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgICAgICAgICAvLyBOT1RFOiBSYXRoZXIgdGhhbiBjb250aW51ZSB0byBhZGQgdG8gdGhpcyBsaXN0LCB3ZSBjb3VsZCBkZWNpZGUgdG9cbiAgICAgICAgICAgICAgICAvLyBhbHdheXMgZmFsbCBiYWNrLCB3aXRoIHRoZSByaXNrIHRoYXQgd2UgbWlnaHQgYWNjaWRlbnRhbGx5IGhpZGUgZXJyb3JzXG4gICAgICAgICAgICAgICAgLy8gcmVwcmVzZW50aW5nIGFjdHVhbCBTREsgYnVncy5cbiAgICAgICAgICAgICAgICAvLyBXaGVuIHRoZSBicm93c2VyIGlzIG91dCBvZiBxdW90YSB3ZSBjb3VsZCBnZXQgZWl0aGVyIHF1b3RhIGV4Y2VlZGVkXG4gICAgICAgICAgICAgICAgLy8gb3IgYW4gYWJvcnRlZCBlcnJvciBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZXJyb3IgaGFwcGVuZWQgZHVyaW5nXG4gICAgICAgICAgICAgICAgLy8gc2NoZW1hIG1pZ3JhdGlvbi5cbiAgICAgICAgICAgICAgICByZXR1cm4gMjIgPT09IHQuY29kZSB8fCAyMCA9PT0gdC5jb2RlIHx8IFxuICAgICAgICAgICAgICAgIC8vIEZpcmVmb3ggUHJpdmF0ZSBCcm93c2luZyBtb2RlIGRpc2FibGVzIEluZGV4ZWREYiBhbmQgcmV0dXJuc1xuICAgICAgICAgICAgICAgIC8vIElOVkFMSURfU1RBVEUgZm9yIGFueSB1c2FnZS5cbiAgICAgICAgICAgICAgICAxMSA9PT0gdC5jb2RlO1xuICAgICAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogQ2xlYXJzIHRoZSBwZXJzaXN0ZW50IHN0b3JhZ2UuIFRoaXMgaW5jbHVkZXMgcGVuZGluZyB3cml0ZXMgYW5kIGNhY2hlZFxuICogZG9jdW1lbnRzLlxuICpcbiAqIE11c3QgYmUgY2FsbGVkIHdoaWxlIHRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSBpcyBub3Qgc3RhcnRlZCAoYWZ0ZXIgdGhlIGFwcCBpc1xuICogdGVybWluYXRlZCBvciB3aGVuIHRoZSBhcHAgaXMgZmlyc3QgaW5pdGlhbGl6ZWQpLiBPbiBzdGFydHVwLCB0aGlzIGZ1bmN0aW9uXG4gKiBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgb3RoZXIgZnVuY3Rpb25zIChvdGhlciB0aGFuIHtAbGlua1xuICogaW5pdGlhbGl6ZUZpcmVzdG9yZX0gb3Ige0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9KSkuIElmIHRoZSB7QGxpbmsgRmlyZXN0b3JlfVxuICogaW5zdGFuY2UgaXMgc3RpbGwgcnVubmluZywgdGhlIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZCB3aXRoIHRoZSBlcnJvciBjb2RlXG4gKiBvZiBgZmFpbGVkLXByZWNvbmRpdGlvbmAuXG4gKlxuICogTm90ZTogYGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgaXMgcHJpbWFyaWx5IGludGVuZGVkIHRvIGhlbHAgd3JpdGVcbiAqIHJlbGlhYmxlIHRlc3RzIHRoYXQgdXNlIENsb3VkIEZpcmVzdG9yZS4gSXQgdXNlcyBhbiBlZmZpY2llbnQgbWVjaGFuaXNtIGZvclxuICogZHJvcHBpbmcgZXhpc3RpbmcgZGF0YSBidXQgZG9lcyBub3QgYXR0ZW1wdCB0byBzZWN1cmVseSBvdmVyd3JpdGUgb3JcbiAqIG90aGVyd2lzZSBtYWtlIGNhY2hlZCBkYXRhIHVucmVjb3ZlcmFibGUuIEZvciBhcHBsaWNhdGlvbnMgdGhhdCBhcmUgc2Vuc2l0aXZlXG4gKiB0byB0aGUgZGlzY2xvc3VyZSBvZiBjYWNoZWQgZGF0YSBpbiBiZXR3ZWVuIHVzZXIgc2Vzc2lvbnMsIHdlIHN0cm9uZ2x5XG4gKiByZWNvbW1lbmQgbm90IGVuYWJsaW5nIHBlcnNpc3RlbmNlIGF0IGFsbC5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGNsZWFyIHBlcnNpc3RlbmNlIGZvci5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgd2hlbiB0aGUgcGVyc2lzdGVudCBzdG9yYWdlIGlzXG4gKiBjbGVhcmVkLiBPdGhlcndpc2UsIHRoZSBwcm9taXNlIGlzIHJlamVjdGVkIHdpdGggYW4gZXJyb3IuXG4gKi8gKGUpKSB0aHJvdyBlO1xuICAgICAgICAgICAgTihcIkVycm9yIGVuYWJsaW5nIG9mZmxpbmUgcGVyc2lzdGVuY2UuIEZhbGxpbmcgYmFjayB0byBwZXJzaXN0ZW5jZSBkaXNhYmxlZDogXCIgKyBlKSwgXG4gICAgICAgICAgICBzLnJlamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pKS50aGVuKCgoKSA9PiBzLnByb21pc2UpKTtcbn1cblxuZnVuY3Rpb24gZmgodCkge1xuICAgIGlmICh0Ll9pbml0aWFsaXplZCAmJiAhdC5fdGVybWluYXRlZCkgdGhyb3cgbmV3IEwoQi5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlBlcnNpc3RlbmNlIGNhbiBvbmx5IGJlIGNsZWFyZWQgYmVmb3JlIGEgRmlyZXN0b3JlIGluc3RhbmNlIGlzIGluaXRpYWxpemVkIG9yIGFmdGVyIGl0IGlzIHRlcm1pbmF0ZWQuXCIpO1xuICAgIGNvbnN0IGUgPSBuZXcgcTtcbiAgICByZXR1cm4gdC5fcXVldWUuZW5xdWV1ZUFuZEZvcmdldEV2ZW5XaGlsZVJlc3RyaWN0ZWQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWJ0LkMoKSkgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0ICsgXCJtYWluXCI7XG4gICAgICAgICAgICAgICAgYXdhaXQgYnQuZGVsZXRlKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgICAgIC8qKlxuICogQ29tcGFyZXMgdHdvIGFycmF5IGZvciBlcXVhbGl0eSB1c2luZyBjb21wYXJhdG9yLiBUaGUgbWV0aG9kIGNvbXB1dGVzIHRoZVxuICogaW50ZXJzZWN0aW9uIGFuZCBpbnZva2VzIGBvbkFkZGAgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBpbiBgYWZ0ZXJgIGJ1dCBub3RcbiAqIGBiZWZvcmVgLiBgb25SZW1vdmVgIGlzIGludm9rZWQgZm9yIGV2ZXJ5IGVsZW1lbnQgaW4gYGJlZm9yZWAgYnV0IG1pc3NpbmdcbiAqIGZyb20gYGFmdGVyYC5cbiAqXG4gKiBUaGUgbWV0aG9kIGNyZWF0ZXMgYSBjb3B5IG9mIGJvdGggYGJlZm9yZWAgYW5kIGBhZnRlcmAgYW5kIHJ1bnMgaW4gTyhuIGxvZ1xuICogbiksIHdoZXJlIG4gaXMgdGhlIHNpemUgb2YgdGhlIHR3byBsaXN0cy5cbiAqXG4gKiBAcGFyYW0gYmVmb3JlIC0gVGhlIGVsZW1lbnRzIHRoYXQgZXhpc3QgaW4gdGhlIG9yaWdpbmFsIGFycmF5LlxuICogQHBhcmFtIGFmdGVyIC0gVGhlIGVsZW1lbnRzIHRvIGRpZmYgYWdhaW5zdCB0aGUgb3JpZ2luYWwgYXJyYXkuXG4gKiBAcGFyYW0gY29tcGFyYXRvciAtIFRoZSBjb21wYXJhdG9yIGZvciB0aGUgZWxlbWVudHMgaW4gYmVmb3JlIGFuZCBhZnRlci5cbiAqIEBwYXJhbSBvbkFkZCAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZiBgXG4gKiBhZnRlcmAgYnV0IG5vdCBgYmVmb3JlYC5cbiAqIEBwYXJhbSBvblJlbW92ZSAtIEEgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBldmVyeSBlbGVtZW50IHRoYXQgaXMgcGFydCBvZlxuICogYGJlZm9yZWAgYnV0IG5vdCBgYWZ0ZXJgLlxuICovIChGbyh0Ll9kYXRhYmFzZUlkLCB0Ll9wZXJzaXN0ZW5jZUtleSkpLCBlLnJlc29sdmUoKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgZS5yZWplY3QodCk7XG4gICAgICAgIH1cbiAgICB9KSksIGUucHJvbWlzZTtcbn1cblxuLyoqXG4gKiBXYWl0cyB1bnRpbCBhbGwgY3VycmVudGx5IHBlbmRpbmcgd3JpdGVzIGZvciB0aGUgYWN0aXZlIHVzZXIgaGF2ZSBiZWVuXG4gKiBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmQuXG4gKlxuICogVGhlIHJldHVybmVkIHByb21pc2UgcmVzb2x2ZXMgaW1tZWRpYXRlbHkgaWYgdGhlcmUgYXJlIG5vIG91dHN0YW5kaW5nIHdyaXRlcy5cbiAqIE90aGVyd2lzZSwgdGhlIHByb21pc2Ugd2FpdHMgZm9yIGFsbCBwcmV2aW91c2x5IGlzc3VlZCB3cml0ZXMgKGluY2x1ZGluZ1xuICogdGhvc2Ugd3JpdHRlbiBpbiBhIHByZXZpb3VzIGFwcCBzZXNzaW9uKSwgYnV0IGl0IGRvZXMgbm90IHdhaXQgZm9yIHdyaXRlc1xuICogdGhhdCB3ZXJlIGFkZGVkIGFmdGVyIHRoZSBmdW5jdGlvbiBpcyBjYWxsZWQuIElmIHlvdSB3YW50IHRvIHdhaXQgZm9yXG4gKiBhZGRpdGlvbmFsIHdyaXRlcywgY2FsbCBgd2FpdEZvclBlbmRpbmdXcml0ZXMoKWAgYWdhaW4uXG4gKlxuICogQW55IG91dHN0YW5kaW5nIGB3YWl0Rm9yUGVuZGluZ1dyaXRlcygpYCBwcm9taXNlcyBhcmUgcmVqZWN0ZWQgZHVyaW5nIHVzZXJcbiAqIGNoYW5nZXMuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgd2hpY2ggcmVzb2x2ZXMgd2hlbiBhbGwgY3VycmVudGx5IHBlbmRpbmcgd3JpdGVzIGhhdmUgYmVlblxuICogYWNrbm93bGVkZ2VkIGJ5IHRoZSBiYWNrZW5kLlxuICovIGZ1bmN0aW9uIGRoKHQpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gbmV3IHE7XG4gICAgICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ga2MoYXdhaXQgVWEodCksIGUpKSksIGUucHJvbWlzZTtcbiAgICB9KHVoKHQgPSBmYSh0LCBpaCkpKTtcbn1cblxuLyoqXG4gKiBSZS1lbmFibGVzIHVzZSBvZiB0aGUgbmV0d29yayBmb3IgdGhpcyB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSBhZnRlciBhIHByaW9yXG4gKiBjYWxsIHRvIHtAbGluayBkaXNhYmxlTmV0d29ya30uXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCBvbmNlIHRoZSBuZXR3b3JrIGhhcyBiZWVuIGVuYWJsZWQuXG4gKi8gZnVuY3Rpb24gX2godCkge1xuICAgIHJldHVybiBRYSh1aCh0ID0gZmEodCwgaWgpKSk7XG59XG5cbi8qKlxuICogRGlzYWJsZXMgbmV0d29yayB1c2FnZSBmb3IgdGhpcyBpbnN0YW5jZS4gSXQgY2FuIGJlIHJlLWVuYWJsZWQgdmlhIHtAbGlua1xuICogZW5hYmxlTmV0d29ya30uIFdoaWxlIHRoZSBuZXR3b3JrIGlzIGRpc2FibGVkLCBhbnkgc25hcHNob3QgbGlzdGVuZXJzLFxuICogYGdldERvYygpYCBvciBgZ2V0RG9jcygpYCBjYWxscyB3aWxsIHJldHVybiByZXN1bHRzIGZyb20gY2FjaGUsIGFuZCBhbnkgd3JpdGVcbiAqIG9wZXJhdGlvbnMgd2lsbCBiZSBxdWV1ZWQgdW50aWwgdGhlIG5ldHdvcmsgaXMgcmVzdG9yZWQuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCBvbmNlIHRoZSBuZXR3b3JrIGhhcyBiZWVuIGRpc2FibGVkLlxuICovIGZ1bmN0aW9uIHdoKHQpIHtcbiAgICByZXR1cm4gamEodWgodCA9IGZhKHQsIGloKSkpO1xufVxuXG4vKipcbiAqIFRlcm1pbmF0ZXMgdGhlIHByb3ZpZGVkIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlLlxuICpcbiAqIEFmdGVyIGNhbGxpbmcgYHRlcm1pbmF0ZSgpYCBvbmx5IHRoZSBgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCBmdW5jdGlvblxuICogbWF5IGJlIHVzZWQuIEFueSBvdGhlciBmdW5jdGlvbiB3aWxsIHRocm93IGEgYEZpcmVzdG9yZUVycm9yYC5cbiAqXG4gKiBUbyByZXN0YXJ0IGFmdGVyIHRlcm1pbmF0aW9uLCBjcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgRmlyZWJhc2VGaXJlc3RvcmUgd2l0aFxuICoge0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9LlxuICpcbiAqIFRlcm1pbmF0aW9uIGRvZXMgbm90IGNhbmNlbCBhbnkgcGVuZGluZyB3cml0ZXMsIGFuZCBhbnkgcHJvbWlzZXMgdGhhdCBhcmVcbiAqIGF3YWl0aW5nIGEgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIHdpbGwgbm90IGJlIHJlc29sdmVkLiBJZiB5b3UgaGF2ZVxuICogcGVyc2lzdGVuY2UgZW5hYmxlZCwgdGhlIG5leHQgdGltZSB5b3Ugc3RhcnQgdGhpcyBpbnN0YW5jZSwgaXQgd2lsbCByZXN1bWVcbiAqIHNlbmRpbmcgdGhlc2Ugd3JpdGVzIHRvIHRoZSBzZXJ2ZXIuXG4gKlxuICogTm90ZTogVW5kZXIgbm9ybWFsIGNpcmN1bXN0YW5jZXMsIGNhbGxpbmcgYHRlcm1pbmF0ZSgpYCBpcyBub3QgcmVxdWlyZWQuIFRoaXNcbiAqIGZ1bmN0aW9uIGlzIHVzZWZ1bCBvbmx5IHdoZW4geW91IHdhbnQgdG8gZm9yY2UgdGhpcyBpbnN0YW5jZSB0byByZWxlYXNlIGFsbFxuICogb2YgaXRzIHJlc291cmNlcyBvciBpbiBjb21iaW5hdGlvbiB3aXRoIGBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlKClgIHRvXG4gKiBlbnN1cmUgdGhhdCBhbGwgbG9jYWwgc3RhdGUgaXMgZGVzdHJveWVkIGJldHdlZW4gdGVzdCBydW5zLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgd2hlbiB0aGUgaW5zdGFuY2UgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5XG4gKiB0ZXJtaW5hdGVkLlxuICovIGZ1bmN0aW9uIG1oKHQpIHtcbiAgICByZXR1cm4gX3JlbW92ZVNlcnZpY2VJbnN0YW5jZSh0LmFwcCwgXCJmaXJlc3RvcmVcIiwgdC5fZGF0YWJhc2VJZC5kYXRhYmFzZSksIHQuX2RlbGV0ZSgpO1xufVxuXG4vKipcbiAqIExvYWRzIGEgRmlyZXN0b3JlIGJ1bmRsZSBpbnRvIHRoZSBsb2NhbCBjYWNoZS5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGxvYWQgYnVuZGxlcyBmb3IuXG4gKiBAcGFyYW0gYnVuZGxlRGF0YSAtIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGJ1bmRsZSB0byBiZSBsb2FkZWQuIFZhbGlkXG4gKiBvYmplY3RzIGFyZSBgQXJyYXlCdWZmZXJgLCBgUmVhZGFibGVTdHJlYW08VWludDhBcnJheT5gIG9yIGBzdHJpbmdgLlxuICpcbiAqIEByZXR1cm5zIEEgYExvYWRCdW5kbGVUYXNrYCBvYmplY3QsIHdoaWNoIG5vdGlmaWVzIGNhbGxlcnMgd2l0aCBwcm9ncmVzc1xuICogdXBkYXRlcywgYW5kIGNvbXBsZXRpb24gb3IgZXJyb3IgZXZlbnRzLiBJdCBjYW4gYmUgdXNlZCBhcyBhXG4gKiBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPmAuXG4gKi8gZnVuY3Rpb24gZ2godCwgZSkge1xuICAgIGNvbnN0IG4gPSB1aCh0ID0gZmEodCwgaWgpKSwgcyA9IG5ldyBuaDtcbiAgICByZXR1cm4gWGEobiwgdC5fZGF0YWJhc2VJZCwgZSwgcyksIHM7XG59XG5cbi8qKlxuICogUmVhZHMgYSBGaXJlc3RvcmUge0BsaW5rIFF1ZXJ5fSBmcm9tIGxvY2FsIGNhY2hlLCBpZGVudGlmaWVkIGJ5IHRoZSBnaXZlblxuICogbmFtZS5cbiAqXG4gKiBUaGUgbmFtZWQgcXVlcmllcyBhcmUgcGFja2FnZWQgIGludG8gYnVuZGxlcyBvbiB0aGUgc2VydmVyIHNpZGUgKGFsb25nXG4gKiB3aXRoIHJlc3VsdGluZyBkb2N1bWVudHMpLCBhbmQgbG9hZGVkIHRvIGxvY2FsIGNhY2hlIHVzaW5nIGBsb2FkQnVuZGxlYC4gT25jZVxuICogaW4gbG9jYWwgY2FjaGUsIHVzZSB0aGlzIG1ldGhvZCB0byBleHRyYWN0IGEge0BsaW5rIFF1ZXJ5fSBieSBuYW1lLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gcmVhZCB0aGUgcXVlcnkgZnJvbS5cbiAqIEBwYXJhbSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHF1ZXJ5LlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCB3aXRoIHRoZSBRdWVyeSBvciBgbnVsbGAuXG4gKi8gZnVuY3Rpb24geWgodCwgZSkge1xuICAgIHJldHVybiBaYSh1aCh0ID0gZmEodCwgaWgpKSwgZSkudGhlbigoZSA9PiBlID8gbmV3IHBhKHQsIG51bGwsIGUucXVlcnkpIDogbnVsbCkpO1xufVxuXG5mdW5jdGlvbiBwaCh0KSB7XG4gICAgaWYgKHQuX2luaXRpYWxpemVkIHx8IHQuX3Rlcm1pbmF0ZWQpIHRocm93IG5ldyBMKEIuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJGaXJlc3RvcmUgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkIGFuZCBwZXJzaXN0ZW5jZSBjYW4gbm8gbG9uZ2VyIGJlIGVuYWJsZWQuIFlvdSBjYW4gb25seSBlbmFibGUgcGVyc2lzdGVuY2UgYmVmb3JlIGNhbGxpbmcgYW55IG90aGVyIG1ldGhvZHMgb24gYSBGaXJlc3RvcmUgb2JqZWN0LlwiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGFuIGFycmF5IG9mIGJ5dGVzLlxuICovXG5jbGFzcyBJaCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuX2J5dGVTdHJpbmcgPSB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGBCeXRlc2Agb2JqZWN0IGZyb20gdGhlIGdpdmVuIEJhc2U2NCBzdHJpbmcsIGNvbnZlcnRpbmcgaXQgdG9cbiAgICAgKiBieXRlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBiYXNlNjQgLSBUaGUgQmFzZTY0IHN0cmluZyB1c2VkIHRvIGNyZWF0ZSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHN0YXRpYyBmcm9tQmFzZTY0U3RyaW5nKHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgSWgoUXQuZnJvbUJhc2U2NFN0cmluZyh0KSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJGYWlsZWQgdG8gY29uc3RydWN0IGRhdGEgZnJvbSBCYXNlNjQgc3RyaW5nOiBcIiArIHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgYEJ5dGVzYCBvYmplY3QgZnJvbSB0aGUgZ2l2ZW4gVWludDhBcnJheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhcnJheSAtIFRoZSBVaW50OEFycmF5IHVzZWQgdG8gY3JlYXRlIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21VaW50OEFycmF5KHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJaChRdC5mcm9tVWludDhBcnJheSh0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHVuZGVybHlpbmcgYnl0ZXMgYXMgYSBCYXNlNjQtZW5jb2RlZCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgQmFzZTY0LWVuY29kZWQgc3RyaW5nIGNyZWF0ZWQgZnJvbSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHRvQmFzZTY0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZVN0cmluZy50b0Jhc2U2NCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB1bmRlcmx5aW5nIGJ5dGVzIGluIGEgbmV3IGBVaW50OEFycmF5YC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBVaW50OEFycmF5IGNyZWF0ZWQgZnJvbSB0aGUgYEJ5dGVzYCBvYmplY3QuXG4gICAgICovICAgIHRvVWludDhBcnJheSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J5dGVTdHJpbmcudG9VaW50OEFycmF5KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMgQSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIFwiQnl0ZXMoYmFzZTY0OiBcIiArIHRoaXMudG9CYXNlNjQoKSArIFwiKVwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgQnl0ZXNgIG9iamVjdCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBCeXRlc2Agb2JqZWN0IHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYEJ5dGVzYCBvYmplY3QgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ieXRlU3RyaW5nLmlzRXF1YWwodC5fYnl0ZVN0cmluZyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBGaWVsZFBhdGhgIHJlZmVycyB0byBhIGZpZWxkIGluIGEgZG9jdW1lbnQuIFRoZSBwYXRoIG1heSBjb25zaXN0IG9mIGFcbiAqIHNpbmdsZSBmaWVsZCBuYW1lIChyZWZlcnJpbmcgdG8gYSB0b3AtbGV2ZWwgZmllbGQgaW4gdGhlIGRvY3VtZW50KSwgb3IgYVxuICogbGlzdCBvZiBmaWVsZCBuYW1lcyAocmVmZXJyaW5nIHRvIGEgbmVzdGVkIGZpZWxkIGluIHRoZSBkb2N1bWVudCkuXG4gKlxuICogQ3JlYXRlIGEgYEZpZWxkUGF0aGAgYnkgcHJvdmlkaW5nIGZpZWxkIG5hbWVzLiBJZiBtb3JlIHRoYW4gb25lIGZpZWxkXG4gKiBuYW1lIGlzIHByb3ZpZGVkLCB0aGUgcGF0aCB3aWxsIHBvaW50IHRvIGEgbmVzdGVkIGZpZWxkIGluIGEgZG9jdW1lbnQuXG4gKi8gY2xhc3MgVGgge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBgRmllbGRQYXRoYCBmcm9tIHRoZSBwcm92aWRlZCBmaWVsZCBuYW1lcy4gSWYgbW9yZSB0aGFuIG9uZSBmaWVsZFxuICAgICAqIG5hbWUgaXMgcHJvdmlkZWQsIHRoZSBwYXRoIHdpbGwgcG9pbnQgdG8gYSBuZXN0ZWQgZmllbGQgaW4gYSBkb2N1bWVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWVsZE5hbWVzIC0gQSBsaXN0IG9mIGZpZWxkIG5hbWVzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKC4uLnQpIHtcbiAgICAgICAgZm9yIChsZXQgZSA9IDA7IGUgPCB0Lmxlbmd0aDsgKytlKSBpZiAoMCA9PT0gdFtlXS5sZW5ndGgpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIGZpZWxkIG5hbWUgYXQgYXJndW1lbnQgJChpICsgMSkuIEZpZWxkIG5hbWVzIG11c3Qgbm90IGJlIGVtcHR5LlwiKTtcbiAgICAgICAgdGhpcy5faW50ZXJuYWxQYXRoID0gbmV3IHV0KHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgRmllbGRQYXRoYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBGaWVsZFBhdGhgIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYEZpZWxkUGF0aGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnRlcm5hbFBhdGguaXNFcXVhbCh0Ll9pbnRlcm5hbFBhdGgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCBzZW50aW5lbCBgRmllbGRQYXRoYCB0byByZWZlciB0byB0aGUgSUQgb2YgYSBkb2N1bWVudC5cbiAqIEl0IGNhbiBiZSB1c2VkIGluIHF1ZXJpZXMgdG8gc29ydCBvciBmaWx0ZXIgYnkgdGhlIGRvY3VtZW50IElELlxuICovIGZ1bmN0aW9uIEVoKCkge1xuICAgIHJldHVybiBuZXcgVGgoXCJfX25hbWVfX1wiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogU2VudGluZWwgdmFsdWVzIHRoYXQgY2FuIGJlIHVzZWQgd2hlbiB3cml0aW5nIGRvY3VtZW50IGZpZWxkcyB3aXRoIGBzZXQoKWBcbiAqIG9yIGB1cGRhdGUoKWAuXG4gKi8gY2xhc3MgQWgge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBfbWV0aG9kTmFtZSAtIFRoZSBwdWJsaWMgQVBJIGVuZHBvaW50IHRoYXQgcmV0dXJucyB0aGlzIGNsYXNzLlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHRoaXMuX21ldGhvZE5hbWUgPSB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW1tdXRhYmxlIG9iamVjdCByZXByZXNlbnRpbmcgYSBnZW9ncmFwaGljIGxvY2F0aW9uIGluIEZpcmVzdG9yZS4gVGhlXG4gKiBsb2NhdGlvbiBpcyByZXByZXNlbnRlZCBhcyBsYXRpdHVkZS9sb25naXR1ZGUgcGFpci5cbiAqXG4gKiBMYXRpdHVkZSB2YWx1ZXMgYXJlIGluIHRoZSByYW5nZSBvZiBbLTkwLCA5MF0uXG4gKiBMb25naXR1ZGUgdmFsdWVzIGFyZSBpbiB0aGUgcmFuZ2Ugb2YgWy0xODAsIDE4MF0uXG4gKi8gY2xhc3MgUmgge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW1tdXRhYmxlIGBHZW9Qb2ludGAgb2JqZWN0IHdpdGggdGhlIHByb3ZpZGVkIGxhdGl0dWRlIGFuZFxuICAgICAqIGxvbmdpdHVkZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIGxhdGl0dWRlIC0gVGhlIGxhdGl0dWRlIGFzIG51bWJlciBiZXR3ZWVuIC05MCBhbmQgOTAuXG4gICAgICogQHBhcmFtIGxvbmdpdHVkZSAtIFRoZSBsb25naXR1ZGUgYXMgbnVtYmVyIGJldHdlZW4gLTE4MCBhbmQgMTgwLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgaWYgKCFpc0Zpbml0ZSh0KSB8fCB0IDwgLTkwIHx8IHQgPiA5MCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIkxhdGl0dWRlIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAtOTAgYW5kIDkwLCBidXQgd2FzOiBcIiArIHQpO1xuICAgICAgICBpZiAoIWlzRmluaXRlKGUpIHx8IGUgPCAtMTgwIHx8IGUgPiAxODApIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJMb25naXR1ZGUgbXVzdCBiZSBhIG51bWJlciBiZXR3ZWVuIC0xODAgYW5kIDE4MCwgYnV0IHdhczogXCIgKyBlKTtcbiAgICAgICAgdGhpcy5fbGF0ID0gdCwgdGhpcy5fbG9uZyA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBsYXRpdHVkZSBvZiB0aGlzIGBHZW9Qb2ludGAgaW5zdGFuY2UuXG4gICAgICovICAgIGdldCBsYXRpdHVkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGxvbmdpdHVkZSBvZiB0aGlzIGBHZW9Qb2ludGAgaW5zdGFuY2UuXG4gICAgICovICAgIGdldCBsb25naXR1ZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb25nO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgR2VvUG9pbnRgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYEdlb1BvaW50YCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBHZW9Qb2ludGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sYXQgPT09IHQuX2xhdCAmJiB0aGlzLl9sb25nID09PSB0Ll9sb25nO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgR2VvUG9pbnQuICovICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGxhdGl0dWRlOiB0aGlzLl9sYXQsXG4gICAgICAgICAgICBsb25naXR1ZGU6IHRoaXMuX2xvbmdcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWN0dWFsbHkgcHJpdmF0ZSB0byBKUyBjb25zdW1lcnMgb2Ygb3VyIEFQSSwgc28gdGhpcyBmdW5jdGlvbiBpcyBwcmVmaXhlZFxuICAgICAqIHdpdGggYW4gdW5kZXJzY29yZS5cbiAgICAgKi8gICAgX2NvbXBhcmVUbyh0KSB7XG4gICAgICAgIHJldHVybiBaKHRoaXMuX2xhdCwgdC5fbGF0KSB8fCBaKHRoaXMuX2xvbmcsIHQuX2xvbmcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgYmggPSAvXl9fLipfXyQvO1xuXG4vKiogVGhlIHJlc3VsdCBvZiBwYXJzaW5nIGRvY3VtZW50IGRhdGEgKGUuZy4gZm9yIGEgc2V0RGF0YSBjYWxsKS4gKi8gY2xhc3MgUGgge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5kYXRhID0gdCwgdGhpcy5maWVsZE1hc2sgPSBlLCB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IG47XG4gICAgfVxuICAgIHRvTXV0YXRpb24odCwgZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5maWVsZE1hc2sgPyBuZXcgdHModCwgdGhpcy5kYXRhLCB0aGlzLmZpZWxkTWFzaywgZSwgdGhpcy5maWVsZFRyYW5zZm9ybXMpIDogbmV3IFpuKHQsIHRoaXMuZGF0YSwgZSwgdGhpcy5maWVsZFRyYW5zZm9ybXMpO1xuICAgIH1cbn1cblxuLyoqIFRoZSByZXN1bHQgb2YgcGFyc2luZyBcInVwZGF0ZVwiIGRhdGEgKGkuZS4gZm9yIGFuIHVwZGF0ZURhdGEgY2FsbCkuICovIGNsYXNzIHZoIHtcbiAgICBjb25zdHJ1Y3Rvcih0LCBcbiAgICAvLyBUaGUgZmllbGRNYXNrIGRvZXMgbm90IGluY2x1ZGUgZG9jdW1lbnQgdHJhbnNmb3Jtcy5cbiAgICBlLCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IHQsIHRoaXMuZmllbGRNYXNrID0gZSwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBuO1xuICAgIH1cbiAgICB0b011dGF0aW9uKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB0cyh0LCB0aGlzLmRhdGEsIHRoaXMuZmllbGRNYXNrLCBlLCB0aGlzLmZpZWxkVHJhbnNmb3Jtcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBWaCh0KSB7XG4gICAgc3dpdGNoICh0KSB7XG4gICAgICBjYXNlIDAgLyogVXNlckRhdGFTb3VyY2UuU2V0ICovIDpcbiAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgICAgY2FzZSAyIC8qIFVzZXJEYXRhU291cmNlLk1lcmdlU2V0ICovIDpcbiAvLyBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgICAgY2FzZSAxIC8qIFVzZXJEYXRhU291cmNlLlVwZGF0ZSAqLyA6XG4gICAgICAgIHJldHVybiAhMDtcblxuICAgICAgY2FzZSAzIC8qIFVzZXJEYXRhU291cmNlLkFyZ3VtZW50ICovIDpcbiAgICAgIGNhc2UgNCAvKiBVc2VyRGF0YVNvdXJjZS5BcnJheUFyZ3VtZW50ICovIDpcbiAgICAgICAgcmV0dXJuICExO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBPKCk7XG4gICAgfVxufVxuXG4vKiogQSBcImNvbnRleHRcIiBvYmplY3QgcGFzc2VkIGFyb3VuZCB3aGlsZSBwYXJzaW5nIHVzZXIgZGF0YS4gKi8gY2xhc3MgU2gge1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIGEgUGFyc2VDb250ZXh0IHdpdGggdGhlIGdpdmVuIHNvdXJjZSBhbmQgcGF0aC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZXR0aW5ncyAtIFRoZSBzZXR0aW5ncyBmb3IgdGhlIHBhcnNlci5cbiAgICAgKiBAcGFyYW0gZGF0YWJhc2VJZCAtIFRoZSBkYXRhYmFzZSBJRCBvZiB0aGUgRmlyZXN0b3JlIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIHNlcmlhbGl6ZXIgdG8gdXNlIHRvIGdlbmVyYXRlIHRoZSBWYWx1ZSBwcm90by5cbiAgICAgKiBAcGFyYW0gaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyAtIFdoZXRoZXIgdG8gaWdub3JlIHVuZGVmaW5lZCBwcm9wZXJ0aWVzXG4gICAgICogcmF0aGVyIHRoYW4gdGhyb3cuXG4gICAgICogQHBhcmFtIGZpZWxkVHJhbnNmb3JtcyAtIEEgbXV0YWJsZSBsaXN0IG9mIGZpZWxkIHRyYW5zZm9ybXMgZW5jb3VudGVyZWRcbiAgICAgKiB3aGlsZSBwYXJzaW5nIHRoZSBkYXRhLlxuICAgICAqIEBwYXJhbSBmaWVsZE1hc2sgLSBBIG11dGFibGUgbGlzdCBvZiBmaWVsZCBwYXRocyBlbmNvdW50ZXJlZCB3aGlsZSBwYXJzaW5nXG4gICAgICogdGhlIGRhdGEuXG4gICAgICpcbiAgICAgKiBUT0RPKGIvMzQ4NzExMzEpOiBXZSBkb24ndCBzdXBwb3J0IGFycmF5IHBhdGhzIHJpZ2h0IG5vdywgc28gcGF0aCBjYW4gYmVcbiAgICAgKiBudWxsIHRvIGluZGljYXRlIHRoZSBjb250ZXh0IHJlcHJlc2VudHMgYW55IGxvY2F0aW9uIHdpdGhpbiBhbiBhcnJheSAoaW5cbiAgICAgKiB3aGljaCBjYXNlIGNlcnRhaW4gZmVhdHVyZXMgd2lsbCBub3Qgd29yayBhbmQgZXJyb3JzIHdpbGwgYmUgc29tZXdoYXRcbiAgICAgKiBjb21wcm9taXNlZCkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSwgcikge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gdCwgdGhpcy5kYXRhYmFzZUlkID0gZSwgdGhpcy55dCA9IG4sIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHMsIFxuICAgICAgICAvLyBNaW5vciBoYWNrOiBJZiBmaWVsZFRyYW5zZm9ybXMgaXMgdW5kZWZpbmVkLCB3ZSBhc3N1bWUgdGhpcyBpcyBhblxuICAgICAgICAvLyBleHRlcm5hbCBjYWxsIGFuZCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBlbnRpcmUgcGF0aC5cbiAgICAgICAgdm9pZCAwID09PSBpICYmIHRoaXMubmEoKSwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBpIHx8IFtdLCB0aGlzLmZpZWxkTWFzayA9IHIgfHwgW107XG4gICAgfVxuICAgIGdldCBwYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5wYXRoO1xuICAgIH1cbiAgICBnZXQgc2EoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnNhO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG5ldyBjb250ZXh0IHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncyBvdmVyd3JpdHRlbi4gKi8gICAgaWEodCkge1xuICAgICAgICByZXR1cm4gbmV3IFNoKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zZXR0aW5ncyksIHQpLCB0aGlzLmRhdGFiYXNlSWQsIHRoaXMueXQsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcywgdGhpcy5maWVsZFRyYW5zZm9ybXMsIHRoaXMuZmllbGRNYXNrKTtcbiAgICB9XG4gICAgcmEodCkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgY29uc3QgbiA9IG51bGwgPT09IChlID0gdGhpcy5wYXRoKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLmNoaWxkKHQpLCBzID0gdGhpcy5pYSh7XG4gICAgICAgICAgICBwYXRoOiBuLFxuICAgICAgICAgICAgb2E6ICExXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcy51YSh0KSwgcztcbiAgICB9XG4gICAgY2EodCkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgY29uc3QgbiA9IG51bGwgPT09IChlID0gdGhpcy5wYXRoKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLmNoaWxkKHQpLCBzID0gdGhpcy5pYSh7XG4gICAgICAgICAgICBwYXRoOiBuLFxuICAgICAgICAgICAgb2E6ICExXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcy5uYSgpLCBzO1xuICAgIH1cbiAgICBhYSh0KSB7XG4gICAgICAgIC8vIFRPRE8oYi8zNDg3MTEzMSk6IFdlIGRvbid0IHN1cHBvcnQgYXJyYXkgcGF0aHMgcmlnaHQgbm93OyBzbyBtYWtlIHBhdGhcbiAgICAgICAgLy8gdW5kZWZpbmVkLlxuICAgICAgICByZXR1cm4gdGhpcy5pYSh7XG4gICAgICAgICAgICBwYXRoOiB2b2lkIDAsXG4gICAgICAgICAgICBvYTogITBcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGhhKHQpIHtcbiAgICAgICAgcmV0dXJuIEhoKHQsIHRoaXMuc2V0dGluZ3MubWV0aG9kTmFtZSwgdGhpcy5zZXR0aW5ncy5sYSB8fCAhMSwgdGhpcy5wYXRoLCB0aGlzLnNldHRpbmdzLmZhKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgJ3RydWUnIGlmICdmaWVsZFBhdGgnIHdhcyB0cmF2ZXJzZWQgd2hlbiBjcmVhdGluZyB0aGlzIGNvbnRleHQuICovICAgIGNvbnRhaW5zKHQpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5maWVsZE1hc2suZmluZCgoZSA9PiB0LmlzUHJlZml4T2YoZSkpKSB8fCB2b2lkIDAgIT09IHRoaXMuZmllbGRUcmFuc2Zvcm1zLmZpbmQoKGUgPT4gdC5pc1ByZWZpeE9mKGUuZmllbGQpKSk7XG4gICAgfVxuICAgIG5hKCkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBSZW1vdmUgbnVsbCBjaGVjayBvbmNlIHdlIGhhdmUgcHJvcGVyIHBhdGhzIGZvciBmaWVsZHNcbiAgICAgICAgLy8gd2l0aGluIGFycmF5cy5cbiAgICAgICAgaWYgKHRoaXMucGF0aCkgZm9yIChsZXQgdCA9IDA7IHQgPCB0aGlzLnBhdGgubGVuZ3RoOyB0KyspIHRoaXMudWEodGhpcy5wYXRoLmdldCh0KSk7XG4gICAgfVxuICAgIHVhKHQpIHtcbiAgICAgICAgaWYgKDAgPT09IHQubGVuZ3RoKSB0aHJvdyB0aGlzLmhhKFwiRG9jdW1lbnQgZmllbGRzIG11c3Qgbm90IGJlIGVtcHR5XCIpO1xuICAgICAgICBpZiAoVmgodGhpcy5zYSkgJiYgYmgudGVzdCh0KSkgdGhyb3cgdGhpcy5oYSgnRG9jdW1lbnQgZmllbGRzIGNhbm5vdCBiZWdpbiBhbmQgZW5kIHdpdGggXCJfX1wiJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciBmb3IgcGFyc2luZyByYXcgdXNlciBpbnB1dCAocHJvdmlkZWQgdmlhIHRoZSBBUEkpIGludG8gaW50ZXJuYWwgbW9kZWxcbiAqIGNsYXNzZXMuXG4gKi8gY2xhc3MgRGgge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gdCwgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzID0gZSwgdGhpcy55dCA9IG4gfHwgcHUodCk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRvcC1sZXZlbCBwYXJzZSBjb250ZXh0LiAqLyAgICBkYSh0LCBlLCBuLCBzID0gITEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTaCh7XG4gICAgICAgICAgICBzYTogdCxcbiAgICAgICAgICAgIG1ldGhvZE5hbWU6IGUsXG4gICAgICAgICAgICBmYTogbixcbiAgICAgICAgICAgIHBhdGg6IHV0LmVtcHR5UGF0aCgpLFxuICAgICAgICAgICAgb2E6ICExLFxuICAgICAgICAgICAgbGE6IHNcbiAgICAgICAgfSwgdGhpcy5kYXRhYmFzZUlkLCB0aGlzLnl0LCB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gQ2godCkge1xuICAgIGNvbnN0IGUgPSB0Ll9mcmVlemVTZXR0aW5ncygpLCBuID0gcHUodC5fZGF0YWJhc2VJZCk7XG4gICAgcmV0dXJuIG5ldyBEaCh0Ll9kYXRhYmFzZUlkLCAhIWUuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcywgbik7XG59XG5cbi8qKiBQYXJzZSBkb2N1bWVudCBkYXRhIGZyb20gYSBzZXQoKSBjYWxsLiAqLyBmdW5jdGlvbiB4aCh0LCBlLCBuLCBzLCBpLCByID0ge30pIHtcbiAgICBjb25zdCBvID0gdC5kYShyLm1lcmdlIHx8IHIubWVyZ2VGaWVsZHMgPyAyIC8qIFVzZXJEYXRhU291cmNlLk1lcmdlU2V0ICovIDogMCAvKiBVc2VyRGF0YVNvdXJjZS5TZXQgKi8gLCBlLCBuLCBpKTtcbiAgICBRaChcIkRhdGEgbXVzdCBiZSBhbiBvYmplY3QsIGJ1dCBpdCB3YXM6XCIsIG8sIHMpO1xuICAgIGNvbnN0IHUgPSBLaChzLCBvKTtcbiAgICBsZXQgYywgYTtcbiAgICBpZiAoci5tZXJnZSkgYyA9IG5ldyBKZShvLmZpZWxkTWFzayksIGEgPSBvLmZpZWxkVHJhbnNmb3JtczsgZWxzZSBpZiAoci5tZXJnZUZpZWxkcykge1xuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgcyBvZiByLm1lcmdlRmllbGRzKSB7XG4gICAgICAgICAgICBjb25zdCBpID0gamgoZSwgcywgbik7XG4gICAgICAgICAgICBpZiAoIW8uY29udGFpbnMoaSkpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEZpZWxkICcke2l9JyBpcyBzcGVjaWZpZWQgaW4geW91ciBmaWVsZCBtYXNrIGJ1dCBtaXNzaW5nIGZyb20geW91ciBpbnB1dCBkYXRhLmApO1xuICAgICAgICAgICAgSmgodCwgaSkgfHwgdC5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgICAgIGMgPSBuZXcgSmUodCksIGEgPSBvLmZpZWxkVHJhbnNmb3Jtcy5maWx0ZXIoKHQgPT4gYy5jb3ZlcnModC5maWVsZCkpKTtcbiAgICB9IGVsc2UgYyA9IG51bGwsIGEgPSBvLmZpZWxkVHJhbnNmb3JtcztcbiAgICByZXR1cm4gbmV3IFBoKG5ldyBZZSh1KSwgYywgYSk7XG59XG5cbmNsYXNzIE5oIGV4dGVuZHMgQWgge1xuICAgIF90b0ZpZWxkVHJhbnNmb3JtKHQpIHtcbiAgICAgICAgaWYgKDIgLyogVXNlckRhdGFTb3VyY2UuTWVyZ2VTZXQgKi8gIT09IHQuc2EpIHRocm93IDEgLyogVXNlckRhdGFTb3VyY2UuVXBkYXRlICovID09PSB0LnNhID8gdC5oYShgJHt0aGlzLl9tZXRob2ROYW1lfSgpIGNhbiBvbmx5IGFwcGVhciBhdCB0aGUgdG9wIGxldmVsIG9mIHlvdXIgdXBkYXRlIGRhdGFgKSA6IHQuaGEoYCR7dGhpcy5fbWV0aG9kTmFtZX0oKSBjYW5ub3QgYmUgdXNlZCB3aXRoIHNldCgpIHVubGVzcyB5b3UgcGFzcyB7bWVyZ2U6dHJ1ZX1gKTtcbiAgICAgICAgLy8gTm8gdHJhbnNmb3JtIHRvIGFkZCBmb3IgYSBkZWxldGUsIGJ1dCB3ZSBuZWVkIHRvIGFkZCBpdCB0byBvdXJcbiAgICAgICAgLy8gZmllbGRNYXNrIHNvIGl0IGdldHMgZGVsZXRlZC5cbiAgICAgICAgcmV0dXJuIHQuZmllbGRNYXNrLnB1c2godC5wYXRoKSwgbnVsbDtcbiAgICB9XG4gICAgaXNFcXVhbCh0KSB7XG4gICAgICAgIHJldHVybiB0IGluc3RhbmNlb2YgTmg7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBjaGlsZCBjb250ZXh0IGZvciBwYXJzaW5nIFNlcmlhbGl6YWJsZUZpZWxkVmFsdWVzLlxuICpcbiAqIFRoaXMgaXMgZGlmZmVyZW50IHRoYW4gY2FsbGluZyBgUGFyc2VDb250ZXh0LmNvbnRleHRXaXRoYCBiZWNhdXNlIGl0IGtlZXBzXG4gKiB0aGUgZmllbGRUcmFuc2Zvcm1zIGFuZCBmaWVsZE1hc2sgc2VwYXJhdGUuXG4gKlxuICogVGhlIGNyZWF0ZWQgY29udGV4dCBoYXMgaXRzIGBkYXRhU291cmNlYCBzZXQgdG8gYFVzZXJEYXRhU291cmNlLkFyZ3VtZW50YC5cbiAqIEFsdGhvdWdoIHRoZXNlIHZhbHVlcyBhcmUgdXNlZCB3aXRoIHdyaXRlcywgYW55IGVsZW1lbnRzIGluIHRoZXNlIEZpZWxkVmFsdWVzXG4gKiBhcmUgbm90IGNvbnNpZGVyZWQgd3JpdGVzIHNpbmNlIHRoZXkgY2Fubm90IGNvbnRhaW4gYW55IEZpZWxkVmFsdWUgc2VudGluZWxzLFxuICogZXRjLlxuICpcbiAqIEBwYXJhbSBmaWVsZFZhbHVlIC0gVGhlIHNlbnRpbmVsIEZpZWxkVmFsdWUgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIGNoaWxkXG4gKiAgICAgY29udGV4dC5cbiAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIHBhcmVudCBjb250ZXh0LlxuICogQHBhcmFtIGFycmF5RWxlbWVudCAtIFdoZXRoZXIgb3Igbm90IHRoZSBGaWVsZFZhbHVlIGhhcyBhbiBhcnJheS5cbiAqLyBmdW5jdGlvbiBraCh0LCBlLCBuKSB7XG4gICAgcmV0dXJuIG5ldyBTaCh7XG4gICAgICAgIHNhOiAzIC8qIFVzZXJEYXRhU291cmNlLkFyZ3VtZW50ICovICxcbiAgICAgICAgZmE6IGUuc2V0dGluZ3MuZmEsXG4gICAgICAgIG1ldGhvZE5hbWU6IHQuX21ldGhvZE5hbWUsXG4gICAgICAgIG9hOiBuXG4gICAgfSwgZS5kYXRhYmFzZUlkLCBlLnl0LCBlLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMpO1xufVxuXG5jbGFzcyBPaCBleHRlbmRzIEFoIHtcbiAgICBfdG9GaWVsZFRyYW5zZm9ybSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgVW4odC5wYXRoLCBuZXcga24pO1xuICAgIH1cbiAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBPaDtcbiAgICB9XG59XG5cbmNsYXNzIE1oIGV4dGVuZHMgQWgge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCksIHRoaXMuX2EgPSBlO1xuICAgIH1cbiAgICBfdG9GaWVsZFRyYW5zZm9ybSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBraCh0aGlzLCB0LCBcbiAgICAgICAgLyphcnJheT0qLyAhMCksIG4gPSB0aGlzLl9hLm1hcCgodCA9PiBVaCh0LCBlKSkpLCBzID0gbmV3IE9uKG4pO1xuICAgICAgICByZXR1cm4gbmV3IFVuKHQucGF0aCwgcyk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICAvLyBUT0RPKG1yc2NobWlkdCk6IEltcGxlbWVudCBpc0VxdWFsc1xuICAgICAgICByZXR1cm4gdGhpcyA9PT0gdDtcbiAgICB9XG59XG5cbmNsYXNzIEZoIGV4dGVuZHMgQWgge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCksIHRoaXMuX2EgPSBlO1xuICAgIH1cbiAgICBfdG9GaWVsZFRyYW5zZm9ybSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBraCh0aGlzLCB0LCBcbiAgICAgICAgLyphcnJheT0qLyAhMCksIG4gPSB0aGlzLl9hLm1hcCgodCA9PiBVaCh0LCBlKSkpLCBzID0gbmV3IEZuKG4pO1xuICAgICAgICByZXR1cm4gbmV3IFVuKHQucGF0aCwgcyk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICAvLyBUT0RPKG1yc2NobWlkdCk6IEltcGxlbWVudCBpc0VxdWFsc1xuICAgICAgICByZXR1cm4gdGhpcyA9PT0gdDtcbiAgICB9XG59XG5cbmNsYXNzICRoIGV4dGVuZHMgQWgge1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgc3VwZXIodCksIHRoaXMud2EgPSBlO1xuICAgIH1cbiAgICBfdG9GaWVsZFRyYW5zZm9ybSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgQm4odC55dCwgU24odC55dCwgdGhpcy53YSkpO1xuICAgICAgICByZXR1cm4gbmV3IFVuKHQucGF0aCwgZSk7XG4gICAgfVxuICAgIGlzRXF1YWwodCkge1xuICAgICAgICAvLyBUT0RPKG1yc2NobWlkdCk6IEltcGxlbWVudCBpc0VxdWFsc1xuICAgICAgICByZXR1cm4gdGhpcyA9PT0gdDtcbiAgICB9XG59XG5cbi8qKiBQYXJzZSB1cGRhdGUgZGF0YSBmcm9tIGFuIHVwZGF0ZSgpIGNhbGwuICovIGZ1bmN0aW9uIEJoKHQsIGUsIG4sIHMpIHtcbiAgICBjb25zdCBpID0gdC5kYSgxIC8qIFVzZXJEYXRhU291cmNlLlVwZGF0ZSAqLyAsIGUsIG4pO1xuICAgIFFoKFwiRGF0YSBtdXN0IGJlIGFuIG9iamVjdCwgYnV0IGl0IHdhczpcIiwgaSwgcyk7XG4gICAgY29uc3QgciA9IFtdLCBvID0gWWUuZW1wdHkoKTtcbiAgICBCdChzLCAoKHQsIHMpID0+IHtcbiAgICAgICAgY29uc3QgdSA9IHpoKGUsIHQsIG4pO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgcyA9IGdldE1vZHVsYXJJbnN0YW5jZShzKTtcbiAgICAgICAgY29uc3QgYyA9IGkuY2EodSk7XG4gICAgICAgIGlmIChzIGluc3RhbmNlb2YgTmgpIFxuICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIGZpZWxkIG1hc2ssIGJ1dCBkb24ndCBhZGQgYW55dGhpbmcgdG8gdXBkYXRlRGF0YS5cbiAgICAgICAgci5wdXNoKHUpOyBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBVaChzLCBjKTtcbiAgICAgICAgICAgIG51bGwgIT0gdCAmJiAoci5wdXNoKHUpLCBvLnNldCh1LCB0KSk7XG4gICAgICAgIH1cbiAgICB9KSk7XG4gICAgY29uc3QgdSA9IG5ldyBKZShyKTtcbiAgICByZXR1cm4gbmV3IHZoKG8sIHUsIGkuZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYSBsaXN0IG9mIGZpZWxkL3ZhbHVlIGFyZ3VtZW50cy4gKi8gZnVuY3Rpb24gTGgodCwgZSwgbiwgcywgaSwgcikge1xuICAgIGNvbnN0IG8gPSB0LmRhKDEgLyogVXNlckRhdGFTb3VyY2UuVXBkYXRlICovICwgZSwgbiksIHUgPSBbIGpoKGUsIHMsIG4pIF0sIGMgPSBbIGkgXTtcbiAgICBpZiAoci5sZW5ndGggJSAyICE9IDApIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEZ1bmN0aW9uICR7ZX0oKSBuZWVkcyB0byBiZSBjYWxsZWQgd2l0aCBhbiBldmVuIG51bWJlciBvZiBhcmd1bWVudHMgdGhhdCBhbHRlcm5hdGUgYmV0d2VlbiBmaWVsZCBuYW1lcyBhbmQgdmFsdWVzLmApO1xuICAgIGZvciAobGV0IHQgPSAwOyB0IDwgci5sZW5ndGg7IHQgKz0gMikgdS5wdXNoKGpoKGUsIHJbdF0pKSwgYy5wdXNoKHJbdCArIDFdKTtcbiAgICBjb25zdCBhID0gW10sIGggPSBZZS5lbXB0eSgpO1xuICAgIC8vIFdlIGl0ZXJhdGUgaW4gcmV2ZXJzZSBvcmRlciB0byBwaWNrIHRoZSBsYXN0IHZhbHVlIGZvciBhIGZpZWxkIGlmIHRoZVxuICAgIC8vIHVzZXIgc3BlY2lmaWVkIHRoZSBmaWVsZCBtdWx0aXBsZSB0aW1lcy5cbiAgICBmb3IgKGxldCB0ID0gdS5sZW5ndGggLSAxOyB0ID49IDA7IC0tdCkgaWYgKCFKaChhLCB1W3RdKSkge1xuICAgICAgICBjb25zdCBlID0gdVt0XTtcbiAgICAgICAgbGV0IG4gPSBjW3RdO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgbiA9IGdldE1vZHVsYXJJbnN0YW5jZShuKTtcbiAgICAgICAgY29uc3QgcyA9IG8uY2EoZSk7XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgTmgpIFxuICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIGZpZWxkIG1hc2ssIGJ1dCBkb24ndCBhZGQgYW55dGhpbmcgdG8gdXBkYXRlRGF0YS5cbiAgICAgICAgYS5wdXNoKGUpOyBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBVaChuLCBzKTtcbiAgICAgICAgICAgIG51bGwgIT0gdCAmJiAoYS5wdXNoKGUpLCBoLnNldChlLCB0KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgbCA9IG5ldyBKZShhKTtcbiAgICByZXR1cm4gbmV3IHZoKGgsIGwsIG8uZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqXG4gKiBQYXJzZSBhIFwicXVlcnkgdmFsdWVcIiAoZS5nLiB2YWx1ZSBpbiBhIHdoZXJlIGZpbHRlciBvciBhIHZhbHVlIGluIGEgY3Vyc29yXG4gKiBib3VuZCkuXG4gKlxuICogQHBhcmFtIGFsbG93QXJyYXlzIC0gV2hldGhlciB0aGUgcXVlcnkgdmFsdWUgaXMgYW4gYXJyYXkgdGhhdCBtYXkgZGlyZWN0bHlcbiAqIGNvbnRhaW4gYWRkaXRpb25hbCBhcnJheXMgKGUuZy4gdGhlIG9wZXJhbmQgb2YgYW4gYGluYCBxdWVyeSkuXG4gKi8gZnVuY3Rpb24gcWgodCwgZSwgbiwgcyA9ICExKSB7XG4gICAgcmV0dXJuIFVoKG4sIHQuZGEocyA/IDQgLyogVXNlckRhdGFTb3VyY2UuQXJyYXlBcmd1bWVudCAqLyA6IDMgLyogVXNlckRhdGFTb3VyY2UuQXJndW1lbnQgKi8gLCBlKSk7XG59XG5cbi8qKlxuICogUGFyc2VzIHVzZXIgZGF0YSB0byBQcm90b2J1ZiBWYWx1ZXMuXG4gKlxuICogQHBhcmFtIGlucHV0IC0gRGF0YSB0byBiZSBwYXJzZWQuXG4gKiBAcGFyYW0gY29udGV4dCAtIEEgY29udGV4dCBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBjdXJyZW50IHBhdGggYmVpbmcgcGFyc2VkLFxuICogdGhlIHNvdXJjZSBvZiB0aGUgZGF0YSBiZWluZyBwYXJzZWQsIGV0Yy5cbiAqIEByZXR1cm5zIFRoZSBwYXJzZWQgdmFsdWUsIG9yIG51bGwgaWYgdGhlIHZhbHVlIHdhcyBhIEZpZWxkVmFsdWUgc2VudGluZWxcbiAqIHRoYXQgc2hvdWxkIG5vdCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0aW5nIHBhcnNlZCBkYXRhLlxuICovIGZ1bmN0aW9uIFVoKHQsIGUpIHtcbiAgICBpZiAoR2goXG4gICAgLy8gVW53cmFwIHRoZSBBUEkgdHlwZSBmcm9tIHRoZSBDb21wYXQgU0RLLiBUaGlzIHdpbGwgcmV0dXJuIHRoZSBBUEkgdHlwZVxuICAgIC8vIGZyb20gZmlyZXN0b3JlLWV4cC5cbiAgICB0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSkgcmV0dXJuIFFoKFwiVW5zdXBwb3J0ZWQgZmllbGQgdmFsdWU6XCIsIGUsIHQpLCBLaCh0LCBlKTtcbiAgICBpZiAodCBpbnN0YW5jZW9mIEFoKSBcbiAgICAvLyBGaWVsZFZhbHVlcyB1c3VhbGx5IHBhcnNlIGludG8gdHJhbnNmb3JtcyAoZXhjZXB0IGRlbGV0ZUZpZWxkKCkpXG4gICAgLy8gaW4gd2hpY2ggY2FzZSB3ZSBkbyBub3Qgd2FudCB0byBpbmNsdWRlIHRoaXMgZmllbGQgaW4gb3VyIHBhcnNlZCBkYXRhXG4gICAgLy8gKGFzIGRvaW5nIHNvIHdpbGwgb3ZlcndyaXRlIHRoZSBmaWVsZCBkaXJlY3RseSBwcmlvciB0byB0aGUgdHJhbnNmb3JtXG4gICAgLy8gdHJ5aW5nIHRvIHRyYW5zZm9ybSBpdCkuIFNvIHdlIGRvbid0IGFkZCB0aGlzIGxvY2F0aW9uIHRvXG4gICAgLy8gY29udGV4dC5maWVsZE1hc2sgYW5kIHdlIHJldHVybiBudWxsIGFzIG91ciBwYXJzaW5nIHJlc3VsdC5cbiAgICAvKipcbiAqIFwiUGFyc2VzXCIgdGhlIHByb3ZpZGVkIEZpZWxkVmFsdWVJbXBsLCBhZGRpbmcgYW55IG5lY2Vzc2FyeSB0cmFuc2Zvcm1zIHRvXG4gKiBjb250ZXh0LmZpZWxkVHJhbnNmb3Jtcy5cbiAqL1xuICAgIHJldHVybiBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIC8vIFNlbnRpbmVscyBhcmUgb25seSBzdXBwb3J0ZWQgd2l0aCB3cml0ZXMsIGFuZCBub3Qgd2l0aGluIGFycmF5cy5cbiAgICAgICAgaWYgKCFWaChlLnNhKSkgdGhyb3cgZS5oYShgJHt0Ll9tZXRob2ROYW1lfSgpIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCB1cGRhdGUoKSBhbmQgc2V0KClgKTtcbiAgICAgICAgaWYgKCFlLnBhdGgpIHRocm93IGUuaGEoYCR7dC5fbWV0aG9kTmFtZX0oKSBpcyBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBpbnNpZGUgYXJyYXlzYCk7XG4gICAgICAgIGNvbnN0IG4gPSB0Ll90b0ZpZWxkVHJhbnNmb3JtKGUpO1xuICAgICAgICBuICYmIGUuZmllbGRUcmFuc2Zvcm1zLnB1c2gobik7XG4gICAgfVxuICAgIC8qKlxuICogSGVscGVyIHRvIHBhcnNlIGEgc2NhbGFyIHZhbHVlIChpLmUuIG5vdCBhbiBPYmplY3QsIEFycmF5LCBvciBGaWVsZFZhbHVlKVxuICpcbiAqIEByZXR1cm5zIFRoZSBwYXJzZWQgdmFsdWVcbiAqLyAodCwgZSksIG51bGw7XG4gICAgaWYgKHZvaWQgMCA9PT0gdCAmJiBlLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMpIFxuICAgIC8vIElmIHRoZSBpbnB1dCBpcyB1bmRlZmluZWQgaXQgY2FuIG5ldmVyIHBhcnRpY2lwYXRlIGluIHRoZSBmaWVsZE1hc2ssIHNvXG4gICAgLy8gZG9uJ3QgaGFuZGxlIHRoaXMgYmVsb3cuIElmIGBpZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzYCBpcyBmYWxzZSxcbiAgICAvLyBgcGFyc2VTY2FsYXJWYWx1ZWAgd2lsbCByZWplY3QgYW4gdW5kZWZpbmVkIHZhbHVlLlxuICAgIHJldHVybiBudWxsO1xuICAgIGlmIChcbiAgICAvLyBJZiBjb250ZXh0LnBhdGggaXMgbnVsbCB3ZSBhcmUgaW5zaWRlIGFuIGFycmF5IGFuZCB3ZSBkb24ndCBzdXBwb3J0XG4gICAgLy8gZmllbGQgbWFzayBwYXRocyBtb3JlIGdyYW51bGFyIHRoYW4gdGhlIHRvcC1sZXZlbCBhcnJheS5cbiAgICBlLnBhdGggJiYgZS5maWVsZE1hc2sucHVzaChlLnBhdGgpLCB0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgLy8gVE9ETyhiLzM0ODcxMTMxKTogSW5jbHVkZSB0aGUgcGF0aCBjb250YWluaW5nIHRoZSBhcnJheSBpbiB0aGUgZXJyb3JcbiAgICAgICAgLy8gbWVzc2FnZS5cbiAgICAgICAgLy8gSW4gdGhlIGNhc2Ugb2YgSU4gcXVlcmllcywgdGhlIHBhcnNlZCBkYXRhIGlzIGFuIGFycmF5IChyZXByZXNlbnRpbmdcbiAgICAgICAgLy8gdGhlIHNldCBvZiB2YWx1ZXMgdG8gYmUgaW5jbHVkZWQgZm9yIHRoZSBJTiBxdWVyeSkgdGhhdCBtYXkgZGlyZWN0bHlcbiAgICAgICAgLy8gY29udGFpbiBhZGRpdGlvbmFsIGFycmF5cyAoZWFjaCByZXByZXNlbnRpbmcgYW4gaW5kaXZpZHVhbCBmaWVsZFxuICAgICAgICAvLyB2YWx1ZSksIHNvIHdlIGRpc2FibGUgdGhpcyB2YWxpZGF0aW9uLlxuICAgICAgICBpZiAoZS5zZXR0aW5ncy5vYSAmJiA0IC8qIFVzZXJEYXRhU291cmNlLkFycmF5QXJndW1lbnQgKi8gIT09IGUuc2EpIHRocm93IGUuaGEoXCJOZXN0ZWQgYXJyYXlzIGFyZSBub3Qgc3VwcG9ydGVkXCIpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgbGV0IHMgPSAwO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIHQpIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IFVoKGksIGUuYWEocykpO1xuICAgICAgICAgICAgICAgIG51bGwgPT0gdCAmJiAoXG4gICAgICAgICAgICAgICAgLy8gSnVzdCBpbmNsdWRlIG51bGxzIGluIHRoZSBhcnJheSBmb3IgZmllbGRzIGJlaW5nIHJlcGxhY2VkIHdpdGggYVxuICAgICAgICAgICAgICAgIC8vIHNlbnRpbmVsLlxuICAgICAgICAgICAgICAgIHQgPSB7XG4gICAgICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgICAgICB9KSwgbi5wdXNoKHQpLCBzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0LCBlKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgaWYgKG51bGwgPT09ICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSkgcmV0dXJuIHtcbiAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIHQpIHJldHVybiBTbihlLnl0LCB0KTtcbiAgICAgICAgaWYgKFwiYm9vbGVhblwiID09IHR5cGVvZiB0KSByZXR1cm4ge1xuICAgICAgICAgICAgYm9vbGVhblZhbHVlOiB0XG4gICAgICAgIH07XG4gICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiB0KSByZXR1cm4ge1xuICAgICAgICAgICAgc3RyaW5nVmFsdWU6IHRcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gbnQuZnJvbURhdGUodCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpbWVzdGFtcFZhbHVlOiAkcyhlLnl0LCBuKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIG50KSB7XG4gICAgICAgICAgICAvLyBGaXJlc3RvcmUgYmFja2VuZCB0cnVuY2F0ZXMgcHJlY2lzaW9uIGRvd24gdG8gbWljcm9zZWNvbmRzLiBUbyBlbnN1cmVcbiAgICAgICAgICAgIC8vIG9mZmxpbmUgbW9kZSB3b3JrcyB0aGUgc2FtZSB3aXRoIHJlZ2FyZHMgdG8gdHJ1bmNhdGlvbiwgcGVyZm9ybSB0aGVcbiAgICAgICAgICAgIC8vIHRydW5jYXRpb24gaW1tZWRpYXRlbHkgd2l0aG91dCB3YWl0aW5nIGZvciB0aGUgYmFja2VuZCB0byBkbyB0aGF0LlxuICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBudCh0LnNlY29uZHMsIDFlMyAqIE1hdGguZmxvb3IodC5uYW5vc2Vjb25kcyAvIDFlMykpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXBWYWx1ZTogJHMoZS55dCwgbilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBSaCkgcmV0dXJuIHtcbiAgICAgICAgICAgIGdlb1BvaW50VmFsdWU6IHtcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogdC5sYXRpdHVkZSxcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHQubG9uZ2l0dWRlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0IGluc3RhbmNlb2YgSWgpIHJldHVybiB7XG4gICAgICAgICAgICBieXRlc1ZhbHVlOiBCcyhlLnl0LCB0Ll9ieXRlU3RyaW5nKVxuICAgICAgICB9O1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIHlhKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5kYXRhYmFzZUlkLCBzID0gdC5maXJlc3RvcmUuX2RhdGFiYXNlSWQ7XG4gICAgICAgICAgICBpZiAoIXMuaXNFcXVhbChuKSkgdGhyb3cgZS5oYShgRG9jdW1lbnQgcmVmZXJlbmNlIGlzIGZvciBkYXRhYmFzZSAke3MucHJvamVjdElkfS8ke3MuZGF0YWJhc2V9IGJ1dCBzaG91bGQgYmUgZm9yIGRhdGFiYXNlICR7bi5wcm9qZWN0SWR9LyR7bi5kYXRhYmFzZX1gKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlVmFsdWU6IFVzKHQuZmlyZXN0b3JlLl9kYXRhYmFzZUlkIHx8IGUuZGF0YWJhc2VJZCwgdC5fa2V5LnBhdGgpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGUuaGEoYFVuc3VwcG9ydGVkIGZpZWxkIHZhbHVlOiAke2xhKHQpfWApO1xuICAgIH1cbiAgICAvKipcbiAqIENoZWNrcyB3aGV0aGVyIGFuIG9iamVjdCBsb29rcyBsaWtlIGEgSlNPTiBvYmplY3QgdGhhdCBzaG91bGQgYmUgY29udmVydGVkXG4gKiBpbnRvIGEgc3RydWN0LiBOb3JtYWwgY2xhc3MvcHJvdG90eXBlIGluc3RhbmNlcyBhcmUgY29uc2lkZXJlZCB0byBsb29rIGxpa2VcbiAqIEpTT04gb2JqZWN0cyBzaW5jZSB0aGV5IHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gYSBzdHJ1Y3QgdmFsdWUuIEFycmF5cywgRGF0ZXMsXG4gKiBHZW9Qb2ludHMsIGV0Yy4gYXJlIG5vdCBjb25zaWRlcmVkIHRvIGxvb2sgbGlrZSBKU09OIG9iamVjdHMgc2luY2UgdGhleSBtYXBcbiAqIHRvIHNwZWNpZmljIEZpZWxkVmFsdWUgdHlwZXMgb3RoZXIgdGhhbiBPYmplY3RWYWx1ZS5cbiAqLyAodCwgZSk7XG59XG5cbmZ1bmN0aW9uIEtoKHQsIGUpIHtcbiAgICBjb25zdCBuID0ge307XG4gICAgcmV0dXJuIEx0KHQpID8gXG4gICAgLy8gSWYgd2UgZW5jb3VudGVyIGFuIGVtcHR5IG9iamVjdCwgd2UgZXhwbGljaXRseSBhZGQgaXQgdG8gdGhlIHVwZGF0ZVxuICAgIC8vIG1hc2sgdG8gZW5zdXJlIHRoYXQgdGhlIHNlcnZlciBjcmVhdGVzIGEgbWFwIGVudHJ5LlxuICAgIGUucGF0aCAmJiBlLnBhdGgubGVuZ3RoID4gMCAmJiBlLmZpZWxkTWFzay5wdXNoKGUucGF0aCkgOiBCdCh0LCAoKHQsIHMpID0+IHtcbiAgICAgICAgY29uc3QgaSA9IFVoKHMsIGUucmEodCkpO1xuICAgICAgICBudWxsICE9IGkgJiYgKG5bdF0gPSBpKTtcbiAgICB9KSksIHtcbiAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgIGZpZWxkczogblxuICAgICAgICB9XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gR2godCkge1xuICAgIHJldHVybiAhKFwib2JqZWN0XCIgIT0gdHlwZW9mIHQgfHwgbnVsbCA9PT0gdCB8fCB0IGluc3RhbmNlb2YgQXJyYXkgfHwgdCBpbnN0YW5jZW9mIERhdGUgfHwgdCBpbnN0YW5jZW9mIG50IHx8IHQgaW5zdGFuY2VvZiBSaCB8fCB0IGluc3RhbmNlb2YgSWggfHwgdCBpbnN0YW5jZW9mIHlhIHx8IHQgaW5zdGFuY2VvZiBBaCk7XG59XG5cbmZ1bmN0aW9uIFFoKHQsIGUsIG4pIHtcbiAgICBpZiAoIUdoKG4pIHx8ICFmdW5jdGlvbih0KSB7XG4gICAgICAgIHJldHVybiBcIm9iamVjdFwiID09IHR5cGVvZiB0ICYmIG51bGwgIT09IHQgJiYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0KSA9PT0gT2JqZWN0LnByb3RvdHlwZSB8fCBudWxsID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodCkpO1xuICAgIH0obikpIHtcbiAgICAgICAgY29uc3QgcyA9IGxhKG4pO1xuICAgICAgICB0aHJvdyBcImFuIG9iamVjdFwiID09PSBzID8gZS5oYSh0ICsgXCIgYSBjdXN0b20gb2JqZWN0XCIpIDogZS5oYSh0ICsgXCIgXCIgKyBzKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRoYXQgY2FsbHMgZnJvbURvdFNlcGFyYXRlZFN0cmluZygpIGJ1dCB3cmFwcyBhbnkgZXJyb3IgdGhyb3duLlxuICovIGZ1bmN0aW9uIGpoKHQsIGUsIG4pIHtcbiAgICBpZiAoKFxuICAgIC8vIElmIHJlcXVpcmVkLCByZXBsYWNlIHRoZSBGaWVsZFBhdGggQ29tcGF0IGNsYXNzIHdpdGggd2l0aCB0aGUgZmlyZXN0b3JlLWV4cFxuICAgIC8vIEZpZWxkUGF0aC5cbiAgICBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKSBpbnN0YW5jZW9mIFRoKSByZXR1cm4gZS5faW50ZXJuYWxQYXRoO1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKSByZXR1cm4gemgodCwgZSk7XG4gICAgdGhyb3cgSGgoXCJGaWVsZCBwYXRoIGFyZ3VtZW50cyBtdXN0IGJlIG9mIHR5cGUgc3RyaW5nIG9yIFwiLCB0LCBcbiAgICAvKiBoYXNDb252ZXJ0ZXI9ICovICExLCBcbiAgICAvKiBwYXRoPSAqLyB2b2lkIDAsIG4pO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgYW55IGNoYXJhY3RlcnMgaW4gYSBmaWVsZCBwYXRoIHN0cmluZyB0aGF0IGFyZSByZXNlcnZlZC5cbiAqLyBjb25zdCBXaCA9IG5ldyBSZWdFeHAoXCJbflxcXFwqL1xcXFxbXFxcXF1dXCIpO1xuXG4vKipcbiAqIFdyYXBzIGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcgd2l0aCBhbiBlcnJvciBtZXNzYWdlIGFib3V0IHRoZSBtZXRob2QgdGhhdFxuICogd2FzIHRocm93bi5cbiAqIEBwYXJhbSBtZXRob2ROYW1lIC0gVGhlIHB1YmxpY2x5IHZpc2libGUgbWV0aG9kIG5hbWVcbiAqIEBwYXJhbSBwYXRoIC0gVGhlIGRvdC1zZXBhcmF0ZWQgc3RyaW5nIGZvcm0gb2YgYSBmaWVsZCBwYXRoIHdoaWNoIHdpbGwgYmVcbiAqIHNwbGl0IG9uIGRvdHMuXG4gKiBAcGFyYW0gdGFyZ2V0RG9jIC0gVGhlIGRvY3VtZW50IGFnYWluc3Qgd2hpY2ggdGhlIGZpZWxkIHBhdGggd2lsbCBiZVxuICogZXZhbHVhdGVkLlxuICovIGZ1bmN0aW9uIHpoKHQsIGUsIG4pIHtcbiAgICBpZiAoZS5zZWFyY2goV2gpID49IDApIHRocm93IEhoKGBJbnZhbGlkIGZpZWxkIHBhdGggKCR7ZX0pLiBQYXRocyBtdXN0IG5vdCBjb250YWluICd+JywgJyonLCAnLycsICdbJywgb3IgJ10nYCwgdCwgXG4gICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgLyogcGF0aD0gKi8gdm9pZCAwLCBuKTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gbmV3IFRoKC4uLmUuc3BsaXQoXCIuXCIpKS5faW50ZXJuYWxQYXRoO1xuICAgIH0gY2F0Y2ggKHMpIHtcbiAgICAgICAgdGhyb3cgSGgoYEludmFsaWQgZmllbGQgcGF0aCAoJHtlfSkuIFBhdGhzIG11c3Qgbm90IGJlIGVtcHR5LCBiZWdpbiB3aXRoICcuJywgZW5kIHdpdGggJy4nLCBvciBjb250YWluICcuLidgLCB0LCBcbiAgICAgICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgICAgIC8qIHBhdGg9ICovIHZvaWQgMCwgbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBIaCh0LCBlLCBuLCBzLCBpKSB7XG4gICAgY29uc3QgciA9IHMgJiYgIXMuaXNFbXB0eSgpLCBvID0gdm9pZCAwICE9PSBpO1xuICAgIGxldCB1ID0gYEZ1bmN0aW9uICR7ZX0oKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGRhdGFgO1xuICAgIG4gJiYgKHUgKz0gXCIgKHZpYSBgdG9GaXJlc3RvcmUoKWApXCIpLCB1ICs9IFwiLiBcIjtcbiAgICBsZXQgYyA9IFwiXCI7XG4gICAgcmV0dXJuIChyIHx8IG8pICYmIChjICs9IFwiIChmb3VuZFwiLCByICYmIChjICs9IGAgaW4gZmllbGQgJHtzfWApLCBvICYmIChjICs9IGAgaW4gZG9jdW1lbnQgJHtpfWApLCBcbiAgICBjICs9IFwiKVwiKSwgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCB1ICsgdCArIGMpO1xufVxuXG4vKiogQ2hlY2tzIGBoYXlzdGFja2AgaWYgRmllbGRQYXRoIGBuZWVkbGVgIGlzIHByZXNlbnQuIFJ1bnMgaW4gTyhuKS4gKi8gZnVuY3Rpb24gSmgodCwgZSkge1xuICAgIHJldHVybiB0LnNvbWUoKHQgPT4gdC5pc0VxdWFsKGUpKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91ciBGaXJlc3RvcmVcbiAqIGRhdGFiYXNlLiBUaGUgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0b1xuICogZ2V0IGEgc3BlY2lmaWMgZmllbGQuXG4gKlxuICogRm9yIGEgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcG9pbnRzIHRvIGEgbm9uLWV4aXN0aW5nIGRvY3VtZW50LCBhbnkgZGF0YVxuICogYWNjZXNzIHdpbGwgcmV0dXJuICd1bmRlZmluZWQnLiBZb3UgY2FuIHVzZSB0aGUgYGV4aXN0cygpYCBtZXRob2QgdG9cbiAqIGV4cGxpY2l0bHkgdmVyaWZ5IGEgZG9jdW1lbnQncyBleGlzdGVuY2UuXG4gKi8gY2xhc3MgWWgge1xuICAgIC8vIE5vdGU6IFRoaXMgY2xhc3MgaXMgc3RyaXBwZWQgZG93biB2ZXJzaW9uIG9mIHRoZSBEb2N1bWVudFNuYXBzaG90IGluXG4gICAgLy8gdGhlIGxlZ2FjeSBTREsuIFRoZSBjaGFuZ2VzIGFyZTpcbiAgICAvLyAtIE5vIHN1cHBvcnQgZm9yIFNuYXBzaG90TWV0YWRhdGEuXG4gICAgLy8gLSBObyBzdXBwb3J0IGZvciBTbmFwc2hvdE9wdGlvbnMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgcHJvdGVjdGVkICovXG4gICAgY29uc3RydWN0b3IodCwgZSwgbiwgcywgaSkge1xuICAgICAgICB0aGlzLl9maXJlc3RvcmUgPSB0LCB0aGlzLl91c2VyRGF0YVdyaXRlciA9IGUsIHRoaXMuX2tleSA9IG4sIHRoaXMuX2RvY3VtZW50ID0gcywgXG4gICAgICAgIHRoaXMuX2NvbnZlcnRlciA9IGk7XG4gICAgfVxuICAgIC8qKiBQcm9wZXJ0eSBvZiB0aGUgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcHJvdmlkZXMgdGhlIGRvY3VtZW50J3MgSUQuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2tleS5wYXRoLmxhc3RTZWdtZW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBgRG9jdW1lbnRSZWZlcmVuY2VgIGZvciB0aGUgZG9jdW1lbnQgaW5jbHVkZWQgaW4gdGhlIGBEb2N1bWVudFNuYXBzaG90YC5cbiAgICAgKi8gICAgZ2V0IHJlZigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB5YSh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX2NvbnZlcnRlciwgdGhpcy5fa2V5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2lnbmFscyB3aGV0aGVyIG9yIG5vdCB0aGUgZG9jdW1lbnQgYXQgdGhlIHNuYXBzaG90J3MgbG9jYXRpb24gZXhpc3RzLlxuICAgICAqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgZG9jdW1lbnQgZXhpc3RzLlxuICAgICAqLyAgICBleGlzdHMoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLl9kb2N1bWVudDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IG9yIGB1bmRlZmluZWRgXG4gICAgICogaWYgdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovICAgIGRhdGEoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbnZlcnRlcikge1xuICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgdGhlIGNvbnZlcnRlciBhbmQgY3JlYXRlIGEgbmV3IERvY3VtZW50U25hcHNob3RcbiAgICAgICAgICAgICAgICAvLyBpZiBhIGNvbnZlcnRlciBoYXMgYmVlbiBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IFhoKHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIHRoaXMuX2tleSwgdGhpcy5fZG9jdW1lbnQsIFxuICAgICAgICAgICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRlci5mcm9tRmlyZXN0b3JlKHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZSh0aGlzLl9kb2N1bWVudC5kYXRhLnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGZpZWxkIHNwZWNpZmllZCBieSBgZmllbGRQYXRoYC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBvciBmaWVsZCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIChmb3IgZXhhbXBsZSAnZm9vJyBvciAnZm9vLmJhcicpIHRvIGEgc3BlY2lmaWNcbiAgICAgKiBmaWVsZC5cbiAgICAgKiBAcmV0dXJucyBUaGUgZGF0YSBhdCB0aGUgc3BlY2lmaWVkIGZpZWxkIGxvY2F0aW9uIG9yIHVuZGVmaW5lZCBpZiBubyBzdWNoXG4gICAgICogZmllbGQgZXhpc3RzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICAvLyBXZSBhcmUgdXNpbmcgYGFueWAgaGVyZSB0byBhdm9pZCBhbiBleHBsaWNpdCBjYXN0IGJ5IG91ciB1c2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGdldCh0KSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuX2RvY3VtZW50LmRhdGEuZmllbGQoWmgoXCJEb2N1bWVudFNuYXBzaG90LmdldFwiLCB0KSk7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZSkgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZShlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91clxuICogRmlyZXN0b3JlIGRhdGFiYXNlIGFzIHBhcnQgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50IGlzIGd1YXJhbnRlZWQgdG8gZXhpc3RcbiAqIGFuZCBpdHMgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0byBnZXQgYVxuICogc3BlY2lmaWMgZmllbGQuXG4gKlxuICogQSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBvZmZlcnMgdGhlIHNhbWUgQVBJIHN1cmZhY2UgYXMgYVxuICogYERvY3VtZW50U25hcHNob3RgLiBTaW5jZSBxdWVyeSByZXN1bHRzIGNvbnRhaW4gb25seSBleGlzdGluZyBkb2N1bWVudHMsIHRoZVxuICogYGV4aXN0c2AgcHJvcGVydHkgd2lsbCBhbHdheXMgYmUgdHJ1ZSBhbmQgYGRhdGEoKWAgd2lsbCBuZXZlciByZXR1cm5cbiAqICd1bmRlZmluZWQnLlxuICovIGNsYXNzIFhoIGV4dGVuZHMgWWgge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgZGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRhdGEoKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRoYXQgY2FsbHMgYGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoKWAgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gWmgodCwgZSkge1xuICAgIHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gemgodCwgZSkgOiBlIGluc3RhbmNlb2YgVGggPyBlLl9pbnRlcm5hbFBhdGggOiBlLl9kZWxlZ2F0ZS5faW50ZXJuYWxQYXRoO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiB0bCh0KSB7XG4gICAgaWYgKFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovID09PSB0LmxpbWl0VHlwZSAmJiAwID09PSB0LmV4cGxpY2l0T3JkZXJCeS5sZW5ndGgpIHRocm93IG5ldyBMKEIuVU5JTVBMRU1FTlRFRCwgXCJsaW1pdFRvTGFzdCgpIHF1ZXJpZXMgcmVxdWlyZSBzcGVjaWZ5aW5nIGF0IGxlYXN0IG9uZSBvcmRlckJ5KCkgY2xhdXNlXCIpO1xufVxuXG4vKipcbiAqIEFuIGBBcHBsaWFibGVDb25zdHJhaW50YCBpcyBhbiBhYnN0cmFjdGlvbiBvZiBhIGNvbnN0cmFpbnQgdGhhdCBjYW4gYmUgYXBwbGllZFxuICogdG8gYSBGaXJlc3RvcmUgcXVlcnkuXG4gKi8gY2xhc3MgZWwge31cblxuLyoqXG4gKiBBIGBRdWVyeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5IGFcbiAqIEZpcmVzdG9yZSBxdWVyeS4gYFF1ZXJ5Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayB3aGVyZX0sXG4gKiB7QGxpbmsgb3JkZXJCeX0sIHtAbGluayBzdGFydEF0fSwge0BsaW5rIHN0YXJ0QWZ0ZXJ9LCB7QGxpbmtcbiAqIGVuZEJlZm9yZX0sIHtAbGluayBlbmRBdH0sIHtAbGluayBsaW1pdH0sIHtAbGluayBsaW1pdFRvTGFzdH0gYW5kXG4gKiBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIHF1ZXJ5fSB0byBjcmVhdGUgYSBuZXcgcXVlcnkgaW5zdGFuY2UgdGhhdFxuICogYWxzbyBjb250YWlucyB0aGlzIGBRdWVyeUNvbnN0cmFpbnRgLlxuICovIGNsYXNzIG5sIGV4dGVuZHMgZWwge31cblxuZnVuY3Rpb24gc2wodCwgZSwgLi4ubikge1xuICAgIGxldCBzID0gW107XG4gICAgZSBpbnN0YW5jZW9mIGVsICYmIHMucHVzaChlKSwgcyA9IHMuY29uY2F0KG4pLCBmdW5jdGlvbih0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0LmZpbHRlcigodCA9PiB0IGluc3RhbmNlb2Ygb2wpKS5sZW5ndGgsIG4gPSB0LmZpbHRlcigodCA9PiB0IGluc3RhbmNlb2YgaWwpKS5sZW5ndGg7XG4gICAgICAgIGlmIChlID4gMSB8fCBlID4gMCAmJiBuID4gMCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWRRdWVyeS4gV2hlbiB1c2luZyBjb21wb3NpdGUgZmlsdGVycywgeW91IGNhbm5vdCB1c2UgbW9yZSB0aGFuIG9uZSBmaWx0ZXIgYXQgdGhlIHRvcCBsZXZlbC4gQ29uc2lkZXIgbmVzdGluZyB0aGUgbXVsdGlwbGUgZmlsdGVycyB3aXRoaW4gYW4gYGFuZCguLi4pYCBzdGF0ZW1lbnQuIEZvciBleGFtcGxlOiBjaGFuZ2UgYHF1ZXJ5KHF1ZXJ5LCB3aGVyZSguLi4pLCBvciguLi4pKWAgdG8gYHF1ZXJ5KHF1ZXJ5LCBhbmQod2hlcmUoLi4uKSwgb3IoLi4uKSkpYC5cIik7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgLyoqXG4gKiBDb252ZXJ0cyBGaXJlc3RvcmUncyBpbnRlcm5hbCB0eXBlcyB0byB0aGUgSmF2YVNjcmlwdCB0eXBlcyB0aGF0IHdlIGV4cG9zZVxuICogdG8gdGhlIHVzZXIuXG4gKlxuICogQGludGVybmFsXG4gKi8gKHMpO1xuICAgIGZvciAoY29uc3QgZSBvZiBzKSB0ID0gZS5fYXBwbHkodCk7XG4gICAgcmV0dXJuIHQ7XG59XG5cbi8qKlxuICogQSBgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5XG4gKiBhIEZpcmVzdG9yZSBxdWVyeSBieSBmaWx0ZXJpbmcgb24gb25lIG9yIG1vcmUgZG9jdW1lbnQgZmllbGRzLlxuICogYFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIHdoZXJlfSBhbmQgY2FuIHRoZW5cbiAqIGJlIHBhc3NlZCB0byB7QGxpbmsgcXVlcnl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeSBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnNcbiAqIHRoaXMgYFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50YC5cbiAqLyBjbGFzcyBpbCBleHRlbmRzIG5sIHtcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuX2ZpZWxkID0gdCwgdGhpcy5fb3AgPSBlLCB0aGlzLl92YWx1ZSA9IG4sIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwid2hlcmVcIjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbmV3IGlsKHQsIGUsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkodCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5fcGFyc2UodCk7XG4gICAgICAgIHJldHVybiBBbCh0Ll9xdWVyeSwgZSksIG5ldyBwYSh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIHluKHQuX3F1ZXJ5LCBlKSk7XG4gICAgfVxuICAgIF9wYXJzZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSBDaCh0LmZpcmVzdG9yZSksIG4gPSBmdW5jdGlvbih0LCBlLCBuLCBzLCBpLCByLCBvKSB7XG4gICAgICAgICAgICBsZXQgdTtcbiAgICAgICAgICAgIGlmIChpLmlzS2V5RmllbGQoKSkge1xuICAgICAgICAgICAgICAgIGlmIChcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IHIgfHwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gPT09IHIpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgUXVlcnkuIFlvdSBjYW4ndCBwZXJmb3JtICcke3J9JyBxdWVyaWVzIG9uIGRvY3VtZW50SWQoKS5gKTtcbiAgICAgICAgICAgICAgICBpZiAoXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSByIHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSByKSB7XG4gICAgICAgICAgICAgICAgICAgIEVsKG8sIHIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBvKSBlLnB1c2goVGwocywgdCwgbikpO1xuICAgICAgICAgICAgICAgICAgICB1ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB1ID0gVGwocywgdCwgbyk7XG4gICAgICAgICAgICB9IGVsc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovICE9PSByICYmIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovICE9PSByICYmIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovICE9PSByIHx8IEVsKG8sIHIpLCBcbiAgICAgICAgICAgIHUgPSBxaChuLCBlLCBvLCBcbiAgICAgICAgICAgIC8qIGFsbG93QXJyYXlzPSAqLyBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IHIgfHwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gPT09IHIpO1xuICAgICAgICAgICAgcmV0dXJuIFJlLmNyZWF0ZShpLCByLCB1KTtcbiAgICAgICAgfSh0Ll9xdWVyeSwgXCJ3aGVyZVwiLCBlLCB0LmZpcmVzdG9yZS5fZGF0YWJhc2VJZCwgdGhpcy5fZmllbGQsIHRoaXMuX29wLCB0aGlzLl92YWx1ZSk7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50fSB0aGF0IGVuZm9yY2VzIHRoYXQgZG9jdW1lbnRzXG4gKiBtdXN0IGNvbnRhaW4gdGhlIHNwZWNpZmllZCBmaWVsZCBhbmQgdGhhdCB0aGUgdmFsdWUgc2hvdWxkIHNhdGlzZnkgdGhlXG4gKiByZWxhdGlvbiBjb25zdHJhaW50IHByb3ZpZGVkLlxuICpcbiAqIEBwYXJhbSBmaWVsZFBhdGggLSBUaGUgcGF0aCB0byBjb21wYXJlXG4gKiBAcGFyYW0gb3BTdHIgLSBUaGUgb3BlcmF0aW9uIHN0cmluZyAoZS5nIFwiJmx0O1wiLCBcIiZsdDs9XCIsIFwiPT1cIiwgXCImbHQ7XCIsXG4gKiAgIFwiJmx0Oz1cIiwgXCIhPVwiKS5cbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSBmb3IgY29tcGFyaXNvblxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50fS5cbiAqLyBmdW5jdGlvbiBybCh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IGUsIGkgPSBaaChcIndoZXJlXCIsIHQpO1xuICAgIHJldHVybiBpbC5fY3JlYXRlKGksIHMsIG4pO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludGAgaXMgdXNlZCB0byBuYXJyb3cgdGhlIHNldCBvZiBkb2N1bWVudHNcbiAqIHJldHVybmVkIGJ5IGEgRmlyZXN0b3JlIHF1ZXJ5IGJ5IHBlcmZvcm1pbmcgdGhlIGxvZ2ljYWwgT1Igb3IgQU5EIG9mIG11bHRpcGxlXG4gKiB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9cyBvciB7QGxpbmsgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50fXMuXG4gKiBgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIG9yfSBvclxuICoge0BsaW5rIGFuZH0gYW5kIGNhbiB0aGVuIGJlIHBhc3NlZCB0byB7QGxpbmsgcXVlcnl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeVxuICogaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoZSBgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50YC5cbiAqIEBpbnRlcm5hbCBUT0RPIHJlbW92ZSB0aGlzIGludGVybmFsIHRhZyB3aXRoIE9SIFF1ZXJ5IHN1cHBvcnQgaW4gdGhlIHNlcnZlclxuICovIGNsYXNzIG9sIGV4dGVuZHMgZWwge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICB0LCBlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IHQsIHRoaXMuX3F1ZXJ5Q29uc3RyYWludHMgPSBlO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZSh0LCBlKSB7XG4gICAgICAgIHJldHVybiBuZXcgb2wodCwgZSk7XG4gICAgfVxuICAgIF9wYXJzZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLl9xdWVyeUNvbnN0cmFpbnRzLm1hcCgoZSA9PiBlLl9wYXJzZSh0KSkpLmZpbHRlcigodCA9PiB0LmdldEZpbHRlcnMoKS5sZW5ndGggPiAwKSk7XG4gICAgICAgIHJldHVybiAxID09PSBlLmxlbmd0aCA/IGVbMF0gOiBiZS5jcmVhdGUoZSwgdGhpcy5fZ2V0T3BlcmF0b3IoKSk7XG4gICAgfVxuICAgIF9hcHBseSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLl9wYXJzZSh0KTtcbiAgICAgICAgcmV0dXJuIDAgPT09IGUuZ2V0RmlsdGVycygpLmxlbmd0aCA/IHQgOiAoZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgbGV0IG4gPSB0O1xuICAgICAgICAgICAgY29uc3QgcyA9IGUuZ2V0RmxhdHRlbmVkRmlsdGVycygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIHMpIEFsKG4sIHQpLCBuID0geW4obiwgdCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ2hlY2tzIGlmIGFueSBvZiB0aGUgcHJvdmlkZWQgZmlsdGVyIG9wZXJhdG9ycyBhcmUgaW5jbHVkZWQgaW4gdGhlIGdpdmVuIGxpc3Qgb2YgZmlsdGVycyBhbmRcbiAgICAgICAgLy8gcmV0dXJucyB0aGUgZmlyc3Qgb25lIHRoYXQgaXMsIG9yIG51bGwgaWYgbm9uZSBhcmUuXG4gICAgICAgICh0Ll9xdWVyeSwgZSksIG5ldyBwYSh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIHluKHQuX3F1ZXJ5LCBlKSkpO1xuICAgIH1cbiAgICBfZ2V0UXVlcnlDb25zdHJhaW50cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5Q29uc3RyYWludHM7XG4gICAgfVxuICAgIF9nZXRPcGVyYXRvcigpIHtcbiAgICAgICAgcmV0dXJuIFwiYW5kXCIgPT09IHRoaXMudHlwZSA/IFwiYW5kXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuQU5EICovIDogXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9IHRoYXQgaXMgYSBkaXNqdW5jdGlvbiBvZlxuICogdGhlIGdpdmVuIGZpbHRlciBjb25zdHJhaW50cy4gQSBkaXNqdW5jdGlvbiBmaWx0ZXIgaW5jbHVkZXMgYSBkb2N1bWVudCBpZiBpdFxuICogc2F0aXNmaWVzIGFueSBvZiB0aGUgZ2l2ZW4gZmlsdGVycy5cbiAqXG4gKiBAcGFyYW0gcXVlcnlDb25zdHJhaW50cyAtIE9wdGlvbmFsLiBUaGUgbGlzdCBvZlxuICoge0BsaW5rIFF1ZXJ5RmlsdGVyQ29uc3RyYWludH1zIHRvIHBlcmZvcm0gYSBkaXNqdW5jdGlvbiBmb3IuIFRoZXNlIG11c3QgYmVcbiAqIGNyZWF0ZWQgd2l0aCBjYWxscyB0byB7QGxpbmsgd2hlcmV9LCB7QGxpbmsgb3J9LCBvciB7QGxpbmsgYW5kfS5cbiAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9LlxuICogQGludGVybmFsIFRPRE8gcmVtb3ZlIHRoaXMgaW50ZXJuYWwgdGFnIHdpdGggT1IgUXVlcnkgc3VwcG9ydCBpbiB0aGUgc2VydmVyXG4gKi8gZnVuY3Rpb24gdWwoLi4udCkge1xuICAgIC8vIE9ubHkgc3VwcG9ydCBRdWVyeUZpbHRlckNvbnN0cmFpbnRzXG4gICAgcmV0dXJuIHQuZm9yRWFjaCgodCA9PiBibChcIm9yXCIsIHQpKSksIG9sLl9jcmVhdGUoXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovICwgdCk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB7QGxpbmsgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50fSB0aGF0IGlzIGEgY29uanVuY3Rpb24gb2ZcbiAqIHRoZSBnaXZlbiBmaWx0ZXIgY29uc3RyYWludHMuIEEgY29uanVuY3Rpb24gZmlsdGVyIGluY2x1ZGVzIGEgZG9jdW1lbnQgaWYgaXRcbiAqIHNhdGlzZmllcyBhbGwgb2YgdGhlIGdpdmVuIGZpbHRlcnMuXG4gKlxuICogQHBhcmFtIHF1ZXJ5Q29uc3RyYWludHMgLSBPcHRpb25hbC4gVGhlIGxpc3Qgb2ZcbiAqIHtAbGluayBRdWVyeUZpbHRlckNvbnN0cmFpbnR9cyB0byBwZXJmb3JtIGEgY29uanVuY3Rpb24gZm9yLiBUaGVzZSBtdXN0IGJlXG4gKiBjcmVhdGVkIHdpdGggY2FsbHMgdG8ge0BsaW5rIHdoZXJlfSwge0BsaW5rIG9yfSwgb3Ige0BsaW5rIGFuZH0uXG4gKiBAcmV0dXJucyBUaGUgbmV3bHkgY3JlYXRlZCB7QGxpbmsgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50fS5cbiAqIEBpbnRlcm5hbCBUT0RPIHJlbW92ZSB0aGlzIGludGVybmFsIHRhZyB3aXRoIE9SIFF1ZXJ5IHN1cHBvcnQgaW4gdGhlIHNlcnZlclxuICovIGZ1bmN0aW9uIGNsKC4uLnQpIHtcbiAgICAvLyBPbmx5IHN1cHBvcnQgUXVlcnlGaWx0ZXJDb25zdHJhaW50c1xuICAgIHJldHVybiB0LmZvckVhY2goKHQgPT4gYmwoXCJhbmRcIiwgdCkpKSwgb2wuX2NyZWF0ZShcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyAsIHQpO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gc29ydCB0aGUgc2V0IG9mIGRvY3VtZW50cyByZXR1cm5lZCBieSBhXG4gKiBGaXJlc3RvcmUgcXVlcnkuIGBRdWVyeU9yZGVyQnlDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmdcbiAqIHtAbGluayBvcmRlckJ5fSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayBxdWVyeX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5XG4gKiBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlPcmRlckJ5Q29uc3RyYWludGAuXG4gKlxuICogTm90ZTogRG9jdW1lbnRzIHRoYXQgZG8gbm90IGNvbnRhaW4gdGhlIG9yZGVyQnkgZmllbGQgd2lsbCBub3QgYmUgcHJlc2VudCBpblxuICogdGhlIHF1ZXJ5IHJlc3VsdC5cbiAqLyBjbGFzcyBhbCBleHRlbmRzIG5sIHtcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuX2ZpZWxkID0gdCwgdGhpcy5fZGlyZWN0aW9uID0gZSwgXG4gICAgICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJvcmRlckJ5XCI7XG4gICAgfVxuICAgIHN0YXRpYyBfY3JlYXRlKHQsIGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBhbCh0LCBlKTtcbiAgICB9XG4gICAgX2FwcGx5KHQpIHtcbiAgICAgICAgY29uc3QgZSA9IGZ1bmN0aW9uKHQsIGUsIG4pIHtcbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0LnN0YXJ0QXQpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBzdGFydEF0KCkgb3Igc3RhcnRBZnRlcigpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gdC5lbmRBdCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWQgcXVlcnkuIFlvdSBtdXN0IG5vdCBjYWxsIGVuZEF0KCkgb3IgZW5kQmVmb3JlKCkgYmVmb3JlIGNhbGxpbmcgb3JkZXJCeSgpLlwiKTtcbiAgICAgICAgICAgIGNvbnN0IHMgPSBuZXcgVWUoZSwgbik7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSkge1xuICAgICAgICAgICAgICAgIGlmIChudWxsID09PSBkbih0KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBmaXJzdCBvcmRlciBieS4gSXQgbXVzdCBtYXRjaCBhbnkgaW5lcXVhbGl0eS5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IF9uKHQpO1xuICAgICAgICAgICAgICAgICAgICBudWxsICE9PSBuICYmIFJsKHQsIG4sIGUuZmllbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0odCwgcyksIHM7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBDcmVhdGUgYSBgQm91bmRgIGZyb20gYSBxdWVyeSBhbmQgYSBkb2N1bWVudC5cbiAqXG4gKiBOb3RlIHRoYXQgdGhlIGBCb3VuZGAgd2lsbCBhbHdheXMgaW5jbHVkZSB0aGUga2V5IG9mIHRoZSBkb2N1bWVudFxuICogYW5kIHNvIG9ubHkgdGhlIHByb3ZpZGVkIGRvY3VtZW50IHdpbGwgY29tcGFyZSBlcXVhbCB0byB0aGUgcmV0dXJuZWRcbiAqIHBvc2l0aW9uLlxuICpcbiAqIFdpbGwgdGhyb3cgaWYgdGhlIGRvY3VtZW50IGRvZXMgbm90IGNvbnRhaW4gYWxsIGZpZWxkcyBvZiB0aGUgb3JkZXIgYnlcbiAqIG9mIHRoZSBxdWVyeSBvciBpZiBhbnkgb2YgdGhlIGZpZWxkcyBpbiB0aGUgb3JkZXIgYnkgYXJlIGFuIHVuY29tbWl0dGVkXG4gKiBzZXJ2ZXIgdGltZXN0YW1wLlxuICovICh0Ll9xdWVyeSwgdGhpcy5fZmllbGQsIHRoaXMuX2RpcmVjdGlvbik7XG4gICAgICAgIHJldHVybiBuZXcgcGEodC5maXJlc3RvcmUsIHQuY29udmVydGVyLCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICAvLyBUT0RPKGRpbW9uZCk6IHZhbGlkYXRlIHRoYXQgb3JkZXJCeSBkb2VzIG5vdCBsaXN0IHRoZSBzYW1lIGtleSB0d2ljZS5cbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmV4cGxpY2l0T3JkZXJCeS5jb25jYXQoWyBlIF0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBhbih0LnBhdGgsIHQuY29sbGVjdGlvbkdyb3VwLCBuLCB0LmZpbHRlcnMuc2xpY2UoKSwgdC5saW1pdCwgdC5saW1pdFR5cGUsIHQuc3RhcnRBdCwgdC5lbmRBdCk7XG4gICAgICAgIH0odC5fcXVlcnksIGUpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBRdWVyeU9yZGVyQnlDb25zdHJhaW50fSB0aGF0IHNvcnRzIHRoZSBxdWVyeSByZXN1bHQgYnkgdGhlXG4gKiBzcGVjaWZpZWQgZmllbGQsIG9wdGlvbmFsbHkgaW4gZGVzY2VuZGluZyBvcmRlciBpbnN0ZWFkIG9mIGFzY2VuZGluZy5cbiAqXG4gKiBOb3RlOiBEb2N1bWVudHMgdGhhdCBkbyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIGZpZWxkIHdpbGwgbm90IGJlIHByZXNlbnRcbiAqIGluIHRoZSBxdWVyeSByZXN1bHQuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBmaWVsZCB0byBzb3J0IGJ5LlxuICogQHBhcmFtIGRpcmVjdGlvblN0ciAtIE9wdGlvbmFsIGRpcmVjdGlvbiB0byBzb3J0IGJ5ICgnYXNjJyBvciAnZGVzYycpLiBJZlxuICogbm90IHNwZWNpZmllZCwgb3JkZXIgd2lsbCBiZSBhc2NlbmRpbmcuXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlPcmRlckJ5Q29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gaGwodCwgZSA9IFwiYXNjXCIpIHtcbiAgICBjb25zdCBuID0gZSwgcyA9IFpoKFwib3JkZXJCeVwiLCB0KTtcbiAgICByZXR1cm4gYWwuX2NyZWF0ZShzLCBuKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUxpbWl0Q29uc3RyYWludGAgaXMgdXNlZCB0byBsaW1pdCB0aGUgbnVtYmVyIG9mIGRvY3VtZW50cyByZXR1cm5lZCBieVxuICogYSBGaXJlc3RvcmUgcXVlcnkuXG4gKiBgUXVlcnlMaW1pdENvbnN0cmFpbnRgcyBhcmUgY3JlYXRlZCBieSBpbnZva2luZyB7QGxpbmsgbGltaXR9IG9yXG4gKiB7QGxpbmsgbGltaXRUb0xhc3R9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIHF1ZXJ5fSB0byBjcmVhdGUgYSBuZXdcbiAqIHF1ZXJ5IGluc3RhbmNlIHRoYXQgYWxzbyBjb250YWlucyB0aGlzIGBRdWVyeUxpbWl0Q29uc3RyYWludGAuXG4gKi8gY2xhc3MgbGwgZXh0ZW5kcyBubCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgcXVlcnkgY29uc3RyYWludCAqL1xuICAgIHQsIGUsIG4pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy50eXBlID0gdCwgdGhpcy5fbGltaXQgPSBlLCB0aGlzLl9saW1pdFR5cGUgPSBuO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZSh0LCBlLCBuKSB7XG4gICAgICAgIHJldHVybiBuZXcgbGwodCwgZSwgbik7XG4gICAgfVxuICAgIF9hcHBseSh0KSB7XG4gICAgICAgIHJldHVybiBuZXcgcGEodC5maXJlc3RvcmUsIHQuY29udmVydGVyLCBwbih0Ll9xdWVyeSwgdGhpcy5fbGltaXQsIHRoaXMuX2xpbWl0VHlwZSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5TGltaXRDb25zdHJhaW50fSB0aGF0IG9ubHkgcmV0dXJucyB0aGUgZmlyc3QgbWF0Y2hpbmdcbiAqIGRvY3VtZW50cy5cbiAqXG4gKiBAcGFyYW0gbGltaXQgLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgdG8gcmV0dXJuLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5TGltaXRDb25zdHJhaW50fS5cbiAqLyBmdW5jdGlvbiBmbCh0KSB7XG4gICAgcmV0dXJuIGRhKFwibGltaXRcIiwgdCksIGxsLl9jcmVhdGUoXCJsaW1pdFwiLCB0LCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8pO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlMaW1pdENvbnN0cmFpbnR9IHRoYXQgb25seSByZXR1cm5zIHRoZSBsYXN0IG1hdGNoaW5nXG4gKiBkb2N1bWVudHMuXG4gKlxuICogWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgYG9yZGVyQnlgIGNsYXVzZSBmb3IgYGxpbWl0VG9MYXN0YCBxdWVyaWVzLFxuICogb3RoZXJ3aXNlIGFuIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93biBkdXJpbmcgZXhlY3V0aW9uLlxuICpcbiAqIEBwYXJhbSBsaW1pdCAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyB0byByZXR1cm4uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlMaW1pdENvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIGRsKHQpIHtcbiAgICByZXR1cm4gZGEoXCJsaW1pdFRvTGFzdFwiLCB0KSwgbGwuX2NyZWF0ZShcImxpbWl0VG9MYXN0XCIsIHQsIFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeVN0YXJ0QXRDb25zdHJhaW50YCBpcyB1c2VkIHRvIGV4Y2x1ZGUgZG9jdW1lbnRzIGZyb20gdGhlIHN0YXJ0IG9mIGFcbiAqIHJlc3VsdCBzZXQgcmV0dXJuZWQgYnkgYSBGaXJlc3RvcmUgcXVlcnkuXG4gKiBgUXVlcnlTdGFydEF0Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayAoc3RhcnRBdDoxKX0gb3JcbiAqIHtAbGluayAoc3RhcnRBZnRlcjoxKX0gYW5kIGNhbiB0aGVuIGJlIHBhc3NlZCB0byB7QGxpbmsgcXVlcnl9IHRvIGNyZWF0ZSBhXG4gKiBuZXcgcXVlcnkgaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnRgLlxuICovIGNsYXNzIF9sIGV4dGVuZHMgbmwge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICB0LCBlLCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IHQsIHRoaXMuX2RvY09yRmllbGRzID0gZSwgdGhpcy5faW5jbHVzaXZlID0gbjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbmV3IF9sKHQsIGUsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkodCkge1xuICAgICAgICBjb25zdCBlID0gSWwodCwgdGhpcy50eXBlLCB0aGlzLl9kb2NPckZpZWxkcywgdGhpcy5faW5jbHVzaXZlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBwYSh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgYW4odC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgdC5maWx0ZXJzLnNsaWNlKCksIHQubGltaXQsIHQubGltaXRUeXBlLCBlLCB0LmVuZEF0KTtcbiAgICAgICAgfSh0Ll9xdWVyeSwgZSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gd2woLi4udCkge1xuICAgIHJldHVybiBfbC5fY3JlYXRlKFwic3RhcnRBdFwiLCB0LCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMCk7XG59XG5cbmZ1bmN0aW9uIG1sKC4uLnQpIHtcbiAgICByZXR1cm4gX2wuX2NyZWF0ZShcInN0YXJ0QWZ0ZXJcIiwgdCwgXG4gICAgLyppbmNsdXNpdmU9Ki8gITEpO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RW5kQXRDb25zdHJhaW50YCBpcyB1c2VkIHRvIGV4Y2x1ZGUgZG9jdW1lbnRzIGZyb20gdGhlIGVuZCBvZiBhXG4gKiByZXN1bHQgc2V0IHJldHVybmVkIGJ5IGEgRmlyZXN0b3JlIHF1ZXJ5LlxuICogYFF1ZXJ5RW5kQXRDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIChlbmRBdDoxKX0gb3JcbiAqIHtAbGluayAoZW5kQmVmb3JlOjEpfSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayBxdWVyeX0gdG8gY3JlYXRlIGEgbmV3XG4gKiBxdWVyeSBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlFbmRBdENvbnN0cmFpbnRgLlxuICovIGNsYXNzIGdsIGV4dGVuZHMgbmwge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICB0LCBlLCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IHQsIHRoaXMuX2RvY09yRmllbGRzID0gZSwgdGhpcy5faW5jbHVzaXZlID0gbjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUodCwgZSwgbikge1xuICAgICAgICByZXR1cm4gbmV3IGdsKHQsIGUsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkodCkge1xuICAgICAgICBjb25zdCBlID0gSWwodCwgdGhpcy50eXBlLCB0aGlzLl9kb2NPckZpZWxkcywgdGhpcy5faW5jbHVzaXZlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBwYSh0LmZpcmVzdG9yZSwgdC5jb252ZXJ0ZXIsIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgYW4odC5wYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgdC5maWx0ZXJzLnNsaWNlKCksIHQubGltaXQsIHQubGltaXRUeXBlLCB0LnN0YXJ0QXQsIGUpO1xuICAgICAgICB9KHQuX3F1ZXJ5LCBlKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB5bCguLi50KSB7XG4gICAgcmV0dXJuIGdsLl9jcmVhdGUoXCJlbmRCZWZvcmVcIiwgdCwgXG4gICAgLyppbmNsdXNpdmU9Ki8gITEpO1xufVxuXG5mdW5jdGlvbiBwbCguLi50KSB7XG4gICAgcmV0dXJuIGdsLl9jcmVhdGUoXCJlbmRBdFwiLCB0LCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMCk7XG59XG5cbi8qKiBIZWxwZXIgZnVuY3Rpb24gdG8gY3JlYXRlIGEgYm91bmQgZnJvbSBhIGRvY3VtZW50IG9yIGZpZWxkcyAqLyBmdW5jdGlvbiBJbCh0LCBlLCBuLCBzKSB7XG4gICAgaWYgKG5bMF0gPSBnZXRNb2R1bGFySW5zdGFuY2UoblswXSksIG5bMF0gaW5zdGFuY2VvZiBZaCkgcmV0dXJuIGZ1bmN0aW9uKHQsIGUsIG4sIHMsIGkpIHtcbiAgICAgICAgaWYgKCFzKSB0aHJvdyBuZXcgTChCLk5PVF9GT1VORCwgYENhbid0IHVzZSBhIERvY3VtZW50U25hcHNob3QgdGhhdCBkb2Vzbid0IGV4aXN0IGZvciAke259KCkuYCk7XG4gICAgICAgIGNvbnN0IHIgPSBbXTtcbiAgICAgICAgLy8gQmVjYXVzZSBwZW9wbGUgZXhwZWN0IHRvIGNvbnRpbnVlL2VuZCBhIHF1ZXJ5IGF0IHRoZSBleGFjdCBkb2N1bWVudFxuICAgICAgICAvLyBwcm92aWRlZCwgd2UgbmVlZCB0byB1c2UgdGhlIGltcGxpY2l0IHNvcnQgb3JkZXIgcmF0aGVyIHRoYW4gdGhlIGV4cGxpY2l0XG4gICAgICAgIC8vIHNvcnQgb3JkZXIsIGJlY2F1c2UgaXQncyBndWFyYW50ZWVkIHRvIGNvbnRhaW4gdGhlIGRvY3VtZW50IGtleS4gVGhhdCB3YXlcbiAgICAgICAgLy8gdGhlIHBvc2l0aW9uIGJlY29tZXMgdW5hbWJpZ3VvdXMgYW5kIHRoZSBxdWVyeSBjb250aW51ZXMvZW5kcyBleGFjdGx5IGF0XG4gICAgICAgIC8vIHRoZSBwcm92aWRlZCBkb2N1bWVudC4gV2l0aG91dCB0aGUga2V5IChieSB1c2luZyB0aGUgZXhwbGljaXQgc29ydFxuICAgICAgICAvLyBvcmRlcnMpLCBtdWx0aXBsZSBkb2N1bWVudHMgY291bGQgbWF0Y2ggdGhlIHBvc2l0aW9uLCB5aWVsZGluZyBkdXBsaWNhdGVcbiAgICAgICAgLy8gcmVzdWx0cy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgbW4odCkpIGlmIChuLmZpZWxkLmlzS2V5RmllbGQoKSkgci5wdXNoKGNlKGUsIHMua2V5KSk7IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdCA9IHMuZGF0YS5maWVsZChuLmZpZWxkKTtcbiAgICAgICAgICAgIGlmIChKdCh0KSkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCAnSW52YWxpZCBxdWVyeS4gWW91IGFyZSB0cnlpbmcgdG8gc3RhcnQgb3IgZW5kIGEgcXVlcnkgdXNpbmcgYSBkb2N1bWVudCBmb3Igd2hpY2ggdGhlIGZpZWxkIFwiJyArIG4uZmllbGQgKyAnXCIgaXMgYW4gdW5jb21taXR0ZWQgc2VydmVyIHRpbWVzdGFtcC4gKFNpbmNlIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIGlzIHVua25vd24sIHlvdSBjYW5ub3Qgc3RhcnQvZW5kIGEgcXVlcnkgd2l0aCBpdC4pJyk7XG4gICAgICAgICAgICBpZiAobnVsbCA9PT0gdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBuLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFlvdSBhcmUgdHJ5aW5nIHRvIHN0YXJ0IG9yIGVuZCBhIHF1ZXJ5IHVzaW5nIGEgZG9jdW1lbnQgZm9yIHdoaWNoIHRoZSBmaWVsZCAnJHt0fScgKHVzZWQgYXMgdGhlIG9yZGVyQnkpIGRvZXMgbm90IGV4aXN0LmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgci5wdXNoKHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgSWUociwgaSk7XG4gICAgfVxuICAgIC8qKlxuICogQ29udmVydHMgYSBsaXN0IG9mIGZpZWxkIHZhbHVlcyB0byBhIGBCb3VuZGAgZm9yIHRoZSBnaXZlbiBxdWVyeS5cbiAqLyAodC5fcXVlcnksIHQuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCBlLCBuWzBdLl9kb2N1bWVudCwgcyk7XG4gICAge1xuICAgICAgICBjb25zdCBpID0gQ2godC5maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24odCwgZSwgbiwgcywgaSwgcikge1xuICAgICAgICAgICAgLy8gVXNlIGV4cGxpY2l0IG9yZGVyIGJ5J3MgYmVjYXVzZSBpdCBoYXMgdG8gbWF0Y2ggdGhlIHF1ZXJ5IHRoZSB1c2VyIG1hZGVcbiAgICAgICAgICAgIGNvbnN0IG8gPSB0LmV4cGxpY2l0T3JkZXJCeTtcbiAgICAgICAgICAgIGlmIChpLmxlbmd0aCA+IG8ubGVuZ3RoKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBUb28gbWFueSBhcmd1bWVudHMgcHJvdmlkZWQgdG8gJHtzfSgpLiBUaGUgbnVtYmVyIG9mIGFyZ3VtZW50cyBtdXN0IGJlIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIG9yZGVyQnkoKSBjbGF1c2VzYCk7XG4gICAgICAgICAgICBjb25zdCB1ID0gW107XG4gICAgICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IGkubGVuZ3RoOyByKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjID0gaVtyXTtcbiAgICAgICAgICAgICAgICBpZiAob1tyXS5maWVsZC5pc0tleUZpZWxkKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFwic3RyaW5nXCIgIT0gdHlwZW9mIGMpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIEV4cGVjdGVkIGEgc3RyaW5nIGZvciBkb2N1bWVudCBJRCBpbiAke3N9KCksIGJ1dCBnb3QgYSAke3R5cGVvZiBjfWApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXduKHQpICYmIC0xICE9PSBjLmluZGV4T2YoXCIvXCIpKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBhbmQgb3JkZXJpbmcgYnkgZG9jdW1lbnRJZCgpLCB0aGUgdmFsdWUgcGFzc2VkIHRvICR7c30oKSBtdXN0IGJlIGEgcGxhaW4gZG9jdW1lbnQgSUQsIGJ1dCAnJHtjfScgY29udGFpbnMgYSBzbGFzaC5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHQucGF0aC5jaGlsZChydC5mcm9tU3RyaW5nKGMpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdC5pc0RvY3VtZW50S2V5KG4pKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBncm91cCBhbmQgb3JkZXJpbmcgYnkgZG9jdW1lbnRJZCgpLCB0aGUgdmFsdWUgcGFzc2VkIHRvICR7c30oKSBtdXN0IHJlc3VsdCBpbiBhIHZhbGlkIGRvY3VtZW50IHBhdGgsIGJ1dCAnJHtufScgaXMgbm90IGJlY2F1c2UgaXQgY29udGFpbnMgYW4gb2RkIG51bWJlciBvZiBzZWdtZW50cy5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBjdChuKTtcbiAgICAgICAgICAgICAgICAgICAgdS5wdXNoKGNlKGUsIGkpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gcWgobiwgcywgYyk7XG4gICAgICAgICAgICAgICAgICAgIHUucHVzaCh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IEllKHUsIHIpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUGFyc2VzIHRoZSBnaXZlbiBgZG9jdW1lbnRJZFZhbHVlYCBpbnRvIGEgYFJlZmVyZW5jZVZhbHVlYCwgdGhyb3dpbmdcbiAqIGFwcHJvcHJpYXRlIGVycm9ycyBpZiB0aGUgdmFsdWUgaXMgYW55dGhpbmcgb3RoZXIgdGhhbiBhIGBEb2N1bWVudFJlZmVyZW5jZWBcbiAqIG9yIGBzdHJpbmdgLCBvciBpZiB0aGUgc3RyaW5nIGlzIG1hbGZvcm1lZC5cbiAqLyAodC5fcXVlcnksIHQuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCBpLCBlLCBuLCBzKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIFRsKHQsIGUsIG4pIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgKG4gPSBnZXRNb2R1bGFySW5zdGFuY2UobikpKSB7XG4gICAgICAgIGlmIChcIlwiID09PSBuKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyB3aXRoIGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHZhbGlkIGRvY3VtZW50IElELCBidXQgaXQgd2FzIGFuIGVtcHR5IHN0cmluZy5cIik7XG4gICAgICAgIGlmICghd24oZSkgJiYgLTEgIT09IG4uaW5kZXhPZihcIi9cIikpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGJ5IGRvY3VtZW50SWQoKSwgeW91IG11c3QgcHJvdmlkZSBhIHBsYWluIGRvY3VtZW50IElELCBidXQgJyR7bn0nIGNvbnRhaW5zIGEgJy8nIGNoYXJhY3Rlci5gKTtcbiAgICAgICAgY29uc3QgcyA9IGUucGF0aC5jaGlsZChydC5mcm9tU3RyaW5nKG4pKTtcbiAgICAgICAgaWYgKCFjdC5pc0RvY3VtZW50S2V5KHMpKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBncm91cCBieSBkb2N1bWVudElkKCksIHRoZSB2YWx1ZSBwcm92aWRlZCBtdXN0IHJlc3VsdCBpbiBhIHZhbGlkIGRvY3VtZW50IHBhdGgsIGJ1dCAnJHtzfScgaXMgbm90IGJlY2F1c2UgaXQgaGFzIGFuIG9kZCBudW1iZXIgb2Ygc2VnbWVudHMgKCR7cy5sZW5ndGh9KS5gKTtcbiAgICAgICAgcmV0dXJuIGNlKHQsIG5ldyBjdChzKSk7XG4gICAgfVxuICAgIGlmIChuIGluc3RhbmNlb2YgeWEpIHJldHVybiBjZSh0LCBuLl9rZXkpO1xuICAgIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgd2l0aCBkb2N1bWVudElkKCksIHlvdSBtdXN0IHByb3ZpZGUgYSB2YWxpZCBzdHJpbmcgb3IgYSBEb2N1bWVudFJlZmVyZW5jZSwgYnV0IGl0IHdhczogJHtsYShuKX0uYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgdGhlIHZhbHVlIHBhc3NlZCBpbnRvIGEgZGlzanVuY3RpdmUgZmlsdGVyIHNhdGlzZmllcyBhbGxcbiAqIGFycmF5IHJlcXVpcmVtZW50cy5cbiAqLyBmdW5jdGlvbiBFbCh0LCBlKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHQpIHx8IDAgPT09IHQubGVuZ3RoKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIFF1ZXJ5LiBBIG5vbi1lbXB0eSBhcnJheSBpcyByZXF1aXJlZCBmb3IgJyR7ZS50b1N0cmluZygpfScgZmlsdGVycy5gKTtcbiAgICBpZiAodC5sZW5ndGggPiAxMCkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBRdWVyeS4gJyR7ZS50b1N0cmluZygpfScgZmlsdGVycyBzdXBwb3J0IGEgbWF4aW11bSBvZiAxMCBlbGVtZW50cyBpbiB0aGUgdmFsdWUgYXJyYXkuYCk7XG59XG5cbi8qKlxuICogR2l2ZW4gYW4gb3BlcmF0b3IsIHJldHVybnMgdGhlIHNldCBvZiBvcGVyYXRvcnMgdGhhdCBjYW5ub3QgYmUgdXNlZCB3aXRoIGl0LlxuICpcbiAqIE9wZXJhdG9ycyBpbiBhIHF1ZXJ5IG11c3QgYWRoZXJlIHRvIHRoZSBmb2xsb3dpbmcgc2V0IG9mIHJ1bGVzOlxuICogMS4gT25seSBvbmUgYXJyYXkgb3BlcmF0b3IgaXMgYWxsb3dlZC5cbiAqIDIuIE9ubHkgb25lIGRpc2p1bmN0aXZlIG9wZXJhdG9yIGlzIGFsbG93ZWQuXG4gKiAzLiBgTk9UX0VRVUFMYCBjYW5ub3QgYmUgdXNlZCB3aXRoIGFub3RoZXIgYE5PVF9FUVVBTGAgb3BlcmF0b3IuXG4gKiA0LiBgTk9UX0lOYCBjYW5ub3QgYmUgdXNlZCB3aXRoIGFycmF5LCBkaXNqdW5jdGl2ZSwgb3IgYE5PVF9FUVVBTGAgb3BlcmF0b3JzLlxuICpcbiAqIEFycmF5IG9wZXJhdG9yczogYEFSUkFZX0NPTlRBSU5TYCwgYEFSUkFZX0NPTlRBSU5TX0FOWWBcbiAqIERpc2p1bmN0aXZlIG9wZXJhdG9yczogYElOYCwgYEFSUkFZX0NPTlRBSU5TX0FOWWAsIGBOT1RfSU5gXG4gKi8gZnVuY3Rpb24gQWwodCwgZSkge1xuICAgIGlmIChlLmlzSW5lcXVhbGl0eSgpKSB7XG4gICAgICAgIGNvbnN0IG4gPSBfbih0KSwgcyA9IGUuZmllbGQ7XG4gICAgICAgIGlmIChudWxsICE9PSBuICYmICFuLmlzRXF1YWwocykpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIEFsbCB3aGVyZSBmaWx0ZXJzIHdpdGggYW4gaW5lcXVhbGl0eSAoPCwgPD0sICE9LCBub3QtaW4sID4sIG9yID49KSBtdXN0IGJlIG9uIHRoZSBzYW1lIGZpZWxkLiBCdXQgeW91IGhhdmUgaW5lcXVhbGl0eSBmaWx0ZXJzIG9uICcke24udG9TdHJpbmcoKX0nIGFuZCAnJHtzLnRvU3RyaW5nKCl9J2ApO1xuICAgICAgICBjb25zdCBpID0gZG4odCk7XG4gICAgICAgIG51bGwgIT09IGkgJiYgUmwodCwgcywgaSk7XG4gICAgfVxuICAgIGNvbnN0IG4gPSBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiB0KSBmb3IgKGNvbnN0IHQgb2Ygbi5nZXRGbGF0dGVuZWRGaWx0ZXJzKCkpIGlmIChlLmluZGV4T2YodC5vcCkgPj0gMCkgcmV0dXJuIHQub3A7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0odC5maWx0ZXJzLCBmdW5jdGlvbih0KSB7XG4gICAgICAgIHN3aXRjaCAodCkge1xuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gWyBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXTtcblxuICAgICAgICAgIGNhc2UgXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovIDpcbiAgICAgICAgICAgIHJldHVybiBbIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyAsIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovICwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXTtcblxuICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICAgIHJldHVybiBbIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovICwgXCJpblwiIC8qIE9wZXJhdG9yLklOICovICwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gXTtcblxuICAgICAgICAgIGNhc2UgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFsgXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovICwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gLCBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyBdO1xuXG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gWyBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gLCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyAsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovICwgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyBdO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH0oZS5vcCkpO1xuICAgIGlmIChudWxsICE9PSBuKSBcbiAgICAvLyBTcGVjaWFsIGNhc2Ugd2hlbiBpdCdzIGEgZHVwbGljYXRlIG9wIHRvIGdpdmUgYSBzbGlnaHRseSBjbGVhcmVyIGVycm9yIG1lc3NhZ2UuXG4gICAgdGhyb3cgbiA9PT0gZS5vcCA/IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFlvdSBjYW5ub3QgdXNlIG1vcmUgdGhhbiBvbmUgJyR7ZS5vcC50b1N0cmluZygpfScgZmlsdGVyLmApIDogbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGNhbm5vdCB1c2UgJyR7ZS5vcC50b1N0cmluZygpfScgZmlsdGVycyB3aXRoICcke24udG9TdHJpbmcoKX0nIGZpbHRlcnMuYCk7XG59XG5cbmZ1bmN0aW9uIFJsKHQsIGUsIG4pIHtcbiAgICBpZiAoIW4uaXNFcXVhbChlKSkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gWW91IGhhdmUgYSB3aGVyZSBmaWx0ZXIgd2l0aCBhbiBpbmVxdWFsaXR5ICg8LCA8PSwgIT0sIG5vdC1pbiwgPiwgb3IgPj0pIG9uIGZpZWxkICcke2UudG9TdHJpbmcoKX0nIGFuZCBzbyB5b3UgbXVzdCBhbHNvIHVzZSAnJHtlLnRvU3RyaW5nKCl9JyBhcyB5b3VyIGZpcnN0IGFyZ3VtZW50IHRvIG9yZGVyQnkoKSwgYnV0IHlvdXIgZmlyc3Qgb3JkZXJCeSgpIGlzIG9uIGZpZWxkICcke24udG9TdHJpbmcoKX0nIGluc3RlYWQuYCk7XG59XG5cbmZ1bmN0aW9uIGJsKHQsIGUpIHtcbiAgICBpZiAoIShlIGluc3RhbmNlb2YgaWwgfHwgZSBpbnN0YW5jZW9mIG9sKSkgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBgRnVuY3Rpb24gJHt0fSgpIHJlcXVpcmVzIEFwcGxpYWJsZUNvbnN0cmFpbnRzIGNyZWF0ZWQgd2l0aCBhIGNhbGwgdG8gJ3doZXJlKC4uLiknLCAnb3IoLi4uKScsIG9yICdhbmQoLi4uKScuYCk7XG59XG5cbmNsYXNzIFBsIHtcbiAgICBjb252ZXJ0VmFsdWUodCwgZSA9IFwibm9uZVwiKSB7XG4gICAgICAgIHN3aXRjaCAoZWUodCkpIHtcbiAgICAgICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICAgIGNhc2UgMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0LmJvb2xlYW5WYWx1ZTtcblxuICAgICAgICAgIGNhc2UgMiAvKiBUeXBlT3JkZXIuTnVtYmVyVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHp0KHQuaW50ZWdlclZhbHVlIHx8IHQuZG91YmxlVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKHQudGltZXN0YW1wVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0U2VydmVyVGltZXN0YW1wKHQsIGUpO1xuXG4gICAgICAgICAgY2FzZSA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdC5zdHJpbmdWYWx1ZTtcblxuICAgICAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRCeXRlcyhIdCh0LmJ5dGVzVmFsdWUpKTtcblxuICAgICAgICAgIGNhc2UgNyAvKiBUeXBlT3JkZXIuUmVmVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydFJlZmVyZW5jZSh0LnJlZmVyZW5jZVZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0R2VvUG9pbnQodC5nZW9Qb2ludFZhbHVlKTtcblxuICAgICAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0QXJyYXkodC5hcnJheVZhbHVlLCBlKTtcblxuICAgICAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRPYmplY3QodC5tYXBWYWx1ZSwgZSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgTygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnZlcnRPYmplY3QodCwgZSkge1xuICAgICAgICBjb25zdCBuID0ge307XG4gICAgICAgIHJldHVybiBCdCh0LmZpZWxkcywgKCh0LCBzKSA9PiB7XG4gICAgICAgICAgICBuW3RdID0gdGhpcy5jb252ZXJ0VmFsdWUocywgZSk7XG4gICAgICAgIH0pKSwgbjtcbiAgICB9XG4gICAgY29udmVydEdlb1BvaW50KHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSaCh6dCh0LmxhdGl0dWRlKSwgenQodC5sb25naXR1ZGUpKTtcbiAgICB9XG4gICAgY29udmVydEFycmF5KHQsIGUpIHtcbiAgICAgICAgcmV0dXJuICh0LnZhbHVlcyB8fCBbXSkubWFwKCh0ID0+IHRoaXMuY29udmVydFZhbHVlKHQsIGUpKSk7XG4gICAgfVxuICAgIGNvbnZlcnRTZXJ2ZXJUaW1lc3RhbXAodCwgZSkge1xuICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICBjYXNlIFwicHJldmlvdXNcIjpcbiAgICAgICAgICAgIGNvbnN0IG4gPSBZdCh0KTtcbiAgICAgICAgICAgIHJldHVybiBudWxsID09IG4gPyBudWxsIDogdGhpcy5jb252ZXJ0VmFsdWUobiwgZSk7XG5cbiAgICAgICAgICBjYXNlIFwiZXN0aW1hdGVcIjpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRUaW1lc3RhbXAoWHQodCkpO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnZlcnRUaW1lc3RhbXAodCkge1xuICAgICAgICBjb25zdCBlID0gV3QodCk7XG4gICAgICAgIHJldHVybiBuZXcgbnQoZS5zZWNvbmRzLCBlLm5hbm9zKTtcbiAgICB9XG4gICAgY29udmVydERvY3VtZW50S2V5KHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IHJ0LmZyb21TdHJpbmcodCk7XG4gICAgICAgIE0od2kobikpO1xuICAgICAgICBjb25zdCBzID0gbmV3IEZ0KG4uZ2V0KDEpLCBuLmdldCgzKSksIGkgPSBuZXcgY3Qobi5wb3BGaXJzdCg1KSk7XG4gICAgICAgIHJldHVybiBzLmlzRXF1YWwoZSkgfHwgXG4gICAgICAgIC8vIFRPRE8oYi82NDEzMDIwMik6IFNvbWVob3cgc3VwcG9ydCBmb3JlaWduIHJlZmVyZW5jZXMuXG4gICAgICAgIHgoYERvY3VtZW50ICR7aX0gY29udGFpbnMgYSBkb2N1bWVudCByZWZlcmVuY2Ugd2l0aGluIGEgZGlmZmVyZW50IGRhdGFiYXNlICgke3MucHJvamVjdElkfS8ke3MuZGF0YWJhc2V9KSB3aGljaCBpcyBub3Qgc3VwcG9ydGVkLiBJdCB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWZlcmVuY2UgaW4gdGhlIGN1cnJlbnQgZGF0YWJhc2UgKCR7ZS5wcm9qZWN0SWR9LyR7ZS5kYXRhYmFzZX0pIGluc3RlYWQuYCksIFxuICAgICAgICBpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ29udmVydHMgY3VzdG9tIG1vZGVsIG9iamVjdCBvZiB0eXBlIFQgaW50byBgRG9jdW1lbnREYXRhYCBieSBhcHBseWluZyB0aGVcbiAqIGNvbnZlcnRlciBpZiBpdCBleGlzdHMuXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHdoZW4gY29udmVydGluZyB1c2VyIG9iamVjdHMgdG8gYERvY3VtZW50RGF0YWBcbiAqIGJlY2F1c2Ugd2Ugd2FudCB0byBwcm92aWRlIHRoZSB1c2VyIHdpdGggYSBtb3JlIHNwZWNpZmljIGVycm9yIG1lc3NhZ2UgaWZcbiAqIHRoZWlyIGBzZXQoKWAgb3IgZmFpbHMgZHVlIHRvIGludmFsaWQgZGF0YSBvcmlnaW5hdGluZyBmcm9tIGEgYHRvRmlyZXN0b3JlKClgXG4gKiBjYWxsLlxuICovIGZ1bmN0aW9uIHZsKHQsIGUsIG4pIHtcbiAgICBsZXQgcztcbiAgICAvLyBDYXN0IHRvIGBhbnlgIGluIG9yZGVyIHRvIHNhdGlzZnkgdGhlIHVuaW9uIHR5cGUgY29uc3RyYWludCBvblxuICAgIC8vIHRvRmlyZXN0b3JlKCkuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICByZXR1cm4gcyA9IHQgPyBuICYmIChuLm1lcmdlIHx8IG4ubWVyZ2VGaWVsZHMpID8gdC50b0ZpcmVzdG9yZShlLCBuKSA6IHQudG9GaXJlc3RvcmUoZSkgOiBlLCBcbiAgICBzO1xufVxuXG5jbGFzcyBWbCBleHRlbmRzIFBsIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZmlyZXN0b3JlID0gdDtcbiAgICB9XG4gICAgY29udmVydEJ5dGVzKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJaCh0KTtcbiAgICB9XG4gICAgY29udmVydFJlZmVyZW5jZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmNvbnZlcnREb2N1bWVudEtleSh0LCB0aGlzLmZpcmVzdG9yZS5fZGF0YWJhc2VJZCk7XG4gICAgICAgIHJldHVybiBuZXcgeWEodGhpcy5maXJlc3RvcmUsIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBNZXRhZGF0YSBhYm91dCBhIHNuYXBzaG90LCBkZXNjcmliaW5nIHRoZSBzdGF0ZSBvZiB0aGUgc25hcHNob3QuXG4gKi8gY2xhc3MgU2wge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICB0aGlzLmhhc1BlbmRpbmdXcml0ZXMgPSB0LCB0aGlzLmZyb21DYWNoZSA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBTbmFwc2hvdE1ldGFkYXRhYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBTbmFwc2hvdE1ldGFkYXRhYCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBTbmFwc2hvdE1ldGFkYXRhYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGFzUGVuZGluZ1dyaXRlcyA9PT0gdC5oYXNQZW5kaW5nV3JpdGVzICYmIHRoaXMuZnJvbUNhY2hlID09PSB0LmZyb21DYWNoZTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyIEZpcmVzdG9yZVxuICogZGF0YWJhc2UuIFRoZSBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvXG4gKiBnZXQgYSBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBGb3IgYSBgRG9jdW1lbnRTbmFwc2hvdGAgdGhhdCBwb2ludHMgdG8gYSBub24tZXhpc3RpbmcgZG9jdW1lbnQsIGFueSBkYXRhXG4gKiBhY2Nlc3Mgd2lsbCByZXR1cm4gJ3VuZGVmaW5lZCcuIFlvdSBjYW4gdXNlIHRoZSBgZXhpc3RzKClgIG1ldGhvZCB0b1xuICogZXhwbGljaXRseSB2ZXJpZnkgYSBkb2N1bWVudCdzIGV4aXN0ZW5jZS5cbiAqLyBjbGFzcyBEbCBleHRlbmRzIFloIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciBwcm90ZWN0ZWQgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzLCBpLCByKSB7XG4gICAgICAgIHN1cGVyKHQsIGUsIG4sIHMsIHIpLCB0aGlzLl9maXJlc3RvcmUgPSB0LCB0aGlzLl9maXJlc3RvcmVJbXBsID0gdCwgdGhpcy5tZXRhZGF0YSA9IGk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGRhdGEgZXhpc3RzLiBUcnVlIGlmIHRoZSBkb2N1bWVudCBleGlzdHMuXG4gICAgICovICAgIGV4aXN0cygpIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmV4aXN0cygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgYXMgYW4gYE9iamVjdGAuIFJldHVybnMgYHVuZGVmaW5lZGAgaWZcbiAgICAgKiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGBzZXJ2ZXJUaW1lc3RhbXAoKWAgdmFsdWVzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW5cbiAgICAgKiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGVcbiAgICAgKiB0aGlzIGJ5IHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgZGF0YSBpcyByZXRyaWV2ZWQgZnJvbVxuICAgICAqIHRoZSBzbmFwc2hvdCAoZm9yIGV4YW1wbGUgdGhlIGRlc2lyZWQgYmVoYXZpb3IgZm9yIHNlcnZlciB0aW1lc3RhbXBzIHRoYXRcbiAgICAgKiBoYXZlIG5vdCB5ZXQgYmVlbiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUpLlxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgb3IgYHVuZGVmaW5lZGAgaWZcbiAgICAgKiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgKi8gICAgZGF0YSh0ID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29udmVydGVyKSB7XG4gICAgICAgICAgICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHVzZSB0aGUgY29udmVydGVyIGFuZCBjcmVhdGUgYSBuZXcgRG9jdW1lbnRTbmFwc2hvdFxuICAgICAgICAgICAgICAgIC8vIGlmIGEgY29udmVydGVyIGhhcyBiZWVuIHByb3ZpZGVkLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgQ2wodGhpcy5fZmlyZXN0b3JlLCB0aGlzLl91c2VyRGF0YVdyaXRlciwgdGhpcy5fa2V5LCB0aGlzLl9kb2N1bWVudCwgdGhpcy5tZXRhZGF0YSwgXG4gICAgICAgICAgICAgICAgLyogY29udmVydGVyPSAqLyBudWxsKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydGVyLmZyb21GaXJlc3RvcmUoZSwgdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGFXcml0ZXIuY29udmVydFZhbHVlKHRoaXMuX2RvY3VtZW50LmRhdGEudmFsdWUsIHQuc2VydmVyVGltZXN0YW1wcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIHRoZSBmaWVsZCBzcGVjaWZpZWQgYnkgYGZpZWxkUGF0aGAuIFJldHVybnMgYHVuZGVmaW5lZGAgaWYgdGhlXG4gICAgICogZG9jdW1lbnQgb3IgZmllbGQgZG9lc24ndCBleGlzdC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGEgYHNlcnZlclRpbWVzdGFtcCgpYCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gc2V0IHRvXG4gICAgICogaXRzIGZpbmFsIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQgYXMgYG51bGxgLiBZb3UgY2FuIG92ZXJyaWRlIHRoaXMgYnlcbiAgICAgKiBwYXNzaW5nIGFuIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIChmb3IgZXhhbXBsZSAnZm9vJyBvciAnZm9vLmJhcicpIHRvIGEgc3BlY2lmaWNcbiAgICAgKiBmaWVsZC5cbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgdGhlIGZpZWxkIGlzIHJldHJpZXZlZFxuICAgICAqIGZyb20gdGhlIHNuYXBzaG90IChmb3IgZXhhbXBsZSB0aGUgZGVzaXJlZCBiZWhhdmlvciBmb3Igc2VydmVyIHRpbWVzdGFtcHNcbiAgICAgKiB0aGF0IGhhdmUgbm90IHlldCBiZWVuIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSkuXG4gICAgICogQHJldHVybnMgVGhlIGRhdGEgYXQgdGhlIHNwZWNpZmllZCBmaWVsZCBsb2NhdGlvbiBvciB1bmRlZmluZWQgaWYgbm8gc3VjaFxuICAgICAqIGZpZWxkIGV4aXN0cyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgLy8gV2UgYXJlIHVzaW5nIGBhbnlgIGhlcmUgdG8gYXZvaWQgYW4gZXhwbGljaXQgY2FzdCBieSBvdXIgdXNlcnMuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBnZXQodCwgZSA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuX2RvY3VtZW50LmRhdGEuZmllbGQoWmgoXCJEb2N1bWVudFNuYXBzaG90LmdldFwiLCB0KSk7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gbikgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZShuLCBlLnNlcnZlclRpbWVzdGFtcHMpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbnMgZGF0YSByZWFkIGZyb20gYSBkb2N1bWVudCBpbiB5b3VyXG4gKiBGaXJlc3RvcmUgZGF0YWJhc2UgYXMgcGFydCBvZiBhIHF1ZXJ5LiBUaGUgZG9jdW1lbnQgaXMgZ3VhcmFudGVlZCB0byBleGlzdFxuICogYW5kIGl0cyBkYXRhIGNhbiBiZSBleHRyYWN0ZWQgd2l0aCBgLmRhdGEoKWAgb3IgYC5nZXQoPGZpZWxkPilgIHRvIGdldCBhXG4gKiBzcGVjaWZpYyBmaWVsZC5cbiAqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIG9mZmVycyB0aGUgc2FtZSBBUEkgc3VyZmFjZSBhcyBhXG4gKiBgRG9jdW1lbnRTbmFwc2hvdGAuIFNpbmNlIHF1ZXJ5IHJlc3VsdHMgY29udGFpbiBvbmx5IGV4aXN0aW5nIGRvY3VtZW50cywgdGhlXG4gKiBgZXhpc3RzYCBwcm9wZXJ0eSB3aWxsIGFsd2F5cyBiZSB0cnVlIGFuZCBgZGF0YSgpYCB3aWxsIG5ldmVyIHJldHVyblxuICogJ3VuZGVmaW5lZCcuXG4gKi8gY2xhc3MgQ2wgZXh0ZW5kcyBEbCB7XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCwgYHNlcnZlclRpbWVzdGFtcCgpYCB2YWx1ZXMgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlblxuICAgICAqIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSB3aWxsIGJlIHJldHVybmVkIGFzIGBudWxsYC4gWW91IGNhbiBvdmVycmlkZVxuICAgICAqIHRoaXMgYnkgcGFzc2luZyBhbiBvcHRpb25zIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBvdmVycmlkZVxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQW4gb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIGhvdyBkYXRhIGlzIHJldHJpZXZlZCBmcm9tXG4gICAgICogdGhlIHNuYXBzaG90IChmb3IgZXhhbXBsZSB0aGUgZGVzaXJlZCBiZWhhdmlvciBmb3Igc2VydmVyIHRpbWVzdGFtcHMgdGhhdFxuICAgICAqIGhhdmUgbm90IHlldCBiZWVuIHNldCB0byB0aGVpciBmaW5hbCB2YWx1ZSkuXG4gICAgICogQHJldHVybnMgQW4gYE9iamVjdGAgY29udGFpbmluZyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICBkYXRhKHQgPSB7fSkge1xuICAgICAgICByZXR1cm4gc3VwZXIuZGF0YSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgUXVlcnlTbmFwc2hvdGAgY29udGFpbnMgemVybyBvciBtb3JlIGBEb2N1bWVudFNuYXBzaG90YCBvYmplY3RzXG4gKiByZXByZXNlbnRpbmcgdGhlIHJlc3VsdHMgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50cyBjYW4gYmUgYWNjZXNzZWQgYXMgYW5cbiAqIGFycmF5IHZpYSB0aGUgYGRvY3NgIHByb3BlcnR5IG9yIGVudW1lcmF0ZWQgdXNpbmcgdGhlIGBmb3JFYWNoYCBtZXRob2QuIFRoZVxuICogbnVtYmVyIG9mIGRvY3VtZW50cyBjYW4gYmUgZGV0ZXJtaW5lZCB2aWEgdGhlIGBlbXB0eWAgYW5kIGBzaXplYFxuICogcHJvcGVydGllcy5cbiAqLyBjbGFzcyB4bCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3Rvcih0LCBlLCBuLCBzKSB7XG4gICAgICAgIHRoaXMuX2ZpcmVzdG9yZSA9IHQsIHRoaXMuX3VzZXJEYXRhV3JpdGVyID0gZSwgdGhpcy5fc25hcHNob3QgPSBzLCB0aGlzLm1ldGFkYXRhID0gbmV3IFNsKHMuaGFzUGVuZGluZ1dyaXRlcywgcy5mcm9tQ2FjaGUpLCBcbiAgICAgICAgdGhpcy5xdWVyeSA9IG47XG4gICAgfVxuICAgIC8qKiBBbiBhcnJheSBvZiBhbGwgdGhlIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLiAqLyAgICBnZXQgZG9jcygpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKChlID0+IHQucHVzaChlKSkpLCB0O1xuICAgIH1cbiAgICAvKiogVGhlIG51bWJlciBvZiBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC4gKi8gICAgZ2V0IHNpemUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zbmFwc2hvdC5kb2NzLnNpemU7XG4gICAgfVxuICAgIC8qKiBUcnVlIGlmIHRoZXJlIGFyZSBubyBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC4gKi8gICAgZ2V0IGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5zaXplO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnVtZXJhdGVzIGFsbCBvZiB0aGUgZG9jdW1lbnRzIGluIHRoZSBgUXVlcnlTbmFwc2hvdGAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aXRoIGEgYFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdGAgZm9yXG4gICAgICogZWFjaCBkb2N1bWVudCBpbiB0aGUgc25hcHNob3QuXG4gICAgICogQHBhcmFtIHRoaXNBcmcgLSBUaGUgYHRoaXNgIGJpbmRpbmcgZm9yIHRoZSBjYWxsYmFjay5cbiAgICAgKi8gICAgZm9yRWFjaCh0LCBlKSB7XG4gICAgICAgIHRoaXMuX3NuYXBzaG90LmRvY3MuZm9yRWFjaCgobiA9PiB7XG4gICAgICAgICAgICB0LmNhbGwoZSwgbmV3IENsKHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIG4ua2V5LCBuLCBuZXcgU2wodGhpcy5fc25hcHNob3QubXV0YXRlZEtleXMuaGFzKG4ua2V5KSwgdGhpcy5fc25hcHNob3QuZnJvbUNhY2hlKSwgdGhpcy5xdWVyeS5jb252ZXJ0ZXIpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIHRoZSBkb2N1bWVudHMgY2hhbmdlcyBzaW5jZSB0aGUgbGFzdCBzbmFwc2hvdC4gSWYgdGhpc1xuICAgICAqIGlzIHRoZSBmaXJzdCBzbmFwc2hvdCwgYWxsIGRvY3VtZW50cyB3aWxsIGJlIGluIHRoZSBsaXN0IGFzICdhZGRlZCdcbiAgICAgKiBjaGFuZ2VzLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBgU25hcHNob3RMaXN0ZW5PcHRpb25zYCB0aGF0IGNvbnRyb2wgd2hldGhlciBtZXRhZGF0YS1vbmx5XG4gICAgICogY2hhbmdlcyAoaS5lLiBvbmx5IGBEb2N1bWVudFNuYXBzaG90Lm1ldGFkYXRhYCBjaGFuZ2VkKSBzaG91bGQgdHJpZ2dlclxuICAgICAqIHNuYXBzaG90IGV2ZW50cy5cbiAgICAgKi8gICAgZG9jQ2hhbmdlcyh0ID0ge30pIHtcbiAgICAgICAgY29uc3QgZSA9ICEhdC5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzO1xuICAgICAgICBpZiAoZSAmJiB0aGlzLl9zbmFwc2hvdC5leGNsdWRlc01ldGFkYXRhQ2hhbmdlcykgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIlRvIGluY2x1ZGUgbWV0YWRhdGEgY2hhbmdlcyB3aXRoIHlvdXIgZG9jdW1lbnQgY2hhbmdlcywgeW91IG11c3QgYWxzbyBwYXNzIHsgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczp0cnVlIH0gdG8gb25TbmFwc2hvdCgpLlwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZENoYW5nZXMgJiYgdGhpcy5fY2FjaGVkQ2hhbmdlc0luY2x1ZGVNZXRhZGF0YUNoYW5nZXMgPT09IGUgfHwgKHRoaXMuX2NhY2hlZENoYW5nZXMgPSBcbiAgICAgICAgLyoqIENhbGN1bGF0ZXMgdGhlIGFycmF5IG9mIGBEb2N1bWVudENoYW5nZWBzIGZvciBhIGdpdmVuIGBWaWV3U25hcHNob3RgLiAqL1xuICAgICAgICBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAodC5fc25hcHNob3Qub2xkRG9jcy5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgZSA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuX3NuYXBzaG90LmRvY0NoYW5nZXMubWFwKChuID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IG5ldyBDbCh0Ll9maXJlc3RvcmUsIHQuX3VzZXJEYXRhV3JpdGVyLCBuLmRvYy5rZXksIG4uZG9jLCBuZXcgU2wodC5fc25hcHNob3QubXV0YXRlZEtleXMuaGFzKG4uZG9jLmtleSksIHQuX3NuYXBzaG90LmZyb21DYWNoZSksIHQucXVlcnkuY29udmVydGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uZG9jLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImFkZGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2M6IHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRJbmRleDogLTEsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdJbmRleDogZSsrXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8vIEEgYERvY3VtZW50U2V0YCB0aGF0IGlzIHVwZGF0ZWQgaW5jcmVtZW50YWxseSBhcyBjaGFuZ2VzIGFyZSBhcHBsaWVkIHRvIHVzZVxuICAgICAgICAgICAgICAgIC8vIHRvIGxvb2t1cCB0aGUgaW5kZXggb2YgYSBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICBsZXQgbiA9IHQuX3NuYXBzaG90Lm9sZERvY3M7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuX3NuYXBzaG90LmRvY0NoYW5nZXMuZmlsdGVyKCh0ID0+IGUgfHwgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovICE9PSB0LnR5cGUpKS5tYXAoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gbmV3IENsKHQuX2ZpcmVzdG9yZSwgdC5fdXNlckRhdGFXcml0ZXIsIGUuZG9jLmtleSwgZS5kb2MsIG5ldyBTbCh0Ll9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXMoZS5kb2Mua2V5KSwgdC5fc25hcHNob3QuZnJvbUNhY2hlKSwgdC5xdWVyeS5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IC0xLCByID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gIT09IGUudHlwZSAmJiAoaSA9IG4uaW5kZXhPZihlLmRvYy5rZXkpLCBuID0gbi5kZWxldGUoZS5kb2Mua2V5KSksIFxuICAgICAgICAgICAgICAgICAgICAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAhPT0gZS50eXBlICYmIChuID0gbi5hZGQoZS5kb2MpLCByID0gbi5pbmRleE9mKGUuZG9jLmtleSkpLCBcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogTmwoZS50eXBlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYzogcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEluZGV4OiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SW5kZXg6IHJcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0odGhpcywgZSksIHRoaXMuX2NhY2hlZENoYW5nZXNJbmNsdWRlTWV0YWRhdGFDaGFuZ2VzID0gZSksIHRoaXMuX2NhY2hlZENoYW5nZXM7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBObCh0KSB7XG4gICAgc3dpdGNoICh0KSB7XG4gICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgIHJldHVybiBcImFkZGVkXCI7XG5cbiAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgIGNhc2UgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovIDpcbiAgICAgICAgcmV0dXJuIFwibW9kaWZpZWRcIjtcblxuICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgIHJldHVybiBcInJlbW92ZWRcIjtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIE8oKTtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JlZXhwKTogQWRkIHRlc3RzIGZvciBzbmFwc2hvdEVxdWFsIHdpdGggZGlmZmVyZW50IHNuYXBzaG90XG4vLyBtZXRhZGF0YVxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZGVkIHNuYXBzaG90cyBhcmUgZXF1YWwuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBBIHNuYXBzaG90IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBBIHNuYXBzaG90IHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBzbmFwc2hvdHMgYXJlIGVxdWFsLlxuICovIGZ1bmN0aW9uIGtsKHQsIGUpIHtcbiAgICByZXR1cm4gdCBpbnN0YW5jZW9mIERsICYmIGUgaW5zdGFuY2VvZiBEbCA/IHQuX2ZpcmVzdG9yZSA9PT0gZS5fZmlyZXN0b3JlICYmIHQuX2tleS5pc0VxdWFsKGUuX2tleSkgJiYgKG51bGwgPT09IHQuX2RvY3VtZW50ID8gbnVsbCA9PT0gZS5fZG9jdW1lbnQgOiB0Ll9kb2N1bWVudC5pc0VxdWFsKGUuX2RvY3VtZW50KSkgJiYgdC5fY29udmVydGVyID09PSBlLl9jb252ZXJ0ZXIgOiB0IGluc3RhbmNlb2YgeGwgJiYgZSBpbnN0YW5jZW9mIHhsICYmICh0Ll9maXJlc3RvcmUgPT09IGUuX2ZpcmVzdG9yZSAmJiBiYSh0LnF1ZXJ5LCBlLnF1ZXJ5KSAmJiB0Lm1ldGFkYXRhLmlzRXF1YWwoZS5tZXRhZGF0YSkgJiYgdC5fc25hcHNob3QuaXNFcXVhbChlLl9zbmFwc2hvdCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgLlxuICpcbiAqIE5vdGU6IGBnZXREb2MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieSB3YWl0aW5nXG4gKiBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWYgeW91IGFyZVxuICogb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLCBpbnZva2VcbiAqIHtAbGluayBnZXREb2NGcm9tQ2FjaGV9IG9yIHtAbGluayBnZXREb2NGcm9tU2VydmVyfS5cbiAqXG4gKiBAcGFyYW0gcmVmZXJlbmNlIC0gVGhlIHJlZmVyZW5jZSBvZiB0aGUgZG9jdW1lbnQgdG8gZmV0Y2guXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqLyBmdW5jdGlvbiBPbCh0KSB7XG4gICAgdCA9IGZhKHQsIHlhKTtcbiAgICBjb25zdCBlID0gZmEodC5maXJlc3RvcmUsIGloKTtcbiAgICByZXR1cm4gemEodWgoZSksIHQuX2tleSkudGhlbigobiA9PiBIbChlLCB0LCBuKSkpO1xufVxuXG5jbGFzcyBNbCBleHRlbmRzIFBsIHtcbiAgICBjb25zdHJ1Y3Rvcih0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZmlyZXN0b3JlID0gdDtcbiAgICB9XG4gICAgY29udmVydEJ5dGVzKHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJaCh0KTtcbiAgICB9XG4gICAgY29udmVydFJlZmVyZW5jZSh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmNvbnZlcnREb2N1bWVudEtleSh0LCB0aGlzLmZpcmVzdG9yZS5fZGF0YWJhc2VJZCk7XG4gICAgICAgIHJldHVybiBuZXcgeWEodGhpcy5maXJlc3RvcmUsIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJlYWRzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGlzIGBEb2N1bWVudFJlZmVyZW5jZWAgZnJvbSBjYWNoZS5cbiAqIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIGRvY3VtZW50IGlzIG5vdCBjdXJyZW50bHkgY2FjaGVkLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHJlc29sdmVkIHdpdGggYSBgRG9jdW1lbnRTbmFwc2hvdGAgY29udGFpbmluZyB0aGVcbiAqIGN1cnJlbnQgZG9jdW1lbnQgY29udGVudHMuXG4gKi8gZnVuY3Rpb24gRmwodCkge1xuICAgIHQgPSBmYSh0LCB5YSk7XG4gICAgY29uc3QgZSA9IGZhKHQuZmlyZXN0b3JlLCBpaCksIG4gPSB1aChlKSwgcyA9IG5ldyBNbChlKTtcbiAgICByZXR1cm4gV2EobiwgdC5fa2V5KS50aGVuKChuID0+IG5ldyBEbChlLCBzLCB0Ll9rZXksIG4sIG5ldyBTbChudWxsICE9PSBuICYmIG4uaGFzTG9jYWxNdXRhdGlvbnMsIFxuICAgIC8qIGZyb21DYWNoZT0gKi8gITApLCB0LmNvbnZlcnRlcikpKTtcbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGZyb20gdGhlIHNlcnZlci5cbiAqIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIG5ldHdvcmsgaXMgbm90IGF2YWlsYWJsZS5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5pbmcgdGhlXG4gKiBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzLlxuICovIGZ1bmN0aW9uICRsKHQpIHtcbiAgICB0ID0gZmEodCwgeWEpO1xuICAgIGNvbnN0IGUgPSBmYSh0LmZpcmVzdG9yZSwgaWgpO1xuICAgIHJldHVybiB6YSh1aChlKSwgdC5fa2V5LCB7XG4gICAgICAgIHNvdXJjZTogXCJzZXJ2ZXJcIlxuICAgIH0pLnRoZW4oKG4gPT4gSGwoZSwgdCwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAuXG4gKlxuICogTm90ZTogYGdldERvY3MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieVxuICogd2FpdGluZyBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWZcbiAqIHlvdSBhcmUgb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLFxuICogaW52b2tlIHtAbGluayBnZXREb2NzRnJvbUNhY2hlfSBvciB7QGxpbmsgZ2V0RG9jc0Zyb21TZXJ2ZXJ9LlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBCbCh0KSB7XG4gICAgdCA9IGZhKHQsIHBhKTtcbiAgICBjb25zdCBlID0gZmEodC5maXJlc3RvcmUsIGloKSwgbiA9IHVoKGUpLCBzID0gbmV3IE1sKGUpO1xuICAgIHJldHVybiB0bCh0Ll9xdWVyeSksIEphKG4sIHQuX3F1ZXJ5KS50aGVuKChuID0+IG5ldyB4bChlLCBzLCB0LCBuKSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBxdWVyeSBhbmQgcmV0dXJucyB0aGUgcmVzdWx0cyBhcyBhIGBRdWVyeVNuYXBzaG90YCBmcm9tIGNhY2hlLlxuICogUmV0dXJucyBhbiBlbXB0eSByZXN1bHQgc2V0IGlmIG5vIGRvY3VtZW50cyBtYXRjaGluZyB0aGUgcXVlcnkgYXJlIGN1cnJlbnRseVxuICogY2FjaGVkLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBMbCh0KSB7XG4gICAgdCA9IGZhKHQsIHBhKTtcbiAgICBjb25zdCBlID0gZmEodC5maXJlc3RvcmUsIGloKSwgbiA9IHVoKGUpLCBzID0gbmV3IE1sKGUpO1xuICAgIHJldHVybiBIYShuLCB0Ll9xdWVyeSkudGhlbigobiA9PiBuZXcgeGwoZSwgcywgdCwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAgZnJvbSB0aGVcbiAqIHNlcnZlci4gUmV0dXJucyBhbiBlcnJvciBpZiB0aGUgbmV0d29yayBpcyBub3QgYXZhaWxhYmxlLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBxbCh0KSB7XG4gICAgdCA9IGZhKHQsIHBhKTtcbiAgICBjb25zdCBlID0gZmEodC5maXJlc3RvcmUsIGloKSwgbiA9IHVoKGUpLCBzID0gbmV3IE1sKGUpO1xuICAgIHJldHVybiBKYShuLCB0Ll9xdWVyeSwge1xuICAgICAgICBzb3VyY2U6IFwic2VydmVyXCJcbiAgICB9KS50aGVuKChuID0+IG5ldyB4bChlLCBzLCB0LCBuKSkpO1xufVxuXG5mdW5jdGlvbiBVbCh0LCBlLCBuKSB7XG4gICAgdCA9IGZhKHQsIHlhKTtcbiAgICBjb25zdCBzID0gZmEodC5maXJlc3RvcmUsIGloKSwgaSA9IHZsKHQuY29udmVydGVyLCBlLCBuKTtcbiAgICByZXR1cm4gemwocywgWyB4aChDaChzKSwgXCJzZXREb2NcIiwgdC5fa2V5LCBpLCBudWxsICE9PSB0LmNvbnZlcnRlciwgbikudG9NdXRhdGlvbih0Ll9rZXksIFFuLm5vbmUoKSkgXSk7XG59XG5cbmZ1bmN0aW9uIEtsKHQsIGUsIG4sIC4uLnMpIHtcbiAgICB0ID0gZmEodCwgeWEpO1xuICAgIGNvbnN0IGkgPSBmYSh0LmZpcmVzdG9yZSwgaWgpLCByID0gQ2goaSk7XG4gICAgbGV0IG87XG4gICAgbyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIChcbiAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKSB8fCBlIGluc3RhbmNlb2YgVGggPyBMaChyLCBcInVwZGF0ZURvY1wiLCB0Ll9rZXksIGUsIG4sIHMpIDogQmgociwgXCJ1cGRhdGVEb2NcIiwgdC5fa2V5LCBlKTtcbiAgICByZXR1cm4gemwoaSwgWyBvLnRvTXV0YXRpb24odC5fa2V5LCBRbi5leGlzdHMoITApKSBdKTtcbn1cblxuLyoqXG4gKiBEZWxldGVzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGUgc3BlY2lmaWVkIGBEb2N1bWVudFJlZmVyZW5jZWAuXG4gKlxuICogQHBhcmFtIHJlZmVyZW5jZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBkZWxldGUuXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgb25jZSB0aGUgZG9jdW1lbnQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5XG4gKiBkZWxldGVkIGZyb20gdGhlIGJhY2tlbmQgKG5vdGUgdGhhdCBpdCB3b24ndCByZXNvbHZlIHdoaWxlIHlvdSdyZSBvZmZsaW5lKS5cbiAqLyBmdW5jdGlvbiBHbCh0KSB7XG4gICAgcmV0dXJuIHpsKGZhKHQuZmlyZXN0b3JlLCBpaCksIFsgbmV3IGlzKHQuX2tleSwgUW4ubm9uZSgpKSBdKTtcbn1cblxuLyoqXG4gKiBBZGQgYSBuZXcgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGBDb2xsZWN0aW9uUmVmZXJlbmNlYCB3aXRoIHRoZSBnaXZlbiBkYXRhLFxuICogYXNzaWduaW5nIGl0IGEgZG9jdW1lbnQgSUQgYXV0b21hdGljYWxseS5cbiAqXG4gKiBAcGFyYW0gcmVmZXJlbmNlIC0gQSByZWZlcmVuY2UgdG8gdGhlIGNvbGxlY3Rpb24gdG8gYWRkIHRoaXMgZG9jdW1lbnQgdG8uXG4gKiBAcGFyYW0gZGF0YSAtIEFuIE9iamVjdCBjb250YWluaW5nIHRoZSBkYXRhIGZvciB0aGUgbmV3IGRvY3VtZW50LlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFJlZmVyZW5jZWAgcG9pbnRpbmcgdG8gdGhlXG4gKiBuZXdseSBjcmVhdGVkIGRvY3VtZW50IGFmdGVyIGl0IGhhcyBiZWVuIHdyaXR0ZW4gdG8gdGhlIGJhY2tlbmQgKE5vdGUgdGhhdCBpdFxuICogd29uJ3QgcmVzb2x2ZSB3aGlsZSB5b3UncmUgb2ZmbGluZSkuXG4gKi8gZnVuY3Rpb24gUWwodCwgZSkge1xuICAgIGNvbnN0IG4gPSBmYSh0LmZpcmVzdG9yZSwgaWgpLCBzID0gQWEodCksIGkgPSB2bCh0LmNvbnZlcnRlciwgZSk7XG4gICAgcmV0dXJuIHpsKG4sIFsgeGgoQ2godC5maXJlc3RvcmUpLCBcImFkZERvY1wiLCBzLl9rZXksIGksIG51bGwgIT09IHQuY29udmVydGVyLCB7fSkudG9NdXRhdGlvbihzLl9rZXksIFFuLmV4aXN0cyghMSkpIF0pLnRoZW4oKCgpID0+IHMpKTtcbn1cblxuZnVuY3Rpb24gamwodCwgLi4uZSkge1xuICAgIHZhciBuLCBzLCBpO1xuICAgIHQgPSBnZXRNb2R1bGFySW5zdGFuY2UodCk7XG4gICAgbGV0IHIgPSB7XG4gICAgICAgIGluY2x1ZGVNZXRhZGF0YUNoYW5nZXM6ICExXG4gICAgfSwgbyA9IDA7XG4gICAgXCJvYmplY3RcIiAhPSB0eXBlb2YgZVtvXSB8fCBlaChlW29dKSB8fCAociA9IGVbb10sIG8rKyk7XG4gICAgY29uc3QgdSA9IHtcbiAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogci5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzXG4gICAgfTtcbiAgICBpZiAoZWgoZVtvXSkpIHtcbiAgICAgICAgY29uc3QgdCA9IGVbb107XG4gICAgICAgIGVbb10gPSBudWxsID09PSAobiA9IHQubmV4dCkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5iaW5kKHQpLCBlW28gKyAxXSA9IG51bGwgPT09IChzID0gdC5lcnJvcikgfHwgdm9pZCAwID09PSBzID8gdm9pZCAwIDogcy5iaW5kKHQpLCBcbiAgICAgICAgZVtvICsgMl0gPSBudWxsID09PSAoaSA9IHQuY29tcGxldGUpIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkuYmluZCh0KTtcbiAgICB9XG4gICAgbGV0IGMsIGEsIGg7XG4gICAgaWYgKHQgaW5zdGFuY2VvZiB5YSkgYSA9IGZhKHQuZmlyZXN0b3JlLCBpaCksIGggPSBsbih0Ll9rZXkucGF0aCksIGMgPSB7XG4gICAgICAgIG5leHQ6IG4gPT4ge1xuICAgICAgICAgICAgZVtvXSAmJiBlW29dKEhsKGEsIHQsIG4pKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGVbbyArIDFdLFxuICAgICAgICBjb21wbGV0ZTogZVtvICsgMl1cbiAgICB9OyBlbHNlIHtcbiAgICAgICAgY29uc3QgbiA9IGZhKHQsIHBhKTtcbiAgICAgICAgYSA9IGZhKG4uZmlyZXN0b3JlLCBpaCksIGggPSBuLl9xdWVyeTtcbiAgICAgICAgY29uc3QgcyA9IG5ldyBNbChhKTtcbiAgICAgICAgYyA9IHtcbiAgICAgICAgICAgIG5leHQ6IHQgPT4ge1xuICAgICAgICAgICAgICAgIGVbb10gJiYgZVtvXShuZXcgeGwoYSwgcywgbiwgdCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBlW28gKyAxXSxcbiAgICAgICAgICAgIGNvbXBsZXRlOiBlW28gKyAyXVxuICAgICAgICB9LCB0bCh0Ll9xdWVyeSk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuLCBzKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgdmEocyksIHIgPSBuZXcgX2MoZSwgaSwgbik7XG4gICAgICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYWMoYXdhaXQgR2EodCksIHIpKSksICgpID0+IHtcbiAgICAgICAgICAgIGkuYmMoKSwgdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGhjKGF3YWl0IEdhKHQpLCByKSkpO1xuICAgICAgICB9O1xuICAgIH0odWgoYSksIGgsIHUsIGMpO1xufVxuXG5mdW5jdGlvbiBXbCh0LCBlKSB7XG4gICAgcmV0dXJuIFlhKHVoKHQgPSBmYSh0LCBpaCkpLCBlaChlKSA/IGUgOiB7XG4gICAgICAgIG5leHQ6IGVcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBMb2NhbGx5IHdyaXRlcyBgbXV0YXRpb25zYCBvbiB0aGUgYXN5bmMgcXVldWUuXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiB6bCh0LCBlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHQsIGUpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBxO1xuICAgICAgICByZXR1cm4gdC5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IFZjKGF3YWl0IFVhKHQpLCBlLCBuKSkpLCBuLnByb21pc2U7XG4gICAgfSh1aCh0KSwgZSk7XG59XG5cbi8qKlxuICogQ29udmVydHMgYSB7QGxpbmsgVmlld1NuYXBzaG90fSB0aGF0IGNvbnRhaW5zIHRoZSBzaW5nbGUgZG9jdW1lbnQgc3BlY2lmaWVkIGJ5IGByZWZgXG4gKiB0byBhIHtAbGluayBEb2N1bWVudFNuYXBzaG90fS5cbiAqLyBmdW5jdGlvbiBIbCh0LCBlLCBuKSB7XG4gICAgY29uc3QgcyA9IG4uZG9jcy5nZXQoZS5fa2V5KSwgaSA9IG5ldyBNbCh0KTtcbiAgICByZXR1cm4gbmV3IERsKHQsIGksIGUuX2tleSwgcywgbmV3IFNsKG4uaGFzUGVuZGluZ1dyaXRlcywgbi5mcm9tQ2FjaGUpLCBlLmNvbnZlcnRlcik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENvbXBhcmVzIHR3byBgQWdncmVnYXRlUXVlcnlTbmFwc2hvdGAgaW5zdGFuY2VzIGZvciBlcXVhbGl0eS5cbiAqXG4gKiBUd28gYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIGluc3RhbmNlcyBhcmUgY29uc2lkZXJlZCBcImVxdWFsXCIgaWYgdGhleSBoYXZlXG4gKiB1bmRlcmx5aW5nIHF1ZXJpZXMgdGhhdCBjb21wYXJlIGVxdWFsLCBhbmQgdGhlIHNhbWUgZGF0YS5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIFRoZSBmaXJzdCBgQWdncmVnYXRlUXVlcnlTbmFwc2hvdGAgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSByaWdodCAtIFRoZSBzZWNvbmQgYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIHRvIGNvbXBhcmUuXG4gKlxuICogQHJldHVybnMgYHRydWVgIGlmIHRoZSBvYmplY3RzIGFyZSBcImVxdWFsXCIsIGFzIGRlZmluZWQgYWJvdmUsIG9yIGBmYWxzZWBcbiAqIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBKbCh0LCBlKSB7XG4gICAgcmV0dXJuIGJhKHQucXVlcnksIGUucXVlcnkpICYmIGRlZXBFcXVhbCh0LmRhdGEoKSwgZS5kYXRhKCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDYWxjdWxhdGVzIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIGluIHRoZSByZXN1bHQgc2V0IG9mIHRoZSBnaXZlbiBxdWVyeSxcbiAqIHdpdGhvdXQgYWN0dWFsbHkgZG93bmxvYWRpbmcgdGhlIGRvY3VtZW50cy5cbiAqXG4gKiBVc2luZyB0aGlzIGZ1bmN0aW9uIHRvIGNvdW50IHRoZSBkb2N1bWVudHMgaXMgZWZmaWNpZW50IGJlY2F1c2Ugb25seSB0aGVcbiAqIGZpbmFsIGNvdW50LCBub3QgdGhlIGRvY3VtZW50cycgZGF0YSwgaXMgZG93bmxvYWRlZC4gVGhpcyBmdW5jdGlvbiBjYW4gZXZlblxuICogY291bnQgdGhlIGRvY3VtZW50cyBpZiB0aGUgcmVzdWx0IHNldCB3b3VsZCBiZSBwcm9oaWJpdGl2ZWx5IGxhcmdlIHRvXG4gKiBkb3dubG9hZCBlbnRpcmVseSAoZS5nLiB0aG91c2FuZHMgb2YgZG9jdW1lbnRzKS5cbiAqXG4gKiBUaGUgcmVzdWx0IHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlciBpcyBwcmVzZW50ZWQsIHVuYWx0ZXJlZCwgd2l0aG91dFxuICogY29uc2lkZXJpbmcgYW55IGxvY2FsIHN0YXRlLiBUaGF0IGlzLCBkb2N1bWVudHMgaW4gdGhlIGxvY2FsIGNhY2hlIGFyZSBub3RcbiAqIHRha2VuIGludG8gY29uc2lkZXJhdGlvbiwgbmVpdGhlciBhcmUgbG9jYWwgbW9kaWZpY2F0aW9ucyBub3QgeWV0XG4gKiBzeW5jaHJvbml6ZWQgd2l0aCB0aGUgc2VydmVyLiBQcmV2aW91c2x5LWRvd25sb2FkZWQgcmVzdWx0cywgaWYgYW55LCBhcmUgbm90XG4gKiB1c2VkOiBldmVyeSByZXF1ZXN0IHVzaW5nIHRoaXMgc291cmNlIG5lY2Vzc2FyaWx5IGludm9sdmVzIGEgcm91bmQgdHJpcCB0b1xuICogdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgd2hvc2UgcmVzdWx0IHNldCBzaXplIHRvIGNhbGN1bGF0ZS5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgY291bnQ7IHRoZSBjb3VudCBjYW4gYmVcbiAqIHJldHJpZXZlZCBmcm9tIGBzbmFwc2hvdC5kYXRhKCkuY291bnRgLCB3aGVyZSBgc25hcHNob3RgIGlzIHRoZVxuICogYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIHRvIHdoaWNoIHRoZSByZXR1cm5lZCBQcm9taXNlIHJlc29sdmVzLlxuICovIGZ1bmN0aW9uIFlsKHQpIHtcbiAgICBjb25zdCBlID0gZmEodC5maXJlc3RvcmUsIGloKTtcbiAgICByZXR1cm4gZnVuY3Rpb24odCwgZSwgbikge1xuICAgICAgICBjb25zdCBzID0gbmV3IHE7XG4gICAgICAgIHJldHVybiB0LmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoTXUoYXdhaXQgcWEodCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBhd2FpdCBLYSh0KSwgciA9IG5ldyBDYShlLCBpLCBuKS5ydW4oKTtcbiAgICAgICAgICAgICAgICAgICAgcy5yZXNvbHZlKHIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBzLnJlamVjdChuZXcgTChCLlVOQVZBSUxBQkxFLCBcIkZhaWxlZCB0byBnZXQgY291bnQgcmVzdWx0IGJlY2F1c2UgdGhlIGNsaWVudCBpcyBvZmZsaW5lLlwiKSk7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgcy5yZWplY3QodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgcy5wcm9taXNlO1xuICAgIH0odWgoZSksIHQsIG5ldyBNbChlKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IFhsID0ge1xuICAgIG1heEF0dGVtcHRzOiA1XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHdyaXRlIGJhdGNoLCB1c2VkIHRvIHBlcmZvcm0gbXVsdGlwbGUgd3JpdGVzIGFzIGEgc2luZ2xlIGF0b21pYyB1bml0LlxuICpcbiAqIEEgYFdyaXRlQmF0Y2hgIG9iamVjdCBjYW4gYmUgYWNxdWlyZWQgYnkgY2FsbGluZyB7QGxpbmsgd3JpdGVCYXRjaH0uIEl0XG4gKiBwcm92aWRlcyBtZXRob2RzIGZvciBhZGRpbmcgd3JpdGVzIHRvIHRoZSB3cml0ZSBiYXRjaC4gTm9uZSBvZiB0aGUgd3JpdGVzXG4gKiB3aWxsIGJlIGNvbW1pdHRlZCAob3IgdmlzaWJsZSBsb2NhbGx5KSB1bnRpbCB7QGxpbmsgV3JpdGVCYXRjaC5jb21taXR9IGlzXG4gKiBjYWxsZWQuXG4gKi9cbmNsYXNzIFpsIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gdCwgdGhpcy5fY29tbWl0SGFuZGxlciA9IGUsIHRoaXMuX211dGF0aW9ucyA9IFtdLCB0aGlzLl9jb21taXR0ZWQgPSAhMSwgXG4gICAgICAgIHRoaXMuX2RhdGFSZWFkZXIgPSBDaCh0KTtcbiAgICB9XG4gICAgc2V0KHQsIGUsIG4pIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IHMgPSB0Zih0LCB0aGlzLl9maXJlc3RvcmUpLCBpID0gdmwocy5jb252ZXJ0ZXIsIGUsIG4pLCByID0geGgodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnNldFwiLCBzLl9rZXksIGksIG51bGwgIT09IHMuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucy5wdXNoKHIudG9NdXRhdGlvbihzLl9rZXksIFFuLm5vbmUoKSkpLCB0aGlzO1xuICAgIH1cbiAgICB1cGRhdGUodCwgZSwgbiwgLi4ucykge1xuICAgICAgICB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKTtcbiAgICAgICAgY29uc3QgaSA9IHRmKHQsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICAgICAgICAgICAgICBsZXQgcjtcbiAgICAgICAgcmV0dXJuIHIgPSBcInN0cmluZ1wiID09IHR5cGVvZiAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSkgfHwgZSBpbnN0YW5jZW9mIFRoID8gTGgodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnVwZGF0ZVwiLCBpLl9rZXksIGUsIG4sIHMpIDogQmgodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnVwZGF0ZVwiLCBpLl9rZXksIGUpLCBcbiAgICAgICAgdGhpcy5fbXV0YXRpb25zLnB1c2goci50b011dGF0aW9uKGkuX2tleSwgUW4uZXhpc3RzKCEwKSkpLCB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGUgcHJvdmlkZWQge0BsaW5rIERvY3VtZW50UmVmZXJlbmNlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudFJlZiAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBiZSBkZWxldGVkLlxuICAgICAqIEByZXR1cm5zIFRoaXMgYFdyaXRlQmF0Y2hgIGluc3RhbmNlLiBVc2VkIGZvciBjaGFpbmluZyBtZXRob2QgY2FsbHMuXG4gICAgICovICAgIGRlbGV0ZSh0KSB7XG4gICAgICAgIHRoaXMuX3ZlcmlmeU5vdENvbW1pdHRlZCgpO1xuICAgICAgICBjb25zdCBlID0gdGYodCwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucyA9IHRoaXMuX211dGF0aW9ucy5jb25jYXQobmV3IGlzKGUuX2tleSwgUW4ubm9uZSgpKSksIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbW1pdHMgYWxsIG9mIHRoZSB3cml0ZXMgaW4gdGhpcyB3cml0ZSBiYXRjaCBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAgICAgKlxuICAgICAqIFRoZSByZXN1bHQgb2YgdGhlc2Ugd3JpdGVzIHdpbGwgb25seSBiZSByZWZsZWN0ZWQgaW4gZG9jdW1lbnQgcmVhZHMgdGhhdFxuICAgICAqIG9jY3VyIGFmdGVyIHRoZSByZXR1cm5lZCBwcm9taXNlIHJlc29sdmVzLiBJZiB0aGUgY2xpZW50IGlzIG9mZmxpbmUsIHRoZVxuICAgICAqIHdyaXRlIGZhaWxzLiBJZiB5b3Ugd291bGQgbGlrZSB0byBzZWUgbG9jYWwgbW9kaWZpY2F0aW9ucyBvciBidWZmZXIgd3JpdGVzXG4gICAgICogdW50aWwgdGhlIGNsaWVudCBpcyBvbmxpbmUsIHVzZSB0aGUgZnVsbCBGaXJlc3RvcmUgU0RLLlxuICAgICAqXG4gICAgICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgb25jZSBhbGwgb2YgdGhlIHdyaXRlcyBpbiB0aGUgYmF0Y2ggaGF2ZSBiZWVuXG4gICAgICogc3VjY2Vzc2Z1bGx5IHdyaXR0ZW4gdG8gdGhlIGJhY2tlbmQgYXMgYW4gYXRvbWljIHVuaXQgKG5vdGUgdGhhdCBpdCB3b24ndFxuICAgICAqIHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICAgICAqLyAgICBjb21taXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKSwgdGhpcy5fY29tbWl0dGVkID0gITAsIHRoaXMuX211dGF0aW9ucy5sZW5ndGggPiAwID8gdGhpcy5fY29tbWl0SGFuZGxlcih0aGlzLl9tdXRhdGlvbnMpIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIF92ZXJpZnlOb3RDb21taXR0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb21taXR0ZWQpIHRocm93IG5ldyBMKEIuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJBIHdyaXRlIGJhdGNoIGNhbiBubyBsb25nZXIgYmUgdXNlZCBhZnRlciBjb21taXQoKSBoYXMgYmVlbiBjYWxsZWQuXCIpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gdGYodCwgZSkge1xuICAgIGlmICgodCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSkuZmlyZXN0b3JlICE9PSBlKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiUHJvdmlkZWQgZG9jdW1lbnQgcmVmZXJlbmNlIGlzIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIGluc3RhbmNlLlwiKTtcbiAgICByZXR1cm4gdDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRPRE8obXJzY2htaWR0KSBDb25zaWRlciB1c2luZyBgQmFzZVRyYW5zYWN0aW9uYCBhcyB0aGUgYmFzZSBjbGFzcyBpbiB0aGVcbi8vIGxlZ2FjeSBTREsuXG4vKipcbiAqIEEgcmVmZXJlbmNlIHRvIGEgdHJhbnNhY3Rpb24uXG4gKlxuICogVGhlIGBUcmFuc2FjdGlvbmAgb2JqZWN0IHBhc3NlZCB0byBhIHRyYW5zYWN0aW9uJ3MgYHVwZGF0ZUZ1bmN0aW9uYCBwcm92aWRlc1xuICogdGhlIG1ldGhvZHMgdG8gcmVhZCBhbmQgd3JpdGUgZGF0YSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uIGNvbnRleHQuIFNlZVxuICoge0BsaW5rIHJ1blRyYW5zYWN0aW9ufS5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSByZWZlcmVuY2UgdG8gYSB0cmFuc2FjdGlvbi5cbiAqXG4gKiBUaGUgYFRyYW5zYWN0aW9uYCBvYmplY3QgcGFzc2VkIHRvIGEgdHJhbnNhY3Rpb24ncyBgdXBkYXRlRnVuY3Rpb25gIHByb3ZpZGVzXG4gKiB0aGUgbWV0aG9kcyB0byByZWFkIGFuZCB3cml0ZSBkYXRhIHdpdGhpbiB0aGUgdHJhbnNhY3Rpb24gY29udGV4dC4gU2VlXG4gKiB7QGxpbmsgcnVuVHJhbnNhY3Rpb259LlxuICovXG5jbGFzcyBlZiBleHRlbmRzIGNsYXNzIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKHQsIGUpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gdCwgdGhpcy5fdHJhbnNhY3Rpb24gPSBlLCB0aGlzLl9kYXRhUmVhZGVyID0gQ2godCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIHRoZSBkb2N1bWVudCByZWZlcmVuY2VkIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIHJlYWQuXG4gICAgICogQHJldHVybnMgQSBgRG9jdW1lbnRTbmFwc2hvdGAgd2l0aCB0aGUgcmVhZCBkYXRhLlxuICAgICAqLyAgICBnZXQodCkge1xuICAgICAgICBjb25zdCBlID0gdGYodCwgdGhpcy5fZmlyZXN0b3JlKSwgbiA9IG5ldyBWbCh0aGlzLl9maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gdGhpcy5fdHJhbnNhY3Rpb24ubG9va3VwKFsgZS5fa2V5IF0pLnRoZW4oKHQgPT4ge1xuICAgICAgICAgICAgaWYgKCF0IHx8IDEgIT09IHQubGVuZ3RoKSByZXR1cm4gTygpO1xuICAgICAgICAgICAgY29uc3QgcyA9IHRbMF07XG4gICAgICAgICAgICBpZiAocy5pc0ZvdW5kRG9jdW1lbnQoKSkgcmV0dXJuIG5ldyBZaCh0aGlzLl9maXJlc3RvcmUsIG4sIHMua2V5LCBzLCBlLmNvbnZlcnRlcik7XG4gICAgICAgICAgICBpZiAocy5pc05vRG9jdW1lbnQoKSkgcmV0dXJuIG5ldyBZaCh0aGlzLl9maXJlc3RvcmUsIG4sIGUuX2tleSwgbnVsbCwgZS5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgdGhyb3cgTygpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNldCh0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0Zih0LCB0aGlzLl9maXJlc3RvcmUpLCBpID0gdmwocy5jb252ZXJ0ZXIsIGUsIG4pLCByID0geGgodGhpcy5fZGF0YVJlYWRlciwgXCJUcmFuc2FjdGlvbi5zZXRcIiwgcy5fa2V5LCBpLCBudWxsICE9PSBzLmNvbnZlcnRlciwgbik7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFuc2FjdGlvbi5zZXQocy5fa2V5LCByKSwgdGhpcztcbiAgICB9XG4gICAgdXBkYXRlKHQsIGUsIG4sIC4uLnMpIHtcbiAgICAgICAgY29uc3QgaSA9IHRmKHQsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICAgICAgICAgICAgICBsZXQgcjtcbiAgICAgICAgcmV0dXJuIHIgPSBcInN0cmluZ1wiID09IHR5cGVvZiAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSkgfHwgZSBpbnN0YW5jZW9mIFRoID8gTGgodGhpcy5fZGF0YVJlYWRlciwgXCJUcmFuc2FjdGlvbi51cGRhdGVcIiwgaS5fa2V5LCBlLCBuLCBzKSA6IEJoKHRoaXMuX2RhdGFSZWFkZXIsIFwiVHJhbnNhY3Rpb24udXBkYXRlXCIsIGkuX2tleSwgZSksIFxuICAgICAgICB0aGlzLl90cmFuc2FjdGlvbi51cGRhdGUoaS5fa2V5LCByKSwgdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVsZXRlcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhlIHByb3ZpZGVkIHtAbGluayBEb2N1bWVudFJlZmVyZW5jZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRSZWYgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gYmUgZGVsZXRlZC5cbiAgICAgKiBAcmV0dXJucyBUaGlzIGBUcmFuc2FjdGlvbmAgaW5zdGFuY2UuIFVzZWQgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgICAgKi8gICAgZGVsZXRlKHQpIHtcbiAgICAgICAgY29uc3QgZSA9IHRmKHQsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFuc2FjdGlvbi5kZWxldGUoZS5fa2V5KSwgdGhpcztcbiAgICB9XG59IHtcbiAgICAvLyBUaGlzIGNsYXNzIGltcGxlbWVudHMgdGhlIHNhbWUgbG9naWMgYXMgdGhlIFRyYW5zYWN0aW9uIEFQSSBpbiB0aGUgTGl0ZSBTREtcbiAgICAvLyBidXQgaXMgc3ViY2xhc3NlZCBpbiBvcmRlciB0byByZXR1cm4gaXRzIG93biBEb2N1bWVudFNuYXBzaG90IHR5cGVzLlxuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IodCwgZSkge1xuICAgICAgICBzdXBlcih0LCBlKSwgdGhpcy5fZmlyZXN0b3JlID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgdGhlIGRvY3VtZW50IHJlZmVyZW5jZWQgYnkgdGhlIHByb3ZpZGVkIHtAbGluayBEb2N1bWVudFJlZmVyZW5jZX0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRSZWYgLSBBIHJlZmVyZW5jZSB0byB0aGUgZG9jdW1lbnQgdG8gYmUgcmVhZC5cbiAgICAgKiBAcmV0dXJucyBBIGBEb2N1bWVudFNuYXBzaG90YCB3aXRoIHRoZSByZWFkIGRhdGEuXG4gICAgICovICAgIGdldCh0KSB7XG4gICAgICAgIGNvbnN0IGUgPSB0Zih0LCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IE1sKHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiBzdXBlci5nZXQodCkudGhlbigodCA9PiBuZXcgRGwodGhpcy5fZmlyZXN0b3JlLCBuLCBlLl9rZXksIHQuX2RvY3VtZW50LCBuZXcgU2woXG4gICAgICAgIC8qIGhhc1BlbmRpbmdXcml0ZXM9ICovICExLCBcbiAgICAgICAgLyogZnJvbUNhY2hlPSAqLyAhMSksIGUuY29udmVydGVyKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgZ2l2ZW4gYHVwZGF0ZUZ1bmN0aW9uYCBhbmQgdGhlbiBhdHRlbXB0cyB0byBjb21taXQgdGhlIGNoYW5nZXNcbiAqIGFwcGxpZWQgd2l0aGluIHRoZSB0cmFuc2FjdGlvbi4gSWYgYW55IGRvY3VtZW50IHJlYWQgd2l0aGluIHRoZSB0cmFuc2FjdGlvblxuICogaGFzIGNoYW5nZWQsIENsb3VkIEZpcmVzdG9yZSByZXRyaWVzIHRoZSBgdXBkYXRlRnVuY3Rpb25gLiBJZiBpdCBmYWlscyB0b1xuICogY29tbWl0IGFmdGVyIDUgYXR0ZW1wdHMsIHRoZSB0cmFuc2FjdGlvbiBmYWlscy5cbiAqXG4gKiBUaGUgbWF4aW11bSBudW1iZXIgb2Ygd3JpdGVzIGFsbG93ZWQgaW4gYSBzaW5nbGUgdHJhbnNhY3Rpb24gaXMgNTAwLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBBIHJlZmVyZW5jZSB0byB0aGUgRmlyZXN0b3JlIGRhdGFiYXNlIHRvIHJ1biB0aGlzXG4gKiB0cmFuc2FjdGlvbiBhZ2FpbnN0LlxuICogQHBhcmFtIHVwZGF0ZUZ1bmN0aW9uIC0gVGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2l0aGluIHRoZSB0cmFuc2FjdGlvblxuICogY29udGV4dC5cbiAqIEBwYXJhbSBvcHRpb25zIC0gQW4gb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIG1heGltdW0gbnVtYmVyIG9mIGF0dGVtcHRzIHRvXG4gKiBjb21taXQuXG4gKiBAcmV0dXJucyBJZiB0aGUgdHJhbnNhY3Rpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseSBvciB3YXMgZXhwbGljaXRseSBhYm9ydGVkXG4gKiAodGhlIGB1cGRhdGVGdW5jdGlvbmAgcmV0dXJuZWQgYSBmYWlsZWQgcHJvbWlzZSksIHRoZSBwcm9taXNlIHJldHVybmVkIGJ5IHRoZVxuICogYHVwZGF0ZUZ1bmN0aW9uIGBpcyByZXR1cm5lZCBoZXJlLiBPdGhlcndpc2UsIGlmIHRoZSB0cmFuc2FjdGlvbiBmYWlsZWQsIGFcbiAqIHJlamVjdGVkIHByb21pc2Ugd2l0aCB0aGUgY29ycmVzcG9uZGluZyBmYWlsdXJlIGVycm9yIGlzIHJldHVybmVkLlxuICovIGZ1bmN0aW9uIG5mKHQsIGUsIG4pIHtcbiAgICB0ID0gZmEodCwgaWgpO1xuICAgIGNvbnN0IHMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIFhsKSwgbik7XG4gICAgIWZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYgKHQubWF4QXR0ZW1wdHMgPCAxKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiTWF4IGF0dGVtcHRzIG11c3QgYmUgYXQgbGVhc3QgMVwiKTtcbiAgICB9KHMpO1xuICAgIHJldHVybiBmdW5jdGlvbih0LCBlLCBuKSB7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgcTtcbiAgICAgICAgcmV0dXJuIHQuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gYXdhaXQgS2EodCk7XG4gICAgICAgICAgICBuZXcgTmEodC5hc3luY1F1ZXVlLCBpLCBuLCBlLCBzKS5ydW4oKTtcbiAgICAgICAgfSkpLCBzLnByb21pc2U7XG4gICAgfSh1aCh0KSwgKG4gPT4gZShuZXcgZWYodCwgbikpKSwgcyk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYSBzZW50aW5lbCBmb3IgdXNlIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSBvclxuICoge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSB3aXRoIGB7bWVyZ2U6IHRydWV9YCB0byBtYXJrIGEgZmllbGQgZm9yIGRlbGV0aW9uLlxuICovIGZ1bmN0aW9uIHNmKCkge1xuICAgIHJldHVybiBuZXcgTmgoXCJkZWxldGVGaWVsZFwiKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc2VudGluZWwgdXNlZCB3aXRoIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHNldERvYzoxKX0gb3Ige0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSB0b1xuICogaW5jbHVkZSBhIHNlcnZlci1nZW5lcmF0ZWQgdGltZXN0YW1wIGluIHRoZSB3cml0dGVuIGRhdGEuXG4gKi8gZnVuY3Rpb24gcmYoKSB7XG4gICAgcmV0dXJuIG5ldyBPaChcInNlcnZlclRpbWVzdGFtcFwiKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSBvciB7QGxpbmtcbiAqIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSB0aGF0IHRlbGxzIHRoZSBzZXJ2ZXIgdG8gdW5pb24gdGhlIGdpdmVuIGVsZW1lbnRzIHdpdGggYW55IGFycmF5XG4gKiB2YWx1ZSB0aGF0IGFscmVhZHkgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIuIEVhY2ggc3BlY2lmaWVkIGVsZW1lbnQgdGhhdCBkb2Vzbid0XG4gKiBhbHJlYWR5IGV4aXN0IGluIHRoZSBhcnJheSB3aWxsIGJlIGFkZGVkIHRvIHRoZSBlbmQuIElmIHRoZSBmaWVsZCBiZWluZ1xuICogbW9kaWZpZWQgaXMgbm90IGFscmVhZHkgYW4gYXJyYXkgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIGFuIGFycmF5XG4gKiBjb250YWluaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmllZCBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudHMgLSBUaGUgZWxlbWVudHMgdG8gdW5pb24gaW50byB0aGUgYXJyYXkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWAuXG4gKi8gZnVuY3Rpb24gb2YoLi4udCkge1xuICAgIC8vIE5PVEU6IFdlIGRvbid0IGFjdHVhbGx5IHBhcnNlIHRoZSBkYXRhIHVudGlsIGl0J3MgdXNlZCBpbiBzZXQoKSBvclxuICAgIC8vIHVwZGF0ZSgpIHNpbmNlIHdlJ2QgbmVlZCB0aGUgRmlyZXN0b3JlIGluc3RhbmNlIHRvIGRvIHRoaXMuXG4gICAgcmV0dXJuIG5ldyBNaChcImFycmF5VW5pb25cIiwgdCk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNwZWNpYWwgdmFsdWUgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIHtAbGluayAoc2V0RG9jOjEpfSBvciB7QGxpbmtcbiAqIHVwZGF0ZURvYzoxfSB0aGF0IHRlbGxzIHRoZSBzZXJ2ZXIgdG8gcmVtb3ZlIHRoZSBnaXZlbiBlbGVtZW50cyBmcm9tIGFueVxuICogYXJyYXkgdmFsdWUgdGhhdCBhbHJlYWR5IGV4aXN0cyBvbiB0aGUgc2VydmVyLiBBbGwgaW5zdGFuY2VzIG9mIGVhY2ggZWxlbWVudFxuICogc3BlY2lmaWVkIHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSBhcnJheS4gSWYgdGhlIGZpZWxkIGJlaW5nIG1vZGlmaWVkIGlzIG5vdFxuICogYWxyZWFkeSBhbiBhcnJheSBpdCB3aWxsIGJlIG92ZXJ3cml0dGVuIHdpdGggYW4gZW1wdHkgYXJyYXkuXG4gKlxuICogQHBhcmFtIGVsZW1lbnRzIC0gVGhlIGVsZW1lbnRzIHRvIHJlbW92ZSBmcm9tIHRoZSBhcnJheS5cbiAqIEByZXR1cm5zIFRoZSBgRmllbGRWYWx1ZWAgc2VudGluZWwgZm9yIHVzZSBpbiBhIGNhbGwgdG8gYHNldERvYygpYCBvclxuICogYHVwZGF0ZURvYygpYFxuICovIGZ1bmN0aW9uIHVmKC4uLnQpIHtcbiAgICAvLyBOT1RFOiBXZSBkb24ndCBhY3R1YWxseSBwYXJzZSB0aGUgZGF0YSB1bnRpbCBpdCdzIHVzZWQgaW4gc2V0KCkgb3JcbiAgICAvLyB1cGRhdGUoKSBzaW5jZSB3ZSdkIG5lZWQgdGhlIEZpcmVzdG9yZSBpbnN0YW5jZSB0byBkbyB0aGlzLlxuICAgIHJldHVybiBuZXcgRmgoXCJhcnJheVJlbW92ZVwiLCB0KTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSBvciB7QGxpbmtcbiAqIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSB0aGF0IHRlbGxzIHRoZSBzZXJ2ZXIgdG8gaW5jcmVtZW50IHRoZSBmaWVsZCdzIGN1cnJlbnQgdmFsdWUgYnlcbiAqIHRoZSBnaXZlbiB2YWx1ZS5cbiAqXG4gKiBJZiBlaXRoZXIgdGhlIG9wZXJhbmQgb3IgdGhlIGN1cnJlbnQgZmllbGQgdmFsdWUgdXNlcyBmbG9hdGluZyBwb2ludFxuICogcHJlY2lzaW9uLCBhbGwgYXJpdGhtZXRpYyBmb2xsb3dzIElFRUUgNzU0IHNlbWFudGljcy4gSWYgYm90aCB2YWx1ZXMgYXJlXG4gKiBpbnRlZ2VycywgdmFsdWVzIG91dHNpZGUgb2YgSmF2YVNjcmlwdCdzIHNhZmUgbnVtYmVyIHJhbmdlXG4gKiAoYE51bWJlci5NSU5fU0FGRV9JTlRFR0VSYCB0byBgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJgKSBhcmUgYWxzbyBzdWJqZWN0IHRvXG4gKiBwcmVjaXNpb24gbG9zcy4gRnVydGhlcm1vcmUsIG9uY2UgcHJvY2Vzc2VkIGJ5IHRoZSBGaXJlc3RvcmUgYmFja2VuZCwgYWxsXG4gKiBpbnRlZ2VyIG9wZXJhdGlvbnMgYXJlIGNhcHBlZCBiZXR3ZWVuIC0yXjYzIGFuZCAyXjYzLTEuXG4gKlxuICogSWYgdGhlIGN1cnJlbnQgZmllbGQgdmFsdWUgaXMgbm90IG9mIHR5cGUgYG51bWJlcmAsIG9yIGlmIHRoZSBmaWVsZCBkb2VzIG5vdFxuICogeWV0IGV4aXN0LCB0aGUgdHJhbnNmb3JtYXRpb24gc2V0cyB0aGUgZmllbGQgdG8gdGhlIGdpdmVuIHZhbHVlLlxuICpcbiAqIEBwYXJhbSBuIC0gVGhlIHZhbHVlIHRvIGluY3JlbWVudCBieS5cbiAqIEByZXR1cm5zIFRoZSBgRmllbGRWYWx1ZWAgc2VudGluZWwgZm9yIHVzZSBpbiBhIGNhbGwgdG8gYHNldERvYygpYCBvclxuICogYHVwZGF0ZURvYygpYFxuICovIGZ1bmN0aW9uIGNmKHQpIHtcbiAgICByZXR1cm4gbmV3ICRoKFwiaW5jcmVtZW50XCIsIHQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDcmVhdGVzIGEgd3JpdGUgYmF0Y2gsIHVzZWQgZm9yIHBlcmZvcm1pbmcgbXVsdGlwbGUgd3JpdGVzIGFzIGEgc2luZ2xlXG4gKiBhdG9taWMgb3BlcmF0aW9uLiBUaGUgbWF4aW11bSBudW1iZXIgb2Ygd3JpdGVzIGFsbG93ZWQgaW4gYSBzaW5nbGUge0BsaW5rIFdyaXRlQmF0Y2h9XG4gKiBpcyA1MDAuXG4gKlxuICogVW5saWtlIHRyYW5zYWN0aW9ucywgd3JpdGUgYmF0Y2hlcyBhcmUgcGVyc2lzdGVkIG9mZmxpbmUgYW5kIHRoZXJlZm9yZSBhcmVcbiAqIHByZWZlcmFibGUgd2hlbiB5b3UgZG9uJ3QgbmVlZCB0byBjb25kaXRpb24geW91ciB3cml0ZXMgb24gcmVhZCBkYXRhLlxuICpcbiAqIEByZXR1cm5zIEEge0BsaW5rIFdyaXRlQmF0Y2h9IHRoYXQgY2FuIGJlIHVzZWQgdG8gYXRvbWljYWxseSBleGVjdXRlIG11bHRpcGxlXG4gKiB3cml0ZXMuXG4gKi8gZnVuY3Rpb24gYWYodCkge1xuICAgIHJldHVybiB1aCh0ID0gZmEodCwgaWgpKSwgbmV3IFpsKHQsIChlID0+IHpsKHQsIGUpKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGZ1bmN0aW9uIGhmKHQsIGUpIHtcbiAgICB2YXIgbjtcbiAgICBjb25zdCBzID0gdWgodCA9IGZhKHQsIGloKSk7XG4gICAgLy8gUE9SVElORyBOT1RFOiBXZSBkb24ndCByZXR1cm4gYW4gZXJyb3IgaWYgdGhlIHVzZXIgaGFzIG5vdCBlbmFibGVkXG4gICAgLy8gcGVyc2lzdGVuY2Ugc2luY2UgYGVuYWJsZUluZGV4ZWRkYlBlcnNpc3RlbmNlKClgIGNhbiBmYWlsIG9uIHRoZSBXZWIuXG4gICAgICAgIGlmICghKG51bGwgPT09IChuID0gcy5vZmZsaW5lQ29tcG9uZW50cykgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIpKSByZXR1cm4gTihcIkNhbm5vdCBlbmFibGUgaW5kZXhlcyB3aGVuIHBlcnNpc3RlbmNlIGlzIGRpc2FibGVkXCIpLCBcbiAgICBQcm9taXNlLnJlc29sdmUoKTtcbiAgICBjb25zdCBpID0gZnVuY3Rpb24odCkge1xuICAgICAgICBjb25zdCBlID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgdCA/IGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodCk7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEwoQi5JTlZBTElEX0FSR1VNRU5ULCBcIkZhaWxlZCB0byBwYXJzZSBKU09OOiBcIiArIChudWxsID09IHQgPyB2b2lkIDAgOiB0Lm1lc3NhZ2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSh0KSA6IHQsIG4gPSBbXTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZS5pbmRleGVzKSkgZm9yIChjb25zdCB0IG9mIGUuaW5kZXhlcykge1xuICAgICAgICAgICAgY29uc3QgZSA9IGxmKHQsIFwiY29sbGVjdGlvbkdyb3VwXCIpLCBzID0gW107XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0LmZpZWxkcykpIGZvciAoY29uc3QgZSBvZiB0LmZpZWxkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB6aChcInNldEluZGV4Q29uZmlndXJhdGlvblwiLCBsZihlLCBcImZpZWxkUGF0aFwiKSk7XG4gICAgICAgICAgICAgICAgXCJDT05UQUlOU1wiID09PSBlLmFycmF5Q29uZmlnID8gcy5wdXNoKG5ldyBkdCh0LCAyIC8qIEluZGV4S2luZC5DT05UQUlOUyAqLykpIDogXCJBU0NFTkRJTkdcIiA9PT0gZS5vcmRlciA/IHMucHVzaChuZXcgZHQodCwgMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovKSkgOiBcIkRFU0NFTkRJTkdcIiA9PT0gZS5vcmRlciAmJiBzLnB1c2gobmV3IGR0KHQsIDEgLyogSW5kZXhLaW5kLkRFU0NFTkRJTkcgKi8pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG4ucHVzaChuZXcgYXQoYXQuVU5LTk9XTl9JRCwgZSwgcywgd3QuZW1wdHkoKSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuO1xuICAgIH0oZSk7XG4gICAgcmV0dXJuIExhKHMpLnRoZW4oKHQgPT4gYXN5bmMgZnVuY3Rpb24odCwgZSkge1xuICAgICAgICBjb25zdCBuID0gJCh0KSwgcyA9IG4uaW5kZXhNYW5hZ2VyLCBpID0gW107XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQ29uZmlndXJlIGluZGV4ZXNcIiwgXCJyZWFkd3JpdGVcIiwgKHQgPT4gcy5nZXRGaWVsZEluZGV4ZXModCkubmV4dCgobiA9PiBmdW5jdGlvbih0LCBlLCBuLCBzLCBpKSB7XG4gICAgICAgICAgICB0ID0gWyAuLi50IF0sIGUgPSBbIC4uLmUgXSwgdC5zb3J0KG4pLCBlLnNvcnQobik7XG4gICAgICAgICAgICBjb25zdCByID0gdC5sZW5ndGgsIG8gPSBlLmxlbmd0aDtcbiAgICAgICAgICAgIGxldCB1ID0gMCwgYyA9IDA7XG4gICAgICAgICAgICBmb3IgKDt1IDwgbyAmJiBjIDwgcjsgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG4odFtjXSwgZVt1XSk7XG4gICAgICAgICAgICAgICAgciA8IDAgPyBcbiAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgcmVtb3ZlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkXG4gICAgICAgICAgICAgICAgLy8gd2Fsa3Rocm91Z2ggaXMgb25seSBpbiBgYmVmb3JlYC5cbiAgICAgICAgICAgICAgICBpKHRbYysrXSkgOiByID4gMCA/IFxuICAgICAgICAgICAgICAgIC8vIFRoZSBlbGVtZW50IHdhcyBhZGRlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkIHdhbGt0aHJvdWdoXG4gICAgICAgICAgICAgICAgLy8gaXMgb25seSBpbiBgYWZ0ZXJgLlxuICAgICAgICAgICAgICAgIHMoZVt1KytdKSA6ICh1KyssIGMrKyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKDt1IDwgbzsgKSBzKGVbdSsrXSk7XG4gICAgICAgICAgICBmb3IgKDtjIDwgcjsgKSBpKHRbYysrXSk7XG4gICAgICAgIH0obiwgZSwgZnQsIChlID0+IHtcbiAgICAgICAgICAgIGkucHVzaChzLmFkZEZpZWxkSW5kZXgodCwgZSkpO1xuICAgICAgICB9KSwgKGUgPT4ge1xuICAgICAgICAgICAgaS5wdXNoKHMuZGVsZXRlRmllbGRJbmRleCh0LCBlKSk7XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IEF0LndhaXRGb3IoaSkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8vIFRoZSBmb3JtYXQgb2YgdGhlIExvY2FsU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgdGhlIGNsaWVudCBzdGF0ZSBpczpcbiAgICAvLyAgICAgZmlyZXN0b3JlX2NsaWVudHNfPHBlcnNpc3RlbmNlX3ByZWZpeD5fPGluc3RhbmNlX2tleT5cbiAgICAodCwgaSkpKTtcbn1cblxuZnVuY3Rpb24gbGYodCwgZSkge1xuICAgIGlmIChcInN0cmluZ1wiICE9IHR5cGVvZiB0W2VdKSB0aHJvdyBuZXcgTChCLklOVkFMSURfQVJHVU1FTlQsIFwiTWlzc2luZyBzdHJpbmcgdmFsdWUgZm9yOiBcIiArIGUpO1xuICAgIHJldHVybiB0W2VdO1xufVxuXG4vKipcbiAqIENsb3VkIEZpcmVzdG9yZVxuICpcbiAqIEBwYWNrYWdlRG9jdW1lbnRhdGlvblxuICovICFmdW5jdGlvbih0LCBlID0gITApIHtcbiAgICAhZnVuY3Rpb24odCkge1xuICAgICAgICB2ID0gdDtcbiAgICB9KFNES19WRVJTSU9OKSwgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJmaXJlc3RvcmVcIiwgKCh0LCB7aW5zdGFuY2VJZGVudGlmaWVyOiBuLCBvcHRpb25zOiBzfSkgPT4ge1xuICAgICAgICBjb25zdCBpID0gdC5nZXRQcm92aWRlcihcImFwcFwiKS5nZXRJbW1lZGlhdGUoKSwgciA9IG5ldyBpaChuZXcgUSh0LmdldFByb3ZpZGVyKFwiYXV0aC1pbnRlcm5hbFwiKSksIG5ldyBIKHQuZ2V0UHJvdmlkZXIoXCJhcHAtY2hlY2staW50ZXJuYWxcIikpLCBmdW5jdGlvbih0LCBlKSB7XG4gICAgICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuYXBwbHkodC5vcHRpb25zLCBbIFwicHJvamVjdElkXCIgXSkpIHRocm93IG5ldyBMKEIuSU5WQUxJRF9BUkdVTUVOVCwgJ1wicHJvamVjdElkXCIgbm90IHByb3ZpZGVkIGluIGZpcmViYXNlLmluaXRpYWxpemVBcHAuJyk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZ0KHQub3B0aW9ucy5wcm9qZWN0SWQsIGUpO1xuICAgICAgICB9KGksIG4pLCBpKTtcbiAgICAgICAgcmV0dXJuIHMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgICAgIHVzZUZldGNoU3RyZWFtczogZVxuICAgICAgICB9LCBzKSwgci5fc2V0U2V0dGluZ3MocyksIHI7XG4gICAgfSksIFwiUFVCTElDXCIpLnNldE11bHRpcGxlSW5zdGFuY2VzKCEwKSksIHJlZ2lzdGVyVmVyc2lvbihiLCBcIjMuOC4xXCIsIHQpLCBcbiAgICAvLyBCVUlMRF9UQVJHRVQgd2lsbCBiZSByZXBsYWNlZCBieSB2YWx1ZXMgbGlrZSBlc201LCBlc20yMDE3LCBjanM1LCBldGMgZHVyaW5nIHRoZSBjb21waWxhdGlvblxuICAgIHJlZ2lzdGVyVmVyc2lvbihiLCBcIjMuOC4xXCIsIFwiZXNtMjAxN1wiKTtcbn0oKTtcblxuZXhwb3J0IHsgUGwgYXMgQWJzdHJhY3RVc2VyRGF0YVdyaXRlciwgU2EgYXMgQWdncmVnYXRlRmllbGQsIERhIGFzIEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3QsIEloIGFzIEJ5dGVzLCBzaCBhcyBDQUNIRV9TSVpFX1VOTElNSVRFRCwgSWEgYXMgQ29sbGVjdGlvblJlZmVyZW5jZSwgeWEgYXMgRG9jdW1lbnRSZWZlcmVuY2UsIERsIGFzIERvY3VtZW50U25hcHNob3QsIFRoIGFzIEZpZWxkUGF0aCwgQWggYXMgRmllbGRWYWx1ZSwgaWggYXMgRmlyZXN0b3JlLCBMIGFzIEZpcmVzdG9yZUVycm9yLCBSaCBhcyBHZW9Qb2ludCwgbmggYXMgTG9hZEJ1bmRsZVRhc2ssIHBhIGFzIFF1ZXJ5LCBvbCBhcyBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQsIG5sIGFzIFF1ZXJ5Q29uc3RyYWludCwgQ2wgYXMgUXVlcnlEb2N1bWVudFNuYXBzaG90LCBnbCBhcyBRdWVyeUVuZEF0Q29uc3RyYWludCwgaWwgYXMgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQsIGxsIGFzIFF1ZXJ5TGltaXRDb25zdHJhaW50LCBhbCBhcyBRdWVyeU9yZGVyQnlDb25zdHJhaW50LCB4bCBhcyBRdWVyeVNuYXBzaG90LCBfbCBhcyBRdWVyeVN0YXJ0QXRDb25zdHJhaW50LCBTbCBhcyBTbmFwc2hvdE1ldGFkYXRhLCBudCBhcyBUaW1lc3RhbXAsIGVmIGFzIFRyYW5zYWN0aW9uLCBabCBhcyBXcml0ZUJhdGNoLCBGdCBhcyBfRGF0YWJhc2VJZCwgY3QgYXMgX0RvY3VtZW50S2V5LCBKIGFzIF9FbXB0eUFwcENoZWNrVG9rZW5Qcm92aWRlciwgSyBhcyBfRW1wdHlBdXRoQ3JlZGVudGlhbHNQcm92aWRlciwgdXQgYXMgX0ZpZWxkUGF0aCwgZmEgYXMgX2Nhc3QsIEYgYXMgX2RlYnVnQXNzZXJ0LCBHdCBhcyBfaXNCYXNlNjRBdmFpbGFibGUsIE4gYXMgX2xvZ1dhcm4sIGNhIGFzIF92YWxpZGF0ZUlzTm90VXNlZFRvZ2V0aGVyLCBRbCBhcyBhZGREb2MsIEpsIGFzIGFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RFcXVhbCwgY2wgYXMgYW5kLCB1ZiBhcyBhcnJheVJlbW92ZSwgb2YgYXMgYXJyYXlVbmlvbiwgZmggYXMgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSwgVGEgYXMgY29sbGVjdGlvbiwgRWEgYXMgY29sbGVjdGlvbkdyb3VwLCBnYSBhcyBjb25uZWN0RmlyZXN0b3JlRW11bGF0b3IsIEdsIGFzIGRlbGV0ZURvYywgc2YgYXMgZGVsZXRlRmllbGQsIHdoIGFzIGRpc2FibGVOZXR3b3JrLCBBYSBhcyBkb2MsIEVoIGFzIGRvY3VtZW50SWQsIGFoIGFzIGVuYWJsZUluZGV4ZWREYlBlcnNpc3RlbmNlLCBoaCBhcyBlbmFibGVNdWx0aVRhYkluZGV4ZWREYlBlcnNpc3RlbmNlLCBfaCBhcyBlbmFibGVOZXR3b3JrLCBwbCBhcyBlbmRBdCwgeWwgYXMgZW5kQmVmb3JlLCB1aCBhcyBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkLCB6bCBhcyBleGVjdXRlV3JpdGUsIFlsIGFzIGdldENvdW50RnJvbVNlcnZlciwgT2wgYXMgZ2V0RG9jLCBGbCBhcyBnZXREb2NGcm9tQ2FjaGUsICRsIGFzIGdldERvY0Zyb21TZXJ2ZXIsIEJsIGFzIGdldERvY3MsIExsIGFzIGdldERvY3NGcm9tQ2FjaGUsIHFsIGFzIGdldERvY3NGcm9tU2VydmVyLCBvaCBhcyBnZXRGaXJlc3RvcmUsIGNmIGFzIGluY3JlbWVudCwgcmggYXMgaW5pdGlhbGl6ZUZpcmVzdG9yZSwgZmwgYXMgbGltaXQsIGRsIGFzIGxpbWl0VG9MYXN0LCBnaCBhcyBsb2FkQnVuZGxlLCB5aCBhcyBuYW1lZFF1ZXJ5LCBqbCBhcyBvblNuYXBzaG90LCBXbCBhcyBvblNuYXBzaG90c0luU3luYywgdWwgYXMgb3IsIGhsIGFzIG9yZGVyQnksIHNsIGFzIHF1ZXJ5LCBiYSBhcyBxdWVyeUVxdWFsLCBSYSBhcyByZWZFcXVhbCwgbmYgYXMgcnVuVHJhbnNhY3Rpb24sIHJmIGFzIHNlcnZlclRpbWVzdGFtcCwgVWwgYXMgc2V0RG9jLCBoZiBhcyBzZXRJbmRleENvbmZpZ3VyYXRpb24sIEQgYXMgc2V0TG9nTGV2ZWwsIGtsIGFzIHNuYXBzaG90RXF1YWwsIG1sIGFzIHN0YXJ0QWZ0ZXIsIHdsIGFzIHN0YXJ0QXQsIG1oIGFzIHRlcm1pbmF0ZSwgS2wgYXMgdXBkYXRlRG9jLCBkaCBhcyB3YWl0Rm9yUGVuZGluZ1dyaXRlcywgcmwgYXMgd2hlcmUsIGFmIGFzIHdyaXRlQmF0Y2ggfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCJpbXBvcnQgeyBfZ2V0UHJvdmlkZXIsIGdldEFwcCwgX3JlZ2lzdGVyQ29tcG9uZW50LCByZWdpc3RlclZlcnNpb24sIFNES19WRVJTSU9OIH0gZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5pbXBvcnQgeyBGaXJlYmFzZUVycm9yLCBpc05vZGUsIGNyZWF0ZU1vY2tVc2VyVG9rZW4sIGdldE1vZHVsYXJJbnN0YW5jZSwgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0IH0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBAZmlsZW92ZXJ2aWV3IENvbnN0YW50cyB1c2VkIGluIHRoZSBGaXJlYmFzZSBTdG9yYWdlIGxpYnJhcnkuXHJcbiAqL1xyXG4vKipcclxuICogRG9tYWluIG5hbWUgZm9yIGZpcmViYXNlIHN0b3JhZ2UuXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX0hPU1QgPSAnZmlyZWJhc2VzdG9yYWdlLmdvb2dsZWFwaXMuY29tJztcclxuLyoqXHJcbiAqIFRoZSBrZXkgaW4gRmlyZWJhc2UgY29uZmlnIGpzb24gZm9yIHRoZSBzdG9yYWdlIGJ1Y2tldC5cclxuICovXHJcbmNvbnN0IENPTkZJR19TVE9SQUdFX0JVQ0tFVF9LRVkgPSAnc3RvcmFnZUJ1Y2tldCc7XHJcbi8qKlxyXG4gKiAyIG1pbnV0ZXNcclxuICpcclxuICogVGhlIHRpbWVvdXQgZm9yIGFsbCBvcGVyYXRpb25zIGV4Y2VwdCB1cGxvYWQuXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX01BWF9PUEVSQVRJT05fUkVUUllfVElNRSA9IDIgKiA2MCAqIDEwMDA7XHJcbi8qKlxyXG4gKiAxMCBtaW51dGVzXHJcbiAqXHJcbiAqIFRoZSB0aW1lb3V0IGZvciB1cGxvYWQuXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX01BWF9VUExPQURfUkVUUllfVElNRSA9IDEwICogNjAgKiAxMDAwO1xyXG4vKipcclxuICogMSBzZWNvbmRcclxuICovXHJcbmNvbnN0IERFRkFVTFRfTUlOX1NMRUVQX1RJTUVfTUlMTElTID0gMTAwMDtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEFuIGVycm9yIHJldHVybmVkIGJ5IHRoZSBGaXJlYmFzZSBTdG9yYWdlIFNESy5cclxuICogQHB1YmxpY1xyXG4gKi9cclxuY2xhc3MgU3RvcmFnZUVycm9yIGV4dGVuZHMgRmlyZWJhc2VFcnJvciB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBjb2RlIC0gQSBTdG9yYWdlRXJyb3JDb2RlIHN0cmluZyB0byBiZSBwcmVmaXhlZCB3aXRoICdzdG9yYWdlLycgYW5kXHJcbiAgICAgKiAgYWRkZWQgdG8gdGhlIGVuZCBvZiB0aGUgbWVzc2FnZS5cclxuICAgICAqIEBwYXJhbSBtZXNzYWdlICAtIEVycm9yIG1lc3NhZ2UuXHJcbiAgICAgKiBAcGFyYW0gc3RhdHVzXyAtIENvcnJlc3BvbmRpbmcgSFRUUCBTdGF0dXMgQ29kZVxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcihjb2RlLCBtZXNzYWdlLCBzdGF0dXNfID0gMCkge1xyXG4gICAgICAgIHN1cGVyKHByZXBlbmRDb2RlKGNvZGUpLCBgRmlyZWJhc2UgU3RvcmFnZTogJHttZXNzYWdlfSAoJHtwcmVwZW5kQ29kZShjb2RlKX0pYCk7XHJcbiAgICAgICAgdGhpcy5zdGF0dXNfID0gc3RhdHVzXztcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTdG9yZXMgY3VzdG9tIGVycm9yIGRhdGEgdW5xdWUgdG8gU3RvcmFnZUVycm9yLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuY3VzdG9tRGF0YSA9IHsgc2VydmVyUmVzcG9uc2U6IG51bGwgfTtcclxuICAgICAgICB0aGlzLl9iYXNlTWVzc2FnZSA9IHRoaXMubWVzc2FnZTtcclxuICAgICAgICAvLyBXaXRob3V0IHRoaXMsIGBpbnN0YW5jZW9mIFN0b3JhZ2VFcnJvcmAsIGluIHRlc3RzIGZvciBleGFtcGxlLFxyXG4gICAgICAgIC8vIHJldHVybnMgZmFsc2UuXHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIFN0b3JhZ2VFcnJvci5wcm90b3R5cGUpO1xyXG4gICAgfVxyXG4gICAgZ2V0IHN0YXR1cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXNfO1xyXG4gICAgfVxyXG4gICAgc2V0IHN0YXR1cyhzdGF0dXMpIHtcclxuICAgICAgICB0aGlzLnN0YXR1c18gPSBzdGF0dXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENvbXBhcmVzIGEgU3RvcmFnZUVycm9yQ29kZSBhZ2FpbnN0IHRoaXMgZXJyb3IncyBjb2RlLCBmaWx0ZXJpbmcgb3V0IHRoZSBwcmVmaXguXHJcbiAgICAgKi9cclxuICAgIF9jb2RlRXF1YWxzKGNvZGUpIHtcclxuICAgICAgICByZXR1cm4gcHJlcGVuZENvZGUoY29kZSkgPT09IHRoaXMuY29kZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogT3B0aW9uYWwgcmVzcG9uc2UgbWVzc2FnZSB0aGF0IHdhcyBhZGRlZCBieSB0aGUgc2VydmVyLlxyXG4gICAgICovXHJcbiAgICBnZXQgc2VydmVyUmVzcG9uc2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRGF0YS5zZXJ2ZXJSZXNwb25zZTtcclxuICAgIH1cclxuICAgIHNldCBzZXJ2ZXJSZXNwb25zZShzZXJ2ZXJSZXNwb25zZSkge1xyXG4gICAgICAgIHRoaXMuY3VzdG9tRGF0YS5zZXJ2ZXJSZXNwb25zZSA9IHNlcnZlclJlc3BvbnNlO1xyXG4gICAgICAgIGlmICh0aGlzLmN1c3RvbURhdGEuc2VydmVyUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5tZXNzYWdlID0gYCR7dGhpcy5fYmFzZU1lc3NhZ2V9XFxuJHt0aGlzLmN1c3RvbURhdGEuc2VydmVyUmVzcG9uc2V9YDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IHRoaXMuX2Jhc2VNZXNzYWdlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwcmVwZW5kQ29kZShjb2RlKSB7XHJcbiAgICByZXR1cm4gJ3N0b3JhZ2UvJyArIGNvZGU7XHJcbn1cclxuZnVuY3Rpb24gdW5rbm93bigpIHtcclxuICAgIGNvbnN0IG1lc3NhZ2UgPSAnQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZCwgcGxlYXNlIGNoZWNrIHRoZSBlcnJvciBwYXlsb2FkIGZvciAnICtcclxuICAgICAgICAnc2VydmVyIHJlc3BvbnNlLic7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcInVua25vd25cIiAvKiBTdG9yYWdlRXJyb3JDb2RlLlVOS05PV04gKi8sIG1lc3NhZ2UpO1xyXG59XHJcbmZ1bmN0aW9uIG9iamVjdE5vdEZvdW5kKHBhdGgpIHtcclxuICAgIHJldHVybiBuZXcgU3RvcmFnZUVycm9yKFwib2JqZWN0LW5vdC1mb3VuZFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuT0JKRUNUX05PVF9GT1VORCAqLywgXCJPYmplY3QgJ1wiICsgcGF0aCArIFwiJyBkb2VzIG5vdCBleGlzdC5cIik7XHJcbn1cclxuZnVuY3Rpb24gcXVvdGFFeGNlZWRlZChidWNrZXQpIHtcclxuICAgIHJldHVybiBuZXcgU3RvcmFnZUVycm9yKFwicXVvdGEtZXhjZWVkZWRcIiAvKiBTdG9yYWdlRXJyb3JDb2RlLlFVT1RBX0VYQ0VFREVEICovLCBcIlF1b3RhIGZvciBidWNrZXQgJ1wiICtcclxuICAgICAgICBidWNrZXQgK1xyXG4gICAgICAgIFwiJyBleGNlZWRlZCwgcGxlYXNlIHZpZXcgcXVvdGEgb24gXCIgK1xyXG4gICAgICAgICdodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vcHJpY2luZy8uJyk7XHJcbn1cclxuZnVuY3Rpb24gdW5hdXRoZW50aWNhdGVkKCkge1xyXG4gICAgY29uc3QgbWVzc2FnZSA9ICdVc2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkLCBwbGVhc2UgYXV0aGVudGljYXRlIHVzaW5nIEZpcmViYXNlICcgK1xyXG4gICAgICAgICdBdXRoZW50aWNhdGlvbiBhbmQgdHJ5IGFnYWluLic7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcInVuYXV0aGVudGljYXRlZFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuVU5BVVRIRU5USUNBVEVEICovLCBtZXNzYWdlKTtcclxufVxyXG5mdW5jdGlvbiB1bmF1dGhvcml6ZWRBcHAoKSB7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcInVuYXV0aG9yaXplZC1hcHBcIiAvKiBTdG9yYWdlRXJyb3JDb2RlLlVOQVVUSE9SSVpFRF9BUFAgKi8sICdUaGlzIGFwcCBkb2VzIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gYWNjZXNzIEZpcmViYXNlIFN0b3JhZ2Ugb24gdGhpcyBwcm9qZWN0LicpO1xyXG59XHJcbmZ1bmN0aW9uIHVuYXV0aG9yaXplZChwYXRoKSB7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcInVuYXV0aG9yaXplZFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuVU5BVVRIT1JJWkVEICovLCBcIlVzZXIgZG9lcyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGFjY2VzcyAnXCIgKyBwYXRoICsgXCInLlwiKTtcclxufVxyXG5mdW5jdGlvbiByZXRyeUxpbWl0RXhjZWVkZWQoKSB7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcInJldHJ5LWxpbWl0LWV4Y2VlZGVkXCIgLyogU3RvcmFnZUVycm9yQ29kZS5SRVRSWV9MSU1JVF9FWENFRURFRCAqLywgJ01heCByZXRyeSB0aW1lIGZvciBvcGVyYXRpb24gZXhjZWVkZWQsIHBsZWFzZSB0cnkgYWdhaW4uJyk7XHJcbn1cclxuZnVuY3Rpb24gY2FuY2VsZWQoKSB7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcImNhbmNlbGVkXCIgLyogU3RvcmFnZUVycm9yQ29kZS5DQU5DRUxFRCAqLywgJ1VzZXIgY2FuY2VsZWQgdGhlIHVwbG9hZC9kb3dubG9hZC4nKTtcclxufVxyXG5mdW5jdGlvbiBpbnZhbGlkVXJsKHVybCkge1xyXG4gICAgcmV0dXJuIG5ldyBTdG9yYWdlRXJyb3IoXCJpbnZhbGlkLXVybFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuSU5WQUxJRF9VUkwgKi8sIFwiSW52YWxpZCBVUkwgJ1wiICsgdXJsICsgXCInLlwiKTtcclxufVxyXG5mdW5jdGlvbiBpbnZhbGlkRGVmYXVsdEJ1Y2tldChidWNrZXQpIHtcclxuICAgIHJldHVybiBuZXcgU3RvcmFnZUVycm9yKFwiaW52YWxpZC1kZWZhdWx0LWJ1Y2tldFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuSU5WQUxJRF9ERUZBVUxUX0JVQ0tFVCAqLywgXCJJbnZhbGlkIGRlZmF1bHQgYnVja2V0ICdcIiArIGJ1Y2tldCArIFwiJy5cIik7XHJcbn1cclxuZnVuY3Rpb24gbm9EZWZhdWx0QnVja2V0KCkge1xyXG4gICAgcmV0dXJuIG5ldyBTdG9yYWdlRXJyb3IoXCJuby1kZWZhdWx0LWJ1Y2tldFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuTk9fREVGQVVMVF9CVUNLRVQgKi8sICdObyBkZWZhdWx0IGJ1Y2tldCAnICtcclxuICAgICAgICBcImZvdW5kLiBEaWQgeW91IHNldCB0aGUgJ1wiICtcclxuICAgICAgICBDT05GSUdfU1RPUkFHRV9CVUNLRVRfS0VZICtcclxuICAgICAgICBcIicgcHJvcGVydHkgd2hlbiBpbml0aWFsaXppbmcgdGhlIGFwcD9cIik7XHJcbn1cclxuZnVuY3Rpb24gY2Fubm90U2xpY2VCbG9iKCkge1xyXG4gICAgcmV0dXJuIG5ldyBTdG9yYWdlRXJyb3IoXCJjYW5ub3Qtc2xpY2UtYmxvYlwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuQ0FOTk9UX1NMSUNFX0JMT0IgKi8sICdDYW5ub3Qgc2xpY2UgYmxvYiBmb3IgdXBsb2FkLiBQbGVhc2UgcmV0cnkgdGhlIHVwbG9hZC4nKTtcclxufVxyXG5mdW5jdGlvbiBzZXJ2ZXJGaWxlV3JvbmdTaXplKCkge1xyXG4gICAgcmV0dXJuIG5ldyBTdG9yYWdlRXJyb3IoXCJzZXJ2ZXItZmlsZS13cm9uZy1zaXplXCIgLyogU3RvcmFnZUVycm9yQ29kZS5TRVJWRVJfRklMRV9XUk9OR19TSVpFICovLCAnU2VydmVyIHJlY29yZGVkIGluY29ycmVjdCB1cGxvYWQgZmlsZSBzaXplLCBwbGVhc2UgcmV0cnkgdGhlIHVwbG9hZC4nKTtcclxufVxyXG5mdW5jdGlvbiBub0Rvd25sb2FkVVJMKCkge1xyXG4gICAgcmV0dXJuIG5ldyBTdG9yYWdlRXJyb3IoXCJuby1kb3dubG9hZC11cmxcIiAvKiBTdG9yYWdlRXJyb3JDb2RlLk5PX0RPV05MT0FEX1VSTCAqLywgJ1RoZSBnaXZlbiBmaWxlIGRvZXMgbm90IGhhdmUgYW55IGRvd25sb2FkIFVSTHMuJyk7XHJcbn1cclxuZnVuY3Rpb24gbWlzc2luZ1BvbHlGaWxsKHBvbHlGaWxsKSB7XHJcbiAgICByZXR1cm4gbmV3IFN0b3JhZ2VFcnJvcihcInVuc3VwcG9ydGVkLWVudmlyb25tZW50XCIgLyogU3RvcmFnZUVycm9yQ29kZS5VTlNVUFBPUlRFRF9FTlZJUk9OTUVOVCAqLywgYCR7cG9seUZpbGx9IGlzIG1pc3NpbmcuIE1ha2Ugc3VyZSB0byBpbnN0YWxsIHRoZSByZXF1aXJlZCBwb2x5ZmlsbHMuIFNlZSBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy93ZWIvZW52aXJvbm1lbnRzLWpzLXNkayNwb2x5ZmlsbHMgZm9yIG1vcmUgaW5mb3JtYXRpb24uYCk7XHJcbn1cclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gaW52YWxpZEFyZ3VtZW50KG1lc3NhZ2UpIHtcclxuICAgIHJldHVybiBuZXcgU3RvcmFnZUVycm9yKFwiaW52YWxpZC1hcmd1bWVudFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuSU5WQUxJRF9BUkdVTUVOVCAqLywgbWVzc2FnZSk7XHJcbn1cclxuZnVuY3Rpb24gYXBwRGVsZXRlZCgpIHtcclxuICAgIHJldHVybiBuZXcgU3RvcmFnZUVycm9yKFwiYXBwLWRlbGV0ZWRcIiAvKiBTdG9yYWdlRXJyb3JDb2RlLkFQUF9ERUxFVEVEICovLCAnVGhlIEZpcmViYXNlIGFwcCB3YXMgZGVsZXRlZC4nKTtcclxufVxyXG4vKipcclxuICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgb3BlcmF0aW9uIHRoYXQgd2FzIGludmFsaWQuXHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gaW52YWxpZFJvb3RPcGVyYXRpb24obmFtZSkge1xyXG4gICAgcmV0dXJuIG5ldyBTdG9yYWdlRXJyb3IoXCJpbnZhbGlkLXJvb3Qtb3BlcmF0aW9uXCIgLyogU3RvcmFnZUVycm9yQ29kZS5JTlZBTElEX1JPT1RfT1BFUkFUSU9OICovLCBcIlRoZSBvcGVyYXRpb24gJ1wiICtcclxuICAgICAgICBuYW1lICtcclxuICAgICAgICBcIicgY2Fubm90IGJlIHBlcmZvcm1lZCBvbiBhIHJvb3QgcmVmZXJlbmNlLCBjcmVhdGUgYSBub24tcm9vdCBcIiArXHJcbiAgICAgICAgXCJyZWZlcmVuY2UgdXNpbmcgY2hpbGQsIHN1Y2ggYXMgLmNoaWxkKCdmaWxlLnBuZycpLlwiKTtcclxufVxyXG4vKipcclxuICogQHBhcmFtIGZvcm1hdCAtIFRoZSBmb3JtYXQgdGhhdCB3YXMgbm90IHZhbGlkLlxyXG4gKiBAcGFyYW0gbWVzc2FnZSAtIEEgbWVzc2FnZSBkZXNjcmliaW5nIHRoZSBmb3JtYXQgdmlvbGF0aW9uLlxyXG4gKi9cclxuZnVuY3Rpb24gaW52YWxpZEZvcm1hdChmb3JtYXQsIG1lc3NhZ2UpIHtcclxuICAgIHJldHVybiBuZXcgU3RvcmFnZUVycm9yKFwiaW52YWxpZC1mb3JtYXRcIiAvKiBTdG9yYWdlRXJyb3JDb2RlLklOVkFMSURfRk9STUFUICovLCBcIlN0cmluZyBkb2VzIG5vdCBtYXRjaCBmb3JtYXQgJ1wiICsgZm9ybWF0ICsgXCInOiBcIiArIG1lc3NhZ2UpO1xyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0gbWVzc2FnZSAtIEEgbWVzc2FnZSBkZXNjcmliaW5nIHRoZSBpbnRlcm5hbCBlcnJvci5cclxuICovXHJcbmZ1bmN0aW9uIGludGVybmFsRXJyb3IobWVzc2FnZSkge1xyXG4gICAgdGhyb3cgbmV3IFN0b3JhZ2VFcnJvcihcImludGVybmFsLWVycm9yXCIgLyogU3RvcmFnZUVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywgJ0ludGVybmFsIGVycm9yOiAnICsgbWVzc2FnZSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEZpcmViYXNlIFN0b3JhZ2UgbG9jYXRpb24gZGF0YS5cclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jbGFzcyBMb2NhdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcihidWNrZXQsIHBhdGgpIHtcclxuICAgICAgICB0aGlzLmJ1Y2tldCA9IGJ1Y2tldDtcclxuICAgICAgICB0aGlzLnBhdGhfID0gcGF0aDtcclxuICAgIH1cclxuICAgIGdldCBwYXRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhdGhfO1xyXG4gICAgfVxyXG4gICAgZ2V0IGlzUm9vdCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLmxlbmd0aCA9PT0gMDtcclxuICAgIH1cclxuICAgIGZ1bGxTZXJ2ZXJVcmwoKSB7XHJcbiAgICAgICAgY29uc3QgZW5jb2RlID0gZW5jb2RlVVJJQ29tcG9uZW50O1xyXG4gICAgICAgIHJldHVybiAnL2IvJyArIGVuY29kZSh0aGlzLmJ1Y2tldCkgKyAnL28vJyArIGVuY29kZSh0aGlzLnBhdGgpO1xyXG4gICAgfVxyXG4gICAgYnVja2V0T25seVNlcnZlclVybCgpIHtcclxuICAgICAgICBjb25zdCBlbmNvZGUgPSBlbmNvZGVVUklDb21wb25lbnQ7XHJcbiAgICAgICAgcmV0dXJuICcvYi8nICsgZW5jb2RlKHRoaXMuYnVja2V0KSArICcvbyc7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgbWFrZUZyb21CdWNrZXRTcGVjKGJ1Y2tldFN0cmluZywgaG9zdCkge1xyXG4gICAgICAgIGxldCBidWNrZXRMb2NhdGlvbjtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBidWNrZXRMb2NhdGlvbiA9IExvY2F0aW9uLm1ha2VGcm9tVXJsKGJ1Y2tldFN0cmluZywgaG9zdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIC8vIE5vdCB2YWxpZCBVUkwsIHVzZSBhcy1pcy4gVGhpcyBsZXRzIHlvdSBwdXQgYmFyZSBidWNrZXQgbmFtZXMgaW5cclxuICAgICAgICAgICAgLy8gY29uZmlnLlxyXG4gICAgICAgICAgICByZXR1cm4gbmV3IExvY2F0aW9uKGJ1Y2tldFN0cmluZywgJycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYnVja2V0TG9jYXRpb24ucGF0aCA9PT0gJycpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGJ1Y2tldExvY2F0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgaW52YWxpZERlZmF1bHRCdWNrZXQoYnVja2V0U3RyaW5nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgbWFrZUZyb21VcmwodXJsLCBob3N0KSB7XHJcbiAgICAgICAgbGV0IGxvY2F0aW9uID0gbnVsbDtcclxuICAgICAgICBjb25zdCBidWNrZXREb21haW4gPSAnKFtBLVphLXowLTkuXFxcXC1fXSspJztcclxuICAgICAgICBmdW5jdGlvbiBnc01vZGlmeShsb2MpIHtcclxuICAgICAgICAgICAgaWYgKGxvYy5wYXRoLmNoYXJBdChsb2MucGF0aC5sZW5ndGggLSAxKSA9PT0gJy8nKSB7XHJcbiAgICAgICAgICAgICAgICBsb2MucGF0aF8gPSBsb2MucGF0aF8uc2xpY2UoMCwgLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGdzUGF0aCA9ICcoLyguKikpPyQnO1xyXG4gICAgICAgIGNvbnN0IGdzUmVnZXggPSBuZXcgUmVnRXhwKCdeZ3M6Ly8nICsgYnVja2V0RG9tYWluICsgZ3NQYXRoLCAnaScpO1xyXG4gICAgICAgIGNvbnN0IGdzSW5kaWNlcyA9IHsgYnVja2V0OiAxLCBwYXRoOiAzIH07XHJcbiAgICAgICAgZnVuY3Rpb24gaHR0cE1vZGlmeShsb2MpIHtcclxuICAgICAgICAgICAgbG9jLnBhdGhfID0gZGVjb2RlVVJJQ29tcG9uZW50KGxvYy5wYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdmVyc2lvbiA9ICd2W0EtWmEtejAtOV9dKyc7XHJcbiAgICAgICAgY29uc3QgZmlyZWJhc2VTdG9yYWdlSG9zdCA9IGhvc3QucmVwbGFjZSgvWy5dL2csICdcXFxcLicpO1xyXG4gICAgICAgIGNvbnN0IGZpcmViYXNlU3RvcmFnZVBhdGggPSAnKC8oW14/I10qKS4qKT8kJztcclxuICAgICAgICBjb25zdCBmaXJlYmFzZVN0b3JhZ2VSZWdFeHAgPSBuZXcgUmVnRXhwKGBeaHR0cHM/Oi8vJHtmaXJlYmFzZVN0b3JhZ2VIb3N0fS8ke3ZlcnNpb259L2IvJHtidWNrZXREb21haW59L28ke2ZpcmViYXNlU3RvcmFnZVBhdGh9YCwgJ2knKTtcclxuICAgICAgICBjb25zdCBmaXJlYmFzZVN0b3JhZ2VJbmRpY2VzID0geyBidWNrZXQ6IDEsIHBhdGg6IDMgfTtcclxuICAgICAgICBjb25zdCBjbG91ZFN0b3JhZ2VIb3N0ID0gaG9zdCA9PT0gREVGQVVMVF9IT1NUXHJcbiAgICAgICAgICAgID8gJyg/OnN0b3JhZ2UuZ29vZ2xlYXBpcy5jb218c3RvcmFnZS5jbG91ZC5nb29nbGUuY29tKSdcclxuICAgICAgICAgICAgOiBob3N0O1xyXG4gICAgICAgIGNvbnN0IGNsb3VkU3RvcmFnZVBhdGggPSAnKFtePyNdKiknO1xyXG4gICAgICAgIGNvbnN0IGNsb3VkU3RvcmFnZVJlZ0V4cCA9IG5ldyBSZWdFeHAoYF5odHRwcz86Ly8ke2Nsb3VkU3RvcmFnZUhvc3R9LyR7YnVja2V0RG9tYWlufS8ke2Nsb3VkU3RvcmFnZVBhdGh9YCwgJ2knKTtcclxuICAgICAgICBjb25zdCBjbG91ZFN0b3JhZ2VJbmRpY2VzID0geyBidWNrZXQ6IDEsIHBhdGg6IDIgfTtcclxuICAgICAgICBjb25zdCBncm91cHMgPSBbXHJcbiAgICAgICAgICAgIHsgcmVnZXg6IGdzUmVnZXgsIGluZGljZXM6IGdzSW5kaWNlcywgcG9zdE1vZGlmeTogZ3NNb2RpZnkgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmVnZXg6IGZpcmViYXNlU3RvcmFnZVJlZ0V4cCxcclxuICAgICAgICAgICAgICAgIGluZGljZXM6IGZpcmViYXNlU3RvcmFnZUluZGljZXMsXHJcbiAgICAgICAgICAgICAgICBwb3N0TW9kaWZ5OiBodHRwTW9kaWZ5XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJlZ2V4OiBjbG91ZFN0b3JhZ2VSZWdFeHAsXHJcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiBjbG91ZFN0b3JhZ2VJbmRpY2VzLFxyXG4gICAgICAgICAgICAgICAgcG9zdE1vZGlmeTogaHR0cE1vZGlmeVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBncm91cCA9IGdyb3Vwc1tpXTtcclxuICAgICAgICAgICAgY29uc3QgY2FwdHVyZXMgPSBncm91cC5yZWdleC5leGVjKHVybCk7XHJcbiAgICAgICAgICAgIGlmIChjYXB0dXJlcykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYnVja2V0VmFsdWUgPSBjYXB0dXJlc1tncm91cC5pbmRpY2VzLmJ1Y2tldF07XHJcbiAgICAgICAgICAgICAgICBsZXQgcGF0aFZhbHVlID0gY2FwdHVyZXNbZ3JvdXAuaW5kaWNlcy5wYXRoXTtcclxuICAgICAgICAgICAgICAgIGlmICghcGF0aFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aFZhbHVlID0gJyc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IG5ldyBMb2NhdGlvbihidWNrZXRWYWx1ZSwgcGF0aFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGdyb3VwLnBvc3RNb2RpZnkobG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxvY2F0aW9uID09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgaW52YWxpZFVybCh1cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbG9jYXRpb247XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEEgcmVxdWVzdCB3aG9zZSBwcm9taXNlIGFsd2F5cyBmYWlscy5cclxuICovXHJcbmNsYXNzIEZhaWxSZXF1ZXN0IHtcclxuICAgIGNvbnN0cnVjdG9yKGVycm9yKSB7XHJcbiAgICAgICAgdGhpcy5wcm9taXNlXyA9IFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgIH1cclxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xyXG4gICAgZ2V0UHJvbWlzZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9taXNlXztcclxuICAgIH1cclxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xyXG4gICAgY2FuY2VsKF9hcHBEZWxldGUgPSBmYWxzZSkgeyB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEFjY2VwdHMgYSBjYWxsYmFjayBmb3IgYW4gYWN0aW9uIHRvIHBlcmZvcm0gKGBkb1JlcXVlc3RgKSxcclxuICogYW5kIHRoZW4gYSBjYWxsYmFjayBmb3Igd2hlbiB0aGUgYmFja29mZiBoYXMgY29tcGxldGVkIChgYmFja29mZkNvbXBsZXRlQ2JgKS5cclxuICogVGhlIGNhbGxiYWNrIHNlbnQgdG8gc3RhcnQgcmVxdWlyZXMgYW4gYXJndW1lbnQgdG8gY2FsbCAoYG9uUmVxdWVzdENvbXBsZXRlYCkuXHJcbiAqIFdoZW4gYHN0YXJ0YCBjYWxscyBgZG9SZXF1ZXN0YCwgaXQgcGFzc2VzIGEgY2FsbGJhY2sgZm9yIHdoZW4gdGhlIHJlcXVlc3QgaGFzXHJcbiAqIGNvbXBsZXRlZCwgYG9uUmVxdWVzdENvbXBsZXRlYC4gQmFzZWQgb24gdGhpcywgdGhlIGJhY2tvZmYgY29udGludWVzLCB3aXRoXHJcbiAqIGFub3RoZXIgY2FsbCB0byBgZG9SZXF1ZXN0YCBhbmQgdGhlIGFib3ZlIGxvb3AgY29udGludWVzIHVudGlsIHRoZSB0aW1lb3V0XHJcbiAqIGlzIGhpdCwgb3IgYSBzdWNjZXNzZnVsIHJlc3BvbnNlIG9jY3Vycy5cclxuICogQGRlc2NyaXB0aW9uXHJcbiAqIEBwYXJhbSBkb1JlcXVlc3QgQ2FsbGJhY2sgdG8gcGVyZm9ybSByZXF1ZXN0XHJcbiAqIEBwYXJhbSBiYWNrb2ZmQ29tcGxldGVDYiBDYWxsYmFjayB0byBjYWxsIHdoZW4gYmFja29mZiBoYXMgYmVlbiBjb21wbGV0ZWRcclxuICovXHJcbmZ1bmN0aW9uIHN0YXJ0KGRvUmVxdWVzdCwgXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbmJhY2tvZmZDb21wbGV0ZUNiLCB0aW1lb3V0KSB7XHJcbiAgICAvLyBUT0RPKGFuZHlzb3RvKTogbWFrZSB0aGlzIGNvZGUgY2xlYW5lciAocHJvYmFibHkgcmVmYWN0b3IgaW50byBhbiBhY3R1YWxcclxuICAgIC8vIHR5cGUgaW5zdGVhZCBvZiBhIGJ1bmNoIG9mIGZ1bmN0aW9ucyB3aXRoIHN0YXRlIHNoYXJlZCBpbiB0aGUgY2xvc3VyZSlcclxuICAgIGxldCB3YWl0U2Vjb25kcyA9IDE7XHJcbiAgICAvLyBXb3VsZCB0eXBlIHRoaXMgYXMgXCJudW1iZXJcIiBidXQgdGhhdCBkb2Vzbid0IHdvcmsgZm9yIE5vZGUgc28gwq9cXF8o44OEKV8vwq9cclxuICAgIC8vIFRPRE86IGZpbmQgYSB3YXkgdG8gZXhjbHVkZSBOb2RlIHR5cGUgZGVmaW5pdGlvbiBmb3Igc3RvcmFnZSBiZWNhdXNlIHN0b3JhZ2Ugb25seSB3b3JrcyBpbiBicm93c2VyXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxyXG4gICAgbGV0IHJldHJ5VGltZW91dElkID0gbnVsbDtcclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XHJcbiAgICBsZXQgZ2xvYmFsVGltZW91dElkID0gbnVsbDtcclxuICAgIGxldCBoaXRUaW1lb3V0ID0gZmFsc2U7XHJcbiAgICBsZXQgY2FuY2VsU3RhdGUgPSAwO1xyXG4gICAgZnVuY3Rpb24gY2FuY2VsZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIGNhbmNlbFN0YXRlID09PSAyO1xyXG4gICAgfVxyXG4gICAgbGV0IHRyaWdnZXJlZENhbGxiYWNrID0gZmFsc2U7XHJcbiAgICBmdW5jdGlvbiB0cmlnZ2VyQ2FsbGJhY2soLi4uYXJncykge1xyXG4gICAgICAgIGlmICghdHJpZ2dlcmVkQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdHJpZ2dlcmVkQ2FsbGJhY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICBiYWNrb2ZmQ29tcGxldGVDYi5hcHBseShudWxsLCBhcmdzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBjYWxsV2l0aERlbGF5KG1pbGxpcykge1xyXG4gICAgICAgIHJldHJ5VGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHJ5VGltZW91dElkID0gbnVsbDtcclxuICAgICAgICAgICAgZG9SZXF1ZXN0KHJlc3BvbnNlSGFuZGxlciwgY2FuY2VsZWQoKSk7XHJcbiAgICAgICAgfSwgbWlsbGlzKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGNsZWFyR2xvYmFsVGltZW91dCgpIHtcclxuICAgICAgICBpZiAoZ2xvYmFsVGltZW91dElkKSB7XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChnbG9iYWxUaW1lb3V0SWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHJlc3BvbnNlSGFuZGxlcihzdWNjZXNzLCAuLi5hcmdzKSB7XHJcbiAgICAgICAgaWYgKHRyaWdnZXJlZENhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIGNsZWFyR2xvYmFsVGltZW91dCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgIGNsZWFyR2xvYmFsVGltZW91dCgpO1xyXG4gICAgICAgICAgICB0cmlnZ2VyQ2FsbGJhY2suY2FsbChudWxsLCBzdWNjZXNzLCAuLi5hcmdzKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBtdXN0U3RvcCA9IGNhbmNlbGVkKCkgfHwgaGl0VGltZW91dDtcclxuICAgICAgICBpZiAobXVzdFN0b3ApIHtcclxuICAgICAgICAgICAgY2xlYXJHbG9iYWxUaW1lb3V0KCk7XHJcbiAgICAgICAgICAgIHRyaWdnZXJDYWxsYmFjay5jYWxsKG51bGwsIHN1Y2Nlc3MsIC4uLmFyZ3MpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh3YWl0U2Vjb25kcyA8IDY0KSB7XHJcbiAgICAgICAgICAgIC8qIFRPRE8oYW5keXNvdG8pOiBkb24ndCBiYWNrIG9mZiBzbyBxdWlja2x5IGlmIHdlIGtub3cgd2UncmUgb2ZmbGluZS4gKi9cclxuICAgICAgICAgICAgd2FpdFNlY29uZHMgKj0gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHdhaXRNaWxsaXM7XHJcbiAgICAgICAgaWYgKGNhbmNlbFN0YXRlID09PSAxKSB7XHJcbiAgICAgICAgICAgIGNhbmNlbFN0YXRlID0gMjtcclxuICAgICAgICAgICAgd2FpdE1pbGxpcyA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB3YWl0TWlsbGlzID0gKHdhaXRTZWNvbmRzICsgTWF0aC5yYW5kb20oKSkgKiAxMDAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsV2l0aERlbGF5KHdhaXRNaWxsaXMpO1xyXG4gICAgfVxyXG4gICAgbGV0IHN0b3BwZWQgPSBmYWxzZTtcclxuICAgIGZ1bmN0aW9uIHN0b3Aod2FzVGltZW91dCkge1xyXG4gICAgICAgIGlmIChzdG9wcGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3RvcHBlZCA9IHRydWU7XHJcbiAgICAgICAgY2xlYXJHbG9iYWxUaW1lb3V0KCk7XHJcbiAgICAgICAgaWYgKHRyaWdnZXJlZENhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJldHJ5VGltZW91dElkICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmICghd2FzVGltZW91dCkge1xyXG4gICAgICAgICAgICAgICAgY2FuY2VsU3RhdGUgPSAyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChyZXRyeVRpbWVvdXRJZCk7XHJcbiAgICAgICAgICAgIGNhbGxXaXRoRGVsYXkoMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoIXdhc1RpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgIGNhbmNlbFN0YXRlID0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNhbGxXaXRoRGVsYXkoMCk7XHJcbiAgICBnbG9iYWxUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBoaXRUaW1lb3V0ID0gdHJ1ZTtcclxuICAgICAgICBzdG9wKHRydWUpO1xyXG4gICAgfSwgdGltZW91dCk7XHJcbiAgICByZXR1cm4gc3RvcDtcclxufVxyXG4vKipcclxuICogU3RvcHMgdGhlIHJldHJ5IGxvb3AgZnJvbSByZXBlYXRpbmcuXHJcbiAqIElmIHRoZSBmdW5jdGlvbiBpcyBjdXJyZW50bHkgXCJpbiBiZXR3ZWVuXCIgcmV0cmllcywgaXQgaXMgaW52b2tlZCBpbW1lZGlhdGVseVxyXG4gKiB3aXRoIHRoZSBzZWNvbmQgcGFyYW1ldGVyIGFzIFwidHJ1ZVwiLiBPdGhlcndpc2UsIGl0IHdpbGwgYmUgaW52b2tlZCBvbmNlIG1vcmVcclxuICogYWZ0ZXIgdGhlIGN1cnJlbnQgaW52b2NhdGlvbiBmaW5pc2hlcyBpZmYgdGhlIGN1cnJlbnQgaW52b2NhdGlvbiB3b3VsZCBoYXZlXHJcbiAqIHRyaWdnZXJlZCBhbm90aGVyIHJldHJ5LlxyXG4gKi9cclxuZnVuY3Rpb24gc3RvcChpZCkge1xyXG4gICAgaWQoZmFsc2UpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGlzSnVzdERlZihwKSB7XHJcbiAgICByZXR1cm4gcCAhPT0gdm9pZCAwO1xyXG59XHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXHJcbmZ1bmN0aW9uIGlzRnVuY3Rpb24ocCkge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBwID09PSAnZnVuY3Rpb24nO1xyXG59XHJcbmZ1bmN0aW9uIGlzTm9uQXJyYXlPYmplY3QocCkge1xyXG4gICAgcmV0dXJuIHR5cGVvZiBwID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShwKTtcclxufVxyXG5mdW5jdGlvbiBpc1N0cmluZyhwKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHAgPT09ICdzdHJpbmcnIHx8IHAgaW5zdGFuY2VvZiBTdHJpbmc7XHJcbn1cclxuZnVuY3Rpb24gaXNOYXRpdmVCbG9iKHApIHtcclxuICAgIHJldHVybiBpc05hdGl2ZUJsb2JEZWZpbmVkKCkgJiYgcCBpbnN0YW5jZW9mIEJsb2I7XHJcbn1cclxuZnVuY3Rpb24gaXNOYXRpdmVCbG9iRGVmaW5lZCgpIHtcclxuICAgIC8vIE5vdGU6IFRoZSBgaXNOb2RlKClgIGNoZWNrIGNhbiBiZSByZW1vdmVkIHdoZW4gYG5vZGUtZmV0Y2hgIGFkZHMgbmF0aXZlIEJsb2Igc3VwcG9ydFxyXG4gICAgLy8gUFI6IGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlLWZldGNoL25vZGUtZmV0Y2gvcHVsbC8xNjY0XHJcbiAgICByZXR1cm4gdHlwZW9mIEJsb2IgIT09ICd1bmRlZmluZWQnICYmICFpc05vZGUoKTtcclxufVxyXG5mdW5jdGlvbiB2YWxpZGF0ZU51bWJlcihhcmd1bWVudCwgbWluVmFsdWUsIG1heFZhbHVlLCB2YWx1ZSkge1xyXG4gICAgaWYgKHZhbHVlIDwgbWluVmFsdWUpIHtcclxuICAgICAgICB0aHJvdyBpbnZhbGlkQXJndW1lbnQoYEludmFsaWQgdmFsdWUgZm9yICcke2FyZ3VtZW50fScuIEV4cGVjdGVkICR7bWluVmFsdWV9IG9yIGdyZWF0ZXIuYCk7XHJcbiAgICB9XHJcbiAgICBpZiAodmFsdWUgPiBtYXhWYWx1ZSkge1xyXG4gICAgICAgIHRocm93IGludmFsaWRBcmd1bWVudChgSW52YWxpZCB2YWx1ZSBmb3IgJyR7YXJndW1lbnR9Jy4gRXhwZWN0ZWQgJHttYXhWYWx1ZX0gb3IgbGVzcy5gKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBtYWtlVXJsKHVybFBhcnQsIGhvc3QsIHByb3RvY29sKSB7XHJcbiAgICBsZXQgb3JpZ2luID0gaG9zdDtcclxuICAgIGlmIChwcm90b2NvbCA9PSBudWxsKSB7XHJcbiAgICAgICAgb3JpZ2luID0gYGh0dHBzOi8vJHtob3N0fWA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYCR7cHJvdG9jb2x9Oi8vJHtvcmlnaW59L3YwJHt1cmxQYXJ0fWA7XHJcbn1cclxuZnVuY3Rpb24gbWFrZVF1ZXJ5U3RyaW5nKHBhcmFtcykge1xyXG4gICAgY29uc3QgZW5jb2RlID0gZW5jb2RlVVJJQ29tcG9uZW50O1xyXG4gICAgbGV0IHF1ZXJ5UGFydCA9ICc/JztcclxuICAgIGZvciAoY29uc3Qga2V5IGluIHBhcmFtcykge1xyXG4gICAgICAgIGlmIChwYXJhbXMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICBjb25zdCBuZXh0UGFydCA9IGVuY29kZShrZXkpICsgJz0nICsgZW5jb2RlKHBhcmFtc1trZXldKTtcclxuICAgICAgICAgICAgcXVlcnlQYXJ0ID0gcXVlcnlQYXJ0ICsgbmV4dFBhcnQgKyAnJic7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gQ2hvcCBvZmYgdGhlIGV4dHJhICcmJyBvciAnPycgb24gdGhlIGVuZFxyXG4gICAgcXVlcnlQYXJ0ID0gcXVlcnlQYXJ0LnNsaWNlKDAsIC0xKTtcclxuICAgIHJldHVybiBxdWVyeVBhcnQ7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEVycm9yIGNvZGVzIGZvciByZXF1ZXN0cyBtYWRlIGJ5IHRoZSB0aGUgWGhySW8gd3JhcHBlci5cclxuICovXHJcbnZhciBFcnJvckNvZGU7XHJcbihmdW5jdGlvbiAoRXJyb3JDb2RlKSB7XHJcbiAgICBFcnJvckNvZGVbRXJyb3JDb2RlW1wiTk9fRVJST1JcIl0gPSAwXSA9IFwiTk9fRVJST1JcIjtcclxuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJORVRXT1JLX0VSUk9SXCJdID0gMV0gPSBcIk5FVFdPUktfRVJST1JcIjtcclxuICAgIEVycm9yQ29kZVtFcnJvckNvZGVbXCJBQk9SVFwiXSA9IDJdID0gXCJBQk9SVFwiO1xyXG59KShFcnJvckNvZGUgfHwgKEVycm9yQ29kZSA9IHt9KSk7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBDaGVja3MgdGhlIHN0YXR1cyBjb2RlIHRvIHNlZSBpZiB0aGUgYWN0aW9uIHNob3VsZCBiZSByZXRyaWVkLlxyXG4gKlxyXG4gKiBAcGFyYW0gc3RhdHVzIEN1cnJlbnQgSFRUUCBzdGF0dXMgY29kZSByZXR1cm5lZCBieSBzZXJ2ZXIuXHJcbiAqIEBwYXJhbSBhZGRpdGlvbmFsUmV0cnlDb2RlcyBhZGRpdGlvbmFsIHJldHJ5IGNvZGVzIHRvIGNoZWNrIGFnYWluc3RcclxuICovXHJcbmZ1bmN0aW9uIGlzUmV0cnlTdGF0dXNDb2RlKHN0YXR1cywgYWRkaXRpb25hbFJldHJ5Q29kZXMpIHtcclxuICAgIC8vIFRoZSBjb2RlcyBmb3Igd2hpY2ggdG8gcmV0cnkgY2FtZSBmcm9tIHRoaXMgcGFnZTpcclxuICAgIC8vIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9zdG9yYWdlL2RvY3MvZXhwb25lbnRpYWwtYmFja29mZlxyXG4gICAgY29uc3QgaXNGaXZlSHVuZHJlZENvZGUgPSBzdGF0dXMgPj0gNTAwICYmIHN0YXR1cyA8IDYwMDtcclxuICAgIGNvbnN0IGV4dHJhUmV0cnlDb2RlcyA9IFtcclxuICAgICAgICAvLyBSZXF1ZXN0IFRpbWVvdXQ6IHdlYiBzZXJ2ZXIgZGlkbid0IHJlY2VpdmUgZnVsbCByZXF1ZXN0IGluIHRpbWUuXHJcbiAgICAgICAgNDA4LFxyXG4gICAgICAgIC8vIFRvbyBNYW55IFJlcXVlc3RzOiB5b3UncmUgZ2V0dGluZyByYXRlLWxpbWl0ZWQsIGJhc2ljYWxseS5cclxuICAgICAgICA0MjlcclxuICAgIF07XHJcbiAgICBjb25zdCBpc0V4dHJhUmV0cnlDb2RlID0gZXh0cmFSZXRyeUNvZGVzLmluZGV4T2Yoc3RhdHVzKSAhPT0gLTE7XHJcbiAgICBjb25zdCBpc0FkZGl0aW9uYWxSZXRyeUNvZGUgPSBhZGRpdGlvbmFsUmV0cnlDb2Rlcy5pbmRleE9mKHN0YXR1cykgIT09IC0xO1xyXG4gICAgcmV0dXJuIGlzRml2ZUh1bmRyZWRDb2RlIHx8IGlzRXh0cmFSZXRyeUNvZGUgfHwgaXNBZGRpdGlvbmFsUmV0cnlDb2RlO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBIYW5kbGVzIG5ldHdvcmsgbG9naWMgZm9yIGFsbCBTdG9yYWdlIFJlcXVlc3RzLCBpbmNsdWRpbmcgZXJyb3IgcmVwb3J0aW5nIGFuZFxyXG4gKiByZXRyaWVzIHdpdGggYmFja29mZi5cclxuICpcclxuICogQHBhcmFtIEkgLSB0aGUgdHlwZSBvZiB0aGUgYmFja2VuZCdzIG5ldHdvcmsgcmVzcG9uc2UuXHJcbiAqIEBwYXJhbSAtIE8gdGhlIG91dHB1dCB0eXBlIHVzZWQgYnkgdGhlIHJlc3Qgb2YgdGhlIFNESy4gVGhlIGNvbnZlcnNpb25cclxuICogaGFwcGVucyBpbiB0aGUgc3BlY2lmaWVkIGBjYWxsYmFja19gLlxyXG4gKi9cclxuY2xhc3MgTmV0d29ya1JlcXVlc3Qge1xyXG4gICAgY29uc3RydWN0b3IodXJsXywgbWV0aG9kXywgaGVhZGVyc18sIGJvZHlfLCBzdWNjZXNzQ29kZXNfLCBhZGRpdGlvbmFsUmV0cnlDb2Rlc18sIGNhbGxiYWNrXywgZXJyb3JDYWxsYmFja18sIHRpbWVvdXRfLCBwcm9ncmVzc0NhbGxiYWNrXywgY29ubmVjdGlvbkZhY3RvcnlfLCByZXRyeSA9IHRydWUpIHtcclxuICAgICAgICB0aGlzLnVybF8gPSB1cmxfO1xyXG4gICAgICAgIHRoaXMubWV0aG9kXyA9IG1ldGhvZF87XHJcbiAgICAgICAgdGhpcy5oZWFkZXJzXyA9IGhlYWRlcnNfO1xyXG4gICAgICAgIHRoaXMuYm9keV8gPSBib2R5XztcclxuICAgICAgICB0aGlzLnN1Y2Nlc3NDb2Rlc18gPSBzdWNjZXNzQ29kZXNfO1xyXG4gICAgICAgIHRoaXMuYWRkaXRpb25hbFJldHJ5Q29kZXNfID0gYWRkaXRpb25hbFJldHJ5Q29kZXNfO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2tfID0gY2FsbGJhY2tfO1xyXG4gICAgICAgIHRoaXMuZXJyb3JDYWxsYmFja18gPSBlcnJvckNhbGxiYWNrXztcclxuICAgICAgICB0aGlzLnRpbWVvdXRfID0gdGltZW91dF87XHJcbiAgICAgICAgdGhpcy5wcm9ncmVzc0NhbGxiYWNrXyA9IHByb2dyZXNzQ2FsbGJhY2tfO1xyXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbkZhY3RvcnlfID0gY29ubmVjdGlvbkZhY3RvcnlfO1xyXG4gICAgICAgIHRoaXMucmV0cnkgPSByZXRyeTtcclxuICAgICAgICB0aGlzLnBlbmRpbmdDb25uZWN0aW9uXyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5iYWNrb2ZmSWRfID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNhbmNlbGVkXyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYXBwRGVsZXRlXyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucHJvbWlzZV8gPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzb2x2ZV8gPSByZXNvbHZlO1xyXG4gICAgICAgICAgICB0aGlzLnJlamVjdF8gPSByZWplY3Q7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRfKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFjdHVhbGx5IHN0YXJ0cyB0aGUgcmV0cnkgbG9vcC5cclxuICAgICAqL1xyXG4gICAgc3RhcnRfKCkge1xyXG4gICAgICAgIGNvbnN0IGRvVGhlUmVxdWVzdCA9IChiYWNrb2ZmQ2FsbGJhY2ssIGNhbmNlbGVkKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChjYW5jZWxlZCkge1xyXG4gICAgICAgICAgICAgICAgYmFja29mZkNhbGxiYWNrKGZhbHNlLCBuZXcgUmVxdWVzdEVuZFN0YXR1cyhmYWxzZSwgbnVsbCwgdHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSB0aGlzLmNvbm5lY3Rpb25GYWN0b3J5XygpO1xyXG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdDb25uZWN0aW9uXyA9IGNvbm5lY3Rpb247XHJcbiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzTGlzdGVuZXIgPSBwcm9ncmVzc0V2ZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGxvYWRlZCA9IHByb2dyZXNzRXZlbnQubG9hZGVkO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG90YWwgPSBwcm9ncmVzc0V2ZW50Lmxlbmd0aENvbXB1dGFibGUgPyBwcm9ncmVzc0V2ZW50LnRvdGFsIDogLTE7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9ncmVzc0NhbGxiYWNrXyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NDYWxsYmFja18obG9hZGVkLCB0b3RhbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnByb2dyZXNzQ2FsbGJhY2tfICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLmFkZFVwbG9hZFByb2dyZXNzTGlzdGVuZXIocHJvZ3Jlc3NMaXN0ZW5lcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gY29ubmVjdGlvbi5zZW5kKCkgbmV2ZXIgcmVqZWN0cywgc28gd2UgZG9uJ3QgbmVlZCB0byBoYXZlIGEgZXJyb3IgaGFuZGxlciBvciB1c2UgY2F0Y2ggb24gdGhlIHJldHVybmVkIHByb21pc2UuXHJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcclxuICAgICAgICAgICAgY29ubmVjdGlvblxyXG4gICAgICAgICAgICAgICAgLnNlbmQodGhpcy51cmxfLCB0aGlzLm1ldGhvZF8sIHRoaXMuYm9keV8sIHRoaXMuaGVhZGVyc18pXHJcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9ncmVzc0NhbGxiYWNrXyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVtb3ZlVXBsb2FkUHJvZ3Jlc3NMaXN0ZW5lcihwcm9ncmVzc0xpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0Nvbm5lY3Rpb25fID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhpdFNlcnZlciA9IGNvbm5lY3Rpb24uZ2V0RXJyb3JDb2RlKCkgPT09IEVycm9yQ29kZS5OT19FUlJPUjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGNvbm5lY3Rpb24uZ2V0U3RhdHVzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWhpdFNlcnZlciB8fFxyXG4gICAgICAgICAgICAgICAgICAgIChpc1JldHJ5U3RhdHVzQ29kZShzdGF0dXMsIHRoaXMuYWRkaXRpb25hbFJldHJ5Q29kZXNfKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJldHJ5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhc0NhbmNlbGVkID0gY29ubmVjdGlvbi5nZXRFcnJvckNvZGUoKSA9PT0gRXJyb3JDb2RlLkFCT1JUO1xyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tvZmZDYWxsYmFjayhmYWxzZSwgbmV3IFJlcXVlc3RFbmRTdGF0dXMoZmFsc2UsIG51bGwsIHdhc0NhbmNlbGVkKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc0NvZGUgPSB0aGlzLnN1Y2Nlc3NDb2Rlc18uaW5kZXhPZihzdGF0dXMpICE9PSAtMTtcclxuICAgICAgICAgICAgICAgIGJhY2tvZmZDYWxsYmFjayh0cnVlLCBuZXcgUmVxdWVzdEVuZFN0YXR1cyhzdWNjZXNzQ29kZSwgY29ubmVjdGlvbikpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwYXJhbSByZXF1ZXN0V2VudFRocm91Z2ggLSBUcnVlIGlmIHRoZSByZXF1ZXN0IGV2ZW50dWFsbHkgd2VudFxyXG4gICAgICAgICAqICAgICB0aHJvdWdoLCBmYWxzZSBpZiBpdCBoaXQgdGhlIHJldHJ5IGxpbWl0IG9yIHdhcyBjYW5jZWxlZC5cclxuICAgICAgICAgKi9cclxuICAgICAgICBjb25zdCBiYWNrb2ZmRG9uZSA9IChyZXF1ZXN0V2VudFRocm91Z2gsIHN0YXR1cykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXNvbHZlID0gdGhpcy5yZXNvbHZlXztcclxuICAgICAgICAgICAgY29uc3QgcmVqZWN0ID0gdGhpcy5yZWplY3RfO1xyXG4gICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uID0gc3RhdHVzLmNvbm5lY3Rpb247XHJcbiAgICAgICAgICAgIGlmIChzdGF0dXMud2FzU3VjY2Vzc0NvZGUpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5jYWxsYmFja18oY29ubmVjdGlvbiwgY29ubmVjdGlvbi5nZXRSZXNwb25zZSgpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNKdXN0RGVmKHJlc3VsdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSB1bmtub3duKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyLnNlcnZlclJlc3BvbnNlID0gY29ubmVjdGlvbi5nZXRFcnJvclRleHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lcnJvckNhbGxiYWNrXykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QodGhpcy5lcnJvckNhbGxiYWNrXyhjb25uZWN0aW9uLCBlcnIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMuY2FuY2VsZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyID0gdGhpcy5hcHBEZWxldGVfID8gYXBwRGVsZXRlZCgpIDogY2FuY2VsZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSByZXRyeUxpbWl0RXhjZWVkZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAodGhpcy5jYW5jZWxlZF8pIHtcclxuICAgICAgICAgICAgYmFja29mZkRvbmUoZmFsc2UsIG5ldyBSZXF1ZXN0RW5kU3RhdHVzKGZhbHNlLCBudWxsLCB0cnVlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmJhY2tvZmZJZF8gPSBzdGFydChkb1RoZVJlcXVlc3QsIGJhY2tvZmZEb25lLCB0aGlzLnRpbWVvdXRfKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKiogQGluaGVyaXREb2MgKi9cclxuICAgIGdldFByb21pc2UoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZV87XHJcbiAgICB9XHJcbiAgICAvKiogQGluaGVyaXREb2MgKi9cclxuICAgIGNhbmNlbChhcHBEZWxldGUpIHtcclxuICAgICAgICB0aGlzLmNhbmNlbGVkXyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5hcHBEZWxldGVfID0gYXBwRGVsZXRlIHx8IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLmJhY2tvZmZJZF8gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgc3RvcCh0aGlzLmJhY2tvZmZJZF8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5wZW5kaW5nQ29ubmVjdGlvbl8gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nQ29ubmVjdGlvbl8uYWJvcnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEEgY29sbGVjdGlvbiBvZiBpbmZvcm1hdGlvbiBhYm91dCB0aGUgcmVzdWx0IG9mIGEgbmV0d29yayByZXF1ZXN0LlxyXG4gKiBAcGFyYW0gb3B0X2NhbmNlbGVkIC0gRGVmYXVsdHMgdG8gZmFsc2UuXHJcbiAqL1xyXG5jbGFzcyBSZXF1ZXN0RW5kU3RhdHVzIHtcclxuICAgIGNvbnN0cnVjdG9yKHdhc1N1Y2Nlc3NDb2RlLCBjb25uZWN0aW9uLCBjYW5jZWxlZCkge1xyXG4gICAgICAgIHRoaXMud2FzU3VjY2Vzc0NvZGUgPSB3YXNTdWNjZXNzQ29kZTtcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xyXG4gICAgICAgIHRoaXMuY2FuY2VsZWQgPSAhIWNhbmNlbGVkO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGFkZEF1dGhIZWFkZXJfKGhlYWRlcnMsIGF1dGhUb2tlbikge1xyXG4gICAgaWYgKGF1dGhUb2tlbiAhPT0gbnVsbCAmJiBhdXRoVG9rZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9ICdGaXJlYmFzZSAnICsgYXV0aFRva2VuO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGFkZFZlcnNpb25IZWFkZXJfKGhlYWRlcnMsIGZpcmViYXNlVmVyc2lvbikge1xyXG4gICAgaGVhZGVyc1snWC1GaXJlYmFzZS1TdG9yYWdlLVZlcnNpb24nXSA9XHJcbiAgICAgICAgJ3dlYmpzLycgKyAoZmlyZWJhc2VWZXJzaW9uICE9PSBudWxsICYmIGZpcmViYXNlVmVyc2lvbiAhPT0gdm9pZCAwID8gZmlyZWJhc2VWZXJzaW9uIDogJ0FwcE1hbmFnZXInKTtcclxufVxyXG5mdW5jdGlvbiBhZGRHbXBpZEhlYWRlcl8oaGVhZGVycywgYXBwSWQpIHtcclxuICAgIGlmIChhcHBJZCkge1xyXG4gICAgICAgIGhlYWRlcnNbJ1gtRmlyZWJhc2UtR01QSUQnXSA9IGFwcElkO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGFkZEFwcENoZWNrSGVhZGVyXyhoZWFkZXJzLCBhcHBDaGVja1Rva2VuKSB7XHJcbiAgICBpZiAoYXBwQ2hlY2tUb2tlbiAhPT0gbnVsbCkge1xyXG4gICAgICAgIGhlYWRlcnNbJ1gtRmlyZWJhc2UtQXBwQ2hlY2snXSA9IGFwcENoZWNrVG9rZW47XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gbWFrZVJlcXVlc3QocmVxdWVzdEluZm8sIGFwcElkLCBhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4sIHJlcXVlc3RGYWN0b3J5LCBmaXJlYmFzZVZlcnNpb24sIHJldHJ5ID0gdHJ1ZSkge1xyXG4gICAgY29uc3QgcXVlcnlQYXJ0ID0gbWFrZVF1ZXJ5U3RyaW5nKHJlcXVlc3RJbmZvLnVybFBhcmFtcyk7XHJcbiAgICBjb25zdCB1cmwgPSByZXF1ZXN0SW5mby51cmwgKyBxdWVyeVBhcnQ7XHJcbiAgICBjb25zdCBoZWFkZXJzID0gT2JqZWN0LmFzc2lnbih7fSwgcmVxdWVzdEluZm8uaGVhZGVycyk7XHJcbiAgICBhZGRHbXBpZEhlYWRlcl8oaGVhZGVycywgYXBwSWQpO1xyXG4gICAgYWRkQXV0aEhlYWRlcl8oaGVhZGVycywgYXV0aFRva2VuKTtcclxuICAgIGFkZFZlcnNpb25IZWFkZXJfKGhlYWRlcnMsIGZpcmViYXNlVmVyc2lvbik7XHJcbiAgICBhZGRBcHBDaGVja0hlYWRlcl8oaGVhZGVycywgYXBwQ2hlY2tUb2tlbik7XHJcbiAgICByZXR1cm4gbmV3IE5ldHdvcmtSZXF1ZXN0KHVybCwgcmVxdWVzdEluZm8ubWV0aG9kLCBoZWFkZXJzLCByZXF1ZXN0SW5mby5ib2R5LCByZXF1ZXN0SW5mby5zdWNjZXNzQ29kZXMsIHJlcXVlc3RJbmZvLmFkZGl0aW9uYWxSZXRyeUNvZGVzLCByZXF1ZXN0SW5mby5oYW5kbGVyLCByZXF1ZXN0SW5mby5lcnJvckhhbmRsZXIsIHJlcXVlc3RJbmZvLnRpbWVvdXQsIHJlcXVlc3RJbmZvLnByb2dyZXNzQ2FsbGJhY2ssIHJlcXVlc3RGYWN0b3J5LCByZXRyeSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0QmxvYkJ1aWxkZXIoKSB7XHJcbiAgICBpZiAodHlwZW9mIEJsb2JCdWlsZGVyICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgIHJldHVybiBCbG9iQnVpbGRlcjtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHR5cGVvZiBXZWJLaXRCbG9iQnVpbGRlciAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICByZXR1cm4gV2ViS2l0QmxvYkJ1aWxkZXI7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBDb25jYXRlbmF0ZXMgb25lIG9yIG1vcmUgdmFsdWVzIHRvZ2V0aGVyIGFuZCBjb252ZXJ0cyB0aGVtIHRvIGEgQmxvYi5cclxuICpcclxuICogQHBhcmFtIGFyZ3MgVGhlIHZhbHVlcyB0aGF0IHdpbGwgbWFrZSB1cCB0aGUgcmVzdWx0aW5nIGJsb2IuXHJcbiAqIEByZXR1cm4gVGhlIGJsb2IuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRCbG9iJDEoLi4uYXJncykge1xyXG4gICAgY29uc3QgQmxvYkJ1aWxkZXIgPSBnZXRCbG9iQnVpbGRlcigpO1xyXG4gICAgaWYgKEJsb2JCdWlsZGVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBjb25zdCBiYiA9IG5ldyBCbG9iQnVpbGRlcigpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBiYi5hcHBlbmQoYXJnc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiYi5nZXRCbG9iKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBpZiAoaXNOYXRpdmVCbG9iRGVmaW5lZCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYihhcmdzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBTdG9yYWdlRXJyb3IoXCJ1bnN1cHBvcnRlZC1lbnZpcm9ubWVudFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuVU5TVVBQT1JURURfRU5WSVJPTk1FTlQgKi8sIFwiVGhpcyBicm93c2VyIGRvZXNuJ3Qgc2VlbSB0byBzdXBwb3J0IGNyZWF0aW5nIEJsb2JzXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4vKipcclxuICogU2xpY2VzIHRoZSBibG9iLiBUaGUgcmV0dXJuZWQgYmxvYiBjb250YWlucyBkYXRhIGZyb20gdGhlIHN0YXJ0IGJ5dGVcclxuICogKGluY2x1c2l2ZSkgdGlsbCB0aGUgZW5kIGJ5dGUgKGV4Y2x1c2l2ZSkuIE5lZ2F0aXZlIGluZGljZXMgY2Fubm90IGJlIHVzZWQuXHJcbiAqXHJcbiAqIEBwYXJhbSBibG9iIFRoZSBibG9iIHRvIGJlIHNsaWNlZC5cclxuICogQHBhcmFtIHN0YXJ0IEluZGV4IG9mIHRoZSBzdGFydGluZyBieXRlLlxyXG4gKiBAcGFyYW0gZW5kIEluZGV4IG9mIHRoZSBlbmRpbmcgYnl0ZS5cclxuICogQHJldHVybiBUaGUgYmxvYiBzbGljZSBvciBudWxsIGlmIG5vdCBzdXBwb3J0ZWQuXHJcbiAqL1xyXG5mdW5jdGlvbiBzbGljZUJsb2IoYmxvYiwgc3RhcnQsIGVuZCkge1xyXG4gICAgaWYgKGJsb2Iud2Via2l0U2xpY2UpIHtcclxuICAgICAgICByZXR1cm4gYmxvYi53ZWJraXRTbGljZShzdGFydCwgZW5kKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGJsb2IubW96U2xpY2UpIHtcclxuICAgICAgICByZXR1cm4gYmxvYi5tb3pTbGljZShzdGFydCwgZW5kKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGJsb2Iuc2xpY2UpIHtcclxuICAgICAgICByZXR1cm4gYmxvYi5zbGljZShzdGFydCwgZW5kKTtcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKiBDb252ZXJ0cyBhIEJhc2U2NCBlbmNvZGVkIHN0cmluZyB0byBhIGJpbmFyeSBzdHJpbmcuICovXHJcbmZ1bmN0aW9uIGRlY29kZUJhc2U2NChlbmNvZGVkKSB7XHJcbiAgICBpZiAodHlwZW9mIGF0b2IgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgdGhyb3cgbWlzc2luZ1BvbHlGaWxsKCdiYXNlLTY0Jyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXRvYihlbmNvZGVkKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQW4gZW51bWVyYXRpb24gb2YgdGhlIHBvc3NpYmxlIHN0cmluZyBmb3JtYXRzIGZvciB1cGxvYWQuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmNvbnN0IFN0cmluZ0Zvcm1hdCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogSW5kaWNhdGVzIHRoZSBzdHJpbmcgc2hvdWxkIGJlIGludGVycHJldGVkIFwicmF3XCIsIHRoYXQgaXMsIGFzIG5vcm1hbCB0ZXh0LlxyXG4gICAgICogVGhlIHN0cmluZyB3aWxsIGJlIGludGVycHJldGVkIGFzIFVURi0xNiwgdGhlbiB1cGxvYWRlZCBhcyBhIFVURi04IGJ5dGVcclxuICAgICAqIHNlcXVlbmNlLlxyXG4gICAgICogRXhhbXBsZTogVGhlIHN0cmluZyAnSGVsbG8hIFxcXFx1ZDgzZFxcXFx1ZGUwYScgYmVjb21lcyB0aGUgYnl0ZSBzZXF1ZW5jZVxyXG4gICAgICogNDggNjUgNmMgNmMgNmYgMjEgMjAgZjAgOWYgOTggOGFcclxuICAgICAqL1xyXG4gICAgUkFXOiAncmF3JyxcclxuICAgIC8qKlxyXG4gICAgICogSW5kaWNhdGVzIHRoZSBzdHJpbmcgc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGJhc2U2NC1lbmNvZGVkIGRhdGEuXHJcbiAgICAgKiBQYWRkaW5nIGNoYXJhY3RlcnMgKHRyYWlsaW5nICc9J3MpIGFyZSBvcHRpb25hbC5cclxuICAgICAqIEV4YW1wbGU6IFRoZSBzdHJpbmcgJ3JXbU8rK0U2dDcvcmx3PT0nIGJlY29tZXMgdGhlIGJ5dGUgc2VxdWVuY2VcclxuICAgICAqIGFkIDY5IDhlIGZiIGUxIDNhIGI3IGJmIGViIDk3XHJcbiAgICAgKi9cclxuICAgIEJBU0U2NDogJ2Jhc2U2NCcsXHJcbiAgICAvKipcclxuICAgICAqIEluZGljYXRlcyB0aGUgc3RyaW5nIHNob3VsZCBiZSBpbnRlcnByZXRlZCBhcyBiYXNlNjR1cmwtZW5jb2RlZCBkYXRhLlxyXG4gICAgICogUGFkZGluZyBjaGFyYWN0ZXJzICh0cmFpbGluZyAnPSdzKSBhcmUgb3B0aW9uYWwuXHJcbiAgICAgKiBFeGFtcGxlOiBUaGUgc3RyaW5nICdyV21PLS1FNnQ3X3Jsdz09JyBiZWNvbWVzIHRoZSBieXRlIHNlcXVlbmNlXHJcbiAgICAgKiBhZCA2OSA4ZSBmYiBlMSAzYSBiNyBiZiBlYiA5N1xyXG4gICAgICovXHJcbiAgICBCQVNFNjRVUkw6ICdiYXNlNjR1cmwnLFxyXG4gICAgLyoqXHJcbiAgICAgKiBJbmRpY2F0ZXMgdGhlIHN0cmluZyBpcyBhIGRhdGEgVVJMLCBzdWNoIGFzIG9uZSBvYnRhaW5lZCBmcm9tXHJcbiAgICAgKiBjYW52YXMudG9EYXRhVVJMKCkuXHJcbiAgICAgKiBFeGFtcGxlOiB0aGUgc3RyaW5nICdkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsYWFhYSdcclxuICAgICAqIGJlY29tZXMgdGhlIGJ5dGUgc2VxdWVuY2VcclxuICAgICAqIDY5IGE2IDlhXHJcbiAgICAgKiAodGhlIGNvbnRlbnQtdHlwZSBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiIGlzIGFsc28gYXBwbGllZCwgYnV0IGNhblxyXG4gICAgICogYmUgb3ZlcnJpZGRlbiBpbiB0aGUgbWV0YWRhdGEgb2JqZWN0KS5cclxuICAgICAqL1xyXG4gICAgREFUQV9VUkw6ICdkYXRhX3VybCdcclxufTtcclxuY2xhc3MgU3RyaW5nRGF0YSB7XHJcbiAgICBjb25zdHJ1Y3RvcihkYXRhLCBjb250ZW50VHlwZSkge1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5jb250ZW50VHlwZSA9IGNvbnRlbnRUeXBlIHx8IG51bGw7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuZnVuY3Rpb24gZGF0YUZyb21TdHJpbmcoZm9ybWF0LCBzdHJpbmdEYXRhKSB7XHJcbiAgICBzd2l0Y2ggKGZvcm1hdCkge1xyXG4gICAgICAgIGNhc2UgU3RyaW5nRm9ybWF0LlJBVzpcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTdHJpbmdEYXRhKHV0ZjhCeXRlc18oc3RyaW5nRGF0YSkpO1xyXG4gICAgICAgIGNhc2UgU3RyaW5nRm9ybWF0LkJBU0U2NDpcclxuICAgICAgICBjYXNlIFN0cmluZ0Zvcm1hdC5CQVNFNjRVUkw6XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nRGF0YShiYXNlNjRCeXRlc18oZm9ybWF0LCBzdHJpbmdEYXRhKSk7XHJcbiAgICAgICAgY2FzZSBTdHJpbmdGb3JtYXQuREFUQV9VUkw6XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3RyaW5nRGF0YShkYXRhVVJMQnl0ZXNfKHN0cmluZ0RhdGEpLCBkYXRhVVJMQ29udGVudFR5cGVfKHN0cmluZ0RhdGEpKTtcclxuICAgICAgICAvLyBkbyBub3RoaW5nXHJcbiAgICB9XHJcbiAgICAvLyBhc3NlcnQoZmFsc2UpO1xyXG4gICAgdGhyb3cgdW5rbm93bigpO1xyXG59XHJcbmZ1bmN0aW9uIHV0ZjhCeXRlc18odmFsdWUpIHtcclxuICAgIGNvbnN0IGIgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBsZXQgYyA9IHZhbHVlLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgaWYgKGMgPD0gMTI3KSB7XHJcbiAgICAgICAgICAgIGIucHVzaChjKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChjIDw9IDIwNDcpIHtcclxuICAgICAgICAgICAgICAgIGIucHVzaCgxOTIgfCAoYyA+PiA2KSwgMTI4IHwgKGMgJiA2MykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKChjICYgNjQ1MTIpID09PSA1NTI5Nikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzdGFydCBvZiBhIHN1cnJvZ2F0ZSBwYWlyLlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkID0gaSA8IHZhbHVlLmxlbmd0aCAtIDEgJiYgKHZhbHVlLmNoYXJDb2RlQXQoaSArIDEpICYgNjQ1MTIpID09PSA1NjMyMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzZWNvbmQgc3Vycm9nYXRlIHdhc24ndCB0aGVyZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYi5wdXNoKDIzOSwgMTkxLCAxODkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGkgPSBjO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsbyA9IHZhbHVlLmNoYXJDb2RlQXQoKytpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IDY1NTM2IHwgKChoaSAmIDEwMjMpIDw8IDEwKSB8IChsbyAmIDEwMjMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiLnB1c2goMjQwIHwgKGMgPj4gMTgpLCAxMjggfCAoKGMgPj4gMTIpICYgNjMpLCAxMjggfCAoKGMgPj4gNikgJiA2MyksIDEyOCB8IChjICYgNjMpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKGMgJiA2NDUxMikgPT09IDU2MzIwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEludmFsaWQgbG93IHN1cnJvZ2F0ZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYi5wdXNoKDIzOSwgMTkxLCAxODkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYi5wdXNoKDIyNCB8IChjID4+IDEyKSwgMTI4IHwgKChjID4+IDYpICYgNjMpLCAxMjggfCAoYyAmIDYzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGIpO1xyXG59XHJcbmZ1bmN0aW9uIHBlcmNlbnRFbmNvZGVkQnl0ZXNfKHZhbHVlKSB7XHJcbiAgICBsZXQgZGVjb2RlZDtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgZGVjb2RlZCA9IGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIHRocm93IGludmFsaWRGb3JtYXQoU3RyaW5nRm9ybWF0LkRBVEFfVVJMLCAnTWFsZm9ybWVkIGRhdGEgVVJMLicpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHV0ZjhCeXRlc18oZGVjb2RlZCk7XHJcbn1cclxuZnVuY3Rpb24gYmFzZTY0Qnl0ZXNfKGZvcm1hdCwgdmFsdWUpIHtcclxuICAgIHN3aXRjaCAoZm9ybWF0KSB7XHJcbiAgICAgICAgY2FzZSBTdHJpbmdGb3JtYXQuQkFTRTY0OiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhc01pbnVzID0gdmFsdWUuaW5kZXhPZignLScpICE9PSAtMTtcclxuICAgICAgICAgICAgY29uc3QgaGFzVW5kZXIgPSB2YWx1ZS5pbmRleE9mKCdfJykgIT09IC0xO1xyXG4gICAgICAgICAgICBpZiAoaGFzTWludXMgfHwgaGFzVW5kZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGludmFsaWRDaGFyID0gaGFzTWludXMgPyAnLScgOiAnXyc7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBpbnZhbGlkRm9ybWF0KGZvcm1hdCwgXCJJbnZhbGlkIGNoYXJhY3RlciAnXCIgK1xyXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRDaGFyICtcclxuICAgICAgICAgICAgICAgICAgICBcIicgZm91bmQ6IGlzIGl0IGJhc2U2NHVybCBlbmNvZGVkP1wiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSBTdHJpbmdGb3JtYXQuQkFTRTY0VVJMOiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGhhc1BsdXMgPSB2YWx1ZS5pbmRleE9mKCcrJykgIT09IC0xO1xyXG4gICAgICAgICAgICBjb25zdCBoYXNTbGFzaCA9IHZhbHVlLmluZGV4T2YoJy8nKSAhPT0gLTE7XHJcbiAgICAgICAgICAgIGlmIChoYXNQbHVzIHx8IGhhc1NsYXNoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnZhbGlkQ2hhciA9IGhhc1BsdXMgPyAnKycgOiAnLyc7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBpbnZhbGlkRm9ybWF0KGZvcm1hdCwgXCJJbnZhbGlkIGNoYXJhY3RlciAnXCIgKyBpbnZhbGlkQ2hhciArIFwiJyBmb3VuZDogaXMgaXQgYmFzZTY0IGVuY29kZWQ/XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvLS9nLCAnKycpLnJlcGxhY2UoL18vZywgJy8nKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGRvIG5vdGhpbmdcclxuICAgIH1cclxuICAgIGxldCBieXRlcztcclxuICAgIHRyeSB7XHJcbiAgICAgICAgYnl0ZXMgPSBkZWNvZGVCYXNlNjQodmFsdWUpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICBpZiAoZS5tZXNzYWdlLmluY2x1ZGVzKCdwb2x5ZmlsbCcpKSB7XHJcbiAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGludmFsaWRGb3JtYXQoZm9ybWF0LCAnSW52YWxpZCBjaGFyYWN0ZXIgZm91bmQnKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoYnl0ZXMubGVuZ3RoKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBhcnJheVtpXSA9IGJ5dGVzLmNoYXJDb2RlQXQoaSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXJyYXk7XHJcbn1cclxuY2xhc3MgRGF0YVVSTFBhcnRzIHtcclxuICAgIGNvbnN0cnVjdG9yKGRhdGFVUkwpIHtcclxuICAgICAgICB0aGlzLmJhc2U2NCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29udGVudFR5cGUgPSBudWxsO1xyXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBkYXRhVVJMLm1hdGNoKC9eZGF0YTooW14sXSspPywvKTtcclxuICAgICAgICBpZiAobWF0Y2hlcyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBpbnZhbGlkRm9ybWF0KFN0cmluZ0Zvcm1hdC5EQVRBX1VSTCwgXCJNdXN0IGJlIGZvcm1hdHRlZCAnZGF0YTpbPG1lZGlhdHlwZT5dWztiYXNlNjRdLDxkYXRhPlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbWlkZGxlID0gbWF0Y2hlc1sxXSB8fCBudWxsO1xyXG4gICAgICAgIGlmIChtaWRkbGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmJhc2U2NCA9IGVuZHNXaXRoKG1pZGRsZSwgJztiYXNlNjQnKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VHlwZSA9IHRoaXMuYmFzZTY0XHJcbiAgICAgICAgICAgICAgICA/IG1pZGRsZS5zdWJzdHJpbmcoMCwgbWlkZGxlLmxlbmd0aCAtICc7YmFzZTY0Jy5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICA6IG1pZGRsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXN0ID0gZGF0YVVSTC5zdWJzdHJpbmcoZGF0YVVSTC5pbmRleE9mKCcsJykgKyAxKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBkYXRhVVJMQnl0ZXNfKGRhdGFVcmwpIHtcclxuICAgIGNvbnN0IHBhcnRzID0gbmV3IERhdGFVUkxQYXJ0cyhkYXRhVXJsKTtcclxuICAgIGlmIChwYXJ0cy5iYXNlNjQpIHtcclxuICAgICAgICByZXR1cm4gYmFzZTY0Qnl0ZXNfKFN0cmluZ0Zvcm1hdC5CQVNFNjQsIHBhcnRzLnJlc3QpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHBlcmNlbnRFbmNvZGVkQnl0ZXNfKHBhcnRzLnJlc3QpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGRhdGFVUkxDb250ZW50VHlwZV8oZGF0YVVybCkge1xyXG4gICAgY29uc3QgcGFydHMgPSBuZXcgRGF0YVVSTFBhcnRzKGRhdGFVcmwpO1xyXG4gICAgcmV0dXJuIHBhcnRzLmNvbnRlbnRUeXBlO1xyXG59XHJcbmZ1bmN0aW9uIGVuZHNXaXRoKHMsIGVuZCkge1xyXG4gICAgY29uc3QgbG9uZ0Vub3VnaCA9IHMubGVuZ3RoID49IGVuZC5sZW5ndGg7XHJcbiAgICBpZiAoIWxvbmdFbm91Z2gpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcy5zdWJzdHJpbmcocy5sZW5ndGggLSBlbmQubGVuZ3RoKSA9PT0gZW5kO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBAcGFyYW0gb3B0X2VsaWRlQ29weSAtIElmIHRydWUsIGRvZXNuJ3QgY29weSBtdXRhYmxlIGlucHV0IGRhdGFcclxuICogICAgIChlLmcuIFVpbnQ4QXJyYXlzKS4gUGFzcyB0cnVlIG9ubHkgaWYgeW91IGtub3cgdGhlIG9iamVjdHMgd2lsbCBub3QgYmVcclxuICogICAgIG1vZGlmaWVkIGFmdGVyIHRoaXMgYmxvYidzIGNvbnN0cnVjdGlvbi5cclxuICpcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5jbGFzcyBGYnNCbG9iIHtcclxuICAgIGNvbnN0cnVjdG9yKGRhdGEsIGVsaWRlQ29weSkge1xyXG4gICAgICAgIGxldCBzaXplID0gMDtcclxuICAgICAgICBsZXQgYmxvYlR5cGUgPSAnJztcclxuICAgICAgICBpZiAoaXNOYXRpdmVCbG9iKGRhdGEpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YV8gPSBkYXRhO1xyXG4gICAgICAgICAgICBzaXplID0gZGF0YS5zaXplO1xyXG4gICAgICAgICAgICBibG9iVHlwZSA9IGRhdGEudHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XHJcbiAgICAgICAgICAgIGlmIChlbGlkZUNvcHkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YV8gPSBuZXcgVWludDhBcnJheShkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YV8gPSBuZXcgVWludDhBcnJheShkYXRhLmJ5dGVMZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhXy5zZXQobmV3IFVpbnQ4QXJyYXkoZGF0YSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNpemUgPSB0aGlzLmRhdGFfLmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcclxuICAgICAgICAgICAgaWYgKGVsaWRlQ29weSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhXyA9IGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGFfID0gbmV3IFVpbnQ4QXJyYXkoZGF0YS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhXy5zZXQoZGF0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2l6ZSA9IGRhdGEubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNpemVfID0gc2l6ZTtcclxuICAgICAgICB0aGlzLnR5cGVfID0gYmxvYlR5cGU7XHJcbiAgICB9XHJcbiAgICBzaXplKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNpemVfO1xyXG4gICAgfVxyXG4gICAgdHlwZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50eXBlXztcclxuICAgIH1cclxuICAgIHNsaWNlKHN0YXJ0Qnl0ZSwgZW5kQnl0ZSkge1xyXG4gICAgICAgIGlmIChpc05hdGl2ZUJsb2IodGhpcy5kYXRhXykpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVhbEJsb2IgPSB0aGlzLmRhdGFfO1xyXG4gICAgICAgICAgICBjb25zdCBzbGljZWQgPSBzbGljZUJsb2IocmVhbEJsb2IsIHN0YXJ0Qnl0ZSwgZW5kQnl0ZSk7XHJcbiAgICAgICAgICAgIGlmIChzbGljZWQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmJzQmxvYihzbGljZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3Qgc2xpY2UgPSBuZXcgVWludDhBcnJheSh0aGlzLmRhdGFfLmJ1ZmZlciwgc3RhcnRCeXRlLCBlbmRCeXRlIC0gc3RhcnRCeXRlKTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGYnNCbG9iKHNsaWNlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0QmxvYiguLi5hcmdzKSB7XHJcbiAgICAgICAgaWYgKGlzTmF0aXZlQmxvYkRlZmluZWQoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBibG9iYnkgPSBhcmdzLm1hcCgodmFsKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgRmJzQmxvYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwuZGF0YV87XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBGYnNCbG9iKGdldEJsb2IkMS5hcHBseShudWxsLCBibG9iYnkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVpbnQ4QXJyYXlzID0gYXJncy5tYXAoKHZhbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzU3RyaW5nKHZhbCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YUZyb21TdHJpbmcoU3RyaW5nRm9ybWF0LlJBVywgdmFsKS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQmxvYnMgZG9uJ3QgZXhpc3QsIHNvIHRoaXMgaGFzIHRvIGJlIGEgVWludDhBcnJheS5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsLmRhdGFfO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbGV0IGZpbmFsTGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgdWludDhBcnJheXMuZm9yRWFjaCgoYXJyYXkpID0+IHtcclxuICAgICAgICAgICAgICAgIGZpbmFsTGVuZ3RoICs9IGFycmF5LmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zdCBtZXJnZWQgPSBuZXcgVWludDhBcnJheShmaW5hbExlbmd0aCk7XHJcbiAgICAgICAgICAgIGxldCBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgIHVpbnQ4QXJyYXlzLmZvckVhY2goKGFycmF5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VkW2luZGV4KytdID0gYXJyYXlbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IEZic0Jsb2IobWVyZ2VkLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB1cGxvYWREYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFfO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSBPYmplY3QgcmVzdWx0aW5nIGZyb20gcGFyc2luZyB0aGUgZ2l2ZW4gSlNPTiwgb3IgbnVsbCBpZiB0aGVcclxuICogZ2l2ZW4gc3RyaW5nIGRvZXMgbm90IHJlcHJlc2VudCBhIEpTT04gb2JqZWN0LlxyXG4gKi9cclxuZnVuY3Rpb24ganNvbk9iamVjdE9yTnVsbChzKSB7XHJcbiAgICBsZXQgb2JqO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBvYmogPSBKU09OLnBhcnNlKHMpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChpc05vbkFycmF5T2JqZWN0KG9iaikpIHtcclxuICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIEBmaWxlb3ZlcnZpZXcgQ29udGFpbnMgaGVscGVyIG1ldGhvZHMgZm9yIG1hbmlwdWxhdGluZyBwYXRocy5cclxuICovXHJcbi8qKlxyXG4gKiBAcmV0dXJuIE51bGwgaWYgdGhlIHBhdGggaXMgYWxyZWFkeSBhdCB0aGUgcm9vdC5cclxuICovXHJcbmZ1bmN0aW9uIHBhcmVudChwYXRoKSB7XHJcbiAgICBpZiAocGF0aC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IGluZGV4ID0gcGF0aC5sYXN0SW5kZXhPZignLycpO1xyXG4gICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIGNvbnN0IG5ld1BhdGggPSBwYXRoLnNsaWNlKDAsIGluZGV4KTtcclxuICAgIHJldHVybiBuZXdQYXRoO1xyXG59XHJcbmZ1bmN0aW9uIGNoaWxkKHBhdGgsIGNoaWxkUGF0aCkge1xyXG4gICAgY29uc3QgY2Fub25pY2FsQ2hpbGRQYXRoID0gY2hpbGRQYXRoXHJcbiAgICAgICAgLnNwbGl0KCcvJylcclxuICAgICAgICAuZmlsdGVyKGNvbXBvbmVudCA9PiBjb21wb25lbnQubGVuZ3RoID4gMClcclxuICAgICAgICAuam9pbignLycpO1xyXG4gICAgaWYgKHBhdGgubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIGNhbm9uaWNhbENoaWxkUGF0aDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBwYXRoICsgJy8nICsgY2Fub25pY2FsQ2hpbGRQYXRoO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRoZSBsYXN0IGNvbXBvbmVudCBvZiBhIHBhdGguXHJcbiAqICcvZm9vL2JhcicgLT4gJ2JhcidcclxuICogJy9mb28vYmFyL2Jhei8nIC0+ICdiYXovJ1xyXG4gKiAnL2EnIC0+ICdhJ1xyXG4gKi9cclxuZnVuY3Rpb24gbGFzdENvbXBvbmVudChwYXRoKSB7XHJcbiAgICBjb25zdCBpbmRleCA9IHBhdGgubGFzdEluZGV4T2YoJy8nLCBwYXRoLmxlbmd0aCAtIDIpO1xyXG4gICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHBhdGguc2xpY2UoaW5kZXggKyAxKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBub1hmb3JtXyhtZXRhZGF0YSwgdmFsdWUpIHtcclxuICAgIHJldHVybiB2YWx1ZTtcclxufVxyXG5jbGFzcyBNYXBwaW5nIHtcclxuICAgIGNvbnN0cnVjdG9yKHNlcnZlciwgbG9jYWwsIHdyaXRhYmxlLCB4Zm9ybSkge1xyXG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xyXG4gICAgICAgIHRoaXMubG9jYWwgPSBsb2NhbCB8fCBzZXJ2ZXI7XHJcbiAgICAgICAgdGhpcy53cml0YWJsZSA9ICEhd3JpdGFibGU7XHJcbiAgICAgICAgdGhpcy54Zm9ybSA9IHhmb3JtIHx8IG5vWGZvcm1fO1xyXG4gICAgfVxyXG59XHJcbmxldCBtYXBwaW5nc18gPSBudWxsO1xyXG5mdW5jdGlvbiB4Zm9ybVBhdGgoZnVsbFBhdGgpIHtcclxuICAgIGlmICghaXNTdHJpbmcoZnVsbFBhdGgpIHx8IGZ1bGxQYXRoLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICByZXR1cm4gZnVsbFBhdGg7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gbGFzdENvbXBvbmVudChmdWxsUGF0aCk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0TWFwcGluZ3MoKSB7XHJcbiAgICBpZiAobWFwcGluZ3NfKSB7XHJcbiAgICAgICAgcmV0dXJuIG1hcHBpbmdzXztcclxuICAgIH1cclxuICAgIGNvbnN0IG1hcHBpbmdzID0gW107XHJcbiAgICBtYXBwaW5ncy5wdXNoKG5ldyBNYXBwaW5nKCdidWNrZXQnKSk7XHJcbiAgICBtYXBwaW5ncy5wdXNoKG5ldyBNYXBwaW5nKCdnZW5lcmF0aW9uJykpO1xyXG4gICAgbWFwcGluZ3MucHVzaChuZXcgTWFwcGluZygnbWV0YWdlbmVyYXRpb24nKSk7XHJcbiAgICBtYXBwaW5ncy5wdXNoKG5ldyBNYXBwaW5nKCduYW1lJywgJ2Z1bGxQYXRoJywgdHJ1ZSkpO1xyXG4gICAgZnVuY3Rpb24gbWFwcGluZ3NYZm9ybVBhdGgoX21ldGFkYXRhLCBmdWxsUGF0aCkge1xyXG4gICAgICAgIHJldHVybiB4Zm9ybVBhdGgoZnVsbFBhdGgpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbmFtZU1hcHBpbmcgPSBuZXcgTWFwcGluZygnbmFtZScpO1xyXG4gICAgbmFtZU1hcHBpbmcueGZvcm0gPSBtYXBwaW5nc1hmb3JtUGF0aDtcclxuICAgIG1hcHBpbmdzLnB1c2gobmFtZU1hcHBpbmcpO1xyXG4gICAgLyoqXHJcbiAgICAgKiBDb2VyY2VzIHRoZSBzZWNvbmQgcGFyYW0gdG8gYSBudW1iZXIsIGlmIGl0IGlzIGRlZmluZWQuXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHhmb3JtU2l6ZShfbWV0YWRhdGEsIHNpemUpIHtcclxuICAgICAgICBpZiAoc2l6ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBOdW1iZXIoc2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gc2l6ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBzaXplTWFwcGluZyA9IG5ldyBNYXBwaW5nKCdzaXplJyk7XHJcbiAgICBzaXplTWFwcGluZy54Zm9ybSA9IHhmb3JtU2l6ZTtcclxuICAgIG1hcHBpbmdzLnB1c2goc2l6ZU1hcHBpbmcpO1xyXG4gICAgbWFwcGluZ3MucHVzaChuZXcgTWFwcGluZygndGltZUNyZWF0ZWQnKSk7XHJcbiAgICBtYXBwaW5ncy5wdXNoKG5ldyBNYXBwaW5nKCd1cGRhdGVkJykpO1xyXG4gICAgbWFwcGluZ3MucHVzaChuZXcgTWFwcGluZygnbWQ1SGFzaCcsIG51bGwsIHRydWUpKTtcclxuICAgIG1hcHBpbmdzLnB1c2gobmV3IE1hcHBpbmcoJ2NhY2hlQ29udHJvbCcsIG51bGwsIHRydWUpKTtcclxuICAgIG1hcHBpbmdzLnB1c2gobmV3IE1hcHBpbmcoJ2NvbnRlbnREaXNwb3NpdGlvbicsIG51bGwsIHRydWUpKTtcclxuICAgIG1hcHBpbmdzLnB1c2gobmV3IE1hcHBpbmcoJ2NvbnRlbnRFbmNvZGluZycsIG51bGwsIHRydWUpKTtcclxuICAgIG1hcHBpbmdzLnB1c2gobmV3IE1hcHBpbmcoJ2NvbnRlbnRMYW5ndWFnZScsIG51bGwsIHRydWUpKTtcclxuICAgIG1hcHBpbmdzLnB1c2gobmV3IE1hcHBpbmcoJ2NvbnRlbnRUeXBlJywgbnVsbCwgdHJ1ZSkpO1xyXG4gICAgbWFwcGluZ3MucHVzaChuZXcgTWFwcGluZygnbWV0YWRhdGEnLCAnY3VzdG9tTWV0YWRhdGEnLCB0cnVlKSk7XHJcbiAgICBtYXBwaW5nc18gPSBtYXBwaW5ncztcclxuICAgIHJldHVybiBtYXBwaW5nc187XHJcbn1cclxuZnVuY3Rpb24gYWRkUmVmKG1ldGFkYXRhLCBzZXJ2aWNlKSB7XHJcbiAgICBmdW5jdGlvbiBnZW5lcmF0ZVJlZigpIHtcclxuICAgICAgICBjb25zdCBidWNrZXQgPSBtZXRhZGF0YVsnYnVja2V0J107XHJcbiAgICAgICAgY29uc3QgcGF0aCA9IG1ldGFkYXRhWydmdWxsUGF0aCddO1xyXG4gICAgICAgIGNvbnN0IGxvYyA9IG5ldyBMb2NhdGlvbihidWNrZXQsIHBhdGgpO1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlLl9tYWtlU3RvcmFnZVJlZmVyZW5jZShsb2MpO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1ldGFkYXRhLCAncmVmJywgeyBnZXQ6IGdlbmVyYXRlUmVmIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGZyb21SZXNvdXJjZShzZXJ2aWNlLCByZXNvdXJjZSwgbWFwcGluZ3MpIHtcclxuICAgIGNvbnN0IG1ldGFkYXRhID0ge307XHJcbiAgICBtZXRhZGF0YVsndHlwZSddID0gJ2ZpbGUnO1xyXG4gICAgY29uc3QgbGVuID0gbWFwcGluZ3MubGVuZ3RoO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgIGNvbnN0IG1hcHBpbmcgPSBtYXBwaW5nc1tpXTtcclxuICAgICAgICBtZXRhZGF0YVttYXBwaW5nLmxvY2FsXSA9IG1hcHBpbmcueGZvcm0obWV0YWRhdGEsIHJlc291cmNlW21hcHBpbmcuc2VydmVyXSk7XHJcbiAgICB9XHJcbiAgICBhZGRSZWYobWV0YWRhdGEsIHNlcnZpY2UpO1xyXG4gICAgcmV0dXJuIG1ldGFkYXRhO1xyXG59XHJcbmZ1bmN0aW9uIGZyb21SZXNvdXJjZVN0cmluZyhzZXJ2aWNlLCByZXNvdXJjZVN0cmluZywgbWFwcGluZ3MpIHtcclxuICAgIGNvbnN0IG9iaiA9IGpzb25PYmplY3RPck51bGwocmVzb3VyY2VTdHJpbmcpO1xyXG4gICAgaWYgKG9iaiA9PT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVzb3VyY2UgPSBvYmo7XHJcbiAgICByZXR1cm4gZnJvbVJlc291cmNlKHNlcnZpY2UsIHJlc291cmNlLCBtYXBwaW5ncyk7XHJcbn1cclxuZnVuY3Rpb24gZG93bmxvYWRVcmxGcm9tUmVzb3VyY2VTdHJpbmcobWV0YWRhdGEsIHJlc291cmNlU3RyaW5nLCBob3N0LCBwcm90b2NvbCkge1xyXG4gICAgY29uc3Qgb2JqID0ganNvbk9iamVjdE9yTnVsbChyZXNvdXJjZVN0cmluZyk7XHJcbiAgICBpZiAob2JqID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAoIWlzU3RyaW5nKG9ialsnZG93bmxvYWRUb2tlbnMnXSkpIHtcclxuICAgICAgICAvLyBUaGlzIGNhbiBoYXBwZW4gaWYgb2JqZWN0cyBhcmUgdXBsb2FkZWQgdGhyb3VnaCBHQ1MgYW5kIHJldHJpZXZlZFxyXG4gICAgICAgIC8vIHRocm91Z2ggbGlzdCwgc28gd2UgZG9uJ3Qgd2FudCB0byB0aHJvdyBhbiBFcnJvci5cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHRva2VucyA9IG9ialsnZG93bmxvYWRUb2tlbnMnXTtcclxuICAgIGlmICh0b2tlbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlbmNvZGUgPSBlbmNvZGVVUklDb21wb25lbnQ7XHJcbiAgICBjb25zdCB0b2tlbnNMaXN0ID0gdG9rZW5zLnNwbGl0KCcsJyk7XHJcbiAgICBjb25zdCB1cmxzID0gdG9rZW5zTGlzdC5tYXAoKHRva2VuKSA9PiB7XHJcbiAgICAgICAgY29uc3QgYnVja2V0ID0gbWV0YWRhdGFbJ2J1Y2tldCddO1xyXG4gICAgICAgIGNvbnN0IHBhdGggPSBtZXRhZGF0YVsnZnVsbFBhdGgnXTtcclxuICAgICAgICBjb25zdCB1cmxQYXJ0ID0gJy9iLycgKyBlbmNvZGUoYnVja2V0KSArICcvby8nICsgZW5jb2RlKHBhdGgpO1xyXG4gICAgICAgIGNvbnN0IGJhc2UgPSBtYWtlVXJsKHVybFBhcnQsIGhvc3QsIHByb3RvY29sKTtcclxuICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IG1ha2VRdWVyeVN0cmluZyh7XHJcbiAgICAgICAgICAgIGFsdDogJ21lZGlhJyxcclxuICAgICAgICAgICAgdG9rZW5cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gYmFzZSArIHF1ZXJ5U3RyaW5nO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdXJsc1swXTtcclxufVxyXG5mdW5jdGlvbiB0b1Jlc291cmNlU3RyaW5nKG1ldGFkYXRhLCBtYXBwaW5ncykge1xyXG4gICAgY29uc3QgcmVzb3VyY2UgPSB7fTtcclxuICAgIGNvbnN0IGxlbiA9IG1hcHBpbmdzLmxlbmd0aDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICBjb25zdCBtYXBwaW5nID0gbWFwcGluZ3NbaV07XHJcbiAgICAgICAgaWYgKG1hcHBpbmcud3JpdGFibGUpIHtcclxuICAgICAgICAgICAgcmVzb3VyY2VbbWFwcGluZy5zZXJ2ZXJdID0gbWV0YWRhdGFbbWFwcGluZy5sb2NhbF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHJlc291cmNlKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBQUkVGSVhFU19LRVkgPSAncHJlZml4ZXMnO1xyXG5jb25zdCBJVEVNU19LRVkgPSAnaXRlbXMnO1xyXG5mdW5jdGlvbiBmcm9tQmFja2VuZFJlc3BvbnNlKHNlcnZpY2UsIGJ1Y2tldCwgcmVzb3VyY2UpIHtcclxuICAgIGNvbnN0IGxpc3RSZXN1bHQgPSB7XHJcbiAgICAgICAgcHJlZml4ZXM6IFtdLFxyXG4gICAgICAgIGl0ZW1zOiBbXSxcclxuICAgICAgICBuZXh0UGFnZVRva2VuOiByZXNvdXJjZVsnbmV4dFBhZ2VUb2tlbiddXHJcbiAgICB9O1xyXG4gICAgaWYgKHJlc291cmNlW1BSRUZJWEVTX0tFWV0pIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHBhdGggb2YgcmVzb3VyY2VbUFJFRklYRVNfS0VZXSkge1xyXG4gICAgICAgICAgICBjb25zdCBwYXRoV2l0aG91dFRyYWlsaW5nU2xhc2ggPSBwYXRoLnJlcGxhY2UoL1xcLyQvLCAnJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZmVyZW5jZSA9IHNlcnZpY2UuX21ha2VTdG9yYWdlUmVmZXJlbmNlKG5ldyBMb2NhdGlvbihidWNrZXQsIHBhdGhXaXRob3V0VHJhaWxpbmdTbGFzaCkpO1xyXG4gICAgICAgICAgICBsaXN0UmVzdWx0LnByZWZpeGVzLnB1c2gocmVmZXJlbmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAocmVzb3VyY2VbSVRFTVNfS0VZXSkge1xyXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiByZXNvdXJjZVtJVEVNU19LRVldKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlZmVyZW5jZSA9IHNlcnZpY2UuX21ha2VTdG9yYWdlUmVmZXJlbmNlKG5ldyBMb2NhdGlvbihidWNrZXQsIGl0ZW1bJ25hbWUnXSkpO1xyXG4gICAgICAgICAgICBsaXN0UmVzdWx0Lml0ZW1zLnB1c2gocmVmZXJlbmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbGlzdFJlc3VsdDtcclxufVxyXG5mdW5jdGlvbiBmcm9tUmVzcG9uc2VTdHJpbmcoc2VydmljZSwgYnVja2V0LCByZXNvdXJjZVN0cmluZykge1xyXG4gICAgY29uc3Qgb2JqID0ganNvbk9iamVjdE9yTnVsbChyZXNvdXJjZVN0cmluZyk7XHJcbiAgICBpZiAob2JqID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXNvdXJjZSA9IG9iajtcclxuICAgIHJldHVybiBmcm9tQmFja2VuZFJlc3BvbnNlKHNlcnZpY2UsIGJ1Y2tldCwgcmVzb3VyY2UpO1xyXG59XG5cbi8qKlxyXG4gKiBDb250YWlucyBhIGZ1bGx5IHNwZWNpZmllZCByZXF1ZXN0LlxyXG4gKlxyXG4gKiBAcGFyYW0gSSAtIHRoZSB0eXBlIG9mIHRoZSBiYWNrZW5kJ3MgbmV0d29yayByZXNwb25zZS5cclxuICogQHBhcmFtIE8gLSB0aGUgb3V0cHV0IHJlc3BvbnNlIHR5cGUgdXNlZCBieSB0aGUgcmVzdCBvZiB0aGUgU0RLLlxyXG4gKi9cclxuY2xhc3MgUmVxdWVzdEluZm8ge1xyXG4gICAgY29uc3RydWN0b3IodXJsLCBtZXRob2QsIFxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSB3aXRoIHdoaWNoIHRvIHJlc29sdmUgdGhlIHJlcXVlc3QncyBwcm9taXNlLiBPbmx5IGNhbGxlZFxyXG4gICAgICogaWYgdGhlIHJlcXVlc3QgaXMgc3VjY2Vzc2Z1bC4gVGhyb3cgZnJvbSB0aGlzIGZ1bmN0aW9uIHRvIHJlamVjdCB0aGVcclxuICAgICAqIHJldHVybmVkIFJlcXVlc3QncyBwcm9taXNlIHdpdGggdGhlIHRocm93biBlcnJvci5cclxuICAgICAqIE5vdGU6IFRoZSBYaHJJbyBwYXNzZWQgdG8gdGhpcyBmdW5jdGlvbiBtYXkgYmUgcmV1c2VkIGFmdGVyIHRoaXMgY2FsbGJhY2tcclxuICAgICAqIHJldHVybnMuIERvIG5vdCBrZWVwIGEgcmVmZXJlbmNlIHRvIGl0IGluIGFueSB3YXkuXHJcbiAgICAgKi9cclxuICAgIGhhbmRsZXIsIHRpbWVvdXQpIHtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLm1ldGhvZCA9IG1ldGhvZDtcclxuICAgICAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xyXG4gICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XHJcbiAgICAgICAgdGhpcy51cmxQYXJhbXMgPSB7fTtcclxuICAgICAgICB0aGlzLmhlYWRlcnMgPSB7fTtcclxuICAgICAgICB0aGlzLmJvZHkgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDYWxsZWQgd2l0aCB0aGUgY3VycmVudCBudW1iZXIgb2YgYnl0ZXMgdXBsb2FkZWQgYW5kIHRvdGFsIHNpemUgKC0xIGlmIG5vdFxyXG4gICAgICAgICAqIGNvbXB1dGFibGUpIG9mIHRoZSByZXF1ZXN0IGJvZHkgKGkuZS4gdXNlZCB0byByZXBvcnQgdXBsb2FkIHByb2dyZXNzKS5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnByb2dyZXNzQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc3VjY2Vzc0NvZGVzID0gWzIwMF07XHJcbiAgICAgICAgdGhpcy5hZGRpdGlvbmFsUmV0cnlDb2RlcyA9IFtdO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUaHJvd3MgdGhlIFVOS05PV04gU3RvcmFnZUVycm9yIGlmIGNuZG4gaXMgZmFsc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBoYW5kbGVyQ2hlY2soY25kbikge1xyXG4gICAgaWYgKCFjbmRuKSB7XHJcbiAgICAgICAgdGhyb3cgdW5rbm93bigpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIG1ldGFkYXRhSGFuZGxlcihzZXJ2aWNlLCBtYXBwaW5ncykge1xyXG4gICAgZnVuY3Rpb24gaGFuZGxlcih4aHIsIHRleHQpIHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IGZyb21SZXNvdXJjZVN0cmluZyhzZXJ2aWNlLCB0ZXh0LCBtYXBwaW5ncyk7XHJcbiAgICAgICAgaGFuZGxlckNoZWNrKG1ldGFkYXRhICE9PSBudWxsKTtcclxuICAgICAgICByZXR1cm4gbWV0YWRhdGE7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaGFuZGxlcjtcclxufVxyXG5mdW5jdGlvbiBsaXN0SGFuZGxlcihzZXJ2aWNlLCBidWNrZXQpIHtcclxuICAgIGZ1bmN0aW9uIGhhbmRsZXIoeGhyLCB0ZXh0KSB7XHJcbiAgICAgICAgY29uc3QgbGlzdFJlc3VsdCA9IGZyb21SZXNwb25zZVN0cmluZyhzZXJ2aWNlLCBidWNrZXQsIHRleHQpO1xyXG4gICAgICAgIGhhbmRsZXJDaGVjayhsaXN0UmVzdWx0ICE9PSBudWxsKTtcclxuICAgICAgICByZXR1cm4gbGlzdFJlc3VsdDtcclxuICAgIH1cclxuICAgIHJldHVybiBoYW5kbGVyO1xyXG59XHJcbmZ1bmN0aW9uIGRvd25sb2FkVXJsSGFuZGxlcihzZXJ2aWNlLCBtYXBwaW5ncykge1xyXG4gICAgZnVuY3Rpb24gaGFuZGxlcih4aHIsIHRleHQpIHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IGZyb21SZXNvdXJjZVN0cmluZyhzZXJ2aWNlLCB0ZXh0LCBtYXBwaW5ncyk7XHJcbiAgICAgICAgaGFuZGxlckNoZWNrKG1ldGFkYXRhICE9PSBudWxsKTtcclxuICAgICAgICByZXR1cm4gZG93bmxvYWRVcmxGcm9tUmVzb3VyY2VTdHJpbmcobWV0YWRhdGEsIHRleHQsIHNlcnZpY2UuaG9zdCwgc2VydmljZS5fcHJvdG9jb2wpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGhhbmRsZXI7XHJcbn1cclxuZnVuY3Rpb24gc2hhcmVkRXJyb3JIYW5kbGVyKGxvY2F0aW9uKSB7XHJcbiAgICBmdW5jdGlvbiBlcnJvckhhbmRsZXIoeGhyLCBlcnIpIHtcclxuICAgICAgICBsZXQgbmV3RXJyO1xyXG4gICAgICAgIGlmICh4aHIuZ2V0U3RhdHVzKCkgPT09IDQwMSkge1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIC8vIFRoaXMgZXhhY3QgbWVzc2FnZSBzdHJpbmcgaXMgdGhlIG9ubHkgY29uc2lzdGVudCBwYXJ0IG9mIHRoZVxyXG4gICAgICAgICAgICAvLyBzZXJ2ZXIncyBlcnJvciByZXNwb25zZSB0aGF0IGlkZW50aWZpZXMgaXQgYXMgYW4gQXBwIENoZWNrIGVycm9yLlxyXG4gICAgICAgICAgICB4aHIuZ2V0RXJyb3JUZXh0KCkuaW5jbHVkZXMoJ0ZpcmViYXNlIEFwcCBDaGVjayB0b2tlbiBpcyBpbnZhbGlkJykpIHtcclxuICAgICAgICAgICAgICAgIG5ld0VyciA9IHVuYXV0aG9yaXplZEFwcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbmV3RXJyID0gdW5hdXRoZW50aWNhdGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh4aHIuZ2V0U3RhdHVzKCkgPT09IDQwMikge1xyXG4gICAgICAgICAgICAgICAgbmV3RXJyID0gcXVvdGFFeGNlZWRlZChsb2NhdGlvbi5idWNrZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHhoci5nZXRTdGF0dXMoKSA9PT0gNDAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RXJyID0gdW5hdXRob3JpemVkKGxvY2F0aW9uLnBhdGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3RXJyID0gZXJyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld0Vyci5zdGF0dXMgPSB4aHIuZ2V0U3RhdHVzKCk7XHJcbiAgICAgICAgbmV3RXJyLnNlcnZlclJlc3BvbnNlID0gZXJyLnNlcnZlclJlc3BvbnNlO1xyXG4gICAgICAgIHJldHVybiBuZXdFcnI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZXJyb3JIYW5kbGVyO1xyXG59XHJcbmZ1bmN0aW9uIG9iamVjdEVycm9ySGFuZGxlcihsb2NhdGlvbikge1xyXG4gICAgY29uc3Qgc2hhcmVkID0gc2hhcmVkRXJyb3JIYW5kbGVyKGxvY2F0aW9uKTtcclxuICAgIGZ1bmN0aW9uIGVycm9ySGFuZGxlcih4aHIsIGVycikge1xyXG4gICAgICAgIGxldCBuZXdFcnIgPSBzaGFyZWQoeGhyLCBlcnIpO1xyXG4gICAgICAgIGlmICh4aHIuZ2V0U3RhdHVzKCkgPT09IDQwNCkge1xyXG4gICAgICAgICAgICBuZXdFcnIgPSBvYmplY3ROb3RGb3VuZChsb2NhdGlvbi5wYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbmV3RXJyLnNlcnZlclJlc3BvbnNlID0gZXJyLnNlcnZlclJlc3BvbnNlO1xyXG4gICAgICAgIHJldHVybiBuZXdFcnI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZXJyb3JIYW5kbGVyO1xyXG59XHJcbmZ1bmN0aW9uIGdldE1ldGFkYXRhJDIoc2VydmljZSwgbG9jYXRpb24sIG1hcHBpbmdzKSB7XHJcbiAgICBjb25zdCB1cmxQYXJ0ID0gbG9jYXRpb24uZnVsbFNlcnZlclVybCgpO1xyXG4gICAgY29uc3QgdXJsID0gbWFrZVVybCh1cmxQYXJ0LCBzZXJ2aWNlLmhvc3QsIHNlcnZpY2UuX3Byb3RvY29sKTtcclxuICAgIGNvbnN0IG1ldGhvZCA9ICdHRVQnO1xyXG4gICAgY29uc3QgdGltZW91dCA9IHNlcnZpY2UubWF4T3BlcmF0aW9uUmV0cnlUaW1lO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIG1ldGFkYXRhSGFuZGxlcihzZXJ2aWNlLCBtYXBwaW5ncyksIHRpbWVvdXQpO1xyXG4gICAgcmVxdWVzdEluZm8uZXJyb3JIYW5kbGVyID0gb2JqZWN0RXJyb3JIYW5kbGVyKGxvY2F0aW9uKTtcclxuICAgIHJldHVybiByZXF1ZXN0SW5mbztcclxufVxyXG5mdW5jdGlvbiBsaXN0JDIoc2VydmljZSwgbG9jYXRpb24sIGRlbGltaXRlciwgcGFnZVRva2VuLCBtYXhSZXN1bHRzKSB7XHJcbiAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTtcclxuICAgIGlmIChsb2NhdGlvbi5pc1Jvb3QpIHtcclxuICAgICAgICB1cmxQYXJhbXNbJ3ByZWZpeCddID0gJyc7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB1cmxQYXJhbXNbJ3ByZWZpeCddID0gbG9jYXRpb24ucGF0aCArICcvJztcclxuICAgIH1cclxuICAgIGlmIChkZWxpbWl0ZXIgJiYgZGVsaW1pdGVyLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB1cmxQYXJhbXNbJ2RlbGltaXRlciddID0gZGVsaW1pdGVyO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhZ2VUb2tlbikge1xyXG4gICAgICAgIHVybFBhcmFtc1sncGFnZVRva2VuJ10gPSBwYWdlVG9rZW47XHJcbiAgICB9XHJcbiAgICBpZiAobWF4UmVzdWx0cykge1xyXG4gICAgICAgIHVybFBhcmFtc1snbWF4UmVzdWx0cyddID0gbWF4UmVzdWx0cztcclxuICAgIH1cclxuICAgIGNvbnN0IHVybFBhcnQgPSBsb2NhdGlvbi5idWNrZXRPbmx5U2VydmVyVXJsKCk7XHJcbiAgICBjb25zdCB1cmwgPSBtYWtlVXJsKHVybFBhcnQsIHNlcnZpY2UuaG9zdCwgc2VydmljZS5fcHJvdG9jb2wpO1xyXG4gICAgY29uc3QgbWV0aG9kID0gJ0dFVCc7XHJcbiAgICBjb25zdCB0aW1lb3V0ID0gc2VydmljZS5tYXhPcGVyYXRpb25SZXRyeVRpbWU7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IG5ldyBSZXF1ZXN0SW5mbyh1cmwsIG1ldGhvZCwgbGlzdEhhbmRsZXIoc2VydmljZSwgbG9jYXRpb24uYnVja2V0KSwgdGltZW91dCk7XHJcbiAgICByZXF1ZXN0SW5mby51cmxQYXJhbXMgPSB1cmxQYXJhbXM7XHJcbiAgICByZXF1ZXN0SW5mby5lcnJvckhhbmRsZXIgPSBzaGFyZWRFcnJvckhhbmRsZXIobG9jYXRpb24pO1xyXG4gICAgcmV0dXJuIHJlcXVlc3RJbmZvO1xyXG59XHJcbmZ1bmN0aW9uIGdldEJ5dGVzJDEoc2VydmljZSwgbG9jYXRpb24sIG1heERvd25sb2FkU2l6ZUJ5dGVzKSB7XHJcbiAgICBjb25zdCB1cmxQYXJ0ID0gbG9jYXRpb24uZnVsbFNlcnZlclVybCgpO1xyXG4gICAgY29uc3QgdXJsID0gbWFrZVVybCh1cmxQYXJ0LCBzZXJ2aWNlLmhvc3QsIHNlcnZpY2UuX3Byb3RvY29sKSArICc/YWx0PW1lZGlhJztcclxuICAgIGNvbnN0IG1ldGhvZCA9ICdHRVQnO1xyXG4gICAgY29uc3QgdGltZW91dCA9IHNlcnZpY2UubWF4T3BlcmF0aW9uUmV0cnlUaW1lO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIChfLCBkYXRhKSA9PiBkYXRhLCB0aW1lb3V0KTtcclxuICAgIHJlcXVlc3RJbmZvLmVycm9ySGFuZGxlciA9IG9iamVjdEVycm9ySGFuZGxlcihsb2NhdGlvbik7XHJcbiAgICBpZiAobWF4RG93bmxvYWRTaXplQnl0ZXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJlcXVlc3RJbmZvLmhlYWRlcnNbJ1JhbmdlJ10gPSBgYnl0ZXM9MC0ke21heERvd25sb2FkU2l6ZUJ5dGVzfWA7XHJcbiAgICAgICAgcmVxdWVzdEluZm8uc3VjY2Vzc0NvZGVzID0gWzIwMCAvKiBPSyAqLywgMjA2IC8qIFBhcnRpYWwgQ29udGVudCAqL107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVxdWVzdEluZm87XHJcbn1cclxuZnVuY3Rpb24gZ2V0RG93bmxvYWRVcmwoc2VydmljZSwgbG9jYXRpb24sIG1hcHBpbmdzKSB7XHJcbiAgICBjb25zdCB1cmxQYXJ0ID0gbG9jYXRpb24uZnVsbFNlcnZlclVybCgpO1xyXG4gICAgY29uc3QgdXJsID0gbWFrZVVybCh1cmxQYXJ0LCBzZXJ2aWNlLmhvc3QsIHNlcnZpY2UuX3Byb3RvY29sKTtcclxuICAgIGNvbnN0IG1ldGhvZCA9ICdHRVQnO1xyXG4gICAgY29uc3QgdGltZW91dCA9IHNlcnZpY2UubWF4T3BlcmF0aW9uUmV0cnlUaW1lO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIGRvd25sb2FkVXJsSGFuZGxlcihzZXJ2aWNlLCBtYXBwaW5ncyksIHRpbWVvdXQpO1xyXG4gICAgcmVxdWVzdEluZm8uZXJyb3JIYW5kbGVyID0gb2JqZWN0RXJyb3JIYW5kbGVyKGxvY2F0aW9uKTtcclxuICAgIHJldHVybiByZXF1ZXN0SW5mbztcclxufVxyXG5mdW5jdGlvbiB1cGRhdGVNZXRhZGF0YSQyKHNlcnZpY2UsIGxvY2F0aW9uLCBtZXRhZGF0YSwgbWFwcGluZ3MpIHtcclxuICAgIGNvbnN0IHVybFBhcnQgPSBsb2NhdGlvbi5mdWxsU2VydmVyVXJsKCk7XHJcbiAgICBjb25zdCB1cmwgPSBtYWtlVXJsKHVybFBhcnQsIHNlcnZpY2UuaG9zdCwgc2VydmljZS5fcHJvdG9jb2wpO1xyXG4gICAgY29uc3QgbWV0aG9kID0gJ1BBVENIJztcclxuICAgIGNvbnN0IGJvZHkgPSB0b1Jlc291cmNlU3RyaW5nKG1ldGFkYXRhLCBtYXBwaW5ncyk7XHJcbiAgICBjb25zdCBoZWFkZXJzID0geyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnIH07XHJcbiAgICBjb25zdCB0aW1lb3V0ID0gc2VydmljZS5tYXhPcGVyYXRpb25SZXRyeVRpbWU7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IG5ldyBSZXF1ZXN0SW5mbyh1cmwsIG1ldGhvZCwgbWV0YWRhdGFIYW5kbGVyKHNlcnZpY2UsIG1hcHBpbmdzKSwgdGltZW91dCk7XHJcbiAgICByZXF1ZXN0SW5mby5oZWFkZXJzID0gaGVhZGVycztcclxuICAgIHJlcXVlc3RJbmZvLmJvZHkgPSBib2R5O1xyXG4gICAgcmVxdWVzdEluZm8uZXJyb3JIYW5kbGVyID0gb2JqZWN0RXJyb3JIYW5kbGVyKGxvY2F0aW9uKTtcclxuICAgIHJldHVybiByZXF1ZXN0SW5mbztcclxufVxyXG5mdW5jdGlvbiBkZWxldGVPYmplY3QkMihzZXJ2aWNlLCBsb2NhdGlvbikge1xyXG4gICAgY29uc3QgdXJsUGFydCA9IGxvY2F0aW9uLmZ1bGxTZXJ2ZXJVcmwoKTtcclxuICAgIGNvbnN0IHVybCA9IG1ha2VVcmwodXJsUGFydCwgc2VydmljZS5ob3N0LCBzZXJ2aWNlLl9wcm90b2NvbCk7XHJcbiAgICBjb25zdCBtZXRob2QgPSAnREVMRVRFJztcclxuICAgIGNvbnN0IHRpbWVvdXQgPSBzZXJ2aWNlLm1heE9wZXJhdGlvblJldHJ5VGltZTtcclxuICAgIGZ1bmN0aW9uIGhhbmRsZXIoX3hociwgX3RleHQpIHsgfVxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIGhhbmRsZXIsIHRpbWVvdXQpO1xyXG4gICAgcmVxdWVzdEluZm8uc3VjY2Vzc0NvZGVzID0gWzIwMCwgMjA0XTtcclxuICAgIHJlcXVlc3RJbmZvLmVycm9ySGFuZGxlciA9IG9iamVjdEVycm9ySGFuZGxlcihsb2NhdGlvbik7XHJcbiAgICByZXR1cm4gcmVxdWVzdEluZm87XHJcbn1cclxuZnVuY3Rpb24gZGV0ZXJtaW5lQ29udGVudFR5cGVfKG1ldGFkYXRhLCBibG9iKSB7XHJcbiAgICByZXR1cm4gKChtZXRhZGF0YSAmJiBtZXRhZGF0YVsnY29udGVudFR5cGUnXSkgfHxcclxuICAgICAgICAoYmxvYiAmJiBibG9iLnR5cGUoKSkgfHxcclxuICAgICAgICAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7XHJcbn1cclxuZnVuY3Rpb24gbWV0YWRhdGFGb3JVcGxvYWRfKGxvY2F0aW9uLCBibG9iLCBtZXRhZGF0YSkge1xyXG4gICAgY29uc3QgbWV0YWRhdGFDbG9uZSA9IE9iamVjdC5hc3NpZ24oe30sIG1ldGFkYXRhKTtcclxuICAgIG1ldGFkYXRhQ2xvbmVbJ2Z1bGxQYXRoJ10gPSBsb2NhdGlvbi5wYXRoO1xyXG4gICAgbWV0YWRhdGFDbG9uZVsnc2l6ZSddID0gYmxvYi5zaXplKCk7XHJcbiAgICBpZiAoIW1ldGFkYXRhQ2xvbmVbJ2NvbnRlbnRUeXBlJ10pIHtcclxuICAgICAgICBtZXRhZGF0YUNsb25lWydjb250ZW50VHlwZSddID0gZGV0ZXJtaW5lQ29udGVudFR5cGVfKG51bGwsIGJsb2IpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1ldGFkYXRhQ2xvbmU7XHJcbn1cclxuLyoqXHJcbiAqIFByZXBhcmUgUmVxdWVzdEluZm8gZm9yIHVwbG9hZHMgYXMgQ29udGVudC1UeXBlOiBtdWx0aXBhcnQuXHJcbiAqL1xyXG5mdW5jdGlvbiBtdWx0aXBhcnRVcGxvYWQoc2VydmljZSwgbG9jYXRpb24sIG1hcHBpbmdzLCBibG9iLCBtZXRhZGF0YSkge1xyXG4gICAgY29uc3QgdXJsUGFydCA9IGxvY2F0aW9uLmJ1Y2tldE9ubHlTZXJ2ZXJVcmwoKTtcclxuICAgIGNvbnN0IGhlYWRlcnMgPSB7XHJcbiAgICAgICAgJ1gtR29vZy1VcGxvYWQtUHJvdG9jb2wnOiAnbXVsdGlwYXJ0J1xyXG4gICAgfTtcclxuICAgIGZ1bmN0aW9uIGdlbkJvdW5kYXJ5KCkge1xyXG4gICAgICAgIGxldCBzdHIgPSAnJztcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykge1xyXG4gICAgICAgICAgICBzdHIgPSBzdHIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkuc2xpY2UoMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9XHJcbiAgICBjb25zdCBib3VuZGFyeSA9IGdlbkJvdW5kYXJ5KCk7XHJcbiAgICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdtdWx0aXBhcnQvcmVsYXRlZDsgYm91bmRhcnk9JyArIGJvdW5kYXJ5O1xyXG4gICAgY29uc3QgbWV0YWRhdGFfID0gbWV0YWRhdGFGb3JVcGxvYWRfKGxvY2F0aW9uLCBibG9iLCBtZXRhZGF0YSk7XHJcbiAgICBjb25zdCBtZXRhZGF0YVN0cmluZyA9IHRvUmVzb3VyY2VTdHJpbmcobWV0YWRhdGFfLCBtYXBwaW5ncyk7XHJcbiAgICBjb25zdCBwcmVCbG9iUGFydCA9ICctLScgK1xyXG4gICAgICAgIGJvdW5kYXJ5ICtcclxuICAgICAgICAnXFxyXFxuJyArXHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFxcclxcblxcclxcbicgK1xyXG4gICAgICAgIG1ldGFkYXRhU3RyaW5nICtcclxuICAgICAgICAnXFxyXFxuLS0nICtcclxuICAgICAgICBib3VuZGFyeSArXHJcbiAgICAgICAgJ1xcclxcbicgK1xyXG4gICAgICAgICdDb250ZW50LVR5cGU6ICcgK1xyXG4gICAgICAgIG1ldGFkYXRhX1snY29udGVudFR5cGUnXSArXHJcbiAgICAgICAgJ1xcclxcblxcclxcbic7XHJcbiAgICBjb25zdCBwb3N0QmxvYlBhcnQgPSAnXFxyXFxuLS0nICsgYm91bmRhcnkgKyAnLS0nO1xyXG4gICAgY29uc3QgYm9keSA9IEZic0Jsb2IuZ2V0QmxvYihwcmVCbG9iUGFydCwgYmxvYiwgcG9zdEJsb2JQYXJ0KTtcclxuICAgIGlmIChib2R5ID09PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgY2Fubm90U2xpY2VCbG9iKCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCB1cmxQYXJhbXMgPSB7IG5hbWU6IG1ldGFkYXRhX1snZnVsbFBhdGgnXSB9O1xyXG4gICAgY29uc3QgdXJsID0gbWFrZVVybCh1cmxQYXJ0LCBzZXJ2aWNlLmhvc3QsIHNlcnZpY2UuX3Byb3RvY29sKTtcclxuICAgIGNvbnN0IG1ldGhvZCA9ICdQT1NUJztcclxuICAgIGNvbnN0IHRpbWVvdXQgPSBzZXJ2aWNlLm1heFVwbG9hZFJldHJ5VGltZTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gbmV3IFJlcXVlc3RJbmZvKHVybCwgbWV0aG9kLCBtZXRhZGF0YUhhbmRsZXIoc2VydmljZSwgbWFwcGluZ3MpLCB0aW1lb3V0KTtcclxuICAgIHJlcXVlc3RJbmZvLnVybFBhcmFtcyA9IHVybFBhcmFtcztcclxuICAgIHJlcXVlc3RJbmZvLmhlYWRlcnMgPSBoZWFkZXJzO1xyXG4gICAgcmVxdWVzdEluZm8uYm9keSA9IGJvZHkudXBsb2FkRGF0YSgpO1xyXG4gICAgcmVxdWVzdEluZm8uZXJyb3JIYW5kbGVyID0gc2hhcmVkRXJyb3JIYW5kbGVyKGxvY2F0aW9uKTtcclxuICAgIHJldHVybiByZXF1ZXN0SW5mbztcclxufVxyXG4vKipcclxuICogQHBhcmFtIGN1cnJlbnQgVGhlIG51bWJlciBvZiBieXRlcyB0aGF0IGhhdmUgYmVlbiB1cGxvYWRlZCBzbyBmYXIuXHJcbiAqIEBwYXJhbSB0b3RhbCBUaGUgdG90YWwgbnVtYmVyIG9mIGJ5dGVzIGluIHRoZSB1cGxvYWQuXHJcbiAqIEBwYXJhbSBvcHRfZmluYWxpemVkIFRydWUgaWYgdGhlIHNlcnZlciBoYXMgZmluaXNoZWQgdGhlIHVwbG9hZC5cclxuICogQHBhcmFtIG9wdF9tZXRhZGF0YSBUaGUgdXBsb2FkIG1ldGFkYXRhLCBzaG91bGRcclxuICogICAgIG9ubHkgYmUgcGFzc2VkIGlmIG9wdF9maW5hbGl6ZWQgaXMgdHJ1ZS5cclxuICovXHJcbmNsYXNzIFJlc3VtYWJsZVVwbG9hZFN0YXR1cyB7XHJcbiAgICBjb25zdHJ1Y3RvcihjdXJyZW50LCB0b3RhbCwgZmluYWxpemVkLCBtZXRhZGF0YSkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudCA9IGN1cnJlbnQ7XHJcbiAgICAgICAgdGhpcy50b3RhbCA9IHRvdGFsO1xyXG4gICAgICAgIHRoaXMuZmluYWxpemVkID0gISFmaW5hbGl6ZWQ7XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG1ldGFkYXRhIHx8IG51bGw7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gY2hlY2tSZXN1bWVIZWFkZXJfKHhociwgYWxsb3dlZCkge1xyXG4gICAgbGV0IHN0YXR1cyA9IG51bGw7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHN0YXR1cyA9IHhoci5nZXRSZXNwb25zZUhlYWRlcignWC1Hb29nLVVwbG9hZC1TdGF0dXMnKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgaGFuZGxlckNoZWNrKGZhbHNlKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGFsbG93ZWRTdGF0dXMgPSBhbGxvd2VkIHx8IFsnYWN0aXZlJ107XHJcbiAgICBoYW5kbGVyQ2hlY2soISFzdGF0dXMgJiYgYWxsb3dlZFN0YXR1cy5pbmRleE9mKHN0YXR1cykgIT09IC0xKTtcclxuICAgIHJldHVybiBzdGF0dXM7XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlUmVzdW1hYmxlVXBsb2FkKHNlcnZpY2UsIGxvY2F0aW9uLCBtYXBwaW5ncywgYmxvYiwgbWV0YWRhdGEpIHtcclxuICAgIGNvbnN0IHVybFBhcnQgPSBsb2NhdGlvbi5idWNrZXRPbmx5U2VydmVyVXJsKCk7XHJcbiAgICBjb25zdCBtZXRhZGF0YUZvclVwbG9hZCA9IG1ldGFkYXRhRm9yVXBsb2FkXyhsb2NhdGlvbiwgYmxvYiwgbWV0YWRhdGEpO1xyXG4gICAgY29uc3QgdXJsUGFyYW1zID0geyBuYW1lOiBtZXRhZGF0YUZvclVwbG9hZFsnZnVsbFBhdGgnXSB9O1xyXG4gICAgY29uc3QgdXJsID0gbWFrZVVybCh1cmxQYXJ0LCBzZXJ2aWNlLmhvc3QsIHNlcnZpY2UuX3Byb3RvY29sKTtcclxuICAgIGNvbnN0IG1ldGhvZCA9ICdQT1NUJztcclxuICAgIGNvbnN0IGhlYWRlcnMgPSB7XHJcbiAgICAgICAgJ1gtR29vZy1VcGxvYWQtUHJvdG9jb2wnOiAncmVzdW1hYmxlJyxcclxuICAgICAgICAnWC1Hb29nLVVwbG9hZC1Db21tYW5kJzogJ3N0YXJ0JyxcclxuICAgICAgICAnWC1Hb29nLVVwbG9hZC1IZWFkZXItQ29udGVudC1MZW5ndGgnOiBgJHtibG9iLnNpemUoKX1gLFxyXG4gICAgICAgICdYLUdvb2ctVXBsb2FkLUhlYWRlci1Db250ZW50LVR5cGUnOiBtZXRhZGF0YUZvclVwbG9hZFsnY29udGVudFR5cGUnXSxcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgnXHJcbiAgICB9O1xyXG4gICAgY29uc3QgYm9keSA9IHRvUmVzb3VyY2VTdHJpbmcobWV0YWRhdGFGb3JVcGxvYWQsIG1hcHBpbmdzKTtcclxuICAgIGNvbnN0IHRpbWVvdXQgPSBzZXJ2aWNlLm1heFVwbG9hZFJldHJ5VGltZTtcclxuICAgIGZ1bmN0aW9uIGhhbmRsZXIoeGhyKSB7XHJcbiAgICAgICAgY2hlY2tSZXN1bWVIZWFkZXJfKHhocik7XHJcbiAgICAgICAgbGV0IHVybDtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB1cmwgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ1gtR29vZy1VcGxvYWQtVVJMJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZXJDaGVjayhmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGhhbmRsZXJDaGVjayhpc1N0cmluZyh1cmwpKTtcclxuICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIGhhbmRsZXIsIHRpbWVvdXQpO1xyXG4gICAgcmVxdWVzdEluZm8udXJsUGFyYW1zID0gdXJsUGFyYW1zO1xyXG4gICAgcmVxdWVzdEluZm8uaGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgICByZXF1ZXN0SW5mby5ib2R5ID0gYm9keTtcclxuICAgIHJlcXVlc3RJbmZvLmVycm9ySGFuZGxlciA9IHNoYXJlZEVycm9ySGFuZGxlcihsb2NhdGlvbik7XHJcbiAgICByZXR1cm4gcmVxdWVzdEluZm87XHJcbn1cclxuLyoqXHJcbiAqIEBwYXJhbSB1cmwgRnJvbSBhIGNhbGwgdG8gZmJzLnJlcXVlc3RzLmNyZWF0ZVJlc3VtYWJsZVVwbG9hZC5cclxuICovXHJcbmZ1bmN0aW9uIGdldFJlc3VtYWJsZVVwbG9hZFN0YXR1cyhzZXJ2aWNlLCBsb2NhdGlvbiwgdXJsLCBibG9iKSB7XHJcbiAgICBjb25zdCBoZWFkZXJzID0geyAnWC1Hb29nLVVwbG9hZC1Db21tYW5kJzogJ3F1ZXJ5JyB9O1xyXG4gICAgZnVuY3Rpb24gaGFuZGxlcih4aHIpIHtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSBjaGVja1Jlc3VtZUhlYWRlcl8oeGhyLCBbJ2FjdGl2ZScsICdmaW5hbCddKTtcclxuICAgICAgICBsZXQgc2l6ZVN0cmluZyA9IG51bGw7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgc2l6ZVN0cmluZyA9IHhoci5nZXRSZXNwb25zZUhlYWRlcignWC1Hb29nLVVwbG9hZC1TaXplLVJlY2VpdmVkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZXJDaGVjayhmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghc2l6ZVN0cmluZykge1xyXG4gICAgICAgICAgICAvLyBudWxsIG9yIGVtcHR5IHN0cmluZ1xyXG4gICAgICAgICAgICBoYW5kbGVyQ2hlY2soZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzaXplID0gTnVtYmVyKHNpemVTdHJpbmcpO1xyXG4gICAgICAgIGhhbmRsZXJDaGVjayghaXNOYU4oc2l6ZSkpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVzdW1hYmxlVXBsb2FkU3RhdHVzKHNpemUsIGJsb2Iuc2l6ZSgpLCBzdGF0dXMgPT09ICdmaW5hbCcpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWV0aG9kID0gJ1BPU1QnO1xyXG4gICAgY29uc3QgdGltZW91dCA9IHNlcnZpY2UubWF4VXBsb2FkUmV0cnlUaW1lO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIGhhbmRsZXIsIHRpbWVvdXQpO1xyXG4gICAgcmVxdWVzdEluZm8uaGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgICByZXF1ZXN0SW5mby5lcnJvckhhbmRsZXIgPSBzaGFyZWRFcnJvckhhbmRsZXIobG9jYXRpb24pO1xyXG4gICAgcmV0dXJuIHJlcXVlc3RJbmZvO1xyXG59XHJcbi8qKlxyXG4gKiBBbnkgdXBsb2FkcyB2aWEgdGhlIHJlc3VtYWJsZSB1cGxvYWQgQVBJIG11c3QgdHJhbnNmZXIgYSBudW1iZXIgb2YgYnl0ZXNcclxuICogdGhhdCBpcyBhIG11bHRpcGxlIG9mIHRoaXMgbnVtYmVyLlxyXG4gKi9cclxuY29uc3QgUkVTVU1BQkxFX1VQTE9BRF9DSFVOS19TSVpFID0gMjU2ICogMTAyNDtcclxuLyoqXHJcbiAqIEBwYXJhbSB1cmwgRnJvbSBhIGNhbGwgdG8gZmJzLnJlcXVlc3RzLmNyZWF0ZVJlc3VtYWJsZVVwbG9hZC5cclxuICogQHBhcmFtIGNodW5rU2l6ZSBOdW1iZXIgb2YgYnl0ZXMgdG8gdXBsb2FkLlxyXG4gKiBAcGFyYW0gc3RhdHVzIFRoZSBwcmV2aW91cyBzdGF0dXMuXHJcbiAqICAgICBJZiBub3QgcGFzc2VkIG9yIG51bGwsIHdlIHN0YXJ0IGZyb20gdGhlIGJlZ2lubmluZy5cclxuICogQHRocm93cyBmYnMuRXJyb3IgSWYgdGhlIHVwbG9hZCBpcyBhbHJlYWR5IGNvbXBsZXRlLCB0aGUgcGFzc2VkIGluIHN0YXR1c1xyXG4gKiAgICAgaGFzIGEgZmluYWwgc2l6ZSBpbmNvbnNpc3RlbnQgd2l0aCB0aGUgYmxvYiwgb3IgdGhlIGJsb2IgY2Fubm90IGJlIHNsaWNlZFxyXG4gKiAgICAgZm9yIHVwbG9hZC5cclxuICovXHJcbmZ1bmN0aW9uIGNvbnRpbnVlUmVzdW1hYmxlVXBsb2FkKGxvY2F0aW9uLCBzZXJ2aWNlLCB1cmwsIGJsb2IsIGNodW5rU2l6ZSwgbWFwcGluZ3MsIHN0YXR1cywgcHJvZ3Jlc3NDYWxsYmFjaykge1xyXG4gICAgLy8gVE9ETyhhbmR5c290byk6IHN0YW5kYXJkaXplIG9uIGludGVybmFsIGFzc2VydHNcclxuICAgIC8vIGFzc2VydCghKG9wdF9zdGF0dXMgJiYgb3B0X3N0YXR1cy5maW5hbGl6ZWQpKTtcclxuICAgIGNvbnN0IHN0YXR1c18gPSBuZXcgUmVzdW1hYmxlVXBsb2FkU3RhdHVzKDAsIDApO1xyXG4gICAgaWYgKHN0YXR1cykge1xyXG4gICAgICAgIHN0YXR1c18uY3VycmVudCA9IHN0YXR1cy5jdXJyZW50O1xyXG4gICAgICAgIHN0YXR1c18udG90YWwgPSBzdGF0dXMudG90YWw7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBzdGF0dXNfLmN1cnJlbnQgPSAwO1xyXG4gICAgICAgIHN0YXR1c18udG90YWwgPSBibG9iLnNpemUoKTtcclxuICAgIH1cclxuICAgIGlmIChibG9iLnNpemUoKSAhPT0gc3RhdHVzXy50b3RhbCkge1xyXG4gICAgICAgIHRocm93IHNlcnZlckZpbGVXcm9uZ1NpemUoKTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJ5dGVzTGVmdCA9IHN0YXR1c18udG90YWwgLSBzdGF0dXNfLmN1cnJlbnQ7XHJcbiAgICBsZXQgYnl0ZXNUb1VwbG9hZCA9IGJ5dGVzTGVmdDtcclxuICAgIGlmIChjaHVua1NpemUgPiAwKSB7XHJcbiAgICAgICAgYnl0ZXNUb1VwbG9hZCA9IE1hdGgubWluKGJ5dGVzVG9VcGxvYWQsIGNodW5rU2l6ZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzdGFydEJ5dGUgPSBzdGF0dXNfLmN1cnJlbnQ7XHJcbiAgICBjb25zdCBlbmRCeXRlID0gc3RhcnRCeXRlICsgYnl0ZXNUb1VwbG9hZDtcclxuICAgIGxldCB1cGxvYWRDb21tYW5kID0gJyc7XHJcbiAgICBpZiAoYnl0ZXNUb1VwbG9hZCA9PT0gMCkge1xyXG4gICAgICAgIHVwbG9hZENvbW1hbmQgPSAnZmluYWxpemUnO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoYnl0ZXNMZWZ0ID09PSBieXRlc1RvVXBsb2FkKSB7XHJcbiAgICAgICAgdXBsb2FkQ29tbWFuZCA9ICd1cGxvYWQsIGZpbmFsaXplJztcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHVwbG9hZENvbW1hbmQgPSAndXBsb2FkJztcclxuICAgIH1cclxuICAgIGNvbnN0IGhlYWRlcnMgPSB7XHJcbiAgICAgICAgJ1gtR29vZy1VcGxvYWQtQ29tbWFuZCc6IHVwbG9hZENvbW1hbmQsXHJcbiAgICAgICAgJ1gtR29vZy1VcGxvYWQtT2Zmc2V0JzogYCR7c3RhdHVzXy5jdXJyZW50fWBcclxuICAgIH07XHJcbiAgICBjb25zdCBib2R5ID0gYmxvYi5zbGljZShzdGFydEJ5dGUsIGVuZEJ5dGUpO1xyXG4gICAgaWYgKGJvZHkgPT09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyBjYW5ub3RTbGljZUJsb2IoKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGhhbmRsZXIoeGhyLCB0ZXh0KSB7XHJcbiAgICAgICAgLy8gVE9ETyhhbmR5c290byk6IFZlcmlmeSB0aGUgTUQ1IG9mIGVhY2ggdXBsb2FkZWQgcmFuZ2U6XHJcbiAgICAgICAgLy8gdGhlICd4LXJhbmdlLW1kNScgaGVhZGVyIGNvbWVzIGJhY2sgd2l0aCBzdGF0dXMgY29kZSAzMDggcmVzcG9uc2VzLlxyXG4gICAgICAgIC8vIFdlJ2xsIG9ubHkgYmUgYWJsZSB0byBiYWlsIG91dCB0aG91Z2gsIGJlY2F1c2UgeW91IGNhbid0IHJlLXVwbG9hZCBhXHJcbiAgICAgICAgLy8gcmFuZ2UgdGhhdCB5b3UgcHJldmlvdXNseSB1cGxvYWRlZC5cclxuICAgICAgICBjb25zdCB1cGxvYWRTdGF0dXMgPSBjaGVja1Jlc3VtZUhlYWRlcl8oeGhyLCBbJ2FjdGl2ZScsICdmaW5hbCddKTtcclxuICAgICAgICBjb25zdCBuZXdDdXJyZW50ID0gc3RhdHVzXy5jdXJyZW50ICsgYnl0ZXNUb1VwbG9hZDtcclxuICAgICAgICBjb25zdCBzaXplID0gYmxvYi5zaXplKCk7XHJcbiAgICAgICAgbGV0IG1ldGFkYXRhO1xyXG4gICAgICAgIGlmICh1cGxvYWRTdGF0dXMgPT09ICdmaW5hbCcpIHtcclxuICAgICAgICAgICAgbWV0YWRhdGEgPSBtZXRhZGF0YUhhbmRsZXIoc2VydmljZSwgbWFwcGluZ3MpKHhociwgdGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBtZXRhZGF0YSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUmVzdW1hYmxlVXBsb2FkU3RhdHVzKG5ld0N1cnJlbnQsIHNpemUsIHVwbG9hZFN0YXR1cyA9PT0gJ2ZpbmFsJywgbWV0YWRhdGEpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWV0aG9kID0gJ1BPU1QnO1xyXG4gICAgY29uc3QgdGltZW91dCA9IHNlcnZpY2UubWF4VXBsb2FkUmV0cnlUaW1lO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBuZXcgUmVxdWVzdEluZm8odXJsLCBtZXRob2QsIGhhbmRsZXIsIHRpbWVvdXQpO1xyXG4gICAgcmVxdWVzdEluZm8uaGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgICByZXF1ZXN0SW5mby5ib2R5ID0gYm9keS51cGxvYWREYXRhKCk7XHJcbiAgICByZXF1ZXN0SW5mby5wcm9ncmVzc0NhbGxiYWNrID0gcHJvZ3Jlc3NDYWxsYmFjayB8fCBudWxsO1xyXG4gICAgcmVxdWVzdEluZm8uZXJyb3JIYW5kbGVyID0gc2hhcmVkRXJyb3JIYW5kbGVyKGxvY2F0aW9uKTtcclxuICAgIHJldHVybiByZXF1ZXN0SW5mbztcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQW4gZXZlbnQgdGhhdCBpcyB0cmlnZ2VyZWQgb24gYSB0YXNrLlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IFRhc2tFdmVudCA9IHtcclxuICAgIC8qKlxyXG4gICAgICogRm9yIHRoaXMgZXZlbnQsXHJcbiAgICAgKiA8dWw+XHJcbiAgICAgKiAgIDxsaT5UaGUgYG5leHRgIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBvbiBwcm9ncmVzcyB1cGRhdGVzIGFuZCB3aGVuIHRoZVxyXG4gICAgICogICAgICAgdGFzayBpcyBwYXVzZWQvcmVzdW1lZCB3aXRoIGFuIGBVcGxvYWRUYXNrU25hcHNob3RgIGFzIHRoZSBmaXJzdFxyXG4gICAgICogICAgICAgYXJndW1lbnQuPC9saT5cclxuICAgICAqICAgPGxpPlRoZSBgZXJyb3JgIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpZiB0aGUgdXBsb2FkIGlzIGNhbmNlbGVkIG9yIGZhaWxzXHJcbiAgICAgKiAgICAgICBmb3IgYW5vdGhlciByZWFzb24uPC9saT5cclxuICAgICAqICAgPGxpPlRoZSBgY29tcGxldGVgIGZ1bmN0aW9uIGlzIHRyaWdnZXJlZCBpZiB0aGUgdXBsb2FkIGNvbXBsZXRlc1xyXG4gICAgICogICAgICAgc3VjY2Vzc2Z1bGx5LjwvbGk+XHJcbiAgICAgKiA8L3VsPlxyXG4gICAgICovXHJcbiAgICBTVEFURV9DSEFOR0VEOiAnc3RhdGVfY2hhbmdlZCdcclxufTtcclxuLy8gdHlwZSBrZXlzID0ga2V5b2YgVGFza1N0YXRlXHJcbi8qKlxyXG4gKiBSZXByZXNlbnRzIHRoZSBjdXJyZW50IHN0YXRlIG9mIGEgcnVubmluZyB1cGxvYWQuXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY29uc3QgVGFza1N0YXRlID0ge1xyXG4gICAgLyoqIFRoZSB0YXNrIGlzIGN1cnJlbnRseSB0cmFuc2ZlcnJpbmcgZGF0YS4gKi9cclxuICAgIFJVTk5JTkc6ICdydW5uaW5nJyxcclxuICAgIC8qKiBUaGUgdGFzayB3YXMgcGF1c2VkIGJ5IHRoZSB1c2VyLiAqL1xyXG4gICAgUEFVU0VEOiAncGF1c2VkJyxcclxuICAgIC8qKiBUaGUgdGFzayBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LiAqL1xyXG4gICAgU1VDQ0VTUzogJ3N1Y2Nlc3MnLFxyXG4gICAgLyoqIFRoZSB0YXNrIHdhcyBjYW5jZWxlZC4gKi9cclxuICAgIENBTkNFTEVEOiAnY2FuY2VsZWQnLFxyXG4gICAgLyoqIFRoZSB0YXNrIGZhaWxlZCB3aXRoIGFuIGVycm9yLiAqL1xyXG4gICAgRVJST1I6ICdlcnJvcidcclxufTtcclxuZnVuY3Rpb24gdGFza1N0YXRlRnJvbUludGVybmFsVGFza1N0YXRlKHN0YXRlKSB7XHJcbiAgICBzd2l0Y2ggKHN0YXRlKSB7XHJcbiAgICAgICAgY2FzZSBcInJ1bm5pbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HICovOlxyXG4gICAgICAgIGNhc2UgXCJwYXVzaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuUEFVU0lORyAqLzpcclxuICAgICAgICBjYXNlIFwiY2FuY2VsaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuQ0FOQ0VMSU5HICovOlxyXG4gICAgICAgICAgICByZXR1cm4gVGFza1N0YXRlLlJVTk5JTkc7XHJcbiAgICAgICAgY2FzZSBcInBhdXNlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNFRCAqLzpcclxuICAgICAgICAgICAgcmV0dXJuIFRhc2tTdGF0ZS5QQVVTRUQ7XHJcbiAgICAgICAgY2FzZSBcInN1Y2Nlc3NcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5TVUNDRVNTICovOlxyXG4gICAgICAgICAgICByZXR1cm4gVGFza1N0YXRlLlNVQ0NFU1M7XHJcbiAgICAgICAgY2FzZSBcImNhbmNlbGVkXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuQ0FOQ0VMRUQgKi86XHJcbiAgICAgICAgICAgIHJldHVybiBUYXNrU3RhdGUuQ0FOQ0VMRUQ7XHJcbiAgICAgICAgY2FzZSBcImVycm9yXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuRVJST1IgKi86XHJcbiAgICAgICAgICAgIHJldHVybiBUYXNrU3RhdGUuRVJST1I7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgLy8gVE9ETyhhbmR5c290byk6IGFzc2VydChmYWxzZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBUYXNrU3RhdGUuRVJST1I7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY2xhc3MgT2JzZXJ2ZXIge1xyXG4gICAgY29uc3RydWN0b3IobmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZSkge1xyXG4gICAgICAgIGNvbnN0IGFzRnVuY3Rpb25zID0gaXNGdW5jdGlvbihuZXh0T3JPYnNlcnZlcikgfHwgZXJyb3IgIT0gbnVsbCB8fCBjb21wbGV0ZSAhPSBudWxsO1xyXG4gICAgICAgIGlmIChhc0Z1bmN0aW9ucykge1xyXG4gICAgICAgICAgICB0aGlzLm5leHQgPSBuZXh0T3JPYnNlcnZlcjtcclxuICAgICAgICAgICAgdGhpcy5lcnJvciA9IGVycm9yICE9PSBudWxsICYmIGVycm9yICE9PSB2b2lkIDAgPyBlcnJvciA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSA9IGNvbXBsZXRlICE9PSBudWxsICYmIGNvbXBsZXRlICE9PSB2b2lkIDAgPyBjb21wbGV0ZSA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV4dE9yT2JzZXJ2ZXI7XHJcbiAgICAgICAgICAgIHRoaXMubmV4dCA9IG9ic2VydmVyLm5leHQ7XHJcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBvYnNlcnZlci5lcnJvcjtcclxuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZSA9IG9ic2VydmVyLmNvbXBsZXRlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBmIHdpdGggaXRzIGFyZ3VtZW50cyBhc3luY2hyb25vdXNseSBhcyBhXHJcbiAqIG1pY3JvdGFzaywgaS5lLiBhcyBzb29uIGFzIHBvc3NpYmxlIGFmdGVyIHRoZSBjdXJyZW50IHNjcmlwdCByZXR1cm5zIGJhY2tcclxuICogaW50byBicm93c2VyIGNvZGUuXHJcbiAqL1xyXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xyXG5mdW5jdGlvbiBhc3luYyhmKSB7XHJcbiAgICByZXR1cm4gKC4uLmFyZ3NUb0ZvcndhcmQpID0+IHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiBmKC4uLmFyZ3NUb0ZvcndhcmQpKTtcclxuICAgIH07XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqIEFuIG92ZXJyaWRlIGZvciB0aGUgdGV4dC1iYXNlZCBDb25uZWN0aW9uLiBVc2VkIGluIHRlc3RzLiAqL1xyXG5sZXQgdGV4dEZhY3RvcnlPdmVycmlkZSA9IG51bGw7XHJcbi8qKlxyXG4gKiBOZXR3b3JrIGxheWVyIGZvciBicm93c2Vycy4gV2UgdXNlIHRoaXMgaW5zdGVhZCBvZiBnb29nLm5ldC5YaHJJbyBiZWNhdXNlXHJcbiAqIGdvb2cubmV0LlhocklvIGlzIGh5dXV1dWdlIGFuZCBkb2Vzbid0IHdvcmsgaW4gUmVhY3QgTmF0aXZlIG9uIEFuZHJvaWQuXHJcbiAqL1xyXG5jbGFzcyBYaHJDb25uZWN0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuc2VudF8gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnhocl8gPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICB0aGlzLmluaXRYaHIoKTtcclxuICAgICAgICB0aGlzLmVycm9yQ29kZV8gPSBFcnJvckNvZGUuTk9fRVJST1I7XHJcbiAgICAgICAgdGhpcy5zZW5kUHJvbWlzZV8gPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgdGhpcy54aHJfLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvckNvZGVfID0gRXJyb3JDb2RlLkFCT1JUO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy54aHJfLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lcnJvckNvZGVfID0gRXJyb3JDb2RlLk5FVFdPUktfRVJST1I7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnhocl8uYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZW5kKHVybCwgbWV0aG9kLCBib2R5LCBoZWFkZXJzKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VudF8pIHtcclxuICAgICAgICAgICAgdGhyb3cgaW50ZXJuYWxFcnJvcignY2Fubm90IC5zZW5kKCkgbW9yZSB0aGFuIG9uY2UnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZW50XyA9IHRydWU7XHJcbiAgICAgICAgdGhpcy54aHJfLm9wZW4obWV0aG9kLCB1cmwsIHRydWUpO1xyXG4gICAgICAgIGlmIChoZWFkZXJzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gaGVhZGVycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGhlYWRlcnMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMueGhyXy5zZXRSZXF1ZXN0SGVhZGVyKGtleSwgaGVhZGVyc1trZXldLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChib2R5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy54aHJfLnNlbmQoYm9keSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnhocl8uc2VuZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5zZW5kUHJvbWlzZV87XHJcbiAgICB9XHJcbiAgICBnZXRFcnJvckNvZGUoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNlbnRfKSB7XHJcbiAgICAgICAgICAgIHRocm93IGludGVybmFsRXJyb3IoJ2Nhbm5vdCAuZ2V0RXJyb3JDb2RlKCkgYmVmb3JlIHNlbmRpbmcnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb2RlXztcclxuICAgIH1cclxuICAgIGdldFN0YXR1cygpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc2VudF8pIHtcclxuICAgICAgICAgICAgdGhyb3cgaW50ZXJuYWxFcnJvcignY2Fubm90IC5nZXRTdGF0dXMoKSBiZWZvcmUgc2VuZGluZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy54aHJfLnN0YXR1cztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldFJlc3BvbnNlKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5zZW50Xykge1xyXG4gICAgICAgICAgICB0aHJvdyBpbnRlcm5hbEVycm9yKCdjYW5ub3QgLmdldFJlc3BvbnNlKCkgYmVmb3JlIHNlbmRpbmcnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueGhyXy5yZXNwb25zZTtcclxuICAgIH1cclxuICAgIGdldEVycm9yVGV4dCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuc2VudF8pIHtcclxuICAgICAgICAgICAgdGhyb3cgaW50ZXJuYWxFcnJvcignY2Fubm90IC5nZXRFcnJvclRleHQoKSBiZWZvcmUgc2VuZGluZycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy54aHJfLnN0YXR1c1RleHQ7XHJcbiAgICB9XHJcbiAgICAvKiogQWJvcnRzIHRoZSByZXF1ZXN0LiAqL1xyXG4gICAgYWJvcnQoKSB7XHJcbiAgICAgICAgdGhpcy54aHJfLmFib3J0KCk7XHJcbiAgICB9XHJcbiAgICBnZXRSZXNwb25zZUhlYWRlcihoZWFkZXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy54aHJfLmdldFJlc3BvbnNlSGVhZGVyKGhlYWRlcik7XHJcbiAgICB9XHJcbiAgICBhZGRVcGxvYWRQcm9ncmVzc0xpc3RlbmVyKGxpc3RlbmVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMueGhyXy51cGxvYWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnhocl8udXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJywgbGlzdGVuZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJlbW92ZVVwbG9hZFByb2dyZXNzTGlzdGVuZXIobGlzdGVuZXIpIHtcclxuICAgICAgICBpZiAodGhpcy54aHJfLnVwbG9hZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMueGhyXy51cGxvYWQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJvZ3Jlc3MnLCBsaXN0ZW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbmNsYXNzIFhoclRleHRDb25uZWN0aW9uIGV4dGVuZHMgWGhyQ29ubmVjdGlvbiB7XHJcbiAgICBpbml0WGhyKCkge1xyXG4gICAgICAgIHRoaXMueGhyXy5yZXNwb25zZVR5cGUgPSAndGV4dCc7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gbmV3VGV4dENvbm5lY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGV4dEZhY3RvcnlPdmVycmlkZSA/IHRleHRGYWN0b3J5T3ZlcnJpZGUoKSA6IG5ldyBYaHJUZXh0Q29ubmVjdGlvbigpO1xyXG59XHJcbmNsYXNzIFhockJ5dGVzQ29ubmVjdGlvbiBleHRlbmRzIFhockNvbm5lY3Rpb24ge1xyXG4gICAgaW5pdFhocigpIHtcclxuICAgICAgICB0aGlzLnhocl8ucmVzcG9uc2VUeXBlID0gJ2FycmF5YnVmZmVyJztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBuZXdCeXRlc0Nvbm5lY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IFhockJ5dGVzQ29ubmVjdGlvbigpO1xyXG59XHJcbmNsYXNzIFhockJsb2JDb25uZWN0aW9uIGV4dGVuZHMgWGhyQ29ubmVjdGlvbiB7XHJcbiAgICBpbml0WGhyKCkge1xyXG4gICAgICAgIHRoaXMueGhyXy5yZXNwb25zZVR5cGUgPSAnYmxvYic7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gbmV3QmxvYkNvbm5lY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gbmV3IFhockJsb2JDb25uZWN0aW9uKCk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFJlcHJlc2VudHMgYSBibG9iIGJlaW5nIHVwbG9hZGVkLiBDYW4gYmUgdXNlZCB0byBwYXVzZS9yZXN1bWUvY2FuY2VsIHRoZVxyXG4gKiB1cGxvYWQgYW5kIG1hbmFnZSBjYWxsYmFja3MgZm9yIHZhcmlvdXMgZXZlbnRzLlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNsYXNzIFVwbG9hZFRhc2sge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gcmVmIC0gVGhlIGZpcmViYXNlU3RvcmFnZS5SZWZlcmVuY2Ugb2JqZWN0IHRoaXMgdGFzayBjYW1lXHJcbiAgICAgKiAgICAgZnJvbSwgdW50eXBlZCB0byBhdm9pZCBjeWNsaWMgZGVwZW5kZW5jaWVzLlxyXG4gICAgICogQHBhcmFtIGJsb2IgLSBUaGUgYmxvYiB0byB1cGxvYWQuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHJlZiwgYmxvYiwgbWV0YWRhdGEgPSBudWxsKSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogTnVtYmVyIG9mIGJ5dGVzIHRyYW5zZmVycmVkIHNvIGZhci5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLl90cmFuc2ZlcnJlZCA9IDA7XHJcbiAgICAgICAgdGhpcy5fbmVlZFRvRmV0Y2hTdGF0dXMgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9uZWVkVG9GZXRjaE1ldGFkYXRhID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fb2JzZXJ2ZXJzID0gW107XHJcbiAgICAgICAgdGhpcy5fZXJyb3IgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5fdXBsb2FkVXJsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5fY2h1bmtNdWx0aXBsaWVyID0gMTtcclxuICAgICAgICB0aGlzLl9yZXNvbHZlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuX3JlamVjdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLl9yZWYgPSByZWY7XHJcbiAgICAgICAgdGhpcy5fYmxvYiA9IGJsb2I7XHJcbiAgICAgICAgdGhpcy5fbWV0YWRhdGEgPSBtZXRhZGF0YTtcclxuICAgICAgICB0aGlzLl9tYXBwaW5ncyA9IGdldE1hcHBpbmdzKCk7XHJcbiAgICAgICAgdGhpcy5fcmVzdW1hYmxlID0gdGhpcy5fc2hvdWxkRG9SZXN1bWFibGUodGhpcy5fYmxvYik7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBcInJ1bm5pbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HICovO1xyXG4gICAgICAgIHRoaXMuX2Vycm9ySGFuZGxlciA9IGVycm9yID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5fY2h1bmtNdWx0aXBsaWVyID0gMTtcclxuICAgICAgICAgICAgaWYgKGVycm9yLl9jb2RlRXF1YWxzKFwiY2FuY2VsZWRcIiAvKiBTdG9yYWdlRXJyb3JDb2RlLkNBTkNFTEVEICovKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbmVlZFRvRmV0Y2hTdGF0dXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZVRyYW5zaXRpb25zXygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYmFja29mZkV4cGlyZWQgPSB0aGlzLmlzRXhwb25lbnRpYWxCYWNrb2ZmRXhwaXJlZCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzUmV0cnlTdGF0dXNDb2RlKGVycm9yLnN0YXR1cywgW10pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJhY2tvZmZFeHBpcmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gcmV0cnlMaW1pdEV4Y2VlZGVkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNsZWVwVGltZSA9IE1hdGgubWF4KHRoaXMuc2xlZXBUaW1lICogMiwgREVGQVVMVF9NSU5fU0xFRVBfVElNRV9NSUxMSVMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZWVkVG9GZXRjaFN0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVUcmFuc2l0aW9uc18oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuX2Vycm9yID0gZXJyb3I7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uKFwiZXJyb3JcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5FUlJPUiAqLyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuX21ldGFkYXRhRXJyb3JIYW5kbGVyID0gZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IuX2NvZGVFcXVhbHMoXCJjYW5jZWxlZFwiIC8qIFN0b3JhZ2VFcnJvckNvZGUuQ0FOQ0VMRUQgKi8pKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlVHJhbnNpdGlvbnNfKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9lcnJvciA9IGVycm9yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbihcImVycm9yXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuRVJST1IgKi8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNsZWVwVGltZSA9IDA7XHJcbiAgICAgICAgdGhpcy5tYXhTbGVlcFRpbWUgPSB0aGlzLl9yZWYuc3RvcmFnZS5tYXhVcGxvYWRSZXRyeVRpbWU7XHJcbiAgICAgICAgdGhpcy5fcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZSA9IHJlc29sdmU7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlamVjdCA9IHJlamVjdDtcclxuICAgICAgICAgICAgdGhpcy5fc3RhcnQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBQcmV2ZW50IHVuY2F1Z2h0IHJlamVjdGlvbnMgb24gdGhlIGludGVybmFsIHByb21pc2UgZnJvbSBidWJibGluZyBvdXRcclxuICAgICAgICAvLyB0byB0aGUgdG9wIGxldmVsIHdpdGggYSBkdW1teSBoYW5kbGVyLlxyXG4gICAgICAgIHRoaXMuX3Byb21pc2UudGhlbihudWxsLCAoKSA9PiB7IH0pO1xyXG4gICAgfVxyXG4gICAgaXNFeHBvbmVudGlhbEJhY2tvZmZFeHBpcmVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNsZWVwVGltZSA+IHRoaXMubWF4U2xlZXBUaW1lO1xyXG4gICAgfVxyXG4gICAgX21ha2VQcm9ncmVzc0NhbGxiYWNrKCkge1xyXG4gICAgICAgIGNvbnN0IHNpemVCZWZvcmUgPSB0aGlzLl90cmFuc2ZlcnJlZDtcclxuICAgICAgICByZXR1cm4gbG9hZGVkID0+IHRoaXMuX3VwZGF0ZVByb2dyZXNzKHNpemVCZWZvcmUgKyBsb2FkZWQpO1xyXG4gICAgfVxyXG4gICAgX3Nob3VsZERvUmVzdW1hYmxlKGJsb2IpIHtcclxuICAgICAgICByZXR1cm4gYmxvYi5zaXplKCkgPiAyNTYgKiAxMDI0O1xyXG4gICAgfVxyXG4gICAgX3N0YXJ0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZSAhPT0gXCJydW5uaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuUlVOTklORyAqLykge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGNhbiBoYXBwZW4gaWYgc29tZW9uZSBwYXVzZXMgdXMgaW4gYSByZXN1bWUgY2FsbGJhY2ssIGZvciBleGFtcGxlLlxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5fcmVzdW1hYmxlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl91cGxvYWRVcmwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlUmVzdW1hYmxlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbmVlZFRvRmV0Y2hTdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9mZXRjaFN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX25lZWRUb0ZldGNoTWV0YWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSGFwcGVucyBpZiB3ZSBtaXNzIHRoZSBtZXRhZGF0YSBvbiB1cGxvYWQgY29tcGxldGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZmV0Y2hNZXRhZGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nVGltZW91dCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbnRpbnVlVXBsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuc2xlZXBUaW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX29uZVNob3RVcGxvYWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfcmVzb2x2ZVRva2VuKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xyXG4gICAgICAgIFByb21pc2UuYWxsKFtcclxuICAgICAgICAgICAgdGhpcy5fcmVmLnN0b3JhZ2UuX2dldEF1dGhUb2tlbigpLFxyXG4gICAgICAgICAgICB0aGlzLl9yZWYuc3RvcmFnZS5fZ2V0QXBwQ2hlY2tUb2tlbigpXHJcbiAgICAgICAgXSkudGhlbigoW2F1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbl0pID0+IHtcclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9zdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInJ1bm5pbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HICovOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGF1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2FuY2VsaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuQ0FOQ0VMSU5HICovOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb24oXCJjYW5jZWxlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLkNBTkNFTEVEICovKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJwYXVzaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuUEFVU0lORyAqLzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uKFwicGF1c2VkXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuUEFVU0VEICovKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8gVE9ETyhhbmR5c290byk6IGFzc2VydCBmYWxzZVxyXG4gICAgX2NyZWF0ZVJlc3VtYWJsZSgpIHtcclxuICAgICAgICB0aGlzLl9yZXNvbHZlVG9rZW4oKGF1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0SW5mbyA9IGNyZWF0ZVJlc3VtYWJsZVVwbG9hZCh0aGlzLl9yZWYuc3RvcmFnZSwgdGhpcy5fcmVmLl9sb2NhdGlvbiwgdGhpcy5fbWFwcGluZ3MsIHRoaXMuX2Jsb2IsIHRoaXMuX21ldGFkYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgY3JlYXRlUmVxdWVzdCA9IHRoaXMuX3JlZi5zdG9yYWdlLl9tYWtlUmVxdWVzdChyZXF1ZXN0SW5mbywgbmV3VGV4dENvbm5lY3Rpb24sIGF1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbik7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0O1xyXG4gICAgICAgICAgICBjcmVhdGVSZXF1ZXN0LmdldFByb21pc2UoKS50aGVuKCh1cmwpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl91cGxvYWRVcmwgPSB1cmw7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9uZWVkVG9GZXRjaFN0YXR1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZVRyYW5zaXRpb25zXygpO1xyXG4gICAgICAgICAgICB9LCB0aGlzLl9lcnJvckhhbmRsZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgX2ZldGNoU3RhdHVzKCkge1xyXG4gICAgICAgIC8vIFRPRE8oYW5keXNvdG8pOiBhc3NlcnQodGhpcy51cGxvYWRVcmxfICE9PSBudWxsKTtcclxuICAgICAgICBjb25zdCB1cmwgPSB0aGlzLl91cGxvYWRVcmw7XHJcbiAgICAgICAgdGhpcy5fcmVzb2x2ZVRva2VuKChhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdEluZm8gPSBnZXRSZXN1bWFibGVVcGxvYWRTdGF0dXModGhpcy5fcmVmLnN0b3JhZ2UsIHRoaXMuX3JlZi5fbG9jYXRpb24sIHVybCwgdGhpcy5fYmxvYik7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXR1c1JlcXVlc3QgPSB0aGlzLl9yZWYuc3RvcmFnZS5fbWFrZVJlcXVlc3QocmVxdWVzdEluZm8sIG5ld1RleHRDb25uZWN0aW9uLCBhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4pO1xyXG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0ID0gc3RhdHVzUmVxdWVzdDtcclxuICAgICAgICAgICAgc3RhdHVzUmVxdWVzdC5nZXRQcm9taXNlKCkudGhlbihzdGF0dXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVByb2dyZXNzKHN0YXR1cy5jdXJyZW50KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX25lZWRUb0ZldGNoU3RhdHVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzLmZpbmFsaXplZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX25lZWRUb0ZldGNoTWV0YWRhdGEgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb21wbGV0ZVRyYW5zaXRpb25zXygpO1xyXG4gICAgICAgICAgICB9LCB0aGlzLl9lcnJvckhhbmRsZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgX2NvbnRpbnVlVXBsb2FkKCkge1xyXG4gICAgICAgIGNvbnN0IGNodW5rU2l6ZSA9IFJFU1VNQUJMRV9VUExPQURfQ0hVTktfU0laRSAqIHRoaXMuX2NodW5rTXVsdGlwbGllcjtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSBuZXcgUmVzdW1hYmxlVXBsb2FkU3RhdHVzKHRoaXMuX3RyYW5zZmVycmVkLCB0aGlzLl9ibG9iLnNpemUoKSk7XHJcbiAgICAgICAgLy8gVE9ETyhhbmR5c290byk6IGFzc2VydCh0aGlzLnVwbG9hZFVybF8gIT09IG51bGwpO1xyXG4gICAgICAgIGNvbnN0IHVybCA9IHRoaXMuX3VwbG9hZFVybDtcclxuICAgICAgICB0aGlzLl9yZXNvbHZlVG9rZW4oKGF1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcmVxdWVzdEluZm87XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0SW5mbyA9IGNvbnRpbnVlUmVzdW1hYmxlVXBsb2FkKHRoaXMuX3JlZi5fbG9jYXRpb24sIHRoaXMuX3JlZi5zdG9yYWdlLCB1cmwsIHRoaXMuX2Jsb2IsIGNodW5rU2l6ZSwgdGhpcy5fbWFwcGluZ3MsIHN0YXR1cywgdGhpcy5fbWFrZVByb2dyZXNzQ2FsbGJhY2soKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2Vycm9yID0gZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb24oXCJlcnJvclwiIC8qIEludGVybmFsVGFza1N0YXRlLkVSUk9SICovKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCB1cGxvYWRSZXF1ZXN0ID0gdGhpcy5fcmVmLnN0b3JhZ2UuX21ha2VSZXF1ZXN0KHJlcXVlc3RJbmZvLCBuZXdUZXh0Q29ubmVjdGlvbiwgYXV0aFRva2VuLCBhcHBDaGVja1Rva2VuLCBcclxuICAgICAgICAgICAgLypyZXRyeT0qLyBmYWxzZSAvLyBVcGxvYWQgcmVxdWVzdHMgc2hvdWxkIG5vdCBiZSByZXRyaWVkIGFzIGVhY2ggcmV0cnkgc2hvdWxkIGJlIHByZWNlZGVkIGJ5IGFub3RoZXIgcXVlcnkgcmVxdWVzdC4gV2hpY2ggaXMgaGFuZGxlZCBpbiB0aGlzIGZpbGUuXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgPSB1cGxvYWRSZXF1ZXN0O1xyXG4gICAgICAgICAgICB1cGxvYWRSZXF1ZXN0LmdldFByb21pc2UoKS50aGVuKChuZXdTdGF0dXMpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2luY3JlYXNlTXVsdGlwbGllcigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVByb2dyZXNzKG5ld1N0YXR1cy5jdXJyZW50KTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdTdGF0dXMuZmluYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWV0YWRhdGEgPSBuZXdTdGF0dXMubWV0YWRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbihcInN1Y2Nlc3NcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5TVUNDRVNTICovKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGVUcmFuc2l0aW9uc18oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcy5fZXJyb3JIYW5kbGVyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIF9pbmNyZWFzZU11bHRpcGxpZXIoKSB7XHJcbiAgICAgICAgY29uc3QgY3VycmVudFNpemUgPSBSRVNVTUFCTEVfVVBMT0FEX0NIVU5LX1NJWkUgKiB0aGlzLl9jaHVua011bHRpcGxpZXI7XHJcbiAgICAgICAgLy8gTWF4IGNodW5rIHNpemUgaXMgMzJNLlxyXG4gICAgICAgIGlmIChjdXJyZW50U2l6ZSAqIDIgPCAzMiAqIDEwMjQgKiAxMDI0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NodW5rTXVsdGlwbGllciAqPSAyO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIF9mZXRjaE1ldGFkYXRhKCkge1xyXG4gICAgICAgIHRoaXMuX3Jlc29sdmVUb2tlbigoYXV0aFRva2VuLCBhcHBDaGVja1Rva2VuKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gZ2V0TWV0YWRhdGEkMih0aGlzLl9yZWYuc3RvcmFnZSwgdGhpcy5fcmVmLl9sb2NhdGlvbiwgdGhpcy5fbWFwcGluZ3MpO1xyXG4gICAgICAgICAgICBjb25zdCBtZXRhZGF0YVJlcXVlc3QgPSB0aGlzLl9yZWYuc3RvcmFnZS5fbWFrZVJlcXVlc3QocmVxdWVzdEluZm8sIG5ld1RleHRDb25uZWN0aW9uLCBhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4pO1xyXG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0ID0gbWV0YWRhdGFSZXF1ZXN0O1xyXG4gICAgICAgICAgICBtZXRhZGF0YVJlcXVlc3QuZ2V0UHJvbWlzZSgpLnRoZW4obWV0YWRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21ldGFkYXRhID0gbWV0YWRhdGE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uKFwic3VjY2Vzc1wiIC8qIEludGVybmFsVGFza1N0YXRlLlNVQ0NFU1MgKi8pO1xyXG4gICAgICAgICAgICB9LCB0aGlzLl9tZXRhZGF0YUVycm9ySGFuZGxlcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBfb25lU2hvdFVwbG9hZCgpIHtcclxuICAgICAgICB0aGlzLl9yZXNvbHZlVG9rZW4oKGF1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0SW5mbyA9IG11bHRpcGFydFVwbG9hZCh0aGlzLl9yZWYuc3RvcmFnZSwgdGhpcy5fcmVmLl9sb2NhdGlvbiwgdGhpcy5fbWFwcGluZ3MsIHRoaXMuX2Jsb2IsIHRoaXMuX21ldGFkYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgbXVsdGlwYXJ0UmVxdWVzdCA9IHRoaXMuX3JlZi5zdG9yYWdlLl9tYWtlUmVxdWVzdChyZXF1ZXN0SW5mbywgbmV3VGV4dENvbm5lY3Rpb24sIGF1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbik7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgPSBtdWx0aXBhcnRSZXF1ZXN0O1xyXG4gICAgICAgICAgICBtdWx0aXBhcnRSZXF1ZXN0LmdldFByb21pc2UoKS50aGVuKG1ldGFkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3QgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9tZXRhZGF0YSA9IG1ldGFkYXRhO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlUHJvZ3Jlc3ModGhpcy5fYmxvYi5zaXplKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbihcInN1Y2Nlc3NcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5TVUNDRVNTICovKTtcclxuICAgICAgICAgICAgfSwgdGhpcy5fZXJyb3JIYW5kbGVyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIF91cGRhdGVQcm9ncmVzcyh0cmFuc2ZlcnJlZCkge1xyXG4gICAgICAgIGNvbnN0IG9sZCA9IHRoaXMuX3RyYW5zZmVycmVkO1xyXG4gICAgICAgIHRoaXMuX3RyYW5zZmVycmVkID0gdHJhbnNmZXJyZWQ7XHJcbiAgICAgICAgLy8gQSBwcm9ncmVzcyB1cGRhdGUgY2FuIG1ha2UgdGhlIFwidHJhbnNmZXJyZWRcIiB2YWx1ZSBzbWFsbGVyIChlLmcuIGFcclxuICAgICAgICAvLyBwYXJ0aWFsIHVwbG9hZCBub3QgY29tcGxldGVkIGJ5IHNlcnZlciwgYWZ0ZXIgd2hpY2ggdGhlIFwidHJhbnNmZXJyZWRcIlxyXG4gICAgICAgIC8vIHZhbHVlIG1heSByZXNldCB0byB0aGUgdmFsdWUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcmVxdWVzdCkuXHJcbiAgICAgICAgaWYgKHRoaXMuX3RyYW5zZmVycmVkICE9PSBvbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5fbm90aWZ5T2JzZXJ2ZXJzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgX3RyYW5zaXRpb24oc3RhdGUpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3RhdGUgPT09IHN0YXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3dpdGNoIChzdGF0ZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwiY2FuY2VsaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuQ0FOQ0VMSU5HICovOlxyXG4gICAgICAgICAgICBjYXNlIFwicGF1c2luZ1wiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNJTkcgKi86XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGFuZHlzb3RvKTpcclxuICAgICAgICAgICAgICAgIC8vIGFzc2VydCh0aGlzLnN0YXRlXyA9PT0gSW50ZXJuYWxUYXNrU3RhdGUuUlVOTklORyB8fFxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHRoaXMuc3RhdGVfID09PSBJbnRlcm5hbFRhc2tTdGF0ZS5QQVVTSU5HKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gc3RhdGU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVxdWVzdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdC5jYW5jZWwoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMucGVuZGluZ1RpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5wZW5kaW5nVGltZW91dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nVGltZW91dCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlVHJhbnNpdGlvbnNfKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInJ1bm5pbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HICovOlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhhbmR5c290byk6XHJcbiAgICAgICAgICAgICAgICAvLyBhc3NlcnQodGhpcy5zdGF0ZV8gPT09IEludGVybmFsVGFza1N0YXRlLlBBVVNFRCB8fFxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHRoaXMuc3RhdGVfID09PSBJbnRlcm5hbFRhc2tTdGF0ZS5QQVVTSU5HKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHdhc1BhdXNlZCA9IHRoaXMuX3N0YXRlID09PSBcInBhdXNlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNFRCAqLztcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gc3RhdGU7XHJcbiAgICAgICAgICAgICAgICBpZiAod2FzUGF1c2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbm90aWZ5T2JzZXJ2ZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RhcnQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwicGF1c2VkXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuUEFVU0VEICovOlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhhbmR5c290byk6XHJcbiAgICAgICAgICAgICAgICAvLyBhc3NlcnQodGhpcy5zdGF0ZV8gPT09IEludGVybmFsVGFza1N0YXRlLlBBVVNJTkcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeU9ic2VydmVycygpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLkNBTkNFTEVEICovOlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhhbmR5c290byk6XHJcbiAgICAgICAgICAgICAgICAvLyBhc3NlcnQodGhpcy5zdGF0ZV8gPT09IEludGVybmFsVGFza1N0YXRlLlBBVVNFRCB8fFxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHRoaXMuc3RhdGVfID09PSBJbnRlcm5hbFRhc2tTdGF0ZS5DQU5DRUxJTkcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZXJyb3IgPSBjYW5jZWxlZCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeU9ic2VydmVycygpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJlcnJvclwiIC8qIEludGVybmFsVGFza1N0YXRlLkVSUk9SICovOlxyXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhhbmR5c290byk6XHJcbiAgICAgICAgICAgICAgICAvLyBhc3NlcnQodGhpcy5zdGF0ZV8gPT09IEludGVybmFsVGFza1N0YXRlLlJVTk5JTkcgfHxcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB0aGlzLnN0YXRlXyA9PT0gSW50ZXJuYWxUYXNrU3RhdGUuUEFVU0lORyB8fFxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHRoaXMuc3RhdGVfID09PSBJbnRlcm5hbFRhc2tTdGF0ZS5DQU5DRUxJTkcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBzdGF0ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeU9ic2VydmVycygpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJzdWNjZXNzXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuU1VDQ0VTUyAqLzpcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8oYW5keXNvdG8pOlxyXG4gICAgICAgICAgICAgICAgLy8gYXNzZXJ0KHRoaXMuc3RhdGVfID09PSBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HIHx8XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgdGhpcy5zdGF0ZV8gPT09IEludGVybmFsVGFza1N0YXRlLlBBVVNJTkcgfHxcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICB0aGlzLnN0YXRlXyA9PT0gSW50ZXJuYWxUYXNrU3RhdGUuQ0FOQ0VMSU5HKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gc3RhdGU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ub3RpZnlPYnNlcnZlcnMoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbXBsZXRlVHJhbnNpdGlvbnNfKCkge1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5fc3RhdGUpIHtcclxuICAgICAgICAgICAgY2FzZSBcInBhdXNpbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5QQVVTSU5HICovOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbihcInBhdXNlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNFRCAqLyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImNhbmNlbGluZ1wiIC8qIEludGVybmFsVGFza1N0YXRlLkNBTkNFTElORyAqLzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb24oXCJjYW5jZWxlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLkNBTkNFTEVEICovKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwicnVubmluZ1wiIC8qIEludGVybmFsVGFza1N0YXRlLlJVTk5JTkcgKi86XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGFydCgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBIHNuYXBzaG90IG9mIHRoZSBjdXJyZW50IHRhc2sgc3RhdGUuXHJcbiAgICAgKi9cclxuICAgIGdldCBzbmFwc2hvdCgpIHtcclxuICAgICAgICBjb25zdCBleHRlcm5hbFN0YXRlID0gdGFza1N0YXRlRnJvbUludGVybmFsVGFza1N0YXRlKHRoaXMuX3N0YXRlKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBieXRlc1RyYW5zZmVycmVkOiB0aGlzLl90cmFuc2ZlcnJlZCxcclxuICAgICAgICAgICAgdG90YWxCeXRlczogdGhpcy5fYmxvYi5zaXplKCksXHJcbiAgICAgICAgICAgIHN0YXRlOiBleHRlcm5hbFN0YXRlLFxyXG4gICAgICAgICAgICBtZXRhZGF0YTogdGhpcy5fbWV0YWRhdGEsXHJcbiAgICAgICAgICAgIHRhc2s6IHRoaXMsXHJcbiAgICAgICAgICAgIHJlZjogdGhpcy5fcmVmXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIGNhbGxiYWNrIGZvciBhbiBldmVudC5cclxuICAgICAqIEBwYXJhbSB0eXBlIC0gVGhlIHR5cGUgb2YgZXZlbnQgdG8gbGlzdGVuIGZvci5cclxuICAgICAqIEBwYXJhbSBuZXh0T3JPYnNlcnZlciAtXHJcbiAgICAgKiAgICAgVGhlIGBuZXh0YCBmdW5jdGlvbiwgd2hpY2ggZ2V0cyBjYWxsZWQgZm9yIGVhY2ggaXRlbSBpblxyXG4gICAgICogICAgIHRoZSBldmVudCBzdHJlYW0sIG9yIGFuIG9ic2VydmVyIG9iamVjdCB3aXRoIHNvbWUgb3IgYWxsIG9mIHRoZXNlIHRocmVlXHJcbiAgICAgKiAgICAgcHJvcGVydGllcyAoYG5leHRgLCBgZXJyb3JgLCBgY29tcGxldGVgKS5cclxuICAgICAqIEBwYXJhbSBlcnJvciAtIEEgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCB3aXRoIGEgYFN0b3JhZ2VFcnJvcmBcclxuICAgICAqICAgICBpZiB0aGUgZXZlbnQgc3RyZWFtIGVuZHMgZHVlIHRvIGFuIGVycm9yLlxyXG4gICAgICogQHBhcmFtIGNvbXBsZXRlZCAtIEEgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCBpZiB0aGVcclxuICAgICAqICAgICBldmVudCBzdHJlYW0gZW5kcyBub3JtYWxseS5cclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKiAgICAgSWYgb25seSB0aGUgZXZlbnQgYXJndW1lbnQgaXMgcGFzc2VkLCByZXR1cm5zIGEgZnVuY3Rpb24geW91IGNhbiB1c2UgdG9cclxuICAgICAqICAgICBhZGQgY2FsbGJhY2tzIChzZWUgdGhlIGV4YW1wbGVzIGFib3ZlKS4gSWYgbW9yZSB0aGFuIGp1c3QgdGhlIGV2ZW50XHJcbiAgICAgKiAgICAgYXJndW1lbnQgaXMgcGFzc2VkLCByZXR1cm5zIGEgZnVuY3Rpb24geW91IGNhbiBjYWxsIHRvIHVucmVnaXN0ZXIgdGhlXHJcbiAgICAgKiAgICAgY2FsbGJhY2tzLlxyXG4gICAgICovXHJcbiAgICBvbih0eXBlLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkge1xyXG4gICAgICAgIC8vIE5vdGU6IGB0eXBlYCBpc24ndCBiZWluZyB1c2VkLiBJdHMgdHlwZSBpcyBhbHNvIGluY29ycmVjdC4gVGFza0V2ZW50IHNob3VsZCBub3QgYmUgYSBzdHJpbmcuXHJcbiAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgT2JzZXJ2ZXIobmV4dE9yT2JzZXJ2ZXIgfHwgdW5kZWZpbmVkLCBlcnJvciB8fCB1bmRlZmluZWQsIGNvbXBsZXRlZCB8fCB1bmRlZmluZWQpO1xyXG4gICAgICAgIHRoaXMuX2FkZE9ic2VydmVyKG9ic2VydmVyKTtcclxuICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9yZW1vdmVPYnNlcnZlcihvYnNlcnZlcik7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVGhpcyBvYmplY3QgYmVoYXZlcyBsaWtlIGEgUHJvbWlzZSwgYW5kIHJlc29sdmVzIHdpdGggaXRzIHNuYXBzaG90IGRhdGFcclxuICAgICAqIHdoZW4gdGhlIHVwbG9hZCBjb21wbGV0ZXMuXHJcbiAgICAgKiBAcGFyYW0gb25GdWxmaWxsZWQgLSBUaGUgZnVsZmlsbG1lbnQgY2FsbGJhY2suIFByb21pc2UgY2hhaW5pbmcgd29ya3MgYXMgbm9ybWFsLlxyXG4gICAgICogQHBhcmFtIG9uUmVqZWN0ZWQgLSBUaGUgcmVqZWN0aW9uIGNhbGxiYWNrLlxyXG4gICAgICovXHJcbiAgICB0aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSB7XHJcbiAgICAgICAgLy8gVGhlc2UgY2FzdHMgYXJlIG5lZWRlZCBzbyB0aGF0IFR5cGVTY3JpcHQgY2FuIGluZmVyIHRoZSB0eXBlcyBvZiB0aGVcclxuICAgICAgICAvLyByZXN1bHRpbmcgUHJvbWlzZS5cclxuICAgICAgICByZXR1cm4gdGhpcy5fcHJvbWlzZS50aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogRXF1aXZhbGVudCB0byBjYWxsaW5nIGB0aGVuKG51bGwsIG9uUmVqZWN0ZWQpYC5cclxuICAgICAqL1xyXG4gICAgY2F0Y2gob25SZWplY3RlZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRoZW4obnVsbCwgb25SZWplY3RlZCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgdGhlIGdpdmVuIG9ic2VydmVyLlxyXG4gICAgICovXHJcbiAgICBfYWRkT2JzZXJ2ZXIob2JzZXJ2ZXIpIHtcclxuICAgICAgICB0aGlzLl9vYnNlcnZlcnMucHVzaChvYnNlcnZlcik7XHJcbiAgICAgICAgdGhpcy5fbm90aWZ5T2JzZXJ2ZXIob2JzZXJ2ZXIpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIHRoZSBnaXZlbiBvYnNlcnZlci5cclxuICAgICAqL1xyXG4gICAgX3JlbW92ZU9ic2VydmVyKG9ic2VydmVyKSB7XHJcbiAgICAgICAgY29uc3QgaSA9IHRoaXMuX29ic2VydmVycy5pbmRleE9mKG9ic2VydmVyKTtcclxuICAgICAgICBpZiAoaSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5fb2JzZXJ2ZXJzLnNwbGljZShpLCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfbm90aWZ5T2JzZXJ2ZXJzKCkge1xyXG4gICAgICAgIHRoaXMuX2ZpbmlzaFByb21pc2UoKTtcclxuICAgICAgICBjb25zdCBvYnNlcnZlcnMgPSB0aGlzLl9vYnNlcnZlcnMuc2xpY2UoKTtcclxuICAgICAgICBvYnNlcnZlcnMuZm9yRWFjaChvYnNlcnZlciA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX25vdGlmeU9ic2VydmVyKG9ic2VydmVyKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIF9maW5pc2hQcm9taXNlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9yZXNvbHZlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbGV0IHRyaWdnZXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodGFza1N0YXRlRnJvbUludGVybmFsVGFza1N0YXRlKHRoaXMuX3N0YXRlKSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBUYXNrU3RhdGUuU1VDQ0VTUzpcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyh0aGlzLl9yZXNvbHZlLmJpbmQobnVsbCwgdGhpcy5zbmFwc2hvdCkpKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFRhc2tTdGF0ZS5DQU5DRUxFRDpcclxuICAgICAgICAgICAgICAgIGNhc2UgVGFza1N0YXRlLkVSUk9SOlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvQ2FsbCA9IHRoaXMuX3JlamVjdDtcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyh0b0NhbGwuYmluZChudWxsLCB0aGlzLl9lcnJvcikpKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0cmlnZ2VyZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Jlc29sdmUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWplY3QgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBfbm90aWZ5T2JzZXJ2ZXIob2JzZXJ2ZXIpIHtcclxuICAgICAgICBjb25zdCBleHRlcm5hbFN0YXRlID0gdGFza1N0YXRlRnJvbUludGVybmFsVGFza1N0YXRlKHRoaXMuX3N0YXRlKTtcclxuICAgICAgICBzd2l0Y2ggKGV4dGVybmFsU3RhdGUpIHtcclxuICAgICAgICAgICAgY2FzZSBUYXNrU3RhdGUuUlVOTklORzpcclxuICAgICAgICAgICAgY2FzZSBUYXNrU3RhdGUuUEFVU0VEOlxyXG4gICAgICAgICAgICAgICAgaWYgKG9ic2VydmVyLm5leHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyhvYnNlcnZlci5uZXh0LmJpbmQob2JzZXJ2ZXIsIHRoaXMuc25hcHNob3QpKSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgVGFza1N0YXRlLlNVQ0NFU1M6XHJcbiAgICAgICAgICAgICAgICBpZiAob2JzZXJ2ZXIuY29tcGxldGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyhvYnNlcnZlci5jb21wbGV0ZS5iaW5kKG9ic2VydmVyKSkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFRhc2tTdGF0ZS5DQU5DRUxFRDpcclxuICAgICAgICAgICAgY2FzZSBUYXNrU3RhdGUuRVJST1I6XHJcbiAgICAgICAgICAgICAgICBpZiAob2JzZXJ2ZXIuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBhc3luYyhvYnNlcnZlci5lcnJvci5iaW5kKG9ic2VydmVyLCB0aGlzLl9lcnJvcikpKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIC8vIFRPRE8oYW5keXNvdG8pOiBhc3NlcnQoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9ic2VydmVyLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMob2JzZXJ2ZXIuZXJyb3IuYmluZChvYnNlcnZlciwgdGhpcy5fZXJyb3IpKSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVzdW1lcyBhIHBhdXNlZCB0YXNrLiBIYXMgbm8gZWZmZWN0IG9uIGEgY3VycmVudGx5IHJ1bm5pbmcgb3IgZmFpbGVkIHRhc2suXHJcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBvcGVyYXRpb24gdG9vayBlZmZlY3QsIGZhbHNlIGlmIGlnbm9yZWQuXHJcbiAgICAgKi9cclxuICAgIHJlc3VtZSgpIHtcclxuICAgICAgICBjb25zdCB2YWxpZCA9IHRoaXMuX3N0YXRlID09PSBcInBhdXNlZFwiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNFRCAqLyB8fFxyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9PT0gXCJwYXVzaW5nXCIgLyogSW50ZXJuYWxUYXNrU3RhdGUuUEFVU0lORyAqLztcclxuICAgICAgICBpZiAodmFsaWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbihcInJ1bm5pbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HICovKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbGlkO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBQYXVzZXMgYSBjdXJyZW50bHkgcnVubmluZyB0YXNrLiBIYXMgbm8gZWZmZWN0IG9uIGEgcGF1c2VkIG9yIGZhaWxlZCB0YXNrLlxyXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgb3BlcmF0aW9uIHRvb2sgZWZmZWN0LCBmYWxzZSBpZiBpZ25vcmVkLlxyXG4gICAgICovXHJcbiAgICBwYXVzZSgpIHtcclxuICAgICAgICBjb25zdCB2YWxpZCA9IHRoaXMuX3N0YXRlID09PSBcInJ1bm5pbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5SVU5OSU5HICovO1xyXG4gICAgICAgIGlmICh2YWxpZCkge1xyXG4gICAgICAgICAgICB0aGlzLl90cmFuc2l0aW9uKFwicGF1c2luZ1wiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNJTkcgKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsaWQ7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENhbmNlbHMgYSBjdXJyZW50bHkgcnVubmluZyBvciBwYXVzZWQgdGFzay4gSGFzIG5vIGVmZmVjdCBvbiBhIGNvbXBsZXRlIG9yXHJcbiAgICAgKiBmYWlsZWQgdGFzay5cclxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIG9wZXJhdGlvbiB0b29rIGVmZmVjdCwgZmFsc2UgaWYgaWdub3JlZC5cclxuICAgICAqL1xyXG4gICAgY2FuY2VsKCkge1xyXG4gICAgICAgIGNvbnN0IHZhbGlkID0gdGhpcy5fc3RhdGUgPT09IFwicnVubmluZ1wiIC8qIEludGVybmFsVGFza1N0YXRlLlJVTk5JTkcgKi8gfHxcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUgPT09IFwicGF1c2luZ1wiIC8qIEludGVybmFsVGFza1N0YXRlLlBBVVNJTkcgKi87XHJcbiAgICAgICAgaWYgKHZhbGlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb24oXCJjYW5jZWxpbmdcIiAvKiBJbnRlcm5hbFRhc2tTdGF0ZS5DQU5DRUxJTkcgKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmFsaWQ7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFByb3ZpZGVzIG1ldGhvZHMgdG8gaW50ZXJhY3Qgd2l0aCBhIGJ1Y2tldCBpbiB0aGUgRmlyZWJhc2UgU3RvcmFnZSBzZXJ2aWNlLlxyXG4gKiBAaW50ZXJuYWxcclxuICogQHBhcmFtIF9sb2NhdGlvbiAtIEFuIGZicy5sb2NhdGlvbiwgb3IgdGhlIFVSTCBhdFxyXG4gKiAgICAgd2hpY2ggdG8gYmFzZSB0aGlzIG9iamVjdCwgaW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgZm9ybXM6XHJcbiAqICAgICAgICAgZ3M6Ly88YnVja2V0Pi88b2JqZWN0LXBhdGg+XHJcbiAqICAgICAgICAgaHR0cFtzXTovL2ZpcmViYXNlc3RvcmFnZS5nb29nbGVhcGlzLmNvbS9cclxuICogICAgICAgICAgICAgICAgICAgICA8YXBpLXZlcnNpb24+L2IvPGJ1Y2tldD4vby88b2JqZWN0LXBhdGg+XHJcbiAqICAgICBBbnkgcXVlcnkgb3IgZnJhZ21lbnQgc3RyaW5ncyB3aWxsIGJlIGlnbm9yZWQgaW4gdGhlIGh0dHBbc11cclxuICogICAgIGZvcm1hdC4gSWYgbm8gdmFsdWUgaXMgcGFzc2VkLCB0aGUgc3RvcmFnZSBvYmplY3Qgd2lsbCB1c2UgYSBVUkwgYmFzZWQgb25cclxuICogICAgIHRoZSBwcm9qZWN0IElEIG9mIHRoZSBiYXNlIGZpcmViYXNlLkFwcCBpbnN0YW5jZS5cclxuICovXHJcbmNsYXNzIFJlZmVyZW5jZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihfc2VydmljZSwgbG9jYXRpb24pIHtcclxuICAgICAgICB0aGlzLl9zZXJ2aWNlID0gX3NlcnZpY2U7XHJcbiAgICAgICAgaWYgKGxvY2F0aW9uIGluc3RhbmNlb2YgTG9jYXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5fbG9jYXRpb24gPSBsb2NhdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2xvY2F0aW9uID0gTG9jYXRpb24ubWFrZUZyb21VcmwobG9jYXRpb24sIF9zZXJ2aWNlLmhvc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyB0aGUgVVJMIGZvciB0aGUgYnVja2V0IGFuZCBwYXRoIHRoaXMgb2JqZWN0IHJlZmVyZW5jZXMsXHJcbiAgICAgKiAgICAgaW4gdGhlIGZvcm0gZ3M6Ly88YnVja2V0Pi88b2JqZWN0LXBhdGg+XHJcbiAgICAgKiBAb3ZlcnJpZGVcclxuICAgICAqL1xyXG4gICAgdG9TdHJpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuICdnczovLycgKyB0aGlzLl9sb2NhdGlvbi5idWNrZXQgKyAnLycgKyB0aGlzLl9sb2NhdGlvbi5wYXRoO1xyXG4gICAgfVxyXG4gICAgX25ld1JlZihzZXJ2aWNlLCBsb2NhdGlvbikge1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVmZXJlbmNlKHNlcnZpY2UsIGxvY2F0aW9uKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQSByZWZlcmVuY2UgdG8gdGhlIHJvb3Qgb2YgdGhpcyBvYmplY3QncyBidWNrZXQuXHJcbiAgICAgKi9cclxuICAgIGdldCByb290KCkge1xyXG4gICAgICAgIGNvbnN0IGxvY2F0aW9uID0gbmV3IExvY2F0aW9uKHRoaXMuX2xvY2F0aW9uLmJ1Y2tldCwgJycpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9uZXdSZWYodGhpcy5fc2VydmljZSwgbG9jYXRpb24pO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgbmFtZSBvZiB0aGUgYnVja2V0IGNvbnRhaW5pbmcgdGhpcyByZWZlcmVuY2UncyBvYmplY3QuXHJcbiAgICAgKi9cclxuICAgIGdldCBidWNrZXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2F0aW9uLmJ1Y2tldDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVGhlIGZ1bGwgcGF0aCBvZiB0aGlzIG9iamVjdC5cclxuICAgICAqL1xyXG4gICAgZ2V0IGZ1bGxQYXRoKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9sb2NhdGlvbi5wYXRoO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgc2hvcnQgbmFtZSBvZiB0aGlzIG9iamVjdCwgd2hpY2ggaXMgdGhlIGxhc3QgY29tcG9uZW50IG9mIHRoZSBmdWxsIHBhdGguXHJcbiAgICAgKiBGb3IgZXhhbXBsZSwgaWYgZnVsbFBhdGggaXMgJ2Z1bGwvcGF0aC9pbWFnZS5wbmcnLCBuYW1lIGlzICdpbWFnZS5wbmcnLlxyXG4gICAgICovXHJcbiAgICBnZXQgbmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gbGFzdENvbXBvbmVudCh0aGlzLl9sb2NhdGlvbi5wYXRoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVGhlIGBTdG9yYWdlU2VydmljZWAgaW5zdGFuY2UgdGhpcyBgU3RvcmFnZVJlZmVyZW5jZWAgaXMgYXNzb2NpYXRlZCB3aXRoLlxyXG4gICAgICovXHJcbiAgICBnZXQgc3RvcmFnZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2VydmljZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQSBgU3RvcmFnZVJlZmVyZW5jZWAgcG9pbnRpbmcgdG8gdGhlIHBhcmVudCBsb2NhdGlvbiBvZiB0aGlzIGBTdG9yYWdlUmVmZXJlbmNlYCwgb3IgbnVsbCBpZlxyXG4gICAgICogdGhpcyByZWZlcmVuY2UgaXMgdGhlIHJvb3QuXHJcbiAgICAgKi9cclxuICAgIGdldCBwYXJlbnQoKSB7XHJcbiAgICAgICAgY29uc3QgbmV3UGF0aCA9IHBhcmVudCh0aGlzLl9sb2NhdGlvbi5wYXRoKTtcclxuICAgICAgICBpZiAobmV3UGF0aCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSBuZXcgTG9jYXRpb24odGhpcy5fbG9jYXRpb24uYnVja2V0LCBuZXdQYXRoKTtcclxuICAgICAgICByZXR1cm4gbmV3IFJlZmVyZW5jZSh0aGlzLl9zZXJ2aWNlLCBsb2NhdGlvbik7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gdG8gdGhyb3cgYW4gZXJyb3IgaW4gbWV0aG9kcyB0aGF0IGRvIG5vdCBhY2NlcHQgYSByb290IHJlZmVyZW5jZS5cclxuICAgICAqL1xyXG4gICAgX3Rocm93SWZSb290KG5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5fbG9jYXRpb24ucGF0aCA9PT0gJycpIHtcclxuICAgICAgICAgICAgdGhyb3cgaW52YWxpZFJvb3RPcGVyYXRpb24obmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBEb3dubG9hZCB0aGUgYnl0ZXMgYXQgdGhlIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBAcmV0dXJucyBBIFByb21pc2UgY29udGFpbmluZyB0aGUgZG93bmxvYWRlZCBieXRlcy5cclxuICovXHJcbmZ1bmN0aW9uIGdldEJ5dGVzSW50ZXJuYWwocmVmLCBtYXhEb3dubG9hZFNpemVCeXRlcykge1xyXG4gICAgcmVmLl90aHJvd0lmUm9vdCgnZ2V0Qnl0ZXMnKTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gZ2V0Qnl0ZXMkMShyZWYuc3RvcmFnZSwgcmVmLl9sb2NhdGlvbiwgbWF4RG93bmxvYWRTaXplQnl0ZXMpO1xyXG4gICAgcmV0dXJuIHJlZi5zdG9yYWdlXHJcbiAgICAgICAgLm1ha2VSZXF1ZXN0V2l0aFRva2VucyhyZXF1ZXN0SW5mbywgbmV3Qnl0ZXNDb25uZWN0aW9uKVxyXG4gICAgICAgIC50aGVuKGJ5dGVzID0+IG1heERvd25sb2FkU2l6ZUJ5dGVzICE9PSB1bmRlZmluZWRcclxuICAgICAgICA/IC8vIEdDUyBtYXkgbm90IGhvbm9yIHRoZSBSYW5nZSBoZWFkZXIgZm9yIHNtYWxsIGZpbGVzXHJcbiAgICAgICAgICAgIGJ5dGVzLnNsaWNlKDAsIG1heERvd25sb2FkU2l6ZUJ5dGVzKVxyXG4gICAgICAgIDogYnl0ZXMpO1xyXG59XHJcbi8qKlxyXG4gKiBEb3dubG9hZCB0aGUgYnl0ZXMgYXQgdGhlIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBAcmV0dXJucyBBIFByb21pc2UgY29udGFpbmluZyB0aGUgZG93bmxvYWRlZCBibG9iLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0QmxvYkludGVybmFsKHJlZiwgbWF4RG93bmxvYWRTaXplQnl0ZXMpIHtcclxuICAgIHJlZi5fdGhyb3dJZlJvb3QoJ2dldEJsb2InKTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gZ2V0Qnl0ZXMkMShyZWYuc3RvcmFnZSwgcmVmLl9sb2NhdGlvbiwgbWF4RG93bmxvYWRTaXplQnl0ZXMpO1xyXG4gICAgcmV0dXJuIHJlZi5zdG9yYWdlXHJcbiAgICAgICAgLm1ha2VSZXF1ZXN0V2l0aFRva2VucyhyZXF1ZXN0SW5mbywgbmV3QmxvYkNvbm5lY3Rpb24pXHJcbiAgICAgICAgLnRoZW4oYmxvYiA9PiBtYXhEb3dubG9hZFNpemVCeXRlcyAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgPyAvLyBHQ1MgbWF5IG5vdCBob25vciB0aGUgUmFuZ2UgaGVhZGVyIGZvciBzbWFsbCBmaWxlc1xyXG4gICAgICAgICAgICBibG9iLnNsaWNlKDAsIG1heERvd25sb2FkU2l6ZUJ5dGVzKVxyXG4gICAgICAgIDogYmxvYik7XHJcbn1cclxuLyoqXHJcbiAqIFVwbG9hZHMgZGF0YSB0byB0aGlzIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBUaGUgdXBsb2FkIGlzIG5vdCByZXN1bWFibGUuXHJcbiAqXHJcbiAqIEBwYXJhbSByZWYgLSBTdG9yYWdlUmVmZXJlbmNlIHdoZXJlIGRhdGEgc2hvdWxkIGJlIHVwbG9hZGVkLlxyXG4gKiBAcGFyYW0gZGF0YSAtIFRoZSBkYXRhIHRvIHVwbG9hZC5cclxuICogQHBhcmFtIG1ldGFkYXRhIC0gTWV0YWRhdGEgZm9yIHRoZSBuZXdseSB1cGxvYWRlZCBkYXRhLlxyXG4gKiBAcmV0dXJucyBBIFByb21pc2UgY29udGFpbmluZyBhbiBVcGxvYWRSZXN1bHRcclxuICovXHJcbmZ1bmN0aW9uIHVwbG9hZEJ5dGVzJDEocmVmLCBkYXRhLCBtZXRhZGF0YSkge1xyXG4gICAgcmVmLl90aHJvd0lmUm9vdCgndXBsb2FkQnl0ZXMnKTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gbXVsdGlwYXJ0VXBsb2FkKHJlZi5zdG9yYWdlLCByZWYuX2xvY2F0aW9uLCBnZXRNYXBwaW5ncygpLCBuZXcgRmJzQmxvYihkYXRhLCB0cnVlKSwgbWV0YWRhdGEpO1xyXG4gICAgcmV0dXJuIHJlZi5zdG9yYWdlXHJcbiAgICAgICAgLm1ha2VSZXF1ZXN0V2l0aFRva2VucyhyZXF1ZXN0SW5mbywgbmV3VGV4dENvbm5lY3Rpb24pXHJcbiAgICAgICAgLnRoZW4oZmluYWxNZXRhZGF0YSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbWV0YWRhdGE6IGZpbmFsTWV0YWRhdGEsXHJcbiAgICAgICAgICAgIHJlZlxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufVxyXG4vKipcclxuICogVXBsb2FkcyBkYXRhIHRvIHRoaXMgb2JqZWN0J3MgbG9jYXRpb24uXHJcbiAqIFRoZSB1cGxvYWQgY2FuIGJlIHBhdXNlZCBhbmQgcmVzdW1lZCwgYW5kIGV4cG9zZXMgcHJvZ3Jlc3MgdXBkYXRlcy5cclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0gcmVmIC0gU3RvcmFnZVJlZmVyZW5jZSB3aGVyZSBkYXRhIHNob3VsZCBiZSB1cGxvYWRlZC5cclxuICogQHBhcmFtIGRhdGEgLSBUaGUgZGF0YSB0byB1cGxvYWQuXHJcbiAqIEBwYXJhbSBtZXRhZGF0YSAtIE1ldGFkYXRhIGZvciB0aGUgbmV3bHkgdXBsb2FkZWQgZGF0YS5cclxuICogQHJldHVybnMgQW4gVXBsb2FkVGFza1xyXG4gKi9cclxuZnVuY3Rpb24gdXBsb2FkQnl0ZXNSZXN1bWFibGUkMShyZWYsIGRhdGEsIG1ldGFkYXRhKSB7XHJcbiAgICByZWYuX3Rocm93SWZSb290KCd1cGxvYWRCeXRlc1Jlc3VtYWJsZScpO1xyXG4gICAgcmV0dXJuIG5ldyBVcGxvYWRUYXNrKHJlZiwgbmV3IEZic0Jsb2IoZGF0YSksIG1ldGFkYXRhKTtcclxufVxyXG4vKipcclxuICogVXBsb2FkcyBhIHN0cmluZyB0byB0aGlzIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBUaGUgdXBsb2FkIGlzIG5vdCByZXN1bWFibGUuXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHJlZiAtIFN0b3JhZ2VSZWZlcmVuY2Ugd2hlcmUgc3RyaW5nIHNob3VsZCBiZSB1cGxvYWRlZC5cclxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHN0cmluZyB0byB1cGxvYWQuXHJcbiAqIEBwYXJhbSBmb3JtYXQgLSBUaGUgZm9ybWF0IG9mIHRoZSBzdHJpbmcgdG8gdXBsb2FkLlxyXG4gKiBAcGFyYW0gbWV0YWRhdGEgLSBNZXRhZGF0YSBmb3IgdGhlIG5ld2x5IHVwbG9hZGVkIHN0cmluZy5cclxuICogQHJldHVybnMgQSBQcm9taXNlIGNvbnRhaW5pbmcgYW4gVXBsb2FkUmVzdWx0XHJcbiAqL1xyXG5mdW5jdGlvbiB1cGxvYWRTdHJpbmckMShyZWYsIHZhbHVlLCBmb3JtYXQgPSBTdHJpbmdGb3JtYXQuUkFXLCBtZXRhZGF0YSkge1xyXG4gICAgcmVmLl90aHJvd0lmUm9vdCgndXBsb2FkU3RyaW5nJyk7XHJcbiAgICBjb25zdCBkYXRhID0gZGF0YUZyb21TdHJpbmcoZm9ybWF0LCB2YWx1ZSk7XHJcbiAgICBjb25zdCBtZXRhZGF0YUNsb25lID0gT2JqZWN0LmFzc2lnbih7fSwgbWV0YWRhdGEpO1xyXG4gICAgaWYgKG1ldGFkYXRhQ2xvbmVbJ2NvbnRlbnRUeXBlJ10gPT0gbnVsbCAmJiBkYXRhLmNvbnRlbnRUeXBlICE9IG51bGwpIHtcclxuICAgICAgICBtZXRhZGF0YUNsb25lWydjb250ZW50VHlwZSddID0gZGF0YS5jb250ZW50VHlwZTtcclxuICAgIH1cclxuICAgIHJldHVybiB1cGxvYWRCeXRlcyQxKHJlZiwgZGF0YS5kYXRhLCBtZXRhZGF0YUNsb25lKTtcclxufVxyXG4vKipcclxuICogTGlzdCBhbGwgaXRlbXMgKGZpbGVzKSBhbmQgcHJlZml4ZXMgKGZvbGRlcnMpIHVuZGVyIHRoaXMgc3RvcmFnZSByZWZlcmVuY2UuXHJcbiAqXHJcbiAqIFRoaXMgaXMgYSBoZWxwZXIgbWV0aG9kIGZvciBjYWxsaW5nIGxpc3QoKSByZXBlYXRlZGx5IHVudGlsIHRoZXJlIGFyZVxyXG4gKiBubyBtb3JlIHJlc3VsdHMuIFRoZSBkZWZhdWx0IHBhZ2luYXRpb24gc2l6ZSBpcyAxMDAwLlxyXG4gKlxyXG4gKiBOb3RlOiBUaGUgcmVzdWx0cyBtYXkgbm90IGJlIGNvbnNpc3RlbnQgaWYgb2JqZWN0cyBhcmUgY2hhbmdlZCB3aGlsZSB0aGlzXHJcbiAqIG9wZXJhdGlvbiBpcyBydW5uaW5nLlxyXG4gKlxyXG4gKiBXYXJuaW5nOiBsaXN0QWxsIG1heSBwb3RlbnRpYWxseSBjb25zdW1lIHRvbyBtYW55IHJlc291cmNlcyBpZiB0aGVyZSBhcmVcclxuICogdG9vIG1hbnkgcmVzdWx0cy5cclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0gcmVmIC0gU3RvcmFnZVJlZmVyZW5jZSB0byBnZXQgbGlzdCBmcm9tLlxyXG4gKlxyXG4gKiBAcmV0dXJucyBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIGFsbCB0aGUgaXRlbXMgYW5kIHByZWZpeGVzIHVuZGVyXHJcbiAqICAgICAgdGhlIGN1cnJlbnQgc3RvcmFnZSByZWZlcmVuY2UuIGBwcmVmaXhlc2AgY29udGFpbnMgcmVmZXJlbmNlcyB0b1xyXG4gKiAgICAgIHN1Yi1kaXJlY3RvcmllcyBhbmQgYGl0ZW1zYCBjb250YWlucyByZWZlcmVuY2VzIHRvIG9iamVjdHMgaW4gdGhpc1xyXG4gKiAgICAgIGZvbGRlci4gYG5leHRQYWdlVG9rZW5gIGlzIG5ldmVyIHJldHVybmVkLlxyXG4gKi9cclxuZnVuY3Rpb24gbGlzdEFsbCQxKHJlZikge1xyXG4gICAgY29uc3QgYWNjdW11bGF0b3IgPSB7XHJcbiAgICAgICAgcHJlZml4ZXM6IFtdLFxyXG4gICAgICAgIGl0ZW1zOiBbXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBsaXN0QWxsSGVscGVyKHJlZiwgYWNjdW11bGF0b3IpLnRoZW4oKCkgPT4gYWNjdW11bGF0b3IpO1xyXG59XHJcbi8qKlxyXG4gKiBTZXBhcmF0ZWQgZnJvbSBsaXN0QWxsIGJlY2F1c2UgYXN5bmMgZnVuY3Rpb25zIGNhbid0IHVzZSBcImFyZ3VtZW50c1wiLlxyXG4gKiBAcGFyYW0gcmVmXHJcbiAqIEBwYXJhbSBhY2N1bXVsYXRvclxyXG4gKiBAcGFyYW0gcGFnZVRva2VuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBsaXN0QWxsSGVscGVyKHJlZiwgYWNjdW11bGF0b3IsIHBhZ2VUb2tlbikge1xyXG4gICAgY29uc3Qgb3B0ID0ge1xyXG4gICAgICAgIC8vIG1heFJlc3VsdHMgaXMgMTAwMCBieSBkZWZhdWx0LlxyXG4gICAgICAgIHBhZ2VUb2tlblxyXG4gICAgfTtcclxuICAgIGNvbnN0IG5leHRQYWdlID0gYXdhaXQgbGlzdCQxKHJlZiwgb3B0KTtcclxuICAgIGFjY3VtdWxhdG9yLnByZWZpeGVzLnB1c2goLi4ubmV4dFBhZ2UucHJlZml4ZXMpO1xyXG4gICAgYWNjdW11bGF0b3IuaXRlbXMucHVzaCguLi5uZXh0UGFnZS5pdGVtcyk7XHJcbiAgICBpZiAobmV4dFBhZ2UubmV4dFBhZ2VUb2tlbiAhPSBudWxsKSB7XHJcbiAgICAgICAgYXdhaXQgbGlzdEFsbEhlbHBlcihyZWYsIGFjY3VtdWxhdG9yLCBuZXh0UGFnZS5uZXh0UGFnZVRva2VuKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogTGlzdCBpdGVtcyAoZmlsZXMpIGFuZCBwcmVmaXhlcyAoZm9sZGVycykgdW5kZXIgdGhpcyBzdG9yYWdlIHJlZmVyZW5jZS5cclxuICpcclxuICogTGlzdCBBUEkgaXMgb25seSBhdmFpbGFibGUgZm9yIEZpcmViYXNlIFJ1bGVzIFZlcnNpb24gMi5cclxuICpcclxuICogR0NTIGlzIGEga2V5LWJsb2Igc3RvcmUuIEZpcmViYXNlIFN0b3JhZ2UgaW1wb3NlcyB0aGUgc2VtYW50aWMgb2YgJy8nXHJcbiAqIGRlbGltaXRlZCBmb2xkZXIgc3RydWN0dXJlLlxyXG4gKiBSZWZlciB0byBHQ1MncyBMaXN0IEFQSSBpZiB5b3Ugd2FudCB0byBsZWFybiBtb3JlLlxyXG4gKlxyXG4gKiBUbyBhZGhlcmUgdG8gRmlyZWJhc2UgUnVsZXMncyBTZW1hbnRpY3MsIEZpcmViYXNlIFN0b3JhZ2UgZG9lcyBub3RcclxuICogc3VwcG9ydCBvYmplY3RzIHdob3NlIHBhdGhzIGVuZCB3aXRoIFwiL1wiIG9yIGNvbnRhaW4gdHdvIGNvbnNlY3V0aXZlXHJcbiAqIFwiL1wicy4gRmlyZWJhc2UgU3RvcmFnZSBMaXN0IEFQSSB3aWxsIGZpbHRlciB0aGVzZSB1bnN1cHBvcnRlZCBvYmplY3RzLlxyXG4gKiBsaXN0KCkgbWF5IGZhaWwgaWYgdGhlcmUgYXJlIHRvbyBtYW55IHVuc3VwcG9ydGVkIG9iamVjdHMgaW4gdGhlIGJ1Y2tldC5cclxuICogQHB1YmxpY1xyXG4gKlxyXG4gKiBAcGFyYW0gcmVmIC0gU3RvcmFnZVJlZmVyZW5jZSB0byBnZXQgbGlzdCBmcm9tLlxyXG4gKiBAcGFyYW0gb3B0aW9ucyAtIFNlZSBMaXN0T3B0aW9ucyBmb3IgZGV0YWlscy5cclxuICogQHJldHVybnMgQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgaXRlbXMgYW5kIHByZWZpeGVzLlxyXG4gKiAgICAgIGBwcmVmaXhlc2AgY29udGFpbnMgcmVmZXJlbmNlcyB0byBzdWItZm9sZGVycyBhbmQgYGl0ZW1zYFxyXG4gKiAgICAgIGNvbnRhaW5zIHJlZmVyZW5jZXMgdG8gb2JqZWN0cyBpbiB0aGlzIGZvbGRlci4gYG5leHRQYWdlVG9rZW5gXHJcbiAqICAgICAgY2FuIGJlIHVzZWQgdG8gZ2V0IHRoZSByZXN0IG9mIHRoZSByZXN1bHRzLlxyXG4gKi9cclxuZnVuY3Rpb24gbGlzdCQxKHJlZiwgb3B0aW9ucykge1xyXG4gICAgaWYgKG9wdGlvbnMgIT0gbnVsbCkge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXhSZXN1bHRzID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICB2YWxpZGF0ZU51bWJlcignb3B0aW9ucy5tYXhSZXN1bHRzJywgXHJcbiAgICAgICAgICAgIC8qIG1pblZhbHVlPSAqLyAxLCBcclxuICAgICAgICAgICAgLyogbWF4VmFsdWU9ICovIDEwMDAsIG9wdGlvbnMubWF4UmVzdWx0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3Qgb3AgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSBsaXN0JDIocmVmLnN0b3JhZ2UsIHJlZi5fbG9jYXRpb24sIFxyXG4gICAgLypkZWxpbWl0ZXI9ICovICcvJywgb3AucGFnZVRva2VuLCBvcC5tYXhSZXN1bHRzKTtcclxuICAgIHJldHVybiByZWYuc3RvcmFnZS5tYWtlUmVxdWVzdFdpdGhUb2tlbnMocmVxdWVzdEluZm8sIG5ld1RleHRDb25uZWN0aW9uKTtcclxufVxyXG4vKipcclxuICogQSBgUHJvbWlzZWAgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSBtZXRhZGF0YSBmb3IgdGhpcyBvYmplY3QuIElmIHRoaXNcclxuICogb2JqZWN0IGRvZXNuJ3QgZXhpc3Qgb3IgbWV0YWRhdGEgY2Fubm90IGJlIHJldHJlaXZlZCwgdGhlIHByb21pc2UgaXNcclxuICogcmVqZWN0ZWQuXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHJlZiAtIFN0b3JhZ2VSZWZlcmVuY2UgdG8gZ2V0IG1ldGFkYXRhIGZyb20uXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRNZXRhZGF0YSQxKHJlZikge1xyXG4gICAgcmVmLl90aHJvd0lmUm9vdCgnZ2V0TWV0YWRhdGEnKTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gZ2V0TWV0YWRhdGEkMihyZWYuc3RvcmFnZSwgcmVmLl9sb2NhdGlvbiwgZ2V0TWFwcGluZ3MoKSk7XHJcbiAgICByZXR1cm4gcmVmLnN0b3JhZ2UubWFrZVJlcXVlc3RXaXRoVG9rZW5zKHJlcXVlc3RJbmZvLCBuZXdUZXh0Q29ubmVjdGlvbik7XHJcbn1cclxuLyoqXHJcbiAqIFVwZGF0ZXMgdGhlIG1ldGFkYXRhIGZvciB0aGlzIG9iamVjdC5cclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0gcmVmIC0gU3RvcmFnZVJlZmVyZW5jZSB0byB1cGRhdGUgbWV0YWRhdGEgZm9yLlxyXG4gKiBAcGFyYW0gbWV0YWRhdGEgLSBUaGUgbmV3IG1ldGFkYXRhIGZvciB0aGUgb2JqZWN0LlxyXG4gKiAgICAgT25seSB2YWx1ZXMgdGhhdCBoYXZlIGJlZW4gZXhwbGljaXRseSBzZXQgd2lsbCBiZSBjaGFuZ2VkLiBFeHBsaWNpdGx5XHJcbiAqICAgICBzZXR0aW5nIGEgdmFsdWUgdG8gbnVsbCB3aWxsIHJlbW92ZSB0aGUgbWV0YWRhdGEuXHJcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXNcclxuICogICAgIHdpdGggdGhlIG5ldyBtZXRhZGF0YSBmb3IgdGhpcyBvYmplY3QuXHJcbiAqICAgICBTZWUgYGZpcmViYXNlU3RvcmFnZS5SZWZlcmVuY2UucHJvdG90eXBlLmdldE1ldGFkYXRhYFxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlTWV0YWRhdGEkMShyZWYsIG1ldGFkYXRhKSB7XHJcbiAgICByZWYuX3Rocm93SWZSb290KCd1cGRhdGVNZXRhZGF0YScpO1xyXG4gICAgY29uc3QgcmVxdWVzdEluZm8gPSB1cGRhdGVNZXRhZGF0YSQyKHJlZi5zdG9yYWdlLCByZWYuX2xvY2F0aW9uLCBtZXRhZGF0YSwgZ2V0TWFwcGluZ3MoKSk7XHJcbiAgICByZXR1cm4gcmVmLnN0b3JhZ2UubWFrZVJlcXVlc3RXaXRoVG9rZW5zKHJlcXVlc3RJbmZvLCBuZXdUZXh0Q29ubmVjdGlvbik7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgdGhlIGRvd25sb2FkIFVSTCBmb3IgdGhlIGdpdmVuIFJlZmVyZW5jZS5cclxuICogQHB1YmxpY1xyXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIHdpdGggdGhlIGRvd25sb2FkXHJcbiAqICAgICBVUkwgZm9yIHRoaXMgb2JqZWN0LlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0RG93bmxvYWRVUkwkMShyZWYpIHtcclxuICAgIHJlZi5fdGhyb3dJZlJvb3QoJ2dldERvd25sb2FkVVJMJyk7XHJcbiAgICBjb25zdCByZXF1ZXN0SW5mbyA9IGdldERvd25sb2FkVXJsKHJlZi5zdG9yYWdlLCByZWYuX2xvY2F0aW9uLCBnZXRNYXBwaW5ncygpKTtcclxuICAgIHJldHVybiByZWYuc3RvcmFnZVxyXG4gICAgICAgIC5tYWtlUmVxdWVzdFdpdGhUb2tlbnMocmVxdWVzdEluZm8sIG5ld1RleHRDb25uZWN0aW9uKVxyXG4gICAgICAgIC50aGVuKHVybCA9PiB7XHJcbiAgICAgICAgaWYgKHVybCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBub0Rvd25sb2FkVVJMKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1cmw7XHJcbiAgICB9KTtcclxufVxyXG4vKipcclxuICogRGVsZXRlcyB0aGUgb2JqZWN0IGF0IHRoaXMgbG9jYXRpb24uXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHJlZiAtIFN0b3JhZ2VSZWZlcmVuY2UgZm9yIG9iamVjdCB0byBkZWxldGUuXHJcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgaWYgdGhlIGRlbGV0aW9uIHN1Y2NlZWRzLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVsZXRlT2JqZWN0JDEocmVmKSB7XHJcbiAgICByZWYuX3Rocm93SWZSb290KCdkZWxldGVPYmplY3QnKTtcclxuICAgIGNvbnN0IHJlcXVlc3RJbmZvID0gZGVsZXRlT2JqZWN0JDIocmVmLnN0b3JhZ2UsIHJlZi5fbG9jYXRpb24pO1xyXG4gICAgcmV0dXJuIHJlZi5zdG9yYWdlLm1ha2VSZXF1ZXN0V2l0aFRva2VucyhyZXF1ZXN0SW5mbywgbmV3VGV4dENvbm5lY3Rpb24pO1xyXG59XHJcbi8qKlxyXG4gKiBSZXR1cm5zIHJlZmVyZW5jZSBmb3Igb2JqZWN0IG9idGFpbmVkIGJ5IGFwcGVuZGluZyBgY2hpbGRQYXRoYCB0byBgcmVmYC5cclxuICpcclxuICogQHBhcmFtIHJlZiAtIFN0b3JhZ2VSZWZlcmVuY2UgdG8gZ2V0IGNoaWxkIG9mLlxyXG4gKiBAcGFyYW0gY2hpbGRQYXRoIC0gQ2hpbGQgcGF0aCBmcm9tIHByb3ZpZGVkIHJlZi5cclxuICogQHJldHVybnMgQSByZWZlcmVuY2UgdG8gdGhlIG9iamVjdCBvYnRhaW5lZCBieVxyXG4gKiBhcHBlbmRpbmcgY2hpbGRQYXRoLCByZW1vdmluZyBhbnkgZHVwbGljYXRlLCBiZWdpbm5pbmcsIG9yIHRyYWlsaW5nXHJcbiAqIHNsYXNoZXMuXHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBfZ2V0Q2hpbGQkMShyZWYsIGNoaWxkUGF0aCkge1xyXG4gICAgY29uc3QgbmV3UGF0aCA9IGNoaWxkKHJlZi5fbG9jYXRpb24ucGF0aCwgY2hpbGRQYXRoKTtcclxuICAgIGNvbnN0IGxvY2F0aW9uID0gbmV3IExvY2F0aW9uKHJlZi5fbG9jYXRpb24uYnVja2V0LCBuZXdQYXRoKTtcclxuICAgIHJldHVybiBuZXcgUmVmZXJlbmNlKHJlZi5zdG9yYWdlLCBsb2NhdGlvbik7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gaXNVcmwocGF0aCkge1xyXG4gICAgcmV0dXJuIC9eW0EtWmEtel0rOlxcL1xcLy8udGVzdChwYXRoKTtcclxufVxyXG4vKipcclxuICogUmV0dXJucyBhIGZpcmViYXNlU3RvcmFnZS5SZWZlcmVuY2UgZm9yIHRoZSBnaXZlbiB1cmwuXHJcbiAqL1xyXG5mdW5jdGlvbiByZWZGcm9tVVJMKHNlcnZpY2UsIHVybCkge1xyXG4gICAgcmV0dXJuIG5ldyBSZWZlcmVuY2Uoc2VydmljZSwgdXJsKTtcclxufVxyXG4vKipcclxuICogUmV0dXJucyBhIGZpcmViYXNlU3RvcmFnZS5SZWZlcmVuY2UgZm9yIHRoZSBnaXZlbiBwYXRoIGluIHRoZSBkZWZhdWx0XHJcbiAqIGJ1Y2tldC5cclxuICovXHJcbmZ1bmN0aW9uIHJlZkZyb21QYXRoKHJlZiwgcGF0aCkge1xyXG4gICAgaWYgKHJlZiBpbnN0YW5jZW9mIEZpcmViYXNlU3RvcmFnZUltcGwpIHtcclxuICAgICAgICBjb25zdCBzZXJ2aWNlID0gcmVmO1xyXG4gICAgICAgIGlmIChzZXJ2aWNlLl9idWNrZXQgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBub0RlZmF1bHRCdWNrZXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgcmVmZXJlbmNlID0gbmV3IFJlZmVyZW5jZShzZXJ2aWNlLCBzZXJ2aWNlLl9idWNrZXQpO1xyXG4gICAgICAgIGlmIChwYXRoICE9IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlZkZyb21QYXRoKHJlZmVyZW5jZSwgcGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVmZXJlbmNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIHJlZiBpcyBhIFJlZmVyZW5jZVxyXG4gICAgICAgIGlmIChwYXRoICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXRDaGlsZCQxKHJlZiwgcGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVmO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZWYkMShzZXJ2aWNlT3JSZWYsIHBhdGhPclVybCkge1xyXG4gICAgaWYgKHBhdGhPclVybCAmJiBpc1VybChwYXRoT3JVcmwpKSB7XHJcbiAgICAgICAgaWYgKHNlcnZpY2VPclJlZiBpbnN0YW5jZW9mIEZpcmViYXNlU3RvcmFnZUltcGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlZkZyb21VUkwoc2VydmljZU9yUmVmLCBwYXRoT3JVcmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgaW52YWxpZEFyZ3VtZW50KCdUbyB1c2UgcmVmKHNlcnZpY2UsIHVybCksIHRoZSBmaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgU3RvcmFnZSBpbnN0YW5jZS4nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gcmVmRnJvbVBhdGgoc2VydmljZU9yUmVmLCBwYXRoT3JVcmwpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGV4dHJhY3RCdWNrZXQoaG9zdCwgY29uZmlnKSB7XHJcbiAgICBjb25zdCBidWNrZXRTdHJpbmcgPSBjb25maWcgPT09IG51bGwgfHwgY29uZmlnID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25maWdbQ09ORklHX1NUT1JBR0VfQlVDS0VUX0tFWV07XHJcbiAgICBpZiAoYnVja2V0U3RyaW5nID09IG51bGwpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHJldHVybiBMb2NhdGlvbi5tYWtlRnJvbUJ1Y2tldFNwZWMoYnVja2V0U3RyaW5nLCBob3N0KTtcclxufVxyXG5mdW5jdGlvbiBjb25uZWN0U3RvcmFnZUVtdWxhdG9yJDEoc3RvcmFnZSwgaG9zdCwgcG9ydCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBzdG9yYWdlLmhvc3QgPSBgJHtob3N0fToke3BvcnR9YDtcclxuICAgIHN0b3JhZ2UuX3Byb3RvY29sID0gJ2h0dHAnO1xyXG4gICAgY29uc3QgeyBtb2NrVXNlclRva2VuIH0gPSBvcHRpb25zO1xyXG4gICAgaWYgKG1vY2tVc2VyVG9rZW4pIHtcclxuICAgICAgICBzdG9yYWdlLl9vdmVycmlkZUF1dGhUb2tlbiA9XHJcbiAgICAgICAgICAgIHR5cGVvZiBtb2NrVXNlclRva2VuID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICAgICAgPyBtb2NrVXNlclRva2VuXHJcbiAgICAgICAgICAgICAgICA6IGNyZWF0ZU1vY2tVc2VyVG9rZW4obW9ja1VzZXJUb2tlbiwgc3RvcmFnZS5hcHAub3B0aW9ucy5wcm9qZWN0SWQpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBIHNlcnZpY2UgdGhhdCBwcm92aWRlcyBGaXJlYmFzZSBTdG9yYWdlIFJlZmVyZW5jZSBpbnN0YW5jZXMuXHJcbiAqIEBwYXJhbSBvcHRfdXJsIC0gZ3M6Ly8gdXJsIHRvIGEgY3VzdG9tIFN0b3JhZ2UgQnVja2V0XHJcbiAqXHJcbiAqIEBpbnRlcm5hbFxyXG4gKi9cclxuY2xhc3MgRmlyZWJhc2VTdG9yYWdlSW1wbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKlxyXG4gICAgICogRmlyZWJhc2VBcHAgYXNzb2NpYXRlZCB3aXRoIHRoaXMgU3RvcmFnZVNlcnZpY2UgaW5zdGFuY2UuXHJcbiAgICAgKi9cclxuICAgIGFwcCwgX2F1dGhQcm92aWRlciwgXHJcbiAgICAvKipcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBfYXBwQ2hlY2tQcm92aWRlciwgXHJcbiAgICAvKipcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBfdXJsLCBfZmlyZWJhc2VWZXJzaW9uKSB7XHJcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XHJcbiAgICAgICAgdGhpcy5fYXV0aFByb3ZpZGVyID0gX2F1dGhQcm92aWRlcjtcclxuICAgICAgICB0aGlzLl9hcHBDaGVja1Byb3ZpZGVyID0gX2FwcENoZWNrUHJvdmlkZXI7XHJcbiAgICAgICAgdGhpcy5fdXJsID0gX3VybDtcclxuICAgICAgICB0aGlzLl9maXJlYmFzZVZlcnNpb24gPSBfZmlyZWJhc2VWZXJzaW9uO1xyXG4gICAgICAgIHRoaXMuX2J1Y2tldCA9IG51bGw7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhpcyBzdHJpbmcgY2FuIGJlIGluIHRoZSBmb3JtYXRzOlxyXG4gICAgICAgICAqIC0gaG9zdFxyXG4gICAgICAgICAqIC0gaG9zdDpwb3J0XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5faG9zdCA9IERFRkFVTFRfSE9TVDtcclxuICAgICAgICB0aGlzLl9wcm90b2NvbCA9ICdodHRwcyc7XHJcbiAgICAgICAgdGhpcy5fYXBwSWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLl9tYXhPcGVyYXRpb25SZXRyeVRpbWUgPSBERUZBVUxUX01BWF9PUEVSQVRJT05fUkVUUllfVElNRTtcclxuICAgICAgICB0aGlzLl9tYXhVcGxvYWRSZXRyeVRpbWUgPSBERUZBVUxUX01BWF9VUExPQURfUkVUUllfVElNRTtcclxuICAgICAgICB0aGlzLl9yZXF1ZXN0cyA9IG5ldyBTZXQoKTtcclxuICAgICAgICBpZiAoX3VybCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1Y2tldCA9IExvY2F0aW9uLm1ha2VGcm9tQnVja2V0U3BlYyhfdXJsLCB0aGlzLl9ob3N0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1Y2tldCA9IGV4dHJhY3RCdWNrZXQodGhpcy5faG9zdCwgdGhpcy5hcHAub3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgaG9zdCBzdHJpbmcgZm9yIHRoaXMgc2VydmljZSwgaW4gdGhlIGZvcm0gb2YgYGhvc3RgIG9yXHJcbiAgICAgKiBgaG9zdDpwb3J0YC5cclxuICAgICAqL1xyXG4gICAgZ2V0IGhvc3QoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hvc3Q7XHJcbiAgICB9XHJcbiAgICBzZXQgaG9zdChob3N0KSB7XHJcbiAgICAgICAgdGhpcy5faG9zdCA9IGhvc3Q7XHJcbiAgICAgICAgaWYgKHRoaXMuX3VybCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1Y2tldCA9IExvY2F0aW9uLm1ha2VGcm9tQnVja2V0U3BlYyh0aGlzLl91cmwsIGhvc3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fYnVja2V0ID0gZXh0cmFjdEJ1Y2tldChob3N0LCB0aGlzLmFwcC5vcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRoZSBtYXhpbXVtIHRpbWUgdG8gcmV0cnkgdXBsb2FkcyBpbiBtaWxsaXNlY29uZHMuXHJcbiAgICAgKi9cclxuICAgIGdldCBtYXhVcGxvYWRSZXRyeVRpbWUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX21heFVwbG9hZFJldHJ5VGltZTtcclxuICAgIH1cclxuICAgIHNldCBtYXhVcGxvYWRSZXRyeVRpbWUodGltZSkge1xyXG4gICAgICAgIHZhbGlkYXRlTnVtYmVyKCd0aW1lJywgXHJcbiAgICAgICAgLyogbWluVmFsdWU9Ki8gMCwgXHJcbiAgICAgICAgLyogbWF4VmFsdWU9ICovIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwgdGltZSk7XHJcbiAgICAgICAgdGhpcy5fbWF4VXBsb2FkUmV0cnlUaW1lID0gdGltZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVGhlIG1heGltdW0gdGltZSB0byByZXRyeSBvcGVyYXRpb25zIG90aGVyIHRoYW4gdXBsb2FkcyBvciBkb3dubG9hZHMgaW5cclxuICAgICAqIG1pbGxpc2Vjb25kcy5cclxuICAgICAqL1xyXG4gICAgZ2V0IG1heE9wZXJhdGlvblJldHJ5VGltZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWF4T3BlcmF0aW9uUmV0cnlUaW1lO1xyXG4gICAgfVxyXG4gICAgc2V0IG1heE9wZXJhdGlvblJldHJ5VGltZSh0aW1lKSB7XHJcbiAgICAgICAgdmFsaWRhdGVOdW1iZXIoJ3RpbWUnLCBcclxuICAgICAgICAvKiBtaW5WYWx1ZT0qLyAwLCBcclxuICAgICAgICAvKiBtYXhWYWx1ZT0gKi8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCB0aW1lKTtcclxuICAgICAgICB0aGlzLl9tYXhPcGVyYXRpb25SZXRyeVRpbWUgPSB0aW1lO1xyXG4gICAgfVxyXG4gICAgYXN5bmMgX2dldEF1dGhUb2tlbigpIHtcclxuICAgICAgICBpZiAodGhpcy5fb3ZlcnJpZGVBdXRoVG9rZW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX292ZXJyaWRlQXV0aFRva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBhdXRoID0gdGhpcy5fYXV0aFByb3ZpZGVyLmdldEltbWVkaWF0ZSh7IG9wdGlvbmFsOiB0cnVlIH0pO1xyXG4gICAgICAgIGlmIChhdXRoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRva2VuRGF0YSA9IGF3YWl0IGF1dGguZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgaWYgKHRva2VuRGF0YSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRva2VuRGF0YS5hY2Nlc3NUb2tlbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGFzeW5jIF9nZXRBcHBDaGVja1Rva2VuKCkge1xyXG4gICAgICAgIGNvbnN0IGFwcENoZWNrID0gdGhpcy5fYXBwQ2hlY2tQcm92aWRlci5nZXRJbW1lZGlhdGUoeyBvcHRpb25hbDogdHJ1ZSB9KTtcclxuICAgICAgICBpZiAoYXBwQ2hlY2spIHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBwQ2hlY2suZ2V0VG9rZW4oKTtcclxuICAgICAgICAgICAgLy8gVE9ETzogV2hhdCBkbyB3ZSB3YW50IHRvIGRvIGlmIHRoZXJlIGlzIGFuIGVycm9yIGdldHRpbmcgdGhlIHRva2VuP1xyXG4gICAgICAgICAgICAvLyBDb250ZXh0OiBhcHBDaGVjay5nZXRUb2tlbigpIHdpbGwgbmV2ZXIgdGhyb3cgZXZlbiBpZiBhbiBlcnJvciBoYXBwZW5lZC4gSW4gdGhlIGVycm9yIGNhc2UsIGEgZHVtbXkgdG9rZW4gd2lsbCBiZVxyXG4gICAgICAgICAgICAvLyByZXR1cm5lZCBhbG9uZyB3aXRoIGFuIGVycm9yIGZpZWxkIGRlc2NyaWJpbmcgdGhlIGVycm9yLiBJbiBnZW5lcmFsLCB3ZSBzaG91bGRuJ3QgY2FyZSBhYm91dCB0aGUgZXJyb3IgY29uZGl0aW9uIGFuZCBqdXN0IHVzZVxyXG4gICAgICAgICAgICAvLyB0aGUgdG9rZW4gKGFjdHVhbCBvciBkdW1teSkgdG8gc2VuZCByZXF1ZXN0cy5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50b2tlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFN0b3AgcnVubmluZyByZXF1ZXN0cyBhbmQgcHJldmVudCBtb3JlIGZyb20gYmVpbmcgY3JlYXRlZC5cclxuICAgICAqL1xyXG4gICAgX2RlbGV0ZSgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2RlbGV0ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGVsZXRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLmZvckVhY2gocmVxdWVzdCA9PiByZXF1ZXN0LmNhbmNlbCgpKTtcclxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHMuY2xlYXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgbmV3IGZpcmViYXNlU3RvcmFnZS5SZWZlcmVuY2Ugb2JqZWN0IHJlZmVyZW5jaW5nIHRoaXMgU3RvcmFnZVNlcnZpY2VcclxuICAgICAqIGF0IHRoZSBnaXZlbiBMb2NhdGlvbi5cclxuICAgICAqL1xyXG4gICAgX21ha2VTdG9yYWdlUmVmZXJlbmNlKGxvYykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVmZXJlbmNlKHRoaXMsIGxvYyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSByZXF1ZXN0SW5mbyAtIEhUVFAgUmVxdWVzdEluZm8gb2JqZWN0XHJcbiAgICAgKiBAcGFyYW0gYXV0aFRva2VuIC0gRmlyZWJhc2UgYXV0aCB0b2tlblxyXG4gICAgICovXHJcbiAgICBfbWFrZVJlcXVlc3QocmVxdWVzdEluZm8sIHJlcXVlc3RGYWN0b3J5LCBhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4sIHJldHJ5ID0gdHJ1ZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5fZGVsZXRlZCkge1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gbWFrZVJlcXVlc3QocmVxdWVzdEluZm8sIHRoaXMuX2FwcElkLCBhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4sIHJlcXVlc3RGYWN0b3J5LCB0aGlzLl9maXJlYmFzZVZlcnNpb24sIHJldHJ5KTtcclxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHMuYWRkKHJlcXVlc3QpO1xyXG4gICAgICAgICAgICAvLyBSZXF1ZXN0IHJlbW92ZXMgaXRzZWxmIGZyb20gc2V0IHdoZW4gY29tcGxldGUuXHJcbiAgICAgICAgICAgIHJlcXVlc3QuZ2V0UHJvbWlzZSgpLnRoZW4oKCkgPT4gdGhpcy5fcmVxdWVzdHMuZGVsZXRlKHJlcXVlc3QpLCAoKSA9PiB0aGlzLl9yZXF1ZXN0cy5kZWxldGUocmVxdWVzdCkpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVxdWVzdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmFpbFJlcXVlc3QoYXBwRGVsZXRlZCgpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBtYWtlUmVxdWVzdFdpdGhUb2tlbnMocmVxdWVzdEluZm8sIHJlcXVlc3RGYWN0b3J5KSB7XHJcbiAgICAgICAgY29uc3QgW2F1dGhUb2tlbiwgYXBwQ2hlY2tUb2tlbl0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgICAgIHRoaXMuX2dldEF1dGhUb2tlbigpLFxyXG4gICAgICAgICAgICB0aGlzLl9nZXRBcHBDaGVja1Rva2VuKClcclxuICAgICAgICBdKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5fbWFrZVJlcXVlc3QocmVxdWVzdEluZm8sIHJlcXVlc3RGYWN0b3J5LCBhdXRoVG9rZW4sIGFwcENoZWNrVG9rZW4pLmdldFByb21pc2UoKTtcclxuICAgIH1cclxufVxuXG5jb25zdCBuYW1lID0gXCJAZmlyZWJhc2Uvc3RvcmFnZVwiO1xuY29uc3QgdmVyc2lvbiA9IFwiMC4xMC4xXCI7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBUeXBlIGNvbnN0YW50IGZvciBGaXJlYmFzZSBTdG9yYWdlLlxyXG4gKi9cclxuY29uc3QgU1RPUkFHRV9UWVBFID0gJ3N0b3JhZ2UnO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRG93bmxvYWRzIHRoZSBkYXRhIGF0IHRoZSBvYmplY3QncyBsb2NhdGlvbi4gUmV0dXJucyBhbiBlcnJvciBpZiB0aGUgb2JqZWN0XHJcbiAqIGlzIG5vdCBmb3VuZC5cclxuICpcclxuICogVG8gdXNlIHRoaXMgZnVuY3Rpb25hbGl0eSwgeW91IGhhdmUgdG8gd2hpdGVsaXN0IHlvdXIgYXBwJ3Mgb3JpZ2luIGluIHlvdXJcclxuICogQ2xvdWQgU3RvcmFnZSBidWNrZXQuIFNlZSBhbHNvXHJcbiAqIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9zdG9yYWdlL2RvY3MvY29uZmlndXJpbmctY29yc1xyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSByZWYgLSBTdG9yYWdlUmVmZXJlbmNlIHdoZXJlIGRhdGEgc2hvdWxkIGJlIGRvd25sb2FkZWQuXHJcbiAqIEBwYXJhbSBtYXhEb3dubG9hZFNpemVCeXRlcyAtIElmIHNldCwgdGhlIG1heGltdW0gYWxsb3dlZCBzaXplIGluIGJ5dGVzIHRvXHJcbiAqIHJldHJpZXZlLlxyXG4gKiBAcmV0dXJucyBBIFByb21pc2UgY29udGFpbmluZyB0aGUgb2JqZWN0J3MgYnl0ZXNcclxuICovXHJcbmZ1bmN0aW9uIGdldEJ5dGVzKHJlZiwgbWF4RG93bmxvYWRTaXplQnl0ZXMpIHtcclxuICAgIHJlZiA9IGdldE1vZHVsYXJJbnN0YW5jZShyZWYpO1xyXG4gICAgcmV0dXJuIGdldEJ5dGVzSW50ZXJuYWwocmVmLCBtYXhEb3dubG9hZFNpemVCeXRlcyk7XHJcbn1cclxuLyoqXHJcbiAqIFVwbG9hZHMgZGF0YSB0byB0aGlzIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBUaGUgdXBsb2FkIGlzIG5vdCByZXN1bWFibGUuXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHJlZiAtIHtAbGluayBTdG9yYWdlUmVmZXJlbmNlfSB3aGVyZSBkYXRhIHNob3VsZCBiZSB1cGxvYWRlZC5cclxuICogQHBhcmFtIGRhdGEgLSBUaGUgZGF0YSB0byB1cGxvYWQuXHJcbiAqIEBwYXJhbSBtZXRhZGF0YSAtIE1ldGFkYXRhIGZvciB0aGUgZGF0YSB0byB1cGxvYWQuXHJcbiAqIEByZXR1cm5zIEEgUHJvbWlzZSBjb250YWluaW5nIGFuIFVwbG9hZFJlc3VsdFxyXG4gKi9cclxuZnVuY3Rpb24gdXBsb2FkQnl0ZXMocmVmLCBkYXRhLCBtZXRhZGF0YSkge1xyXG4gICAgcmVmID0gZ2V0TW9kdWxhckluc3RhbmNlKHJlZik7XHJcbiAgICByZXR1cm4gdXBsb2FkQnl0ZXMkMShyZWYsIGRhdGEsIG1ldGFkYXRhKTtcclxufVxyXG4vKipcclxuICogVXBsb2FkcyBhIHN0cmluZyB0byB0aGlzIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBUaGUgdXBsb2FkIGlzIG5vdCByZXN1bWFibGUuXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHJlZiAtIHtAbGluayBTdG9yYWdlUmVmZXJlbmNlfSB3aGVyZSBzdHJpbmcgc2hvdWxkIGJlIHVwbG9hZGVkLlxyXG4gKiBAcGFyYW0gdmFsdWUgLSBUaGUgc3RyaW5nIHRvIHVwbG9hZC5cclxuICogQHBhcmFtIGZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIHN0cmluZyB0byB1cGxvYWQuXHJcbiAqIEBwYXJhbSBtZXRhZGF0YSAtIE1ldGFkYXRhIGZvciB0aGUgc3RyaW5nIHRvIHVwbG9hZC5cclxuICogQHJldHVybnMgQSBQcm9taXNlIGNvbnRhaW5pbmcgYW4gVXBsb2FkUmVzdWx0XHJcbiAqL1xyXG5mdW5jdGlvbiB1cGxvYWRTdHJpbmcocmVmLCB2YWx1ZSwgZm9ybWF0LCBtZXRhZGF0YSkge1xyXG4gICAgcmVmID0gZ2V0TW9kdWxhckluc3RhbmNlKHJlZik7XHJcbiAgICByZXR1cm4gdXBsb2FkU3RyaW5nJDEocmVmLCB2YWx1ZSwgZm9ybWF0LCBtZXRhZGF0YSk7XHJcbn1cclxuLyoqXHJcbiAqIFVwbG9hZHMgZGF0YSB0byB0aGlzIG9iamVjdCdzIGxvY2F0aW9uLlxyXG4gKiBUaGUgdXBsb2FkIGNhbiBiZSBwYXVzZWQgYW5kIHJlc3VtZWQsIGFuZCBleHBvc2VzIHByb2dyZXNzIHVwZGF0ZXMuXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHJlZiAtIHtAbGluayBTdG9yYWdlUmVmZXJlbmNlfSB3aGVyZSBkYXRhIHNob3VsZCBiZSB1cGxvYWRlZC5cclxuICogQHBhcmFtIGRhdGEgLSBUaGUgZGF0YSB0byB1cGxvYWQuXHJcbiAqIEBwYXJhbSBtZXRhZGF0YSAtIE1ldGFkYXRhIGZvciB0aGUgZGF0YSB0byB1cGxvYWQuXHJcbiAqIEByZXR1cm5zIEFuIFVwbG9hZFRhc2tcclxuICovXHJcbmZ1bmN0aW9uIHVwbG9hZEJ5dGVzUmVzdW1hYmxlKHJlZiwgZGF0YSwgbWV0YWRhdGEpIHtcclxuICAgIHJlZiA9IGdldE1vZHVsYXJJbnN0YW5jZShyZWYpO1xyXG4gICAgcmV0dXJuIHVwbG9hZEJ5dGVzUmVzdW1hYmxlJDEocmVmLCBkYXRhLCBtZXRhZGF0YSk7XHJcbn1cclxuLyoqXHJcbiAqIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgbWV0YWRhdGEgZm9yIHRoaXMgb2JqZWN0LiBJZiB0aGlzXHJcbiAqIG9iamVjdCBkb2Vzbid0IGV4aXN0IG9yIG1ldGFkYXRhIGNhbm5vdCBiZSByZXRyZWl2ZWQsIHRoZSBwcm9taXNlIGlzXHJcbiAqIHJlamVjdGVkLlxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSByZWYgLSB7QGxpbmsgU3RvcmFnZVJlZmVyZW5jZX0gdG8gZ2V0IG1ldGFkYXRhIGZyb20uXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRNZXRhZGF0YShyZWYpIHtcclxuICAgIHJlZiA9IGdldE1vZHVsYXJJbnN0YW5jZShyZWYpO1xyXG4gICAgcmV0dXJuIGdldE1ldGFkYXRhJDEocmVmKTtcclxufVxyXG4vKipcclxuICogVXBkYXRlcyB0aGUgbWV0YWRhdGEgZm9yIHRoaXMgb2JqZWN0LlxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSByZWYgLSB7QGxpbmsgU3RvcmFnZVJlZmVyZW5jZX0gdG8gdXBkYXRlIG1ldGFkYXRhIGZvci5cclxuICogQHBhcmFtIG1ldGFkYXRhIC0gVGhlIG5ldyBtZXRhZGF0YSBmb3IgdGhlIG9iamVjdC5cclxuICogICAgIE9ubHkgdmFsdWVzIHRoYXQgaGF2ZSBiZWVuIGV4cGxpY2l0bHkgc2V0IHdpbGwgYmUgY2hhbmdlZC4gRXhwbGljaXRseVxyXG4gKiAgICAgc2V0dGluZyBhIHZhbHVlIHRvIG51bGwgd2lsbCByZW1vdmUgdGhlIG1ldGFkYXRhLlxyXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIHdpdGggdGhlIG5ldyBtZXRhZGF0YSBmb3IgdGhpcyBvYmplY3QuXHJcbiAqL1xyXG5mdW5jdGlvbiB1cGRhdGVNZXRhZGF0YShyZWYsIG1ldGFkYXRhKSB7XHJcbiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTtcclxuICAgIHJldHVybiB1cGRhdGVNZXRhZGF0YSQxKHJlZiwgbWV0YWRhdGEpO1xyXG59XHJcbi8qKlxyXG4gKiBMaXN0IGl0ZW1zIChmaWxlcykgYW5kIHByZWZpeGVzIChmb2xkZXJzKSB1bmRlciB0aGlzIHN0b3JhZ2UgcmVmZXJlbmNlLlxyXG4gKlxyXG4gKiBMaXN0IEFQSSBpcyBvbmx5IGF2YWlsYWJsZSBmb3IgRmlyZWJhc2UgUnVsZXMgVmVyc2lvbiAyLlxyXG4gKlxyXG4gKiBHQ1MgaXMgYSBrZXktYmxvYiBzdG9yZS4gRmlyZWJhc2UgU3RvcmFnZSBpbXBvc2VzIHRoZSBzZW1hbnRpYyBvZiAnLydcclxuICogZGVsaW1pdGVkIGZvbGRlciBzdHJ1Y3R1cmUuXHJcbiAqIFJlZmVyIHRvIEdDUydzIExpc3QgQVBJIGlmIHlvdSB3YW50IHRvIGxlYXJuIG1vcmUuXHJcbiAqXHJcbiAqIFRvIGFkaGVyZSB0byBGaXJlYmFzZSBSdWxlcydzIFNlbWFudGljcywgRmlyZWJhc2UgU3RvcmFnZSBkb2VzIG5vdFxyXG4gKiBzdXBwb3J0IG9iamVjdHMgd2hvc2UgcGF0aHMgZW5kIHdpdGggXCIvXCIgb3IgY29udGFpbiB0d28gY29uc2VjdXRpdmVcclxuICogXCIvXCJzLiBGaXJlYmFzZSBTdG9yYWdlIExpc3QgQVBJIHdpbGwgZmlsdGVyIHRoZXNlIHVuc3VwcG9ydGVkIG9iamVjdHMuXHJcbiAqIGxpc3QoKSBtYXkgZmFpbCBpZiB0aGVyZSBhcmUgdG9vIG1hbnkgdW5zdXBwb3J0ZWQgb2JqZWN0cyBpbiB0aGUgYnVja2V0LlxyXG4gKiBAcHVibGljXHJcbiAqXHJcbiAqIEBwYXJhbSByZWYgLSB7QGxpbmsgU3RvcmFnZVJlZmVyZW5jZX0gdG8gZ2V0IGxpc3QgZnJvbS5cclxuICogQHBhcmFtIG9wdGlvbnMgLSBTZWUge0BsaW5rIExpc3RPcHRpb25zfSBmb3IgZGV0YWlscy5cclxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCByZXNvbHZlcyB3aXRoIHRoZSBpdGVtcyBhbmQgcHJlZml4ZXMuXHJcbiAqICAgICAgYHByZWZpeGVzYCBjb250YWlucyByZWZlcmVuY2VzIHRvIHN1Yi1mb2xkZXJzIGFuZCBgaXRlbXNgXHJcbiAqICAgICAgY29udGFpbnMgcmVmZXJlbmNlcyB0byBvYmplY3RzIGluIHRoaXMgZm9sZGVyLiBgbmV4dFBhZ2VUb2tlbmBcclxuICogICAgICBjYW4gYmUgdXNlZCB0byBnZXQgdGhlIHJlc3Qgb2YgdGhlIHJlc3VsdHMuXHJcbiAqL1xyXG5mdW5jdGlvbiBsaXN0KHJlZiwgb3B0aW9ucykge1xyXG4gICAgcmVmID0gZ2V0TW9kdWxhckluc3RhbmNlKHJlZik7XHJcbiAgICByZXR1cm4gbGlzdCQxKHJlZiwgb3B0aW9ucyk7XHJcbn1cclxuLyoqXHJcbiAqIExpc3QgYWxsIGl0ZW1zIChmaWxlcykgYW5kIHByZWZpeGVzIChmb2xkZXJzKSB1bmRlciB0aGlzIHN0b3JhZ2UgcmVmZXJlbmNlLlxyXG4gKlxyXG4gKiBUaGlzIGlzIGEgaGVscGVyIG1ldGhvZCBmb3IgY2FsbGluZyBsaXN0KCkgcmVwZWF0ZWRseSB1bnRpbCB0aGVyZSBhcmVcclxuICogbm8gbW9yZSByZXN1bHRzLiBUaGUgZGVmYXVsdCBwYWdpbmF0aW9uIHNpemUgaXMgMTAwMC5cclxuICpcclxuICogTm90ZTogVGhlIHJlc3VsdHMgbWF5IG5vdCBiZSBjb25zaXN0ZW50IGlmIG9iamVjdHMgYXJlIGNoYW5nZWQgd2hpbGUgdGhpc1xyXG4gKiBvcGVyYXRpb24gaXMgcnVubmluZy5cclxuICpcclxuICogV2FybmluZzogYGxpc3RBbGxgIG1heSBwb3RlbnRpYWxseSBjb25zdW1lIHRvbyBtYW55IHJlc291cmNlcyBpZiB0aGVyZSBhcmVcclxuICogdG9vIG1hbnkgcmVzdWx0cy5cclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0gcmVmIC0ge0BsaW5rIFN0b3JhZ2VSZWZlcmVuY2V9IHRvIGdldCBsaXN0IGZyb20uXHJcbiAqXHJcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgd2l0aCBhbGwgdGhlIGl0ZW1zIGFuZCBwcmVmaXhlcyB1bmRlclxyXG4gKiAgICAgIHRoZSBjdXJyZW50IHN0b3JhZ2UgcmVmZXJlbmNlLiBgcHJlZml4ZXNgIGNvbnRhaW5zIHJlZmVyZW5jZXMgdG9cclxuICogICAgICBzdWItZGlyZWN0b3JpZXMgYW5kIGBpdGVtc2AgY29udGFpbnMgcmVmZXJlbmNlcyB0byBvYmplY3RzIGluIHRoaXNcclxuICogICAgICBmb2xkZXIuIGBuZXh0UGFnZVRva2VuYCBpcyBuZXZlciByZXR1cm5lZC5cclxuICovXHJcbmZ1bmN0aW9uIGxpc3RBbGwocmVmKSB7XHJcbiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTtcclxuICAgIHJldHVybiBsaXN0QWxsJDEocmVmKTtcclxufVxyXG4vKipcclxuICogUmV0dXJucyB0aGUgZG93bmxvYWQgVVJMIGZvciB0aGUgZ2l2ZW4ge0BsaW5rIFN0b3JhZ2VSZWZlcmVuY2V9LlxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSByZWYgLSB7QGxpbmsgU3RvcmFnZVJlZmVyZW5jZX0gdG8gZ2V0IHRoZSBkb3dubG9hZCBVUkwgZm9yLlxyXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlc29sdmVzIHdpdGggdGhlIGRvd25sb2FkXHJcbiAqICAgICBVUkwgZm9yIHRoaXMgb2JqZWN0LlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0RG93bmxvYWRVUkwocmVmKSB7XHJcbiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTtcclxuICAgIHJldHVybiBnZXREb3dubG9hZFVSTCQxKHJlZik7XHJcbn1cclxuLyoqXHJcbiAqIERlbGV0ZXMgdGhlIG9iamVjdCBhdCB0aGlzIGxvY2F0aW9uLlxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSByZWYgLSB7QGxpbmsgU3RvcmFnZVJlZmVyZW5jZX0gZm9yIG9iamVjdCB0byBkZWxldGUuXHJcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgaWYgdGhlIGRlbGV0aW9uIHN1Y2NlZWRzLlxyXG4gKi9cclxuZnVuY3Rpb24gZGVsZXRlT2JqZWN0KHJlZikge1xyXG4gICAgcmVmID0gZ2V0TW9kdWxhckluc3RhbmNlKHJlZik7XHJcbiAgICByZXR1cm4gZGVsZXRlT2JqZWN0JDEocmVmKTtcclxufVxyXG5mdW5jdGlvbiByZWYoc2VydmljZU9yUmVmLCBwYXRoT3JVcmwpIHtcclxuICAgIHNlcnZpY2VPclJlZiA9IGdldE1vZHVsYXJJbnN0YW5jZShzZXJ2aWNlT3JSZWYpO1xyXG4gICAgcmV0dXJuIHJlZiQxKHNlcnZpY2VPclJlZiwgcGF0aE9yVXJsKTtcclxufVxyXG4vKipcclxuICogQGludGVybmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBfZ2V0Q2hpbGQocmVmLCBjaGlsZFBhdGgpIHtcclxuICAgIHJldHVybiBfZ2V0Q2hpbGQkMShyZWYsIGNoaWxkUGF0aCk7XHJcbn1cclxuLyoqXHJcbiAqIEdldHMgYSB7QGxpbmsgRmlyZWJhc2VTdG9yYWdlfSBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIEZpcmViYXNlIGFwcC5cclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0gYXBwIC0gRmlyZWJhc2UgYXBwIHRvIGdldCB7QGxpbmsgRmlyZWJhc2VTdG9yYWdlfSBpbnN0YW5jZSBmb3IuXHJcbiAqIEBwYXJhbSBidWNrZXRVcmwgLSBUaGUgZ3M6Ly8gdXJsIHRvIHlvdXIgRmlyZWJhc2UgU3RvcmFnZSBCdWNrZXQuXHJcbiAqIElmIG5vdCBwYXNzZWQsIHVzZXMgdGhlIGFwcCdzIGRlZmF1bHQgU3RvcmFnZSBCdWNrZXQuXHJcbiAqIEByZXR1cm5zIEEge0BsaW5rIEZpcmViYXNlU3RvcmFnZX0gaW5zdGFuY2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRTdG9yYWdlKGFwcCA9IGdldEFwcCgpLCBidWNrZXRVcmwpIHtcclxuICAgIGFwcCA9IGdldE1vZHVsYXJJbnN0YW5jZShhcHApO1xyXG4gICAgY29uc3Qgc3RvcmFnZVByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgU1RPUkFHRV9UWVBFKTtcclxuICAgIGNvbnN0IHN0b3JhZ2VJbnN0YW5jZSA9IHN0b3JhZ2VQcm92aWRlci5nZXRJbW1lZGlhdGUoe1xyXG4gICAgICAgIGlkZW50aWZpZXI6IGJ1Y2tldFVybFxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBlbXVsYXRvciA9IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCgnc3RvcmFnZScpO1xyXG4gICAgaWYgKGVtdWxhdG9yKSB7XHJcbiAgICAgICAgY29ubmVjdFN0b3JhZ2VFbXVsYXRvcihzdG9yYWdlSW5zdGFuY2UsIC4uLmVtdWxhdG9yKTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdG9yYWdlSW5zdGFuY2U7XHJcbn1cclxuLyoqXHJcbiAqIE1vZGlmeSB0aGlzIHtAbGluayBGaXJlYmFzZVN0b3JhZ2V9IGluc3RhbmNlIHRvIGNvbW11bmljYXRlIHdpdGggdGhlIENsb3VkIFN0b3JhZ2UgZW11bGF0b3IuXHJcbiAqXHJcbiAqIEBwYXJhbSBzdG9yYWdlIC0gVGhlIHtAbGluayBGaXJlYmFzZVN0b3JhZ2V9IGluc3RhbmNlXHJcbiAqIEBwYXJhbSBob3N0IC0gVGhlIGVtdWxhdG9yIGhvc3QgKGV4OiBsb2NhbGhvc3QpXHJcbiAqIEBwYXJhbSBwb3J0IC0gVGhlIGVtdWxhdG9yIHBvcnQgKGV4OiA1MDAxKVxyXG4gKiBAcGFyYW0gb3B0aW9ucyAtIEVtdWxhdG9yIG9wdGlvbnMuIGBvcHRpb25zLm1vY2tVc2VyVG9rZW5gIGlzIHRoZSBtb2NrIGF1dGhcclxuICogdG9rZW4gdG8gdXNlIGZvciB1bml0IHRlc3RpbmcgU2VjdXJpdHkgUnVsZXMuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGNvbm5lY3RTdG9yYWdlRW11bGF0b3Ioc3RvcmFnZSwgaG9zdCwgcG9ydCwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICBjb25uZWN0U3RvcmFnZUVtdWxhdG9yJDEoc3RvcmFnZSwgaG9zdCwgcG9ydCwgb3B0aW9ucyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIERvd25sb2FkcyB0aGUgZGF0YSBhdCB0aGUgb2JqZWN0J3MgbG9jYXRpb24uIFJldHVybnMgYW4gZXJyb3IgaWYgdGhlIG9iamVjdFxyXG4gKiBpcyBub3QgZm91bmQuXHJcbiAqXHJcbiAqIFRvIHVzZSB0aGlzIGZ1bmN0aW9uYWxpdHksIHlvdSBoYXZlIHRvIHdoaXRlbGlzdCB5b3VyIGFwcCdzIG9yaWdpbiBpbiB5b3VyXHJcbiAqIENsb3VkIFN0b3JhZ2UgYnVja2V0LiBTZWUgYWxzb1xyXG4gKiBodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vc3RvcmFnZS9kb2NzL2NvbmZpZ3VyaW5nLWNvcnNcclxuICpcclxuICogVGhpcyBBUEkgaXMgbm90IGF2YWlsYWJsZSBpbiBOb2RlLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSByZWYgLSBTdG9yYWdlUmVmZXJlbmNlIHdoZXJlIGRhdGEgc2hvdWxkIGJlIGRvd25sb2FkZWQuXHJcbiAqIEBwYXJhbSBtYXhEb3dubG9hZFNpemVCeXRlcyAtIElmIHNldCwgdGhlIG1heGltdW0gYWxsb3dlZCBzaXplIGluIGJ5dGVzIHRvXHJcbiAqIHJldHJpZXZlLlxyXG4gKiBAcmV0dXJucyBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIGEgQmxvYiBjb250YWluaW5nIHRoZSBvYmplY3QncyBieXRlc1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0QmxvYihyZWYsIG1heERvd25sb2FkU2l6ZUJ5dGVzKSB7XHJcbiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTtcclxuICAgIHJldHVybiBnZXRCbG9iSW50ZXJuYWwocmVmLCBtYXhEb3dubG9hZFNpemVCeXRlcyk7XHJcbn1cclxuLyoqXHJcbiAqIERvd25sb2FkcyB0aGUgZGF0YSBhdCB0aGUgb2JqZWN0J3MgbG9jYXRpb24uIFJhaXNlcyBhbiBlcnJvciBldmVudCBpZiB0aGVcclxuICogb2JqZWN0IGlzIG5vdCBmb3VuZC5cclxuICpcclxuICogVGhpcyBBUEkgaXMgb25seSBhdmFpbGFibGUgaW4gTm9kZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0gcmVmIC0gU3RvcmFnZVJlZmVyZW5jZSB3aGVyZSBkYXRhIHNob3VsZCBiZSBkb3dubG9hZGVkLlxyXG4gKiBAcGFyYW0gbWF4RG93bmxvYWRTaXplQnl0ZXMgLSBJZiBzZXQsIHRoZSBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBpbiBieXRlcyB0b1xyXG4gKiByZXRyaWV2ZS5cclxuICogQHJldHVybnMgQSBzdHJlYW0gd2l0aCB0aGUgb2JqZWN0J3MgZGF0YSBhcyBieXRlc1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0U3RyZWFtKHJlZiwgbWF4RG93bmxvYWRTaXplQnl0ZXMpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignZ2V0U3RyZWFtKCkgaXMgb25seSBzdXBwb3J0ZWQgYnkgTm9kZUpTIGJ1aWxkcycpO1xyXG59XG5cbi8qKlxyXG4gKiBDbG91ZCBTdG9yYWdlIGZvciBGaXJlYmFzZVxyXG4gKlxyXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cclxuICovXHJcbmZ1bmN0aW9uIGZhY3RvcnkoY29udGFpbmVyLCB7IGluc3RhbmNlSWRlbnRpZmllcjogdXJsIH0pIHtcclxuICAgIGNvbnN0IGFwcCA9IGNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICBjb25zdCBhdXRoUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2F1dGgtaW50ZXJuYWwnKTtcclxuICAgIGNvbnN0IGFwcENoZWNrUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcC1jaGVjay1pbnRlcm5hbCcpO1xyXG4gICAgcmV0dXJuIG5ldyBGaXJlYmFzZVN0b3JhZ2VJbXBsKGFwcCwgYXV0aFByb3ZpZGVyLCBhcHBDaGVja1Byb3ZpZGVyLCB1cmwsIFNES19WRVJTSU9OKTtcclxufVxyXG5mdW5jdGlvbiByZWdpc3RlclN0b3JhZ2UoKSB7XHJcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudChTVE9SQUdFX1RZUEUsIGZhY3RvcnksIFwiUFVCTElDXCIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pLnNldE11bHRpcGxlSW5zdGFuY2VzKHRydWUpKTtcclxuICAgIC8vUlVOVElNRV9FTlYgd2lsbCBiZSByZXBsYWNlZCBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uIHRvIFwibm9kZVwiIGZvciBub2RlanMgYW5kIGFuIGVtcHR5IHN0cmluZyBmb3IgYnJvd3NlclxyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24sICcnKTtcclxuICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uXHJcbiAgICByZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2VzbTIwMTcnKTtcclxufVxyXG5yZWdpc3RlclN0b3JhZ2UoKTtcblxuZXhwb3J0IHsgU3RyaW5nRm9ybWF0LCBGYnNCbG9iIGFzIF9GYnNCbG9iLCBMb2NhdGlvbiBhcyBfTG9jYXRpb24sIFRhc2tFdmVudCBhcyBfVGFza0V2ZW50LCBUYXNrU3RhdGUgYXMgX1Rhc2tTdGF0ZSwgVXBsb2FkVGFzayBhcyBfVXBsb2FkVGFzaywgZGF0YUZyb21TdHJpbmcgYXMgX2RhdGFGcm9tU3RyaW5nLCBfZ2V0Q2hpbGQsIGludmFsaWRBcmd1bWVudCBhcyBfaW52YWxpZEFyZ3VtZW50LCBpbnZhbGlkUm9vdE9wZXJhdGlvbiBhcyBfaW52YWxpZFJvb3RPcGVyYXRpb24sIGNvbm5lY3RTdG9yYWdlRW11bGF0b3IsIGRlbGV0ZU9iamVjdCwgZ2V0QmxvYiwgZ2V0Qnl0ZXMsIGdldERvd25sb2FkVVJMLCBnZXRNZXRhZGF0YSwgZ2V0U3RvcmFnZSwgZ2V0U3RyZWFtLCBsaXN0LCBsaXN0QWxsLCByZWYsIHVwZGF0ZU1ldGFkYXRhLCB1cGxvYWRCeXRlcywgdXBsb2FkQnl0ZXNSZXN1bWFibGUsIHVwbG9hZFN0cmluZyB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsImltcG9ydCB7IF9nZXRQcm92aWRlciwgZ2V0QXBwLCBfcmVnaXN0ZXJDb21wb25lbnQsIHJlZ2lzdGVyVmVyc2lvbiB9IGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnQGZpcmViYXNlL2NvbXBvbmVudCc7XG5pbXBvcnQgeyBFcnJvckZhY3RvcnksIEZpcmViYXNlRXJyb3IgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBvcGVuREIgfSBmcm9tICdpZGInO1xuXG5jb25zdCBuYW1lID0gXCJAZmlyZWJhc2UvaW5zdGFsbGF0aW9uc1wiO1xuY29uc3QgdmVyc2lvbiA9IFwiMC42LjFcIjtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUEVORElOR19USU1FT1VUX01TID0gMTAwMDA7XHJcbmNvbnN0IFBBQ0tBR0VfVkVSU0lPTiA9IGB3OiR7dmVyc2lvbn1gO1xyXG5jb25zdCBJTlRFUk5BTF9BVVRIX1ZFUlNJT04gPSAnRklTX3YyJztcclxuY29uc3QgSU5TVEFMTEFUSU9OU19BUElfVVJMID0gJ2h0dHBzOi8vZmlyZWJhc2VpbnN0YWxsYXRpb25zLmdvb2dsZWFwaXMuY29tL3YxJztcclxuY29uc3QgVE9LRU5fRVhQSVJBVElPTl9CVUZGRVIgPSA2MCAqIDYwICogMTAwMDsgLy8gT25lIGhvdXJcclxuY29uc3QgU0VSVklDRSA9ICdpbnN0YWxsYXRpb25zJztcclxuY29uc3QgU0VSVklDRV9OQU1FID0gJ0luc3RhbGxhdGlvbnMnO1xuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBFUlJPUl9ERVNDUklQVElPTl9NQVAgPSB7XHJcbiAgICBbXCJtaXNzaW5nLWFwcC1jb25maWctdmFsdWVzXCIgLyogRXJyb3JDb2RlLk1JU1NJTkdfQVBQX0NPTkZJR19WQUxVRVMgKi9dOiAnTWlzc2luZyBBcHAgY29uZmlndXJhdGlvbiB2YWx1ZTogXCJ7JHZhbHVlTmFtZX1cIicsXHJcbiAgICBbXCJub3QtcmVnaXN0ZXJlZFwiIC8qIEVycm9yQ29kZS5OT1RfUkVHSVNURVJFRCAqL106ICdGaXJlYmFzZSBJbnN0YWxsYXRpb24gaXMgbm90IHJlZ2lzdGVyZWQuJyxcclxuICAgIFtcImluc3RhbGxhdGlvbi1ub3QtZm91bmRcIiAvKiBFcnJvckNvZGUuSU5TVEFMTEFUSU9OX05PVF9GT1VORCAqL106ICdGaXJlYmFzZSBJbnN0YWxsYXRpb24gbm90IGZvdW5kLicsXHJcbiAgICBbXCJyZXF1ZXN0LWZhaWxlZFwiIC8qIEVycm9yQ29kZS5SRVFVRVNUX0ZBSUxFRCAqL106ICd7JHJlcXVlc3ROYW1lfSByZXF1ZXN0IGZhaWxlZCB3aXRoIGVycm9yIFwieyRzZXJ2ZXJDb2RlfSB7JHNlcnZlclN0YXR1c306IHskc2VydmVyTWVzc2FnZX1cIicsXHJcbiAgICBbXCJhcHAtb2ZmbGluZVwiIC8qIEVycm9yQ29kZS5BUFBfT0ZGTElORSAqL106ICdDb3VsZCBub3QgcHJvY2VzcyByZXF1ZXN0LiBBcHBsaWNhdGlvbiBvZmZsaW5lLicsXHJcbiAgICBbXCJkZWxldGUtcGVuZGluZy1yZWdpc3RyYXRpb25cIiAvKiBFcnJvckNvZGUuREVMRVRFX1BFTkRJTkdfUkVHSVNUUkFUSU9OICovXTogXCJDYW4ndCBkZWxldGUgaW5zdGFsbGF0aW9uIHdoaWxlIHRoZXJlIGlzIGEgcGVuZGluZyByZWdpc3RyYXRpb24gcmVxdWVzdC5cIlxyXG59O1xyXG5jb25zdCBFUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeShTRVJWSUNFLCBTRVJWSUNFX05BTUUsIEVSUk9SX0RFU0NSSVBUSU9OX01BUCk7XHJcbi8qKiBSZXR1cm5zIHRydWUgaWYgZXJyb3IgaXMgYSBGaXJlYmFzZUVycm9yIHRoYXQgaXMgYmFzZWQgb24gYW4gZXJyb3IgZnJvbSB0aGUgc2VydmVyLiAqL1xyXG5mdW5jdGlvbiBpc1NlcnZlckVycm9yKGVycm9yKSB7XHJcbiAgICByZXR1cm4gKGVycm9yIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvciAmJlxyXG4gICAgICAgIGVycm9yLmNvZGUuaW5jbHVkZXMoXCJyZXF1ZXN0LWZhaWxlZFwiIC8qIEVycm9yQ29kZS5SRVFVRVNUX0ZBSUxFRCAqLykpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGdldEluc3RhbGxhdGlvbnNFbmRwb2ludCh7IHByb2plY3RJZCB9KSB7XHJcbiAgICByZXR1cm4gYCR7SU5TVEFMTEFUSU9OU19BUElfVVJMfS9wcm9qZWN0cy8ke3Byb2plY3RJZH0vaW5zdGFsbGF0aW9uc2A7XHJcbn1cclxuZnVuY3Rpb24gZXh0cmFjdEF1dGhUb2tlbkluZm9Gcm9tUmVzcG9uc2UocmVzcG9uc2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdG9rZW46IHJlc3BvbnNlLnRva2VuLFxyXG4gICAgICAgIHJlcXVlc3RTdGF0dXM6IDIgLyogUmVxdWVzdFN0YXR1cy5DT01QTEVURUQgKi8sXHJcbiAgICAgICAgZXhwaXJlc0luOiBnZXRFeHBpcmVzSW5Gcm9tUmVzcG9uc2VFeHBpcmVzSW4ocmVzcG9uc2UuZXhwaXJlc0luKSxcclxuICAgICAgICBjcmVhdGlvblRpbWU6IERhdGUubm93KClcclxuICAgIH07XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZ2V0RXJyb3JGcm9tUmVzcG9uc2UocmVxdWVzdE5hbWUsIHJlc3BvbnNlKSB7XHJcbiAgICBjb25zdCByZXNwb25zZUpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICBjb25zdCBlcnJvckRhdGEgPSByZXNwb25zZUpzb24uZXJyb3I7XHJcbiAgICByZXR1cm4gRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJyZXF1ZXN0LWZhaWxlZFwiIC8qIEVycm9yQ29kZS5SRVFVRVNUX0ZBSUxFRCAqLywge1xyXG4gICAgICAgIHJlcXVlc3ROYW1lLFxyXG4gICAgICAgIHNlcnZlckNvZGU6IGVycm9yRGF0YS5jb2RlLFxyXG4gICAgICAgIHNlcnZlck1lc3NhZ2U6IGVycm9yRGF0YS5tZXNzYWdlLFxyXG4gICAgICAgIHNlcnZlclN0YXR1czogZXJyb3JEYXRhLnN0YXR1c1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0SGVhZGVycyh7IGFwaUtleSB9KSB7XHJcbiAgICByZXR1cm4gbmV3IEhlYWRlcnMoe1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgJ3gtZ29vZy1hcGkta2V5JzogYXBpS2V5XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBnZXRIZWFkZXJzV2l0aEF1dGgoYXBwQ29uZmlnLCB7IHJlZnJlc2hUb2tlbiB9KSB7XHJcbiAgICBjb25zdCBoZWFkZXJzID0gZ2V0SGVhZGVycyhhcHBDb25maWcpO1xyXG4gICAgaGVhZGVycy5hcHBlbmQoJ0F1dGhvcml6YXRpb24nLCBnZXRBdXRob3JpemF0aW9uSGVhZGVyKHJlZnJlc2hUb2tlbikpO1xyXG4gICAgcmV0dXJuIGhlYWRlcnM7XHJcbn1cclxuLyoqXHJcbiAqIENhbGxzIHRoZSBwYXNzZWQgaW4gZmV0Y2ggd3JhcHBlciBhbmQgcmV0dXJucyB0aGUgcmVzcG9uc2UuXHJcbiAqIElmIHRoZSByZXR1cm5lZCByZXNwb25zZSBoYXMgYSBzdGF0dXMgb2YgNXh4LCByZS1ydW5zIHRoZSBmdW5jdGlvbiBvbmNlIGFuZFxyXG4gKiByZXR1cm5zIHRoZSByZXNwb25zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJldHJ5SWZTZXJ2ZXJFcnJvcihmbikge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZm4oKTtcclxuICAgIGlmIChyZXN1bHQuc3RhdHVzID49IDUwMCAmJiByZXN1bHQuc3RhdHVzIDwgNjAwKSB7XHJcbiAgICAgICAgLy8gSW50ZXJuYWwgU2VydmVyIEVycm9yLiBSZXRyeSByZXF1ZXN0LlxyXG4gICAgICAgIHJldHVybiBmbigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5mdW5jdGlvbiBnZXRFeHBpcmVzSW5Gcm9tUmVzcG9uc2VFeHBpcmVzSW4ocmVzcG9uc2VFeHBpcmVzSW4pIHtcclxuICAgIC8vIFRoaXMgd29ya3MgYmVjYXVzZSB0aGUgc2VydmVyIHdpbGwgbmV2ZXIgcmVzcG9uZCB3aXRoIGZyYWN0aW9ucyBvZiBhIHNlY29uZC5cclxuICAgIHJldHVybiBOdW1iZXIocmVzcG9uc2VFeHBpcmVzSW4ucmVwbGFjZSgncycsICcwMDAnKSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QXV0aG9yaXphdGlvbkhlYWRlcihyZWZyZXNoVG9rZW4pIHtcclxuICAgIHJldHVybiBgJHtJTlRFUk5BTF9BVVRIX1ZFUlNJT059ICR7cmVmcmVzaFRva2VufWA7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlSW5zdGFsbGF0aW9uUmVxdWVzdCh7IGFwcENvbmZpZywgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyIH0sIHsgZmlkIH0pIHtcclxuICAgIGNvbnN0IGVuZHBvaW50ID0gZ2V0SW5zdGFsbGF0aW9uc0VuZHBvaW50KGFwcENvbmZpZyk7XHJcbiAgICBjb25zdCBoZWFkZXJzID0gZ2V0SGVhZGVycyhhcHBDb25maWcpO1xyXG4gICAgLy8gSWYgaGVhcnRiZWF0IHNlcnZpY2UgZXhpc3RzLCBhZGQgdGhlIGhlYXJ0YmVhdCBzdHJpbmcgdG8gdGhlIGhlYWRlci5cclxuICAgIGNvbnN0IGhlYXJ0YmVhdFNlcnZpY2UgPSBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIuZ2V0SW1tZWRpYXRlKHtcclxuICAgICAgICBvcHRpb25hbDogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBpZiAoaGVhcnRiZWF0U2VydmljZSkge1xyXG4gICAgICAgIGNvbnN0IGhlYXJ0YmVhdHNIZWFkZXIgPSBhd2FpdCBoZWFydGJlYXRTZXJ2aWNlLmdldEhlYXJ0YmVhdHNIZWFkZXIoKTtcclxuICAgICAgICBpZiAoaGVhcnRiZWF0c0hlYWRlcikge1xyXG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZCgneC1maXJlYmFzZS1jbGllbnQnLCBoZWFydGJlYXRzSGVhZGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgIGZpZCxcclxuICAgICAgICBhdXRoVmVyc2lvbjogSU5URVJOQUxfQVVUSF9WRVJTSU9OLFxyXG4gICAgICAgIGFwcElkOiBhcHBDb25maWcuYXBwSWQsXHJcbiAgICAgICAgc2RrVmVyc2lvbjogUEFDS0FHRV9WRVJTSU9OXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXRyeUlmU2VydmVyRXJyb3IoKCkgPT4gZmV0Y2goZW5kcG9pbnQsIHJlcXVlc3QpKTtcclxuICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlVmFsdWUgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJlZEluc3RhbGxhdGlvbkVudHJ5ID0ge1xyXG4gICAgICAgICAgICBmaWQ6IHJlc3BvbnNlVmFsdWUuZmlkIHx8IGZpZCxcclxuICAgICAgICAgICAgcmVnaXN0cmF0aW9uU3RhdHVzOiAyIC8qIFJlcXVlc3RTdGF0dXMuQ09NUExFVEVEICovLFxyXG4gICAgICAgICAgICByZWZyZXNoVG9rZW46IHJlc3BvbnNlVmFsdWUucmVmcmVzaFRva2VuLFxyXG4gICAgICAgICAgICBhdXRoVG9rZW46IGV4dHJhY3RBdXRoVG9rZW5JbmZvRnJvbVJlc3BvbnNlKHJlc3BvbnNlVmFsdWUuYXV0aFRva2VuKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHJlZ2lzdGVyZWRJbnN0YWxsYXRpb25FbnRyeTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHRocm93IGF3YWl0IGdldEVycm9yRnJvbVJlc3BvbnNlKCdDcmVhdGUgSW5zdGFsbGF0aW9uJywgcmVzcG9uc2UpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIGFmdGVyIGdpdmVuIHRpbWUgcGFzc2VzLiAqL1xyXG5mdW5jdGlvbiBzbGVlcChtcykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpO1xyXG4gICAgfSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gYnVmZmVyVG9CYXNlNjRVcmxTYWZlKGFycmF5KSB7XHJcbiAgICBjb25zdCBiNjQgPSBidG9hKFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYXJyYXkpKTtcclxuICAgIHJldHVybiBiNjQucmVwbGFjZSgvXFwrL2csICctJykucmVwbGFjZSgvXFwvL2csICdfJyk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgVkFMSURfRklEX1BBVFRFUk4gPSAvXltjZGVmXVtcXHctXXsyMX0kLztcclxuY29uc3QgSU5WQUxJRF9GSUQgPSAnJztcclxuLyoqXHJcbiAqIEdlbmVyYXRlcyBhIG5ldyBGSUQgdXNpbmcgcmFuZG9tIHZhbHVlcyBmcm9tIFdlYiBDcnlwdG8gQVBJLlxyXG4gKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBpZiBGSUQgZ2VuZXJhdGlvbiBmYWlscyBmb3IgYW55IHJlYXNvbi5cclxuICovXHJcbmZ1bmN0aW9uIGdlbmVyYXRlRmlkKCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBBIHZhbGlkIEZJRCBoYXMgZXhhY3RseSAyMiBiYXNlNjQgY2hhcmFjdGVycywgd2hpY2ggaXMgMTMyIGJpdHMsIG9yIDE2LjVcclxuICAgICAgICAvLyBieXRlcy4gb3VyIGltcGxlbWVudGF0aW9uIGdlbmVyYXRlcyBhIDE3IGJ5dGUgYXJyYXkgaW5zdGVhZC5cclxuICAgICAgICBjb25zdCBmaWRCeXRlQXJyYXkgPSBuZXcgVWludDhBcnJheSgxNyk7XHJcbiAgICAgICAgY29uc3QgY3J5cHRvID0gc2VsZi5jcnlwdG8gfHwgc2VsZi5tc0NyeXB0bztcclxuICAgICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGZpZEJ5dGVBcnJheSk7XHJcbiAgICAgICAgLy8gUmVwbGFjZSB0aGUgZmlyc3QgNCByYW5kb20gYml0cyB3aXRoIHRoZSBjb25zdGFudCBGSUQgaGVhZGVyIG9mIDBiMDExMS5cclxuICAgICAgICBmaWRCeXRlQXJyYXlbMF0gPSAwYjAxMTEwMDAwICsgKGZpZEJ5dGVBcnJheVswXSAlIDBiMDAwMTAwMDApO1xyXG4gICAgICAgIGNvbnN0IGZpZCA9IGVuY29kZShmaWRCeXRlQXJyYXkpO1xyXG4gICAgICAgIHJldHVybiBWQUxJRF9GSURfUEFUVEVSTi50ZXN0KGZpZCkgPyBmaWQgOiBJTlZBTElEX0ZJRDtcclxuICAgIH1cclxuICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgIC8vIEZJRCBnZW5lcmF0aW9uIGVycm9yZWRcclxuICAgICAgICByZXR1cm4gSU5WQUxJRF9GSUQ7XHJcbiAgICB9XHJcbn1cclxuLyoqIENvbnZlcnRzIGEgRklEIFVpbnQ4QXJyYXkgdG8gYSBiYXNlNjQgc3RyaW5nIHJlcHJlc2VudGF0aW9uLiAqL1xyXG5mdW5jdGlvbiBlbmNvZGUoZmlkQnl0ZUFycmF5KSB7XHJcbiAgICBjb25zdCBiNjRTdHJpbmcgPSBidWZmZXJUb0Jhc2U2NFVybFNhZmUoZmlkQnl0ZUFycmF5KTtcclxuICAgIC8vIFJlbW92ZSB0aGUgMjNyZCBjaGFyYWN0ZXIgdGhhdCB3YXMgYWRkZWQgYmVjYXVzZSBvZiB0aGUgZXh0cmEgNCBiaXRzIGF0IHRoZVxyXG4gICAgLy8gZW5kIG9mIG91ciAxNyBieXRlIGFycmF5LCBhbmQgdGhlICc9JyBwYWRkaW5nLlxyXG4gICAgcmV0dXJuIGI2NFN0cmluZy5zdWJzdHIoMCwgMjIpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKiBSZXR1cm5zIGEgc3RyaW5nIGtleSB0aGF0IGNhbiBiZSB1c2VkIHRvIGlkZW50aWZ5IHRoZSBhcHAuICovXHJcbmZ1bmN0aW9uIGdldEtleShhcHBDb25maWcpIHtcclxuICAgIHJldHVybiBgJHthcHBDb25maWcuYXBwTmFtZX0hJHthcHBDb25maWcuYXBwSWR9YDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBmaWRDaGFuZ2VDYWxsYmFja3MgPSBuZXcgTWFwKCk7XHJcbi8qKlxyXG4gKiBDYWxscyB0aGUgb25JZENoYW5nZSBjYWxsYmFja3Mgd2l0aCB0aGUgbmV3IEZJRCB2YWx1ZSwgYW5kIGJyb2FkY2FzdHMgdGhlXHJcbiAqIGNoYW5nZSB0byBvdGhlciB0YWJzLlxyXG4gKi9cclxuZnVuY3Rpb24gZmlkQ2hhbmdlZChhcHBDb25maWcsIGZpZCkge1xyXG4gICAgY29uc3Qga2V5ID0gZ2V0S2V5KGFwcENvbmZpZyk7XHJcbiAgICBjYWxsRmlkQ2hhbmdlQ2FsbGJhY2tzKGtleSwgZmlkKTtcclxuICAgIGJyb2FkY2FzdEZpZENoYW5nZShrZXksIGZpZCk7XHJcbn1cclxuZnVuY3Rpb24gYWRkQ2FsbGJhY2soYXBwQ29uZmlnLCBjYWxsYmFjaykge1xyXG4gICAgLy8gT3BlbiB0aGUgYnJvYWRjYXN0IGNoYW5uZWwgaWYgaXQncyBub3QgYWxyZWFkeSBvcGVuLFxyXG4gICAgLy8gdG8gYmUgYWJsZSB0byBsaXN0ZW4gdG8gY2hhbmdlIGV2ZW50cyBmcm9tIG90aGVyIHRhYnMuXHJcbiAgICBnZXRCcm9hZGNhc3RDaGFubmVsKCk7XHJcbiAgICBjb25zdCBrZXkgPSBnZXRLZXkoYXBwQ29uZmlnKTtcclxuICAgIGxldCBjYWxsYmFja1NldCA9IGZpZENoYW5nZUNhbGxiYWNrcy5nZXQoa2V5KTtcclxuICAgIGlmICghY2FsbGJhY2tTZXQpIHtcclxuICAgICAgICBjYWxsYmFja1NldCA9IG5ldyBTZXQoKTtcclxuICAgICAgICBmaWRDaGFuZ2VDYWxsYmFja3Muc2V0KGtleSwgY2FsbGJhY2tTZXQpO1xyXG4gICAgfVxyXG4gICAgY2FsbGJhY2tTZXQuYWRkKGNhbGxiYWNrKTtcclxufVxyXG5mdW5jdGlvbiByZW1vdmVDYWxsYmFjayhhcHBDb25maWcsIGNhbGxiYWNrKSB7XHJcbiAgICBjb25zdCBrZXkgPSBnZXRLZXkoYXBwQ29uZmlnKTtcclxuICAgIGNvbnN0IGNhbGxiYWNrU2V0ID0gZmlkQ2hhbmdlQ2FsbGJhY2tzLmdldChrZXkpO1xyXG4gICAgaWYgKCFjYWxsYmFja1NldCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNhbGxiYWNrU2V0LmRlbGV0ZShjYWxsYmFjayk7XHJcbiAgICBpZiAoY2FsbGJhY2tTZXQuc2l6ZSA9PT0gMCkge1xyXG4gICAgICAgIGZpZENoYW5nZUNhbGxiYWNrcy5kZWxldGUoa2V5KTtcclxuICAgIH1cclxuICAgIC8vIENsb3NlIGJyb2FkY2FzdCBjaGFubmVsIGlmIHRoZXJlIGFyZSBubyBtb3JlIGNhbGxiYWNrcy5cclxuICAgIGNsb3NlQnJvYWRjYXN0Q2hhbm5lbCgpO1xyXG59XHJcbmZ1bmN0aW9uIGNhbGxGaWRDaGFuZ2VDYWxsYmFja3Moa2V5LCBmaWQpIHtcclxuICAgIGNvbnN0IGNhbGxiYWNrcyA9IGZpZENoYW5nZUNhbGxiYWNrcy5nZXQoa2V5KTtcclxuICAgIGlmICghY2FsbGJhY2tzKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZm9yIChjb25zdCBjYWxsYmFjayBvZiBjYWxsYmFja3MpIHtcclxuICAgICAgICBjYWxsYmFjayhmaWQpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGJyb2FkY2FzdEZpZENoYW5nZShrZXksIGZpZCkge1xyXG4gICAgY29uc3QgY2hhbm5lbCA9IGdldEJyb2FkY2FzdENoYW5uZWwoKTtcclxuICAgIGlmIChjaGFubmVsKSB7XHJcbiAgICAgICAgY2hhbm5lbC5wb3N0TWVzc2FnZSh7IGtleSwgZmlkIH0pO1xyXG4gICAgfVxyXG4gICAgY2xvc2VCcm9hZGNhc3RDaGFubmVsKCk7XHJcbn1cclxubGV0IGJyb2FkY2FzdENoYW5uZWwgPSBudWxsO1xyXG4vKiogT3BlbnMgYW5kIHJldHVybnMgYSBCcm9hZGNhc3RDaGFubmVsIGlmIGl0IGlzIHN1cHBvcnRlZCBieSB0aGUgYnJvd3Nlci4gKi9cclxuZnVuY3Rpb24gZ2V0QnJvYWRjYXN0Q2hhbm5lbCgpIHtcclxuICAgIGlmICghYnJvYWRjYXN0Q2hhbm5lbCAmJiAnQnJvYWRjYXN0Q2hhbm5lbCcgaW4gc2VsZikge1xyXG4gICAgICAgIGJyb2FkY2FzdENoYW5uZWwgPSBuZXcgQnJvYWRjYXN0Q2hhbm5lbCgnW0ZpcmViYXNlXSBGSUQgQ2hhbmdlJyk7XHJcbiAgICAgICAgYnJvYWRjYXN0Q2hhbm5lbC5vbm1lc3NhZ2UgPSBlID0+IHtcclxuICAgICAgICAgICAgY2FsbEZpZENoYW5nZUNhbGxiYWNrcyhlLmRhdGEua2V5LCBlLmRhdGEuZmlkKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGJyb2FkY2FzdENoYW5uZWw7XHJcbn1cclxuZnVuY3Rpb24gY2xvc2VCcm9hZGNhc3RDaGFubmVsKCkge1xyXG4gICAgaWYgKGZpZENoYW5nZUNhbGxiYWNrcy5zaXplID09PSAwICYmIGJyb2FkY2FzdENoYW5uZWwpIHtcclxuICAgICAgICBicm9hZGNhc3RDaGFubmVsLmNsb3NlKCk7XHJcbiAgICAgICAgYnJvYWRjYXN0Q2hhbm5lbCA9IG51bGw7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgREFUQUJBU0VfTkFNRSA9ICdmaXJlYmFzZS1pbnN0YWxsYXRpb25zLWRhdGFiYXNlJztcclxuY29uc3QgREFUQUJBU0VfVkVSU0lPTiA9IDE7XHJcbmNvbnN0IE9CSkVDVF9TVE9SRV9OQU1FID0gJ2ZpcmViYXNlLWluc3RhbGxhdGlvbnMtc3RvcmUnO1xyXG5sZXQgZGJQcm9taXNlID0gbnVsbDtcclxuZnVuY3Rpb24gZ2V0RGJQcm9taXNlKCkge1xyXG4gICAgaWYgKCFkYlByb21pc2UpIHtcclxuICAgICAgICBkYlByb21pc2UgPSBvcGVuREIoREFUQUJBU0VfTkFNRSwgREFUQUJBU0VfVkVSU0lPTiwge1xyXG4gICAgICAgICAgICB1cGdyYWRlOiAoZGIsIG9sZFZlcnNpb24pID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHVzZSAnYnJlYWsnIGluIHRoaXMgc3dpdGNoIHN0YXRlbWVudCwgdGhlIGZhbGwtdGhyb3VnaFxyXG4gICAgICAgICAgICAgICAgLy8gYmVoYXZpb3IgaXMgd2hhdCB3ZSB3YW50LCBiZWNhdXNlIGlmIHRoZXJlIGFyZSBtdWx0aXBsZSB2ZXJzaW9ucyBiZXR3ZWVuXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgb2xkIHZlcnNpb24gYW5kIHRoZSBjdXJyZW50IHZlcnNpb24sIHdlIHdhbnQgQUxMIHRoZSBtaWdyYXRpb25zXHJcbiAgICAgICAgICAgICAgICAvLyB0aGF0IGNvcnJlc3BvbmQgdG8gdGhvc2UgdmVyc2lvbnMgdG8gcnVuLCBub3Qgb25seSB0aGUgbGFzdCBvbmUuXHJcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZGVmYXVsdC1jYXNlXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG9sZFZlcnNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKE9CSkVDVF9TVE9SRV9OQU1FKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRiUHJvbWlzZTtcclxufVxyXG4vKiogQXNzaWducyBvciBvdmVyd3JpdGVzIHRoZSByZWNvcmQgZm9yIHRoZSBnaXZlbiBrZXkgd2l0aCB0aGUgZ2l2ZW4gdmFsdWUuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHNldChhcHBDb25maWcsIHZhbHVlKSB7XHJcbiAgICBjb25zdCBrZXkgPSBnZXRLZXkoYXBwQ29uZmlnKTtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7XHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKE9CSkVDVF9TVE9SRV9OQU1FLCAncmVhZHdyaXRlJyk7XHJcbiAgICBjb25zdCBvYmplY3RTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKE9CSkVDVF9TVE9SRV9OQU1FKTtcclxuICAgIGNvbnN0IG9sZFZhbHVlID0gKGF3YWl0IG9iamVjdFN0b3JlLmdldChrZXkpKTtcclxuICAgIGF3YWl0IG9iamVjdFN0b3JlLnB1dCh2YWx1ZSwga2V5KTtcclxuICAgIGF3YWl0IHR4LmRvbmU7XHJcbiAgICBpZiAoIW9sZFZhbHVlIHx8IG9sZFZhbHVlLmZpZCAhPT0gdmFsdWUuZmlkKSB7XHJcbiAgICAgICAgZmlkQ2hhbmdlZChhcHBDb25maWcsIHZhbHVlLmZpZCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsdWU7XHJcbn1cclxuLyoqIFJlbW92ZXMgcmVjb3JkKHMpIGZyb20gdGhlIG9iamVjdFN0b3JlIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIGtleS4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlKGFwcENvbmZpZykge1xyXG4gICAgY29uc3Qga2V5ID0gZ2V0S2V5KGFwcENvbmZpZyk7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihPQkpFQ1RfU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgYXdhaXQgdHgub2JqZWN0U3RvcmUoT0JKRUNUX1NUT1JFX05BTUUpLmRlbGV0ZShrZXkpO1xyXG4gICAgYXdhaXQgdHguZG9uZTtcclxufVxyXG4vKipcclxuICogQXRvbWljYWxseSB1cGRhdGVzIGEgcmVjb3JkIHdpdGggdGhlIHJlc3VsdCBvZiB1cGRhdGVGbiwgd2hpY2ggZ2V0c1xyXG4gKiBjYWxsZWQgd2l0aCB0aGUgY3VycmVudCB2YWx1ZS4gSWYgbmV3VmFsdWUgaXMgdW5kZWZpbmVkLCB0aGUgcmVjb3JkIGlzXHJcbiAqIGRlbGV0ZWQgaW5zdGVhZC5cclxuICogQHJldHVybiBVcGRhdGVkIHZhbHVlXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGUoYXBwQ29uZmlnLCB1cGRhdGVGbikge1xyXG4gICAgY29uc3Qga2V5ID0gZ2V0S2V5KGFwcENvbmZpZyk7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihPQkpFQ1RfU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShPQkpFQ1RfU1RPUkVfTkFNRSk7XHJcbiAgICBjb25zdCBvbGRWYWx1ZSA9IChhd2FpdCBzdG9yZS5nZXQoa2V5KSk7XHJcbiAgICBjb25zdCBuZXdWYWx1ZSA9IHVwZGF0ZUZuKG9sZFZhbHVlKTtcclxuICAgIGlmIChuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgYXdhaXQgc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBhd2FpdCBzdG9yZS5wdXQobmV3VmFsdWUsIGtleSk7XHJcbiAgICB9XHJcbiAgICBhd2FpdCB0eC5kb25lO1xyXG4gICAgaWYgKG5ld1ZhbHVlICYmICghb2xkVmFsdWUgfHwgb2xkVmFsdWUuZmlkICE9PSBuZXdWYWx1ZS5maWQpKSB7XHJcbiAgICAgICAgZmlkQ2hhbmdlZChhcHBDb25maWcsIG5ld1ZhbHVlLmZpZCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3VmFsdWU7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFVwZGF0ZXMgYW5kIHJldHVybnMgdGhlIEluc3RhbGxhdGlvbkVudHJ5IGZyb20gdGhlIGRhdGFiYXNlLlxyXG4gKiBBbHNvIHRyaWdnZXJzIGEgcmVnaXN0cmF0aW9uIHJlcXVlc3QgaWYgaXQgaXMgbmVjZXNzYXJ5IGFuZCBwb3NzaWJsZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEluc3RhbGxhdGlvbkVudHJ5KGluc3RhbGxhdGlvbnMpIHtcclxuICAgIGxldCByZWdpc3RyYXRpb25Qcm9taXNlO1xyXG4gICAgY29uc3QgaW5zdGFsbGF0aW9uRW50cnkgPSBhd2FpdCB1cGRhdGUoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcsIG9sZEVudHJ5ID0+IHtcclxuICAgICAgICBjb25zdCBpbnN0YWxsYXRpb25FbnRyeSA9IHVwZGF0ZU9yQ3JlYXRlSW5zdGFsbGF0aW9uRW50cnkob2xkRW50cnkpO1xyXG4gICAgICAgIGNvbnN0IGVudHJ5V2l0aFByb21pc2UgPSB0cmlnZ2VyUmVnaXN0cmF0aW9uSWZOZWNlc3NhcnkoaW5zdGFsbGF0aW9ucywgaW5zdGFsbGF0aW9uRW50cnkpO1xyXG4gICAgICAgIHJlZ2lzdHJhdGlvblByb21pc2UgPSBlbnRyeVdpdGhQcm9taXNlLnJlZ2lzdHJhdGlvblByb21pc2U7XHJcbiAgICAgICAgcmV0dXJuIGVudHJ5V2l0aFByb21pc2UuaW5zdGFsbGF0aW9uRW50cnk7XHJcbiAgICB9KTtcclxuICAgIGlmIChpbnN0YWxsYXRpb25FbnRyeS5maWQgPT09IElOVkFMSURfRklEKSB7XHJcbiAgICAgICAgLy8gRklEIGdlbmVyYXRpb24gZmFpbGVkLiBXYWl0aW5nIGZvciB0aGUgRklEIGZyb20gdGhlIHNlcnZlci5cclxuICAgICAgICByZXR1cm4geyBpbnN0YWxsYXRpb25FbnRyeTogYXdhaXQgcmVnaXN0cmF0aW9uUHJvbWlzZSB9O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbnN0YWxsYXRpb25FbnRyeSxcclxuICAgICAgICByZWdpc3RyYXRpb25Qcm9taXNlXHJcbiAgICB9O1xyXG59XHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgbmV3IEluc3RhbGxhdGlvbiBFbnRyeSBpZiBvbmUgZG9lcyBub3QgZXhpc3QuXHJcbiAqIEFsc28gY2xlYXJzIHRpbWVkIG91dCBwZW5kaW5nIHJlcXVlc3RzLlxyXG4gKi9cclxuZnVuY3Rpb24gdXBkYXRlT3JDcmVhdGVJbnN0YWxsYXRpb25FbnRyeShvbGRFbnRyeSkge1xyXG4gICAgY29uc3QgZW50cnkgPSBvbGRFbnRyeSB8fCB7XHJcbiAgICAgICAgZmlkOiBnZW5lcmF0ZUZpZCgpLFxyXG4gICAgICAgIHJlZ2lzdHJhdGlvblN0YXR1czogMCAvKiBSZXF1ZXN0U3RhdHVzLk5PVF9TVEFSVEVEICovXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGNsZWFyVGltZWRPdXRSZXF1ZXN0KGVudHJ5KTtcclxufVxyXG4vKipcclxuICogSWYgdGhlIEZpcmViYXNlIEluc3RhbGxhdGlvbiBpcyBub3QgcmVnaXN0ZXJlZCB5ZXQsIHRoaXMgd2lsbCB0cmlnZ2VyIHRoZVxyXG4gKiByZWdpc3RyYXRpb24gYW5kIHJldHVybiBhbiBJblByb2dyZXNzSW5zdGFsbGF0aW9uRW50cnkuXHJcbiAqXHJcbiAqIElmIHJlZ2lzdHJhdGlvblByb21pc2UgZG9lcyBub3QgZXhpc3QsIHRoZSBpbnN0YWxsYXRpb25FbnRyeSBpcyBndWFyYW50ZWVkXHJcbiAqIHRvIGJlIHJlZ2lzdGVyZWQuXHJcbiAqL1xyXG5mdW5jdGlvbiB0cmlnZ2VyUmVnaXN0cmF0aW9uSWZOZWNlc3NhcnkoaW5zdGFsbGF0aW9ucywgaW5zdGFsbGF0aW9uRW50cnkpIHtcclxuICAgIGlmIChpbnN0YWxsYXRpb25FbnRyeS5yZWdpc3RyYXRpb25TdGF0dXMgPT09IDAgLyogUmVxdWVzdFN0YXR1cy5OT1RfU1RBUlRFRCAqLykge1xyXG4gICAgICAgIGlmICghbmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgICAgICAgICAvLyBSZWdpc3RyYXRpb24gcmVxdWlyZWQgYnV0IGFwcCBpcyBvZmZsaW5lLlxyXG4gICAgICAgICAgICBjb25zdCByZWdpc3RyYXRpb25Qcm9taXNlV2l0aEVycm9yID0gUHJvbWlzZS5yZWplY3QoRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJhcHAtb2ZmbGluZVwiIC8qIEVycm9yQ29kZS5BUFBfT0ZGTElORSAqLykpO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFsbGF0aW9uRW50cnksXHJcbiAgICAgICAgICAgICAgICByZWdpc3RyYXRpb25Qcm9taXNlOiByZWdpc3RyYXRpb25Qcm9taXNlV2l0aEVycm9yXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRyeSByZWdpc3RlcmluZy4gQ2hhbmdlIHN0YXR1cyB0byBJTl9QUk9HUkVTUy5cclxuICAgICAgICBjb25zdCBpblByb2dyZXNzRW50cnkgPSB7XHJcbiAgICAgICAgICAgIGZpZDogaW5zdGFsbGF0aW9uRW50cnkuZmlkLFxyXG4gICAgICAgICAgICByZWdpc3RyYXRpb25TdGF0dXM6IDEgLyogUmVxdWVzdFN0YXR1cy5JTl9QUk9HUkVTUyAqLyxcclxuICAgICAgICAgICAgcmVnaXN0cmF0aW9uVGltZTogRGF0ZS5ub3coKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uUHJvbWlzZSA9IHJlZ2lzdGVySW5zdGFsbGF0aW9uKGluc3RhbGxhdGlvbnMsIGluUHJvZ3Jlc3NFbnRyeSk7XHJcbiAgICAgICAgcmV0dXJuIHsgaW5zdGFsbGF0aW9uRW50cnk6IGluUHJvZ3Jlc3NFbnRyeSwgcmVnaXN0cmF0aW9uUHJvbWlzZSB9O1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoaW5zdGFsbGF0aW9uRW50cnkucmVnaXN0cmF0aW9uU3RhdHVzID09PSAxIC8qIFJlcXVlc3RTdGF0dXMuSU5fUFJPR1JFU1MgKi8pIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbnN0YWxsYXRpb25FbnRyeSxcclxuICAgICAgICAgICAgcmVnaXN0cmF0aW9uUHJvbWlzZTogd2FpdFVudGlsRmlkUmVnaXN0cmF0aW9uKGluc3RhbGxhdGlvbnMpXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB7IGluc3RhbGxhdGlvbkVudHJ5IH07XHJcbiAgICB9XHJcbn1cclxuLyoqIFRoaXMgd2lsbCBiZSBleGVjdXRlZCBvbmx5IG9uY2UgZm9yIGVhY2ggbmV3IEZpcmViYXNlIEluc3RhbGxhdGlvbi4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcmVnaXN0ZXJJbnN0YWxsYXRpb24oaW5zdGFsbGF0aW9ucywgaW5zdGFsbGF0aW9uRW50cnkpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJlZEluc3RhbGxhdGlvbkVudHJ5ID0gYXdhaXQgY3JlYXRlSW5zdGFsbGF0aW9uUmVxdWVzdChpbnN0YWxsYXRpb25zLCBpbnN0YWxsYXRpb25FbnRyeSk7XHJcbiAgICAgICAgcmV0dXJuIHNldChpbnN0YWxsYXRpb25zLmFwcENvbmZpZywgcmVnaXN0ZXJlZEluc3RhbGxhdGlvbkVudHJ5KTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgaWYgKGlzU2VydmVyRXJyb3IoZSkgJiYgZS5jdXN0b21EYXRhLnNlcnZlckNvZGUgPT09IDQwOSkge1xyXG4gICAgICAgICAgICAvLyBTZXJ2ZXIgcmV0dXJuZWQgYSBcIkZJRCBjYW4gbm90IGJlIHVzZWRcIiBlcnJvci5cclxuICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgSUQgbmV4dCB0aW1lLlxyXG4gICAgICAgICAgICBhd2FpdCByZW1vdmUoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gUmVnaXN0cmF0aW9uIGZhaWxlZC4gU2V0IEZJRCBhcyBub3QgcmVnaXN0ZXJlZC5cclxuICAgICAgICAgICAgYXdhaXQgc2V0KGluc3RhbGxhdGlvbnMuYXBwQ29uZmlnLCB7XHJcbiAgICAgICAgICAgICAgICBmaWQ6IGluc3RhbGxhdGlvbkVudHJ5LmZpZCxcclxuICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvblN0YXR1czogMCAvKiBSZXF1ZXN0U3RhdHVzLk5PVF9TVEFSVEVEICovXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBlO1xyXG4gICAgfVxyXG59XHJcbi8qKiBDYWxsIGlmIEZJRCByZWdpc3RyYXRpb24gaXMgcGVuZGluZyBpbiBhbm90aGVyIHJlcXVlc3QuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHdhaXRVbnRpbEZpZFJlZ2lzdHJhdGlvbihpbnN0YWxsYXRpb25zKSB7XHJcbiAgICAvLyBVbmZvcnR1bmF0ZWx5LCB0aGVyZSBpcyBubyB3YXkgb2YgcmVsaWFibHkgb2JzZXJ2aW5nIHdoZW4gYSB2YWx1ZSBpblxyXG4gICAgLy8gSW5kZXhlZERCIGNoYW5nZXMgKHlldCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9XSUNHL2luZGV4ZWQtZGItb2JzZXJ2ZXJzKSxcclxuICAgIC8vIHNvIHdlIG5lZWQgdG8gcG9sbC5cclxuICAgIGxldCBlbnRyeSA9IGF3YWl0IHVwZGF0ZUluc3RhbGxhdGlvblJlcXVlc3QoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcpO1xyXG4gICAgd2hpbGUgKGVudHJ5LnJlZ2lzdHJhdGlvblN0YXR1cyA9PT0gMSAvKiBSZXF1ZXN0U3RhdHVzLklOX1BST0dSRVNTICovKSB7XHJcbiAgICAgICAgLy8gY3JlYXRlSW5zdGFsbGF0aW9uIHJlcXVlc3Qgc3RpbGwgaW4gcHJvZ3Jlc3MuXHJcbiAgICAgICAgYXdhaXQgc2xlZXAoMTAwKTtcclxuICAgICAgICBlbnRyeSA9IGF3YWl0IHVwZGF0ZUluc3RhbGxhdGlvblJlcXVlc3QoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcpO1xyXG4gICAgfVxyXG4gICAgaWYgKGVudHJ5LnJlZ2lzdHJhdGlvblN0YXR1cyA9PT0gMCAvKiBSZXF1ZXN0U3RhdHVzLk5PVF9TVEFSVEVEICovKSB7XHJcbiAgICAgICAgLy8gVGhlIHJlcXVlc3QgdGltZWQgb3V0IG9yIGZhaWxlZCBpbiBhIGRpZmZlcmVudCBjYWxsLiBUcnkgYWdhaW4uXHJcbiAgICAgICAgY29uc3QgeyBpbnN0YWxsYXRpb25FbnRyeSwgcmVnaXN0cmF0aW9uUHJvbWlzZSB9ID0gYXdhaXQgZ2V0SW5zdGFsbGF0aW9uRW50cnkoaW5zdGFsbGF0aW9ucyk7XHJcbiAgICAgICAgaWYgKHJlZ2lzdHJhdGlvblByb21pc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJhdGlvblByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBubyByZWdpc3RyYXRpb25Qcm9taXNlLCBlbnRyeSBpcyByZWdpc3RlcmVkLlxyXG4gICAgICAgICAgICByZXR1cm4gaW5zdGFsbGF0aW9uRW50cnk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVudHJ5O1xyXG59XHJcbi8qKlxyXG4gKiBDYWxsZWQgb25seSBpZiB0aGVyZSBpcyBhIENyZWF0ZUluc3RhbGxhdGlvbiByZXF1ZXN0IGluIHByb2dyZXNzLlxyXG4gKlxyXG4gKiBVcGRhdGVzIHRoZSBJbnN0YWxsYXRpb25FbnRyeSBpbiB0aGUgREIgYmFzZWQgb24gdGhlIHN0YXR1cyBvZiB0aGVcclxuICogQ3JlYXRlSW5zdGFsbGF0aW9uIHJlcXVlc3QuXHJcbiAqXHJcbiAqIFJldHVybnMgdGhlIHVwZGF0ZWQgSW5zdGFsbGF0aW9uRW50cnkuXHJcbiAqL1xyXG5mdW5jdGlvbiB1cGRhdGVJbnN0YWxsYXRpb25SZXF1ZXN0KGFwcENvbmZpZykge1xyXG4gICAgcmV0dXJuIHVwZGF0ZShhcHBDb25maWcsIG9sZEVudHJ5ID0+IHtcclxuICAgICAgICBpZiAoIW9sZEVudHJ5KSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaW5zdGFsbGF0aW9uLW5vdC1mb3VuZFwiIC8qIEVycm9yQ29kZS5JTlNUQUxMQVRJT05fTk9UX0ZPVU5EICovKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNsZWFyVGltZWRPdXRSZXF1ZXN0KG9sZEVudHJ5KTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGNsZWFyVGltZWRPdXRSZXF1ZXN0KGVudHJ5KSB7XHJcbiAgICBpZiAoaGFzSW5zdGFsbGF0aW9uUmVxdWVzdFRpbWVkT3V0KGVudHJ5KSkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGZpZDogZW50cnkuZmlkLFxyXG4gICAgICAgICAgICByZWdpc3RyYXRpb25TdGF0dXM6IDAgLyogUmVxdWVzdFN0YXR1cy5OT1RfU1RBUlRFRCAqL1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZW50cnk7XHJcbn1cclxuZnVuY3Rpb24gaGFzSW5zdGFsbGF0aW9uUmVxdWVzdFRpbWVkT3V0KGluc3RhbGxhdGlvbkVudHJ5KSB7XHJcbiAgICByZXR1cm4gKGluc3RhbGxhdGlvbkVudHJ5LnJlZ2lzdHJhdGlvblN0YXR1cyA9PT0gMSAvKiBSZXF1ZXN0U3RhdHVzLklOX1BST0dSRVNTICovICYmXHJcbiAgICAgICAgaW5zdGFsbGF0aW9uRW50cnkucmVnaXN0cmF0aW9uVGltZSArIFBFTkRJTkdfVElNRU9VVF9NUyA8IERhdGUubm93KCkpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQXV0aFRva2VuUmVxdWVzdCh7IGFwcENvbmZpZywgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyIH0sIGluc3RhbGxhdGlvbkVudHJ5KSB7XHJcbiAgICBjb25zdCBlbmRwb2ludCA9IGdldEdlbmVyYXRlQXV0aFRva2VuRW5kcG9pbnQoYXBwQ29uZmlnLCBpbnN0YWxsYXRpb25FbnRyeSk7XHJcbiAgICBjb25zdCBoZWFkZXJzID0gZ2V0SGVhZGVyc1dpdGhBdXRoKGFwcENvbmZpZywgaW5zdGFsbGF0aW9uRW50cnkpO1xyXG4gICAgLy8gSWYgaGVhcnRiZWF0IHNlcnZpY2UgZXhpc3RzLCBhZGQgdGhlIGhlYXJ0YmVhdCBzdHJpbmcgdG8gdGhlIGhlYWRlci5cclxuICAgIGNvbnN0IGhlYXJ0YmVhdFNlcnZpY2UgPSBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIuZ2V0SW1tZWRpYXRlKHtcclxuICAgICAgICBvcHRpb25hbDogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBpZiAoaGVhcnRiZWF0U2VydmljZSkge1xyXG4gICAgICAgIGNvbnN0IGhlYXJ0YmVhdHNIZWFkZXIgPSBhd2FpdCBoZWFydGJlYXRTZXJ2aWNlLmdldEhlYXJ0YmVhdHNIZWFkZXIoKTtcclxuICAgICAgICBpZiAoaGVhcnRiZWF0c0hlYWRlcikge1xyXG4gICAgICAgICAgICBoZWFkZXJzLmFwcGVuZCgneC1maXJlYmFzZS1jbGllbnQnLCBoZWFydGJlYXRzSGVhZGVyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBib2R5ID0ge1xyXG4gICAgICAgIGluc3RhbGxhdGlvbjoge1xyXG4gICAgICAgICAgICBzZGtWZXJzaW9uOiBQQUNLQUdFX1ZFUlNJT04sXHJcbiAgICAgICAgICAgIGFwcElkOiBhcHBDb25maWcuYXBwSWRcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBoZWFkZXJzLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXRyeUlmU2VydmVyRXJyb3IoKCkgPT4gZmV0Y2goZW5kcG9pbnQsIHJlcXVlc3QpKTtcclxuICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlVmFsdWUgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgY29uc3QgY29tcGxldGVkQXV0aFRva2VuID0gZXh0cmFjdEF1dGhUb2tlbkluZm9Gcm9tUmVzcG9uc2UocmVzcG9uc2VWYWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIGNvbXBsZXRlZEF1dGhUb2tlbjtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHRocm93IGF3YWl0IGdldEVycm9yRnJvbVJlc3BvbnNlKCdHZW5lcmF0ZSBBdXRoIFRva2VuJywgcmVzcG9uc2UpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGdldEdlbmVyYXRlQXV0aFRva2VuRW5kcG9pbnQoYXBwQ29uZmlnLCB7IGZpZCB9KSB7XHJcbiAgICByZXR1cm4gYCR7Z2V0SW5zdGFsbGF0aW9uc0VuZHBvaW50KGFwcENvbmZpZyl9LyR7ZmlkfS9hdXRoVG9rZW5zOmdlbmVyYXRlYDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogUmV0dXJucyBhIHZhbGlkIGF1dGhlbnRpY2F0aW9uIHRva2VuIGZvciB0aGUgaW5zdGFsbGF0aW9uLiBHZW5lcmF0ZXMgYSBuZXdcclxuICogdG9rZW4gaWYgb25lIGRvZXNuJ3QgZXhpc3QsIGlzIGV4cGlyZWQgb3IgYWJvdXQgdG8gZXhwaXJlLlxyXG4gKlxyXG4gKiBTaG91bGQgb25seSBiZSBjYWxsZWQgaWYgdGhlIEZpcmViYXNlIEluc3RhbGxhdGlvbiBpcyByZWdpc3RlcmVkLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gcmVmcmVzaEF1dGhUb2tlbihpbnN0YWxsYXRpb25zLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkge1xyXG4gICAgbGV0IHRva2VuUHJvbWlzZTtcclxuICAgIGNvbnN0IGVudHJ5ID0gYXdhaXQgdXBkYXRlKGluc3RhbGxhdGlvbnMuYXBwQ29uZmlnLCBvbGRFbnRyeSA9PiB7XHJcbiAgICAgICAgaWYgKCFpc0VudHJ5UmVnaXN0ZXJlZChvbGRFbnRyeSkpIHtcclxuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJub3QtcmVnaXN0ZXJlZFwiIC8qIEVycm9yQ29kZS5OT1RfUkVHSVNURVJFRCAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IG9sZEF1dGhUb2tlbiA9IG9sZEVudHJ5LmF1dGhUb2tlbjtcclxuICAgICAgICBpZiAoIWZvcmNlUmVmcmVzaCAmJiBpc0F1dGhUb2tlblZhbGlkKG9sZEF1dGhUb2tlbikpIHtcclxuICAgICAgICAgICAgLy8gVGhlcmUgaXMgYSB2YWxpZCB0b2tlbiBpbiB0aGUgREIuXHJcbiAgICAgICAgICAgIHJldHVybiBvbGRFbnRyeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAob2xkQXV0aFRva2VuLnJlcXVlc3RTdGF0dXMgPT09IDEgLyogUmVxdWVzdFN0YXR1cy5JTl9QUk9HUkVTUyAqLykge1xyXG4gICAgICAgICAgICAvLyBUaGVyZSBhbHJlYWR5IGlzIGEgdG9rZW4gcmVxdWVzdCBpbiBwcm9ncmVzcy5cclxuICAgICAgICAgICAgdG9rZW5Qcm9taXNlID0gd2FpdFVudGlsQXV0aFRva2VuUmVxdWVzdChpbnN0YWxsYXRpb25zLCBmb3JjZVJlZnJlc2gpO1xyXG4gICAgICAgICAgICByZXR1cm4gb2xkRW50cnk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBObyB0b2tlbiBvciB0b2tlbiBleHBpcmVkLlxyXG4gICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiYXBwLW9mZmxpbmVcIiAvKiBFcnJvckNvZGUuQVBQX09GRkxJTkUgKi8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IGluUHJvZ3Jlc3NFbnRyeSA9IG1ha2VBdXRoVG9rZW5SZXF1ZXN0SW5Qcm9ncmVzc0VudHJ5KG9sZEVudHJ5KTtcclxuICAgICAgICAgICAgdG9rZW5Qcm9taXNlID0gZmV0Y2hBdXRoVG9rZW5Gcm9tU2VydmVyKGluc3RhbGxhdGlvbnMsIGluUHJvZ3Jlc3NFbnRyeSk7XHJcbiAgICAgICAgICAgIHJldHVybiBpblByb2dyZXNzRW50cnk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBjb25zdCBhdXRoVG9rZW4gPSB0b2tlblByb21pc2VcclxuICAgICAgICA/IGF3YWl0IHRva2VuUHJvbWlzZVxyXG4gICAgICAgIDogZW50cnkuYXV0aFRva2VuO1xyXG4gICAgcmV0dXJuIGF1dGhUb2tlbjtcclxufVxyXG4vKipcclxuICogQ2FsbCBvbmx5IGlmIEZJRCBpcyByZWdpc3RlcmVkIGFuZCBBdXRoIFRva2VuIHJlcXVlc3QgaXMgaW4gcHJvZ3Jlc3MuXHJcbiAqXHJcbiAqIFdhaXRzIHVudGlsIHRoZSBjdXJyZW50IHBlbmRpbmcgcmVxdWVzdCBmaW5pc2hlcy4gSWYgdGhlIHJlcXVlc3QgdGltZXMgb3V0LFxyXG4gKiB0cmllcyBvbmNlIGluIHRoaXMgdGhyZWFkIGFzIHdlbGwuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiB3YWl0VW50aWxBdXRoVG9rZW5SZXF1ZXN0KGluc3RhbGxhdGlvbnMsIGZvcmNlUmVmcmVzaCkge1xyXG4gICAgLy8gVW5mb3J0dW5hdGVseSwgdGhlcmUgaXMgbm8gd2F5IG9mIHJlbGlhYmx5IG9ic2VydmluZyB3aGVuIGEgdmFsdWUgaW5cclxuICAgIC8vIEluZGV4ZWREQiBjaGFuZ2VzICh5ZXQsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vV0lDRy9pbmRleGVkLWRiLW9ic2VydmVycyksXHJcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHBvbGwuXHJcbiAgICBsZXQgZW50cnkgPSBhd2FpdCB1cGRhdGVBdXRoVG9rZW5SZXF1ZXN0KGluc3RhbGxhdGlvbnMuYXBwQ29uZmlnKTtcclxuICAgIHdoaWxlIChlbnRyeS5hdXRoVG9rZW4ucmVxdWVzdFN0YXR1cyA9PT0gMSAvKiBSZXF1ZXN0U3RhdHVzLklOX1BST0dSRVNTICovKSB7XHJcbiAgICAgICAgLy8gZ2VuZXJhdGVBdXRoVG9rZW4gc3RpbGwgaW4gcHJvZ3Jlc3MuXHJcbiAgICAgICAgYXdhaXQgc2xlZXAoMTAwKTtcclxuICAgICAgICBlbnRyeSA9IGF3YWl0IHVwZGF0ZUF1dGhUb2tlblJlcXVlc3QoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgYXV0aFRva2VuID0gZW50cnkuYXV0aFRva2VuO1xyXG4gICAgaWYgKGF1dGhUb2tlbi5yZXF1ZXN0U3RhdHVzID09PSAwIC8qIFJlcXVlc3RTdGF0dXMuTk9UX1NUQVJURUQgKi8pIHtcclxuICAgICAgICAvLyBUaGUgcmVxdWVzdCB0aW1lZCBvdXQgb3IgZmFpbGVkIGluIGEgZGlmZmVyZW50IGNhbGwuIFRyeSBhZ2Fpbi5cclxuICAgICAgICByZXR1cm4gcmVmcmVzaEF1dGhUb2tlbihpbnN0YWxsYXRpb25zLCBmb3JjZVJlZnJlc2gpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGF1dGhUb2tlbjtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogQ2FsbGVkIG9ubHkgaWYgdGhlcmUgaXMgYSBHZW5lcmF0ZUF1dGhUb2tlbiByZXF1ZXN0IGluIHByb2dyZXNzLlxyXG4gKlxyXG4gKiBVcGRhdGVzIHRoZSBJbnN0YWxsYXRpb25FbnRyeSBpbiB0aGUgREIgYmFzZWQgb24gdGhlIHN0YXR1cyBvZiB0aGVcclxuICogR2VuZXJhdGVBdXRoVG9rZW4gcmVxdWVzdC5cclxuICpcclxuICogUmV0dXJucyB0aGUgdXBkYXRlZCBJbnN0YWxsYXRpb25FbnRyeS5cclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZUF1dGhUb2tlblJlcXVlc3QoYXBwQ29uZmlnKSB7XHJcbiAgICByZXR1cm4gdXBkYXRlKGFwcENvbmZpZywgb2xkRW50cnkgPT4ge1xyXG4gICAgICAgIGlmICghaXNFbnRyeVJlZ2lzdGVyZWQob2xkRW50cnkpKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm90LXJlZ2lzdGVyZWRcIiAvKiBFcnJvckNvZGUuTk9UX1JFR0lTVEVSRUQgKi8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvbGRBdXRoVG9rZW4gPSBvbGRFbnRyeS5hdXRoVG9rZW47XHJcbiAgICAgICAgaWYgKGhhc0F1dGhUb2tlblJlcXVlc3RUaW1lZE91dChvbGRBdXRoVG9rZW4pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9sZEVudHJ5KSwgeyBhdXRoVG9rZW46IHsgcmVxdWVzdFN0YXR1czogMCAvKiBSZXF1ZXN0U3RhdHVzLk5PVF9TVEFSVEVEICovIH0gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvbGRFbnRyeTtcclxuICAgIH0pO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIGZldGNoQXV0aFRva2VuRnJvbVNlcnZlcihpbnN0YWxsYXRpb25zLCBpbnN0YWxsYXRpb25FbnRyeSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBhdXRoVG9rZW4gPSBhd2FpdCBnZW5lcmF0ZUF1dGhUb2tlblJlcXVlc3QoaW5zdGFsbGF0aW9ucywgaW5zdGFsbGF0aW9uRW50cnkpO1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRJbnN0YWxsYXRpb25FbnRyeSA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgaW5zdGFsbGF0aW9uRW50cnkpLCB7IGF1dGhUb2tlbiB9KTtcclxuICAgICAgICBhd2FpdCBzZXQoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcsIHVwZGF0ZWRJbnN0YWxsYXRpb25FbnRyeSk7XHJcbiAgICAgICAgcmV0dXJuIGF1dGhUb2tlbjtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgaWYgKGlzU2VydmVyRXJyb3IoZSkgJiZcclxuICAgICAgICAgICAgKGUuY3VzdG9tRGF0YS5zZXJ2ZXJDb2RlID09PSA0MDEgfHwgZS5jdXN0b21EYXRhLnNlcnZlckNvZGUgPT09IDQwNCkpIHtcclxuICAgICAgICAgICAgLy8gU2VydmVyIHJldHVybmVkIGEgXCJGSUQgbm90IGZvdW5kXCIgb3IgYSBcIkludmFsaWQgYXV0aGVudGljYXRpb25cIiBlcnJvci5cclxuICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBuZXcgSUQgbmV4dCB0aW1lLlxyXG4gICAgICAgICAgICBhd2FpdCByZW1vdmUoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEluc3RhbGxhdGlvbkVudHJ5ID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBpbnN0YWxsYXRpb25FbnRyeSksIHsgYXV0aFRva2VuOiB7IHJlcXVlc3RTdGF0dXM6IDAgLyogUmVxdWVzdFN0YXR1cy5OT1RfU1RBUlRFRCAqLyB9IH0pO1xyXG4gICAgICAgICAgICBhd2FpdCBzZXQoaW5zdGFsbGF0aW9ucy5hcHBDb25maWcsIHVwZGF0ZWRJbnN0YWxsYXRpb25FbnRyeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gaXNFbnRyeVJlZ2lzdGVyZWQoaW5zdGFsbGF0aW9uRW50cnkpIHtcclxuICAgIHJldHVybiAoaW5zdGFsbGF0aW9uRW50cnkgIT09IHVuZGVmaW5lZCAmJlxyXG4gICAgICAgIGluc3RhbGxhdGlvbkVudHJ5LnJlZ2lzdHJhdGlvblN0YXR1cyA9PT0gMiAvKiBSZXF1ZXN0U3RhdHVzLkNPTVBMRVRFRCAqLyk7XHJcbn1cclxuZnVuY3Rpb24gaXNBdXRoVG9rZW5WYWxpZChhdXRoVG9rZW4pIHtcclxuICAgIHJldHVybiAoYXV0aFRva2VuLnJlcXVlc3RTdGF0dXMgPT09IDIgLyogUmVxdWVzdFN0YXR1cy5DT01QTEVURUQgKi8gJiZcclxuICAgICAgICAhaXNBdXRoVG9rZW5FeHBpcmVkKGF1dGhUb2tlbikpO1xyXG59XHJcbmZ1bmN0aW9uIGlzQXV0aFRva2VuRXhwaXJlZChhdXRoVG9rZW4pIHtcclxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XHJcbiAgICByZXR1cm4gKG5vdyA8IGF1dGhUb2tlbi5jcmVhdGlvblRpbWUgfHxcclxuICAgICAgICBhdXRoVG9rZW4uY3JlYXRpb25UaW1lICsgYXV0aFRva2VuLmV4cGlyZXNJbiA8IG5vdyArIFRPS0VOX0VYUElSQVRJT05fQlVGRkVSKTtcclxufVxyXG4vKiogUmV0dXJucyBhbiB1cGRhdGVkIEluc3RhbGxhdGlvbkVudHJ5IHdpdGggYW4gSW5Qcm9ncmVzc0F1dGhUb2tlbi4gKi9cclxuZnVuY3Rpb24gbWFrZUF1dGhUb2tlblJlcXVlc3RJblByb2dyZXNzRW50cnkob2xkRW50cnkpIHtcclxuICAgIGNvbnN0IGluUHJvZ3Jlc3NBdXRoVG9rZW4gPSB7XHJcbiAgICAgICAgcmVxdWVzdFN0YXR1czogMSAvKiBSZXF1ZXN0U3RhdHVzLklOX1BST0dSRVNTICovLFxyXG4gICAgICAgIHJlcXVlc3RUaW1lOiBEYXRlLm5vdygpXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgb2xkRW50cnkpLCB7IGF1dGhUb2tlbjogaW5Qcm9ncmVzc0F1dGhUb2tlbiB9KTtcclxufVxyXG5mdW5jdGlvbiBoYXNBdXRoVG9rZW5SZXF1ZXN0VGltZWRPdXQoYXV0aFRva2VuKSB7XHJcbiAgICByZXR1cm4gKGF1dGhUb2tlbi5yZXF1ZXN0U3RhdHVzID09PSAxIC8qIFJlcXVlc3RTdGF0dXMuSU5fUFJPR1JFU1MgKi8gJiZcclxuICAgICAgICBhdXRoVG9rZW4ucmVxdWVzdFRpbWUgKyBQRU5ESU5HX1RJTUVPVVRfTVMgPCBEYXRlLm5vdygpKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogQ3JlYXRlcyBhIEZpcmViYXNlIEluc3RhbGxhdGlvbiBpZiB0aGVyZSBpc24ndCBvbmUgZm9yIHRoZSBhcHAgYW5kXHJcbiAqIHJldHVybnMgdGhlIEluc3RhbGxhdGlvbiBJRC5cclxuICogQHBhcmFtIGluc3RhbGxhdGlvbnMgLSBUaGUgYEluc3RhbGxhdGlvbnNgIGluc3RhbmNlLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRJZChpbnN0YWxsYXRpb25zKSB7XHJcbiAgICBjb25zdCBpbnN0YWxsYXRpb25zSW1wbCA9IGluc3RhbGxhdGlvbnM7XHJcbiAgICBjb25zdCB7IGluc3RhbGxhdGlvbkVudHJ5LCByZWdpc3RyYXRpb25Qcm9taXNlIH0gPSBhd2FpdCBnZXRJbnN0YWxsYXRpb25FbnRyeShpbnN0YWxsYXRpb25zSW1wbCk7XHJcbiAgICBpZiAocmVnaXN0cmF0aW9uUHJvbWlzZSkge1xyXG4gICAgICAgIHJlZ2lzdHJhdGlvblByb21pc2UuY2F0Y2goY29uc29sZS5lcnJvcik7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAvLyBJZiB0aGUgaW5zdGFsbGF0aW9uIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCwgdXBkYXRlIHRoZSBhdXRoZW50aWNhdGlvblxyXG4gICAgICAgIC8vIHRva2VuIGlmIG5lZWRlZC5cclxuICAgICAgICByZWZyZXNoQXV0aFRva2VuKGluc3RhbGxhdGlvbnNJbXBsKS5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuICAgIH1cclxuICAgIHJldHVybiBpbnN0YWxsYXRpb25FbnRyeS5maWQ7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuLyoqXHJcbiAqIFJldHVybnMgYSBGaXJlYmFzZSBJbnN0YWxsYXRpb25zIGF1dGggdG9rZW4sIGlkZW50aWZ5aW5nIHRoZSBjdXJyZW50XHJcbiAqIEZpcmViYXNlIEluc3RhbGxhdGlvbi5cclxuICogQHBhcmFtIGluc3RhbGxhdGlvbnMgLSBUaGUgYEluc3RhbGxhdGlvbnNgIGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gZm9yY2VSZWZyZXNoIC0gRm9yY2UgcmVmcmVzaCByZWdhcmRsZXNzIG9mIHRva2VuIGV4cGlyYXRpb24uXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFRva2VuKGluc3RhbGxhdGlvbnMsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7XHJcbiAgICBjb25zdCBpbnN0YWxsYXRpb25zSW1wbCA9IGluc3RhbGxhdGlvbnM7XHJcbiAgICBhd2FpdCBjb21wbGV0ZUluc3RhbGxhdGlvblJlZ2lzdHJhdGlvbihpbnN0YWxsYXRpb25zSW1wbCk7XHJcbiAgICAvLyBBdCB0aGlzIHBvaW50IHdlIGVpdGhlciBoYXZlIGEgUmVnaXN0ZXJlZCBJbnN0YWxsYXRpb24gaW4gdGhlIERCLCBvciB3ZSd2ZVxyXG4gICAgLy8gYWxyZWFkeSB0aHJvd24gYW4gZXJyb3IuXHJcbiAgICBjb25zdCBhdXRoVG9rZW4gPSBhd2FpdCByZWZyZXNoQXV0aFRva2VuKGluc3RhbGxhdGlvbnNJbXBsLCBmb3JjZVJlZnJlc2gpO1xyXG4gICAgcmV0dXJuIGF1dGhUb2tlbi50b2tlbjtcclxufVxyXG5hc3luYyBmdW5jdGlvbiBjb21wbGV0ZUluc3RhbGxhdGlvblJlZ2lzdHJhdGlvbihpbnN0YWxsYXRpb25zKSB7XHJcbiAgICBjb25zdCB7IHJlZ2lzdHJhdGlvblByb21pc2UgfSA9IGF3YWl0IGdldEluc3RhbGxhdGlvbkVudHJ5KGluc3RhbGxhdGlvbnMpO1xyXG4gICAgaWYgKHJlZ2lzdHJhdGlvblByb21pc2UpIHtcclxuICAgICAgICAvLyBBIGNyZWF0ZUluc3RhbGxhdGlvbiByZXF1ZXN0IGlzIGluIHByb2dyZXNzLiBXYWl0IHVudGlsIGl0IGZpbmlzaGVzLlxyXG4gICAgICAgIGF3YWl0IHJlZ2lzdHJhdGlvblByb21pc2U7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlSW5zdGFsbGF0aW9uUmVxdWVzdChhcHBDb25maWcsIGluc3RhbGxhdGlvbkVudHJ5KSB7XHJcbiAgICBjb25zdCBlbmRwb2ludCA9IGdldERlbGV0ZUVuZHBvaW50KGFwcENvbmZpZywgaW5zdGFsbGF0aW9uRW50cnkpO1xyXG4gICAgY29uc3QgaGVhZGVycyA9IGdldEhlYWRlcnNXaXRoQXV0aChhcHBDb25maWcsIGluc3RhbGxhdGlvbkVudHJ5KTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgICAgICBoZWFkZXJzXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXRyeUlmU2VydmVyRXJyb3IoKCkgPT4gZmV0Y2goZW5kcG9pbnQsIHJlcXVlc3QpKTtcclxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgICAgICB0aHJvdyBhd2FpdCBnZXRFcnJvckZyb21SZXNwb25zZSgnRGVsZXRlIEluc3RhbGxhdGlvbicsIHJlc3BvbnNlKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXREZWxldGVFbmRwb2ludChhcHBDb25maWcsIHsgZmlkIH0pIHtcclxuICAgIHJldHVybiBgJHtnZXRJbnN0YWxsYXRpb25zRW5kcG9pbnQoYXBwQ29uZmlnKX0vJHtmaWR9YDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKipcclxuICogRGVsZXRlcyB0aGUgRmlyZWJhc2UgSW5zdGFsbGF0aW9uIGFuZCBhbGwgYXNzb2NpYXRlZCBkYXRhLlxyXG4gKiBAcGFyYW0gaW5zdGFsbGF0aW9ucyAtIFRoZSBgSW5zdGFsbGF0aW9uc2AgaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUluc3RhbGxhdGlvbnMoaW5zdGFsbGF0aW9ucykge1xyXG4gICAgY29uc3QgeyBhcHBDb25maWcgfSA9IGluc3RhbGxhdGlvbnM7XHJcbiAgICBjb25zdCBlbnRyeSA9IGF3YWl0IHVwZGF0ZShhcHBDb25maWcsIG9sZEVudHJ5ID0+IHtcclxuICAgICAgICBpZiAob2xkRW50cnkgJiYgb2xkRW50cnkucmVnaXN0cmF0aW9uU3RhdHVzID09PSAwIC8qIFJlcXVlc3RTdGF0dXMuTk9UX1NUQVJURUQgKi8pIHtcclxuICAgICAgICAgICAgLy8gRGVsZXRlIHRoZSB1bnJlZ2lzdGVyZWQgZW50cnkgd2l0aG91dCBzZW5kaW5nIGEgZGVsZXRlSW5zdGFsbGF0aW9uIHJlcXVlc3QuXHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvbGRFbnRyeTtcclxuICAgIH0pO1xyXG4gICAgaWYgKGVudHJ5KSB7XHJcbiAgICAgICAgaWYgKGVudHJ5LnJlZ2lzdHJhdGlvblN0YXR1cyA9PT0gMSAvKiBSZXF1ZXN0U3RhdHVzLklOX1BST0dSRVNTICovKSB7XHJcbiAgICAgICAgICAgIC8vIENhbid0IGRlbGV0ZSB3aGlsZSB0cnlpbmcgdG8gcmVnaXN0ZXIuXHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiZGVsZXRlLXBlbmRpbmctcmVnaXN0cmF0aW9uXCIgLyogRXJyb3JDb2RlLkRFTEVURV9QRU5ESU5HX1JFR0lTVFJBVElPTiAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVudHJ5LnJlZ2lzdHJhdGlvblN0YXR1cyA9PT0gMiAvKiBSZXF1ZXN0U3RhdHVzLkNPTVBMRVRFRCAqLykge1xyXG4gICAgICAgICAgICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiYXBwLW9mZmxpbmVcIiAvKiBFcnJvckNvZGUuQVBQX09GRkxJTkUgKi8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlSW5zdGFsbGF0aW9uUmVxdWVzdChhcHBDb25maWcsIGVudHJ5KTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHJlbW92ZShhcHBDb25maWcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBTZXRzIGEgbmV3IGNhbGxiYWNrIHRoYXQgd2lsbCBnZXQgY2FsbGVkIHdoZW4gSW5zdGFsbGF0aW9uIElEIGNoYW5nZXMuXHJcbiAqIFJldHVybnMgYW4gdW5zdWJzY3JpYmUgZnVuY3Rpb24gdGhhdCB3aWxsIHJlbW92ZSB0aGUgY2FsbGJhY2sgd2hlbiBjYWxsZWQuXHJcbiAqIEBwYXJhbSBpbnN0YWxsYXRpb25zIC0gVGhlIGBJbnN0YWxsYXRpb25zYCBpbnN0YW5jZS5cclxuICogQHBhcmFtIGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgaW52b2tlZCB3aGVuIEZJRCBjaGFuZ2VzLlxyXG4gKiBAcmV0dXJucyBBIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIGNhbGxlZCB0byB1bnN1YnNjcmliZS5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gb25JZENoYW5nZShpbnN0YWxsYXRpb25zLCBjYWxsYmFjaykge1xyXG4gICAgY29uc3QgeyBhcHBDb25maWcgfSA9IGluc3RhbGxhdGlvbnM7XHJcbiAgICBhZGRDYWxsYmFjayhhcHBDb25maWcsIGNhbGxiYWNrKTtcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgcmVtb3ZlQ2FsbGJhY2soYXBwQ29uZmlnLCBjYWxsYmFjayk7XHJcbiAgICB9O1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXR1cm5zIGFuIGluc3RhbmNlIG9mIHtAbGluayBJbnN0YWxsYXRpb25zfSBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuXHJcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfSBpbnN0YW5jZS5cclxuICogQHBhcmFtIGFwcCAtIFRoZSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldEluc3RhbGxhdGlvbnMoYXBwID0gZ2V0QXBwKCkpIHtcclxuICAgIGNvbnN0IGluc3RhbGxhdGlvbnNJbXBsID0gX2dldFByb3ZpZGVyKGFwcCwgJ2luc3RhbGxhdGlvbnMnKS5nZXRJbW1lZGlhdGUoKTtcclxuICAgIHJldHVybiBpbnN0YWxsYXRpb25zSW1wbDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBleHRyYWN0QXBwQ29uZmlnKGFwcCkge1xyXG4gICAgaWYgKCFhcHAgfHwgIWFwcC5vcHRpb25zKSB7XHJcbiAgICAgICAgdGhyb3cgZ2V0TWlzc2luZ1ZhbHVlRXJyb3IoJ0FwcCBDb25maWd1cmF0aW9uJyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIWFwcC5uYW1lKSB7XHJcbiAgICAgICAgdGhyb3cgZ2V0TWlzc2luZ1ZhbHVlRXJyb3IoJ0FwcCBOYW1lJyk7XHJcbiAgICB9XHJcbiAgICAvLyBSZXF1aXJlZCBhcHAgY29uZmlnIGtleXNcclxuICAgIGNvbnN0IGNvbmZpZ0tleXMgPSBbXHJcbiAgICAgICAgJ3Byb2plY3RJZCcsXHJcbiAgICAgICAgJ2FwaUtleScsXHJcbiAgICAgICAgJ2FwcElkJ1xyXG4gICAgXTtcclxuICAgIGZvciAoY29uc3Qga2V5TmFtZSBvZiBjb25maWdLZXlzKSB7XHJcbiAgICAgICAgaWYgKCFhcHAub3B0aW9uc1trZXlOYW1lXSkge1xyXG4gICAgICAgICAgICB0aHJvdyBnZXRNaXNzaW5nVmFsdWVFcnJvcihrZXlOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGFwcE5hbWU6IGFwcC5uYW1lLFxyXG4gICAgICAgIHByb2plY3RJZDogYXBwLm9wdGlvbnMucHJvamVjdElkLFxyXG4gICAgICAgIGFwaUtleTogYXBwLm9wdGlvbnMuYXBpS2V5LFxyXG4gICAgICAgIGFwcElkOiBhcHAub3B0aW9ucy5hcHBJZFxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBnZXRNaXNzaW5nVmFsdWVFcnJvcih2YWx1ZU5hbWUpIHtcclxuICAgIHJldHVybiBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcIm1pc3NpbmctYXBwLWNvbmZpZy12YWx1ZXNcIiAvKiBFcnJvckNvZGUuTUlTU0lOR19BUFBfQ09ORklHX1ZBTFVFUyAqLywge1xyXG4gICAgICAgIHZhbHVlTmFtZVxyXG4gICAgfSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgSU5TVEFMTEFUSU9OU19OQU1FID0gJ2luc3RhbGxhdGlvbnMnO1xyXG5jb25zdCBJTlNUQUxMQVRJT05TX05BTUVfSU5URVJOQUwgPSAnaW5zdGFsbGF0aW9ucy1pbnRlcm5hbCc7XHJcbmNvbnN0IHB1YmxpY0ZhY3RvcnkgPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgICBjb25zdCBhcHAgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcCcpLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgLy8gVGhyb3dzIGlmIGFwcCBpc24ndCBjb25maWd1cmVkIHByb3Blcmx5LlxyXG4gICAgY29uc3QgYXBwQ29uZmlnID0gZXh0cmFjdEFwcENvbmZpZyhhcHApO1xyXG4gICAgY29uc3QgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ2hlYXJ0YmVhdCcpO1xyXG4gICAgY29uc3QgaW5zdGFsbGF0aW9uc0ltcGwgPSB7XHJcbiAgICAgICAgYXBwLFxyXG4gICAgICAgIGFwcENvbmZpZyxcclxuICAgICAgICBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIsXHJcbiAgICAgICAgX2RlbGV0ZTogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKClcclxuICAgIH07XHJcbiAgICByZXR1cm4gaW5zdGFsbGF0aW9uc0ltcGw7XHJcbn07XHJcbmNvbnN0IGludGVybmFsRmFjdG9yeSA9IChjb250YWluZXIpID0+IHtcclxuICAgIGNvbnN0IGFwcCA9IGNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICAvLyBJbnRlcm5hbCBGSVMgaW5zdGFuY2UgcmVsaWVzIG9uIHB1YmxpYyBGSVMgaW5zdGFuY2UuXHJcbiAgICBjb25zdCBpbnN0YWxsYXRpb25zID0gX2dldFByb3ZpZGVyKGFwcCwgSU5TVEFMTEFUSU9OU19OQU1FKS5nZXRJbW1lZGlhdGUoKTtcclxuICAgIGNvbnN0IGluc3RhbGxhdGlvbnNJbnRlcm5hbCA9IHtcclxuICAgICAgICBnZXRJZDogKCkgPT4gZ2V0SWQoaW5zdGFsbGF0aW9ucyksXHJcbiAgICAgICAgZ2V0VG9rZW46IChmb3JjZVJlZnJlc2gpID0+IGdldFRva2VuKGluc3RhbGxhdGlvbnMsIGZvcmNlUmVmcmVzaClcclxuICAgIH07XHJcbiAgICByZXR1cm4gaW5zdGFsbGF0aW9uc0ludGVybmFsO1xyXG59O1xyXG5mdW5jdGlvbiByZWdpc3Rlckluc3RhbGxhdGlvbnMoKSB7XHJcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudChJTlNUQUxMQVRJT05TX05BTUUsIHB1YmxpY0ZhY3RvcnksIFwiUFVCTElDXCIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pKTtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KElOU1RBTExBVElPTlNfTkFNRV9JTlRFUk5BTCwgaW50ZXJuYWxGYWN0b3J5LCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTtcclxufVxuXG4vKipcclxuICogRmlyZWJhc2UgSW5zdGFsbGF0aW9uc1xyXG4gKlxyXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cclxuICovXHJcbnJlZ2lzdGVySW5zdGFsbGF0aW9ucygpO1xyXG5yZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbik7XHJcbi8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uXHJcbnJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCAnZXNtMjAxNycpO1xuXG5leHBvcnQgeyBkZWxldGVJbnN0YWxsYXRpb25zLCBnZXRJZCwgZ2V0SW5zdGFsbGF0aW9ucywgZ2V0VG9rZW4sIG9uSWRDaGFuZ2UgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCJpbXBvcnQgJ0BmaXJlYmFzZS9pbnN0YWxsYXRpb25zJztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0BmaXJlYmFzZS9jb21wb25lbnQnO1xuaW1wb3J0IHsgb3BlbkRCLCBkZWxldGVEQiB9IGZyb20gJ2lkYic7XG5pbXBvcnQgeyBFcnJvckZhY3RvcnksIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUsIGlzSW5kZXhlZERCQXZhaWxhYmxlLCBhcmVDb29raWVzRW5hYmxlZCwgZ2V0TW9kdWxhckluc3RhbmNlIH0gZnJvbSAnQGZpcmViYXNlL3V0aWwnO1xuaW1wb3J0IHsgX3JlZ2lzdGVyQ29tcG9uZW50LCByZWdpc3RlclZlcnNpb24sIF9nZXRQcm92aWRlciwgZ2V0QXBwIH0gZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IERFRkFVTFRfU1dfUEFUSCA9ICcvZmlyZWJhc2UtbWVzc2FnaW5nLXN3LmpzJztcclxuY29uc3QgREVGQVVMVF9TV19TQ09QRSA9ICcvZmlyZWJhc2UtY2xvdWQtbWVzc2FnaW5nLXB1c2gtc2NvcGUnO1xyXG5jb25zdCBERUZBVUxUX1ZBUElEX0tFWSA9ICdCRE9VOTktaDY3SGNBNkplRlhIYlNOTXU3ZTJ5Tk51M1J6b01qOFRNNFc4OGpJVGZxN1ptUHZJTTFJdi00X2wyTHhRY1l3aHFieTJ4R3BXd3pqZkFuRzQnO1xyXG5jb25zdCBFTkRQT0lOVCA9ICdodHRwczovL2ZjbXJlZ2lzdHJhdGlvbnMuZ29vZ2xlYXBpcy5jb20vdjEnO1xyXG5jb25zdCBDT05TT0xFX0NBTVBBSUdOX0lEID0gJ2dvb2dsZS5jLmEuY19pZCc7XHJcbmNvbnN0IENPTlNPTEVfQ0FNUEFJR05fTkFNRSA9ICdnb29nbGUuYy5hLmNfbCc7XHJcbmNvbnN0IENPTlNPTEVfQ0FNUEFJR05fVElNRSA9ICdnb29nbGUuYy5hLnRzJztcclxuLyoqIFNldCB0byAnMScgaWYgQW5hbHl0aWNzIGlzIGVuYWJsZWQgZm9yIHRoZSBjYW1wYWlnbiAqL1xyXG5jb25zdCBDT05TT0xFX0NBTVBBSUdOX0FOQUxZVElDU19FTkFCTEVEID0gJ2dvb2dsZS5jLmEuZSc7XHJcbnZhciBNZXNzYWdlVHlwZSQxO1xyXG4oZnVuY3Rpb24gKE1lc3NhZ2VUeXBlKSB7XHJcbiAgICBNZXNzYWdlVHlwZVtNZXNzYWdlVHlwZVtcIkRBVEFfTUVTU0FHRVwiXSA9IDFdID0gXCJEQVRBX01FU1NBR0VcIjtcclxuICAgIE1lc3NhZ2VUeXBlW01lc3NhZ2VUeXBlW1wiRElTUExBWV9OT1RJRklDQVRJT05cIl0gPSAzXSA9IFwiRElTUExBWV9OT1RJRklDQVRJT05cIjtcclxufSkoTWVzc2FnZVR5cGUkMSB8fCAoTWVzc2FnZVR5cGUkMSA9IHt9KSk7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0XHJcbiAqIGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlXHJcbiAqIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzXHJcbiAqIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXJcclxuICogdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG52YXIgTWVzc2FnZVR5cGU7XHJcbihmdW5jdGlvbiAoTWVzc2FnZVR5cGUpIHtcclxuICAgIE1lc3NhZ2VUeXBlW1wiUFVTSF9SRUNFSVZFRFwiXSA9IFwicHVzaC1yZWNlaXZlZFwiO1xyXG4gICAgTWVzc2FnZVR5cGVbXCJOT1RJRklDQVRJT05fQ0xJQ0tFRFwiXSA9IFwibm90aWZpY2F0aW9uLWNsaWNrZWRcIjtcclxufSkoTWVzc2FnZVR5cGUgfHwgKE1lc3NhZ2VUeXBlID0ge30pKTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuZnVuY3Rpb24gYXJyYXlUb0Jhc2U2NChhcnJheSkge1xyXG4gICAgY29uc3QgdWludDhBcnJheSA9IG5ldyBVaW50OEFycmF5KGFycmF5KTtcclxuICAgIGNvbnN0IGJhc2U2NFN0cmluZyA9IGJ0b2EoU3RyaW5nLmZyb21DaGFyQ29kZSguLi51aW50OEFycmF5KSk7XHJcbiAgICByZXR1cm4gYmFzZTY0U3RyaW5nLnJlcGxhY2UoLz0vZywgJycpLnJlcGxhY2UoL1xcKy9nLCAnLScpLnJlcGxhY2UoL1xcLy9nLCAnXycpO1xyXG59XHJcbmZ1bmN0aW9uIGJhc2U2NFRvQXJyYXkoYmFzZTY0U3RyaW5nKSB7XHJcbiAgICBjb25zdCBwYWRkaW5nID0gJz0nLnJlcGVhdCgoNCAtIChiYXNlNjRTdHJpbmcubGVuZ3RoICUgNCkpICUgNCk7XHJcbiAgICBjb25zdCBiYXNlNjQgPSAoYmFzZTY0U3RyaW5nICsgcGFkZGluZylcclxuICAgICAgICAucmVwbGFjZSgvXFwtL2csICcrJylcclxuICAgICAgICAucmVwbGFjZSgvXy9nLCAnLycpO1xyXG4gICAgY29uc3QgcmF3RGF0YSA9IGF0b2IoYmFzZTY0KTtcclxuICAgIGNvbnN0IG91dHB1dEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkocmF3RGF0YS5sZW5ndGgpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYXdEYXRhLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgb3V0cHV0QXJyYXlbaV0gPSByYXdEYXRhLmNoYXJDb2RlQXQoaSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb3V0cHV0QXJyYXk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgT0xEX0RCX05BTUUgPSAnZmNtX3Rva2VuX2RldGFpbHNfZGInO1xyXG4vKipcclxuICogVGhlIGxhc3QgREIgdmVyc2lvbiBvZiAnZmNtX3Rva2VuX2RldGFpbHNfZGInIHdhcyA0LiBUaGlzIGlzIG9uZSBoaWdoZXIsIHNvIHRoYXQgdGhlIHVwZ3JhZGVcclxuICogY2FsbGJhY2sgaXMgY2FsbGVkIGZvciBhbGwgdmVyc2lvbnMgb2YgdGhlIG9sZCBEQi5cclxuICovXHJcbmNvbnN0IE9MRF9EQl9WRVJTSU9OID0gNTtcclxuY29uc3QgT0xEX09CSkVDVF9TVE9SRV9OQU1FID0gJ2ZjbV90b2tlbl9vYmplY3RfU3RvcmUnO1xyXG5hc3luYyBmdW5jdGlvbiBtaWdyYXRlT2xkRGF0YWJhc2Uoc2VuZGVySWQpIHtcclxuICAgIGlmICgnZGF0YWJhc2VzJyBpbiBpbmRleGVkREIpIHtcclxuICAgICAgICAvLyBpbmRleGVkRGIuZGF0YWJhc2VzKCkgaXMgYW4gSW5kZXhlZERCIHYzIEFQSSBhbmQgZG9lcyBub3QgZXhpc3QgaW4gYWxsIGJyb3dzZXJzLiBUT0RPOiBSZW1vdmVcclxuICAgICAgICAvLyB0eXBlY2FzdCB3aGVuIGl0IGxhbmRzIGluIFRTIHR5cGVzLlxyXG4gICAgICAgIGNvbnN0IGRhdGFiYXNlcyA9IGF3YWl0IGluZGV4ZWREQi5kYXRhYmFzZXMoKTtcclxuICAgICAgICBjb25zdCBkYk5hbWVzID0gZGF0YWJhc2VzLm1hcChkYiA9PiBkYi5uYW1lKTtcclxuICAgICAgICBpZiAoIWRiTmFtZXMuaW5jbHVkZXMoT0xEX0RCX05BTUUpKSB7XHJcbiAgICAgICAgICAgIC8vIG9sZCBEQiBkaWRuJ3QgZXhpc3QsIG5vIG5lZWQgdG8gb3Blbi5cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgbGV0IHRva2VuRGV0YWlscyA9IG51bGw7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IG9wZW5EQihPTERfREJfTkFNRSwgT0xEX0RCX1ZFUlNJT04sIHtcclxuICAgICAgICB1cGdyYWRlOiBhc3luYyAoZGIsIG9sZFZlcnNpb24sIG5ld1ZlcnNpb24sIHVwZ3JhZGVUcmFuc2FjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgIGlmIChvbGRWZXJzaW9uIDwgMikge1xyXG4gICAgICAgICAgICAgICAgLy8gRGF0YWJhc2UgdG9vIG9sZCwgc2tpcCBtaWdyYXRpb24uXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKE9MRF9PQkpFQ1RfU1RPUkVfTkFNRSkpIHtcclxuICAgICAgICAgICAgICAgIC8vIERhdGFiYXNlIGRpZCBub3QgZXhpc3QuIE5vdGhpbmcgdG8gZG8uXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3Qgb2JqZWN0U3RvcmUgPSB1cGdyYWRlVHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoT0xEX09CSkVDVF9TVE9SRV9OQU1FKTtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCBvYmplY3RTdG9yZS5pbmRleCgnZmNtU2VuZGVySWQnKS5nZXQoc2VuZGVySWQpO1xyXG4gICAgICAgICAgICBhd2FpdCBvYmplY3RTdG9yZS5jbGVhcigpO1xyXG4gICAgICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBObyBlbnRyeSBpbiB0aGUgZGF0YWJhc2UsIG5vdGhpbmcgdG8gbWlncmF0ZS5cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAob2xkVmVyc2lvbiA9PT0gMikge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkRGV0YWlscyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvbGREZXRhaWxzLmF1dGggfHwgIW9sZERldGFpbHMucDI1NmRoIHx8ICFvbGREZXRhaWxzLmVuZHBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdG9rZW5EZXRhaWxzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiBvbGREZXRhaWxzLmZjbVRva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IChfYSA9IG9sZERldGFpbHMuY3JlYXRlVGltZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25PcHRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGg6IG9sZERldGFpbHMuYXV0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDI1NmRoOiBvbGREZXRhaWxzLnAyNTZkaCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IG9sZERldGFpbHMuZW5kcG9pbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3U2NvcGU6IG9sZERldGFpbHMuc3dTY29wZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFwaWRLZXk6IHR5cGVvZiBvbGREZXRhaWxzLnZhcGlkS2V5ID09PSAnc3RyaW5nJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBvbGREZXRhaWxzLnZhcGlkS2V5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGFycmF5VG9CYXNlNjQob2xkRGV0YWlscy52YXBpZEtleSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG9sZFZlcnNpb24gPT09IDMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9sZERldGFpbHMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIHRva2VuRGV0YWlscyA9IHtcclxuICAgICAgICAgICAgICAgICAgICB0b2tlbjogb2xkRGV0YWlscy5mY21Ub2tlbixcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVUaW1lOiBvbGREZXRhaWxzLmNyZWF0ZVRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uT3B0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoOiBhcnJheVRvQmFzZTY0KG9sZERldGFpbHMuYXV0aCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHAyNTZkaDogYXJyYXlUb0Jhc2U2NChvbGREZXRhaWxzLnAyNTZkaCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OiBvbGREZXRhaWxzLmVuZHBvaW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd1Njb3BlOiBvbGREZXRhaWxzLnN3U2NvcGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcGlkS2V5OiBhcnJheVRvQmFzZTY0KG9sZERldGFpbHMudmFwaWRLZXkpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChvbGRWZXJzaW9uID09PSA0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvbGREZXRhaWxzID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB0b2tlbkRldGFpbHMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IG9sZERldGFpbHMuZmNtVG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlVGltZTogb2xkRGV0YWlscy5jcmVhdGVUaW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbk9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aDogYXJyYXlUb0Jhc2U2NChvbGREZXRhaWxzLmF1dGgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwMjU2ZGg6IGFycmF5VG9CYXNlNjQob2xkRGV0YWlscy5wMjU2ZGgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogb2xkRGV0YWlscy5lbmRwb2ludCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dTY29wZTogb2xkRGV0YWlscy5zd1Njb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXBpZEtleTogYXJyYXlUb0Jhc2U2NChvbGREZXRhaWxzLnZhcGlkS2V5KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIGRiLmNsb3NlKCk7XHJcbiAgICAvLyBEZWxldGUgYWxsIG9sZCBkYXRhYmFzZXMuXHJcbiAgICBhd2FpdCBkZWxldGVEQihPTERfREJfTkFNRSk7XHJcbiAgICBhd2FpdCBkZWxldGVEQignZmNtX3ZhcGlkX2RldGFpbHNfZGInKTtcclxuICAgIGF3YWl0IGRlbGV0ZURCKCd1bmRlZmluZWQnKTtcclxuICAgIHJldHVybiBjaGVja1Rva2VuRGV0YWlscyh0b2tlbkRldGFpbHMpID8gdG9rZW5EZXRhaWxzIDogbnVsbDtcclxufVxyXG5mdW5jdGlvbiBjaGVja1Rva2VuRGV0YWlscyh0b2tlbkRldGFpbHMpIHtcclxuICAgIGlmICghdG9rZW5EZXRhaWxzIHx8ICF0b2tlbkRldGFpbHMuc3Vic2NyaXB0aW9uT3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IHsgc3Vic2NyaXB0aW9uT3B0aW9ucyB9ID0gdG9rZW5EZXRhaWxzO1xyXG4gICAgcmV0dXJuICh0eXBlb2YgdG9rZW5EZXRhaWxzLmNyZWF0ZVRpbWUgPT09ICdudW1iZXInICYmXHJcbiAgICAgICAgdG9rZW5EZXRhaWxzLmNyZWF0ZVRpbWUgPiAwICYmXHJcbiAgICAgICAgdHlwZW9mIHRva2VuRGV0YWlscy50b2tlbiA9PT0gJ3N0cmluZycgJiZcclxuICAgICAgICB0b2tlbkRldGFpbHMudG9rZW4ubGVuZ3RoID4gMCAmJlxyXG4gICAgICAgIHR5cGVvZiBzdWJzY3JpcHRpb25PcHRpb25zLmF1dGggPT09ICdzdHJpbmcnICYmXHJcbiAgICAgICAgc3Vic2NyaXB0aW9uT3B0aW9ucy5hdXRoLmxlbmd0aCA+IDAgJiZcclxuICAgICAgICB0eXBlb2Ygc3Vic2NyaXB0aW9uT3B0aW9ucy5wMjU2ZGggPT09ICdzdHJpbmcnICYmXHJcbiAgICAgICAgc3Vic2NyaXB0aW9uT3B0aW9ucy5wMjU2ZGgubGVuZ3RoID4gMCAmJlxyXG4gICAgICAgIHR5cGVvZiBzdWJzY3JpcHRpb25PcHRpb25zLmVuZHBvaW50ID09PSAnc3RyaW5nJyAmJlxyXG4gICAgICAgIHN1YnNjcmlwdGlvbk9wdGlvbnMuZW5kcG9pbnQubGVuZ3RoID4gMCAmJlxyXG4gICAgICAgIHR5cGVvZiBzdWJzY3JpcHRpb25PcHRpb25zLnN3U2NvcGUgPT09ICdzdHJpbmcnICYmXHJcbiAgICAgICAgc3Vic2NyaXB0aW9uT3B0aW9ucy5zd1Njb3BlLmxlbmd0aCA+IDAgJiZcclxuICAgICAgICB0eXBlb2Ygc3Vic2NyaXB0aW9uT3B0aW9ucy52YXBpZEtleSA9PT0gJ3N0cmluZycgJiZcclxuICAgICAgICBzdWJzY3JpcHRpb25PcHRpb25zLnZhcGlkS2V5Lmxlbmd0aCA+IDApO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8vIEV4cG9ydGVkIGZvciB0ZXN0cy5cclxuY29uc3QgREFUQUJBU0VfTkFNRSA9ICdmaXJlYmFzZS1tZXNzYWdpbmctZGF0YWJhc2UnO1xyXG5jb25zdCBEQVRBQkFTRV9WRVJTSU9OID0gMTtcclxuY29uc3QgT0JKRUNUX1NUT1JFX05BTUUgPSAnZmlyZWJhc2UtbWVzc2FnaW5nLXN0b3JlJztcclxubGV0IGRiUHJvbWlzZSA9IG51bGw7XHJcbmZ1bmN0aW9uIGdldERiUHJvbWlzZSgpIHtcclxuICAgIGlmICghZGJQcm9taXNlKSB7XHJcbiAgICAgICAgZGJQcm9taXNlID0gb3BlbkRCKERBVEFCQVNFX05BTUUsIERBVEFCQVNFX1ZFUlNJT04sIHtcclxuICAgICAgICAgICAgdXBncmFkZTogKHVwZ3JhZGVEYiwgb2xkVmVyc2lvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdXNlICdicmVhaycgaW4gdGhpcyBzd2l0Y2ggc3RhdGVtZW50LCB0aGUgZmFsbC10aHJvdWdoIGJlaGF2aW9yIGlzIHdoYXQgd2Ugd2FudCxcclxuICAgICAgICAgICAgICAgIC8vIGJlY2F1c2UgaWYgdGhlcmUgYXJlIG11bHRpcGxlIHZlcnNpb25zIGJldHdlZW4gdGhlIG9sZCB2ZXJzaW9uIGFuZCB0aGUgY3VycmVudCB2ZXJzaW9uLCB3ZVxyXG4gICAgICAgICAgICAgICAgLy8gd2FudCBBTEwgdGhlIG1pZ3JhdGlvbnMgdGhhdCBjb3JyZXNwb25kIHRvIHRob3NlIHZlcnNpb25zIHRvIHJ1biwgbm90IG9ubHkgdGhlIGxhc3Qgb25lLlxyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlZmF1bHQtY2FzZVxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChvbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoT0JKRUNUX1NUT1JFX05BTUUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGJQcm9taXNlO1xyXG59XHJcbi8qKiBHZXRzIHJlY29yZChzKSBmcm9tIHRoZSBvYmplY3RTdG9yZSB0aGF0IG1hdGNoIHRoZSBnaXZlbiBrZXkuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGRiR2V0KGZpcmViYXNlRGVwZW5kZW5jaWVzKSB7XHJcbiAgICBjb25zdCBrZXkgPSBnZXRLZXkoZmlyZWJhc2VEZXBlbmRlbmNpZXMpO1xyXG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYlByb21pc2UoKTtcclxuICAgIGNvbnN0IHRva2VuRGV0YWlscyA9IChhd2FpdCBkYlxyXG4gICAgICAgIC50cmFuc2FjdGlvbihPQkpFQ1RfU1RPUkVfTkFNRSlcclxuICAgICAgICAub2JqZWN0U3RvcmUoT0JKRUNUX1NUT1JFX05BTUUpXHJcbiAgICAgICAgLmdldChrZXkpKTtcclxuICAgIGlmICh0b2tlbkRldGFpbHMpIHtcclxuICAgICAgICByZXR1cm4gdG9rZW5EZXRhaWxzO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYSB0b2tlbkRldGFpbHMgb2JqZWN0IGluIHRoZSBvbGQgREIuXHJcbiAgICAgICAgY29uc3Qgb2xkVG9rZW5EZXRhaWxzID0gYXdhaXQgbWlncmF0ZU9sZERhdGFiYXNlKGZpcmViYXNlRGVwZW5kZW5jaWVzLmFwcENvbmZpZy5zZW5kZXJJZCk7XHJcbiAgICAgICAgaWYgKG9sZFRva2VuRGV0YWlscykge1xyXG4gICAgICAgICAgICBhd2FpdCBkYlNldChmaXJlYmFzZURlcGVuZGVuY2llcywgb2xkVG9rZW5EZXRhaWxzKTtcclxuICAgICAgICAgICAgcmV0dXJuIG9sZFRva2VuRGV0YWlscztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuLyoqIEFzc2lnbnMgb3Igb3ZlcndyaXRlcyB0aGUgcmVjb3JkIGZvciB0aGUgZ2l2ZW4ga2V5IHdpdGggdGhlIGdpdmVuIHZhbHVlLiAqL1xyXG5hc3luYyBmdW5jdGlvbiBkYlNldChmaXJlYmFzZURlcGVuZGVuY2llcywgdG9rZW5EZXRhaWxzKSB7XHJcbiAgICBjb25zdCBrZXkgPSBnZXRLZXkoZmlyZWJhc2VEZXBlbmRlbmNpZXMpO1xyXG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYlByb21pc2UoKTtcclxuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oT0JKRUNUX1NUT1JFX05BTUUsICdyZWFkd3JpdGUnKTtcclxuICAgIGF3YWl0IHR4Lm9iamVjdFN0b3JlKE9CSkVDVF9TVE9SRV9OQU1FKS5wdXQodG9rZW5EZXRhaWxzLCBrZXkpO1xyXG4gICAgYXdhaXQgdHguZG9uZTtcclxuICAgIHJldHVybiB0b2tlbkRldGFpbHM7XHJcbn1cclxuLyoqIFJlbW92ZXMgcmVjb3JkKHMpIGZyb20gdGhlIG9iamVjdFN0b3JlIHRoYXQgbWF0Y2ggdGhlIGdpdmVuIGtleS4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZGJSZW1vdmUoZmlyZWJhc2VEZXBlbmRlbmNpZXMpIHtcclxuICAgIGNvbnN0IGtleSA9IGdldEtleShmaXJlYmFzZURlcGVuZGVuY2llcyk7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGdldERiUHJvbWlzZSgpO1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihPQkpFQ1RfU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgYXdhaXQgdHgub2JqZWN0U3RvcmUoT0JKRUNUX1NUT1JFX05BTUUpLmRlbGV0ZShrZXkpO1xyXG4gICAgYXdhaXQgdHguZG9uZTtcclxufVxyXG5mdW5jdGlvbiBnZXRLZXkoeyBhcHBDb25maWcgfSkge1xyXG4gICAgcmV0dXJuIGFwcENvbmZpZy5hcHBJZDtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBFUlJPUl9NQVAgPSB7XHJcbiAgICBbXCJtaXNzaW5nLWFwcC1jb25maWctdmFsdWVzXCIgLyogRXJyb3JDb2RlLk1JU1NJTkdfQVBQX0NPTkZJR19WQUxVRVMgKi9dOiAnTWlzc2luZyBBcHAgY29uZmlndXJhdGlvbiB2YWx1ZTogXCJ7JHZhbHVlTmFtZX1cIicsXHJcbiAgICBbXCJvbmx5LWF2YWlsYWJsZS1pbi13aW5kb3dcIiAvKiBFcnJvckNvZGUuQVZBSUxBQkxFX0lOX1dJTkRPVyAqL106ICdUaGlzIG1ldGhvZCBpcyBhdmFpbGFibGUgaW4gYSBXaW5kb3cgY29udGV4dC4nLFxyXG4gICAgW1wib25seS1hdmFpbGFibGUtaW4tc3dcIiAvKiBFcnJvckNvZGUuQVZBSUxBQkxFX0lOX1NXICovXTogJ1RoaXMgbWV0aG9kIGlzIGF2YWlsYWJsZSBpbiBhIHNlcnZpY2Ugd29ya2VyIGNvbnRleHQuJyxcclxuICAgIFtcInBlcm1pc3Npb24tZGVmYXVsdFwiIC8qIEVycm9yQ29kZS5QRVJNSVNTSU9OX0RFRkFVTFQgKi9dOiAnVGhlIG5vdGlmaWNhdGlvbiBwZXJtaXNzaW9uIHdhcyBub3QgZ3JhbnRlZCBhbmQgZGlzbWlzc2VkIGluc3RlYWQuJyxcclxuICAgIFtcInBlcm1pc3Npb24tYmxvY2tlZFwiIC8qIEVycm9yQ29kZS5QRVJNSVNTSU9OX0JMT0NLRUQgKi9dOiAnVGhlIG5vdGlmaWNhdGlvbiBwZXJtaXNzaW9uIHdhcyBub3QgZ3JhbnRlZCBhbmQgYmxvY2tlZCBpbnN0ZWFkLicsXHJcbiAgICBbXCJ1bnN1cHBvcnRlZC1icm93c2VyXCIgLyogRXJyb3JDb2RlLlVOU1VQUE9SVEVEX0JST1dTRVIgKi9dOiBcIlRoaXMgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgdGhlIEFQSSdzIHJlcXVpcmVkIHRvIHVzZSB0aGUgRmlyZWJhc2UgU0RLLlwiLFxyXG4gICAgW1wiaW5kZXhlZC1kYi11bnN1cHBvcnRlZFwiIC8qIEVycm9yQ29kZS5JTkRFWEVEX0RCX1VOU1VQUE9SVEVEICovXTogXCJUaGlzIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IGluZGV4ZWREYi5vcGVuKCkgKGV4LiBTYWZhcmkgaUZyYW1lLCBGaXJlZm94IFByaXZhdGUgQnJvd3NpbmcsIGV0YylcIixcclxuICAgIFtcImZhaWxlZC1zZXJ2aWNlLXdvcmtlci1yZWdpc3RyYXRpb25cIiAvKiBFcnJvckNvZGUuRkFJTEVEX0RFRkFVTFRfUkVHSVNUUkFUSU9OICovXTogJ1dlIGFyZSB1bmFibGUgdG8gcmVnaXN0ZXIgdGhlIGRlZmF1bHQgc2VydmljZSB3b3JrZXIuIHskYnJvd3NlckVycm9yTWVzc2FnZX0nLFxyXG4gICAgW1widG9rZW4tc3Vic2NyaWJlLWZhaWxlZFwiIC8qIEVycm9yQ29kZS5UT0tFTl9TVUJTQ1JJQkVfRkFJTEVEICovXTogJ0EgcHJvYmxlbSBvY2N1cnJlZCB3aGlsZSBzdWJzY3JpYmluZyB0aGUgdXNlciB0byBGQ006IHskZXJyb3JJbmZvfScsXHJcbiAgICBbXCJ0b2tlbi1zdWJzY3JpYmUtbm8tdG9rZW5cIiAvKiBFcnJvckNvZGUuVE9LRU5fU1VCU0NSSUJFX05PX1RPS0VOICovXTogJ0ZDTSByZXR1cm5lZCBubyB0b2tlbiB3aGVuIHN1YnNjcmliaW5nIHRoZSB1c2VyIHRvIHB1c2guJyxcclxuICAgIFtcInRva2VuLXVuc3Vic2NyaWJlLWZhaWxlZFwiIC8qIEVycm9yQ29kZS5UT0tFTl9VTlNVQlNDUklCRV9GQUlMRUQgKi9dOiAnQSBwcm9ibGVtIG9jY3VycmVkIHdoaWxlIHVuc3Vic2NyaWJpbmcgdGhlICcgK1xyXG4gICAgICAgICd1c2VyIGZyb20gRkNNOiB7JGVycm9ySW5mb30nLFxyXG4gICAgW1widG9rZW4tdXBkYXRlLWZhaWxlZFwiIC8qIEVycm9yQ29kZS5UT0tFTl9VUERBVEVfRkFJTEVEICovXTogJ0EgcHJvYmxlbSBvY2N1cnJlZCB3aGlsZSB1cGRhdGluZyB0aGUgdXNlciBmcm9tIEZDTTogeyRlcnJvckluZm99JyxcclxuICAgIFtcInRva2VuLXVwZGF0ZS1uby10b2tlblwiIC8qIEVycm9yQ29kZS5UT0tFTl9VUERBVEVfTk9fVE9LRU4gKi9dOiAnRkNNIHJldHVybmVkIG5vIHRva2VuIHdoZW4gdXBkYXRpbmcgdGhlIHVzZXIgdG8gcHVzaC4nLFxyXG4gICAgW1widXNlLXN3LWFmdGVyLWdldC10b2tlblwiIC8qIEVycm9yQ29kZS5VU0VfU1dfQUZURVJfR0VUX1RPS0VOICovXTogJ1RoZSB1c2VTZXJ2aWNlV29ya2VyKCkgbWV0aG9kIG1heSBvbmx5IGJlIGNhbGxlZCBvbmNlIGFuZCBtdXN0IGJlICcgK1xyXG4gICAgICAgICdjYWxsZWQgYmVmb3JlIGNhbGxpbmcgZ2V0VG9rZW4oKSB0byBlbnN1cmUgeW91ciBzZXJ2aWNlIHdvcmtlciBpcyB1c2VkLicsXHJcbiAgICBbXCJpbnZhbGlkLXN3LXJlZ2lzdHJhdGlvblwiIC8qIEVycm9yQ29kZS5JTlZBTElEX1NXX1JFR0lTVFJBVElPTiAqL106ICdUaGUgaW5wdXQgdG8gdXNlU2VydmljZVdvcmtlcigpIG11c3QgYmUgYSBTZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uLicsXHJcbiAgICBbXCJpbnZhbGlkLWJnLWhhbmRsZXJcIiAvKiBFcnJvckNvZGUuSU5WQUxJRF9CR19IQU5ETEVSICovXTogJ1RoZSBpbnB1dCB0byBzZXRCYWNrZ3JvdW5kTWVzc2FnZUhhbmRsZXIoKSBtdXN0IGJlIGEgZnVuY3Rpb24uJyxcclxuICAgIFtcImludmFsaWQtdmFwaWQta2V5XCIgLyogRXJyb3JDb2RlLklOVkFMSURfVkFQSURfS0VZICovXTogJ1RoZSBwdWJsaWMgVkFQSUQga2V5IG11c3QgYmUgYSBzdHJpbmcuJyxcclxuICAgIFtcInVzZS12YXBpZC1rZXktYWZ0ZXItZ2V0LXRva2VuXCIgLyogRXJyb3JDb2RlLlVTRV9WQVBJRF9LRVlfQUZURVJfR0VUX1RPS0VOICovXTogJ1RoZSB1c2VQdWJsaWNWYXBpZEtleSgpIG1ldGhvZCBtYXkgb25seSBiZSBjYWxsZWQgb25jZSBhbmQgbXVzdCBiZSAnICtcclxuICAgICAgICAnY2FsbGVkIGJlZm9yZSBjYWxsaW5nIGdldFRva2VuKCkgdG8gZW5zdXJlIHlvdXIgVkFQSUQga2V5IGlzIHVzZWQuJ1xyXG59O1xyXG5jb25zdCBFUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeSgnbWVzc2FnaW5nJywgJ01lc3NhZ2luZycsIEVSUk9SX01BUCk7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3RHZXRUb2tlbihmaXJlYmFzZURlcGVuZGVuY2llcywgc3Vic2NyaXB0aW9uT3B0aW9ucykge1xyXG4gICAgY29uc3QgaGVhZGVycyA9IGF3YWl0IGdldEhlYWRlcnMoZmlyZWJhc2VEZXBlbmRlbmNpZXMpO1xyXG4gICAgY29uc3QgYm9keSA9IGdldEJvZHkoc3Vic2NyaXB0aW9uT3B0aW9ucyk7XHJcbiAgICBjb25zdCBzdWJzY3JpYmVPcHRpb25zID0ge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGhlYWRlcnMsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSlcclxuICAgIH07XHJcbiAgICBsZXQgcmVzcG9uc2VEYXRhO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGdldEVuZHBvaW50KGZpcmViYXNlRGVwZW5kZW5jaWVzLmFwcENvbmZpZyksIHN1YnNjcmliZU9wdGlvbnMpO1xyXG4gICAgICAgIHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnIpIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcInRva2VuLXN1YnNjcmliZS1mYWlsZWRcIiAvKiBFcnJvckNvZGUuVE9LRU5fU1VCU0NSSUJFX0ZBSUxFRCAqLywge1xyXG4gICAgICAgICAgICBlcnJvckluZm86IGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVyci50b1N0cmluZygpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAocmVzcG9uc2VEYXRhLmVycm9yKSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHJlc3BvbnNlRGF0YS5lcnJvci5tZXNzYWdlO1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwidG9rZW4tc3Vic2NyaWJlLWZhaWxlZFwiIC8qIEVycm9yQ29kZS5UT0tFTl9TVUJTQ1JJQkVfRkFJTEVEICovLCB7XHJcbiAgICAgICAgICAgIGVycm9ySW5mbzogbWVzc2FnZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKCFyZXNwb25zZURhdGEudG9rZW4pIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcInRva2VuLXN1YnNjcmliZS1uby10b2tlblwiIC8qIEVycm9yQ29kZS5UT0tFTl9TVUJTQ1JJQkVfTk9fVE9LRU4gKi8pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3BvbnNlRGF0YS50b2tlbjtcclxufVxyXG5hc3luYyBmdW5jdGlvbiByZXF1ZXN0VXBkYXRlVG9rZW4oZmlyZWJhc2VEZXBlbmRlbmNpZXMsIHRva2VuRGV0YWlscykge1xyXG4gICAgY29uc3QgaGVhZGVycyA9IGF3YWl0IGdldEhlYWRlcnMoZmlyZWJhc2VEZXBlbmRlbmNpZXMpO1xyXG4gICAgY29uc3QgYm9keSA9IGdldEJvZHkodG9rZW5EZXRhaWxzLnN1YnNjcmlwdGlvbk9wdGlvbnMpO1xyXG4gICAgY29uc3QgdXBkYXRlT3B0aW9ucyA9IHtcclxuICAgICAgICBtZXRob2Q6ICdQQVRDSCcsXHJcbiAgICAgICAgaGVhZGVycyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KVxyXG4gICAgfTtcclxuICAgIGxldCByZXNwb25zZURhdGE7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7Z2V0RW5kcG9pbnQoZmlyZWJhc2VEZXBlbmRlbmNpZXMuYXBwQ29uZmlnKX0vJHt0b2tlbkRldGFpbHMudG9rZW59YCwgdXBkYXRlT3B0aW9ucyk7XHJcbiAgICAgICAgcmVzcG9uc2VEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycikge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwidG9rZW4tdXBkYXRlLWZhaWxlZFwiIC8qIEVycm9yQ29kZS5UT0tFTl9VUERBVEVfRkFJTEVEICovLCB7XHJcbiAgICAgICAgICAgIGVycm9ySW5mbzogZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLnRvU3RyaW5nKClcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChyZXNwb25zZURhdGEuZXJyb3IpIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gcmVzcG9uc2VEYXRhLmVycm9yLm1lc3NhZ2U7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJ0b2tlbi11cGRhdGUtZmFpbGVkXCIgLyogRXJyb3JDb2RlLlRPS0VOX1VQREFURV9GQUlMRUQgKi8sIHtcclxuICAgICAgICAgICAgZXJyb3JJbmZvOiBtZXNzYWdlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXJlc3BvbnNlRGF0YS50b2tlbikge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwidG9rZW4tdXBkYXRlLW5vLXRva2VuXCIgLyogRXJyb3JDb2RlLlRPS0VOX1VQREFURV9OT19UT0tFTiAqLyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzcG9uc2VEYXRhLnRva2VuO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3REZWxldGVUb2tlbihmaXJlYmFzZURlcGVuZGVuY2llcywgdG9rZW4pIHtcclxuICAgIGNvbnN0IGhlYWRlcnMgPSBhd2FpdCBnZXRIZWFkZXJzKGZpcmViYXNlRGVwZW5kZW5jaWVzKTtcclxuICAgIGNvbnN0IHVuc3Vic2NyaWJlT3B0aW9ucyA9IHtcclxuICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgIGhlYWRlcnNcclxuICAgIH07XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7Z2V0RW5kcG9pbnQoZmlyZWJhc2VEZXBlbmRlbmNpZXMuYXBwQ29uZmlnKX0vJHt0b2tlbn1gLCB1bnN1YnNjcmliZU9wdGlvbnMpO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICBpZiAocmVzcG9uc2VEYXRhLmVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSByZXNwb25zZURhdGEuZXJyb3IubWVzc2FnZTtcclxuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJ0b2tlbi11bnN1YnNjcmliZS1mYWlsZWRcIiAvKiBFcnJvckNvZGUuVE9LRU5fVU5TVUJTQ1JJQkVfRkFJTEVEICovLCB7XHJcbiAgICAgICAgICAgICAgICBlcnJvckluZm86IG1lc3NhZ2VcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGVycikge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwidG9rZW4tdW5zdWJzY3JpYmUtZmFpbGVkXCIgLyogRXJyb3JDb2RlLlRPS0VOX1VOU1VCU0NSSUJFX0ZBSUxFRCAqLywge1xyXG4gICAgICAgICAgICBlcnJvckluZm86IGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVyci50b1N0cmluZygpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0RW5kcG9pbnQoeyBwcm9qZWN0SWQgfSkge1xyXG4gICAgcmV0dXJuIGAke0VORFBPSU5UfS9wcm9qZWN0cy8ke3Byb2plY3RJZH0vcmVnaXN0cmF0aW9uc2A7XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZ2V0SGVhZGVycyh7IGFwcENvbmZpZywgaW5zdGFsbGF0aW9ucyB9KSB7XHJcbiAgICBjb25zdCBhdXRoVG9rZW4gPSBhd2FpdCBpbnN0YWxsYXRpb25zLmdldFRva2VuKCk7XHJcbiAgICByZXR1cm4gbmV3IEhlYWRlcnMoe1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgJ3gtZ29vZy1hcGkta2V5JzogYXBwQ29uZmlnLmFwaUtleSxcclxuICAgICAgICAneC1nb29nLWZpcmViYXNlLWluc3RhbGxhdGlvbnMtYXV0aCc6IGBGSVMgJHthdXRoVG9rZW59YFxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0Qm9keSh7IHAyNTZkaCwgYXV0aCwgZW5kcG9pbnQsIHZhcGlkS2V5IH0pIHtcclxuICAgIGNvbnN0IGJvZHkgPSB7XHJcbiAgICAgICAgd2ViOiB7XHJcbiAgICAgICAgICAgIGVuZHBvaW50LFxyXG4gICAgICAgICAgICBhdXRoLFxyXG4gICAgICAgICAgICBwMjU2ZGhcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgaWYgKHZhcGlkS2V5ICE9PSBERUZBVUxUX1ZBUElEX0tFWSkge1xyXG4gICAgICAgIGJvZHkud2ViLmFwcGxpY2F0aW9uUHViS2V5ID0gdmFwaWRLZXk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYm9keTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vLyBVcGRhdGVSZWdpc3RyYXRpb24gd2lsbCBiZSBjYWxsZWQgb25jZSBldmVyeSB3ZWVrLlxyXG5jb25zdCBUT0tFTl9FWFBJUkFUSU9OX01TID0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDA7IC8vIDcgZGF5c1xyXG5hc3luYyBmdW5jdGlvbiBnZXRUb2tlbkludGVybmFsKG1lc3NhZ2luZykge1xyXG4gICAgY29uc3QgcHVzaFN1YnNjcmlwdGlvbiA9IGF3YWl0IGdldFB1c2hTdWJzY3JpcHRpb24obWVzc2FnaW5nLnN3UmVnaXN0cmF0aW9uLCBtZXNzYWdpbmcudmFwaWRLZXkpO1xyXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICB2YXBpZEtleTogbWVzc2FnaW5nLnZhcGlkS2V5LFxyXG4gICAgICAgIHN3U2NvcGU6IG1lc3NhZ2luZy5zd1JlZ2lzdHJhdGlvbi5zY29wZSxcclxuICAgICAgICBlbmRwb2ludDogcHVzaFN1YnNjcmlwdGlvbi5lbmRwb2ludCxcclxuICAgICAgICBhdXRoOiBhcnJheVRvQmFzZTY0KHB1c2hTdWJzY3JpcHRpb24uZ2V0S2V5KCdhdXRoJykpLFxyXG4gICAgICAgIHAyNTZkaDogYXJyYXlUb0Jhc2U2NChwdXNoU3Vic2NyaXB0aW9uLmdldEtleSgncDI1NmRoJykpXHJcbiAgICB9O1xyXG4gICAgY29uc3QgdG9rZW5EZXRhaWxzID0gYXdhaXQgZGJHZXQobWVzc2FnaW5nLmZpcmViYXNlRGVwZW5kZW5jaWVzKTtcclxuICAgIGlmICghdG9rZW5EZXRhaWxzKSB7XHJcbiAgICAgICAgLy8gTm8gdG9rZW4sIGdldCBhIG5ldyBvbmUuXHJcbiAgICAgICAgcmV0dXJuIGdldE5ld1Rva2VuKG1lc3NhZ2luZy5maXJlYmFzZURlcGVuZGVuY2llcywgc3Vic2NyaXB0aW9uT3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICghaXNUb2tlblZhbGlkKHRva2VuRGV0YWlscy5zdWJzY3JpcHRpb25PcHRpb25zLCBzdWJzY3JpcHRpb25PcHRpb25zKSkge1xyXG4gICAgICAgIC8vIEludmFsaWQgdG9rZW4sIGdldCBhIG5ldyBvbmUuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgYXdhaXQgcmVxdWVzdERlbGV0ZVRva2VuKG1lc3NhZ2luZy5maXJlYmFzZURlcGVuZGVuY2llcywgdG9rZW5EZXRhaWxzLnRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gU3VwcHJlc3MgZXJyb3JzIGJlY2F1c2Ugb2YgIzIzNjRcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZ2V0TmV3VG9rZW4obWVzc2FnaW5nLmZpcmViYXNlRGVwZW5kZW5jaWVzLCBzdWJzY3JpcHRpb25PcHRpb25zKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKERhdGUubm93KCkgPj0gdG9rZW5EZXRhaWxzLmNyZWF0ZVRpbWUgKyBUT0tFTl9FWFBJUkFUSU9OX01TKSB7XHJcbiAgICAgICAgLy8gV2Vla2x5IHRva2VuIHJlZnJlc2hcclxuICAgICAgICByZXR1cm4gdXBkYXRlVG9rZW4obWVzc2FnaW5nLCB7XHJcbiAgICAgICAgICAgIHRva2VuOiB0b2tlbkRldGFpbHMudG9rZW4sXHJcbiAgICAgICAgICAgIGNyZWF0ZVRpbWU6IERhdGUubm93KCksXHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbk9wdGlvbnNcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIFZhbGlkIHRva2VuLCBub3RoaW5nIHRvIGRvLlxyXG4gICAgICAgIHJldHVybiB0b2tlbkRldGFpbHMudG9rZW47XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFRoaXMgbWV0aG9kIGRlbGV0ZXMgdGhlIHRva2VuIGZyb20gdGhlIGRhdGFiYXNlLCB1bnN1YnNjcmliZXMgdGhlIHRva2VuIGZyb20gRkNNLCBhbmQgdW5yZWdpc3RlcnNcclxuICogdGhlIHB1c2ggc3Vic2NyaXB0aW9uIGlmIGl0IGV4aXN0cy5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRva2VuSW50ZXJuYWwobWVzc2FnaW5nKSB7XHJcbiAgICBjb25zdCB0b2tlbkRldGFpbHMgPSBhd2FpdCBkYkdldChtZXNzYWdpbmcuZmlyZWJhc2VEZXBlbmRlbmNpZXMpO1xyXG4gICAgaWYgKHRva2VuRGV0YWlscykge1xyXG4gICAgICAgIGF3YWl0IHJlcXVlc3REZWxldGVUb2tlbihtZXNzYWdpbmcuZmlyZWJhc2VEZXBlbmRlbmNpZXMsIHRva2VuRGV0YWlscy50b2tlbik7XHJcbiAgICAgICAgYXdhaXQgZGJSZW1vdmUobWVzc2FnaW5nLmZpcmViYXNlRGVwZW5kZW5jaWVzKTtcclxuICAgIH1cclxuICAgIC8vIFVuc3Vic2NyaWJlIGZyb20gdGhlIHB1c2ggc3Vic2NyaXB0aW9uLlxyXG4gICAgY29uc3QgcHVzaFN1YnNjcmlwdGlvbiA9IGF3YWl0IG1lc3NhZ2luZy5zd1JlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTtcclxuICAgIGlmIChwdXNoU3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHB1c2hTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICAgIC8vIElmIHRoZXJlJ3Mgbm8gU1csIGNvbnNpZGVyIGl0IGEgc3VjY2Vzcy5cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVRva2VuKG1lc3NhZ2luZywgdG9rZW5EZXRhaWxzKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRUb2tlbiA9IGF3YWl0IHJlcXVlc3RVcGRhdGVUb2tlbihtZXNzYWdpbmcuZmlyZWJhc2VEZXBlbmRlbmNpZXMsIHRva2VuRGV0YWlscyk7XHJcbiAgICAgICAgY29uc3QgdXBkYXRlZFRva2VuRGV0YWlscyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdG9rZW5EZXRhaWxzKSwgeyB0b2tlbjogdXBkYXRlZFRva2VuLCBjcmVhdGVUaW1lOiBEYXRlLm5vdygpIH0pO1xyXG4gICAgICAgIGF3YWl0IGRiU2V0KG1lc3NhZ2luZy5maXJlYmFzZURlcGVuZGVuY2llcywgdXBkYXRlZFRva2VuRGV0YWlscyk7XHJcbiAgICAgICAgcmV0dXJuIHVwZGF0ZWRUb2tlbjtcclxuICAgIH1cclxuICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgYXdhaXQgZGVsZXRlVG9rZW5JbnRlcm5hbChtZXNzYWdpbmcpO1xyXG4gICAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbn1cclxuYXN5bmMgZnVuY3Rpb24gZ2V0TmV3VG9rZW4oZmlyZWJhc2VEZXBlbmRlbmNpZXMsIHN1YnNjcmlwdGlvbk9wdGlvbnMpIHtcclxuICAgIGNvbnN0IHRva2VuID0gYXdhaXQgcmVxdWVzdEdldFRva2VuKGZpcmViYXNlRGVwZW5kZW5jaWVzLCBzdWJzY3JpcHRpb25PcHRpb25zKTtcclxuICAgIGNvbnN0IHRva2VuRGV0YWlscyA9IHtcclxuICAgICAgICB0b2tlbixcclxuICAgICAgICBjcmVhdGVUaW1lOiBEYXRlLm5vdygpLFxyXG4gICAgICAgIHN1YnNjcmlwdGlvbk9wdGlvbnNcclxuICAgIH07XHJcbiAgICBhd2FpdCBkYlNldChmaXJlYmFzZURlcGVuZGVuY2llcywgdG9rZW5EZXRhaWxzKTtcclxuICAgIHJldHVybiB0b2tlbkRldGFpbHMudG9rZW47XHJcbn1cclxuLyoqXHJcbiAqIEdldHMgYSBQdXNoU3Vic2NyaXB0aW9uIGZvciB0aGUgY3VycmVudCB1c2VyLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0UHVzaFN1YnNjcmlwdGlvbihzd1JlZ2lzdHJhdGlvbiwgdmFwaWRLZXkpIHtcclxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHN3UmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLmdldFN1YnNjcmlwdGlvbigpO1xyXG4gICAgaWYgKHN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgIHJldHVybiBzdWJzY3JpcHRpb247XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3dSZWdpc3RyYXRpb24ucHVzaE1hbmFnZXIuc3Vic2NyaWJlKHtcclxuICAgICAgICB1c2VyVmlzaWJsZU9ubHk6IHRydWUsXHJcbiAgICAgICAgLy8gQ2hyb21lIDw9IDc1IGRvZXNuJ3Qgc3VwcG9ydCBiYXNlNjQtZW5jb2RlZCBWQVBJRCBrZXkuIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCBWQVBJRCBrZXlcclxuICAgICAgICAvLyBzdWJtaXR0ZWQgdG8gcHVzaE1hbmFnZXIjc3Vic2NyaWJlIG11c3QgYmUgb2YgdHlwZSBVaW50OEFycmF5LlxyXG4gICAgICAgIGFwcGxpY2F0aW9uU2VydmVyS2V5OiBiYXNlNjRUb0FycmF5KHZhcGlkS2V5KVxyXG4gICAgfSk7XHJcbn1cclxuLyoqXHJcbiAqIENoZWNrcyBpZiB0aGUgc2F2ZWQgdG9rZW5EZXRhaWxzIG9iamVjdCBtYXRjaGVzIHRoZSBjb25maWd1cmF0aW9uIHByb3ZpZGVkLlxyXG4gKi9cclxuZnVuY3Rpb24gaXNUb2tlblZhbGlkKGRiT3B0aW9ucywgY3VycmVudE9wdGlvbnMpIHtcclxuICAgIGNvbnN0IGlzVmFwaWRLZXlFcXVhbCA9IGN1cnJlbnRPcHRpb25zLnZhcGlkS2V5ID09PSBkYk9wdGlvbnMudmFwaWRLZXk7XHJcbiAgICBjb25zdCBpc0VuZHBvaW50RXF1YWwgPSBjdXJyZW50T3B0aW9ucy5lbmRwb2ludCA9PT0gZGJPcHRpb25zLmVuZHBvaW50O1xyXG4gICAgY29uc3QgaXNBdXRoRXF1YWwgPSBjdXJyZW50T3B0aW9ucy5hdXRoID09PSBkYk9wdGlvbnMuYXV0aDtcclxuICAgIGNvbnN0IGlzUDI1NmRoRXF1YWwgPSBjdXJyZW50T3B0aW9ucy5wMjU2ZGggPT09IGRiT3B0aW9ucy5wMjU2ZGg7XHJcbiAgICByZXR1cm4gaXNWYXBpZEtleUVxdWFsICYmIGlzRW5kcG9pbnRFcXVhbCAmJiBpc0F1dGhFcXVhbCAmJiBpc1AyNTZkaEVxdWFsO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGV4dGVybmFsaXplUGF5bG9hZChpbnRlcm5hbFBheWxvYWQpIHtcclxuICAgIGNvbnN0IHBheWxvYWQgPSB7XHJcbiAgICAgICAgZnJvbTogaW50ZXJuYWxQYXlsb2FkLmZyb20sXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxyXG4gICAgICAgIGNvbGxhcHNlS2V5OiBpbnRlcm5hbFBheWxvYWQuY29sbGFwc2Vfa2V5LFxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2VcclxuICAgICAgICBtZXNzYWdlSWQ6IGludGVybmFsUGF5bG9hZC5mY21NZXNzYWdlSWRcclxuICAgIH07XHJcbiAgICBwcm9wYWdhdGVOb3RpZmljYXRpb25QYXlsb2FkKHBheWxvYWQsIGludGVybmFsUGF5bG9hZCk7XHJcbiAgICBwcm9wYWdhdGVEYXRhUGF5bG9hZChwYXlsb2FkLCBpbnRlcm5hbFBheWxvYWQpO1xyXG4gICAgcHJvcGFnYXRlRmNtT3B0aW9ucyhwYXlsb2FkLCBpbnRlcm5hbFBheWxvYWQpO1xyXG4gICAgcmV0dXJuIHBheWxvYWQ7XHJcbn1cclxuZnVuY3Rpb24gcHJvcGFnYXRlTm90aWZpY2F0aW9uUGF5bG9hZChwYXlsb2FkLCBtZXNzYWdlUGF5bG9hZEludGVybmFsKSB7XHJcbiAgICBpZiAoIW1lc3NhZ2VQYXlsb2FkSW50ZXJuYWwubm90aWZpY2F0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgcGF5bG9hZC5ub3RpZmljYXRpb24gPSB7fTtcclxuICAgIGNvbnN0IHRpdGxlID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5ub3RpZmljYXRpb24udGl0bGU7XHJcbiAgICBpZiAoISF0aXRsZSkge1xyXG4gICAgICAgIHBheWxvYWQubm90aWZpY2F0aW9uLnRpdGxlID0gdGl0bGU7XHJcbiAgICB9XHJcbiAgICBjb25zdCBib2R5ID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5ub3RpZmljYXRpb24uYm9keTtcclxuICAgIGlmICghIWJvZHkpIHtcclxuICAgICAgICBwYXlsb2FkLm5vdGlmaWNhdGlvbi5ib2R5ID0gYm9keTtcclxuICAgIH1cclxuICAgIGNvbnN0IGltYWdlID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5ub3RpZmljYXRpb24uaW1hZ2U7XHJcbiAgICBpZiAoISFpbWFnZSkge1xyXG4gICAgICAgIHBheWxvYWQubm90aWZpY2F0aW9uLmltYWdlID0gaW1hZ2U7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpY29uID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5ub3RpZmljYXRpb24uaWNvbjtcclxuICAgIGlmICghIWljb24pIHtcclxuICAgICAgICBwYXlsb2FkLm5vdGlmaWNhdGlvbi5pY29uID0gaWNvbjtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwcm9wYWdhdGVEYXRhUGF5bG9hZChwYXlsb2FkLCBtZXNzYWdlUGF5bG9hZEludGVybmFsKSB7XHJcbiAgICBpZiAoIW1lc3NhZ2VQYXlsb2FkSW50ZXJuYWwuZGF0YSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHBheWxvYWQuZGF0YSA9IG1lc3NhZ2VQYXlsb2FkSW50ZXJuYWwuZGF0YTtcclxufVxyXG5mdW5jdGlvbiBwcm9wYWdhdGVGY21PcHRpb25zKHBheWxvYWQsIG1lc3NhZ2VQYXlsb2FkSW50ZXJuYWwpIHtcclxuICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2U7XHJcbiAgICAvLyBmY21PcHRpb25zLmxpbmsgdmFsdWUgaXMgd3JpdHRlbiBpbnRvIG5vdGlmaWNhdGlvbi5jbGlja19hY3Rpb24uIHNlZSBtb3JlIGluIGIvMjMyMDcyMTExXHJcbiAgICBpZiAoIW1lc3NhZ2VQYXlsb2FkSW50ZXJuYWwuZmNtT3B0aW9ucyAmJlxyXG4gICAgICAgICEoKF9hID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5ub3RpZmljYXRpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jbGlja19hY3Rpb24pKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgcGF5bG9hZC5mY21PcHRpb25zID0ge307XHJcbiAgICBjb25zdCBsaW5rID0gKF9jID0gKF9iID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5mY21PcHRpb25zKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IubGluaykgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogKF9kID0gbWVzc2FnZVBheWxvYWRJbnRlcm5hbC5ub3RpZmljYXRpb24pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC5jbGlja19hY3Rpb247XHJcbiAgICBpZiAoISFsaW5rKSB7XHJcbiAgICAgICAgcGF5bG9hZC5mY21PcHRpb25zLmxpbmsgPSBsaW5rO1xyXG4gICAgfVxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxyXG4gICAgY29uc3QgYW5hbHl0aWNzTGFiZWwgPSAoX2UgPSBtZXNzYWdlUGF5bG9hZEludGVybmFsLmZjbU9wdGlvbnMpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5hbmFseXRpY3NfbGFiZWw7XHJcbiAgICBpZiAoISFhbmFseXRpY3NMYWJlbCkge1xyXG4gICAgICAgIHBheWxvYWQuZmNtT3B0aW9ucy5hbmFseXRpY3NMYWJlbCA9IGFuYWx5dGljc0xhYmVsO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGlzQ29uc29sZU1lc3NhZ2UoZGF0YSkge1xyXG4gICAgLy8gVGhpcyBtZXNzYWdlIGhhcyBhIGNhbXBhaWduIElELCBtZWFuaW5nIGl0IHdhcyBzZW50IHVzaW5nIHRoZSBGaXJlYmFzZSBDb25zb2xlLlxyXG4gICAgcmV0dXJuIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJiAhIWRhdGEgJiYgQ09OU09MRV9DQU1QQUlHTl9JRCBpbiBkYXRhO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbl9tZXJnZVN0cmluZ3MoJ2h0cy9mcmJzbGdpZ3Aub2dlcHNjbXYvaWVvL2VheWxnJywgJ3RwOi9pZWFlb2duLWFnb2xhaS5vLzFmcmxnbGdjL28nKTtcclxuX21lcmdlU3RyaW5ncygnQXpTQ2J3NjNnMVIwbkN3ODVqRzgnLCAnSWF5YTN5TEt3bWd2aDdjRjBxNCcpO1xyXG5mdW5jdGlvbiBfbWVyZ2VTdHJpbmdzKHMxLCBzMikge1xyXG4gICAgY29uc3QgcmVzdWx0QXJyYXkgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgczEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICByZXN1bHRBcnJheS5wdXNoKHMxLmNoYXJBdChpKSk7XHJcbiAgICAgICAgaWYgKGkgPCBzMi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmVzdWx0QXJyYXkucHVzaChzMi5jaGFyQXQoaSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHRBcnJheS5qb2luKCcnKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBleHRyYWN0QXBwQ29uZmlnKGFwcCkge1xyXG4gICAgaWYgKCFhcHAgfHwgIWFwcC5vcHRpb25zKSB7XHJcbiAgICAgICAgdGhyb3cgZ2V0TWlzc2luZ1ZhbHVlRXJyb3IoJ0FwcCBDb25maWd1cmF0aW9uIE9iamVjdCcpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFhcHAubmFtZSkge1xyXG4gICAgICAgIHRocm93IGdldE1pc3NpbmdWYWx1ZUVycm9yKCdBcHAgTmFtZScpO1xyXG4gICAgfVxyXG4gICAgLy8gUmVxdWlyZWQgYXBwIGNvbmZpZyBrZXlzXHJcbiAgICBjb25zdCBjb25maWdLZXlzID0gW1xyXG4gICAgICAgICdwcm9qZWN0SWQnLFxyXG4gICAgICAgICdhcGlLZXknLFxyXG4gICAgICAgICdhcHBJZCcsXHJcbiAgICAgICAgJ21lc3NhZ2luZ1NlbmRlcklkJ1xyXG4gICAgXTtcclxuICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gYXBwO1xyXG4gICAgZm9yIChjb25zdCBrZXlOYW1lIG9mIGNvbmZpZ0tleXMpIHtcclxuICAgICAgICBpZiAoIW9wdGlvbnNba2V5TmFtZV0pIHtcclxuICAgICAgICAgICAgdGhyb3cgZ2V0TWlzc2luZ1ZhbHVlRXJyb3Ioa2V5TmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBhcHBOYW1lOiBhcHAubmFtZSxcclxuICAgICAgICBwcm9qZWN0SWQ6IG9wdGlvbnMucHJvamVjdElkLFxyXG4gICAgICAgIGFwaUtleTogb3B0aW9ucy5hcGlLZXksXHJcbiAgICAgICAgYXBwSWQ6IG9wdGlvbnMuYXBwSWQsXHJcbiAgICAgICAgc2VuZGVySWQ6IG9wdGlvbnMubWVzc2FnaW5nU2VuZGVySWRcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gZ2V0TWlzc2luZ1ZhbHVlRXJyb3IodmFsdWVOYW1lKSB7XHJcbiAgICByZXR1cm4gRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJtaXNzaW5nLWFwcC1jb25maWctdmFsdWVzXCIgLyogRXJyb3JDb2RlLk1JU1NJTkdfQVBQX0NPTkZJR19WQUxVRVMgKi8sIHtcclxuICAgICAgICB2YWx1ZU5hbWVcclxuICAgIH0pO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNsYXNzIE1lc3NhZ2luZ1NlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoYXBwLCBpbnN0YWxsYXRpb25zLCBhbmFseXRpY3NQcm92aWRlcikge1xyXG4gICAgICAgIC8vIGxvZ2dpbmcgaXMgb25seSBkb25lIHdpdGggZW5kIHVzZXIgY29uc2VudC4gRGVmYXVsdCB0byBmYWxzZS5cclxuICAgICAgICB0aGlzLmRlbGl2ZXJ5TWV0cmljc0V4cG9ydGVkVG9CaWdRdWVyeUVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm9uQmFja2dyb3VuZE1lc3NhZ2VIYW5kbGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLm9uTWVzc2FnZUhhbmRsZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubG9nRXZlbnRzID0gW107XHJcbiAgICAgICAgdGhpcy5pc0xvZ1NlcnZpY2VTdGFydGVkID0gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgYXBwQ29uZmlnID0gZXh0cmFjdEFwcENvbmZpZyhhcHApO1xyXG4gICAgICAgIHRoaXMuZmlyZWJhc2VEZXBlbmRlbmNpZXMgPSB7XHJcbiAgICAgICAgICAgIGFwcCxcclxuICAgICAgICAgICAgYXBwQ29uZmlnLFxyXG4gICAgICAgICAgICBpbnN0YWxsYXRpb25zLFxyXG4gICAgICAgICAgICBhbmFseXRpY3NQcm92aWRlclxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBfZGVsZXRlKCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiByZWdpc3RlckRlZmF1bHRTdyhtZXNzYWdpbmcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgbWVzc2FnaW5nLnN3UmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoREVGQVVMVF9TV19QQVRILCB7XHJcbiAgICAgICAgICAgIHNjb3BlOiBERUZBVUxUX1NXX1NDT1BFXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gVGhlIHRpbWluZyB3aGVuIGJyb3dzZXIgdXBkYXRlcyBzdyB3aGVuIHN3IGhhcyBhbiB1cGRhdGUgaXMgdW5yZWxpYWJsZSBmcm9tIGV4cGVyaW1lbnQuIEl0XHJcbiAgICAgICAgLy8gbGVhZHMgdG8gdmVyc2lvbiBjb25mbGljdCB3aGVuIHRoZSBTREsgdXBncmFkZXMgdG8gYSBuZXdlciB2ZXJzaW9uIGluIHRoZSBtYWluIHBhZ2UsIGJ1dCBzd1xyXG4gICAgICAgIC8vIGlzIHN0dWNrIHdpdGggdGhlIG9sZCB2ZXJzaW9uLiBGb3IgZXhhbXBsZSxcclxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy8yNTkwIFRoZSBmb2xsb3dpbmcgbGluZSByZWxpYWJseSB1cGRhdGVzXHJcbiAgICAgICAgLy8gc3cgaWYgdGhlcmUgd2FzIGFuIHVwZGF0ZS5cclxuICAgICAgICBtZXNzYWdpbmcuc3dSZWdpc3RyYXRpb24udXBkYXRlKCkuY2F0Y2goKCkgPT4ge1xyXG4gICAgICAgICAgICAvKiBpdCBpcyBub24gYmxvY2tpbmcgYW5kIHdlIGRvbid0IGNhcmUgaWYgaXQgZmFpbGVkICovXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiZmFpbGVkLXNlcnZpY2Utd29ya2VyLXJlZ2lzdHJhdGlvblwiIC8qIEVycm9yQ29kZS5GQUlMRURfREVGQVVMVF9SRUdJU1RSQVRJT04gKi8sIHtcclxuICAgICAgICAgICAgYnJvd3NlckVycm9yTWVzc2FnZTogZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLm1lc3NhZ2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVTd1JlZyhtZXNzYWdpbmcsIHN3UmVnaXN0cmF0aW9uKSB7XHJcbiAgICBpZiAoIXN3UmVnaXN0cmF0aW9uICYmICFtZXNzYWdpbmcuc3dSZWdpc3RyYXRpb24pIHtcclxuICAgICAgICBhd2FpdCByZWdpc3RlckRlZmF1bHRTdyhtZXNzYWdpbmcpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFzd1JlZ2lzdHJhdGlvbiAmJiAhIW1lc3NhZ2luZy5zd1JlZ2lzdHJhdGlvbikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghKHN3UmVnaXN0cmF0aW9uIGluc3RhbmNlb2YgU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbikpIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImludmFsaWQtc3ctcmVnaXN0cmF0aW9uXCIgLyogRXJyb3JDb2RlLklOVkFMSURfU1dfUkVHSVNUUkFUSU9OICovKTtcclxuICAgIH1cclxuICAgIG1lc3NhZ2luZy5zd1JlZ2lzdHJhdGlvbiA9IHN3UmVnaXN0cmF0aW9uO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVZhcGlkS2V5KG1lc3NhZ2luZywgdmFwaWRLZXkpIHtcclxuICAgIGlmICghIXZhcGlkS2V5KSB7XHJcbiAgICAgICAgbWVzc2FnaW5nLnZhcGlkS2V5ID0gdmFwaWRLZXk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICghbWVzc2FnaW5nLnZhcGlkS2V5KSB7XHJcbiAgICAgICAgbWVzc2FnaW5nLnZhcGlkS2V5ID0gREVGQVVMVF9WQVBJRF9LRVk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0VG9rZW4kMShtZXNzYWdpbmcsIG9wdGlvbnMpIHtcclxuICAgIGlmICghbmF2aWdhdG9yKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJvbmx5LWF2YWlsYWJsZS1pbi13aW5kb3dcIiAvKiBFcnJvckNvZGUuQVZBSUxBQkxFX0lOX1dJTkRPVyAqLyk7XHJcbiAgICB9XHJcbiAgICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09ICdkZWZhdWx0Jykge1xyXG4gICAgICAgIGF3YWl0IE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbigpO1xyXG4gICAgfVxyXG4gICAgaWYgKE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uICE9PSAnZ3JhbnRlZCcpIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcInBlcm1pc3Npb24tYmxvY2tlZFwiIC8qIEVycm9yQ29kZS5QRVJNSVNTSU9OX0JMT0NLRUQgKi8pO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgdXBkYXRlVmFwaWRLZXkobWVzc2FnaW5nLCBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMudmFwaWRLZXkpO1xyXG4gICAgYXdhaXQgdXBkYXRlU3dSZWcobWVzc2FnaW5nLCBvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuc2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbik7XHJcbiAgICByZXR1cm4gZ2V0VG9rZW5JbnRlcm5hbChtZXNzYWdpbmcpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGxvZ1RvU2Npb24obWVzc2FnaW5nLCBtZXNzYWdlVHlwZSwgZGF0YSkge1xyXG4gICAgY29uc3QgZXZlbnRUeXBlID0gZ2V0RXZlbnRUeXBlKG1lc3NhZ2VUeXBlKTtcclxuICAgIGNvbnN0IGFuYWx5dGljcyA9IGF3YWl0IG1lc3NhZ2luZy5maXJlYmFzZURlcGVuZGVuY2llcy5hbmFseXRpY3NQcm92aWRlci5nZXQoKTtcclxuICAgIGFuYWx5dGljcy5sb2dFdmVudChldmVudFR5cGUsIHtcclxuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBjYW1lbGNhc2UgKi9cclxuICAgICAgICBtZXNzYWdlX2lkOiBkYXRhW0NPTlNPTEVfQ0FNUEFJR05fSURdLFxyXG4gICAgICAgIG1lc3NhZ2VfbmFtZTogZGF0YVtDT05TT0xFX0NBTVBBSUdOX05BTUVdLFxyXG4gICAgICAgIG1lc3NhZ2VfdGltZTogZGF0YVtDT05TT0xFX0NBTVBBSUdOX1RJTUVdLFxyXG4gICAgICAgIG1lc3NhZ2VfZGV2aWNlX3RpbWU6IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApXHJcbiAgICAgICAgLyogZXNsaW50LWVuYWJsZSBjYW1lbGNhc2UgKi9cclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGdldEV2ZW50VHlwZShtZXNzYWdlVHlwZSkge1xyXG4gICAgc3dpdGNoIChtZXNzYWdlVHlwZSkge1xyXG4gICAgICAgIGNhc2UgTWVzc2FnZVR5cGUuTk9USUZJQ0FUSU9OX0NMSUNLRUQ6XHJcbiAgICAgICAgICAgIHJldHVybiAnbm90aWZpY2F0aW9uX29wZW4nO1xyXG4gICAgICAgIGNhc2UgTWVzc2FnZVR5cGUuUFVTSF9SRUNFSVZFRDpcclxuICAgICAgICAgICAgcmV0dXJuICdub3RpZmljYXRpb25fZm9yZWdyb3VuZCc7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gbWVzc2FnZUV2ZW50TGlzdGVuZXIobWVzc2FnaW5nLCBldmVudCkge1xyXG4gICAgY29uc3QgaW50ZXJuYWxQYXlsb2FkID0gZXZlbnQuZGF0YTtcclxuICAgIGlmICghaW50ZXJuYWxQYXlsb2FkLmlzRmlyZWJhc2VNZXNzYWdpbmcpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAobWVzc2FnaW5nLm9uTWVzc2FnZUhhbmRsZXIgJiZcclxuICAgICAgICBpbnRlcm5hbFBheWxvYWQubWVzc2FnZVR5cGUgPT09IE1lc3NhZ2VUeXBlLlBVU0hfUkVDRUlWRUQpIHtcclxuICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2luZy5vbk1lc3NhZ2VIYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2luZy5vbk1lc3NhZ2VIYW5kbGVyKGV4dGVybmFsaXplUGF5bG9hZChpbnRlcm5hbFBheWxvYWQpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG1lc3NhZ2luZy5vbk1lc3NhZ2VIYW5kbGVyLm5leHQoZXh0ZXJuYWxpemVQYXlsb2FkKGludGVybmFsUGF5bG9hZCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIExvZyB0byBTY2lvbiBpZiBhcHBsaWNhYmxlXHJcbiAgICBjb25zdCBkYXRhUGF5bG9hZCA9IGludGVybmFsUGF5bG9hZC5kYXRhO1xyXG4gICAgaWYgKGlzQ29uc29sZU1lc3NhZ2UoZGF0YVBheWxvYWQpICYmXHJcbiAgICAgICAgZGF0YVBheWxvYWRbQ09OU09MRV9DQU1QQUlHTl9BTkFMWVRJQ1NfRU5BQkxFRF0gPT09ICcxJykge1xyXG4gICAgICAgIGF3YWl0IGxvZ1RvU2Npb24obWVzc2FnaW5nLCBpbnRlcm5hbFBheWxvYWQubWVzc2FnZVR5cGUsIGRhdGFQYXlsb2FkKTtcclxuICAgIH1cclxufVxuXG5jb25zdCBuYW1lID0gXCJAZmlyZWJhc2UvbWVzc2FnaW5nXCI7XG5jb25zdCB2ZXJzaW9uID0gXCIwLjEyLjFcIjtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgV2luZG93TWVzc2FnaW5nRmFjdG9yeSA9IChjb250YWluZXIpID0+IHtcclxuICAgIGNvbnN0IG1lc3NhZ2luZyA9IG5ldyBNZXNzYWdpbmdTZXJ2aWNlKGNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCksIGNvbnRhaW5lci5nZXRQcm92aWRlcignaW5zdGFsbGF0aW9ucy1pbnRlcm5hbCcpLmdldEltbWVkaWF0ZSgpLCBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FuYWx5dGljcy1pbnRlcm5hbCcpKTtcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBlID0+IG1lc3NhZ2VFdmVudExpc3RlbmVyKG1lc3NhZ2luZywgZSkpO1xyXG4gICAgcmV0dXJuIG1lc3NhZ2luZztcclxufTtcclxuY29uc3QgV2luZG93TWVzc2FnaW5nSW50ZXJuYWxGYWN0b3J5ID0gKGNvbnRhaW5lcikgPT4ge1xyXG4gICAgY29uc3QgbWVzc2FnaW5nID0gY29udGFpbmVyXHJcbiAgICAgICAgLmdldFByb3ZpZGVyKCdtZXNzYWdpbmcnKVxyXG4gICAgICAgIC5nZXRJbW1lZGlhdGUoKTtcclxuICAgIGNvbnN0IG1lc3NhZ2luZ0ludGVybmFsID0ge1xyXG4gICAgICAgIGdldFRva2VuOiAob3B0aW9ucykgPT4gZ2V0VG9rZW4kMShtZXNzYWdpbmcsIG9wdGlvbnMpXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG1lc3NhZ2luZ0ludGVybmFsO1xyXG59O1xyXG5mdW5jdGlvbiByZWdpc3Rlck1lc3NhZ2luZ0luV2luZG93KCkge1xyXG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoJ21lc3NhZ2luZycsIFdpbmRvd01lc3NhZ2luZ0ZhY3RvcnksIFwiUFVCTElDXCIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pKTtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdtZXNzYWdpbmctaW50ZXJuYWwnLCBXaW5kb3dNZXNzYWdpbmdJbnRlcm5hbEZhY3RvcnksIFwiUFJJVkFURVwiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykpO1xyXG4gICAgcmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24pO1xyXG4gICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtNSwgZXNtMjAxNywgY2pzNSwgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cclxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCAnZXNtMjAxNycpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBDaGVja3MgaWYgYWxsIHJlcXVpcmVkIEFQSXMgZXhpc3QgaW4gdGhlIGJyb3dzZXIuXHJcbiAqIEByZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgYm9vbGVhbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gaXNXaW5kb3dTdXBwb3J0ZWQoKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIFRoaXMgdGhyb3dzIGlmIG9wZW4oKSBpcyB1bnN1cHBvcnRlZCwgc28gYWRkaW5nIGl0IHRvIHRoZSBjb25kaXRpb25hbFxyXG4gICAgICAgIC8vIHN0YXRlbWVudCBiZWxvdyBjYW4gY2F1c2UgYW4gdW5jYXVnaHQgZXJyb3IuXHJcbiAgICAgICAgYXdhaXQgdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSgpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvLyBmaXJlYmFzZS1qcy1zZGsvaXNzdWVzLzIzOTMgcmV2ZWFscyB0aGF0IGlkYiNvcGVuIGluIFNhZmFyaSBpZnJhbWUgYW5kIEZpcmVmb3ggcHJpdmF0ZSBicm93c2luZ1xyXG4gICAgLy8gbWlnaHQgYmUgcHJvaGliaXRlZCB0byBydW4uIEluIHRoZXNlIGNvbnRleHRzLCBhbiBlcnJvciB3b3VsZCBiZSB0aHJvd24gZHVyaW5nIHRoZSBtZXNzYWdpbmdcclxuICAgIC8vIGluc3RhbnRpYXRpbmcgcGhhc2UsIGluZm9ybWluZyB0aGUgZGV2ZWxvcGVycyB0byBpbXBvcnQvY2FsbCBpc1N1cHBvcnRlZCBmb3Igc3BlY2lhbCBoYW5kbGluZy5cclxuICAgIHJldHVybiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgICBpc0luZGV4ZWREQkF2YWlsYWJsZSgpICYmXHJcbiAgICAgICAgYXJlQ29va2llc0VuYWJsZWQoKSAmJlxyXG4gICAgICAgICdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiZcclxuICAgICAgICAnUHVzaE1hbmFnZXInIGluIHdpbmRvdyAmJlxyXG4gICAgICAgICdOb3RpZmljYXRpb24nIGluIHdpbmRvdyAmJlxyXG4gICAgICAgICdmZXRjaCcgaW4gd2luZG93ICYmXHJcbiAgICAgICAgU2VydmljZVdvcmtlclJlZ2lzdHJhdGlvbi5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoJ3Nob3dOb3RpZmljYXRpb24nKSAmJlxyXG4gICAgICAgIFB1c2hTdWJzY3JpcHRpb24ucHJvdG90eXBlLmhhc093blByb3BlcnR5KCdnZXRLZXknKSk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlVG9rZW4kMShtZXNzYWdpbmcpIHtcclxuICAgIGlmICghbmF2aWdhdG9yKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJvbmx5LWF2YWlsYWJsZS1pbi13aW5kb3dcIiAvKiBFcnJvckNvZGUuQVZBSUxBQkxFX0lOX1dJTkRPVyAqLyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIW1lc3NhZ2luZy5zd1JlZ2lzdHJhdGlvbikge1xyXG4gICAgICAgIGF3YWl0IHJlZ2lzdGVyRGVmYXVsdFN3KG1lc3NhZ2luZyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVsZXRlVG9rZW5JbnRlcm5hbChtZXNzYWdpbmcpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIG9uTWVzc2FnZSQxKG1lc3NhZ2luZywgbmV4dE9yT2JzZXJ2ZXIpIHtcclxuICAgIGlmICghbmF2aWdhdG9yKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJvbmx5LWF2YWlsYWJsZS1pbi13aW5kb3dcIiAvKiBFcnJvckNvZGUuQVZBSUxBQkxFX0lOX1dJTkRPVyAqLyk7XHJcbiAgICB9XHJcbiAgICBtZXNzYWdpbmcub25NZXNzYWdlSGFuZGxlciA9IG5leHRPck9ic2VydmVyO1xyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICBtZXNzYWdpbmcub25NZXNzYWdlSGFuZGxlciA9IG51bGw7XHJcbiAgICB9O1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbi8qKlxyXG4gKiBSZXRyaWV2ZXMgYSBGaXJlYmFzZSBDbG91ZCBNZXNzYWdpbmcgaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEByZXR1cm5zIFRoZSBGaXJlYmFzZSBDbG91ZCBNZXNzYWdpbmcgaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBwcm92aWRlZCBmaXJlYmFzZSBhcHAuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGdldE1lc3NhZ2luZ0luV2luZG93KGFwcCA9IGdldEFwcCgpKSB7XHJcbiAgICAvLyBDb25zY2lvdXMgZGVjaXNpb24gdG8gbWFrZSB0aGlzIGFzeW5jIGNoZWNrIG5vbi1ibG9ja2luZyBkdXJpbmcgdGhlIG1lc3NhZ2luZyBpbnN0YW5jZVxyXG4gICAgLy8gaW5pdGlhbGl6YXRpb24gcGhhc2UgZm9yIHBlcmZvcm1hbmNlIGNvbnNpZGVyYXRpb24uIEFuIGVycm9yIHdvdWxkIGJlIHRocm93biBsYXR0ZXIgZm9yXHJcbiAgICAvLyBkZXZlbG9wZXIncyBpbmZvcm1hdGlvbi4gRGV2ZWxvcGVycyBjYW4gdGhlbiBjaG9vc2UgdG8gaW1wb3J0IGFuZCBjYWxsIGBpc1N1cHBvcnRlZGAgZm9yXHJcbiAgICAvLyBzcGVjaWFsIGhhbmRsaW5nLlxyXG4gICAgaXNXaW5kb3dTdXBwb3J0ZWQoKS50aGVuKGlzU3VwcG9ydGVkID0+IHtcclxuICAgICAgICAvLyBJZiBgaXNXaW5kb3dTdXBwb3J0ZWQoKWAgcmVzb2x2ZWQsIGJ1dCByZXR1cm5lZCBmYWxzZS5cclxuICAgICAgICBpZiAoIWlzU3VwcG9ydGVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwidW5zdXBwb3J0ZWQtYnJvd3NlclwiIC8qIEVycm9yQ29kZS5VTlNVUFBPUlRFRF9CUk9XU0VSICovKTtcclxuICAgICAgICB9XHJcbiAgICB9LCBfID0+IHtcclxuICAgICAgICAvLyBJZiBgaXNXaW5kb3dTdXBwb3J0ZWQoKWAgcmVqZWN0ZWQuXHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpbmRleGVkLWRiLXVuc3VwcG9ydGVkXCIgLyogRXJyb3JDb2RlLklOREVYRURfREJfVU5TVVBQT1JURUQgKi8pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gX2dldFByb3ZpZGVyKGdldE1vZHVsYXJJbnN0YW5jZShhcHApLCAnbWVzc2FnaW5nJykuZ2V0SW1tZWRpYXRlKCk7XHJcbn1cclxuLyoqXHJcbiAqIFN1YnNjcmliZXMgdGhlIHtAbGluayBNZXNzYWdpbmd9IGluc3RhbmNlIHRvIHB1c2ggbm90aWZpY2F0aW9ucy4gUmV0dXJucyBhbiBGaXJlYmFzZSBDbG91ZFxyXG4gKiBNZXNzYWdpbmcgcmVnaXN0cmF0aW9uIHRva2VuIHRoYXQgY2FuIGJlIHVzZWQgdG8gc2VuZCBwdXNoIG1lc3NhZ2VzIHRvIHRoYXQge0BsaW5rIE1lc3NhZ2luZ31cclxuICogaW5zdGFuY2UuXHJcbiAqXHJcbiAqIElmIGEgbm90aWZpY2F0aW9uIHBlcm1pc3Npb24gaXNuJ3QgYWxyZWFkeSBncmFudGVkLCB0aGlzIG1ldGhvZCBhc2tzIHRoZSB1c2VyIGZvciBwZXJtaXNzaW9uLiBUaGVcclxuICogcmV0dXJuZWQgcHJvbWlzZSByZWplY3RzIGlmIHRoZSB1c2VyIGRvZXMgbm90IGFsbG93IHRoZSBhcHAgdG8gc2hvdyBub3RpZmljYXRpb25zLlxyXG4gKlxyXG4gKiBAcGFyYW0gbWVzc2FnaW5nIC0gVGhlIHtAbGluayBNZXNzYWdpbmd9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gb3B0aW9ucyAtIFByb3ZpZGVzIGFuIG9wdGlvbmFsIHZhcGlkIGtleSBhbmQgYW4gb3B0aW5vYWwgc2VydmljZSB3b3JrZXIgcmVnaXN0cmF0aW9uXHJcbiAqXHJcbiAqIEByZXR1cm5zIFRoZSBwcm9taXNlIHJlc29sdmVzIHdpdGggYW4gRkNNIHJlZ2lzdHJhdGlvbiB0b2tlbi5cclxuICpcclxuICogQHB1YmxpY1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0VG9rZW4obWVzc2FnaW5nLCBvcHRpb25zKSB7XHJcbiAgICBtZXNzYWdpbmcgPSBnZXRNb2R1bGFySW5zdGFuY2UobWVzc2FnaW5nKTtcclxuICAgIHJldHVybiBnZXRUb2tlbiQxKG1lc3NhZ2luZywgb3B0aW9ucyk7XHJcbn1cclxuLyoqXHJcbiAqIERlbGV0ZXMgdGhlIHJlZ2lzdHJhdGlvbiB0b2tlbiBhc3NvY2lhdGVkIHdpdGggdGhpcyB7QGxpbmsgTWVzc2FnaW5nfSBpbnN0YW5jZSBhbmQgdW5zdWJzY3JpYmVzXHJcbiAqIHRoZSB7QGxpbmsgTWVzc2FnaW5nfSBpbnN0YW5jZSBmcm9tIHRoZSBwdXNoIHN1YnNjcmlwdGlvbi5cclxuICpcclxuICogQHBhcmFtIG1lc3NhZ2luZyAtIFRoZSB7QGxpbmsgTWVzc2FnaW5nfSBpbnN0YW5jZS5cclxuICpcclxuICogQHJldHVybnMgVGhlIHByb21pc2UgcmVzb2x2ZXMgd2hlbiB0aGUgdG9rZW4gaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuXHJcbiAqXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGRlbGV0ZVRva2VuKG1lc3NhZ2luZykge1xyXG4gICAgbWVzc2FnaW5nID0gZ2V0TW9kdWxhckluc3RhbmNlKG1lc3NhZ2luZyk7XHJcbiAgICByZXR1cm4gZGVsZXRlVG9rZW4kMShtZXNzYWdpbmcpO1xyXG59XHJcbi8qKlxyXG4gKiBXaGVuIGEgcHVzaCBtZXNzYWdlIGlzIHJlY2VpdmVkIGFuZCB0aGUgdXNlciBpcyBjdXJyZW50bHkgb24gYSBwYWdlIGZvciB5b3VyIG9yaWdpbiwgdGhlXHJcbiAqIG1lc3NhZ2UgaXMgcGFzc2VkIHRvIHRoZSBwYWdlIGFuZCBhbiBgb25NZXNzYWdlKClgIGV2ZW50IGlzIGRpc3BhdGNoZWQgd2l0aCB0aGUgcGF5bG9hZCBvZlxyXG4gKiB0aGUgcHVzaCBtZXNzYWdlLlxyXG4gKlxyXG4gKlxyXG4gKiBAcGFyYW0gbWVzc2FnaW5nIC0gVGhlIHtAbGluayBNZXNzYWdpbmd9IGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gbmV4dE9yT2JzZXJ2ZXIgLSBUaGlzIGZ1bmN0aW9uLCBvciBvYnNlcnZlciBvYmplY3Qgd2l0aCBgbmV4dGAgZGVmaW5lZCxcclxuICogICAgIGlzIGNhbGxlZCB3aGVuIGEgbWVzc2FnZSBpcyByZWNlaXZlZCBhbmQgdGhlIHVzZXIgaXMgY3VycmVudGx5IHZpZXdpbmcgeW91ciBwYWdlLlxyXG4gKiBAcmV0dXJucyBUbyBzdG9wIGxpc3RlbmluZyBmb3IgbWVzc2FnZXMgZXhlY3V0ZSB0aGlzIHJldHVybmVkIGZ1bmN0aW9uLlxyXG4gKlxyXG4gKiBAcHVibGljXHJcbiAqL1xyXG5mdW5jdGlvbiBvbk1lc3NhZ2UobWVzc2FnaW5nLCBuZXh0T3JPYnNlcnZlcikge1xyXG4gICAgbWVzc2FnaW5nID0gZ2V0TW9kdWxhckluc3RhbmNlKG1lc3NhZ2luZyk7XHJcbiAgICByZXR1cm4gb25NZXNzYWdlJDEobWVzc2FnaW5nLCBuZXh0T3JPYnNlcnZlcik7XHJcbn1cblxuLyoqXHJcbiAqIEZpcmViYXNlIENsb3VkIE1lc3NhZ2luZ1xyXG4gKlxyXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cclxuICovXHJcbnJlZ2lzdGVyTWVzc2FnaW5nSW5XaW5kb3coKTtcblxuZXhwb3J0IHsgZGVsZXRlVG9rZW4sIGdldE1lc3NhZ2luZ0luV2luZG93IGFzIGdldE1lc3NhZ2luZywgZ2V0VG9rZW4sIGlzV2luZG93U3VwcG9ydGVkIGFzIGlzU3VwcG9ydGVkLCBvbk1lc3NhZ2UgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCJpbXBvcnQgeyBFcnJvckZhY3RvcnksIGFyZUNvb2tpZXNFbmFibGVkLCBpc0luZGV4ZWREQkF2YWlsYWJsZSwgdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSwgZ2V0TW9kdWxhckluc3RhbmNlLCBkZWVwRXF1YWwgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBMb2dnZXIsIExvZ0xldmVsIH0gZnJvbSAnQGZpcmViYXNlL2xvZ2dlcic7XG5pbXBvcnQgeyBfZ2V0UHJvdmlkZXIsIGdldEFwcCwgX3JlZ2lzdGVyQ29tcG9uZW50LCByZWdpc3RlclZlcnNpb24gfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0BmaXJlYmFzZS9jb21wb25lbnQnO1xuaW1wb3J0ICdAZmlyZWJhc2UvaW5zdGFsbGF0aW9ucyc7XG5cbmNvbnN0IG5hbWUgPSBcIkBmaXJlYmFzZS9wZXJmb3JtYW5jZVwiO1xuY29uc3QgdmVyc2lvbiA9IFwiMC42LjFcIjtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgU0RLX1ZFUlNJT04gPSB2ZXJzaW9uO1xyXG4vKiogVGhlIHByZWZpeCBmb3Igc3RhcnQgVXNlciBUaW1pbmcgbWFya3MgdXNlZCBmb3IgY3JlYXRpbmcgVHJhY2VzLiAqL1xyXG5jb25zdCBUUkFDRV9TVEFSVF9NQVJLX1BSRUZJWCA9ICdGQi1QRVJGLVRSQUNFLVNUQVJUJztcclxuLyoqIFRoZSBwcmVmaXggZm9yIHN0b3AgVXNlciBUaW1pbmcgbWFya3MgdXNlZCBmb3IgY3JlYXRpbmcgVHJhY2VzLiAqL1xyXG5jb25zdCBUUkFDRV9TVE9QX01BUktfUFJFRklYID0gJ0ZCLVBFUkYtVFJBQ0UtU1RPUCc7XHJcbi8qKiBUaGUgcHJlZml4IGZvciBVc2VyIFRpbWluZyBtZWFzdXJlIHVzZWQgZm9yIGNyZWF0aW5nIFRyYWNlcy4gKi9cclxuY29uc3QgVFJBQ0VfTUVBU1VSRV9QUkVGSVggPSAnRkItUEVSRi1UUkFDRS1NRUFTVVJFJztcclxuLyoqIFRoZSBwcmVmaXggZm9yIG91dCBvZiB0aGUgYm94IHBhZ2UgbG9hZCBUcmFjZSBuYW1lLiAqL1xyXG5jb25zdCBPT0JfVFJBQ0VfUEFHRV9MT0FEX1BSRUZJWCA9ICdfd3RfJztcclxuY29uc3QgRklSU1RfUEFJTlRfQ09VTlRFUl9OQU1FID0gJ19mcCc7XHJcbmNvbnN0IEZJUlNUX0NPTlRFTlRGVUxfUEFJTlRfQ09VTlRFUl9OQU1FID0gJ19mY3AnO1xyXG5jb25zdCBGSVJTVF9JTlBVVF9ERUxBWV9DT1VOVEVSX05BTUUgPSAnX2ZpZCc7XHJcbmNvbnN0IENPTkZJR19MT0NBTF9TVE9SQUdFX0tFWSA9ICdAZmlyZWJhc2UvcGVyZm9ybWFuY2UvY29uZmlnJztcclxuY29uc3QgQ09ORklHX0VYUElSWV9MT0NBTF9TVE9SQUdFX0tFWSA9ICdAZmlyZWJhc2UvcGVyZm9ybWFuY2UvY29uZmlnZXhwaXJlJztcclxuY29uc3QgU0VSVklDRSA9ICdwZXJmb3JtYW5jZSc7XHJcbmNvbnN0IFNFUlZJQ0VfTkFNRSA9ICdQZXJmb3JtYW5jZSc7XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IEVSUk9SX0RFU0NSSVBUSU9OX01BUCA9IHtcclxuICAgIFtcInRyYWNlIHN0YXJ0ZWRcIiAvKiBFcnJvckNvZGUuVFJBQ0VfU1RBUlRFRF9CRUZPUkUgKi9dOiAnVHJhY2UgeyR0cmFjZU5hbWV9IHdhcyBzdGFydGVkIGJlZm9yZS4nLFxyXG4gICAgW1widHJhY2Ugc3RvcHBlZFwiIC8qIEVycm9yQ29kZS5UUkFDRV9TVE9QUEVEX0JFRk9SRSAqL106ICdUcmFjZSB7JHRyYWNlTmFtZX0gaXMgbm90IHJ1bm5pbmcuJyxcclxuICAgIFtcIm5vbnBvc2l0aXZlIHRyYWNlIHN0YXJ0VGltZVwiIC8qIEVycm9yQ29kZS5OT05QT1NJVElWRV9UUkFDRV9TVEFSVF9USU1FICovXTogJ1RyYWNlIHskdHJhY2VOYW1lfSBzdGFydFRpbWUgc2hvdWxkIGJlIHBvc2l0aXZlLicsXHJcbiAgICBbXCJub25wb3NpdGl2ZSB0cmFjZSBkdXJhdGlvblwiIC8qIEVycm9yQ29kZS5OT05QT1NJVElWRV9UUkFDRV9EVVJBVElPTiAqL106ICdUcmFjZSB7JHRyYWNlTmFtZX0gZHVyYXRpb24gc2hvdWxkIGJlIHBvc2l0aXZlLicsXHJcbiAgICBbXCJubyB3aW5kb3dcIiAvKiBFcnJvckNvZGUuTk9fV0lORE9XICovXTogJ1dpbmRvdyBpcyBub3QgYXZhaWxhYmxlLicsXHJcbiAgICBbXCJubyBhcHAgaWRcIiAvKiBFcnJvckNvZGUuTk9fQVBQX0lEICovXTogJ0FwcCBpZCBpcyBub3QgYXZhaWxhYmxlLicsXHJcbiAgICBbXCJubyBwcm9qZWN0IGlkXCIgLyogRXJyb3JDb2RlLk5PX1BST0pFQ1RfSUQgKi9dOiAnUHJvamVjdCBpZCBpcyBub3QgYXZhaWxhYmxlLicsXHJcbiAgICBbXCJubyBhcGkga2V5XCIgLyogRXJyb3JDb2RlLk5PX0FQSV9LRVkgKi9dOiAnQXBpIGtleSBpcyBub3QgYXZhaWxhYmxlLicsXHJcbiAgICBbXCJpbnZhbGlkIGNjIGxvZ1wiIC8qIEVycm9yQ29kZS5JTlZBTElEX0NDX0xPRyAqL106ICdBdHRlbXB0ZWQgdG8gcXVldWUgaW52YWxpZCBjYyBldmVudCcsXHJcbiAgICBbXCJGQiBub3QgZGVmYXVsdFwiIC8qIEVycm9yQ29kZS5GQl9OT1RfREVGQVVMVCAqL106ICdQZXJmb3JtYW5jZSBjYW4gb25seSBzdGFydCB3aGVuIEZpcmViYXNlIGFwcCBpbnN0YW5jZSBpcyB0aGUgZGVmYXVsdCBvbmUuJyxcclxuICAgIFtcIlJDIHJlc3BvbnNlIG5vdCBva1wiIC8qIEVycm9yQ29kZS5SQ19OT1RfT0sgKi9dOiAnUkMgcmVzcG9uc2UgaXMgbm90IG9rJyxcclxuICAgIFtcImludmFsaWQgYXR0cmlidXRlIG5hbWVcIiAvKiBFcnJvckNvZGUuSU5WQUxJRF9BVFRSSUJVVEVfTkFNRSAqL106ICdBdHRyaWJ1dGUgbmFtZSB7JGF0dHJpYnV0ZU5hbWV9IGlzIGludmFsaWQuJyxcclxuICAgIFtcImludmFsaWQgYXR0cmlidXRlIHZhbHVlXCIgLyogRXJyb3JDb2RlLklOVkFMSURfQVRUUklCVVRFX1ZBTFVFICovXTogJ0F0dHJpYnV0ZSB2YWx1ZSB7JGF0dHJpYnV0ZVZhbHVlfSBpcyBpbnZhbGlkLicsXHJcbiAgICBbXCJpbnZhbGlkIGN1c3RvbSBtZXRyaWMgbmFtZVwiIC8qIEVycm9yQ29kZS5JTlZBTElEX0NVU1RPTV9NRVRSSUNfTkFNRSAqL106ICdDdXN0b20gbWV0cmljIG5hbWUgeyRjdXN0b21NZXRyaWNOYW1lfSBpcyBpbnZhbGlkJyxcclxuICAgIFtcImludmFsaWQgU3RyaW5nIG1lcmdlciBpbnB1dFwiIC8qIEVycm9yQ29kZS5JTlZBTElEX1NUUklOR19NRVJHRVJfUEFSQU1FVEVSICovXTogJ0lucHV0IGZvciBTdHJpbmcgbWVyZ2VyIGlzIGludmFsaWQsIGNvbnRhY3Qgc3VwcG9ydCB0ZWFtIHRvIHJlc29sdmUuJyxcclxuICAgIFtcImFscmVhZHkgaW5pdGlhbGl6ZWRcIiAvKiBFcnJvckNvZGUuQUxSRUFEWV9JTklUSUFMSVpFRCAqL106ICdpbml0aWFsaXplUGVyZm9ybWFuY2UoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCB3aXRoICcgK1xyXG4gICAgICAgICdkaWZmZXJlbnQgb3B0aW9ucy4gVG8gYXZvaWQgdGhpcyBlcnJvciwgY2FsbCBpbml0aWFsaXplUGVyZm9ybWFuY2UoKSB3aXRoIHRoZSAnICtcclxuICAgICAgICAnc2FtZSBvcHRpb25zIGFzIHdoZW4gaXQgd2FzIG9yaWdpbmFsbHkgY2FsbGVkLCBvciBjYWxsIGdldFBlcmZvcm1hbmNlKCkgdG8gcmV0dXJuIHRoZScgK1xyXG4gICAgICAgICcgYWxyZWFkeSBpbml0aWFsaXplZCBpbnN0YW5jZS4nXHJcbn07XHJcbmNvbnN0IEVSUk9SX0ZBQ1RPUlkgPSBuZXcgRXJyb3JGYWN0b3J5KFNFUlZJQ0UsIFNFUlZJQ0VfTkFNRSwgRVJST1JfREVTQ1JJUFRJT05fTUFQKTtcblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgY29uc29sZUxvZ2dlciA9IG5ldyBMb2dnZXIoU0VSVklDRV9OQU1FKTtcclxuY29uc29sZUxvZ2dlci5sb2dMZXZlbCA9IExvZ0xldmVsLklORk87XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmxldCBhcGlJbnN0YW5jZTtcclxubGV0IHdpbmRvd0luc3RhbmNlO1xyXG4vKipcclxuICogVGhpcyBjbGFzcyBob2xkcyBhIHJlZmVyZW5jZSB0byB2YXJpb3VzIGJyb3dzZXIgcmVsYXRlZCBvYmplY3RzIGluamVjdGVkIGJ5XHJcbiAqIHNldCBtZXRob2RzLlxyXG4gKi9cclxuY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKHdpbmRvdykge1xyXG4gICAgICAgIHRoaXMud2luZG93ID0gd2luZG93O1xyXG4gICAgICAgIGlmICghd2luZG93KSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm8gd2luZG93XCIgLyogRXJyb3JDb2RlLk5PX1dJTkRPVyAqLyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucGVyZm9ybWFuY2UgPSB3aW5kb3cucGVyZm9ybWFuY2U7XHJcbiAgICAgICAgdGhpcy5QZXJmb3JtYW5jZU9ic2VydmVyID0gd2luZG93LlBlcmZvcm1hbmNlT2JzZXJ2ZXI7XHJcbiAgICAgICAgdGhpcy53aW5kb3dMb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjtcclxuICAgICAgICB0aGlzLm5hdmlnYXRvciA9IHdpbmRvdy5uYXZpZ2F0b3I7XHJcbiAgICAgICAgdGhpcy5kb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudDtcclxuICAgICAgICBpZiAodGhpcy5uYXZpZ2F0b3IgJiYgdGhpcy5uYXZpZ2F0b3IuY29va2llRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAvLyBJZiB1c2VyIGJsb2NrcyBjb29raWVzIG9uIHRoZSBicm93c2VyLCBhY2Nlc3NpbmcgbG9jYWxTdG9yYWdlIHdpbGxcclxuICAgICAgICAgICAgLy8gdGhyb3cgYW4gZXhjZXB0aW9uLlxyXG4gICAgICAgICAgICB0aGlzLmxvY2FsU3RvcmFnZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh3aW5kb3cucGVyZk1ldHJpY3MgJiYgd2luZG93LnBlcmZNZXRyaWNzLm9uRmlyc3RJbnB1dERlbGF5KSB7XHJcbiAgICAgICAgICAgIHRoaXMub25GaXJzdElucHV0RGVsYXkgPSB3aW5kb3cucGVyZk1ldHJpY3Mub25GaXJzdElucHV0RGVsYXk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0VXJsKCkge1xyXG4gICAgICAgIC8vIERvIG5vdCBjYXB0dXJlIHRoZSBzdHJpbmcgcXVlcnkgcGFydCBvZiB1cmwuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMud2luZG93TG9jYXRpb24uaHJlZi5zcGxpdCgnPycpWzBdO1xyXG4gICAgfVxyXG4gICAgbWFyayhuYW1lKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnBlcmZvcm1hbmNlIHx8ICF0aGlzLnBlcmZvcm1hbmNlLm1hcmspIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBlcmZvcm1hbmNlLm1hcmsobmFtZSk7XHJcbiAgICB9XHJcbiAgICBtZWFzdXJlKG1lYXN1cmVOYW1lLCBtYXJrMSwgbWFyazIpIHtcclxuICAgICAgICBpZiAoIXRoaXMucGVyZm9ybWFuY2UgfHwgIXRoaXMucGVyZm9ybWFuY2UubWVhc3VyZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucGVyZm9ybWFuY2UubWVhc3VyZShtZWFzdXJlTmFtZSwgbWFyazEsIG1hcmsyKTtcclxuICAgIH1cclxuICAgIGdldEVudHJpZXNCeVR5cGUodHlwZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5wZXJmb3JtYW5jZSB8fCAhdGhpcy5wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlUeXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5VHlwZSh0eXBlKTtcclxuICAgIH1cclxuICAgIGdldEVudHJpZXNCeU5hbWUobmFtZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5wZXJmb3JtYW5jZSB8fCAhdGhpcy5wZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5TmFtZShuYW1lKTtcclxuICAgIH1cclxuICAgIGdldFRpbWVPcmlnaW4oKSB7XHJcbiAgICAgICAgLy8gUG9seWZpbGwgdGhlIHRpbWUgb3JpZ2luIHdpdGggcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydC5cclxuICAgICAgICByZXR1cm4gKHRoaXMucGVyZm9ybWFuY2UgJiZcclxuICAgICAgICAgICAgKHRoaXMucGVyZm9ybWFuY2UudGltZU9yaWdpbiB8fCB0aGlzLnBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQpKTtcclxuICAgIH1cclxuICAgIHJlcXVpcmVkQXBpc0F2YWlsYWJsZSgpIHtcclxuICAgICAgICBpZiAoIWZldGNoIHx8ICFQcm9taXNlIHx8ICFhcmVDb29raWVzRW5hYmxlZCgpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGVMb2dnZXIuaW5mbygnRmlyZWJhc2UgUGVyZm9ybWFuY2UgY2Fubm90IHN0YXJ0IGlmIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBmZXRjaCBhbmQgUHJvbWlzZSBvciBjb29raWUgaXMgZGlzYWJsZWQuJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpc0luZGV4ZWREQkF2YWlsYWJsZSgpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGVMb2dnZXIuaW5mbygnSW5kZXhlZERCIGlzIG5vdCBzdXBwb3J0ZWQgYnkgY3VycmVudCBicm93c3dlcicpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgc2V0dXBPYnNlcnZlcihlbnRyeVR5cGUsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLlBlcmZvcm1hbmNlT2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyB0aGlzLlBlcmZvcm1hbmNlT2JzZXJ2ZXIobGlzdCA9PiB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgbGlzdC5nZXRFbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIGBlbnRyeWAgaXMgYSBQZXJmb3JtYW5jZUVudHJ5IGluc3RhbmNlLlxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZW50cnkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gU3RhcnQgb2JzZXJ2aW5nIHRoZSBlbnRyeSB0eXBlcyB5b3UgY2FyZSBhYm91dC5cclxuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHsgZW50cnlUeXBlczogW2VudHJ5VHlwZV0gfSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XHJcbiAgICAgICAgaWYgKGFwaUluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgYXBpSW5zdGFuY2UgPSBuZXcgQXBpKHdpbmRvd0luc3RhbmNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFwaUluc3RhbmNlO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHNldHVwQXBpKHdpbmRvdykge1xyXG4gICAgd2luZG93SW5zdGFuY2UgPSB3aW5kb3c7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxubGV0IGlpZDtcclxuZnVuY3Rpb24gZ2V0SWlkUHJvbWlzZShpbnN0YWxsYXRpb25zU2VydmljZSkge1xyXG4gICAgY29uc3QgaWlkUHJvbWlzZSA9IGluc3RhbGxhdGlvbnNTZXJ2aWNlLmdldElkKCk7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICBpaWRQcm9taXNlLnRoZW4oKGlpZFZhbCkgPT4ge1xyXG4gICAgICAgIGlpZCA9IGlpZFZhbDtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGlpZFByb21pc2U7XHJcbn1cclxuLy8gVGhpcyBtZXRob2Qgc2hvdWxkIGJlIHVzZWQgYWZ0ZXIgdGhlIGlpZCBpcyByZXRyaWV2ZWQgYnkgZ2V0SWlkUHJvbWlzZSBtZXRob2QuXHJcbmZ1bmN0aW9uIGdldElpZCgpIHtcclxuICAgIHJldHVybiBpaWQ7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QXV0aFRva2VuUHJvbWlzZShpbnN0YWxsYXRpb25zU2VydmljZSkge1xyXG4gICAgY29uc3QgYXV0aFRva2VuUHJvbWlzZSA9IGluc3RhbGxhdGlvbnNTZXJ2aWNlLmdldFRva2VuKCk7XHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXHJcbiAgICBhdXRoVG9rZW5Qcm9taXNlLnRoZW4oKGF1dGhUb2tlblZhbCkgPT4ge1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gYXV0aFRva2VuUHJvbWlzZTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBtZXJnZVN0cmluZ3MocGFydDEsIHBhcnQyKSB7XHJcbiAgICBjb25zdCBzaXplRGlmZiA9IHBhcnQxLmxlbmd0aCAtIHBhcnQyLmxlbmd0aDtcclxuICAgIGlmIChzaXplRGlmZiA8IDAgfHwgc2l6ZURpZmYgPiAxKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpbnZhbGlkIFN0cmluZyBtZXJnZXIgaW5wdXRcIiAvKiBFcnJvckNvZGUuSU5WQUxJRF9TVFJJTkdfTUVSR0VSX1BBUkFNRVRFUiAqLyk7XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXN1bHRBcnJheSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0MS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHJlc3VsdEFycmF5LnB1c2gocGFydDEuY2hhckF0KGkpKTtcclxuICAgICAgICBpZiAocGFydDIubGVuZ3RoID4gaSkge1xyXG4gICAgICAgICAgICByZXN1bHRBcnJheS5wdXNoKHBhcnQyLmNoYXJBdChpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdEFycmF5LmpvaW4oJycpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmxldCBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZTtcclxuY2xhc3MgU2V0dGluZ3NTZXJ2aWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIC8vIFRoZSB2YXJpYWJsZSB3aGljaCBjb250cm9scyBsb2dnaW5nIG9mIGF1dG9tYXRpYyB0cmFjZXMgYW5kIEhUVFAvUyBuZXR3b3JrIG1vbml0b3JpbmcuXHJcbiAgICAgICAgdGhpcy5pbnN0cnVtZW50YXRpb25FbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAvLyBUaGUgdmFyaWFibGUgd2hpY2ggY29udHJvbHMgbG9nZ2luZyBvZiBjdXN0b20gdHJhY2VzLlxyXG4gICAgICAgIHRoaXMuZGF0YUNvbGxlY3Rpb25FbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAvLyBDb25maWd1cmF0aW9uIGZsYWdzIHNldCB0aHJvdWdoIHJlbW90ZSBjb25maWcuXHJcbiAgICAgICAgdGhpcy5sb2dnaW5nRW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgIC8vIFNhbXBsaW5nIHJhdGUgYmV0d2VlbiAwIGFuZCAxLlxyXG4gICAgICAgIHRoaXMudHJhY2VzU2FtcGxpbmdSYXRlID0gMTtcclxuICAgICAgICB0aGlzLm5ldHdvcmtSZXF1ZXN0c1NhbXBsaW5nUmF0ZSA9IDE7XHJcbiAgICAgICAgLy8gQWRkcmVzcyBvZiBsb2dnaW5nIHNlcnZpY2UuXHJcbiAgICAgICAgdGhpcy5sb2dFbmRQb2ludFVybCA9ICdodHRwczovL2ZpcmViYXNlbG9nZ2luZy5nb29nbGVhcGlzLmNvbS92MGNjL2xvZz9mb3JtYXQ9anNvbl9wcm90byc7XHJcbiAgICAgICAgLy8gUGVyZm9ybWFuY2UgZXZlbnQgdHJhbnNwb3J0IGVuZHBvaW50IFVSTCB3aGljaCBzaG91bGQgYmUgY29tcGF0aWJsZSB3aXRoIHByb3RvMy5cclxuICAgICAgICAvLyBOZXcgQWRkcmVzcyBmb3IgdHJhbnNwb3J0IHNlcnZpY2UsIG5vdCBjb25maWd1cmFibGUgdmlhIFJlbW90ZSBDb25maWcuXHJcbiAgICAgICAgdGhpcy5mbFRyYW5zcG9ydEVuZHBvaW50VXJsID0gbWVyZ2VTdHJpbmdzKCdodHMvZnJic2xnaWdwLm9nZXBzY212L2llby9lYXlsZycsICd0cDovaWVhZW9nbi1hZ29sYWkuby8xZnJsZ2xnYy9vJyk7XHJcbiAgICAgICAgdGhpcy50cmFuc3BvcnRLZXkgPSBtZXJnZVN0cmluZ3MoJ0F6U0M4cjZSZWlHcUZNeWZ2Z293JywgJ0lheXgwdS1YVDN2a3NWTS1wSVYnKTtcclxuICAgICAgICAvLyBTb3VyY2UgdHlwZSBmb3IgcGVyZm9ybWFuY2UgZXZlbnQgbG9ncy5cclxuICAgICAgICB0aGlzLmxvZ1NvdXJjZSA9IDQ2MjtcclxuICAgICAgICAvLyBGbGFncyB3aGljaCBjb250cm9sIHBlciBzZXNzaW9uIGxvZ2dpbmcgb2YgdHJhY2VzIGFuZCBuZXR3b3JrIHJlcXVlc3RzLlxyXG4gICAgICAgIHRoaXMubG9nVHJhY2VBZnRlclNhbXBsaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sb2dOZXR3b3JrQWZ0ZXJTYW1wbGluZyA9IGZhbHNlO1xyXG4gICAgICAgIC8vIFRUTCBvZiBjb25maWcgcmV0cmlldmVkIGZyb20gcmVtb3RlIGNvbmZpZyBpbiBob3Vycy5cclxuICAgICAgICB0aGlzLmNvbmZpZ1RpbWVUb0xpdmUgPSAxMjtcclxuICAgIH1cclxuICAgIGdldEZsVHJhbnNwb3J0RnVsbFVybCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5mbFRyYW5zcG9ydEVuZHBvaW50VXJsLmNvbmNhdCgnP2tleT0nLCB0aGlzLnRyYW5zcG9ydEtleSk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XHJcbiAgICAgICAgaWYgKHNldHRpbmdzU2VydmljZUluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgc2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UgPSBuZXcgU2V0dGluZ3NTZXJ2aWNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG52YXIgVmlzaWJpbGl0eVN0YXRlO1xyXG4oZnVuY3Rpb24gKFZpc2liaWxpdHlTdGF0ZSkge1xyXG4gICAgVmlzaWJpbGl0eVN0YXRlW1Zpc2liaWxpdHlTdGF0ZVtcIlVOS05PV05cIl0gPSAwXSA9IFwiVU5LTk9XTlwiO1xyXG4gICAgVmlzaWJpbGl0eVN0YXRlW1Zpc2liaWxpdHlTdGF0ZVtcIlZJU0lCTEVcIl0gPSAxXSA9IFwiVklTSUJMRVwiO1xyXG4gICAgVmlzaWJpbGl0eVN0YXRlW1Zpc2liaWxpdHlTdGF0ZVtcIkhJRERFTlwiXSA9IDJdID0gXCJISURERU5cIjtcclxufSkoVmlzaWJpbGl0eVN0YXRlIHx8IChWaXNpYmlsaXR5U3RhdGUgPSB7fSkpO1xyXG5jb25zdCBSRVNFUlZFRF9BVFRSSUJVVEVfUFJFRklYRVMgPSBbJ2ZpcmViYXNlXycsICdnb29nbGVfJywgJ2dhXyddO1xyXG5jb25zdCBBVFRSSUJVVEVfRk9STUFUX1JFR0VYID0gbmV3IFJlZ0V4cCgnXlthLXpBLVpdXFxcXHcqJCcpO1xyXG5jb25zdCBNQVhfQVRUUklCVVRFX05BTUVfTEVOR1RIID0gNDA7XHJcbmNvbnN0IE1BWF9BVFRSSUJVVEVfVkFMVUVfTEVOR1RIID0gMTAwO1xyXG5mdW5jdGlvbiBnZXRTZXJ2aWNlV29ya2VyU3RhdHVzKCkge1xyXG4gICAgY29uc3QgbmF2aWdhdG9yID0gQXBpLmdldEluc3RhbmNlKCkubmF2aWdhdG9yO1xyXG4gICAgaWYgKG5hdmlnYXRvciA9PT0gbnVsbCB8fCBuYXZpZ2F0b3IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgICAgICAgaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDIgLyogU2VydmljZVdvcmtlclN0YXR1cy5DT05UUk9MTEVEICovO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIDMgLyogU2VydmljZVdvcmtlclN0YXR1cy5VTkNPTlRST0xMRUQgKi87XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDEgLyogU2VydmljZVdvcmtlclN0YXR1cy5VTlNVUFBPUlRFRCAqLztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXRWaXNpYmlsaXR5U3RhdGUoKSB7XHJcbiAgICBjb25zdCBkb2N1bWVudCA9IEFwaS5nZXRJbnN0YW5jZSgpLmRvY3VtZW50O1xyXG4gICAgY29uc3QgdmlzaWJpbGl0eVN0YXRlID0gZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlO1xyXG4gICAgc3dpdGNoICh2aXNpYmlsaXR5U3RhdGUpIHtcclxuICAgICAgICBjYXNlICd2aXNpYmxlJzpcclxuICAgICAgICAgICAgcmV0dXJuIFZpc2liaWxpdHlTdGF0ZS5WSVNJQkxFO1xyXG4gICAgICAgIGNhc2UgJ2hpZGRlbic6XHJcbiAgICAgICAgICAgIHJldHVybiBWaXNpYmlsaXR5U3RhdGUuSElEREVOO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBWaXNpYmlsaXR5U3RhdGUuVU5LTk9XTjtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXRFZmZlY3RpdmVDb25uZWN0aW9uVHlwZSgpIHtcclxuICAgIGNvbnN0IG5hdmlnYXRvciA9IEFwaS5nZXRJbnN0YW5jZSgpLm5hdmlnYXRvcjtcclxuICAgIGNvbnN0IG5hdmlnYXRvckNvbm5lY3Rpb24gPSBuYXZpZ2F0b3IuY29ubmVjdGlvbjtcclxuICAgIGNvbnN0IGVmZmVjdGl2ZVR5cGUgPSBuYXZpZ2F0b3JDb25uZWN0aW9uICYmIG5hdmlnYXRvckNvbm5lY3Rpb24uZWZmZWN0aXZlVHlwZTtcclxuICAgIHN3aXRjaCAoZWZmZWN0aXZlVHlwZSkge1xyXG4gICAgICAgIGNhc2UgJ3Nsb3ctMmcnOlxyXG4gICAgICAgICAgICByZXR1cm4gMSAvKiBFZmZlY3RpdmVDb25uZWN0aW9uVHlwZS5DT05ORUNUSU9OX1NMT1dfMkcgKi87XHJcbiAgICAgICAgY2FzZSAnMmcnOlxyXG4gICAgICAgICAgICByZXR1cm4gMiAvKiBFZmZlY3RpdmVDb25uZWN0aW9uVHlwZS5DT05ORUNUSU9OXzJHICovO1xyXG4gICAgICAgIGNhc2UgJzNnJzpcclxuICAgICAgICAgICAgcmV0dXJuIDMgLyogRWZmZWN0aXZlQ29ubmVjdGlvblR5cGUuQ09OTkVDVElPTl8zRyAqLztcclxuICAgICAgICBjYXNlICc0Zyc6XHJcbiAgICAgICAgICAgIHJldHVybiA0IC8qIEVmZmVjdGl2ZUNvbm5lY3Rpb25UeXBlLkNPTk5FQ1RJT05fNEcgKi87XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgcmV0dXJuIDAgLyogRWZmZWN0aXZlQ29ubmVjdGlvblR5cGUuVU5LTk9XTiAqLztcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpc1ZhbGlkQ3VzdG9tQXR0cmlidXRlTmFtZShuYW1lKSB7XHJcbiAgICBpZiAobmFtZS5sZW5ndGggPT09IDAgfHwgbmFtZS5sZW5ndGggPiBNQVhfQVRUUklCVVRFX05BTUVfTEVOR1RIKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWF0Y2hlc1Jlc2VydmVkUHJlZml4ID0gUkVTRVJWRURfQVRUUklCVVRFX1BSRUZJWEVTLnNvbWUocHJlZml4ID0+IG5hbWUuc3RhcnRzV2l0aChwcmVmaXgpKTtcclxuICAgIHJldHVybiAhbWF0Y2hlc1Jlc2VydmVkUHJlZml4ICYmICEhbmFtZS5tYXRjaChBVFRSSUJVVEVfRk9STUFUX1JFR0VYKTtcclxufVxyXG5mdW5jdGlvbiBpc1ZhbGlkQ3VzdG9tQXR0cmlidXRlVmFsdWUodmFsdWUpIHtcclxuICAgIHJldHVybiB2YWx1ZS5sZW5ndGggIT09IDAgJiYgdmFsdWUubGVuZ3RoIDw9IE1BWF9BVFRSSUJVVEVfVkFMVUVfTEVOR1RIO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGdldEFwcElkKGZpcmViYXNlQXBwKSB7XHJcbiAgICB2YXIgX2E7XHJcbiAgICBjb25zdCBhcHBJZCA9IChfYSA9IGZpcmViYXNlQXBwLm9wdGlvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hcHBJZDtcclxuICAgIGlmICghYXBwSWQpIHtcclxuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcIm5vIGFwcCBpZFwiIC8qIEVycm9yQ29kZS5OT19BUFBfSUQgKi8pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFwcElkO1xyXG59XHJcbmZ1bmN0aW9uIGdldFByb2plY3RJZChmaXJlYmFzZUFwcCkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgY29uc3QgcHJvamVjdElkID0gKF9hID0gZmlyZWJhc2VBcHAub3B0aW9ucykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb2plY3RJZDtcclxuICAgIGlmICghcHJvamVjdElkKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJubyBwcm9qZWN0IGlkXCIgLyogRXJyb3JDb2RlLk5PX1BST0pFQ1RfSUQgKi8pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHByb2plY3RJZDtcclxufVxyXG5mdW5jdGlvbiBnZXRBcGlLZXkoZmlyZWJhc2VBcHApIHtcclxuICAgIHZhciBfYTtcclxuICAgIGNvbnN0IGFwaUtleSA9IChfYSA9IGZpcmViYXNlQXBwLm9wdGlvbnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hcGlLZXk7XHJcbiAgICBpZiAoIWFwaUtleSkge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm8gYXBpIGtleVwiIC8qIEVycm9yQ29kZS5OT19BUElfS0VZICovKTtcclxuICAgIH1cclxuICAgIHJldHVybiBhcGlLZXk7XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgUkVNT1RFX0NPTkZJR19TREtfVkVSU0lPTiA9ICcwLjAuMSc7XHJcbi8vIFRoZXNlIHZhbHVlcyB3aWxsIGJlIHVzZWQgaWYgdGhlIHJlbW90ZSBjb25maWcgb2JqZWN0IGlzIHN1Y2Nlc3NmdWxseVxyXG4vLyByZXRyaWV2ZWQsIGJ1dCB0aGUgdGVtcGxhdGUgZG9lcyBub3QgaGF2ZSB0aGVzZSBmaWVsZHMuXHJcbmNvbnN0IERFRkFVTFRfQ09ORklHUyA9IHtcclxuICAgIGxvZ2dpbmdFbmFibGVkOiB0cnVlXHJcbn07XHJcbmNvbnN0IEZJU19BVVRIX1BSRUZJWCA9ICdGSVJFQkFTRV9JTlNUQUxMQVRJT05TX0FVVEgnO1xyXG5mdW5jdGlvbiBnZXRDb25maWcocGVyZm9ybWFuY2VDb250cm9sbGVyLCBpaWQpIHtcclxuICAgIGNvbnN0IGNvbmZpZyA9IGdldFN0b3JlZENvbmZpZygpO1xyXG4gICAgaWYgKGNvbmZpZykge1xyXG4gICAgICAgIHByb2Nlc3NDb25maWcoY29uZmlnKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZ2V0UmVtb3RlQ29uZmlnKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgaWlkKVxyXG4gICAgICAgIC50aGVuKHByb2Nlc3NDb25maWcpXHJcbiAgICAgICAgLnRoZW4oY29uZmlnID0+IHN0b3JlQ29uZmlnKGNvbmZpZyksIFxyXG4gICAgLyoqIERvIG5vdGhpbmcgZm9yIGVycm9yLCB1c2UgZGVmYXVsdHMgc2V0IGluIHNldHRpbmdzIHNlcnZpY2UuICovXHJcbiAgICAoKSA9PiB7IH0pO1xyXG59XHJcbmZ1bmN0aW9uIGdldFN0b3JlZENvbmZpZygpIHtcclxuICAgIGNvbnN0IGxvY2FsU3RvcmFnZSA9IEFwaS5nZXRJbnN0YW5jZSgpLmxvY2FsU3RvcmFnZTtcclxuICAgIGlmICghbG9jYWxTdG9yYWdlKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZXhwaXJ5U3RyaW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ09ORklHX0VYUElSWV9MT0NBTF9TVE9SQUdFX0tFWSk7XHJcbiAgICBpZiAoIWV4cGlyeVN0cmluZyB8fCAhY29uZmlnVmFsaWQoZXhwaXJ5U3RyaW5nKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGNvbnN0IGNvbmZpZ1N0cmluZ2lmaWVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQ09ORklHX0xPQ0FMX1NUT1JBR0VfS0VZKTtcclxuICAgIGlmICghY29uZmlnU3RyaW5naWZpZWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZ1Jlc3BvbnNlID0gSlNPTi5wYXJzZShjb25maWdTdHJpbmdpZmllZCk7XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZ1Jlc3BvbnNlO1xyXG4gICAgfVxyXG4gICAgY2F0Y2ggKF9hKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHN0b3JlQ29uZmlnKGNvbmZpZykge1xyXG4gICAgY29uc3QgbG9jYWxTdG9yYWdlID0gQXBpLmdldEluc3RhbmNlKCkubG9jYWxTdG9yYWdlO1xyXG4gICAgaWYgKCFjb25maWcgfHwgIWxvY2FsU3RvcmFnZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKENPTkZJR19MT0NBTF9TVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkoY29uZmlnKSk7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShDT05GSUdfRVhQSVJZX0xPQ0FMX1NUT1JBR0VfS0VZLCBTdHJpbmcoRGF0ZS5ub3coKSArXHJcbiAgICAgICAgU2V0dGluZ3NTZXJ2aWNlLmdldEluc3RhbmNlKCkuY29uZmlnVGltZVRvTGl2ZSAqIDYwICogNjAgKiAxMDAwKSk7XHJcbn1cclxuY29uc3QgQ09VTERfTk9UX0dFVF9DT05GSUdfTVNHID0gJ0NvdWxkIG5vdCBmZXRjaCBjb25maWcsIHdpbGwgdXNlIGRlZmF1bHQgY29uZmlncyc7XHJcbmZ1bmN0aW9uIGdldFJlbW90ZUNvbmZpZyhwZXJmb3JtYW5jZUNvbnRyb2xsZXIsIGlpZCkge1xyXG4gICAgLy8gUGVyZiBuZWVkcyBhdXRoIHRva2VuIG9ubHkgdG8gcmV0cmlldmUgcmVtb3RlIGNvbmZpZy5cclxuICAgIHJldHVybiBnZXRBdXRoVG9rZW5Qcm9taXNlKHBlcmZvcm1hbmNlQ29udHJvbGxlci5pbnN0YWxsYXRpb25zKVxyXG4gICAgICAgIC50aGVuKGF1dGhUb2tlbiA9PiB7XHJcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gZ2V0UHJvamVjdElkKHBlcmZvcm1hbmNlQ29udHJvbGxlci5hcHApO1xyXG4gICAgICAgIGNvbnN0IGFwaUtleSA9IGdldEFwaUtleShwZXJmb3JtYW5jZUNvbnRyb2xsZXIuYXBwKTtcclxuICAgICAgICBjb25zdCBjb25maWdFbmRQb2ludCA9IGBodHRwczovL2ZpcmViYXNlcmVtb3RlY29uZmlnLmdvb2dsZWFwaXMuY29tL3YxL3Byb2plY3RzLyR7cHJvamVjdElkfS9uYW1lc3BhY2VzL2ZpcmVwZXJmOmZldGNoP2tleT0ke2FwaUtleX1gO1xyXG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgUmVxdWVzdChjb25maWdFbmRQb2ludCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgJHtGSVNfQVVUSF9QUkVGSVh9ICR7YXV0aFRva2VufWAgfSxcclxuICAgICAgICAgICAgLyogZXNsaW50LWRpc2FibGUgY2FtZWxjYXNlICovXHJcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIGFwcF9pbnN0YW5jZV9pZDogaWlkLFxyXG4gICAgICAgICAgICAgICAgYXBwX2luc3RhbmNlX2lkX3Rva2VuOiBhdXRoVG9rZW4sXHJcbiAgICAgICAgICAgICAgICBhcHBfaWQ6IGdldEFwcElkKHBlcmZvcm1hbmNlQ29udHJvbGxlci5hcHApLFxyXG4gICAgICAgICAgICAgICAgYXBwX3ZlcnNpb246IFNES19WRVJTSU9OLFxyXG4gICAgICAgICAgICAgICAgc2RrX3ZlcnNpb246IFJFTU9URV9DT05GSUdfU0RLX1ZFUlNJT05cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBjYW1lbGNhc2UgKi9cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZmV0Y2gocmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBJbiBjYXNlIHJlc3BvbnNlIGlzIG5vdCBvay4gVGhpcyB3aWxsIGJlIGNhdWdodCBieSBjYXRjaC5cclxuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJSQyByZXNwb25zZSBub3Qgb2tcIiAvKiBFcnJvckNvZGUuUkNfTk9UX09LICovKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKCgpID0+IHtcclxuICAgICAgICBjb25zb2xlTG9nZ2VyLmluZm8oQ09VTERfTk9UX0dFVF9DT05GSUdfTVNHKTtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfSk7XHJcbn1cclxuLyoqXHJcbiAqIFByb2Nlc3NlcyBjb25maWcgY29taW5nIGVpdGhlciBmcm9tIGNhbGxpbmcgUkMgb3IgZnJvbSBsb2NhbCBzdG9yYWdlLlxyXG4gKiBUaGlzIG1ldGhvZCBvbmx5IHJ1bnMgaWYgY2FsbCBpcyBzdWNjZXNzZnVsIG9yIGNvbmZpZyBpbiBzdG9yYWdlXHJcbiAqIGlzIHZhbGlkLlxyXG4gKi9cclxuZnVuY3Rpb24gcHJvY2Vzc0NvbmZpZyhjb25maWcpIHtcclxuICAgIGlmICghY29uZmlnKSB7XHJcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgIH1cclxuICAgIGNvbnN0IHNldHRpbmdzU2VydmljZUluc3RhbmNlID0gU2V0dGluZ3NTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgICBjb25zdCBlbnRyaWVzID0gY29uZmlnLmVudHJpZXMgfHwge307XHJcbiAgICBpZiAoZW50cmllcy5mcHJfZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgLy8gVE9ETzogQ2hhbmdlIHRoZSBhc3NpZ25tZW50IG9mIGxvZ2dpbmdFbmFibGVkIG9uY2UgdGhlIHJlY2VpdmVkIHR5cGUgaXNcclxuICAgICAgICAvLyBrbm93bi5cclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS5sb2dnaW5nRW5hYmxlZCA9XHJcbiAgICAgICAgICAgIFN0cmluZyhlbnRyaWVzLmZwcl9lbmFibGVkKSA9PT0gJ3RydWUnO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLy8gQ29uZmlnIHJldHJpZXZlZCBzdWNjZXNzZnVsbHksIGJ1dCB0aGVyZSBpcyBubyBmcHJfZW5hYmxlZCBpbiB0ZW1wbGF0ZS5cclxuICAgICAgICAvLyBVc2Ugc2Vjb25kYXJ5IGNvbmZpZ3MgdmFsdWUuXHJcbiAgICAgICAgc2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UubG9nZ2luZ0VuYWJsZWQgPSBERUZBVUxUX0NPTkZJR1MubG9nZ2luZ0VuYWJsZWQ7XHJcbiAgICB9XHJcbiAgICBpZiAoZW50cmllcy5mcHJfbG9nX3NvdXJjZSkge1xyXG4gICAgICAgIHNldHRpbmdzU2VydmljZUluc3RhbmNlLmxvZ1NvdXJjZSA9IE51bWJlcihlbnRyaWVzLmZwcl9sb2dfc291cmNlKTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKERFRkFVTFRfQ09ORklHUy5sb2dTb3VyY2UpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS5sb2dTb3VyY2UgPSBERUZBVUxUX0NPTkZJR1MubG9nU291cmNlO1xyXG4gICAgfVxyXG4gICAgaWYgKGVudHJpZXMuZnByX2xvZ19lbmRwb2ludF91cmwpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS5sb2dFbmRQb2ludFVybCA9IGVudHJpZXMuZnByX2xvZ19lbmRwb2ludF91cmw7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChERUZBVUxUX0NPTkZJR1MubG9nRW5kUG9pbnRVcmwpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS5sb2dFbmRQb2ludFVybCA9IERFRkFVTFRfQ09ORklHUy5sb2dFbmRQb2ludFVybDtcclxuICAgIH1cclxuICAgIC8vIEtleSBmcm9tIFJlbW90ZSBDb25maWcgaGFzIHRvIGJlIG5vbi1lbXB0eSBzdHJpbmcsIG90aGVyd3NpZSB1c2UgbG9jYWwgdmFsdWUuXHJcbiAgICBpZiAoZW50cmllcy5mcHJfbG9nX3RyYW5zcG9ydF9rZXkpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS50cmFuc3BvcnRLZXkgPSBlbnRyaWVzLmZwcl9sb2dfdHJhbnNwb3J0X2tleTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKERFRkFVTFRfQ09ORklHUy50cmFuc3BvcnRLZXkpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS50cmFuc3BvcnRLZXkgPSBERUZBVUxUX0NPTkZJR1MudHJhbnNwb3J0S2V5O1xyXG4gICAgfVxyXG4gICAgaWYgKGVudHJpZXMuZnByX3ZjX25ldHdvcmtfcmVxdWVzdF9zYW1wbGluZ19yYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS5uZXR3b3JrUmVxdWVzdHNTYW1wbGluZ1JhdGUgPSBOdW1iZXIoZW50cmllcy5mcHJfdmNfbmV0d29ya19yZXF1ZXN0X3NhbXBsaW5nX3JhdGUpO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoREVGQVVMVF9DT05GSUdTLm5ldHdvcmtSZXF1ZXN0c1NhbXBsaW5nUmF0ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgc2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UubmV0d29ya1JlcXVlc3RzU2FtcGxpbmdSYXRlID1cclxuICAgICAgICAgICAgREVGQVVMVF9DT05GSUdTLm5ldHdvcmtSZXF1ZXN0c1NhbXBsaW5nUmF0ZTtcclxuICAgIH1cclxuICAgIGlmIChlbnRyaWVzLmZwcl92Y190cmFjZV9zYW1wbGluZ19yYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS50cmFjZXNTYW1wbGluZ1JhdGUgPSBOdW1iZXIoZW50cmllcy5mcHJfdmNfdHJhY2Vfc2FtcGxpbmdfcmF0ZSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChERUZBVUxUX0NPTkZJR1MudHJhY2VzU2FtcGxpbmdSYXRlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS50cmFjZXNTYW1wbGluZ1JhdGUgPVxyXG4gICAgICAgICAgICBERUZBVUxUX0NPTkZJR1MudHJhY2VzU2FtcGxpbmdSYXRlO1xyXG4gICAgfVxyXG4gICAgLy8gU2V0IHRoZSBwZXIgc2Vzc2lvbiB0cmFjZSBhbmQgbmV0d29yayBsb2dnaW5nIGZsYWdzLlxyXG4gICAgc2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UubG9nVHJhY2VBZnRlclNhbXBsaW5nID0gc2hvdWxkTG9nQWZ0ZXJTYW1wbGluZyhzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZS50cmFjZXNTYW1wbGluZ1JhdGUpO1xyXG4gICAgc2V0dGluZ3NTZXJ2aWNlSW5zdGFuY2UubG9nTmV0d29ya0FmdGVyU2FtcGxpbmcgPSBzaG91bGRMb2dBZnRlclNhbXBsaW5nKHNldHRpbmdzU2VydmljZUluc3RhbmNlLm5ldHdvcmtSZXF1ZXN0c1NhbXBsaW5nUmF0ZSk7XHJcbiAgICByZXR1cm4gY29uZmlnO1xyXG59XHJcbmZ1bmN0aW9uIGNvbmZpZ1ZhbGlkKGV4cGlyeSkge1xyXG4gICAgcmV0dXJuIE51bWJlcihleHBpcnkpID4gRGF0ZS5ub3coKTtcclxufVxyXG5mdW5jdGlvbiBzaG91bGRMb2dBZnRlclNhbXBsaW5nKHNhbXBsaW5nUmF0ZSkge1xyXG4gICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPD0gc2FtcGxpbmdSYXRlO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmxldCBpbml0aWFsaXphdGlvblN0YXR1cyA9IDEgLyogSW5pdGlhbGl6YXRpb25TdGF0dXMubm90SW5pdGlhbGl6ZWQgKi87XHJcbmxldCBpbml0aWFsaXphdGlvblByb21pc2U7XHJcbmZ1bmN0aW9uIGdldEluaXRpYWxpemF0aW9uUHJvbWlzZShwZXJmb3JtYW5jZUNvbnRyb2xsZXIpIHtcclxuICAgIGluaXRpYWxpemF0aW9uU3RhdHVzID0gMiAvKiBJbml0aWFsaXphdGlvblN0YXR1cy5pbml0aWFsaXphdGlvblBlbmRpbmcgKi87XHJcbiAgICBpbml0aWFsaXphdGlvblByb21pc2UgPVxyXG4gICAgICAgIGluaXRpYWxpemF0aW9uUHJvbWlzZSB8fCBpbml0aWFsaXplUGVyZihwZXJmb3JtYW5jZUNvbnRyb2xsZXIpO1xyXG4gICAgcmV0dXJuIGluaXRpYWxpemF0aW9uUHJvbWlzZTtcclxufVxyXG5mdW5jdGlvbiBpc1BlcmZJbml0aWFsaXplZCgpIHtcclxuICAgIHJldHVybiBpbml0aWFsaXphdGlvblN0YXR1cyA9PT0gMyAvKiBJbml0aWFsaXphdGlvblN0YXR1cy5pbml0aWFsaXplZCAqLztcclxufVxyXG5mdW5jdGlvbiBpbml0aWFsaXplUGVyZihwZXJmb3JtYW5jZUNvbnRyb2xsZXIpIHtcclxuICAgIHJldHVybiBnZXREb2N1bWVudFJlYWR5Q29tcGxldGUoKVxyXG4gICAgICAgIC50aGVuKCgpID0+IGdldElpZFByb21pc2UocGVyZm9ybWFuY2VDb250cm9sbGVyLmluc3RhbGxhdGlvbnMpKVxyXG4gICAgICAgIC50aGVuKGlpZCA9PiBnZXRDb25maWcocGVyZm9ybWFuY2VDb250cm9sbGVyLCBpaWQpKVxyXG4gICAgICAgIC50aGVuKCgpID0+IGNoYW5nZUluaXRpYWxpemF0aW9uU3RhdHVzKCksICgpID0+IGNoYW5nZUluaXRpYWxpemF0aW9uU3RhdHVzKCkpO1xyXG59XHJcbi8qKlxyXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSB3aGljaCByZXNvbHZlcyB3aGVuZXZlciB0aGUgZG9jdW1lbnQgcmVhZHlzdGF0ZSBpcyBjb21wbGV0ZSBvclxyXG4gKiBpbW1lZGlhdGVseSBpZiBpdCBpcyBjYWxsZWQgYWZ0ZXIgcGFnZSBsb2FkIGNvbXBsZXRlLlxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0RG9jdW1lbnRSZWFkeUNvbXBsZXRlKCkge1xyXG4gICAgY29uc3QgZG9jdW1lbnQgPSBBcGkuZ2V0SW5zdGFuY2UoKS5kb2N1bWVudDtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICBpZiAoZG9jdW1lbnQgJiYgZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJykge1xyXG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgaGFuZGxlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdyZWFkeXN0YXRlY2hhbmdlJywgaGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gY2hhbmdlSW5pdGlhbGl6YXRpb25TdGF0dXMoKSB7XHJcbiAgICBpbml0aWFsaXphdGlvblN0YXR1cyA9IDMgLyogSW5pdGlhbGl6YXRpb25TdGF0dXMuaW5pdGlhbGl6ZWQgKi87XHJcbn1cblxuLyoqXHJcbiAqIEBsaWNlbnNlXHJcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuY29uc3QgREVGQVVMVF9TRU5EX0lOVEVSVkFMX01TID0gMTAgKiAxMDAwO1xyXG5jb25zdCBJTklUSUFMX1NFTkRfVElNRV9ERUxBWV9NUyA9IDUuNSAqIDEwMDA7XHJcbi8vIElmIGVuZCBwb2ludCBkb2VzIG5vdCB3b3JrLCB0aGUgY2FsbCB3aWxsIGJlIHRyaWVkIGZvciB0aGVzZSBtYW55IHRpbWVzLlxyXG5jb25zdCBERUZBVUxUX1JFTUFJTklOR19UUklFUyA9IDM7XHJcbmNvbnN0IE1BWF9FVkVOVF9DT1VOVF9QRVJfUkVRVUVTVCA9IDEwMDA7XHJcbmxldCByZW1haW5pbmdUcmllcyA9IERFRkFVTFRfUkVNQUlOSU5HX1RSSUVTO1xyXG4vKiBlc2xpbnQtZW5hYmxlIGNhbWVsY2FzZSAqL1xyXG5sZXQgcXVldWUgPSBbXTtcclxubGV0IGlzVHJhbnNwb3J0U2V0dXAgPSBmYWxzZTtcclxuZnVuY3Rpb24gc2V0dXBUcmFuc3BvcnRTZXJ2aWNlKCkge1xyXG4gICAgaWYgKCFpc1RyYW5zcG9ydFNldHVwKSB7XHJcbiAgICAgICAgcHJvY2Vzc1F1ZXVlKElOSVRJQUxfU0VORF9USU1FX0RFTEFZX01TKTtcclxuICAgICAgICBpc1RyYW5zcG9ydFNldHVwID0gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwcm9jZXNzUXVldWUodGltZU9mZnNldCkge1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gcmVtYWluaW5nVHJpZXMgbGVmdCwgc3RvcCByZXRyeWluZy5cclxuICAgICAgICBpZiAocmVtYWluaW5nVHJpZXMgPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gZXZlbnRzIHRvIHByb2Nlc3MsIHdhaXQgZm9yIERFRkFVTFRfU0VORF9JTlRFUlZBTF9NUyBhbmQgdHJ5IGFnYWluLlxyXG4gICAgICAgIGlmICghcXVldWUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzUXVldWUoREVGQVVMVF9TRU5EX0lOVEVSVkFMX01TKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGlzcGF0Y2hRdWV1ZUV2ZW50cygpO1xyXG4gICAgfSwgdGltZU9mZnNldCk7XHJcbn1cclxuZnVuY3Rpb24gZGlzcGF0Y2hRdWV1ZUV2ZW50cygpIHtcclxuICAgIC8vIEV4dHJhY3QgZXZlbnRzIHVwIHRvIHRoZSBtYXhpbXVtIGNhcCBvZiBzaW5nbGUgbG9nUmVxdWVzdCBmcm9tIHRvcCBvZiBcIm9mZmljaWFsIHF1ZXVlXCIuXHJcbiAgICAvLyBUaGUgc3RhZ2VkIGV2ZW50cyB3aWxsIGJlIHVzZWQgZm9yIGN1cnJlbnQgbG9nUmVxdWVzdCBhdHRlbXB0LCByZW1haW5pbmcgZXZlbnRzIHdpbGwgYmUga2VwdFxyXG4gICAgLy8gZm9yIG5leHQgYXR0ZW1wdC5cclxuICAgIGNvbnN0IHN0YWdlZCA9IHF1ZXVlLnNwbGljZSgwLCBNQVhfRVZFTlRfQ09VTlRfUEVSX1JFUVVFU1QpO1xyXG4gICAgLyogZXNsaW50LWRpc2FibGUgY2FtZWxjYXNlICovXHJcbiAgICAvLyBXZSB3aWxsIHBhc3MgdGhlIEpTT04gc2VyaWFsaXplZCBldmVudCB0byB0aGUgYmFja2VuZC5cclxuICAgIGNvbnN0IGxvZ19ldmVudCA9IHN0YWdlZC5tYXAoZXZ0ID0+ICh7XHJcbiAgICAgICAgc291cmNlX2V4dGVuc2lvbl9qc29uX3Byb3RvMzogZXZ0Lm1lc3NhZ2UsXHJcbiAgICAgICAgZXZlbnRfdGltZV9tczogU3RyaW5nKGV2dC5ldmVudFRpbWUpXHJcbiAgICB9KSk7XHJcbiAgICBjb25zdCBkYXRhID0ge1xyXG4gICAgICAgIHJlcXVlc3RfdGltZV9tczogU3RyaW5nKERhdGUubm93KCkpLFxyXG4gICAgICAgIGNsaWVudF9pbmZvOiB7XHJcbiAgICAgICAgICAgIGNsaWVudF90eXBlOiAxLFxyXG4gICAgICAgICAgICBqc19jbGllbnRfaW5mbzoge31cclxuICAgICAgICB9LFxyXG4gICAgICAgIGxvZ19zb3VyY2U6IFNldHRpbmdzU2VydmljZS5nZXRJbnN0YW5jZSgpLmxvZ1NvdXJjZSxcclxuICAgICAgICBsb2dfZXZlbnRcclxuICAgIH07XHJcbiAgICAvKiBlc2xpbnQtZW5hYmxlIGNhbWVsY2FzZSAqL1xyXG4gICAgc2VuZEV2ZW50c1RvRmwoZGF0YSwgc3RhZ2VkKS5jYXRjaCgoKSA9PiB7XHJcbiAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgZmFpbHMgZm9yIHNvbWUgcmVhc29uLCBhZGQgdGhlIGV2ZW50cyB0aGF0IHdlcmUgYXR0ZW1wdGVkXHJcbiAgICAgICAgLy8gYmFjayB0byB0aGUgcHJpbWFyeSBxdWV1ZSB0byByZXRyeSBsYXRlci5cclxuICAgICAgICBxdWV1ZSA9IFsuLi5zdGFnZWQsIC4uLnF1ZXVlXTtcclxuICAgICAgICByZW1haW5pbmdUcmllcy0tO1xyXG4gICAgICAgIGNvbnNvbGVMb2dnZXIuaW5mbyhgVHJpZXMgbGVmdDogJHtyZW1haW5pbmdUcmllc30uYCk7XHJcbiAgICAgICAgcHJvY2Vzc1F1ZXVlKERFRkFVTFRfU0VORF9JTlRFUlZBTF9NUyk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBzZW5kRXZlbnRzVG9GbChkYXRhLCBzdGFnZWQpIHtcclxuICAgIHJldHVybiBwb3N0VG9GbEVuZHBvaW50KGRhdGEpXHJcbiAgICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBpZiAoIXJlcy5vaykge1xyXG4gICAgICAgICAgICBjb25zb2xlTG9nZ2VyLmluZm8oJ0NhbGwgdG8gRmlyZWJhc2UgYmFja2VuZCBmYWlsZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgfSlcclxuICAgICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIC8vIEZpbmQgdGhlIG5leHQgY2FsbCB3YWl0IHRpbWUgZnJvbSB0aGUgcmVzcG9uc2UuXHJcbiAgICAgICAgY29uc3QgdHJhbnNwb3J0V2FpdCA9IE51bWJlcihyZXMubmV4dFJlcXVlc3RXYWl0TWlsbGlzKTtcclxuICAgICAgICBsZXQgcmVxdWVzdE9mZnNldCA9IERFRkFVTFRfU0VORF9JTlRFUlZBTF9NUztcclxuICAgICAgICBpZiAoIWlzTmFOKHRyYW5zcG9ydFdhaXQpKSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RPZmZzZXQgPSBNYXRoLm1heCh0cmFuc3BvcnRXYWl0LCByZXF1ZXN0T2Zmc2V0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRGVsZXRlIHJlcXVlc3QgaWYgcmVzcG9uc2UgaW5jbHVkZSBSRVNQT05TRV9BQ1RJT05fVU5LTk9XTiBvciBERUxFVEVfUkVRVUVTVCBhY3Rpb24uXHJcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCByZXRyeSByZXF1ZXN0IHVzaW5nIG5vcm1hbCBzY2hlZHVsaW5nIGlmIHJlc3BvbnNlIGluY2x1ZGUgUkVUUllfUkVRVUVTVF9MQVRFUi5cclxuICAgICAgICBjb25zdCBsb2dSZXNwb25zZURldGFpbHMgPSByZXMubG9nUmVzcG9uc2VEZXRhaWxzO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGxvZ1Jlc3BvbnNlRGV0YWlscykgJiZcclxuICAgICAgICAgICAgbG9nUmVzcG9uc2VEZXRhaWxzLmxlbmd0aCA+IDAgJiZcclxuICAgICAgICAgICAgbG9nUmVzcG9uc2VEZXRhaWxzWzBdLnJlc3BvbnNlQWN0aW9uID09PSAnUkVUUllfUkVRVUVTVF9MQVRFUicpIHtcclxuICAgICAgICAgICAgcXVldWUgPSBbLi4uc3RhZ2VkLCAuLi5xdWV1ZV07XHJcbiAgICAgICAgICAgIGNvbnNvbGVMb2dnZXIuaW5mbyhgUmV0cnkgdHJhbnNwb3J0IHJlcXVlc3QgbGF0ZXIuYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlbWFpbmluZ1RyaWVzID0gREVGQVVMVF9SRU1BSU5JTkdfVFJJRVM7XHJcbiAgICAgICAgLy8gU2NoZWR1bGUgdGhlIG5leHQgcHJvY2Vzcy5cclxuICAgICAgICBwcm9jZXNzUXVldWUocmVxdWVzdE9mZnNldCk7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBwb3N0VG9GbEVuZHBvaW50KGRhdGEpIHtcclxuICAgIGNvbnN0IGZsVHJhbnNwb3J0RnVsbFVybCA9IFNldHRpbmdzU2VydmljZS5nZXRJbnN0YW5jZSgpLmdldEZsVHJhbnNwb3J0RnVsbFVybCgpO1xyXG4gICAgcmV0dXJuIGZldGNoKGZsVHJhbnNwb3J0RnVsbFVybCwge1xyXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpXHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBhZGRUb1F1ZXVlKGV2dCkge1xyXG4gICAgaWYgKCFldnQuZXZlbnRUaW1lIHx8ICFldnQubWVzc2FnZSkge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaW52YWxpZCBjYyBsb2dcIiAvKiBFcnJvckNvZGUuSU5WQUxJRF9DQ19MT0cgKi8pO1xyXG4gICAgfVxyXG4gICAgLy8gQWRkIHRoZSBuZXcgZXZlbnQgdG8gdGhlIHF1ZXVlLlxyXG4gICAgcXVldWUgPSBbLi4ucXVldWUsIGV2dF07XHJcbn1cclxuLyoqIExvZyBoYW5kbGVyIGZvciBjYyBzZXJ2aWNlIHRvIHNlbmQgdGhlIHBlcmZvcm1hbmNlIGxvZ3MgdG8gdGhlIHNlcnZlci4gKi9cclxuZnVuY3Rpb24gdHJhbnNwb3J0SGFuZGxlcihcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuc2VyaWFsaXplcikge1xyXG4gICAgcmV0dXJuICguLi5hcmdzKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHNlcmlhbGl6ZXIoLi4uYXJncyk7XHJcbiAgICAgICAgYWRkVG9RdWV1ZSh7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIGV2ZW50VGltZTogRGF0ZS5ub3coKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG4vKiBlc2xpbnQtZW5ibGUgY2FtZWxjYXNlICovXHJcbmxldCBsb2dnZXI7XHJcbi8vIFRoaXMgbWV0aG9kIGlzIG5vdCBjYWxsZWQgYmVmb3JlIGluaXRpYWxpemF0aW9uLlxyXG5mdW5jdGlvbiBzZW5kTG9nKHJlc291cmNlLCByZXNvdXJjZVR5cGUpIHtcclxuICAgIGlmICghbG9nZ2VyKSB7XHJcbiAgICAgICAgbG9nZ2VyID0gdHJhbnNwb3J0SGFuZGxlcihzZXJpYWxpemVyKTtcclxuICAgIH1cclxuICAgIGxvZ2dlcihyZXNvdXJjZSwgcmVzb3VyY2VUeXBlKTtcclxufVxyXG5mdW5jdGlvbiBsb2dUcmFjZSh0cmFjZSkge1xyXG4gICAgY29uc3Qgc2V0dGluZ3NTZXJ2aWNlID0gU2V0dGluZ3NTZXJ2aWNlLmdldEluc3RhbmNlKCk7XHJcbiAgICAvLyBEbyBub3QgbG9nIGlmIHRyYWNlIGlzIGF1dG8gZ2VuZXJhdGVkIGFuZCBpbnN0cnVtZW50YXRpb24gaXMgZGlzYWJsZWQuXHJcbiAgICBpZiAoIXNldHRpbmdzU2VydmljZS5pbnN0cnVtZW50YXRpb25FbmFibGVkICYmIHRyYWNlLmlzQXV0bykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIERvIG5vdCBsb2cgaWYgdHJhY2UgaXMgY3VzdG9tIGFuZCBkYXRhIGNvbGxlY3Rpb24gaXMgZGlzYWJsZWQuXHJcbiAgICBpZiAoIXNldHRpbmdzU2VydmljZS5kYXRhQ29sbGVjdGlvbkVuYWJsZWQgJiYgIXRyYWNlLmlzQXV0bykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIERvIG5vdCBsb2cgaWYgcmVxdWlyZWQgYXBpcyBhcmUgbm90IGF2YWlsYWJsZS5cclxuICAgIGlmICghQXBpLmdldEluc3RhbmNlKCkucmVxdWlyZWRBcGlzQXZhaWxhYmxlKCkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBPbmx5IGxvZyB0aGUgcGFnZSBsb2FkIGF1dG8gdHJhY2VzIGlmIHBhZ2UgaXMgdmlzaWJsZS5cclxuICAgIGlmICh0cmFjZS5pc0F1dG8gJiYgZ2V0VmlzaWJpbGl0eVN0YXRlKCkgIT09IFZpc2liaWxpdHlTdGF0ZS5WSVNJQkxFKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGlzUGVyZkluaXRpYWxpemVkKCkpIHtcclxuICAgICAgICBzZW5kVHJhY2VMb2codHJhY2UpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgLy8gQ3VzdG9tIHRyYWNlcyBjYW4gYmUgdXNlZCBiZWZvcmUgdGhlIGluaXRpYWxpemF0aW9uIGJ1dCBsb2dnaW5nXHJcbiAgICAgICAgLy8gc2hvdWxkIHdhaXQgdW50aWwgYWZ0ZXIuXHJcbiAgICAgICAgZ2V0SW5pdGlhbGl6YXRpb25Qcm9taXNlKHRyYWNlLnBlcmZvcm1hbmNlQ29udHJvbGxlcikudGhlbigoKSA9PiBzZW5kVHJhY2VMb2codHJhY2UpLCAoKSA9PiBzZW5kVHJhY2VMb2codHJhY2UpKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBzZW5kVHJhY2VMb2codHJhY2UpIHtcclxuICAgIGlmICghZ2V0SWlkKCkpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCBzZXR0aW5nc1NlcnZpY2UgPSBTZXR0aW5nc1NlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcclxuICAgIGlmICghc2V0dGluZ3NTZXJ2aWNlLmxvZ2dpbmdFbmFibGVkIHx8XHJcbiAgICAgICAgIXNldHRpbmdzU2VydmljZS5sb2dUcmFjZUFmdGVyU2FtcGxpbmcpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHNlbmRMb2codHJhY2UsIDEgLyogUmVzb3VyY2VUeXBlLlRyYWNlICovKSwgMCk7XHJcbn1cclxuZnVuY3Rpb24gbG9nTmV0d29ya1JlcXVlc3QobmV0d29ya1JlcXVlc3QpIHtcclxuICAgIGNvbnN0IHNldHRpbmdzU2VydmljZSA9IFNldHRpbmdzU2VydmljZS5nZXRJbnN0YW5jZSgpO1xyXG4gICAgLy8gRG8gbm90IGxvZyBuZXR3b3JrIHJlcXVlc3RzIGlmIGluc3RydW1lbnRhdGlvbiBpcyBkaXNhYmxlZC5cclxuICAgIGlmICghc2V0dGluZ3NTZXJ2aWNlLmluc3RydW1lbnRhdGlvbkVuYWJsZWQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBEbyBub3QgbG9nIHRoZSBqcyBzZGsncyBjYWxsIHRvIHRyYW5zcG9ydCBzZXJ2aWNlIGRvbWFpbiB0byBhdm9pZCB1bm5lY2Vzc2FyeSBjeWNsZS5cclxuICAgIC8vIE5lZWQgdG8gYmxhY2tsaXN0IGJvdGggb2xkIGFuZCBuZXcgZW5kcG9pbnRzIHRvIGF2b2lkIG1pZ3JhdGlvbiBnYXAuXHJcbiAgICBjb25zdCBuZXR3b3JrUmVxdWVzdFVybCA9IG5ldHdvcmtSZXF1ZXN0LnVybDtcclxuICAgIC8vIEJsYWNrbGlzdCBvbGQgbG9nIGVuZHBvaW50IGFuZCBuZXcgdHJhbnNwb3J0IGVuZHBvaW50LlxyXG4gICAgLy8gQmVjYXVzZSBQZXJmb3JtYW5jZSBTREsgZG9lc24ndCBpbnN0cnVtZW50IHJlcXVlc3RzIHNlbnQgZnJvbSBTREsgaXRzZWxmLlxyXG4gICAgY29uc3QgbG9nRW5kcG9pbnRVcmwgPSBzZXR0aW5nc1NlcnZpY2UubG9nRW5kUG9pbnRVcmwuc3BsaXQoJz8nKVswXTtcclxuICAgIGNvbnN0IGZsRW5kcG9pbnRVcmwgPSBzZXR0aW5nc1NlcnZpY2UuZmxUcmFuc3BvcnRFbmRwb2ludFVybC5zcGxpdCgnPycpWzBdO1xyXG4gICAgaWYgKG5ldHdvcmtSZXF1ZXN0VXJsID09PSBsb2dFbmRwb2ludFVybCB8fFxyXG4gICAgICAgIG5ldHdvcmtSZXF1ZXN0VXJsID09PSBmbEVuZHBvaW50VXJsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFzZXR0aW5nc1NlcnZpY2UubG9nZ2luZ0VuYWJsZWQgfHxcclxuICAgICAgICAhc2V0dGluZ3NTZXJ2aWNlLmxvZ05ldHdvcmtBZnRlclNhbXBsaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgc2V0VGltZW91dCgoKSA9PiBzZW5kTG9nKG5ldHdvcmtSZXF1ZXN0LCAwIC8qIFJlc291cmNlVHlwZS5OZXR3b3JrUmVxdWVzdCAqLyksIDApO1xyXG59XHJcbmZ1bmN0aW9uIHNlcmlhbGl6ZXIocmVzb3VyY2UsIHJlc291cmNlVHlwZSkge1xyXG4gICAgaWYgKHJlc291cmNlVHlwZSA9PT0gMCAvKiBSZXNvdXJjZVR5cGUuTmV0d29ya1JlcXVlc3QgKi8pIHtcclxuICAgICAgICByZXR1cm4gc2VyaWFsaXplTmV0d29ya1JlcXVlc3QocmVzb3VyY2UpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNlcmlhbGl6ZVRyYWNlKHJlc291cmNlKTtcclxufVxyXG5mdW5jdGlvbiBzZXJpYWxpemVOZXR3b3JrUmVxdWVzdChuZXR3b3JrUmVxdWVzdCkge1xyXG4gICAgY29uc3QgbmV0d29ya1JlcXVlc3RNZXRyaWMgPSB7XHJcbiAgICAgICAgdXJsOiBuZXR3b3JrUmVxdWVzdC51cmwsXHJcbiAgICAgICAgaHR0cF9tZXRob2Q6IG5ldHdvcmtSZXF1ZXN0Lmh0dHBNZXRob2QgfHwgMCxcclxuICAgICAgICBodHRwX3Jlc3BvbnNlX2NvZGU6IDIwMCxcclxuICAgICAgICByZXNwb25zZV9wYXlsb2FkX2J5dGVzOiBuZXR3b3JrUmVxdWVzdC5yZXNwb25zZVBheWxvYWRCeXRlcyxcclxuICAgICAgICBjbGllbnRfc3RhcnRfdGltZV91czogbmV0d29ya1JlcXVlc3Quc3RhcnRUaW1lVXMsXHJcbiAgICAgICAgdGltZV90b19yZXNwb25zZV9pbml0aWF0ZWRfdXM6IG5ldHdvcmtSZXF1ZXN0LnRpbWVUb1Jlc3BvbnNlSW5pdGlhdGVkVXMsXHJcbiAgICAgICAgdGltZV90b19yZXNwb25zZV9jb21wbGV0ZWRfdXM6IG5ldHdvcmtSZXF1ZXN0LnRpbWVUb1Jlc3BvbnNlQ29tcGxldGVkVXNcclxuICAgIH07XHJcbiAgICBjb25zdCBwZXJmTWV0cmljID0ge1xyXG4gICAgICAgIGFwcGxpY2F0aW9uX2luZm86IGdldEFwcGxpY2F0aW9uSW5mbyhuZXR3b3JrUmVxdWVzdC5wZXJmb3JtYW5jZUNvbnRyb2xsZXIuYXBwKSxcclxuICAgICAgICBuZXR3b3JrX3JlcXVlc3RfbWV0cmljOiBuZXR3b3JrUmVxdWVzdE1ldHJpY1xyXG4gICAgfTtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShwZXJmTWV0cmljKTtcclxufVxyXG5mdW5jdGlvbiBzZXJpYWxpemVUcmFjZSh0cmFjZSkge1xyXG4gICAgY29uc3QgdHJhY2VNZXRyaWMgPSB7XHJcbiAgICAgICAgbmFtZTogdHJhY2UubmFtZSxcclxuICAgICAgICBpc19hdXRvOiB0cmFjZS5pc0F1dG8sXHJcbiAgICAgICAgY2xpZW50X3N0YXJ0X3RpbWVfdXM6IHRyYWNlLnN0YXJ0VGltZVVzLFxyXG4gICAgICAgIGR1cmF0aW9uX3VzOiB0cmFjZS5kdXJhdGlvblVzXHJcbiAgICB9O1xyXG4gICAgaWYgKE9iamVjdC5rZXlzKHRyYWNlLmNvdW50ZXJzKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICB0cmFjZU1ldHJpYy5jb3VudGVycyA9IHRyYWNlLmNvdW50ZXJzO1xyXG4gICAgfVxyXG4gICAgY29uc3QgY3VzdG9tQXR0cmlidXRlcyA9IHRyYWNlLmdldEF0dHJpYnV0ZXMoKTtcclxuICAgIGlmIChPYmplY3Qua2V5cyhjdXN0b21BdHRyaWJ1dGVzKS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICB0cmFjZU1ldHJpYy5jdXN0b21fYXR0cmlidXRlcyA9IGN1c3RvbUF0dHJpYnV0ZXM7XHJcbiAgICB9XHJcbiAgICBjb25zdCBwZXJmTWV0cmljID0ge1xyXG4gICAgICAgIGFwcGxpY2F0aW9uX2luZm86IGdldEFwcGxpY2F0aW9uSW5mbyh0cmFjZS5wZXJmb3JtYW5jZUNvbnRyb2xsZXIuYXBwKSxcclxuICAgICAgICB0cmFjZV9tZXRyaWM6IHRyYWNlTWV0cmljXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHBlcmZNZXRyaWMpO1xyXG59XHJcbmZ1bmN0aW9uIGdldEFwcGxpY2F0aW9uSW5mbyhmaXJlYmFzZUFwcCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBnb29nbGVfYXBwX2lkOiBnZXRBcHBJZChmaXJlYmFzZUFwcCksXHJcbiAgICAgICAgYXBwX2luc3RhbmNlX2lkOiBnZXRJaWQoKSxcclxuICAgICAgICB3ZWJfYXBwX2luZm86IHtcclxuICAgICAgICAgICAgc2RrX3ZlcnNpb246IFNES19WRVJTSU9OLFxyXG4gICAgICAgICAgICBwYWdlX3VybDogQXBpLmdldEluc3RhbmNlKCkuZ2V0VXJsKCksXHJcbiAgICAgICAgICAgIHNlcnZpY2Vfd29ya2VyX3N0YXR1czogZ2V0U2VydmljZVdvcmtlclN0YXR1cygpLFxyXG4gICAgICAgICAgICB2aXNpYmlsaXR5X3N0YXRlOiBnZXRWaXNpYmlsaXR5U3RhdGUoKSxcclxuICAgICAgICAgICAgZWZmZWN0aXZlX2Nvbm5lY3Rpb25fdHlwZTogZ2V0RWZmZWN0aXZlQ29ubmVjdGlvblR5cGUoKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXBwbGljYXRpb25fcHJvY2Vzc19zdGF0ZTogMFxyXG4gICAgfTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jb25zdCBNQVhfTUVUUklDX05BTUVfTEVOR1RIID0gMTAwO1xyXG5jb25zdCBSRVNFUlZFRF9BVVRPX1BSRUZJWCA9ICdfJztcclxuY29uc3Qgb29iTWV0cmljcyA9IFtcclxuICAgIEZJUlNUX1BBSU5UX0NPVU5URVJfTkFNRSxcclxuICAgIEZJUlNUX0NPTlRFTlRGVUxfUEFJTlRfQ09VTlRFUl9OQU1FLFxyXG4gICAgRklSU1RfSU5QVVRfREVMQVlfQ09VTlRFUl9OQU1FXHJcbl07XHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIG1ldHJpYyBpcyBjdXN0b20gYW5kIGRvZXMgbm90IHN0YXJ0IHdpdGggcmVzZXJ2ZWQgcHJlZml4LCBvciBpZlxyXG4gKiB0aGUgbWV0cmljIGlzIG9uZSBvZiBvdXQgb2YgdGhlIGJveCBwYWdlIGxvYWQgdHJhY2UgbWV0cmljcy5cclxuICovXHJcbmZ1bmN0aW9uIGlzVmFsaWRNZXRyaWNOYW1lKG5hbWUsIHRyYWNlTmFtZSkge1xyXG4gICAgaWYgKG5hbWUubGVuZ3RoID09PSAwIHx8IG5hbWUubGVuZ3RoID4gTUFYX01FVFJJQ19OQU1FX0xFTkdUSCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiAoKHRyYWNlTmFtZSAmJlxyXG4gICAgICAgIHRyYWNlTmFtZS5zdGFydHNXaXRoKE9PQl9UUkFDRV9QQUdFX0xPQURfUFJFRklYKSAmJlxyXG4gICAgICAgIG9vYk1ldHJpY3MuaW5kZXhPZihuYW1lKSA+IC0xKSB8fFxyXG4gICAgICAgICFuYW1lLnN0YXJ0c1dpdGgoUkVTRVJWRURfQVVUT19QUkVGSVgpKTtcclxufVxyXG4vKipcclxuICogQ29udmVydHMgdGhlIHByb3ZpZGVkIHZhbHVlIHRvIGFuIGludGVnZXIgdmFsdWUgdG8gYmUgdXNlZCBpbiBjYXNlIG9mIGEgbWV0cmljLlxyXG4gKiBAcGFyYW0gcHJvdmlkZWRWYWx1ZSBQcm92aWRlZCBudW1iZXIgdmFsdWUgb2YgdGhlIG1ldHJpYyB0aGF0IG5lZWRzIHRvIGJlIGNvbnZlcnRlZCB0byBhbiBpbnRlZ2VyLlxyXG4gKlxyXG4gKiBAcmV0dXJucyBDb252ZXJ0ZWQgaW50ZWdlciBudW1iZXIgdG8gYmUgc2V0IGZvciB0aGUgbWV0cmljLlxyXG4gKi9cclxuZnVuY3Rpb24gY29udmVydE1ldHJpY1ZhbHVlVG9JbnRlZ2VyKHByb3ZpZGVkVmFsdWUpIHtcclxuICAgIGNvbnN0IHZhbHVlQXNJbnRlZ2VyID0gTWF0aC5mbG9vcihwcm92aWRlZFZhbHVlKTtcclxuICAgIGlmICh2YWx1ZUFzSW50ZWdlciA8IHByb3ZpZGVkVmFsdWUpIHtcclxuICAgICAgICBjb25zb2xlTG9nZ2VyLmluZm8oYE1ldHJpYyB2YWx1ZSBzaG91bGQgYmUgYW4gSW50ZWdlciwgc2V0dGluZyB0aGUgdmFsdWUgYXMgOiAke3ZhbHVlQXNJbnRlZ2VyfS5gKTtcclxuICAgIH1cclxuICAgIHJldHVybiB2YWx1ZUFzSW50ZWdlcjtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBUcmFjZSB7XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBwZXJmb3JtYW5jZUNvbnRyb2xsZXIgVGhlIHBlcmZvcm1hbmNlIGNvbnRyb2xsZXIgcnVubmluZy5cclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSB0cmFjZS5cclxuICAgICAqIEBwYXJhbSBpc0F1dG8gSWYgdGhlIHRyYWNlIGlzIGF1dG8taW5zdHJ1bWVudGVkLlxyXG4gICAgICogQHBhcmFtIHRyYWNlTWVhc3VyZU5hbWUgVGhlIG5hbWUgb2YgdGhlIG1lYXN1cmUgbWFya2VyIGluIHVzZXIgdGltaW5nIHNwZWNpZmljYXRpb24uIFRoaXMgZmllbGRcclxuICAgICAqIGlzIG9ubHkgc2V0IHdoZW4gdGhlIHRyYWNlIGlzIGJ1aWx0IGZvciBsb2dnaW5nIHdoZW4gdGhlIHVzZXIgZGlyZWN0bHkgdXNlcyB0aGUgdXNlciB0aW1pbmdcclxuICAgICAqIGFwaSAocGVyZm9ybWFuY2UubWFyayBhbmQgcGVyZm9ybWFuY2UubWVhc3VyZSkuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgbmFtZSwgaXNBdXRvID0gZmFsc2UsIHRyYWNlTWVhc3VyZU5hbWUpIHtcclxuICAgICAgICB0aGlzLnBlcmZvcm1hbmNlQ29udHJvbGxlciA9IHBlcmZvcm1hbmNlQ29udHJvbGxlcjtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuaXNBdXRvID0gaXNBdXRvO1xyXG4gICAgICAgIHRoaXMuc3RhdGUgPSAxIC8qIFRyYWNlU3RhdGUuVU5JTklUSUFMSVpFRCAqLztcclxuICAgICAgICB0aGlzLmN1c3RvbUF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICB0aGlzLmNvdW50ZXJzID0ge307XHJcbiAgICAgICAgdGhpcy5hcGkgPSBBcGkuZ2V0SW5zdGFuY2UoKTtcclxuICAgICAgICB0aGlzLnJhbmRvbUlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQXV0bykge1xyXG4gICAgICAgICAgICB0aGlzLnRyYWNlU3RhcnRNYXJrID0gYCR7VFJBQ0VfU1RBUlRfTUFSS19QUkVGSVh9LSR7dGhpcy5yYW5kb21JZH0tJHt0aGlzLm5hbWV9YDtcclxuICAgICAgICAgICAgdGhpcy50cmFjZVN0b3BNYXJrID0gYCR7VFJBQ0VfU1RPUF9NQVJLX1BSRUZJWH0tJHt0aGlzLnJhbmRvbUlkfS0ke3RoaXMubmFtZX1gO1xyXG4gICAgICAgICAgICB0aGlzLnRyYWNlTWVhc3VyZSA9XHJcbiAgICAgICAgICAgICAgICB0cmFjZU1lYXN1cmVOYW1lIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgYCR7VFJBQ0VfTUVBU1VSRV9QUkVGSVh9LSR7dGhpcy5yYW5kb21JZH0tJHt0aGlzLm5hbWV9YDtcclxuICAgICAgICAgICAgaWYgKHRyYWNlTWVhc3VyZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgIC8vIEZvciB0aGUgY2FzZSBvZiBkaXJlY3QgdXNlciB0aW1pbmcgdHJhY2VzLCBubyBzdGFydCBzdG9wIHdpbGwgaGFwcGVuLiBUaGUgbWVhc3VyZSBvYmplY3RcclxuICAgICAgICAgICAgICAgIC8vIGlzIGFscmVhZHkgYXZhaWxhYmxlLlxyXG4gICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGVUcmFjZU1ldHJpY3MoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU3RhcnRzIGEgdHJhY2UuIFRoZSBtZWFzdXJlbWVudCBvZiB0aGUgZHVyYXRpb24gc3RhcnRzIGF0IHRoaXMgcG9pbnQuXHJcbiAgICAgKi9cclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAxIC8qIFRyYWNlU3RhdGUuVU5JTklUSUFMSVpFRCAqLykge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcInRyYWNlIHN0YXJ0ZWRcIiAvKiBFcnJvckNvZGUuVFJBQ0VfU1RBUlRFRF9CRUZPUkUgKi8sIHtcclxuICAgICAgICAgICAgICAgIHRyYWNlTmFtZTogdGhpcy5uYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFwaS5tYXJrKHRoaXMudHJhY2VTdGFydE1hcmspO1xyXG4gICAgICAgIHRoaXMuc3RhdGUgPSAyIC8qIFRyYWNlU3RhdGUuUlVOTklORyAqLztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU3RvcHMgdGhlIHRyYWNlLiBUaGUgbWVhc3VyZW1lbnQgb2YgdGhlIGR1cmF0aW9uIG9mIHRoZSB0cmFjZSBzdG9wcyBhdCB0aGlzIHBvaW50IGFuZCB0cmFjZVxyXG4gICAgICogaXMgbG9nZ2VkLlxyXG4gICAgICovXHJcbiAgICBzdG9wKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSAyIC8qIFRyYWNlU3RhdGUuUlVOTklORyAqLykge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcInRyYWNlIHN0b3BwZWRcIiAvKiBFcnJvckNvZGUuVFJBQ0VfU1RPUFBFRF9CRUZPUkUgKi8sIHtcclxuICAgICAgICAgICAgICAgIHRyYWNlTmFtZTogdGhpcy5uYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN0YXRlID0gMyAvKiBUcmFjZVN0YXRlLlRFUk1JTkFURUQgKi87XHJcbiAgICAgICAgdGhpcy5hcGkubWFyayh0aGlzLnRyYWNlU3RvcE1hcmspO1xyXG4gICAgICAgIHRoaXMuYXBpLm1lYXN1cmUodGhpcy50cmFjZU1lYXN1cmUsIHRoaXMudHJhY2VTdGFydE1hcmssIHRoaXMudHJhY2VTdG9wTWFyayk7XHJcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVUcmFjZU1ldHJpY3MoKTtcclxuICAgICAgICBsb2dUcmFjZSh0aGlzKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVjb3JkcyBhIHRyYWNlIHdpdGggcHJlZGV0ZXJtaW5lZCB2YWx1ZXMuIElmIHRoaXMgbWV0aG9kIGlzIHVzZWQgYSB0cmFjZSBpcyBjcmVhdGVkIGFuZCBsb2dnZWRcclxuICAgICAqIGRpcmVjdGx5LiBObyBuZWVkIHRvIHVzZSBzdGFydCBhbmQgc3RvcCBtZXRob2RzLlxyXG4gICAgICogQHBhcmFtIHN0YXJ0VGltZSBUcmFjZSBzdGFydCB0aW1lIHNpbmNlIGVwb2NoIGluIG1pbGxpc2VjXHJcbiAgICAgKiBAcGFyYW0gZHVyYXRpb24gVGhlIGR1cmFjdGlvbiBvZiB0aGUgdHJhY2UgaW4gbWlsbGlzZWNcclxuICAgICAqIEBwYXJhbSBvcHRpb25zIEFuIG9iamVjdCB3aGljaCBjYW4gb3B0aW9uYWxseSBob2xkIG1hcHMgb2YgY3VzdG9tIG1ldHJpY3MgYW5kIGN1c3RvbSBhdHRyaWJ1dGVzXHJcbiAgICAgKi9cclxuICAgIHJlY29yZChzdGFydFRpbWUsIGR1cmF0aW9uLCBvcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKHN0YXJ0VGltZSA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwibm9ucG9zaXRpdmUgdHJhY2Ugc3RhcnRUaW1lXCIgLyogRXJyb3JDb2RlLk5PTlBPU0lUSVZFX1RSQUNFX1NUQVJUX1RJTUUgKi8sIHtcclxuICAgICAgICAgICAgICAgIHRyYWNlTmFtZTogdGhpcy5uYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZHVyYXRpb24gPD0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcIm5vbnBvc2l0aXZlIHRyYWNlIGR1cmF0aW9uXCIgLyogRXJyb3JDb2RlLk5PTlBPU0lUSVZFX1RSQUNFX0RVUkFUSU9OICovLCB7XHJcbiAgICAgICAgICAgICAgICB0cmFjZU5hbWU6IHRoaXMubmFtZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kdXJhdGlvblVzID0gTWF0aC5mbG9vcihkdXJhdGlvbiAqIDEwMDApO1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lVXMgPSBNYXRoLmZsb29yKHN0YXJ0VGltZSAqIDEwMDApO1xyXG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICB0aGlzLmN1c3RvbUF0dHJpYnV0ZXMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLmF0dHJpYnV0ZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLm1ldHJpY3MpIHtcclxuICAgICAgICAgICAgZm9yIChjb25zdCBtZXRyaWNOYW1lIG9mIE9iamVjdC5rZXlzKG9wdGlvbnMubWV0cmljcykpIHtcclxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4oTnVtYmVyKG9wdGlvbnMubWV0cmljc1ttZXRyaWNOYW1lXSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb3VudGVyc1ttZXRyaWNOYW1lXSA9IE1hdGguZmxvb3IoTnVtYmVyKG9wdGlvbnMubWV0cmljc1ttZXRyaWNOYW1lXSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvZ1RyYWNlKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBJbmNyZW1lbnRzIGEgY3VzdG9tIG1ldHJpYyBieSBhIGNlcnRhaW4gbnVtYmVyIG9yIDEgaWYgbnVtYmVyIG5vdCBzcGVjaWZpZWQuIFdpbGwgY3JlYXRlIGEgbmV3XHJcbiAgICAgKiBjdXN0b20gbWV0cmljIGlmIG9uZSB3aXRoIHRoZSBnaXZlbiBuYW1lIGRvZXMgbm90IGV4aXN0LiBUaGUgdmFsdWUgd2lsbCBiZSBmbG9vcmVkIGRvd24gdG8gYW5cclxuICAgICAqIGludGVnZXIuXHJcbiAgICAgKiBAcGFyYW0gY291bnRlciBOYW1lIG9mIHRoZSBjdXN0b20gbWV0cmljXHJcbiAgICAgKiBAcGFyYW0gbnVtQXNJbnRlZ2VyIEluY3JlbWVudCBieSB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBpbmNyZW1lbnRNZXRyaWMoY291bnRlciwgbnVtQXNJbnRlZ2VyID0gMSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvdW50ZXJzW2NvdW50ZXJdID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5wdXRNZXRyaWMoY291bnRlciwgbnVtQXNJbnRlZ2VyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucHV0TWV0cmljKGNvdW50ZXIsIHRoaXMuY291bnRlcnNbY291bnRlcl0gKyBudW1Bc0ludGVnZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyBhIGN1c3RvbSBtZXRyaWMgdG8gYSBzcGVjaWZpZWQgdmFsdWUuIFdpbGwgY3JlYXRlIGEgbmV3IGN1c3RvbSBtZXRyaWMgaWYgb25lIHdpdGggdGhlXHJcbiAgICAgKiBnaXZlbiBuYW1lIGRvZXMgbm90IGV4aXN0LiBUaGUgdmFsdWUgd2lsbCBiZSBmbG9vcmVkIGRvd24gdG8gYW4gaW50ZWdlci5cclxuICAgICAqIEBwYXJhbSBjb3VudGVyIE5hbWUgb2YgdGhlIGN1c3RvbSBtZXRyaWNcclxuICAgICAqIEBwYXJhbSBudW1Bc0ludGVnZXIgU2V0IGN1c3RvbSBtZXRyaWMgdG8gdGhpcyB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBwdXRNZXRyaWMoY291bnRlciwgbnVtQXNJbnRlZ2VyKSB7XHJcbiAgICAgICAgaWYgKGlzVmFsaWRNZXRyaWNOYW1lKGNvdW50ZXIsIHRoaXMubmFtZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5jb3VudGVyc1tjb3VudGVyXSA9IGNvbnZlcnRNZXRyaWNWYWx1ZVRvSW50ZWdlcihudW1Bc0ludGVnZXIgIT09IG51bGwgJiYgbnVtQXNJbnRlZ2VyICE9PSB2b2lkIDAgPyBudW1Bc0ludGVnZXIgOiAwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaW52YWxpZCBjdXN0b20gbWV0cmljIG5hbWVcIiAvKiBFcnJvckNvZGUuSU5WQUxJRF9DVVNUT01fTUVUUklDX05BTUUgKi8sIHtcclxuICAgICAgICAgICAgICAgIGN1c3RvbU1ldHJpY05hbWU6IGNvdW50ZXJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgY3VzdG9tIG1ldHJpYyBieSB0aGF0IG5hbWUuIElmIGEgY3VzdG9tIG1ldHJpYyB3aXRoIHRoYXQgbmFtZSBkb2VzXHJcbiAgICAgKiBub3QgZXhpc3Qgd2lsbCByZXR1cm4gemVyby5cclxuICAgICAqIEBwYXJhbSBjb3VudGVyXHJcbiAgICAgKi9cclxuICAgIGdldE1ldHJpYyhjb3VudGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY291bnRlcnNbY291bnRlcl0gfHwgMDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogU2V0cyBhIGN1c3RvbSBhdHRyaWJ1dGUgb2YgYSB0cmFjZSB0byBhIGNlcnRhaW4gdmFsdWUuXHJcbiAgICAgKiBAcGFyYW0gYXR0clxyXG4gICAgICogQHBhcmFtIHZhbHVlXHJcbiAgICAgKi9cclxuICAgIHB1dEF0dHJpYnV0ZShhdHRyLCB2YWx1ZSkge1xyXG4gICAgICAgIGNvbnN0IGlzVmFsaWROYW1lID0gaXNWYWxpZEN1c3RvbUF0dHJpYnV0ZU5hbWUoYXR0cik7XHJcbiAgICAgICAgY29uc3QgaXNWYWxpZFZhbHVlID0gaXNWYWxpZEN1c3RvbUF0dHJpYnV0ZVZhbHVlKHZhbHVlKTtcclxuICAgICAgICBpZiAoaXNWYWxpZE5hbWUgJiYgaXNWYWxpZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY3VzdG9tQXR0cmlidXRlc1thdHRyXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFRocm93IGFwcHJvcHJpYXRlIGVycm9yIHdoZW4gdGhlIGF0dHJpYnV0ZSBuYW1lIG9yIHZhbHVlIGlzIGludmFsaWQuXHJcbiAgICAgICAgaWYgKCFpc1ZhbGlkTmFtZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImludmFsaWQgYXR0cmlidXRlIG5hbWVcIiAvKiBFcnJvckNvZGUuSU5WQUxJRF9BVFRSSUJVVEVfTkFNRSAqLywge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlTmFtZTogYXR0clxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpc1ZhbGlkVmFsdWUpIHtcclxuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpbnZhbGlkIGF0dHJpYnV0ZSB2YWx1ZVwiIC8qIEVycm9yQ29kZS5JTlZBTElEX0FUVFJJQlVURV9WQUxVRSAqLywge1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlVmFsdWU6IHZhbHVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0cmlldmVzIHRoZSB2YWx1ZSBhIGN1c3RvbSBhdHRyaWJ1dGUgb2YgYSB0cmFjZSBpcyBzZXQgdG8uXHJcbiAgICAgKiBAcGFyYW0gYXR0clxyXG4gICAgICovXHJcbiAgICBnZXRBdHRyaWJ1dGUoYXR0cikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1c3RvbUF0dHJpYnV0ZXNbYXR0cl07XHJcbiAgICB9XHJcbiAgICByZW1vdmVBdHRyaWJ1dGUoYXR0cikge1xyXG4gICAgICAgIGlmICh0aGlzLmN1c3RvbUF0dHJpYnV0ZXNbYXR0cl0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlbGV0ZSB0aGlzLmN1c3RvbUF0dHJpYnV0ZXNbYXR0cl07XHJcbiAgICB9XHJcbiAgICBnZXRBdHRyaWJ1dGVzKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmN1c3RvbUF0dHJpYnV0ZXMpO1xyXG4gICAgfVxyXG4gICAgc2V0U3RhcnRUaW1lKHN0YXJ0VGltZSkge1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lVXMgPSBzdGFydFRpbWU7XHJcbiAgICB9XHJcbiAgICBzZXREdXJhdGlvbihkdXJhdGlvbikge1xyXG4gICAgICAgIHRoaXMuZHVyYXRpb25VcyA9IGR1cmF0aW9uO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxjdWxhdGVzIGFuZCBhc3NpZ25zIHRoZSBkdXJhdGlvbiBhbmQgc3RhcnQgdGltZSBvZiB0aGUgdHJhY2UgdXNpbmcgdGhlIG1lYXN1cmUgcGVyZm9ybWFuY2VcclxuICAgICAqIGVudHJ5LlxyXG4gICAgICovXHJcbiAgICBjYWxjdWxhdGVUcmFjZU1ldHJpY3MoKSB7XHJcbiAgICAgICAgY29uc3QgcGVyZk1lYXN1cmVFbnRyaWVzID0gdGhpcy5hcGkuZ2V0RW50cmllc0J5TmFtZSh0aGlzLnRyYWNlTWVhc3VyZSk7XHJcbiAgICAgICAgY29uc3QgcGVyZk1lYXN1cmVFbnRyeSA9IHBlcmZNZWFzdXJlRW50cmllcyAmJiBwZXJmTWVhc3VyZUVudHJpZXNbMF07XHJcbiAgICAgICAgaWYgKHBlcmZNZWFzdXJlRW50cnkpIHtcclxuICAgICAgICAgICAgdGhpcy5kdXJhdGlvblVzID0gTWF0aC5mbG9vcihwZXJmTWVhc3VyZUVudHJ5LmR1cmF0aW9uICogMTAwMCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lVXMgPSBNYXRoLmZsb29yKChwZXJmTWVhc3VyZUVudHJ5LnN0YXJ0VGltZSArIHRoaXMuYXBpLmdldFRpbWVPcmlnaW4oKSkgKiAxMDAwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEBwYXJhbSBuYXZpZ2F0aW9uVGltaW5ncyBBIHNpbmdsZSBlbGVtZW50IGFycmF5IHdoaWNoIGNvbnRhaW5zIHRoZSBuYXZpZ2F0aW9uVEltaW5nIG9iamVjdCBvZlxyXG4gICAgICogdGhlIHBhZ2UgbG9hZFxyXG4gICAgICogQHBhcmFtIHBhaW50VGltaW5ncyBBIGFycmF5IHdoaWNoIGNvbnRhaW5zIHBhaW50VGltaW5nIG9iamVjdCBvZiB0aGUgcGFnZSBsb2FkXHJcbiAgICAgKiBAcGFyYW0gZmlyc3RJbnB1dERlbGF5IEZpcnN0IGlucHV0IGRlbGF5IGluIG1pbGxpc2VjXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBjcmVhdGVPb2JUcmFjZShwZXJmb3JtYW5jZUNvbnRyb2xsZXIsIG5hdmlnYXRpb25UaW1pbmdzLCBwYWludFRpbWluZ3MsIGZpcnN0SW5wdXREZWxheSkge1xyXG4gICAgICAgIGNvbnN0IHJvdXRlID0gQXBpLmdldEluc3RhbmNlKCkuZ2V0VXJsKCk7XHJcbiAgICAgICAgaWYgKCFyb3V0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHRyYWNlID0gbmV3IFRyYWNlKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgT09CX1RSQUNFX1BBR0VfTE9BRF9QUkVGSVggKyByb3V0ZSwgdHJ1ZSk7XHJcbiAgICAgICAgY29uc3QgdGltZU9yaWdpblVzID0gTWF0aC5mbG9vcihBcGkuZ2V0SW5zdGFuY2UoKS5nZXRUaW1lT3JpZ2luKCkgKiAxMDAwKTtcclxuICAgICAgICB0cmFjZS5zZXRTdGFydFRpbWUodGltZU9yaWdpblVzKTtcclxuICAgICAgICAvLyBuYXZpZ2F0aW9uVGltaW5ncyBpbmNsdWRlcyBvbmx5IG9uZSBlbGVtZW50LlxyXG4gICAgICAgIGlmIChuYXZpZ2F0aW9uVGltaW5ncyAmJiBuYXZpZ2F0aW9uVGltaW5nc1swXSkge1xyXG4gICAgICAgICAgICB0cmFjZS5zZXREdXJhdGlvbihNYXRoLmZsb29yKG5hdmlnYXRpb25UaW1pbmdzWzBdLmR1cmF0aW9uICogMTAwMCkpO1xyXG4gICAgICAgICAgICB0cmFjZS5wdXRNZXRyaWMoJ2RvbUludGVyYWN0aXZlJywgTWF0aC5mbG9vcihuYXZpZ2F0aW9uVGltaW5nc1swXS5kb21JbnRlcmFjdGl2ZSAqIDEwMDApKTtcclxuICAgICAgICAgICAgdHJhY2UucHV0TWV0cmljKCdkb21Db250ZW50TG9hZGVkRXZlbnRFbmQnLCBNYXRoLmZsb29yKG5hdmlnYXRpb25UaW1pbmdzWzBdLmRvbUNvbnRlbnRMb2FkZWRFdmVudEVuZCAqIDEwMDApKTtcclxuICAgICAgICAgICAgdHJhY2UucHV0TWV0cmljKCdsb2FkRXZlbnRFbmQnLCBNYXRoLmZsb29yKG5hdmlnYXRpb25UaW1pbmdzWzBdLmxvYWRFdmVudEVuZCAqIDEwMDApKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgRklSU1RfUEFJTlQgPSAnZmlyc3QtcGFpbnQnO1xyXG4gICAgICAgIGNvbnN0IEZJUlNUX0NPTlRFTlRGVUxfUEFJTlQgPSAnZmlyc3QtY29udGVudGZ1bC1wYWludCc7XHJcbiAgICAgICAgaWYgKHBhaW50VGltaW5ncykge1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdFBhaW50ID0gcGFpbnRUaW1pbmdzLmZpbmQocGFpbnRPYmplY3QgPT4gcGFpbnRPYmplY3QubmFtZSA9PT0gRklSU1RfUEFJTlQpO1xyXG4gICAgICAgICAgICBpZiAoZmlyc3RQYWludCAmJiBmaXJzdFBhaW50LnN0YXJ0VGltZSkge1xyXG4gICAgICAgICAgICAgICAgdHJhY2UucHV0TWV0cmljKEZJUlNUX1BBSU5UX0NPVU5URVJfTkFNRSwgTWF0aC5mbG9vcihmaXJzdFBhaW50LnN0YXJ0VGltZSAqIDEwMDApKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zdCBmaXJzdENvbnRlbnRmdWxQYWludCA9IHBhaW50VGltaW5ncy5maW5kKHBhaW50T2JqZWN0ID0+IHBhaW50T2JqZWN0Lm5hbWUgPT09IEZJUlNUX0NPTlRFTlRGVUxfUEFJTlQpO1xyXG4gICAgICAgICAgICBpZiAoZmlyc3RDb250ZW50ZnVsUGFpbnQgJiYgZmlyc3RDb250ZW50ZnVsUGFpbnQuc3RhcnRUaW1lKSB7XHJcbiAgICAgICAgICAgICAgICB0cmFjZS5wdXRNZXRyaWMoRklSU1RfQ09OVEVOVEZVTF9QQUlOVF9DT1VOVEVSX05BTUUsIE1hdGguZmxvb3IoZmlyc3RDb250ZW50ZnVsUGFpbnQuc3RhcnRUaW1lICogMTAwMCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChmaXJzdElucHV0RGVsYXkpIHtcclxuICAgICAgICAgICAgICAgIHRyYWNlLnB1dE1ldHJpYyhGSVJTVF9JTlBVVF9ERUxBWV9DT1VOVEVSX05BTUUsIE1hdGguZmxvb3IoZmlyc3RJbnB1dERlbGF5ICogMTAwMCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvZ1RyYWNlKHRyYWNlKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBjcmVhdGVVc2VyVGltaW5nVHJhY2UocGVyZm9ybWFuY2VDb250cm9sbGVyLCBtZWFzdXJlTmFtZSkge1xyXG4gICAgICAgIGNvbnN0IHRyYWNlID0gbmV3IFRyYWNlKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgbWVhc3VyZU5hbWUsIGZhbHNlLCBtZWFzdXJlTmFtZSk7XHJcbiAgICAgICAgbG9nVHJhY2UodHJhY2UpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZU5ldHdvcmtSZXF1ZXN0RW50cnkocGVyZm9ybWFuY2VDb250cm9sbGVyLCBlbnRyeSkge1xyXG4gICAgY29uc3QgcGVyZm9ybWFuY2VFbnRyeSA9IGVudHJ5O1xyXG4gICAgaWYgKCFwZXJmb3JtYW5jZUVudHJ5IHx8IHBlcmZvcm1hbmNlRW50cnkucmVzcG9uc2VTdGFydCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdGltZU9yaWdpbiA9IEFwaS5nZXRJbnN0YW5jZSgpLmdldFRpbWVPcmlnaW4oKTtcclxuICAgIGNvbnN0IHN0YXJ0VGltZVVzID0gTWF0aC5mbG9vcigocGVyZm9ybWFuY2VFbnRyeS5zdGFydFRpbWUgKyB0aW1lT3JpZ2luKSAqIDEwMDApO1xyXG4gICAgY29uc3QgdGltZVRvUmVzcG9uc2VJbml0aWF0ZWRVcyA9IHBlcmZvcm1hbmNlRW50cnkucmVzcG9uc2VTdGFydFxyXG4gICAgICAgID8gTWF0aC5mbG9vcigocGVyZm9ybWFuY2VFbnRyeS5yZXNwb25zZVN0YXJ0IC0gcGVyZm9ybWFuY2VFbnRyeS5zdGFydFRpbWUpICogMTAwMClcclxuICAgICAgICA6IHVuZGVmaW5lZDtcclxuICAgIGNvbnN0IHRpbWVUb1Jlc3BvbnNlQ29tcGxldGVkVXMgPSBNYXRoLmZsb29yKChwZXJmb3JtYW5jZUVudHJ5LnJlc3BvbnNlRW5kIC0gcGVyZm9ybWFuY2VFbnRyeS5zdGFydFRpbWUpICogMTAwMCk7XHJcbiAgICAvLyBSZW1vdmUgdGhlIHF1ZXJ5IHBhcmFtcyBmcm9tIGxvZ2dlZCBuZXR3b3JrIHJlcXVlc3QgdXJsLlxyXG4gICAgY29uc3QgdXJsID0gcGVyZm9ybWFuY2VFbnRyeS5uYW1lICYmIHBlcmZvcm1hbmNlRW50cnkubmFtZS5zcGxpdCgnPycpWzBdO1xyXG4gICAgY29uc3QgbmV0d29ya1JlcXVlc3QgPSB7XHJcbiAgICAgICAgcGVyZm9ybWFuY2VDb250cm9sbGVyLFxyXG4gICAgICAgIHVybCxcclxuICAgICAgICByZXNwb25zZVBheWxvYWRCeXRlczogcGVyZm9ybWFuY2VFbnRyeS50cmFuc2ZlclNpemUsXHJcbiAgICAgICAgc3RhcnRUaW1lVXMsXHJcbiAgICAgICAgdGltZVRvUmVzcG9uc2VJbml0aWF0ZWRVcyxcclxuICAgICAgICB0aW1lVG9SZXNwb25zZUNvbXBsZXRlZFVzXHJcbiAgICB9O1xyXG4gICAgbG9nTmV0d29ya1JlcXVlc3QobmV0d29ya1JlcXVlc3QpO1xyXG59XG5cbi8qKlxyXG4gKiBAbGljZW5zZVxyXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcbmNvbnN0IEZJRF9XQUlUX1RJTUVfTVMgPSA1MDAwO1xyXG5mdW5jdGlvbiBzZXR1cE9vYlJlc291cmNlcyhwZXJmb3JtYW5jZUNvbnRyb2xsZXIpIHtcclxuICAgIC8vIERvIG5vdCBpbml0aWFsaXplIHVubGVzcyBpaWQgaXMgYXZhaWxhYmxlLlxyXG4gICAgaWYgKCFnZXRJaWQoKSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIFRoZSBsb2FkIGV2ZW50IG1pZ2h0IG5vdCBoYXZlIGZpcmVkIHlldCwgYW5kIHRoYXQgbWVhbnMgcGVyZm9ybWFuY2UgbmF2aWdhdGlvbiB0aW1pbmdcclxuICAgIC8vIG9iamVjdCBoYXMgYSBkdXJhdGlvbiBvZiAwLiBUaGUgc2V0dXAgc2hvdWxkIHJ1biBhZnRlciBhbGwgY3VycmVudCB0YXNrcyBpbiBqcyBxdWV1ZS5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4gc2V0dXBPb2JUcmFjZXMocGVyZm9ybWFuY2VDb250cm9sbGVyKSwgMCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHNldHVwTmV0d29ya1JlcXVlc3RzKHBlcmZvcm1hbmNlQ29udHJvbGxlciksIDApO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiBzZXR1cFVzZXJUaW1pbmdUcmFjZXMocGVyZm9ybWFuY2VDb250cm9sbGVyKSwgMCk7XHJcbn1cclxuZnVuY3Rpb24gc2V0dXBOZXR3b3JrUmVxdWVzdHMocGVyZm9ybWFuY2VDb250cm9sbGVyKSB7XHJcbiAgICBjb25zdCBhcGkgPSBBcGkuZ2V0SW5zdGFuY2UoKTtcclxuICAgIGNvbnN0IHJlc291cmNlcyA9IGFwaS5nZXRFbnRyaWVzQnlUeXBlKCdyZXNvdXJjZScpO1xyXG4gICAgZm9yIChjb25zdCByZXNvdXJjZSBvZiByZXNvdXJjZXMpIHtcclxuICAgICAgICBjcmVhdGVOZXR3b3JrUmVxdWVzdEVudHJ5KHBlcmZvcm1hbmNlQ29udHJvbGxlciwgcmVzb3VyY2UpO1xyXG4gICAgfVxyXG4gICAgYXBpLnNldHVwT2JzZXJ2ZXIoJ3Jlc291cmNlJywgZW50cnkgPT4gY3JlYXRlTmV0d29ya1JlcXVlc3RFbnRyeShwZXJmb3JtYW5jZUNvbnRyb2xsZXIsIGVudHJ5KSk7XHJcbn1cclxuZnVuY3Rpb24gc2V0dXBPb2JUcmFjZXMocGVyZm9ybWFuY2VDb250cm9sbGVyKSB7XHJcbiAgICBjb25zdCBhcGkgPSBBcGkuZ2V0SW5zdGFuY2UoKTtcclxuICAgIGNvbnN0IG5hdmlnYXRpb25UaW1pbmdzID0gYXBpLmdldEVudHJpZXNCeVR5cGUoJ25hdmlnYXRpb24nKTtcclxuICAgIGNvbnN0IHBhaW50VGltaW5ncyA9IGFwaS5nZXRFbnRyaWVzQnlUeXBlKCdwYWludCcpO1xyXG4gICAgLy8gSWYgRmlyc3QgSW5wdXQgRGVzbHkgcG9seWZpbGwgaXMgYWRkZWQgdG8gdGhlIHBhZ2UsIHJlcG9ydCB0aGUgZmlkIHZhbHVlLlxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0dvb2dsZUNocm9tZUxhYnMvZmlyc3QtaW5wdXQtZGVsYXlcclxuICAgIGlmIChhcGkub25GaXJzdElucHV0RGVsYXkpIHtcclxuICAgICAgICAvLyBJZiB0aGUgZmlkIGNhbGwgYmFjayBpcyBub3QgY2FsbGVkIGZvciBjZXJ0YWluIHRpbWUsIGNvbnRpbnVlIHdpdGhvdXQgaXQuXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcclxuICAgICAgICBsZXQgdGltZW91dElkID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIFRyYWNlLmNyZWF0ZU9vYlRyYWNlKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgbmF2aWdhdGlvblRpbWluZ3MsIHBhaW50VGltaW5ncyk7XHJcbiAgICAgICAgICAgIHRpbWVvdXRJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9LCBGSURfV0FJVF9USU1FX01TKTtcclxuICAgICAgICBhcGkub25GaXJzdElucHV0RGVsYXkoKGZpZCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGltZW91dElkKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcclxuICAgICAgICAgICAgICAgIFRyYWNlLmNyZWF0ZU9vYlRyYWNlKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgbmF2aWdhdGlvblRpbWluZ3MsIHBhaW50VGltaW5ncywgZmlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgVHJhY2UuY3JlYXRlT29iVHJhY2UocGVyZm9ybWFuY2VDb250cm9sbGVyLCBuYXZpZ2F0aW9uVGltaW5ncywgcGFpbnRUaW1pbmdzKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBzZXR1cFVzZXJUaW1pbmdUcmFjZXMocGVyZm9ybWFuY2VDb250cm9sbGVyKSB7XHJcbiAgICBjb25zdCBhcGkgPSBBcGkuZ2V0SW5zdGFuY2UoKTtcclxuICAgIC8vIFJ1biB0aHJvdWdoIHRoZSBtZWFzdXJlIHBlcmZvcm1hbmNlIGVudHJpZXMgY29sbGVjdGVkIHVwIHRvIHRoaXMgcG9pbnQuXHJcbiAgICBjb25zdCBtZWFzdXJlcyA9IGFwaS5nZXRFbnRyaWVzQnlUeXBlKCdtZWFzdXJlJyk7XHJcbiAgICBmb3IgKGNvbnN0IG1lYXN1cmUgb2YgbWVhc3VyZXMpIHtcclxuICAgICAgICBjcmVhdGVVc2VyVGltaW5nVHJhY2UocGVyZm9ybWFuY2VDb250cm9sbGVyLCBtZWFzdXJlKTtcclxuICAgIH1cclxuICAgIC8vIFNldHVwIGFuIG9ic2VydmVyIHRvIGNhcHR1cmUgdGhlIG1lYXN1cmVzIGZyb20gdGhpcyBwb2ludCBvbi5cclxuICAgIGFwaS5zZXR1cE9ic2VydmVyKCdtZWFzdXJlJywgZW50cnkgPT4gY3JlYXRlVXNlclRpbWluZ1RyYWNlKHBlcmZvcm1hbmNlQ29udHJvbGxlciwgZW50cnkpKTtcclxufVxyXG5mdW5jdGlvbiBjcmVhdGVVc2VyVGltaW5nVHJhY2UocGVyZm9ybWFuY2VDb250cm9sbGVyLCBtZWFzdXJlKSB7XHJcbiAgICBjb25zdCBtZWFzdXJlTmFtZSA9IG1lYXN1cmUubmFtZTtcclxuICAgIC8vIERvIG5vdCBjcmVhdGUgYSB0cmFjZSwgaWYgdGhlIHVzZXIgdGltaW5nIG1hcmtzIGFuZCBtZWFzdXJlcyBhcmUgY3JlYXRlZCBieSB0aGUgc2RrIGl0c2VsZi5cclxuICAgIGlmIChtZWFzdXJlTmFtZS5zdWJzdHJpbmcoMCwgVFJBQ0VfTUVBU1VSRV9QUkVGSVgubGVuZ3RoKSA9PT1cclxuICAgICAgICBUUkFDRV9NRUFTVVJFX1BSRUZJWCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFRyYWNlLmNyZWF0ZVVzZXJUaW1pbmdUcmFjZShwZXJmb3JtYW5jZUNvbnRyb2xsZXIsIG1lYXN1cmVOYW1lKTtcclxufVxuXG4vKipcclxuICogQGxpY2Vuc2VcclxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5jbGFzcyBQZXJmb3JtYW5jZUNvbnRyb2xsZXIge1xyXG4gICAgY29uc3RydWN0b3IoYXBwLCBpbnN0YWxsYXRpb25zKSB7XHJcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XHJcbiAgICAgICAgdGhpcy5pbnN0YWxsYXRpb25zID0gaW5zdGFsbGF0aW9ucztcclxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFRoaXMgbWV0aG9kICptdXN0KiBiZSBjYWxsZWQgaW50ZXJuYWxseSBhcyBwYXJ0IG9mIGNyZWF0aW5nIGFcclxuICAgICAqIFBlcmZvcm1hbmNlQ29udHJvbGxlciBpbnN0YW5jZS5cclxuICAgICAqXHJcbiAgICAgKiBDdXJyZW50bHkgaXQncyBub3QgcG9zc2libGUgdG8gcGFzcyB0aGUgc2V0dGluZ3Mgb2JqZWN0IHRocm91Z2ggdGhlXHJcbiAgICAgKiBjb25zdHJ1Y3RvciB1c2luZyBDb21wb25lbnRzLCBzbyB0aGlzIG1ldGhvZCBleGlzdHMgdG8gYmUgY2FsbGVkIHdpdGggdGhlXHJcbiAgICAgKiBkZXNpcmVkIHNldHRpbmdzLCB0byBlbnN1cmUgbm90aGluZyBpcyBjb2xsZWN0ZWQgd2l0aG91dCB0aGUgdXNlcidzXHJcbiAgICAgKiBjb25zZW50LlxyXG4gICAgICovXHJcbiAgICBfaW5pdChzZXR0aW5ncykge1xyXG4gICAgICAgIGlmICh0aGlzLmluaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKChzZXR0aW5ncyA9PT0gbnVsbCB8fCBzZXR0aW5ncyA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2V0dGluZ3MuZGF0YUNvbGxlY3Rpb25FbmFibGVkKSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YUNvbGxlY3Rpb25FbmFibGVkID0gc2V0dGluZ3MuZGF0YUNvbGxlY3Rpb25FbmFibGVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoKHNldHRpbmdzID09PSBudWxsIHx8IHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXR0aW5ncy5pbnN0cnVtZW50YXRpb25FbmFibGVkKSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5zdHJ1bWVudGF0aW9uRW5hYmxlZCA9IHNldHRpbmdzLmluc3RydW1lbnRhdGlvbkVuYWJsZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChBcGkuZ2V0SW5zdGFuY2UoKS5yZXF1aXJlZEFwaXNBdmFpbGFibGUoKSkge1xyXG4gICAgICAgICAgICB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGlzQXZhaWxhYmxlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChpc0F2YWlsYWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldHVwVHJhbnNwb3J0U2VydmljZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGdldEluaXRpYWxpemF0aW9uUHJvbWlzZSh0aGlzKS50aGVuKCgpID0+IHNldHVwT29iUmVzb3VyY2VzKHRoaXMpLCAoKSA9PiBzZXR1cE9vYlJlc291cmNlcyh0aGlzKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZUxvZ2dlci5pbmZvKGBFbnZpcm9ubWVudCBkb2Vzbid0IHN1cHBvcnQgSW5kZXhlZERCOiAke2Vycm9yfWApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGVMb2dnZXIuaW5mbygnRmlyZWJhc2UgUGVyZm9ybWFuY2UgY2Fubm90IHN0YXJ0IGlmIHRoZSBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgJyArXHJcbiAgICAgICAgICAgICAgICAnXCJGZXRjaFwiIGFuZCBcIlByb21pc2VcIiwgb3IgY29va2llcyBhcmUgZGlzYWJsZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2V0IGluc3RydW1lbnRhdGlvbkVuYWJsZWQodmFsKSB7XHJcbiAgICAgICAgU2V0dGluZ3NTZXJ2aWNlLmdldEluc3RhbmNlKCkuaW5zdHJ1bWVudGF0aW9uRW5hYmxlZCA9IHZhbDtcclxuICAgIH1cclxuICAgIGdldCBpbnN0cnVtZW50YXRpb25FbmFibGVkKCkge1xyXG4gICAgICAgIHJldHVybiBTZXR0aW5nc1NlcnZpY2UuZ2V0SW5zdGFuY2UoKS5pbnN0cnVtZW50YXRpb25FbmFibGVkO1xyXG4gICAgfVxyXG4gICAgc2V0IGRhdGFDb2xsZWN0aW9uRW5hYmxlZCh2YWwpIHtcclxuICAgICAgICBTZXR0aW5nc1NlcnZpY2UuZ2V0SW5zdGFuY2UoKS5kYXRhQ29sbGVjdGlvbkVuYWJsZWQgPSB2YWw7XHJcbiAgICB9XHJcbiAgICBnZXQgZGF0YUNvbGxlY3Rpb25FbmFibGVkKCkge1xyXG4gICAgICAgIHJldHVybiBTZXR0aW5nc1NlcnZpY2UuZ2V0SW5zdGFuY2UoKS5kYXRhQ29sbGVjdGlvbkVuYWJsZWQ7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEZpcmViYXNlIFBlcmZvcm1hbmNlIE1vbml0b3JpbmdcclxuICpcclxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXHJcbiAqL1xyXG5jb25zdCBERUZBVUxUX0VOVFJZX05BTUUgPSAnW0RFRkFVTFRdJztcclxuLyoqXHJcbiAqIFJldHVybnMgYSB7QGxpbmsgRmlyZWJhc2VQZXJmb3JtYW5jZX0gaW5zdGFuY2UgZm9yIHRoZSBnaXZlbiBhcHAuXHJcbiAqIEBwYXJhbSBhcHAgLSBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IHRvIHVzZS5cclxuICogQHB1YmxpY1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0UGVyZm9ybWFuY2UoYXBwID0gZ2V0QXBwKCkpIHtcclxuICAgIGFwcCA9IGdldE1vZHVsYXJJbnN0YW5jZShhcHApO1xyXG4gICAgY29uc3QgcHJvdmlkZXIgPSBfZ2V0UHJvdmlkZXIoYXBwLCAncGVyZm9ybWFuY2UnKTtcclxuICAgIGNvbnN0IHBlcmZJbnN0YW5jZSA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgcmV0dXJuIHBlcmZJbnN0YW5jZTtcclxufVxyXG4vKipcclxuICogUmV0dXJucyBhIHtAbGluayBGaXJlYmFzZVBlcmZvcm1hbmNlfSBpbnN0YW5jZSBmb3IgdGhlIGdpdmVuIGFwcC4gQ2FuIG9ubHkgYmUgY2FsbGVkIG9uY2UuXHJcbiAqIEBwYXJhbSBhcHAgLSBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IHRvIHVzZS5cclxuICogQHBhcmFtIHNldHRpbmdzIC0gT3B0aW9uYWwgc2V0dGluZ3MgZm9yIHRoZSB7QGxpbmsgRmlyZWJhc2VQZXJmb3JtYW5jZX0gaW5zdGFuY2UuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIGluaXRpYWxpemVQZXJmb3JtYW5jZShhcHAsIHNldHRpbmdzKSB7XHJcbiAgICBhcHAgPSBnZXRNb2R1bGFySW5zdGFuY2UoYXBwKTtcclxuICAgIGNvbnN0IHByb3ZpZGVyID0gX2dldFByb3ZpZGVyKGFwcCwgJ3BlcmZvcm1hbmNlJyk7XHJcbiAgICAvLyB0aHJvdyBpZiBhbiBpbnN0YW5jZSB3YXMgYWxyZWFkeSBjcmVhdGVkLlxyXG4gICAgLy8gSXQgY291bGQgaGFwcGVuIGlmIGluaXRpYWxpemVQZXJmb3JtYW5jZSgpIGlzIGNhbGxlZCBtb3JlIHRoYW4gb25jZSwgb3IgZ2V0UGVyZm9ybWFuY2UoKSBpcyBjYWxsZWQgZmlyc3QuXHJcbiAgICBpZiAocHJvdmlkZXIuaXNJbml0aWFsaXplZCgpKSB7XHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdJbnN0YW5jZSA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpO1xyXG4gICAgICAgIGNvbnN0IGluaXRpYWxTZXR0aW5ncyA9IHByb3ZpZGVyLmdldE9wdGlvbnMoKTtcclxuICAgICAgICBpZiAoZGVlcEVxdWFsKGluaXRpYWxTZXR0aW5ncywgc2V0dGluZ3MgIT09IG51bGwgJiYgc2V0dGluZ3MgIT09IHZvaWQgMCA/IHNldHRpbmdzIDoge30pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleGlzdGluZ0luc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJhbHJlYWR5IGluaXRpYWxpemVkXCIgLyogRXJyb3JDb2RlLkFMUkVBRFlfSU5JVElBTElaRUQgKi8pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IHBlcmZJbnN0YW5jZSA9IHByb3ZpZGVyLmluaXRpYWxpemUoe1xyXG4gICAgICAgIG9wdGlvbnM6IHNldHRpbmdzXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBwZXJmSW5zdGFuY2U7XHJcbn1cclxuLyoqXHJcbiAqIFJldHVybnMgYSBuZXcgYFBlcmZvcm1hbmNlVHJhY2VgIGluc3RhbmNlLlxyXG4gKiBAcGFyYW0gcGVyZm9ybWFuY2UgLSBUaGUge0BsaW5rIEZpcmViYXNlUGVyZm9ybWFuY2V9IGluc3RhbmNlIHRvIHVzZS5cclxuICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgdHJhY2UuXHJcbiAqIEBwdWJsaWNcclxuICovXHJcbmZ1bmN0aW9uIHRyYWNlKHBlcmZvcm1hbmNlLCBuYW1lKSB7XHJcbiAgICBwZXJmb3JtYW5jZSA9IGdldE1vZHVsYXJJbnN0YW5jZShwZXJmb3JtYW5jZSk7XHJcbiAgICByZXR1cm4gbmV3IFRyYWNlKHBlcmZvcm1hbmNlLCBuYW1lKTtcclxufVxyXG5jb25zdCBmYWN0b3J5ID0gKGNvbnRhaW5lciwgeyBvcHRpb25zOiBzZXR0aW5ncyB9KSA9PiB7XHJcbiAgICAvLyBEZXBlbmRlbmNpZXNcclxuICAgIGNvbnN0IGFwcCA9IGNvbnRhaW5lci5nZXRQcm92aWRlcignYXBwJykuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICBjb25zdCBpbnN0YWxsYXRpb25zID0gY29udGFpbmVyXHJcbiAgICAgICAgLmdldFByb3ZpZGVyKCdpbnN0YWxsYXRpb25zLWludGVybmFsJylcclxuICAgICAgICAuZ2V0SW1tZWRpYXRlKCk7XHJcbiAgICBpZiAoYXBwLm5hbWUgIT09IERFRkFVTFRfRU5UUllfTkFNRSkge1xyXG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiRkIgbm90IGRlZmF1bHRcIiAvKiBFcnJvckNvZGUuRkJfTk9UX0RFRkFVTFQgKi8pO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJubyB3aW5kb3dcIiAvKiBFcnJvckNvZGUuTk9fV0lORE9XICovKTtcclxuICAgIH1cclxuICAgIHNldHVwQXBpKHdpbmRvdyk7XHJcbiAgICBjb25zdCBwZXJmSW5zdGFuY2UgPSBuZXcgUGVyZm9ybWFuY2VDb250cm9sbGVyKGFwcCwgaW5zdGFsbGF0aW9ucyk7XHJcbiAgICBwZXJmSW5zdGFuY2UuX2luaXQoc2V0dGluZ3MpO1xyXG4gICAgcmV0dXJuIHBlcmZJbnN0YW5jZTtcclxufTtcclxuZnVuY3Rpb24gcmVnaXN0ZXJQZXJmb3JtYW5jZSgpIHtcclxuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KCdwZXJmb3JtYW5jZScsIGZhY3RvcnksIFwiUFVCTElDXCIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pKTtcclxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uKTtcclxuICAgIC8vIEJVSUxEX1RBUkdFVCB3aWxsIGJlIHJlcGxhY2VkIGJ5IHZhbHVlcyBsaWtlIGVzbTUsIGVzbTIwMTcsIGNqczUsIGV0YyBkdXJpbmcgdGhlIGNvbXBpbGF0aW9uXHJcbiAgICByZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2VzbTIwMTcnKTtcclxufVxyXG5yZWdpc3RlclBlcmZvcm1hbmNlKCk7XG5cbmV4cG9ydCB7IGdldFBlcmZvcm1hbmNlLCBpbml0aWFsaXplUGVyZm9ybWFuY2UsIHRyYWNlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgaW5pdGlhbGl6ZUFwcCB9IGZyb20gJ2ZpcmViYXNlL2FwcCc7XHJcbmltcG9ydCB7XHJcbiAgZ2V0QXV0aCxcclxuICBvbkF1dGhTdGF0ZUNoYW5nZWQsXHJcbiAgR29vZ2xlQXV0aFByb3ZpZGVyLFxyXG4gIHNpZ25JbldpdGhQb3B1cCxcclxuICBzaWduT3V0LFxyXG4gIHNpZ25JbkFub255bW91c2x5XHJcbn0gZnJvbSAnZmlyZWJhc2UvYXV0aCc7XHJcbmltcG9ydCB7XHJcbiAgZ2V0RmlyZXN0b3JlLFxyXG4gIGNvbGxlY3Rpb24sXHJcbiAgYWRkRG9jLFxyXG4gIHF1ZXJ5LFxyXG4gIG9yZGVyQnksXHJcbiAgbGltaXQsXHJcbiAgb25TbmFwc2hvdCxcclxuICBzZXREb2MsXHJcbiAgdXBkYXRlRG9jLFxyXG4gIGRvYywgXHJcbiAgc2VydmVyVGltZXN0YW1wLFxyXG59IGZyb20gJ2ZpcmViYXNlL2ZpcmVzdG9yZSc7XHJcbmltcG9ydCB7IFxyXG4gIGdldFN0b3JhZ2UsXHJcbiAgcmVmLFxyXG4gIHVwbG9hZEJ5dGVzUmVzdW1hYmxlLFxyXG4gIGdldERvd25sb2FkVVJMLFxyXG59IGZyb20gJ2ZpcmViYXNlL3N0b3JhZ2UnO1xyXG5pbXBvcnQgeyBnZXRNZXNzYWdpbmcsIGdldFRva2VuLCBvbk1lc3NhZ2UgfSBmcm9tICdmaXJlYmFzZS9tZXNzYWdpbmcnO1xyXG5pbXBvcnQgeyBnZXRQZXJmb3JtYW5jZSB9IGZyb20gJ2ZpcmViYXNlL3BlcmZvcm1hbmNlJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmYkluaXQoKSB7XHJcblxyXG4gICAgY29uc3QgZmlyZWJhc2VDb25maWcgPSB7XHJcbiAgICAgICAgYXBpS2V5OiBcIkFJemFTeUMzUFJ6aE5aWnIySEM1NF8yZTFtQklndTFJNzFleFkzb1wiLFxyXG4gICAgICAgIGF1dGhEb21haW46IFwiZG9pbmdpdC1hcHAuZmlyZWJhc2VhcHAuY29tXCIsXHJcbiAgICAgICAgcHJvamVjdElkOiBcImRvaW5naXQtYXBwXCIsXHJcbiAgICAgICAgc3RvcmFnZUJ1Y2tldDogXCJkb2luZ2l0LWFwcC5hcHBzcG90LmNvbVwiLFxyXG4gICAgICAgIG1lc3NhZ2luZ1NlbmRlcklkOiBcIjY5MTg0Nzk5NzQ5XCIsXHJcbiAgICAgICAgYXBwSWQ6IFwiMTo2OTE4NDc5OTc0OTp3ZWI6ZGE4NWEyMGI1MjFlM2I0ZDI5Yzg2Y1wiXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGFwcCA9IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpO1xyXG5cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNpZ25Jbkdvb2dsZSgpIHtcclxuICAgIHZhciBwcm92aWRlciA9IG5ldyBHb29nbGVBdXRoUHJvdmlkZXIoKTtcclxuICAgIGF3YWl0IHNpZ25JbldpdGhQb3B1cChnZXRBdXRoKCksIHByb3ZpZGVyKTtcclxuICB9XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2lnbkluQW5vbigpIHtcclxuICAgIGNvbnN0IGF1dGggPSBnZXRBdXRoKCk7XHJcbnNpZ25JbkFub255bW91c2x5KGF1dGgpXHJcbiAgLnRoZW4oKCkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coXCJXZWxjb21lIVwiKVxyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JDb2RlID0gZXJyb3IuY29kZTtcclxuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XHJcbiAgICAvLyAuLi5cclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluaXRGaXJlYmFzZUF1dGgoKSB7XHJcbiAgICAvLyBMaXN0ZW4gdG8gYXV0aCBzdGF0ZSBjaGFuZ2VzLlxyXG4gICAgb25BdXRoU3RhdGVDaGFuZ2VkKGdldEF1dGgoKSwgYXV0aFN0YXRlT2JzZXJ2ZXIpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYXV0aFN0YXRlT2JzZXJ2ZXIodXNlcikge1xyXG4gICAgXHJcbiAgICBjb25zdCBhdXRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYXV0Jyk7XHJcblxyXG4gICAgaWYgKHVzZXIpIHsgLy9JZiB1c2VyIGxvZ2dlZCBpblxyXG4gICAgICAgIFxyXG4gICAgICAgIGF1dENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFwiaW52aXNpYmxlXCIpO1xyXG5cclxuICAgIH0gZWxzZSB7IC8vSWYgdXNlciBsb2dnZWQgb3V0XHJcbiAgICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwibm90IHVzZXJcIilcclxuICAgIH1cclxuICB9ICIsImV4cG9ydCBjbGFzcyBBcHBIYW5kbGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKHByb2plY3RzID0gW10pIHtcclxuICAgICAgICB0aGlzLnByb2plY3RzID0gcHJvamVjdHM7XHJcbiAgICB9XHJcbiAgICBnZXRQcm9qZWN0cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcm9qZWN0cztcclxuICAgIH1cclxuICAgIGFkZFByb2plY3QocHJvamVjdCkge1xyXG4gICAgICAgIHRoaXMucHJvamVjdHMucHVzaChwcm9qZWN0KTtcclxuICAgIH1cclxuICAgIGRlbGV0ZVByb2plY3QocHJvamVjdCkge1xyXG4gICAgICAgIHRoaXMucHJvamVjdHMuc3BsaWNlKHRoaXMucHJvamVjdHMuaW5kZXhPZihwcm9qZWN0KSwgMSk7XHJcbiAgICB9XHJcbiAgICBlZGl0UHJvamVjdChwcm9qZWN0KSB7XHJcbiAgICAgICAgbGV0IG5hbWUgPSBwcm9tcHQoJ0Nob29zZSBhIG5ldyBuYW1lIGZvciB5b3VyIHByb2plY3Q6Jyk7XHJcbiAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBuYW1lICE9ICcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvamVjdHNbdGhpcy5wcm9qZWN0cy5pbmRleE9mKHByb2plY3QpXS5zZXROYW1lKG5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG59IiwiZXhwb3J0IGNsYXNzIFByb2plY3Qge1xyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCB0YXNrcyA9IFtdKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnRhc2tzID0gdGFza3M7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkVGFzayh0YXNrKSB7XHJcbiAgICAgICAgdGhpcy50YXNrcy5wdXNoKHRhc2spO1xyXG4gICAgfVxyXG4gICAgZGVsZXRlVGFzayh0YXNrKSB7XHJcbiAgICAgICAgdGhpcy50YXNrcy5zcGxpY2UodGhpcy50YXNrcy5pbmRleE9mKHRhc2spLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXROYW1lKG5hbWUpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgfVxyXG4gICAgZ2V0TmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5uYW1lO1xyXG4gICAgfVxyXG4gICAgZ2V0U2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50YXNrcy5sZW5ndGhcclxuICAgIH1cclxuICAgIGdldFRhc2tzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRhc2tzO1xyXG4gICAgfVxyXG4gICAgc2V0VGFza3ModGFza3MpIHtcclxuICAgICAgICB0aGlzLnRhc2tzID0gdGFza3M7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgVGFzayB7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGRlc2NyaXB0aW9uLCBkYXRlID0gXCIwMDAwLTAwLTAwXCIsIGlzQ29tcGxldGVkID0gZmFsc2UpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcclxuICAgICAgICB0aGlzLmRhdGUgPSBkYXRlO1xyXG4gICAgICAgIHRoaXMuaXNDb21wbGV0ZWQgPSBpc0NvbXBsZXRlZDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgc2V0TmFtZShuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIH1cclxuICAgIHNldERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xyXG4gICAgfVxyXG4gICAgc2V0RGF0ZShkYXRlKSB7XHJcbiAgICAgICAgdGhpcy5kYXRlID0gZGF0ZTtcclxuICAgIH1cclxuICAgIHNldElzQ29tcGxldGVkKGlzQ29tcGxldGVkKSB7XHJcbiAgICAgICAgdGhpcy5pc0NvbXBsZXRlZCA9IGlzQ29tcGxldGVkO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXROYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5hbWU7XHJcbiAgICB9XHJcbiAgICBnZXREZXNjcmlwdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZXNjcmlwdGlvbjtcclxuICAgIH1cclxuICAgIGdldERhdGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZTtcclxuICAgIH1cclxuICAgIGdldElzQ29tcGxldGVkKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzQ29tcGxldGVkO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IG1lbnUgZnJvbSAnLi4vaWNvbnMvbWVudS5zdmcnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckhlYWRlcihxdWVyeSkge1xyXG4gICAgcXVlcnkuaW5uZXJIVE1MID0gYFxyXG4gICAgPGltZyBjbGFzcz1cImljb25cIiBzcmM9XCIke21lbnV9XCIgYWx0PVwiTWVudSBJY29uXCIvPlxyXG4gICAgPGgxIGNsYXNzPVwiaGVhZGVyLXRpdGxlXCI+4pyU77iPRG9pbmdJdDwvaDE+XHJcbiAgICBgO1xyXG59IiwiaW1wb3J0IHsgcmVuZGVyTGF5b3V0IH0gZnJvbSBcIi4uL1VJL21haW5MYXlvdXRcIjtcclxuaW1wb3J0IHsgcmVuZGVySGVhZGVyIH0gZnJvbSAnLi4vVUkvaGVhZGVyJztcclxuaW1wb3J0IHsgcmVuZGVyTmF2IH0gZnJvbSAnLi4vVUkvbmF2JztcclxuaW1wb3J0IHsgcmVuZGVyQXV0IH0gZnJvbSBcIi4uL1VJL2F1dFwiO1xyXG5cclxuaW1wb3J0IHByb2plY3QgZnJvbSAnLi4vaWNvbnMvcHJvamVjdC5zdmcnO1xyXG5pbXBvcnQgZGVsZXRlSWNvbiBmcm9tICcuLi9pY29ucy9kZWxldGUuc3ZnJztcclxuaW1wb3J0IGVkaXQgZnJvbSAnLi4vaWNvbnMvZWRpdC5zdmcnO1xyXG5cclxuaW1wb3J0IHsgc2lnbkluR29vZ2xlLCBzaWduSW5Bbm9uIH0gZnJvbSBcIi4vZmlyZUJhc2VNYW5pcHVsYXRpb25cIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJQYWdlKCkge1xyXG4gICAgY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuICAgIHJlbmRlckxheW91dChib2R5KTtcclxuXHJcbiAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkZXInKTtcclxuICAgIHJlbmRlckhlYWRlcihoZWFkZXIpO1xyXG5cclxuICAgIGNvbnN0IG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ25hdicpO1xyXG4gICAgcmVuZGVyTmF2KG5hdik7XHJcblxyXG4gICAgY29uc3QgYXV0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmF1dCcpO1xyXG4gICAgcmVuZGVyQXV0KGF1dENvbnRhaW5lcik7XHJcbn1cclxuXHJcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG5pbXBvcnQgeyBBcHBIYW5kbGVyIH0gZnJvbSBcIi4vQXBwSGFuZGxlclwiO1xyXG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSBcIi4vUHJvamVjdFwiO1xyXG5pbXBvcnQgeyBUYXNrIH0gZnJvbSBcIi4vVGFza1wiO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1haW4oKSB7XHJcblxyXG4gICAgbGV0IGFwcEhhbmRsZXIgPSBuZXcgQXBwSGFuZGxlcigpO1xyXG5cclxuICAgIGxldCBkYXRhO1xyXG5cclxuICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaGFuZGxlckRhdGEnKSAhPSBudWxsKSB7XHJcbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hhbmRsZXJEYXRhJykpO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEucHJvamVjdHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IG5hbWUgPSBkYXRhLnByb2plY3RzW2ldLm5hbWU7XHJcbiAgICAgICAgICAgIGxldCBwcm9qID0gbmV3IFByb2plY3QobmFtZSk7XHJcbiAgICAgICAgICAgIGFwcEhhbmRsZXIuYWRkUHJvamVjdChwcm9qKTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBkYXRhLnByb2plY3RzW2ldLnRhc2tzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IGRhdGEucHJvamVjdHNbaV0udGFza3Nbal0ubmFtZTtcclxuICAgICAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbiA9IGRhdGEucHJvamVjdHNbaV0udGFza3Nbal0uZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IGRhdGEucHJvamVjdHNbaV0udGFza3Nbal0uZGF0ZTtcclxuICAgICAgICAgICAgICAgIGxldCBpc0NvbXBsZXRlZCA9IGRhdGEucHJvamVjdHNbaV0udGFza3Nbal0uaXNDb21wbGV0ZWQ7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGFzayA9IG5ldyBUYXNrKG5hbWUsIGRlc2NyaXB0aW9uLCBkYXRlLCBpc0NvbXBsZXRlZCk7XHJcbiAgICAgICAgICAgICAgICBhcHBIYW5kbGVyLmdldFByb2plY3RzKClbaV0uYWRkVGFzayh0YXNrKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWRkUHJvamVjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNhZGQnKTtcclxuXHJcbiAgICBhZGRQcm9qZWN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIGxldCBuYW1lID0gcHJvbXB0KCdOYW1lIHlvdXIgbmV3IHByb2plY3QnKTtcclxuICAgICAgICBpZiAobmFtZSAhPSBudWxsICYmIG5hbWUgIT0gJycpIHtcclxuICAgICAgICAgICAgbGV0IG5ld1Byb2plY3QgPSBuZXcgUHJvamVjdChuYW1lKTtcclxuICAgICAgICAgICAgYXBwSGFuZGxlci5hZGRQcm9qZWN0KG5ld1Byb2plY3QpO1xyXG4gICAgICAgICAgICByZW5kZXJQcm9qZWN0c1RhYihwcm9qZWN0c1VsLCBhcHBIYW5kbGVyLmdldFByb2plY3RzKCkpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcHBIYW5kbGVyKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2hhbmRsZXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoYXBwSGFuZGxlcikpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHByb2plY3RzVWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcHJvamVjdHMtbGlzdCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJlbmRlclByb2plY3RzVGFiKGNvbnRhaW5lckVsZW1lbnQsIHByb2plY3RMaXN0KSB7XHJcbiAgICAgICAgbGV0IEhUTUxDb250ZW50ID0gJyc7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9qZWN0TGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBIVE1MQ29udGVudCArPSBgPGxpPjxpbWcgY2xhc3M9XCJpY29uXCIgc3JjPVwiJHtwcm9qZWN0fVwiIGFsdD1cIlByb2plY3QgSWNvblwiPjxidXR0b24gaWQ9XCJvcGVuLWJ0bi0ke2l9XCI+JHtwcm9qZWN0TGlzdFtpXS5nZXROYW1lKCl9PC9idXR0b24+Jm5ic3A8ZGl2IGNsYXNzPVwiYmFkZ2VyXCI+JHtwcm9qZWN0TGlzdFtpXS5nZXRTaXplKCl9PC9kaXY+XHJcbiAgICAgICAgICAgIDxidXR0b24gaWQ9XCJlZHQtYnRuLSR7aX1cIj48aW1nIGNsYXNzPVwiaWNvblwiIHNyYz1cIiR7ZWRpdH1cIiBhbHQ9XCJFZGl0IEljb25cIj48L2J1dHRvbj48YnV0dG9uIGlkPVwiZGVsLWJ0bi0ke2l9XCI+PGltZyBjbGFzcz1cImljb25cIiBzcmM9XCIke2RlbGV0ZUljb259XCIgYWx0PVwiRGVsZXRlIEljb25cIjwvYnV0dG9uPlxyXG4gICAgICAgICAgICA8L2xpPmA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRhaW5lckVsZW1lbnQuaW5uZXJIVE1MID0gSFRNTENvbnRlbnQ7XHJcbiAgICAgICAgYWRkUHJvamVjdExpc3RlbmVycyhwcm9qZWN0TGlzdCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keSA+IGRpdiA+IG1haW5cIik7XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkUHJvamVjdExpc3RlbmVycyhwcm9qZWN0TGlzdCkge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvamVjdExpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRlbC1idG4tJHtpfWApLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBhcHBIYW5kbGVyLmRlbGV0ZVByb2plY3QocHJvamVjdExpc3RbaV0pO1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdHNUYWIocHJvamVjdHNVbCwgYXBwSGFuZGxlci5nZXRQcm9qZWN0cygpKTtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdoYW5kbGVyRGF0YScsIEpTT04uc3RyaW5naWZ5KGFwcEhhbmRsZXIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZWR0LWJ0bi0ke2l9YCkub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGFwcEhhbmRsZXIuZWRpdFByb2plY3QocHJvamVjdExpc3RbaV0pO1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdHNUYWIocHJvamVjdHNVbCwgYXBwSGFuZGxlci5nZXRQcm9qZWN0cygpKTtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdoYW5kbGVyRGF0YScsIEpTT04uc3RyaW5naWZ5KGFwcEhhbmRsZXIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgb3Blbi1idG4tJHtpfWApLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJQcm9qZWN0Q29udGVudChtYWluLCBhcHBIYW5kbGVyLmdldFByb2plY3RzKClbaV0pO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2hhbmRsZXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoYXBwSGFuZGxlcikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJlbmRlclByb2plY3RDb250ZW50KGNvbnRhaW5lckVsZW1lbnQsIHByb2plY3QpIHtcclxuICAgICAgICBsZXQgSFRNTENvbnRlbnQgPSAnPHVsPic7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9qZWN0LmdldFRhc2tzKCkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgSFRNTENvbnRlbnQgKz0gYDxsaWA7XHJcblxyXG4gICAgICAgICAgICBpZiAocHJvamVjdC5nZXRUYXNrcygpW2ldLmdldElzQ29tcGxldGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIEhUTUxDb250ZW50ICs9IGAgc3R5bGU9XCJ0ZXh0LWRlY29yYXRpb246IGxpbmUtdGhyb3VnaDtcImA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIEhUTUxDb250ZW50ICs9IGA+PHNwYW4+JHtwcm9qZWN0LmdldFRhc2tzKClbaV0uZ2V0TmFtZSgpfTwvc3Bhbj48YnV0dG9uIGlkPVwiZWR0LW5hbWUtJHtpfVwiPjxpbWcgY2xhc3M9XCJpY29uXCIgc3JjPVwiJHtlZGl0fVwiIGFsdD1cIkVkaXQgSWNvblwiPjwvYnV0dG9uPlxyXG4gICAgICAgICAgICA8c3Bhbj4ke3Byb2plY3QuZ2V0VGFza3MoKVtpXS5nZXREZXNjcmlwdGlvbigpfTwvc3Bhbj48YnV0dG9uIGlkPVwiZWR0LWRlc2MtJHtpfVwiPjxpbWcgY2xhc3M9XCJpY29uXCIgc3JjPVwiJHtlZGl0fVwiIGFsdD1cIkVkaXQgSWNvblwiPjwvYnV0dG9uPlxyXG4gICAgICAgICAgICA8aW5wdXQgaWQ9XCJkYXRlLSR7aX1cIiB0eXBlPVwiZGF0ZVwiIHZhbHVlPVwiJHtwcm9qZWN0LmdldFRhc2tzKClbaV0uZ2V0RGF0ZSgpfVwiPjxpbnB1dCBpZD1cImNoZWNrLSR7aX1cIiB0eXBlPVwiY2hlY2tib3hcIiBgO1xyXG4gICAgICAgICAgICBpZiAocHJvamVjdC5nZXRUYXNrcygpW2ldLmdldElzQ29tcGxldGVkKCkpIHtcclxuICAgICAgICAgICAgICAgIEhUTUxDb250ZW50ICs9IFwiY2hlY2tlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9qZWN0ICE9IHByb2plY3RBbGxUYXNrcykge1xyXG4gICAgICAgICAgICAgICAgSFRNTENvbnRlbnQgKz0gYD48YnV0dG9uIGlkPVwiZGVsLSR7aX1cIj48aW1nIGNsYXNzPVwiaWNvblwiIHNyYz1cIiR7ZGVsZXRlSWNvbn1cIiBhbHQ9XCJEZWxldGUgSWNvblwiPjwvYnV0dG9uPjwvbGk+YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIEhUTUxDb250ZW50ICs9IGA+PC9saT5gO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocHJvamVjdCAhPSBwcm9qZWN0QWxsVGFza3MpIHtcclxuICAgICAgICAgICAgSFRNTENvbnRlbnQgKz0gJzwvdWw+PGJ1dHRvbiBpZD1cImFkZC10YXNrXCI+QWRkIFRhc2s8L2J1dHRvbj4nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250YWluZXJFbGVtZW50LmlubmVySFRNTCA9IEhUTUxDb250ZW50O1xyXG5cclxuICAgICAgICBhZGRUYXNrTGlzdGVuZXJzKHByb2plY3QpO1xyXG4gICAgICAgIGlmIChwcm9qZWN0ICE9IHByb2plY3RBbGxUYXNrcykge1xyXG4gICAgICAgICAgICBsZXQgYWRkVGFza0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLXRhc2tcIik7XHJcbiAgICAgICAgICAgIGFkZE5ld1Rhc2tMaXN0ZW5lcihhZGRUYXNrQnRuLCBwcm9qZWN0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFkZFRhc2tMaXN0ZW5lcnMocHJvamVjdCkge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvamVjdC5nZXRUYXNrcygpLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBlZHQtbmFtZS0ke2l9YCkub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBuYW1lID0gcHJvbXB0KFwiQ2hvb3NlIGEgbmV3IG5hbWU6XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCAmJiBuYW1lICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdC5nZXRUYXNrcygpW2ldLnNldE5hbWUobmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdENvbnRlbnQobWFpbiwgcHJvamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2hhbmRsZXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoYXBwSGFuZGxlcikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBlZHQtZGVzYy0ke2l9YCkub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBkZXNjID0gcHJvbXB0KFwiQ2hvb3NlIGEgbmV3IGRlc2NyaXB0aW9uOlwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChkZXNjID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZXNjID0gXCJObyBkZXNjcmlwdGlvbi4uLlwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGRlc2MgPT0gbnVsbCkge30gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdC5nZXRUYXNrcygpW2ldLnNldERlc2NyaXB0aW9uKGRlc2MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlclByb2plY3RDb250ZW50KG1haW4sIHByb2plY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdoYW5kbGVyRGF0YScsIEpTT04uc3RyaW5naWZ5KGFwcEhhbmRsZXIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRhdGUtJHtpfWApLm9uY2hhbmdlID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZGF0ZS0ke2l9YCkudmFsdWU7XHJcbiAgICAgICAgICAgICAgICBwcm9qZWN0LmdldFRhc2tzKClbaV0uc2V0RGF0ZShkYXRlKTtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdoYW5kbGVyRGF0YScsIEpTT04uc3RyaW5naWZ5KGFwcEhhbmRsZXIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY2hlY2stJHtpfWApLm9uY2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2hlY2tlZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBjaGVjay0ke2l9YCkuY2hlY2tlZDtcclxuICAgICAgICAgICAgICAgIHByb2plY3QuZ2V0VGFza3MoKVtpXS5zZXRJc0NvbXBsZXRlZChjaGVja2VkKTtcclxuICAgICAgICAgICAgICAgIHJlbmRlclByb2plY3RDb250ZW50KG1haW4sIHByb2plY3QpO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2hhbmRsZXJEYXRhJywgSlNPTi5zdHJpbmdpZnkoYXBwSGFuZGxlcikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcm9qZWN0ICE9IHByb2plY3RBbGxUYXNrcykge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRlbC0ke2l9YCkub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdGFzayA9IHByb2plY3QuZ2V0VGFza3MoKVtpXTtcclxuICAgICAgICAgICAgICAgICAgICBwcm9qZWN0LmRlbGV0ZVRhc2sodGFzayk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdENvbnRlbnQobWFpbiwgcHJvamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdHNUYWIocHJvamVjdHNVbCwgYXBwSGFuZGxlci5nZXRQcm9qZWN0cygpKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaGFuZGxlckRhdGEnLCBKU09OLnN0cmluZ2lmeShhcHBIYW5kbGVyKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGFkZE5ld1Rhc2tMaXN0ZW5lcihidXR0b24sIHByb2plY3QpIHtcclxuICAgICAgICBidXR0b24ub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICAgICAgbGV0IG5hbWUgPSBwcm9tcHQoXCJDaG9vc2UgeW91ciB0YXNrIG5hbWVcIik7XHJcbiAgICAgICAgICAgIGxldCBkZXNjcmlwdGlvbiA9IHByb21wdChcIkNob29zZSB5b3VyIHRhc2sgZGVzY3JpcHRpb25cIik7XHJcbiAgICAgICAgICAgIGlmIChkZXNjcmlwdGlvbiA9PSBudWxsIHx8IGRlc2NyaXB0aW9uID09IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gXCJObyBkZXNjcmlwdGlvbi4uLlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChuYW1lICE9IG51bGwgJiYgbmFtZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgbGV0IHRhc2sgPSBuZXcgVGFzayhuYW1lLCBkZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICBwcm9qZWN0LmFkZFRhc2sodGFzayk7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJQcm9qZWN0Q29udGVudChtYWluLCBwcm9qZWN0KTtcclxuICAgICAgICAgICAgICAgIHJlbmRlclByb2plY3RzVGFiKHByb2plY3RzVWwsIGFwcEhhbmRsZXIuZ2V0UHJvamVjdHMoKSk7XHJcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaGFuZGxlckRhdGEnLCBKU09OLnN0cmluZ2lmeShhcHBIYW5kbGVyKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBwcm9qZWN0QWxsVGFza3MgPSBuZXcgUHJvamVjdChcIkFsbFwiKTtcclxuICAgIHVwZGF0ZUFsbFRhc2tzKCk7XHJcbiAgICByZW5kZXJQcm9qZWN0Q29udGVudChtYWluLCBwcm9qZWN0QWxsVGFza3MpO1xyXG4gICAgcmVuZGVyUHJvamVjdHNUYWIocHJvamVjdHNVbCwgYXBwSGFuZGxlci5nZXRQcm9qZWN0cygpKTtcclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVBbGxUYXNrcygpIHtcclxuICAgICAgICBsZXQgYWxsVGFza3MgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFwcEhhbmRsZXIuZ2V0UHJvamVjdHMoKS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGFwcEhhbmRsZXIuZ2V0UHJvamVjdHMoKVtpXS5nZXRUYXNrcygpLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBhbGxUYXNrcy5wdXNoKGFwcEhhbmRsZXIuZ2V0UHJvamVjdHMoKVtpXS5nZXRUYXNrcygpW2pdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm9qZWN0QWxsVGFza3Muc2V0VGFza3MoYWxsVGFza3MpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhbGxUYXNrc0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5ID4gZGl2ID4gbmF2ID4gdWw6bnRoLWNoaWxkKDEpID4gbGk6bnRoLWNoaWxkKDEpID4gYnV0dG9uXCIpO1xyXG4gICAgYWxsVGFza3NCdG4ub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICB1cGRhdGVBbGxUYXNrcygpO1xyXG4gICAgICAgIHJlbmRlclByb2plY3RDb250ZW50KG1haW4sIHByb2plY3RBbGxUYXNrcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlVG9kYXlUYXNrcygpIHtcclxuICAgICAgICBsZXQgdGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgbGV0IGZvcm1hdHRlZERhdGUgPSBgJHt0aW1lLmdldEZ1bGxZZWFyKCl9LSR7dGltZS5nZXRNb250aCgpICsgMX0tJHt0aW1lLmdldERhdGUoKX1gO1xyXG4gICAgICAgIGxldCB0b2RheVRhc2tzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcHBIYW5kbGVyLmdldFByb2plY3RzKCkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBhcHBIYW5kbGVyLmdldFByb2plY3RzKClbaV0uZ2V0VGFza3MoKS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFwcEhhbmRsZXIuZ2V0UHJvamVjdHMoKVtpXS5nZXRUYXNrcygpW2pdLmdldERhdGUoKSA9PSBmb3JtYXR0ZWREYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9kYXlUYXNrcy5wdXNoKGFwcEhhbmRsZXIuZ2V0UHJvamVjdHMoKVtpXS5nZXRUYXNrcygpW2pdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBwcm9qZWN0QWxsVGFza3Muc2V0VGFza3ModG9kYXlUYXNrcyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdG9kYXlUYXNrc0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5ID4gZGl2ID4gbmF2ID4gdWw6bnRoLWNoaWxkKDEpID4gbGk6bnRoLWNoaWxkKDIpID4gYnV0dG9uXCIpO1xyXG4gICAgdG9kYXlUYXNrc0J0bi5vbmNsaWNrID0gKCkgPT4ge1xyXG4gICAgICAgIHVwZGF0ZVRvZGF5VGFza3MoKTtcclxuICAgICAgICByZW5kZXJQcm9qZWN0Q29udGVudChtYWluLCBwcm9qZWN0QWxsVGFza3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZVdlZWtUYXNrcygpIHtcclxuICAgICAgICBsZXQgdGltZU5vdyA9IERhdGUubm93KCk7XHJcbiAgICAgICAgbGV0IHRpbWVOZXh0V2VlayA9IHRpbWVOb3cgKyA2MDQ4MDAwMDA7XHJcblxyXG5cclxuICAgICAgICBsZXQgd2Vla1Rhc2tzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcHBIYW5kbGVyLmdldFByb2plY3RzKCkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBhcHBIYW5kbGVyLmdldFByb2plY3RzKClbaV0uZ2V0VGFza3MoKS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShhcHBIYW5kbGVyLmdldFByb2plY3RzKClbaV0uZ2V0VGFza3MoKVtqXS5nZXREYXRlKCkpO1xyXG4gICAgICAgICAgICAgICAgZGF0ZSA9IGRhdGUuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRhdGUgPiB0aW1lTm93ICYmIGRhdGUgPCB0aW1lTmV4dFdlZWspIHtcclxuICAgICAgICAgICAgICAgICAgICB3ZWVrVGFza3MucHVzaChhcHBIYW5kbGVyLmdldFByb2plY3RzKClbaV0uZ2V0VGFza3MoKVtqXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvamVjdEFsbFRhc2tzLnNldFRhc2tzKHdlZWtUYXNrcyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgd2Vla1Rhc2tzQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHkgPiBkaXYgPiBuYXYgPiB1bDpudGgtY2hpbGQoMSkgPiBsaTpudGgtY2hpbGQoMykgPiBidXR0b25cIik7XHJcbiAgICB3ZWVrVGFza3NCdG4ub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICB1cGRhdGVXZWVrVGFza3MoKTtcclxuICAgICAgICByZW5kZXJQcm9qZWN0Q29udGVudChtYWluLCBwcm9qZWN0QWxsVGFza3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1lbnVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYm9keSA+IGhlYWRlciA+IGltZ1wiKTtcclxuICAgIGNvbnN0IG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5ID4gZGl2ID4gbmF2XCIpO1xyXG5cclxuICAgIG1lbnVCdG4ub25jbGljayA9ICgpID0+IHtcclxuICAgICAgICBpZiAoIW5hdi5jbGFzc0xpc3QuY29udGFpbnMoXCJ2aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgICAgIG5hdi5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBuYXYuY2xhc3NMaXN0LnJlbW92ZShcInZpc2libGVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuICAgIGNvbnN0IGxvZ0dvb2dsZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbG9nLWdvb2dsZS1idG5cIik7XHJcbiAgICBsb2dHb29nbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICBzaWduSW5Hb29nbGUoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGxvZ0Fub25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvZy1hbm9uLWJ0blwiKTtcclxuICAgIGxvZ0Fub25CdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICBzaWduSW5Bbm9uKCk7IFxyXG4gICAgfSk7XHJcblxyXG59IiwiZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckxheW91dChxdWVyeSkge1xyXG4gICAgcXVlcnkuaW5uZXJIVE1MID0gYFxyXG4gICAgPGRpdiBjbGFzcz1cImF1dFwiPjwvZGl2PlxyXG4gICAgPGhlYWRlcj48L2hlYWRlcj5cclxuICAgIDxkaXYgY2xhc3M9XCJtYWluLWNvbnRhaW5lclwiPlxyXG4gICAgICAgIDxuYXY+PC9uYXY+XHJcbiAgICAgICAgPG1haW4+PC9tYWluPlxyXG4gICAgPC9kaXY+XHJcbiAgICBgO1xyXG59IiwiaW1wb3J0IGFsbCBmcm9tICcuLi9pY29ucy9hbGwuc3ZnJztcclxuaW1wb3J0IHRvZGF5IGZyb20gJy4uL2ljb25zL3RvZGF5LnN2Zyc7XHJcbmltcG9ydCB3ZWVrIGZyb20gJy4uL2ljb25zL3dlZWsuc3ZnJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJOYXYocXVlcnkpIHtcclxuICAgIHF1ZXJ5LmlubmVySFRNTCA9IGBcclxuICAgIDx1bD5cclxuICAgICAgICA8bGk+PGltZyBjbGFzcz1cImljb25cIiBzcmM9XCIke2FsbH1cIiBhbHQ9XCJBbGwgSWNvblwiPjxidXR0b24+QWxsPC9idXR0b24+PC9saT5cclxuICAgICAgICA8bGk+PGltZyBjbGFzcz1cImljb25cIiBzcmM9XCIke3RvZGF5fVwiIGFsdD1cIlRvZGF5IEljb25cIj48YnV0dG9uPlRvZGF5PC9idXR0b24+PC9saT5cclxuICAgICAgICA8bGk+PGltZyBjbGFzcz1cImljb25cIiBzcmM9XCIke3dlZWt9XCIgYWx0PVwiVGhpcyB3ZWVrIEljb25cIj48YnV0dG9uPk5leHQgNyBkYXlzPC9idXR0b24+PC9saT5cclxuICAgIDwvdWw+XHJcbiAgICA8c3Bhbj5Qcm9qZWN0czwvc3Bhbj5cclxuICAgIDx1bCBpZD1cInByb2plY3RzLWxpc3RcIj5cclxuICAgIDwvdWw+XHJcbiAgICA8dWw+XHJcbiAgICAgICAgPGxpIGlkPVwiYWRkLWNvbnRhaW5lclwiPjxidXR0b24gaWQ9XCJhZGRcIj5BZGQgUHJvamVjdDwvYnV0dG9uPjwvbGk+XHJcbiAgICA8L3VsPlxyXG4gICAgYDtcclxufSIsImltcG9ydCBcIi4uL3N0eWxlcy9hdXQuY3NzXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyQXV0KHF1ZXJ5KSB7XHJcbiAgICBxdWVyeS5pbm5lckhUTUwgPSBgXHJcbiAgICA8YnV0dG9uIGlkPVwibG9nLWdvb2dsZS1idG5cIj5Mb2dpbiB2aWEgR09PR0xFPC9idXR0b24+XHJcbiAgICA8YnV0dG9uIGlkPVwibG9nLWFub24tYnRuXCI+QW5vbnltb3VzIExvZ2luPC9idXR0b24+XHJcbiAgICBgXHJcbn0iLCJpbXBvcnQgJy4vc3R5bGVzL21haW5MYXlvdXQuY3NzJztcclxuaW1wb3J0ICcuL3N0eWxlcy9oZWFkZXIuY3NzJztcclxuaW1wb3J0ICcuL3N0eWxlcy9uYXYuY3NzJztcclxuaW1wb3J0ICcuL3N0eWxlcy90YXNrcy5jc3MnO1xyXG5cclxuaW1wb3J0IHsgcmVuZGVyUGFnZSB9IGZyb20gJy4vbG9naWMvRE9NTWFuaXB1bGF0aW9uJztcclxucmVuZGVyUGFnZSgpO1xyXG5cclxuaW1wb3J0IHsgbWFpbiB9IGZyb20gJy4vbG9naWMvRE9NTWFuaXB1bGF0aW9uJztcclxubWFpbigpO1xyXG5cclxuaW1wb3J0IHsgZmJJbml0LCBpbml0RmlyZWJhc2VBdXRoIH0gZnJvbSAnLi9sb2dpYy9maXJlQmFzZU1hbmlwdWxhdGlvbic7XHJcbmZiSW5pdCgpO1xyXG5pbml0RmlyZWJhc2VBdXRoKCk7Il0sIm5hbWVzIjpbIl9fX0NTU19MT0FERVJfRVhQT1JUX19fIiwicHVzaCIsIm1vZHVsZSIsImlkIiwiZXhwb3J0cyIsImNzc1dpdGhNYXBwaW5nVG9TdHJpbmciLCJsaXN0IiwidG9TdHJpbmciLCJ0aGlzIiwibWFwIiwiaXRlbSIsImNvbnRlbnQiLCJuZWVkTGF5ZXIiLCJjb25jYXQiLCJsZW5ndGgiLCJqb2luIiwiaSIsIm1vZHVsZXMiLCJtZWRpYSIsImRlZHVwZSIsInN1cHBvcnRzIiwibGF5ZXIiLCJ1bmRlZmluZWQiLCJhbHJlYWR5SW1wb3J0ZWRNb2R1bGVzIiwiayIsIl9rIiwiY3NzTWFwcGluZyIsImJ0b2EiLCJiYXNlNjQiLCJ1bmVzY2FwZSIsImVuY29kZVVSSUNvbXBvbmVudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwic291cmNlTWFwcGluZyIsInNvdXJjZVVSTHMiLCJzb3VyY2VzIiwic291cmNlIiwic291cmNlUm9vdCIsInN0eWxlc0luRE9NIiwiZ2V0SW5kZXhCeUlkZW50aWZpZXIiLCJpZGVudGlmaWVyIiwicmVzdWx0IiwibW9kdWxlc1RvRG9tIiwib3B0aW9ucyIsImlkQ291bnRNYXAiLCJpZGVudGlmaWVycyIsImJhc2UiLCJjb3VudCIsImluZGV4QnlJZGVudGlmaWVyIiwib2JqIiwiY3NzIiwic291cmNlTWFwIiwicmVmZXJlbmNlcyIsInVwZGF0ZXIiLCJhZGRFbGVtZW50U3R5bGUiLCJieUluZGV4Iiwic3BsaWNlIiwiYXBpIiwiZG9tQVBJIiwidXBkYXRlIiwibmV3T2JqIiwicmVtb3ZlIiwibGFzdElkZW50aWZpZXJzIiwibmV3TGlzdCIsImluZGV4IiwibmV3TGFzdElkZW50aWZpZXJzIiwiX2kiLCJfaW5kZXgiLCJtZW1vIiwiaW5zZXJ0Iiwic3R5bGUiLCJ0YXJnZXQiLCJzdHlsZVRhcmdldCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIndpbmRvdyIsIkhUTUxJRnJhbWVFbGVtZW50IiwiY29udGVudERvY3VtZW50IiwiaGVhZCIsImUiLCJnZXRUYXJnZXQiLCJFcnJvciIsImFwcGVuZENoaWxkIiwiZWxlbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGVzIiwiYXR0cmlidXRlcyIsInN0eWxlRWxlbWVudCIsIm5vbmNlIiwic2V0QXR0cmlidXRlIiwiaW5zZXJ0U3R5bGVFbGVtZW50Iiwic3R5bGVUYWdUcmFuc2Zvcm0iLCJhcHBseSIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInJlbW92ZVN0eWxlRWxlbWVudCIsInN0eWxlU2hlZXQiLCJjc3NUZXh0IiwiZmlyc3RDaGlsZCIsImNyZWF0ZVRleHROb2RlIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwic2NyaXB0VXJsIiwiaW1wb3J0U2NyaXB0cyIsImxvY2F0aW9uIiwiY3VycmVudFNjcmlwdCIsInNyYyIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInJlcGxhY2UiLCJwIiwibmMiLCJzdHJpbmdUb0J5dGVBcnJheSQxIiwic3RyIiwib3V0IiwiYyIsImNoYXJDb2RlQXQiLCJieXRlVG9DaGFyTWFwXyIsImNoYXJUb0J5dGVNYXBfIiwiYnl0ZVRvQ2hhck1hcFdlYlNhZmVfIiwiY2hhclRvQnl0ZU1hcFdlYlNhZmVfIiwiRU5DT0RFRF9WQUxTX0JBU0UiLCJFTkNPREVEX1ZBTFMiLCJFTkNPREVEX1ZBTFNfV0VCU0FGRSIsIkhBU19OQVRJVkVfU1VQUE9SVCIsImF0b2IiLCJlbmNvZGVCeXRlQXJyYXkiLCJpbnB1dCIsIndlYlNhZmUiLCJBcnJheSIsImlzQXJyYXkiLCJpbml0XyIsImJ5dGVUb0NoYXJNYXAiLCJvdXRwdXQiLCJieXRlMSIsImhhdmVCeXRlMiIsImJ5dGUyIiwiaGF2ZUJ5dGUzIiwiYnl0ZTMiLCJvdXRCeXRlMSIsIm91dEJ5dGUyIiwib3V0Qnl0ZTMiLCJvdXRCeXRlNCIsImVuY29kZVN0cmluZyIsImRlY29kZVN0cmluZyIsImJ5dGVzIiwicG9zIiwiYzEiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJjMiIsInUiLCJjMyIsImJ5dGVBcnJheVRvU3RyaW5nIiwiZGVjb2RlU3RyaW5nVG9CeXRlQXJyYXkiLCJjaGFyVG9CeXRlTWFwIiwiY2hhckF0IiwiYnl0ZTQiLCJiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyIsInV0ZjhCeXRlcyIsImJhc2U2NEVuY29kZSIsImJhc2U2NERlY29kZSIsImNvbnNvbGUiLCJlcnJvciIsImdldERlZmF1bHRzIiwic2VsZiIsImdldEdsb2JhbCIsIl9fRklSRUJBU0VfREVGQVVMVFNfXyIsInByb2Nlc3MiLCJlbnYiLCJkZWZhdWx0c0pzb25TdHJpbmciLCJwYXJzZSIsImdldERlZmF1bHRzRnJvbUVudlZhcmlhYmxlIiwibWF0Y2giLCJjb29raWUiLCJkZWNvZGVkIiwiZ2V0RGVmYXVsdHNGcm9tQ29va2llIiwiaW5mbyIsImdldEV4cGVyaW1lbnRhbFNldHRpbmciLCJuYW1lIiwiX2EiLCJEZWZlcnJlZCIsImNvbnN0cnVjdG9yIiwicmVqZWN0IiwicmVzb2x2ZSIsInByb21pc2UiLCJQcm9taXNlIiwid3JhcENhbGxiYWNrIiwiY2FsbGJhY2siLCJ2YWx1ZSIsImNhdGNoIiwibmF2aWdhdG9yIiwiaW5kZXhlZERCIiwicHJlRXhpc3QiLCJEQl9DSEVDS19OQU1FIiwicmVxdWVzdCIsIm9wZW4iLCJvbnN1Y2Nlc3MiLCJjbG9zZSIsImRlbGV0ZURhdGFiYXNlIiwib251cGdyYWRlbmVlZGVkIiwib25lcnJvciIsIm1lc3NhZ2UiLCJGaXJlYmFzZUVycm9yIiwiY29kZSIsImN1c3RvbURhdGEiLCJzdXBlciIsInNldFByb3RvdHlwZU9mIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJFcnJvckZhY3RvcnkiLCJjcmVhdGUiLCJzZXJ2aWNlIiwic2VydmljZU5hbWUiLCJlcnJvcnMiLCJmdWxsQ29kZSIsInRlbXBsYXRlIiwiUEFUVEVSTiIsIl8iLCJyZXBsYWNlVGVtcGxhdGUiLCJmdWxsTWVzc2FnZSIsImIiLCJhS2V5cyIsImtleXMiLCJiS2V5cyIsImluY2x1ZGVzIiwiYVByb3AiLCJiUHJvcCIsImlzT2JqZWN0IiwidGhpbmciLCJxdWVyeXN0cmluZ1BhcmFtcyIsInBhcmFtcyIsImVudHJpZXMiLCJmb3JFYWNoIiwiYXJyYXlWYWwiLCJxdWVyeXN0cmluZ0RlY29kZSIsInF1ZXJ5c3RyaW5nIiwic3BsaXQiLCJ0b2tlbiIsImRlY29kZVVSSUNvbXBvbmVudCIsImV4dHJhY3RRdWVyeXN0cmluZyIsInVybCIsInF1ZXJ5U3RhcnQiLCJpbmRleE9mIiwiZnJhZ21lbnRTdGFydCIsInN1YnN0cmluZyIsIk9ic2VydmVyUHJveHkiLCJleGVjdXRvciIsIm9uTm9PYnNlcnZlcnMiLCJvYnNlcnZlcnMiLCJ1bnN1YnNjcmliZXMiLCJvYnNlcnZlckNvdW50IiwidGFzayIsImZpbmFsaXplZCIsInRoZW4iLCJuZXh0IiwiZm9yRWFjaE9ic2VydmVyIiwib2JzZXJ2ZXIiLCJjb21wbGV0ZSIsInN1YnNjcmliZSIsIm5leHRPck9ic2VydmVyIiwibWV0aG9kcyIsIm1ldGhvZCIsImltcGxlbWVudHNBbnlNZXRob2RzIiwibm9vcCIsInVuc3ViIiwidW5zdWJzY3JpYmVPbmUiLCJiaW5kIiwiZmluYWxFcnJvciIsImZuIiwic2VuZE9uZSIsImVyciIsIl9kZWxlZ2F0ZSIsIkNvbXBvbmVudCIsImluc3RhbmNlRmFjdG9yeSIsInR5cGUiLCJtdWx0aXBsZUluc3RhbmNlcyIsInNlcnZpY2VQcm9wcyIsImluc3RhbnRpYXRpb25Nb2RlIiwib25JbnN0YW5jZUNyZWF0ZWQiLCJzZXRJbnN0YW50aWF0aW9uTW9kZSIsIm1vZGUiLCJzZXRNdWx0aXBsZUluc3RhbmNlcyIsInNldFNlcnZpY2VQcm9wcyIsInByb3BzIiwic2V0SW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2siLCJERUZBVUxUX0VOVFJZX05BTUUiLCJQcm92aWRlciIsImNvbnRhaW5lciIsImNvbXBvbmVudCIsImluc3RhbmNlcyIsIk1hcCIsImluc3RhbmNlc0RlZmVycmVkIiwiaW5zdGFuY2VzT3B0aW9ucyIsIm9uSW5pdENhbGxiYWNrcyIsIm5vcm1hbGl6ZWRJZGVudGlmaWVyIiwibm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyIiwiaGFzIiwiZGVmZXJyZWQiLCJzZXQiLCJpc0luaXRpYWxpemVkIiwic2hvdWxkQXV0b0luaXRpYWxpemUiLCJpbnN0YW5jZSIsImdldE9ySW5pdGlhbGl6ZVNlcnZpY2UiLCJpbnN0YW5jZUlkZW50aWZpZXIiLCJnZXRJbW1lZGlhdGUiLCJvcHRpb25hbCIsImdldENvbXBvbmVudCIsInNldENvbXBvbmVudCIsImlzQ29tcG9uZW50RWFnZXIiLCJpbnN0YW5jZURlZmVycmVkIiwiY2xlYXJJbnN0YW5jZSIsImRlbGV0ZSIsImFzeW5jIiwic2VydmljZXMiLCJmcm9tIiwidmFsdWVzIiwiYWxsIiwiZmlsdGVyIiwiSU5URVJOQUwiLCJfZGVsZXRlIiwiaXNDb21wb25lbnRTZXQiLCJnZXRPcHRpb25zIiwiaW5pdGlhbGl6ZSIsIm9wdHMiLCJvbkluaXQiLCJleGlzdGluZ0NhbGxiYWNrcyIsIlNldCIsImFkZCIsImV4aXN0aW5nSW5zdGFuY2UiLCJpbnZva2VPbkluaXRDYWxsYmFja3MiLCJjYWxsYmFja3MiLCJDb21wb25lbnRDb250YWluZXIiLCJwcm92aWRlcnMiLCJhZGRDb21wb25lbnQiLCJwcm92aWRlciIsImdldFByb3ZpZGVyIiwiYWRkT3JPdmVyd3JpdGVDb21wb25lbnQiLCJnZXRQcm92aWRlcnMiLCJMb2dMZXZlbCIsImxldmVsU3RyaW5nVG9FbnVtIiwiREVCVUciLCJWRVJCT1NFIiwiSU5GTyIsIldBUk4iLCJFUlJPUiIsIlNJTEVOVCIsImRlZmF1bHRMb2dMZXZlbCIsIkNvbnNvbGVNZXRob2QiLCJkZWZhdWx0TG9nSGFuZGxlciIsImxvZ1R5cGUiLCJhcmdzIiwibG9nTGV2ZWwiLCJub3ciLCJEYXRlIiwidG9JU09TdHJpbmciLCJMb2dnZXIiLCJfbG9nTGV2ZWwiLCJfbG9nSGFuZGxlciIsIl91c2VyTG9nSGFuZGxlciIsInZhbCIsIlR5cGVFcnJvciIsInNldExvZ0xldmVsIiwibG9nSGFuZGxlciIsInVzZXJMb2dIYW5kbGVyIiwiZGVidWciLCJsb2ciLCJ3YXJuIiwiaWRiUHJveHlhYmxlVHlwZXMiLCJjdXJzb3JBZHZhbmNlTWV0aG9kcyIsImN1cnNvclJlcXVlc3RNYXAiLCJXZWFrTWFwIiwidHJhbnNhY3Rpb25Eb25lTWFwIiwidHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwIiwidHJhbnNmb3JtQ2FjaGUiLCJyZXZlcnNlVHJhbnNmb3JtQ2FjaGUiLCJpZGJQcm94eVRyYXBzIiwicmVjZWl2ZXIiLCJJREJUcmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlTmFtZXMiLCJvYmplY3RTdG9yZSIsIndyYXAiLCJ0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlIiwiZnVuYyIsIklEQkRhdGFiYXNlIiwidHJhbnNhY3Rpb24iLCJJREJDdXJzb3IiLCJhZHZhbmNlIiwiY29udGludWUiLCJjb250aW51ZVByaW1hcnlLZXkiLCJ1bndyYXAiLCJzdG9yZU5hbWVzIiwidHgiLCJzb3J0IiwiZG9uZSIsInVubGlzdGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIkRPTUV4Y2VwdGlvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24iLCJvYmplY3QiLCJJREJPYmplY3RTdG9yZSIsIklEQkluZGV4Iiwic29tZSIsIlByb3h5IiwiSURCUmVxdWVzdCIsInN1Y2Nlc3MiLCJwcm9taXNpZnlSZXF1ZXN0IiwibmV3VmFsdWUiLCJvcGVuREIiLCJ2ZXJzaW9uIiwiYmxvY2tlZCIsInVwZ3JhZGUiLCJibG9ja2luZyIsInRlcm1pbmF0ZWQiLCJvcGVuUHJvbWlzZSIsImV2ZW50Iiwib2xkVmVyc2lvbiIsIm5ld1ZlcnNpb24iLCJkYiIsImRlbGV0ZURCIiwicmVhZE1ldGhvZHMiLCJ3cml0ZU1ldGhvZHMiLCJjYWNoZWRNZXRob2RzIiwiZ2V0TWV0aG9kIiwidGFyZ2V0RnVuY05hbWUiLCJ1c2VJbmRleCIsImlzV3JpdGUiLCJzdG9yZU5hbWUiLCJzdG9yZSIsInNoaWZ0Iiwib2xkVHJhcHMiLCJQbGF0Zm9ybUxvZ2dlclNlcnZpY2VJbXBsIiwiZ2V0UGxhdGZvcm1JbmZvU3RyaW5nIiwiaXNWZXJzaW9uU2VydmljZVByb3ZpZGVyIiwibGlicmFyeSIsImxvZ1N0cmluZyIsIm5hbWUkbyIsInZlcnNpb24kMSIsImxvZ2dlciIsIlBMQVRGT1JNX0xPR19TVFJJTkciLCJfYXBwcyIsIl9jb21wb25lbnRzIiwiX2FkZENvbXBvbmVudCIsImFwcCIsIl9yZWdpc3RlckNvbXBvbmVudCIsImNvbXBvbmVudE5hbWUiLCJoZWFydGJlYXRDb250cm9sbGVyIiwidHJpZ2dlckhlYXJ0YmVhdCIsIkVSUk9SX0ZBQ1RPUlkiLCJGaXJlYmFzZUFwcEltcGwiLCJjb25maWciLCJfaXNEZWxldGVkIiwiX29wdGlvbnMiLCJhc3NpZ24iLCJfY29uZmlnIiwiX25hbWUiLCJfYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkIiwiYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkIiwiX2NvbnRhaW5lciIsImNoZWNrRGVzdHJveWVkIiwiaXNEZWxldGVkIiwiYXBwTmFtZSIsIlNES19WRVJTSU9OIiwiaW5pdGlhbGl6ZUFwcCIsInJhd0NvbmZpZyIsImdldERlZmF1bHRBcHBDb25maWciLCJleGlzdGluZ0FwcCIsIm5ld0FwcCIsInJlZ2lzdGVyVmVyc2lvbiIsImxpYnJhcnlLZXlPck5hbWUiLCJ2YXJpYW50IiwibGlicmFyeU1pc21hdGNoIiwidmVyc2lvbk1pc21hdGNoIiwid2FybmluZyIsIlNUT1JFX05BTUUiLCJkYlByb21pc2UiLCJnZXREYlByb21pc2UiLCJjcmVhdGVPYmplY3RTdG9yZSIsIm9yaWdpbmFsRXJyb3JNZXNzYWdlIiwid3JpdGVIZWFydGJlYXRzVG9JbmRleGVkREIiLCJoZWFydGJlYXRPYmplY3QiLCJwdXQiLCJjb21wdXRlS2V5IiwiaWRiR2V0RXJyb3IiLCJhcHBJZCIsIkhlYXJ0YmVhdFNlcnZpY2VJbXBsIiwiX2hlYXJ0YmVhdHNDYWNoZSIsIl9zdG9yYWdlIiwiSGVhcnRiZWF0U3RvcmFnZUltcGwiLCJfaGVhcnRiZWF0c0NhY2hlUHJvbWlzZSIsInJlYWQiLCJhZ2VudCIsImRhdGUiLCJnZXRVVENEYXRlU3RyaW5nIiwibGFzdFNlbnRIZWFydGJlYXREYXRlIiwiaGVhcnRiZWF0cyIsInNpbmdsZURhdGVIZWFydGJlYXQiLCJoYlRpbWVzdGFtcCIsInZhbHVlT2YiLCJvdmVyd3JpdGUiLCJoZWFydGJlYXRzVG9TZW5kIiwidW5zZW50RW50cmllcyIsImhlYXJ0YmVhdHNDYWNoZSIsIm1heFNpemUiLCJzbGljZSIsImhlYXJ0YmVhdEVudHJ5IiwiZmluZCIsImhiIiwiZGF0ZXMiLCJjb3VudEJ5dGVzIiwicG9wIiwiZXh0cmFjdEhlYXJ0YmVhdHNGb3JIZWFkZXIiLCJoZWFkZXJTdHJpbmciLCJfY2FuVXNlSW5kZXhlZERCUHJvbWlzZSIsInJ1bkluZGV4ZWREQkVudmlyb25tZW50Q2hlY2siLCJyZWFkSGVhcnRiZWF0c0Zyb21JbmRleGVkREIiLCJoZWFydGJlYXRzT2JqZWN0IiwiZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0IiwiX19yZXN0IiwicyIsInQiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInByb2RFcnJvck1hcCIsIl9ERUZBVUxUX0FVVEhfRVJST1JfRkFDVE9SWSIsImxvZ0NsaWVudCIsIl9sb2dFcnJvciIsIm1zZyIsIl9mYWlsIiwiYXV0aE9yQ29kZSIsInJlc3QiLCJjcmVhdGVFcnJvckludGVybmFsIiwiX2NyZWF0ZUVycm9yIiwiX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UiLCJhdXRoIiwiZXJyb3JNYXAiLCJmdWxsUGFyYW1zIiwiX2Vycm9yRmFjdG9yeSIsIl9hc3NlcnQiLCJhc3NlcnRpb24iLCJkZWJ1Z0ZhaWwiLCJmYWlsdXJlIiwiZGVidWdBc3NlcnQiLCJpbnN0YW5jZUNhY2hlIiwiX2dldEluc3RhbmNlIiwiY2xzIiwiX2dldEN1cnJlbnRVcmwiLCJocmVmIiwiX2dldEN1cnJlbnRTY2hlbWUiLCJwcm90b2NvbCIsIl9pc09ubGluZSIsIm9uTGluZSIsInJ1bnRpbWUiLCJjaHJvbWUiLCJicm93c2VyIiwiaXNCcm93c2VyRXh0ZW5zaW9uIiwiRGVsYXkiLCJzaG9ydERlbGF5IiwibG9uZ0RlbGF5IiwiaXNNb2JpbGUiLCJ0ZXN0IiwiTWF0aCIsIm1pbiIsIl9lbXVsYXRvclVybCIsInBhdGgiLCJlbXVsYXRvciIsInN0YXJ0c1dpdGgiLCJGZXRjaFByb3ZpZGVyIiwic3RhdGljIiwiZmV0Y2hJbXBsIiwiaGVhZGVyc0ltcGwiLCJyZXNwb25zZUltcGwiLCJmZXRjaCIsIkhlYWRlcnMiLCJSZXNwb25zZSIsIlNFUlZFUl9FUlJPUl9NQVAiLCJERUZBVUxUX0FQSV9USU1FT1VUX01TIiwiX2FkZFRpZElmTmVjZXNzYXJ5IiwidGVuYW50SWQiLCJfcGVyZm9ybUFwaVJlcXVlc3QiLCJjdXN0b21FcnJvck1hcCIsIl9wZXJmb3JtRmV0Y2hXaXRoRXJyb3JIYW5kbGluZyIsImJvZHkiLCJxdWVyeSIsImFwaUtleSIsImhlYWRlcnMiLCJfZ2V0QWRkaXRpb25hbEhlYWRlcnMiLCJsYW5ndWFnZUNvZGUiLCJfZ2V0RmluYWxUYXJnZXQiLCJhcGlIb3N0IiwicmVmZXJyZXJQb2xpY3kiLCJmZXRjaEZuIiwiX2NhbkluaXRFbXVsYXRvciIsIm5ldHdvcmtUaW1lb3V0IiwiTmV0d29ya1RpbWVvdXQiLCJyZXNwb25zZSIsInJhY2UiLCJjbGVhck5ldHdvcmtUaW1lb3V0IiwianNvbiIsIl9tYWtlVGFnZ2VkRXJyb3IiLCJvayIsImVycm9yTWVzc2FnZSIsInNlcnZlckVycm9yQ29kZSIsInNlcnZlckVycm9yTWVzc2FnZSIsImF1dGhFcnJvciIsInRvTG93ZXJDYXNlIiwiX3BlcmZvcm1TaWduSW5SZXF1ZXN0Iiwic2VydmVyUmVzcG9uc2UiLCJfc2VydmVyUmVzcG9uc2UiLCJob3N0IiwiYXBpU2NoZW1lIiwidGltZXIiLCJzZXRUaW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwiZXJyb3JQYXJhbXMiLCJlbWFpbCIsInBob25lTnVtYmVyIiwiX3Rva2VuUmVzcG9uc2UiLCJ1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmciLCJ1dGNUaW1lc3RhbXAiLCJOdW1iZXIiLCJpc05hTiIsImdldFRpbWUiLCJ0b1VUQ1N0cmluZyIsInNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyIsInNlY29uZHMiLCJfcGFyc2VUb2tlbiIsImFsZ29yaXRobSIsInBheWxvYWQiLCJzaWduYXR1cmUiLCJfbG9nb3V0SWZJbnZhbGlkYXRlZCIsInVzZXIiLCJieXBhc3NBdXRoU3RhdGUiLCJpc1VzZXJJbnZhbGlkYXRlZCIsImN1cnJlbnRVc2VyIiwic2lnbk91dCIsIlByb2FjdGl2ZVJlZnJlc2giLCJpc1J1bm5pbmciLCJ0aW1lcklkIiwiZXJyb3JCYWNrb2ZmIiwiX3N0YXJ0Iiwic2NoZWR1bGUiLCJfc3RvcCIsImdldEludGVydmFsIiwid2FzRXJyb3IiLCJpbnRlcnZhbCIsInN0c1Rva2VuTWFuYWdlciIsImV4cGlyYXRpb25UaW1lIiwibWF4IiwiaXRlcmF0aW9uIiwiZ2V0SWRUb2tlbiIsIlVzZXJNZXRhZGF0YSIsImNyZWF0ZWRBdCIsImxhc3RMb2dpbkF0IiwiX2luaXRpYWxpemVUaW1lIiwibGFzdFNpZ25JblRpbWUiLCJjcmVhdGlvblRpbWUiLCJfY29weSIsIm1ldGFkYXRhIiwidG9KU09OIiwiX3JlbG9hZFdpdGhvdXRTYXZpbmciLCJpZFRva2VuIiwiZ2V0QWNjb3VudEluZm8iLCJ1c2VycyIsImNvcmVBY2NvdW50IiwiX25vdGlmeVJlbG9hZExpc3RlbmVyIiwibmV3UHJvdmlkZXJEYXRhIiwicHJvdmlkZXJVc2VySW5mbyIsInByb3ZpZGVySWQiLCJ1aWQiLCJyYXdJZCIsImRpc3BsYXlOYW1lIiwicGhvdG9VUkwiLCJwaG90b1VybCIsInByb3ZpZGVyRGF0YSIsIm9yaWdpbmFsIiwibmV3RGF0YSIsIm9sZElzQW5vbnltb3VzIiwiaXNBbm9ueW1vdXMiLCJuZXdJc0Fub255bW91cyIsInBhc3N3b3JkSGFzaCIsInVwZGF0ZXMiLCJsb2NhbElkIiwiZW1haWxWZXJpZmllZCIsIlN0c1Rva2VuTWFuYWdlciIsInJlZnJlc2hUb2tlbiIsImFjY2Vzc1Rva2VuIiwiaXNFeHBpcmVkIiwidXBkYXRlRnJvbVNlcnZlclJlc3BvbnNlIiwiZXhwaXJlc0luIiwicGFyc2VkVG9rZW4iLCJleHAiLCJpYXQiLCJfdG9rZW5FeHBpcmVzSW4iLCJ1cGRhdGVUb2tlbnNBbmRFeHBpcmF0aW9uIiwiZm9yY2VSZWZyZXNoIiwicmVmcmVzaCIsImNsZWFyUmVmcmVzaFRva2VuIiwib2xkVG9rZW4iLCJ0b2tlbkFwaUhvc3QiLCJhY2Nlc3NfdG9rZW4iLCJleHBpcmVzX2luIiwicmVmcmVzaF90b2tlbiIsInJlcXVlc3RTdHNUb2tlbiIsImV4cGlyZXNJblNlYyIsIm1hbmFnZXIiLCJfYXNzaWduIiwiX2Nsb25lIiwiX3BlcmZvcm1SZWZyZXNoIiwiYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQiLCJVc2VySW1wbCIsIm9wdCIsInByb2FjdGl2ZVJlZnJlc2giLCJyZWxvYWRVc2VySW5mbyIsInJlbG9hZExpc3RlbmVyIiwiZ2V0VG9rZW4iLCJfcGVyc2lzdFVzZXJJZkN1cnJlbnQiLCJfbm90aWZ5TGlzdGVuZXJzSWZDdXJyZW50IiwiZ2V0SWRUb2tlblJlc3VsdCIsInVzZXJJbnRlcm5hbCIsImNsYWltcyIsImF1dGhfdGltZSIsImZpcmViYXNlIiwic2lnbkluUHJvdmlkZXIiLCJhdXRoVGltZSIsImlzc3VlZEF0VGltZSIsInNpZ25JblNlY29uZEZhY3RvciIsInJlbG9hZCIsInVzZXJJbmZvIiwiX29uUmVsb2FkIiwiX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCIsIl9zdG9wUHJvYWN0aXZlUmVmcmVzaCIsInRva2Vuc1JlZnJlc2hlZCIsImRlbGV0ZUFjY291bnQiLCJfcmVkaXJlY3RFdmVudElkIiwiX2IiLCJfYyIsIl9kIiwiX2UiLCJfZiIsIl9nIiwiX2giLCJwbGFpbk9iamVjdFRva2VuTWFuYWdlciIsImZyb21KU09OIiwiaWRUb2tlblJlc3BvbnNlIiwiSW5NZW1vcnlQZXJzaXN0ZW5jZSIsInN0b3JhZ2UiLCJfYWRkTGlzdGVuZXIiLCJfa2V5IiwiX2xpc3RlbmVyIiwiX3JlbW92ZUxpc3RlbmVyIiwiaW5NZW1vcnlQZXJzaXN0ZW5jZSIsIl9wZXJzaXN0ZW5jZUtleU5hbWUiLCJQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyIiwicGVyc2lzdGVuY2UiLCJ1c2VyS2V5IiwiZnVsbFVzZXJLZXkiLCJmdWxsUGVyc2lzdGVuY2VLZXkiLCJib3VuZEV2ZW50SGFuZGxlciIsIl9vblN0b3JhZ2VFdmVudCIsInNldEN1cnJlbnRVc2VyIiwiX3NldCIsImJsb2IiLCJfZ2V0IiwiX2Zyb21KU09OIiwicmVtb3ZlQ3VycmVudFVzZXIiLCJfcmVtb3ZlIiwic2F2ZVBlcnNpc3RlbmNlRm9yUmVkaXJlY3QiLCJuZXdQZXJzaXN0ZW5jZSIsImdldEN1cnJlbnRVc2VyIiwicGVyc2lzdGVuY2VIaWVyYXJjaHkiLCJhdmFpbGFibGVQZXJzaXN0ZW5jZXMiLCJfaXNBdmFpbGFibGUiLCJzZWxlY3RlZFBlcnNpc3RlbmNlIiwidXNlclRvTWlncmF0ZSIsIm1pZ3JhdGlvbkhpZXJhcmNoeSIsIl9zaG91bGRBbGxvd01pZ3JhdGlvbiIsIl9nZXRCcm93c2VyTmFtZSIsInVzZXJBZ2VudCIsInVhIiwiX2lzSUVNb2JpbGUiLCJfaXNGaXJlZm94IiwiX2lzQmxhY2tCZXJyeSIsIl9pc1dlYk9TIiwiX2lzU2FmYXJpIiwiX2lzQ2hyb21lSU9TIiwiX2lzQW5kcm9pZCIsInJlIiwibWF0Y2hlcyIsIl9pc0lPUyIsIl9pc01vYmlsZUJyb3dzZXIiLCJfZ2V0Q2xpZW50VmVyc2lvbiIsImNsaWVudFBsYXRmb3JtIiwiZnJhbWV3b3JrcyIsInJlcG9ydGVkUGxhdGZvcm0iLCJyZXBvcnRlZEZyYW1ld29ya3MiLCJBdXRoTWlkZGxld2FyZVF1ZXVlIiwicXVldWUiLCJwdXNoQ2FsbGJhY2siLCJvbkFib3J0Iiwid3JhcHBlZENhbGxiYWNrIiwibmV4dFVzZXIiLCJvbkFib3J0U3RhY2siLCJiZWZvcmVTdGF0ZUNhbGxiYWNrIiwicmV2ZXJzZSIsIm9yaWdpbmFsTWVzc2FnZSIsIkF1dGhJbXBsIiwiaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyIiwiZW11bGF0b3JDb25maWciLCJvcGVyYXRpb25zIiwiYXV0aFN0YXRlU3Vic2NyaXB0aW9uIiwiU3Vic2NyaXB0aW9uIiwiaWRUb2tlblN1YnNjcmlwdGlvbiIsImJlZm9yZVN0YXRlUXVldWUiLCJyZWRpcmVjdFVzZXIiLCJpc1Byb2FjdGl2ZVJlZnJlc2hFbmFibGVkIiwiX2lzSW5pdGlhbGl6ZWQiLCJfZGVsZXRlZCIsIl9pbml0aWFsaXphdGlvblByb21pc2UiLCJfcG9wdXBSZWRpcmVjdFJlc29sdmVyIiwibGFzdE5vdGlmaWVkVWlkIiwic2V0dGluZ3MiLCJhcHBWZXJpZmljYXRpb25EaXNhYmxlZEZvclRlc3RpbmciLCJjbGllbnRWZXJzaW9uIiwic2RrQ2xpZW50VmVyc2lvbiIsIl9pbml0aWFsaXplV2l0aFBlcnNpc3RlbmNlIiwicG9wdXBSZWRpcmVjdFJlc29sdmVyIiwicGVyc2lzdGVuY2VNYW5hZ2VyIiwiX3Nob3VsZEluaXRQcm9hY3RpdmVseSIsIl9pbml0aWFsaXplIiwiaW5pdGlhbGl6ZUN1cnJlbnRVc2VyIiwiYXNzZXJ0ZWRQZXJzaXN0ZW5jZSIsIl9jdXJyZW50VXNlciIsIl91cGRhdGVDdXJyZW50VXNlciIsInByZXZpb3VzbHlTdG9yZWRVc2VyIiwiZnV0dXJlQ3VycmVudFVzZXIiLCJuZWVkc1RvY2hlY2tNaWRkbGV3YXJlIiwiYXV0aERvbWFpbiIsImdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyIiwicmVkaXJlY3RVc2VyRXZlbnRJZCIsInN0b3JlZFVzZXJFdmVudElkIiwidHJ5UmVkaXJlY3RTaWduSW4iLCJkaXJlY3RseVNldEN1cnJlbnRVc2VyIiwicnVuTWlkZGxld2FyZSIsIl9vdmVycmlkZVJlZGlyZWN0UmVzdWx0IiwicmVsb2FkQW5kU2V0Q3VycmVudFVzZXJPckNsZWFyIiwicmVkaXJlY3RSZXNvbHZlciIsIl9jb21wbGV0ZVJlZGlyZWN0Rm4iLCJfc2V0UmVkaXJlY3RVc2VyIiwidXNlRGV2aWNlTGFuZ3VhZ2UiLCJuYXZpZ2F0b3JMYW5ndWFnZSIsImxhbmd1YWdlcyIsImxhbmd1YWdlIiwiX2dldFVzZXJMYW5ndWFnZSIsInVzZXJFeHRlcm4iLCJza2lwQmVmb3JlU3RhdGVDYWxsYmFja3MiLCJub3RpZnlBdXRoTGlzdGVuZXJzIiwicmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIiLCJzZXRQZXJzaXN0ZW5jZSIsIl9nZXRQZXJzaXN0ZW5jZSIsIl91cGRhdGVFcnJvck1hcCIsIm9uQXV0aFN0YXRlQ2hhbmdlZCIsImNvbXBsZXRlZCIsInJlZ2lzdGVyU3RhdGVMaXN0ZW5lciIsImJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQiLCJvbklkVG9rZW5DaGFuZ2VkIiwicmVkaXJlY3RNYW5hZ2VyIiwicmVzb2x2ZXIiLCJfcmVkaXJlY3RQZXJzaXN0ZW5jZSIsImN1cnJlbnRVaWQiLCJzdWJzY3JpcHRpb24iLCJjYiIsImFkZE9ic2VydmVyIiwiYWN0aW9uIiwiX2xvZ0ZyYW1ld29yayIsImZyYW1ld29yayIsIl9nZXRGcmFtZXdvcmtzIiwiaGVhcnRiZWF0c0hlYWRlciIsImdldEhlYXJ0YmVhdHNIZWFkZXIiLCJfY2FzdEF1dGgiLCJwcm94eSIsImNyZWF0ZVN1YnNjcmliZSIsImV4dHJhY3RQcm90b2NvbCIsInByb3RvY29sRW5kIiwic3Vic3RyIiwicGFyc2VQb3J0IiwicG9ydFN0ciIsInBvcnQiLCJBdXRoQ3JlZGVudGlhbCIsInNpZ25Jbk1ldGhvZCIsIl9nZXRJZFRva2VuUmVzcG9uc2UiLCJfYXV0aCIsIl9saW5rVG9JZFRva2VuIiwiX2lkVG9rZW4iLCJfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyIiwiRW1haWxBdXRoQ3JlZGVudGlhbCIsIl9lbWFpbCIsIl9wYXNzd29yZCIsIl90ZW5hbnRJZCIsInBhc3N3b3JkIiwib29iQ29kZSIsIl9mcm9tRW1haWxBbmRQYXNzd29yZCIsIl9mcm9tRW1haWxBbmRDb2RlIiwic2lnbkluV2l0aFBhc3N3b3JkIiwicmV0dXJuU2VjdXJlVG9rZW4iLCJzaWduSW5XaXRoRW1haWxMaW5rJDEiLCJ1cGRhdGVFbWFpbFBhc3N3b3JkIiwic2lnbkluV2l0aEVtYWlsTGlua0ZvckxpbmtpbmciLCJzaWduSW5XaXRoSWRwIiwiT0F1dGhDcmVkZW50aWFsIiwiYXJndW1lbnRzIiwicGVuZGluZ1Rva2VuIiwiY3JlZCIsIm9hdXRoVG9rZW4iLCJvYXV0aFRva2VuU2VjcmV0Iiwic2VjcmV0IiwiYnVpbGRSZXF1ZXN0IiwiYXV0b0NyZWF0ZSIsInJlcXVlc3RVcmkiLCJwb3N0Qm9keSIsIlZFUklGWV9QSE9ORV9OVU1CRVJfRk9SX0VYSVNUSU5HX0VSUk9SX01BUF8iLCJQaG9uZUF1dGhDcmVkZW50aWFsIiwidmVyaWZpY2F0aW9uSWQiLCJ2ZXJpZmljYXRpb25Db2RlIiwidGVtcG9yYXJ5UHJvb2YiLCJzaWduSW5XaXRoUGhvbmVOdW1iZXIkMSIsIl9tYWtlVmVyaWZpY2F0aW9uUmVxdWVzdCIsImxpbmtXaXRoUGhvbmVOdW1iZXIkMSIsIm9wZXJhdGlvbiIsInZlcmlmeVBob25lTnVtYmVyRm9yRXhpc3RpbmciLCJzZXNzaW9uSW5mbyIsIkFjdGlvbkNvZGVVUkwiLCJhY3Rpb25MaW5rIiwic2VhcmNoUGFyYW1zIiwicGFyc2VNb2RlIiwiY29udGludWVVcmwiLCJsaW5rIiwiZG91YmxlRGVlcExpbmsiLCJpT1NEZWVwTGluayIsInBhcnNlRGVlcExpbmsiLCJFbWFpbEF1dGhQcm92aWRlciIsIlBST1ZJREVSX0lEIiwiZW1haWxMaW5rIiwiYWN0aW9uQ29kZVVybCIsInBhcnNlTGluayIsIkVNQUlMX1BBU1NXT1JEX1NJR05fSU5fTUVUSE9EIiwiRU1BSUxfTElOS19TSUdOX0lOX01FVEhPRCIsIkZlZGVyYXRlZEF1dGhQcm92aWRlciIsImRlZmF1bHRMYW5ndWFnZUNvZGUiLCJjdXN0b21QYXJhbWV0ZXJzIiwic2V0RGVmYXVsdExhbmd1YWdlIiwic2V0Q3VzdG9tUGFyYW1ldGVycyIsImN1c3RvbU9BdXRoUGFyYW1ldGVycyIsImdldEN1c3RvbVBhcmFtZXRlcnMiLCJCYXNlT0F1dGhQcm92aWRlciIsInNjb3BlcyIsImFkZFNjb3BlIiwic2NvcGUiLCJnZXRTY29wZXMiLCJGYWNlYm9va0F1dGhQcm92aWRlciIsIl9mcm9tUGFyYW1zIiwiRkFDRUJPT0tfU0lHTl9JTl9NRVRIT0QiLCJ1c2VyQ3JlZGVudGlhbCIsImNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0IiwidG9rZW5SZXNwb25zZSIsIm9hdXRoQWNjZXNzVG9rZW4iLCJjcmVkZW50aWFsIiwiR29vZ2xlQXV0aFByb3ZpZGVyIiwiR09PR0xFX1NJR05fSU5fTUVUSE9EIiwib2F1dGhJZFRva2VuIiwiR2l0aHViQXV0aFByb3ZpZGVyIiwiR0lUSFVCX1NJR05fSU5fTUVUSE9EIiwiVHdpdHRlckF1dGhQcm92aWRlciIsIlRXSVRURVJfU0lHTl9JTl9NRVRIT0QiLCJVc2VyQ3JlZGVudGlhbEltcGwiLCJvcGVyYXRpb25UeXBlIiwiX2Zyb21JZFRva2VuUmVzcG9uc2UiLCJwcm92aWRlcklkRm9yUmVzcG9uc2UiLCJfdXBkYXRlVG9rZW5zSWZOZWNlc3NhcnkiLCJNdWx0aUZhY3RvckVycm9yIiwiX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5IiwiX2Zyb21FcnJvckFuZE9wZXJhdGlvbiIsIlNUT1JBR0VfQVZBSUxBQkxFX0tFWSIsIkJyb3dzZXJQZXJzaXN0ZW5jZUNsYXNzIiwic3RvcmFnZVJldHJpZXZlciIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiZ2V0SXRlbSIsIkJyb3dzZXJMb2NhbFBlcnNpc3RlbmNlIiwibG9jYWxTdG9yYWdlIiwicG9sbCIsIm9uU3RvcmFnZUV2ZW50IiwibGlzdGVuZXJzIiwibG9jYWxDYWNoZSIsInBvbGxUaW1lciIsInNhZmFyaUxvY2FsU3RvcmFnZU5vdFN5bmNlZCIsIl9pZnJhbWVDYW5ub3RTeW5jV2ViU3RvcmFnZSIsInRvcCIsIl9pc0lmcmFtZSIsImZhbGxiYWNrVG9Qb2xsaW5nIiwiZm9yQWxsQ2hhbmdlZEtleXMiLCJvbGRWYWx1ZSIsIl9vbGRWYWx1ZSIsIm5vdGlmeUxpc3RlbmVycyIsImRldGFjaExpc3RlbmVyIiwic3RvcFBvbGxpbmciLCJzdG9yZWRWYWx1ZSIsInRyaWdnZXJMaXN0ZW5lcnMiLCJpc0lFIiwiZG9jdW1lbnRNb2RlIiwibGlzdGVuZXIiLCJzdGFydFBvbGxpbmciLCJzZXRJbnRlcnZhbCIsIlN0b3JhZ2VFdmVudCIsImNsZWFySW50ZXJ2YWwiLCJhdHRhY2hMaXN0ZW5lciIsInNpemUiLCJicm93c2VyTG9jYWxQZXJzaXN0ZW5jZSIsIkJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UiLCJzZXNzaW9uU3RvcmFnZSIsImJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UiLCJSZWNlaXZlciIsImV2ZW50VGFyZ2V0IiwiaGFuZGxlcnNNYXAiLCJoYW5kbGVFdmVudCIsInJlY2VpdmVycyIsImlzTGlzdGVuaW5ndG8iLCJuZXdJbnN0YW5jZSIsIm1lc3NhZ2VFdmVudCIsImV2ZW50SWQiLCJldmVudFR5cGUiLCJoYW5kbGVycyIsInBvcnRzIiwicG9zdE1lc3NhZ2UiLCJzdGF0dXMiLCJwcm9taXNlcyIsImhhbmRsZXIiLCJvcmlnaW4iLCJmdWxmaWxsZWQiLCJyZWFzb24iLCJfYWxsU2V0dGxlZCIsIl9zdWJzY3JpYmUiLCJldmVudEhhbmRsZXIiLCJfdW5zdWJzY3JpYmUiLCJfZ2VuZXJhdGVFdmVudElkIiwicHJlZml4IiwiZGlnaXRzIiwicmFuZG9tIiwiZmxvb3IiLCJTZW5kZXIiLCJyZW1vdmVNZXNzYWdlSGFuZGxlciIsIm1lc3NhZ2VDaGFubmVsIiwicG9ydDEiLCJvbk1lc3NhZ2UiLCJ0aW1lb3V0IiwiTWVzc2FnZUNoYW5uZWwiLCJjb21wbGV0aW9uVGltZXIiLCJzdGFydCIsImFja1RpbWVyIiwicG9ydDIiLCJmaW5hbGx5IiwiX3dpbmRvdyIsIl9pc1dvcmtlciIsIkRCX09CSkVDVFNUT1JFX05BTUUiLCJEQl9EQVRBX0tFWVBBVEgiLCJEQlByb21pc2UiLCJ0b1Byb21pc2UiLCJnZXRPYmplY3RTdG9yZSIsImlzUmVhZFdyaXRlIiwiX29wZW5EYXRhYmFzZSIsImtleVBhdGgiLCJjb250YWlucyIsIl9kZWxldGVEYXRhYmFzZSIsIl9wdXRPYmplY3QiLCJfZGVsZXRlT2JqZWN0IiwiSW5kZXhlZERCTG9jYWxQZXJzaXN0ZW5jZSIsInBlbmRpbmdXcml0ZXMiLCJzZW5kZXIiLCJzZXJ2aWNlV29ya2VyUmVjZWl2ZXJBdmFpbGFibGUiLCJhY3RpdmVTZXJ2aWNlV29ya2VyIiwiX3dvcmtlckluaXRpYWxpemF0aW9uUHJvbWlzZSIsImluaXRpYWxpemVTZXJ2aWNlV29ya2VyTWVzc2FnaW5nIiwib3AiLCJudW1BdHRlbXB0cyIsIl9vcGVuRGIiLCJpbml0aWFsaXplUmVjZWl2ZXIiLCJpbml0aWFsaXplU2VuZGVyIiwiX29yaWdpbiIsImtleVByb2Nlc3NlZCIsIl9wb2xsIiwiX2RhdGEiLCJzZXJ2aWNlV29ya2VyIiwicmVhZHkiLCJhY3RpdmUiLCJfZ2V0QWN0aXZlU2VydmljZVdvcmtlciIsInJlc3VsdHMiLCJfc2VuZCIsImNvbnRyb2xsZXIiLCJfZ2V0U2VydmljZVdvcmtlckNvbnRyb2xsZXIiLCJ3cml0ZSIsIl93aXRoUGVuZGluZ1dyaXRlIiwiX3dpdGhSZXRyaWVzIiwibm90aWZ5U2VydmljZVdvcmtlciIsImdldE9iamVjdCIsImdldEFsbFJlcXVlc3QiLCJnZXRBbGwiLCJrZXlzSW5SZXN1bHQiLCJmYmFzZV9rZXkiLCJsb2NhbEtleSIsImluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UiLCJfZ2VuZXJhdGVDYWxsYmFja05hbWUiLCJQaG9uZUF1dGhQcm92aWRlciIsInZlcmlmeVBob25lTnVtYmVyIiwicGhvbmVPcHRpb25zIiwiYXBwbGljYXRpb25WZXJpZmllciIsInZlcmlmaWVyIiwicmVjYXB0Y2hhVG9rZW4iLCJ2ZXJpZnkiLCJwaG9uZUluZm9PcHRpb25zIiwic2Vzc2lvbiIsInN0YXJ0RW5yb2xsUGhvbmVNZmEiLCJwaG9uZUVucm9sbG1lbnRJbmZvIiwicGhvbmVTZXNzaW9uSW5mbyIsIm1mYUVucm9sbG1lbnRJZCIsIm11bHRpRmFjdG9ySGludCIsIm11bHRpRmFjdG9yVWlkIiwic3RhcnRTaWduSW5QaG9uZU1mYSIsIm1mYVBlbmRpbmdDcmVkZW50aWFsIiwicGhvbmVTaWduSW5JbmZvIiwicGhvbmVSZXNwb25zZUluZm8iLCJzZW5kUGhvbmVWZXJpZmljYXRpb25Db2RlIiwiX3Jlc2V0IiwiX3ZlcmlmeVBob25lTnVtYmVyIiwiX2Zyb21WZXJpZmljYXRpb24iLCJfZnJvbVRva2VuUmVzcG9uc2UiLCJfd2l0aERlZmF1bHRSZXNvbHZlciIsInJlc29sdmVyT3ZlcnJpZGUiLCJQSE9ORV9TSUdOX0lOX01FVEhPRCIsIklkcENyZWRlbnRpYWwiLCJfYnVpbGRJZHBSZXF1ZXN0Iiwic2Vzc2lvbklkIiwicmV0dXJuSWRwQ3JlZGVudGlhbCIsIl9zaWduSW4iLCJfc2lnbkluV2l0aENyZWRlbnRpYWwiLCJfcmVhdXRoIiwicGFyc2VkIiwic3ViIiwiX2Zvck9wZXJhdGlvbiIsIl9yZWF1dGhlbnRpY2F0ZSIsIl9saW5rIiwiX2xpbmskMSIsIkFic3RyYWN0UG9wdXBSZWRpcmVjdE9wZXJhdGlvbiIsInBlbmRpbmdQcm9taXNlIiwiZXZlbnRNYW5hZ2VyIiwiZXhlY3V0ZSIsIm9uRXhlY3V0aW9uIiwicmVnaXN0ZXJDb25zdW1lciIsInVybFJlc3BvbnNlIiwiZ2V0SWRwVGFzayIsIm9uRXJyb3IiLCJ1bnJlZ2lzdGVyQW5kQ2xlYW5VcCIsInVucmVnaXN0ZXJDb25zdW1lciIsImNsZWFuVXAiLCJfUE9MTF9XSU5ET1dfQ0xPU0VfVElNRU9VVCIsIlBvcHVwT3BlcmF0aW9uIiwiYXV0aFdpbmRvdyIsInBvbGxJZCIsImN1cnJlbnRQb3B1cEFjdGlvbiIsImNhbmNlbCIsIl9vcGVuUG9wdXAiLCJhc3NvY2lhdGVkRXZlbnQiLCJfb3JpZ2luVmFsaWRhdGlvbiIsIl9pc0lmcmFtZVdlYlN0b3JhZ2VTdXBwb3J0ZWQiLCJpc1N1cHBvcnRlZCIsInBvbGxVc2VyQ2FuY2VsbGF0aW9uIiwiY2xvc2VkIiwicmVkaXJlY3RPdXRjb21lTWFwIiwiUmVkaXJlY3RBY3Rpb24iLCJyZWFkeU91dGNvbWUiLCJwZW5kaW5nUmVkaXJlY3RLZXkiLCJyZXNvbHZlclBlcnNpc3RlbmNlIiwiaGFzUGVuZGluZ1JlZGlyZWN0IiwiX2dldEFuZENsZWFyUGVuZGluZ1JlZGlyZWN0U3RhdHVzIiwib25BdXRoRXZlbnQiLCJfcmVkaXJlY3RVc2VyRm9ySWQiLCJfZ2V0UmVkaXJlY3RSZXN1bHQiLCJyZXNvbHZlckV4dGVybiIsImF1dGhJbnRlcm5hbCIsIkF1dGhFdmVudE1hbmFnZXIiLCJjYWNoZWRFdmVudFVpZHMiLCJjb25zdW1lcnMiLCJxdWV1ZWRSZWRpcmVjdEV2ZW50IiwiaGFzSGFuZGxlZFBvdGVudGlhbFJlZGlyZWN0IiwibGFzdFByb2Nlc3NlZEV2ZW50VGltZSIsImF1dGhFdmVudENvbnN1bWVyIiwiaXNFdmVudEZvckNvbnN1bWVyIiwic2VuZFRvQ29uc3VtZXIiLCJzYXZlRXZlbnRUb0NhY2hlIiwib25FdmVudCIsImhhc0V2ZW50QmVlbkhhbmRsZWQiLCJoYW5kbGVkIiwiY29uc3VtZXIiLCJpc051bGxSZWRpcmVjdEV2ZW50IiwiaXNSZWRpcmVjdEV2ZW50IiwiZXZlbnRJZE1hdGNoZXMiLCJjbGVhciIsImV2ZW50VWlkIiwidiIsIklQX0FERFJFU1NfUkVHRVgiLCJIVFRQX1JFR0VYIiwibWF0Y2hEb21haW4iLCJleHBlY3RlZCIsImN1cnJlbnRVcmwiLCJob3N0bmFtZSIsIlVSTCIsImNlVXJsIiwiZXNjYXBlZERvbWFpblBhdHRlcm4iLCJSZWdFeHAiLCJORVRXT1JLX1RJTUVPVVQiLCJyZXNldFVubG9hZGVkR2FwaU1vZHVsZXMiLCJiZWFjb24iLCJfX19qc2wiLCJIIiwiaGludCIsInIiLCJMIiwiQ1AiLCJjYWNoZWRHQXBpTG9hZGVyIiwiX2xvYWRHYXBpIiwibG9hZEdhcGlJZnJhbWUiLCJnYXBpIiwibG9hZCIsImlmcmFtZXMiLCJnZXRDb250ZXh0Iiwib250aW1lb3V0IiwiSWZyYW1lIiwiY2JOYW1lIiwiZWwiLCJvbmxvYWQiLCJjaGFyc2V0IiwiZ2V0U2NyaXB0UGFyZW50RWxlbWVudCIsImxvYWRHYXBpIiwiUElOR19USU1FT1VUIiwiSUZSQU1FX0FUVFJJQlVURVMiLCJwb3NpdGlvbiIsIndpZHRoIiwiaGVpZ2h0IiwidGFiaW5kZXgiLCJFSURfRlJPTV9BUElIT1NUIiwiZ2V0SWZyYW1lVXJsIiwiZWlkIiwiZnciLCJCQVNFX1BPUFVQX09QVElPTlMiLCJyZXNpemFibGUiLCJzdGF0dXNiYXIiLCJ0b29sYmFyIiwiQXV0aFBvcHVwIiwiX2dldFJlZGlyZWN0VXJsIiwiYXV0aFR5cGUiLCJyZWRpcmVjdFVybCIsImFkZGl0aW9uYWxQYXJhbXMiLCJpc0VtcHR5IiwidGlkIiwicGFyYW1zRGljdCIsImdldEhhbmRsZXJCYXNlIiwiV0VCX1NUT1JBR0VfU1VQUE9SVF9LRVkiLCJicm93c2VyUG9wdXBSZWRpcmVjdFJlc29sdmVyIiwiZXZlbnRNYW5hZ2VycyIsIm9yaWdpblZhbGlkYXRpb25Qcm9taXNlcyIsInNjcmVlbiIsImF2YWlsSGVpZ2h0IiwibGVmdCIsImF2YWlsV2lkdGgiLCJzY3JvbGxiYXJzIiwib3B0aW9uc1N0cmluZyIsInJlZHVjZSIsImFjY3VtIiwic3RhbmRhbG9uZSIsIl9pc0lPU1N0YW5kYWxvbmUiLCJjbGljayIsImNyZWF0ZUV2ZW50IiwiaW5pdE1vdXNlRXZlbnQiLCJkaXNwYXRjaEV2ZW50Iiwib3BlbkFzTmV3V2luZG93SU9TIiwibmV3V2luIiwiZm9jdXMiLCJfb3BlbiIsImluaXRBbmRHZXRNYW5hZ2VyIiwiaWZyYW1lIiwiY29udGV4dCIsIndoZXJlIiwibWVzc2FnZUhhbmRsZXJzRmlsdGVyIiwiQ1JPU1NfT1JJR0lOX0lGUkFNRVNfRklMVEVSIiwiZG9udGNsZWFyIiwicmVzdHlsZSIsInNldEhpZGVPbkxlYXZlIiwibmV0d29ya0Vycm9yIiwibmV0d29ya0Vycm9yVGltZXIiLCJjbGVhclRpbWVyQW5kUmVzb2x2ZSIsInBpbmciLCJfb3BlbklmcmFtZSIsInJlZ2lzdGVyIiwiaWZyYW1lRXZlbnQiLCJhdXRoRXZlbnQiLCJzZW5kIiwiYXV0aG9yaXplZERvbWFpbnMiLCJfZ2V0UHJvamVjdENvbmZpZyIsImRvbWFpbiIsIl92YWxpZGF0ZU9yaWdpbiIsIkF1dGhJbnRlcm9wIiwiaW50ZXJuYWxMaXN0ZW5lcnMiLCJnZXRVaWQiLCJhc3NlcnRBdXRoQ29uZmlndXJlZCIsImFkZEF1dGhUb2tlbkxpc3RlbmVyIiwidW5zdWJzY3JpYmUiLCJ1cGRhdGVQcm9hY3RpdmVSZWZyZXNoIiwicmVtb3ZlQXV0aFRva2VuTGlzdGVuZXIiLCJhdXRoSWRUb2tlbk1heEFnZSIsImxhc3RQb3N0ZWRJZFRva2VuIiwiZ2V0QXV0aCIsImRlcHMiLCJpbml0aWFsaXplQXV0aCIsImF1dGhUb2tlblN5bmNVcmwiLCJtaW50Q29va2llIiwiaWRUb2tlblJlc3VsdCIsImlkVG9rZW5BZ2UiLCJhdXRoRW11bGF0b3JIb3N0IiwicHJvZHVjdE5hbWUiLCJlbXVsYXRvckhvc3RzIiwiZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCIsImRpc2FibGVXYXJuaW5ncyIsImF1dGhvcml0eSIsImV4ZWMiLCJob3N0QW5kUG9ydCIsImJyYWNrZXRlZElQdjYiLCJleHRyYWN0SG9zdEFuZFBvcnQiLCJmcmVlemUiLCJhdHRhY2hCYW5uZXIiLCJzdHkiLCJpbm5lclRleHQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJib3JkZXIiLCJjb2xvciIsImJvdHRvbSIsIm1hcmdpbiIsInpJbmRleCIsInRleHRBbGlnbiIsImNsYXNzTGlzdCIsInJlYWR5U3RhdGUiLCJlbWl0RW11bGF0b3JXYXJuaW5nIiwiY29ubmVjdEF1dGhFbXVsYXRvciIsImF1dGhJbnN0YW5jZSIsImhpZXJhcmNoeSIsIl9pbml0aWFsaXplQXV0aEluc3RhbmNlIiwiX2luc3RhbmNlSWRlbnRpZmllciIsIl9pbnN0YW5jZSIsImdldFZlcnNpb25Gb3JQbGF0Zm9ybSIsImNvbW1vbmpzR2xvYmFsIiwiZXNtIiwiZ29vZyIsImwiLCJhYSIsImJhIiwiZGEiLCJlYSIsImZhIiwiaGEiLCJ1bnNoaWZ0IiwicSIsImlhIiwiWCIsIldiIiwiZiIsImgiLCJuYSIsIk0iLCJsYSIsIm1hIiwidyIsImRlZmF1bHRQcmV2ZW50ZWQiLCJvYSIsInBhIiwicWEiLCJ0cmltIiwicmEiLCJzYSIsIngiLCJ0YSIsIkVhIiwid2EiLCJ5IiwieGEiLCJ5YSIsInphIiwiQWEiLCJCYSIsIkZhIiwiR2EiLCJIYSIsInBhcnNlRmxvYXQiLCJKYSIsInZhIiwiSWEiLCJwYXJzZUludCIsIkxhIiwieiIsInJlbGF0ZWRUYXJnZXQiLCJidXR0b24iLCJzY3JlZW5ZIiwic2NyZWVuWCIsImNsaWVudFkiLCJjbGllbnRYIiwibWV0YUtleSIsInNoaWZ0S2V5IiwiYWx0S2V5IiwiY3RybEtleSIsInN0YXRlIiwicG9pbnRlcklkIiwicG9pbnRlclR5cGUiLCJjaGFuZ2VkVG91Y2hlcyIsInNyY0VsZW1lbnQiLCJub2RlTmFtZSIsImZyb21FbGVtZW50IiwidG9FbGVtZW50IiwicGFnZVgiLCJwYWdlWSIsIk1hIiwicHJldmVudERlZmF1bHQiLCJyZXR1cm5WYWx1ZSIsIkEiLCJOYSIsIk9hIiwiY2FwdHVyZSIsIlBhIiwiUWEiLCJSYSIsIlNhIiwiVGEiLCJVYSIsIldhIiwiVmEiLCJYYSIsIllhIiwiJGEiLCJvbmNlIiwiYWIiLCJiYiIsIk4iLCJnYiIsImViIiwiYXR0YWNoRXZlbnQiLCJmYiIsImFkZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJPIiwiaWIiLCJkZXRhY2hFdmVudCIsImpiIiwiQiIsIlAiLCJJIiwiQyIsImtiIiwibGIiLCJtYiIsIm5iIiwidWIiLCJwYiIsImoiLCJxYiIsInJlc2V0IiwicmIiLCJzYiIsInhiIiwidmIiLCJ3YiIsInliIiwiemIiLCJjYSIsIlIiLCJBYiIsIkJiIiwibSIsIkNiIiwiRCIsIkRiIiwiRWIiLCJGYiIsIkdiIiwiRSIsIkpiIiwiRyIsIkxiIiwiTWIiLCJOYiIsIk9iIiwiU1RBVF9FVkVOVCIsInN0YXQiLCJQYiIsIkoiLCJRYiIsIk5PX0VSUk9SIiwidGIiLCJUSU1FT1VUIiwiUmIiLCJWYiIsIlNiIiwiVGIiLCJVYiIsIlhiIiwiSyIsIk9QRU4iLCJZYiIsIlUiLCJTIiwiWmIiLCJUIiwiRiIsIlYiLCJZIiwiJCIsIloiLCIkYiIsIlhNTEh0dHBSZXF1ZXN0IiwiYWMiLCJiYyIsImNjIiwiZGMiLCJlYyIsImZjIiwiZ2MiLCJIYiIsImpjIiwiRGEiLCJsYyIsImtjIiwib2MiLCJRIiwicGMiLCJpYyIsIm1jIiwiYWJvcnQiLCJxYyIsInJjIiwic2MiLCJ0YyIsInVjIiwiamEiLCJrYSIsIkNhIiwiZ2V0UmVzcG9uc2VIZWFkZXIiLCJ2YyIsIndjIiwieGMiLCJ5YyIsInpjIiwiQWMiLCJEYyIsIlciLCJDYyIsIkJjIiwiaGMiLCJUZXh0RGVjb2RlciIsImRlY29kZSIsInN0cmVhbSIsIkliIiwiS2IiLCJFYyIsIkdjIiwiSGMiLCJJYyIsIkpjIiwiS2MiLCJUYyIsIlFjIiwiTGMiLCJSYyIsImFicyIsImRlY29kZVVSSSIsImVuY29kZVVSSSIsIlNjIiwiTWMiLCJOYyIsIk9jIiwiUGMiLCJGYyIsIlVjIiwiV2MiLCJYYyIsIlBlcmZvcm1hbmNlTmF2aWdhdGlvblRpbWluZyIsInBlcmZvcm1hbmNlIiwiZ2V0RW50cmllc0J5VHlwZSIsIm5leHRIb3BQcm90b2NvbCIsIlljIiwiWmMiLCIkYyIsImFkIiwiYmQiLCJkZCIsIm9uYWJvcnQiLCJlZCIsImZkIiwiZ2QiLCJyZXNwb25zZVR5cGUiLCJyZXNwb25zZVRleHQiLCJzdGF0dXNUZXh0Iiwib25yZWFkeXN0YXRlY2hhbmdlIiwiamQiLCJnYSIsImhkIiwiY3JlZGVudGlhbHMiLCJjYWNoZSIsIlJlcXVlc3QiLCJhcnJheUJ1ZmZlciIsIlJlYWRhYmxlU3RyZWFtIiwiZ2V0UmVhZGVyIiwidGV4dCIsIlVpbnQ4QXJyYXkiLCJzZXRSZXF1ZXN0SGVhZGVyIiwiYXBwZW5kIiwiZ2V0QWxsUmVzcG9uc2VIZWFkZXJzIiwia2QiLCJsZCIsIm1kIiwibmQiLCJvZCIsInJkIiwic2QiLCJ0ZCIsInBkIiwibW96UmVzcG9uc2VBcnJheUJ1ZmZlciIsInVkIiwidmQiLCJ3ZCIsImludGVybmFsQ2hhbm5lbFBhcmFtcyIsInhkIiwiWmEiLCJ4bWxIdHRwRmFjdG9yeSIsInN1cHBvcnRzQ3Jvc3NEb21haW5YaHIiLCJjb25jdXJyZW50UmVxdWVzdExpbWl0IiwiZmFzdEhhbmRzaGFrZSIsImVuY29kZUluaXRNZXNzYWdlSGVhZGVycyIsImZvcmNlTG9uZ1BvbGxpbmciLCJkZXRlY3RCdWZmZXJpbmdQcm94eSIsInlkIiwiemQiLCJzZW5kQmVhY29uIiwiSW1hZ2UiLCJBZCIsIkVkIiwiRGQiLCJyb3VuZCIsIkNkIiwiRmQiLCJCZCIsImNkIiwiS2EiLCJHZCIsIkhkIiwibWVzc2FnZVVybFBhcmFtcyIsIm1lc3NhZ2VIZWFkZXJzIiwiY2xpZW50UHJvdG9jb2xIZWFkZXJSZXF1aXJlZCIsImluaXRNZXNzYWdlSGVhZGVycyIsIm1lc3NhZ2VDb250ZW50VHlwZSIsInNlbmRSYXdKc29uIiwiaHR0cFNlc3Npb25JZFBhcmFtIiwiSWQiLCJfX3NtX18iLCJKZCIsInRvVXBwZXJDYXNlIiwiZ2V0UHJvdG90eXBlT2YiLCJGb3JtRGF0YSIsIndpdGhDcmVkZW50aWFscyIsInFkIiwiX19kYXRhX18iLCJjcmVhdGVXZWJDaGFubmVsIiwiSFRUUF9FUlJPUiIsIkNPTVBMRVRFIiwiRXZlbnRUeXBlIiwiQ0xPU0UiLCJNRVNTQUdFIiwibGlzdGVuIiwibGlzdGVuT25jZSIsImdldExhc3RFcnJvciIsImdldExhc3RFcnJvckNvZGUiLCJnZXRTdGF0dXMiLCJnZXRSZXNwb25zZUpzb24iLCJnZXRSZXNwb25zZVRleHQiLCJzZXRXaXRoQ3JlZGVudGlhbHMiLCJjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0IiwiZ2V0U3RhdEV2ZW50VGFyZ2V0IiwiRXJyb3JDb2RlIiwiRXZlbnQiLCJTdGF0IiwiUFJPWFkiLCJOT1BST1hZIiwib2IiLCJGZXRjaFhtbEh0dHBGYWN0b3J5IiwiV2ViQ2hhbm5lbCIsIlhocklvIiwiaXNBdXRoZW50aWNhdGVkIiwidG9LZXkiLCJpc0VxdWFsIiwiVU5BVVRIRU5USUNBVEVEIiwiR09PR0xFX0NSRURFTlRJQUxTIiwiRklSU1RfUEFSVFkiLCJNT0NLX1VTRVIiLCJpbnZhbGlkYXRlVG9rZW4iLCJlbnF1ZXVlUmV0cnlhYmxlIiwic2h1dGRvd24iLCJnZXRBdXRoSGVhZGVyVmFsdWVGb3JGaXJzdFBhcnR5IiwiYXBwQ2hlY2siLCJhZGRUb2tlbkxpc3RlbmVyIiwicmVtb3ZlVG9rZW5MaXN0ZW5lciIsImNyeXB0byIsIm1zQ3J5cHRvIiwiZ2V0UmFuZG9tVmFsdWVzIiwiaXQiLCJzZWdtZW50cyIsIm9mZnNldCIsImxlbiIsImNvbXBhcmF0b3IiLCJjaGlsZCIsImxpbWl0IiwiY29uc3RydWN0IiwicG9wRmlyc3QiLCJwb3BMYXN0IiwiZmlyc3RTZWdtZW50IiwibGFzdFNlZ21lbnQiLCJpc1ByZWZpeE9mIiwiaXNJbW1lZGlhdGVQYXJlbnRPZiIsInRvQXJyYXkiLCJydCIsImNhbm9uaWNhbFN0cmluZyIsImN0IiwiZnJvbVN0cmluZyIsImVtcHR5UGF0aCIsImNvbGxlY3Rpb25Hcm91cCIsImhhc0NvbGxlY3Rpb25JZCIsImdldENvbGxlY3Rpb25Hcm91cCIsImdldENvbGxlY3Rpb25QYXRoIiwiVnQiLCJNdCIsImRhdGFiYXNlSWQiLCJwZXJzaXN0ZW5jZUtleSIsInNzbCIsImF1dG9EZXRlY3RMb25nUG9sbGluZyIsInVzZUZldGNoU3RyZWFtcyIsIkZ0IiwicHJvamVjdElkIiwiZGF0YWJhc2UiLCJpc0RlZmF1bHREYXRhYmFzZSIsIlF0IiwiYmluYXJ5U3RyaW5nIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJ0b0Jhc2U2NCIsInRvVWludDhBcnJheSIsImFwcHJveGltYXRlQnl0ZVNpemUiLCJjb21wYXJlVG8iLCJ6dCIsIkVNUFRZX0JZVEVfU1RSSU5HIiwiR2UiLCJyb290IiwiamUiLCJFTVBUWSIsImNvcHkiLCJCTEFDSyIsInJpZ2h0IiwibWluS2V5IiwibWF4S2V5IiwiaW5vcmRlclRyYXZlcnNhbCIsInJldmVyc2VUcmF2ZXJzYWwiLCJnZXRJdGVyYXRvciIsIlFlIiwiZ2V0SXRlcmF0b3JGcm9tIiwiZ2V0UmV2ZXJzZUl0ZXJhdG9yIiwiZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbSIsImlzUmV2ZXJzZSIsIm5vZGVTdGFjayIsImdldE5leHQiLCJoYXNOZXh0IiwicGVlayIsIlJFRCIsImZpeFVwIiwicmVtb3ZlTWluIiwiaXNSZWQiLCJtb3ZlUmVkTGVmdCIsInJvdGF0ZVJpZ2h0IiwibW92ZVJlZFJpZ2h0Iiwicm90YXRlTGVmdCIsImNvbG9yRmxpcCIsImNoZWNrTWF4RGVwdGgiLCJjaGVjayIsInBvdyIsIldlIiwiZmlyc3QiLCJsYXN0IiwiZm9yRWFjaEluUmFuZ2UiLCJmb3JFYWNoV2hpbGUiLCJmaXJzdEFmdGVyT3JFcXVhbCIsInplIiwidW5pb25XaXRoIiwiaXRlciIsInVzIiwiY3MiLCJPSyIsIkNBTkNFTExFRCIsIlVOS05PV04iLCJJTlZBTElEX0FSR1VNRU5UIiwiREVBRExJTkVfRVhDRUVERUQiLCJOT1RfRk9VTkQiLCJBTFJFQURZX0VYSVNUUyIsIlBFUk1JU1NJT05fREVOSUVEIiwiUkVTT1VSQ0VfRVhIQVVTVEVEIiwiRkFJTEVEX1BSRUNPTkRJVElPTiIsIkFCT1JURUQiLCJPVVRfT0ZfUkFOR0UiLCJVTklNUExFTUVOVEVEIiwiVU5BVkFJTEFCTEUiLCJEQVRBX0xPU1MiLCJkciIsInVlIiwiY2UiLCJhZSIsImhlIiwibGUiLCJib29sZWFuVmFsdWUiLCJpbnRlZ2VyVmFsdWUiLCJkb3VibGVWYWx1ZSIsIlV0IiwidGltZXN0YW1wVmFsdWUiLCJmZSIsIm5hbm9zIiwiZGUiLCJzdHJpbmdWYWx1ZSIsIndlIiwiZnJvbUJhc2U2NFN0cmluZyIsImZyb21VaW50OEFycmF5IiwiSHQiLCJieXRlc1ZhbHVlIiwibWUiLCJyZWZlcmVuY2VWYWx1ZSIsImdlb1BvaW50VmFsdWUiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsIm1hcFZhbHVlIiwiZmllbGRzIiwiX190eXBlX18iLCJNQVhfU0FGRV9JTlRFR0VSIiwiZ2UiLCJ5ZSIsImFycmF5VmFsdWUiLCJwZSIsImZyb21OYW1lIiwiSWUiLCJLciIsImNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQiLCJwZXJjZW50aWxlVG9Db2xsZWN0IiwibWF4aW11bVNlcXVlbmNlTnVtYmVyc1RvQ29sbGVjdCIsIkRFRkFVTFRfQ09MTEVDVElPTl9QRVJDRU5USUxFIiwiREVGQVVMVF9NQVhfU0VRVUVOQ0VfTlVNQkVSU19UT19DT0xMRUNUIiwieXUiLCJERUZBVUxUIiwiRElTQUJMRUQiLCJJdSIsIkhzIiwibW8iLCJ5byIsInBvIiwiSW8iLCJUbyIsIkVvIiwiQW8iLCJSbyIsImJvIiwiZW5xdWV1ZUFmdGVyRGVsYXkiLCJQbyIsInNraXBEZWxheSIsImFzeW5jUXVldWUiLCJ0YXJnZXRUaW1lTXMiLCJyZW1vdmFsQ2FsbGJhY2siLCJ0aW1lckhhbmRsZSIsImhhbmRsZURlbGF5RWxhcHNlZCIsImVucXVldWVBbmRGb3JnZXQiLCJpZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzIiwiY2FjaGVTaXplQnl0ZXMiLCJleHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nIiwiZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nIiwiX2F1dGhDcmVkZW50aWFscyIsIl9hcHBDaGVja0NyZWRlbnRpYWxzIiwiX2RhdGFiYXNlSWQiLCJfYXBwIiwiX3BlcnNpc3RlbmNlS2V5IiwiX3NldHRpbmdzIiwiX3NldHRpbmdzRnJvemVuIiwiX2luaXRpYWxpemVkIiwiX3Rlcm1pbmF0ZWQiLCJfdGVybWluYXRlVGFzayIsIl9zZXRTZXR0aW5ncyIsImNsaWVudCIsInNlc3Npb25JbmRleCIsImlhbVRva2VuIiwiYXV0aFRva2VuRmFjdG9yeSIsIl9nZXRTZXR0aW5ncyIsIl9mcmVlemVTZXR0aW5ncyIsIl90ZXJtaW5hdGUiLCJ0ZXJtaW5hdGUiLCJhdXRoQ3JlZGVudGlhbHMiLCJhcHBDaGVja0NyZWRlbnRpYWxzIiwiZGF0YWJhc2VJbmZvIiwiY2xpZW50SWQiLCJhdXRoQ3JlZGVudGlhbExpc3RlbmVyIiwiYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIiLCJpbml0aWFsVXNlciIsIm1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zIiwic2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyIiwic2V0QXBwQ2hlY2tUb2tlbkNoYW5nZUxpc3RlbmVyIiwidmVyaWZ5Tm90VGVybWluYXRlZCIsImlzU2h1dHRpbmdEb3duIiwiZW50ZXJSZXN0cmljdGVkTW9kZSIsImVucXVldWVBbmRGb3JnZXRFdmVuV2hpbGVSZXN0cmljdGVkIiwib25saW5lQ29tcG9uZW50cyIsIm9mZmxpbmVDb21wb25lbnRzIiwidGgiLCJ4byIsInZpc2liaWxpdHlTdGF0ZSIsImVucXVldWUiLCJzdGFjayIsImNyZWF0ZUFuZFNjaGVkdWxlIiwidmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcyIsImloIiwiX3F1ZXVlIiwiX2ZpcmVzdG9yZUNsaWVudCIsImNoIiwiREVGQVVMVF9IT1NUIiwiU3RvcmFnZUVycm9yIiwic3RhdHVzXyIsInByZXBlbmRDb2RlIiwiX2Jhc2VNZXNzYWdlIiwiX2NvZGVFcXVhbHMiLCJpbnZhbGlkQXJndW1lbnQiLCJhcHBEZWxldGVkIiwiTG9jYXRpb24iLCJidWNrZXQiLCJwYXRoXyIsImlzUm9vdCIsImZ1bGxTZXJ2ZXJVcmwiLCJlbmNvZGUiLCJidWNrZXRPbmx5U2VydmVyVXJsIiwiYnVja2V0U3RyaW5nIiwiYnVja2V0TG9jYXRpb24iLCJtYWtlRnJvbVVybCIsImJ1Y2tldERvbWFpbiIsImdzUmVnZXgiLCJodHRwTW9kaWZ5IiwibG9jIiwiZmlyZWJhc2VTdG9yYWdlSG9zdCIsImdyb3VwcyIsInJlZ2V4IiwiaW5kaWNlcyIsInBvc3RNb2RpZnkiLCJncm91cCIsImNhcHR1cmVzIiwiYnVja2V0VmFsdWUiLCJwYXRoVmFsdWUiLCJpbnZhbGlkVXJsIiwiRmFpbFJlcXVlc3QiLCJwcm9taXNlXyIsImdldFByb21pc2UiLCJfYXBwRGVsZXRlIiwidmFsaWRhdGVOdW1iZXIiLCJhcmd1bWVudCIsIm1pblZhbHVlIiwibWF4VmFsdWUiLCJOZXR3b3JrUmVxdWVzdCIsInVybF8iLCJtZXRob2RfIiwiaGVhZGVyc18iLCJib2R5XyIsInN1Y2Nlc3NDb2Rlc18iLCJhZGRpdGlvbmFsUmV0cnlDb2Rlc18iLCJjYWxsYmFja18iLCJlcnJvckNhbGxiYWNrXyIsInRpbWVvdXRfIiwicHJvZ3Jlc3NDYWxsYmFja18iLCJjb25uZWN0aW9uRmFjdG9yeV8iLCJyZXRyeSIsInBlbmRpbmdDb25uZWN0aW9uXyIsImJhY2tvZmZJZF8iLCJjYW5jZWxlZF8iLCJhcHBEZWxldGVfIiwicmVzb2x2ZV8iLCJyZWplY3RfIiwic3RhcnRfIiwiYmFja29mZkRvbmUiLCJyZXF1ZXN0V2VudFRocm91Z2giLCJjb25uZWN0aW9uIiwid2FzU3VjY2Vzc0NvZGUiLCJnZXRSZXNwb25zZSIsImlzSnVzdERlZiIsImdldEVycm9yVGV4dCIsImNhbmNlbGVkIiwiUmVxdWVzdEVuZFN0YXR1cyIsImRvUmVxdWVzdCIsImJhY2tvZmZDb21wbGV0ZUNiIiwid2FpdFNlY29uZHMiLCJyZXRyeVRpbWVvdXRJZCIsImdsb2JhbFRpbWVvdXRJZCIsImhpdFRpbWVvdXQiLCJjYW5jZWxTdGF0ZSIsInRyaWdnZXJlZENhbGxiYWNrIiwidHJpZ2dlckNhbGxiYWNrIiwiY2FsbFdpdGhEZWxheSIsIm1pbGxpcyIsInJlc3BvbnNlSGFuZGxlciIsImNsZWFyR2xvYmFsVGltZW91dCIsIndhaXRNaWxsaXMiLCJzdG9wcGVkIiwic3RvcCIsIndhc1RpbWVvdXQiLCJiYWNrb2ZmQ2FsbGJhY2siLCJwcm9ncmVzc0xpc3RlbmVyIiwicHJvZ3Jlc3NFdmVudCIsImxvYWRlZCIsInRvdGFsIiwibGVuZ3RoQ29tcHV0YWJsZSIsImFkZFVwbG9hZFByb2dyZXNzTGlzdGVuZXIiLCJyZW1vdmVVcGxvYWRQcm9ncmVzc0xpc3RlbmVyIiwiaGl0U2VydmVyIiwiZ2V0RXJyb3JDb2RlIiwiYWRkaXRpb25hbFJldHJ5Q29kZXMiLCJpc0ZpdmVIdW5kcmVkQ29kZSIsImlzRXh0cmFSZXRyeUNvZGUiLCJpc0FkZGl0aW9uYWxSZXRyeUNvZGUiLCJpc1JldHJ5U3RhdHVzQ29kZSIsIndhc0NhbmNlbGVkIiwiQUJPUlQiLCJzdWNjZXNzQ29kZSIsImFwcERlbGV0ZSIsIlJlZmVyZW5jZSIsIl9zZXJ2aWNlIiwiX2xvY2F0aW9uIiwiX25ld1JlZiIsImZ1bGxQYXRoIiwibGFzdEluZGV4T2YiLCJsYXN0Q29tcG9uZW50IiwicGFyZW50IiwibmV3UGF0aCIsIl90aHJvd0lmUm9vdCIsImludmFsaWRSb290T3BlcmF0aW9uIiwiZXh0cmFjdEJ1Y2tldCIsIm1ha2VGcm9tQnVja2V0U3BlYyIsIkZpcmViYXNlU3RvcmFnZUltcGwiLCJfYXV0aFByb3ZpZGVyIiwiX2FwcENoZWNrUHJvdmlkZXIiLCJfdXJsIiwiX2ZpcmViYXNlVmVyc2lvbiIsIl9idWNrZXQiLCJfaG9zdCIsIl9wcm90b2NvbCIsIl9hcHBJZCIsIl9tYXhPcGVyYXRpb25SZXRyeVRpbWUiLCJfbWF4VXBsb2FkUmV0cnlUaW1lIiwiX3JlcXVlc3RzIiwibWF4VXBsb2FkUmV0cnlUaW1lIiwidGltZSIsIlBPU0lUSVZFX0lORklOSVRZIiwibWF4T3BlcmF0aW9uUmV0cnlUaW1lIiwiX292ZXJyaWRlQXV0aFRva2VuIiwidG9rZW5EYXRhIiwiX21ha2VTdG9yYWdlUmVmZXJlbmNlIiwiX21ha2VSZXF1ZXN0IiwicmVxdWVzdEluZm8iLCJyZXF1ZXN0RmFjdG9yeSIsImF1dGhUb2tlbiIsImFwcENoZWNrVG9rZW4iLCJmaXJlYmFzZVZlcnNpb24iLCJxdWVyeVBhcnQiLCJtYWtlUXVlcnlTdHJpbmciLCJ1cmxQYXJhbXMiLCJhZGRHbXBpZEhlYWRlcl8iLCJhZGRBdXRoSGVhZGVyXyIsImFkZFZlcnNpb25IZWFkZXJfIiwiYWRkQXBwQ2hlY2tIZWFkZXJfIiwic3VjY2Vzc0NvZGVzIiwiZXJyb3JIYW5kbGVyIiwicHJvZ3Jlc3NDYWxsYmFjayIsIm1ha2VSZXF1ZXN0IiwiX2dldEF1dGhUb2tlbiIsIl9nZXRBcHBDaGVja1Rva2VuIiwiYXV0aFByb3ZpZGVyIiwiYXBwQ2hlY2tQcm92aWRlciIsIlBBQ0tBR0VfVkVSU0lPTiIsIklOVEVSTkFMX0FVVEhfVkVSU0lPTiIsImlzU2VydmVyRXJyb3IiLCJnZXRJbnN0YWxsYXRpb25zRW5kcG9pbnQiLCJleHRyYWN0QXV0aFRva2VuSW5mb0Zyb21SZXNwb25zZSIsInJlcXVlc3RTdGF0dXMiLCJyZXNwb25zZUV4cGlyZXNJbiIsImdldEVycm9yRnJvbVJlc3BvbnNlIiwicmVxdWVzdE5hbWUiLCJlcnJvckRhdGEiLCJzZXJ2ZXJDb2RlIiwic2VydmVyTWVzc2FnZSIsInNlcnZlclN0YXR1cyIsImdldEhlYWRlcnMiLCJBY2NlcHQiLCJyZXRyeUlmU2VydmVyRXJyb3IiLCJzbGVlcCIsIm1zIiwiVkFMSURfRklEX1BBVFRFUk4iLCJnZW5lcmF0ZUZpZCIsImZpZEJ5dGVBcnJheSIsImZpZCIsImFycmF5IiwiZ2V0S2V5IiwiYXBwQ29uZmlnIiwiZmlkQ2hhbmdlQ2FsbGJhY2tzIiwiZmlkQ2hhbmdlZCIsImNhbGxGaWRDaGFuZ2VDYWxsYmFja3MiLCJjaGFubmVsIiwiYnJvYWRjYXN0Q2hhbm5lbCIsIkJyb2FkY2FzdENoYW5uZWwiLCJvbm1lc3NhZ2UiLCJicm9hZGNhc3RGaWRDaGFuZ2UiLCJPQkpFQ1RfU1RPUkVfTkFNRSIsInVwZGF0ZUZuIiwiZ2V0SW5zdGFsbGF0aW9uRW50cnkiLCJpbnN0YWxsYXRpb25zIiwicmVnaXN0cmF0aW9uUHJvbWlzZSIsImluc3RhbGxhdGlvbkVudHJ5Iiwib2xkRW50cnkiLCJjbGVhclRpbWVkT3V0UmVxdWVzdCIsInJlZ2lzdHJhdGlvblN0YXR1cyIsInVwZGF0ZU9yQ3JlYXRlSW5zdGFsbGF0aW9uRW50cnkiLCJlbnRyeVdpdGhQcm9taXNlIiwiaW5Qcm9ncmVzc0VudHJ5IiwicmVnaXN0cmF0aW9uVGltZSIsInJlZ2lzdGVyZWRJbnN0YWxsYXRpb25FbnRyeSIsImVuZHBvaW50IiwiaGVhcnRiZWF0U2VydmljZSIsImF1dGhWZXJzaW9uIiwic2RrVmVyc2lvbiIsInJlc3BvbnNlVmFsdWUiLCJjcmVhdGVJbnN0YWxsYXRpb25SZXF1ZXN0IiwicmVnaXN0ZXJJbnN0YWxsYXRpb24iLCJ3YWl0VW50aWxGaWRSZWdpc3RyYXRpb24iLCJ0cmlnZ2VyUmVnaXN0cmF0aW9uSWZOZWNlc3NhcnkiLCJlbnRyeSIsInVwZGF0ZUluc3RhbGxhdGlvblJlcXVlc3QiLCJnZW5lcmF0ZUF1dGhUb2tlblJlcXVlc3QiLCJnZXRHZW5lcmF0ZUF1dGhUb2tlbkVuZHBvaW50IiwiZ2V0QXV0aG9yaXphdGlvbkhlYWRlciIsImdldEhlYWRlcnNXaXRoQXV0aCIsImluc3RhbGxhdGlvbiIsInJlZnJlc2hBdXRoVG9rZW4iLCJ0b2tlblByb21pc2UiLCJpc0VudHJ5UmVnaXN0ZXJlZCIsIm9sZEF1dGhUb2tlbiIsImlzQXV0aFRva2VuRXhwaXJlZCIsInVwZGF0ZUF1dGhUb2tlblJlcXVlc3QiLCJ3YWl0VW50aWxBdXRoVG9rZW5SZXF1ZXN0IiwiaW5Qcm9ncmVzc0F1dGhUb2tlbiIsInJlcXVlc3RUaW1lIiwibWFrZUF1dGhUb2tlblJlcXVlc3RJblByb2dyZXNzRW50cnkiLCJ1cGRhdGVkSW5zdGFsbGF0aW9uRW50cnkiLCJmZXRjaEF1dGhUb2tlbkZyb21TZXJ2ZXIiLCJnZXRNaXNzaW5nVmFsdWVFcnJvciIsInZhbHVlTmFtZSIsIklOU1RBTExBVElPTlNfTkFNRSIsImNvbmZpZ0tleXMiLCJrZXlOYW1lIiwiZXh0cmFjdEFwcENvbmZpZyIsImdldElkIiwiaW5zdGFsbGF0aW9uc0ltcGwiLCJjb21wbGV0ZUluc3RhbGxhdGlvblJlZ2lzdHJhdGlvbiIsIkRFRkFVTFRfVkFQSURfS0VZIiwiQ09OU09MRV9DQU1QQUlHTl9JRCIsIk1lc3NhZ2VUeXBlJDEiLCJNZXNzYWdlVHlwZSIsImFycmF5VG9CYXNlNjQiLCJ1aW50OEFycmF5IiwiYmFzZTY0VG9BcnJheSIsImJhc2U2NFN0cmluZyIsInJlcGVhdCIsInJhd0RhdGEiLCJvdXRwdXRBcnJheSIsIk9MRF9EQl9OQU1FIiwiT0xEX09CSkVDVF9TVE9SRV9OQU1FIiwidXBncmFkZURiIiwiZGJHZXQiLCJmaXJlYmFzZURlcGVuZGVuY2llcyIsInRva2VuRGV0YWlscyIsIm9sZFRva2VuRGV0YWlscyIsInNlbmRlcklkIiwiZGJOYW1lcyIsImRhdGFiYXNlcyIsInVwZ3JhZGVUcmFuc2FjdGlvbiIsIm9sZERldGFpbHMiLCJwMjU2ZGgiLCJmY21Ub2tlbiIsImNyZWF0ZVRpbWUiLCJzdWJzY3JpcHRpb25PcHRpb25zIiwic3dTY29wZSIsInZhcGlkS2V5IiwiY2hlY2tUb2tlbkRldGFpbHMiLCJtaWdyYXRlT2xkRGF0YWJhc2UiLCJkYlNldCIsInJlcXVlc3REZWxldGVUb2tlbiIsInVuc3Vic2NyaWJlT3B0aW9ucyIsImdldEVuZHBvaW50IiwicmVzcG9uc2VEYXRhIiwiZXJyb3JJbmZvIiwiZ2V0Qm9keSIsIndlYiIsImFwcGxpY2F0aW9uUHViS2V5IiwiZ2V0VG9rZW5JbnRlcm5hbCIsIm1lc3NhZ2luZyIsInB1c2hTdWJzY3JpcHRpb24iLCJzd1JlZ2lzdHJhdGlvbiIsInB1c2hNYW5hZ2VyIiwiZ2V0U3Vic2NyaXB0aW9uIiwidXNlclZpc2libGVPbmx5IiwiYXBwbGljYXRpb25TZXJ2ZXJLZXkiLCJnZXRQdXNoU3Vic2NyaXB0aW9uIiwiZGJPcHRpb25zIiwiY3VycmVudE9wdGlvbnMiLCJpc1ZhcGlkS2V5RXF1YWwiLCJpc0VuZHBvaW50RXF1YWwiLCJpc0F1dGhFcXVhbCIsImlzUDI1NmRoRXF1YWwiLCJpc1Rva2VuVmFsaWQiLCJ1cGRhdGVkVG9rZW4iLCJ1cGRhdGVPcHRpb25zIiwicmVxdWVzdFVwZGF0ZVRva2VuIiwidXBkYXRlZFRva2VuRGV0YWlscyIsImRiUmVtb3ZlIiwiZGVsZXRlVG9rZW5JbnRlcm5hbCIsInVwZGF0ZVRva2VuIiwiZ2V0TmV3VG9rZW4iLCJzdWJzY3JpYmVPcHRpb25zIiwicmVxdWVzdEdldFRva2VuIiwiZXh0ZXJuYWxpemVQYXlsb2FkIiwiaW50ZXJuYWxQYXlsb2FkIiwiY29sbGFwc2VLZXkiLCJjb2xsYXBzZV9rZXkiLCJtZXNzYWdlSWQiLCJmY21NZXNzYWdlSWQiLCJtZXNzYWdlUGF5bG9hZEludGVybmFsIiwibm90aWZpY2F0aW9uIiwidGl0bGUiLCJpbWFnZSIsImljb24iLCJwcm9wYWdhdGVOb3RpZmljYXRpb25QYXlsb2FkIiwicHJvcGFnYXRlRGF0YVBheWxvYWQiLCJmY21PcHRpb25zIiwiY2xpY2tfYWN0aW9uIiwiYW5hbHl0aWNzTGFiZWwiLCJhbmFseXRpY3NfbGFiZWwiLCJwcm9wYWdhdGVGY21PcHRpb25zIiwiX21lcmdlU3RyaW5ncyIsInMxIiwiczIiLCJyZXN1bHRBcnJheSIsIk1lc3NhZ2luZ1NlcnZpY2UiLCJhbmFseXRpY3NQcm92aWRlciIsImRlbGl2ZXJ5TWV0cmljc0V4cG9ydGVkVG9CaWdRdWVyeUVuYWJsZWQiLCJvbkJhY2tncm91bmRNZXNzYWdlSGFuZGxlciIsIm9uTWVzc2FnZUhhbmRsZXIiLCJsb2dFdmVudHMiLCJpc0xvZ1NlcnZpY2VTdGFydGVkIiwibWVzc2FnaW5nU2VuZGVySWQiLCJnZXRUb2tlbiQxIiwiTm90aWZpY2F0aW9uIiwicGVybWlzc2lvbiIsInJlcXVlc3RQZXJtaXNzaW9uIiwidXBkYXRlVmFwaWRLZXkiLCJicm93c2VyRXJyb3JNZXNzYWdlIiwicmVnaXN0ZXJEZWZhdWx0U3ciLCJTZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uIiwidXBkYXRlU3dSZWciLCJzZXJ2aWNlV29ya2VyUmVnaXN0cmF0aW9uIiwibWVzc2FnZUV2ZW50TGlzdGVuZXIiLCJpc0ZpcmViYXNlTWVzc2FnaW5nIiwibWVzc2FnZVR5cGUiLCJQVVNIX1JFQ0VJVkVEIiwiZGF0YVBheWxvYWQiLCJOT1RJRklDQVRJT05fQ0xJQ0tFRCIsImdldEV2ZW50VHlwZSIsImxvZ0V2ZW50IiwibWVzc2FnZV9pZCIsIm1lc3NhZ2VfbmFtZSIsIm1lc3NhZ2VfdGltZSIsIm1lc3NhZ2VfZGV2aWNlX3RpbWUiLCJsb2dUb1NjaW9uIiwibWVzc2FnaW5nSW50ZXJuYWwiLCJUUkFDRV9NRUFTVVJFX1BSRUZJWCIsIk9PQl9UUkFDRV9QQUdFX0xPQURfUFJFRklYIiwiRklSU1RfQ09OVEVOVEZVTF9QQUlOVF9DT1VOVEVSX05BTUUiLCJGSVJTVF9JTlBVVF9ERUxBWV9DT1VOVEVSX05BTUUiLCJDT05GSUdfTE9DQUxfU1RPUkFHRV9LRVkiLCJDT05GSUdfRVhQSVJZX0xPQ0FMX1NUT1JBR0VfS0VZIiwiY29uc29sZUxvZ2dlciIsImFwaUluc3RhbmNlIiwid2luZG93SW5zdGFuY2UiLCJpaWQiLCJzZXR0aW5nc1NlcnZpY2VJbnN0YW5jZSIsIkFwaSIsIlBlcmZvcm1hbmNlT2JzZXJ2ZXIiLCJ3aW5kb3dMb2NhdGlvbiIsImNvb2tpZUVuYWJsZWQiLCJwZXJmTWV0cmljcyIsIm9uRmlyc3RJbnB1dERlbGF5IiwiZ2V0VXJsIiwibWFyayIsIm1lYXN1cmUiLCJtZWFzdXJlTmFtZSIsIm1hcmsxIiwibWFyazIiLCJnZXRFbnRyaWVzQnlOYW1lIiwiZ2V0VGltZU9yaWdpbiIsInRpbWVPcmlnaW4iLCJ0aW1pbmciLCJuYXZpZ2F0aW9uU3RhcnQiLCJyZXF1aXJlZEFwaXNBdmFpbGFibGUiLCJzZXR1cE9ic2VydmVyIiwiZW50cnlUeXBlIiwiZ2V0RW50cmllcyIsIm9ic2VydmUiLCJlbnRyeVR5cGVzIiwiZ2V0SWlkIiwibWVyZ2VTdHJpbmdzIiwicGFydDEiLCJwYXJ0MiIsInNpemVEaWZmIiwiU2V0dGluZ3NTZXJ2aWNlIiwiaW5zdHJ1bWVudGF0aW9uRW5hYmxlZCIsImRhdGFDb2xsZWN0aW9uRW5hYmxlZCIsImxvZ2dpbmdFbmFibGVkIiwidHJhY2VzU2FtcGxpbmdSYXRlIiwibmV0d29ya1JlcXVlc3RzU2FtcGxpbmdSYXRlIiwibG9nRW5kUG9pbnRVcmwiLCJmbFRyYW5zcG9ydEVuZHBvaW50VXJsIiwidHJhbnNwb3J0S2V5IiwibG9nU291cmNlIiwibG9nVHJhY2VBZnRlclNhbXBsaW5nIiwibG9nTmV0d29ya0FmdGVyU2FtcGxpbmciLCJjb25maWdUaW1lVG9MaXZlIiwiZ2V0RmxUcmFuc3BvcnRGdWxsVXJsIiwiVmlzaWJpbGl0eVN0YXRlIiwiUkVTRVJWRURfQVRUUklCVVRFX1BSRUZJWEVTIiwiQVRUUklCVVRFX0ZPUk1BVF9SRUdFWCIsImdldFNlcnZpY2VXb3JrZXJTdGF0dXMiLCJnZXRJbnN0YW5jZSIsImdldFZpc2liaWxpdHlTdGF0ZSIsIlZJU0lCTEUiLCJISURERU4iLCJnZXRFZmZlY3RpdmVDb25uZWN0aW9uVHlwZSIsIm5hdmlnYXRvckNvbm5lY3Rpb24iLCJlZmZlY3RpdmVUeXBlIiwiZ2V0QXBwSWQiLCJmaXJlYmFzZUFwcCIsIkRFRkFVTFRfQ09ORklHUyIsIkNPVUxEX05PVF9HRVRfQ09ORklHX01TRyIsInByb2Nlc3NDb25maWciLCJmcHJfZW5hYmxlZCIsImZwcl9sb2dfc291cmNlIiwiZnByX2xvZ19lbmRwb2ludF91cmwiLCJmcHJfbG9nX3RyYW5zcG9ydF9rZXkiLCJmcHJfdmNfbmV0d29ya19yZXF1ZXN0X3NhbXBsaW5nX3JhdGUiLCJmcHJfdmNfdHJhY2Vfc2FtcGxpbmdfcmF0ZSIsInNob3VsZExvZ0FmdGVyU2FtcGxpbmciLCJzYW1wbGluZ1JhdGUiLCJpbml0aWFsaXphdGlvblByb21pc2UiLCJpbml0aWFsaXphdGlvblN0YXR1cyIsImdldEluaXRpYWxpemF0aW9uUHJvbWlzZSIsInBlcmZvcm1hbmNlQ29udHJvbGxlciIsImdldERvY3VtZW50UmVhZHlDb21wbGV0ZSIsImluc3RhbGxhdGlvbnNTZXJ2aWNlIiwiaWlkUHJvbWlzZSIsImlpZFZhbCIsImdldElpZFByb21pc2UiLCJleHBpcnlTdHJpbmciLCJleHBpcnkiLCJjb25maWdTdHJpbmdpZmllZCIsImdldFN0b3JlZENvbmZpZyIsImF1dGhUb2tlblByb21pc2UiLCJhdXRoVG9rZW5WYWwiLCJnZXRBdXRoVG9rZW5Qcm9taXNlIiwiZ2V0UHJvamVjdElkIiwiZ2V0QXBpS2V5IiwiQXV0aG9yaXphdGlvbiIsImFwcF9pbnN0YW5jZV9pZCIsImFwcF9pbnN0YW5jZV9pZF90b2tlbiIsImFwcF9pZCIsImFwcF92ZXJzaW9uIiwic2RrX3ZlcnNpb24iLCJnZXRSZW1vdGVDb25maWciLCJzdG9yZUNvbmZpZyIsImdldENvbmZpZyIsImNoYW5nZUluaXRpYWxpemF0aW9uU3RhdHVzIiwiaW5pdGlhbGl6ZVBlcmYiLCJERUZBVUxUX1NFTkRfSU5URVJWQUxfTVMiLCJyZW1haW5pbmdUcmllcyIsImlzVHJhbnNwb3J0U2V0dXAiLCJwcm9jZXNzUXVldWUiLCJ0aW1lT2Zmc2V0Iiwic3RhZ2VkIiwibG9nX2V2ZW50IiwiZXZ0Iiwic291cmNlX2V4dGVuc2lvbl9qc29uX3Byb3RvMyIsImV2ZW50X3RpbWVfbXMiLCJldmVudFRpbWUiLCJmbFRyYW5zcG9ydEZ1bGxVcmwiLCJwb3N0VG9GbEVuZHBvaW50IiwicmVzIiwidHJhbnNwb3J0V2FpdCIsIm5leHRSZXF1ZXN0V2FpdE1pbGxpcyIsInJlcXVlc3RPZmZzZXQiLCJsb2dSZXNwb25zZURldGFpbHMiLCJyZXNwb25zZUFjdGlvbiIsInNlbmRFdmVudHNUb0ZsIiwicmVxdWVzdF90aW1lX21zIiwiY2xpZW50X2luZm8iLCJjbGllbnRfdHlwZSIsImpzX2NsaWVudF9pbmZvIiwibG9nX3NvdXJjZSIsImRpc3BhdGNoUXVldWVFdmVudHMiLCJzZW5kTG9nIiwicmVzb3VyY2UiLCJyZXNvdXJjZVR5cGUiLCJzZXJpYWxpemVyIiwiYWRkVG9RdWV1ZSIsInRyYW5zcG9ydEhhbmRsZXIiLCJsb2dUcmFjZSIsInRyYWNlIiwic2V0dGluZ3NTZXJ2aWNlIiwiaXNBdXRvIiwic2VuZFRyYWNlTG9nIiwibmV0d29ya1JlcXVlc3QiLCJuZXR3b3JrUmVxdWVzdE1ldHJpYyIsImh0dHBfbWV0aG9kIiwiaHR0cE1ldGhvZCIsImh0dHBfcmVzcG9uc2VfY29kZSIsInJlc3BvbnNlX3BheWxvYWRfYnl0ZXMiLCJyZXNwb25zZVBheWxvYWRCeXRlcyIsImNsaWVudF9zdGFydF90aW1lX3VzIiwic3RhcnRUaW1lVXMiLCJ0aW1lX3RvX3Jlc3BvbnNlX2luaXRpYXRlZF91cyIsInRpbWVUb1Jlc3BvbnNlSW5pdGlhdGVkVXMiLCJ0aW1lX3RvX3Jlc3BvbnNlX2NvbXBsZXRlZF91cyIsInRpbWVUb1Jlc3BvbnNlQ29tcGxldGVkVXMiLCJwZXJmTWV0cmljIiwiYXBwbGljYXRpb25faW5mbyIsImdldEFwcGxpY2F0aW9uSW5mbyIsIm5ldHdvcmtfcmVxdWVzdF9tZXRyaWMiLCJzZXJpYWxpemVOZXR3b3JrUmVxdWVzdCIsInRyYWNlTWV0cmljIiwiaXNfYXV0byIsImR1cmF0aW9uX3VzIiwiZHVyYXRpb25VcyIsImNvdW50ZXJzIiwiY3VzdG9tQXR0cmlidXRlcyIsImdldEF0dHJpYnV0ZXMiLCJjdXN0b21fYXR0cmlidXRlcyIsInRyYWNlX21ldHJpYyIsInNlcmlhbGl6ZVRyYWNlIiwiZ29vZ2xlX2FwcF9pZCIsIndlYl9hcHBfaW5mbyIsInBhZ2VfdXJsIiwic2VydmljZV93b3JrZXJfc3RhdHVzIiwidmlzaWJpbGl0eV9zdGF0ZSIsImVmZmVjdGl2ZV9jb25uZWN0aW9uX3R5cGUiLCJhcHBsaWNhdGlvbl9wcm9jZXNzX3N0YXRlIiwib29iTWV0cmljcyIsIlRyYWNlIiwidHJhY2VNZWFzdXJlTmFtZSIsInJhbmRvbUlkIiwidHJhY2VTdGFydE1hcmsiLCJ0cmFjZVN0b3BNYXJrIiwidHJhY2VNZWFzdXJlIiwiY2FsY3VsYXRlVHJhY2VNZXRyaWNzIiwidHJhY2VOYW1lIiwicmVjb3JkIiwic3RhcnRUaW1lIiwiZHVyYXRpb24iLCJtZXRyaWNzIiwibWV0cmljTmFtZSIsImluY3JlbWVudE1ldHJpYyIsImNvdW50ZXIiLCJudW1Bc0ludGVnZXIiLCJwdXRNZXRyaWMiLCJjdXN0b21NZXRyaWNOYW1lIiwicHJvdmlkZWRWYWx1ZSIsInZhbHVlQXNJbnRlZ2VyIiwiY29udmVydE1ldHJpY1ZhbHVlVG9JbnRlZ2VyIiwiZ2V0TWV0cmljIiwicHV0QXR0cmlidXRlIiwiYXR0ciIsImlzVmFsaWROYW1lIiwiaXNWYWxpZFZhbHVlIiwiaXNWYWxpZEN1c3RvbUF0dHJpYnV0ZVZhbHVlIiwiYXR0cmlidXRlTmFtZSIsImF0dHJpYnV0ZVZhbHVlIiwiZ2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwic2V0U3RhcnRUaW1lIiwic2V0RHVyYXRpb24iLCJwZXJmTWVhc3VyZUVudHJpZXMiLCJwZXJmTWVhc3VyZUVudHJ5IiwibmF2aWdhdGlvblRpbWluZ3MiLCJwYWludFRpbWluZ3MiLCJmaXJzdElucHV0RGVsYXkiLCJyb3V0ZSIsInRpbWVPcmlnaW5VcyIsImRvbUludGVyYWN0aXZlIiwiZG9tQ29udGVudExvYWRlZEV2ZW50RW5kIiwibG9hZEV2ZW50RW5kIiwiZmlyc3RQYWludCIsInBhaW50T2JqZWN0IiwiZmlyc3RDb250ZW50ZnVsUGFpbnQiLCJjcmVhdGVOZXR3b3JrUmVxdWVzdEVudHJ5IiwicGVyZm9ybWFuY2VFbnRyeSIsInJlc3BvbnNlU3RhcnQiLCJyZXNwb25zZUVuZCIsIm5ldHdvcmtSZXF1ZXN0VXJsIiwibG9nRW5kcG9pbnRVcmwiLCJmbEVuZHBvaW50VXJsIiwibG9nTmV0d29ya1JlcXVlc3QiLCJ0cmFuc2ZlclNpemUiLCJzZXR1cE9vYlJlc291cmNlcyIsInRpbWVvdXRJZCIsImNyZWF0ZU9vYlRyYWNlIiwic2V0dXBPb2JUcmFjZXMiLCJyZXNvdXJjZXMiLCJzZXR1cE5ldHdvcmtSZXF1ZXN0cyIsIm1lYXN1cmVzIiwiY3JlYXRlVXNlclRpbWluZ1RyYWNlIiwic2V0dXBVc2VyVGltaW5nVHJhY2VzIiwiUGVyZm9ybWFuY2VDb250cm9sbGVyIiwiaW5pdGlhbGl6ZWQiLCJfaW5pdCIsImlzQXZhaWxhYmxlIiwic2lnbkluR29vZ2xlIiwiX2Fzc2VydEluc3RhbmNlT2YiLCJyZXNvbHZlckludGVybmFsIiwic2lnbkluV2l0aFBvcHVwIiwiZXhlY3V0ZU5vdE51bGwiLCJzaWduSW5Bbm9uIiwic2lnblVwIiwic2lnbkluQW5vbnltb3VzbHkiLCJzZXR1cEFwaSIsInBlcmZJbnN0YW5jZSIsIkFwcEhhbmRsZXIiLCJwcm9qZWN0cyIsImdldFByb2plY3RzIiwiYWRkUHJvamVjdCIsInByb2plY3QiLCJkZWxldGVQcm9qZWN0IiwiZWRpdFByb2plY3QiLCJwcm9tcHQiLCJzZXROYW1lIiwiUHJvamVjdCIsInRhc2tzIiwiYWRkVGFzayIsImRlbGV0ZVRhc2siLCJnZXROYW1lIiwiZ2V0U2l6ZSIsImdldFRhc2tzIiwic2V0VGFza3MiLCJUYXNrIiwiZGVzY3JpcHRpb24iLCJpc0NvbXBsZXRlZCIsInNldERlc2NyaXB0aW9uIiwic2V0RGF0ZSIsInNldElzQ29tcGxldGVkIiwiZ2V0RGVzY3JpcHRpb24iLCJnZXREYXRlIiwiZ2V0SXNDb21wbGV0ZWQiLCJpbm5lckhUTUwiLCJhcHBIYW5kbGVyIiwicHJvaiIsIm5ld1Byb2plY3QiLCJyZW5kZXJQcm9qZWN0c1RhYiIsInByb2plY3RzVWwiLCJjb250YWluZXJFbGVtZW50IiwicHJvamVjdExpc3QiLCJIVE1MQ29udGVudCIsImdldEVsZW1lbnRCeUlkIiwib25jbGljayIsInJlbmRlclByb2plY3RDb250ZW50IiwibWFpbiIsImFkZFByb2plY3RMaXN0ZW5lcnMiLCJwcm9qZWN0QWxsVGFza3MiLCJkZXNjIiwib25jaGFuZ2UiLCJjaGVja2VkIiwiYWRkVGFza0xpc3RlbmVycyIsImFkZE5ld1Rhc2tMaXN0ZW5lciIsInVwZGF0ZUFsbFRhc2tzIiwiYWxsVGFza3MiLCJmb3JtYXR0ZWREYXRlIiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsInRvZGF5VGFza3MiLCJ1cGRhdGVUb2RheVRhc2tzIiwidGltZU5vdyIsInRpbWVOZXh0V2VlayIsIndlZWtUYXNrcyIsInVwZGF0ZVdlZWtUYXNrcyIsIm1lbnVCdG4iLCJuYXYiLCJzdG9yYWdlQnVja2V0IiwiYXV0Q29udGFpbmVyIl0sInNvdXJjZVJvb3QiOiIifQ==